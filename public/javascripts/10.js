(window.webpackJsonp=window.webpackJsonp||[]).push([[10,8,11,14,15,16,17],Array(334).concat([function(t,e,i){"use strict";i.r(e),i.d(e,"AnimationBase",function(){return o}),i.d(e,"Animation",function(){return r});i(333),i(332);var s=i(349);window.m_draw_animation_texture_info=!1;class n{constructor(t,e){this._raw=null,this._url=null,Object.defineProperties(this,{_raw:{value:t},_url:{value:e}}),this.frame=0,this.time=0,this.delta=0,this.textures=[],this.is_loop=!0,this.is_end=!1,!t&&this._url}getTotalTime(){return this.textures.reduce((t,e)=>t+e.delay,0)}clone(){let t=new this.constructor(this._raw,this._url);return t.textures=this.textures,t}load(){throw new Error("Not implement")}update(t){throw new Error("Not implement")}_resetFrame(){this.frame=0,this.time=0}reset(){this.frame=0,this.time=0,this.is_end=!1}get texture(){throw new Error("Not implement")}destroy(){this.is_loop=!1,this.is_end=!0}}class o extends n{constructor(t,e){super(t,e)}load(){this._raw;for(let t=0;t in this._raw;++t){let e=new s.a(this._raw[t]);this.textures[t]=e}this.textures[0]&&(this.textures[0].isLoaded()||this.textures[0].__loadTexture())}isEnd(){return this.is_end}_update(t){const e=this.textures.length;e>0&&(this.time=this.time+t,this.time>this.texture.delay&&(this.frame=++this.frame%e,this.time=0)),this.delta+=t}update(t){const e=this.textures.length;if(e>0&&(this.time=this.time+t,this.time>this.texture.delay)){if(this.frame=this.frame+1,this.frame>=e){if(!this.is_loop)return this.frame=e-1,void(this.is_end=!0);this.reset()}this.time=0}this.delta+=t}draw(t,e,i,s,n){let o=this.texture;t.drawRotaGraph(o,e,i,s,n)}get texture(){return this.textures[this.frame]}}class r extends o{constructor(t,e){super(t,e),this.draw=this._draw_and_preload}_draw_and_preload(t,e,i,s,n){let o;for(o=this.frame;o>=0;--o){let r=this.textures[o];if(r.isLoaded()){t.drawRotaGraph(r,e,i,s,n);break}}let r=this.textures[++o];r?r.isLoaded()||r.__loadTexture():delete this.draw}}},,function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterAnimationBase",function(){return P}),i.d(e,"CharacterRenderer",function(){return $});var s=i(353),n=i(338),o=i(334),r=(i(335),i(332)),a=i(349),l=i(333),h=i(372);let c={},_={};class u extends a.b{constructor(t,e){super(t,e),this._raw.origin&&(this._raw.origin.__proto__=l.Vec2.prototype);for(let t in this._raw.map)this._raw.map[t].__proto__=l.Vec2.prototype;this.relative=new l.Vec2(0,0),this.calcRelative=this._calcRelative,this.filter=new r.ImageFilter,this.opacity=1,this.visible=!0,this._slot=null,this._place=null,this.classList=null}get z(){return c[this._raw.z]||1}set z(t){console.error("Not implement")}get order(){return this.z}set order(t){console.error(new TypeError("Not implement"))}get origin(){return this._raw.origin||l.Vec2.empty}isHasAnchor(){return!!this._raw.map}get brow(){return this._raw.map.brow}isAnchorBrow(){return!!this._raw.map.brow}get neck(){return this._raw.map.neck}isAnchorNeck(){return!!this._raw.map.neck}get navel(){return this._raw.map.navel}isAnchorNavel(){return!!this._raw.map.navel}get hand(){return this._raw.map.hand}isAnchorHand(){return!!this._raw.map.hand}get handMove(){return this._raw.map.handMove}isAnchorHandMove(){return!!this._raw.map.handMove}get _earBelowHead(){return this._raw.map.earBelowHead}isAnchor_EarBelowHead(){return!!this._raw.map.earBelowHead}get _earOverHead(){return this._raw.map.earOverHead}isAnchor_EarOverHead(){return!!this._raw.map.earOverHead}_anchor(t,e,i){return e[i].minus(t[i]).plus(e.origin.minus(t.origin))}_calcRelative(t,e,i){return this.calcRelative=this._getRelativeFunction(t),this.calcRelative(t,e,i)}_getRelativeFunction(t){return this.isHasAnchor()?this.isAnchorNeck()?this._calcRelative_neck:this.isAnchorBrow()?this._calcRelative_brow:this.isAnchorNavel()?this==t.slots.body?this._getOrigin:this._calcRelative_navel:this.isAnchorHand()?this._calcRelative_hand:this.isAnchorHandMove()?this._url.lastIndexOf("lHand")>0?this._calcRelative_handMove_lHand:this._calcRelative_handMove:void 0:this._calcRelativeEmpty}_calcRelativeEmpty(t,e,i){return l.Vec2.empty}_getOrigin(t,e,i){return this.origin}_calcRelative_neck(t,e,i){return this._anchor(this,e,"neck").minus(e.origin)}_calcRelative_brow(t,e,i){return this._anchor(this,i,"brow").plus(this._anchor(i,e,"neck")).minus(e.origin)}_calcRelative_navel(t,e,i){return e.navel.minus(this.navel).minus(this.origin)}_calcRelative_hand(t,e,i){const s=t.slots.body.fragments.arm.getTexture(t);return null==s?l.Vec2.empty.minus(this.hand).minus(this.origin).minus(e.origin):this._anchor(this,s,"hand").minus(this._anchor(e,s,"navel")).minus(e.origin)}_calcRelative_handMove(t,e,i){return l.Vec2.empty.minus(this.origin).minus(this.handMove)}_calcRelative_handMove_lHand(t,e,i){return l.Vec2.empty.minus(this.origin)}update(t){if(t.slots.body&&t.slots.head){const e=t.slots.body.fragments.body.getTexture(t),i=t.slots.head.fragments.head.getTexture(t);if(e&&i){this.relative=this.calcRelative(t,e,i);const s=t.slots.tamingMob;s&&(this.relative=s.adj_pos(this.relative,e,t))}}}render(t,e){if(!this.relative||!this.visible)return;const i=this.relative.x,s=this.relative.y;t.globalAlpha=this.opacity,this.filter.isEmpty?t.drawGraph2(this,i,s):(t.ctx.filter=this.filter.toString(),t.drawGraph2(this,i,s),t.ctx.filter="none")}}class m extends u{update(t){super.update(t),this.visible=!t.hideBody}}class d extends u{constructor(...t){super(...t),this.graph2=null,this.graph3=null}update(t){if(t.slots.body&&t.slots.head){const e=t.slots.body.fragments.body.getTexture(t),i=t.slots.head.fragments.head.getTexture(t);if(e&&i){this.relative=this.calcRelative(t,e,i);const s=t.slots.tamingMob;s&&(this.relative=s.adj_pos(this.relative,e,t)),this.graph2&&(this.graph2.relative=this.relative),this.graph3&&(this.graph3.relative=this.relative)}}}render(t,e){this.relative&&(t.globalAlpha=this.opacity||1,this.filter.isEmpty?this._render(t):(t.ctx.filter=this.filter.toString(),this._render(t),t.ctx.filter="none"))}_render(t){const e=this.relative.x,i=this.relative.y;t.drawGraph2(this,e,i),this.graph2&&this.graph2.opacity&&(t.globalAlpha=this.graph2.opacity,t.drawGraph2(this.graph2,e,i)),this.graph3&&this.graph3.opacity&&(t.globalAlpha=this.graph3.opacity,t.drawGraph2(this.graph3,e,i))}}class p extends o.Animation{constructor(t,e){super(t,e),Object.defineProperty(this,"_raw",{value:t}),this.__getAttr("z",-1),this.__getAttr("pos",1),super.load()}__getAttr(t,e){t in this._raw?this[t]=this._raw[t]:this[t]=e}render(t,e,i,s){if(e)this.draw(t,0,0,-i,s);else{const e=.25*-this.texture.height;this.draw(t,0,e,0,s)}}}class f{constructor(){this._url=null,this._raw=null,this.animation={},this.action=null,this.time=0,this.frame=0,this.fixed=0,this.z=-2,this.action=1,this.actionExceptRotation=0,this.enable=!0}static async Init(){try{let t=f._list,e=$get.list("/Effect/ItemEff");t.clear(),e.forEach(e=>{t.add(parseInt(e,10))})}catch(t){return!1}}static async load(t){const e=Number(t);if(f._list.has(e)){let e=new f;return await e.load(t),e}return null}async load(t){const e=`/Effect/ItemEff/${Number(t)}/effect`;let i;try{i=await $get.data(e)}catch(t){throw t}return i?this._load(t,e,i):null}update(t,e){e in this.animation?this.action=e:this.action="default",this.animation[this.action]&&this.animation[this.action].update(t)}render(t,e){this.animation&&this.animation[this.action]&&this.animation[this.action].render(t,this.actionExceptRotation,e.angle,e.front>0)}_load(t,e,i){this.id=t,Object.defineProperty(this,"_raw",{value:i}),this.__construct()}__construct(){this.__getAttr("fixed",0),this.__getAttr("z",-1),this.__getAttr("action",1),this.__getAttr("actionExceptRotation",0);for(let t in this._raw)this._raw[t]&&"object"==typeof this._raw[t]&&"0"in this._raw[t]&&(this.animation[t]=new p(this._raw[t],[this._url,t].join("/")))}__getAttr(t,e){t in this._raw?this[t]=this._raw[t]:this[t]=e}}f._list=new Set;class y{constructor(t){this.textures=t}getTexture(t){throw new Error("Not implement")}getFrameTexture(t,e){throw new Error("Not implement")}getFrameCount(t){throw new Error("Not implement")}}class g extends y{constructor(t){super(t)}getTexture(t){return this.getFrameTexture(t,t.action_frame)}getFrameTexture(t,e){if(!(t.action in this.textures))return null;const i=this.textures[t.action].length;return this.textures[t.action][e%i]}getFrameCount(t){return this.textures[t.action]?this.textures[t.action].length:0}}class v extends y{constructor(t){super(t)}getTexture(t){return this.getFrameTexture(t,t.emotion_frame)}getFrameTexture(t,e){if(!(t.emotion in this.textures))return null;return this.textures[t.emotion][e]}getFrameCount(t){return this.textures[t.emotion]?this.textures[t.emotion].length:0}}class x extends y{constructor(t){super(t)}getTexture(t){return this.getFrameTexture(t,t._action_frame)}getFrameTexture(t,e){if(!(t._ride_action in this.textures))return null;const i=this.textures[t._ride_action].length;return this.textures[t._ride_action][e%i]}getFrameCount(t){return this.textures[t._ride_action]?this.textures[t._ride_action].length:0}}class b{constructor(t){this.equip=t}get hue(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let n=t.fragments[e].textures[i][s];if(n)return n.filter.hue}}set hue(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let n=0;n<e.fragments[i].textures[s].length;++n){let o=e.fragments[i].textures[s][n];o&&(o.filter.hue=t)}}get sat(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let n=t.fragments[e].textures[i][s];if(n)return n.filter.sat}}set sat(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let n=0;n<e.fragments[i].textures[s].length;++n){let o=e.fragments[i].textures[s][n];o&&(o.filter.sat=t)}}get bri(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let n=t.fragments[e].textures[i][s];if(n)return n.filter.bri}}set bri(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let n=0;n<e.fragments[i].textures[s].length;++n){let o=e.fragments[i].textures[s][n];o&&(o.filter.bri=t)}}get contrast(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let n=t.fragments[e].textures[i][s];if(n)return n.filter.contrast}}set contrast(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let n=0;n<e.fragments[i].textures[s].length;++n){let o=e.fragments[i].textures[s][n];o&&(o.filter.contrast=t)}}toJSON(){return{hue:this.hue,sat:this.sat,bri:this.bri,contrast:this.contrast}}}class A{constructor(){}isLoaded(){return!1}_unload(){}getFrameCount(t){throw new Error("Not implement")}getDelay(t){throw new Error("Not implement")}toJSON(){throw new Error("Not implement")}}class w extends A{constructor(){super(),this._raw=null,this.effect=null,this.fragments=null,this._onload=null,this.id=null,this.categoryInfo=null,this.slot_order=0,this.islot={},this.vslot={},this.filter=new b(this)}toJSON(){return{id:this.id,filter:this.filter.toJSON()}}isLoaded(){return null!=this.fragments}get _onload(){return this.__onload}set _onload(t){this.__onload=t,this.isLoaded()&&this.__onload.call(this,this)}async load(t,e,i,n){let o;this.id=e,this.categoryInfo=i;try{s.d.isEquipExist(e,i)&&(o=await s.c.getItem(e))}catch(t){throw t}try{!o&&load_extern_item_data&&(o=await load_extern_item_data(e))}catch(t){throw t}return Object.defineProperty(this,"_raw",{value:o}),this.__load_slot(),this.__load_fragments(),this._onload&&this._onload.call(this,this),f.load(this.id).then(t=>this.effect=t),!0}__load_fragments(){const t=this.FragmentConstructor;let e=Object.keys(this._raw_textures),i={};for(let t of e)if("object"==typeof this._raw_textures[t]&&"0"in this._raw_textures[t]){let e=this._base_path+t;i[t]=this.__load_frame_textures(this._raw_textures[t],e)}let s={};for(let t in i)for(let e in i[t])for(let n in i[t][e])n in s||(s[n]={}),t in s[n]||(s[n][t]=[]),s[n][t][e]=i[t][e][n];let n={};for(let e in s)n[e]=new t(s[e]);this.fragments=n}__load_frame_textures(t,e){let i=[];for(let s=0;s in t;++s){let n=`${e}/${s}`;i[s]=this.__load_place_textures(t[s],n)}return i}__load_place_textures(t,e){let i={};for(let s in t){let n=`${e}/${s}`,o=t[s];if(o){const t=this.FragmentTextureConstructor;let e;""==o[""]?(e._url=n,i[s]=e):"string"==typeof o[""]?(e=new t(o),i[s]=e):"hairShade"==s&&(e=new t(o[0]),i[s]=e),e&&(e._slot=this.categoryInfo.slot,e._place=s,e.classList=[e._slot,"item"+this.id,e._place,e._raw.z,"z"+e.z].join(" "))}}return i}__load_slot(){if(!this._raw.info.islot)return;let t=this._raw.info.islot.match(/([A-Z][a-z0-9])/g);for(let e in t){const i=t[e],s=c[i];this.islot[i]=s,s>this.slot_order&&(this.slot_order=s)}let e=this._raw.info.vslot.match(/([A-Z][a-z0-9])/g);for(let t in e){const i=e[t];this.vslot[i]=i}}_unload(){this.fragments=null,this.effect}get opacity(){for(let t in this.fragments)for(let e in this.fragments[t].textures)for(let i=0;i<this.fragments[t].textures[e].length;++i){let s=this.fragments[t].textures[e][i];if(s)return s.opacity}}set opacity(t){for(let e in this.fragments)for(let i in this.fragments[e].textures)for(let s=0;s<this.fragments[e].textures[i].length;++s){let n=this.fragments[e].textures[i][s];n&&(n.opacity=t)}}setFilter(t,e,i){for(let s in this.fragments)for(let n in this.fragments[s].textures)for(let o=0;o<this.fragments[s].textures[n].length;++o){let r=this.fragments[s].textures[n][o];r&&(r.filter.hue=t,r.filter.sat=e,r.filter.bri=i)}}getIconUrl(){return s.c.getIconUrl(this.id)}getIconRawUrl(){return s.c.getIconRawUrl(this.id)}get _animation_type(){throw new Error("Not Implement")}get FragmentConstructor(){throw new Error("Not implement")}get FragmentTextureConstructor(){throw new Error("Not implement")}get _raw_textures(){return this._raw}get _base_path(){return this._url}}class S extends w{constructor(){super()}getFrameCount(t){return t.slots.body.fragments.body.textures[t.action].length}getDelay(t){const e=this._raw[t.action][t.action_frame].delay;return Number.isSafeInteger(e)?e:120}}class C extends S{constructor(){super()}get _animation_type(){return"action"}get FragmentConstructor(){return g}get FragmentTextureConstructor(){return m}}class B extends S{constructor(){super()}get _animation_type(){return"action"}get FragmentConstructor(){return g}get FragmentTextureConstructor(){return u}}class V extends B{constructor(){super()}get _animation_type(){return"action"}get FragmentConstructor(){return g}get FragmentTextureConstructor(){return d}}class M extends B{constructor(){super()}getFrameCount(t){return t.slots.face.fragments.face.textures[t.emotion].length}getDelay(t){const e=this._raw[t.emotion][t.emotion_frame].delay;return null!=e?e:60}}s.c._info["0000"].FragmentType=class extends S{constructor(){super()}get _animation_type(){return"action"}get FragmentConstructor(){return g}get FragmentTextureConstructor(){return m}},s.c._info["0001"].FragmentType=class extends B{constructor(){super(),this.elfEarFragment=null,this.lefEarFragment=null,this.highlefEarFragment=null}__load_fragments(){super.__load_fragments(),this.fragments&&(this.fragments.ear&&(this.elfEarFragment=this.fragments.ear,delete this.fragments.ear),this.fragments.lefEar&&(this.lefEarFragment=this.fragments.lefEar,delete this.fragments.lefEar),this.fragments.highlefEar&&(this.highlefEarFragment=this.fragments.highlefEar,delete this.fragments.highlefEar))}get elfEar(){return null!=this.fragments.ear}set elfEar(t){this.elfEarFragment&&(t?this.fragments.ear=this.elfEarFragment:delete this.fragments.ear)}get lefEar(){return null!=this.fragments.lefEar}set lefEar(t){this.lefEarFragment&&(t?this.fragments.lefEar=this.lefEarFragment:delete this.fragments.lefEar)}get highlefEar(){return null!=this.fragments.highlefEar}set highlefEar(t){this.highlefEarFragment&&(t?this.fragments.highlefEar=this.highlefEarFragment:delete this.fragments.highlefEar)}get _animation_type(){return"action"}get FragmentConstructor(){return g}},s.c._info["0002"].FragmentType=class extends M{constructor(){super()}get _animation_type(){return"emotion"}get FragmentConstructor(){return v}},s.c._info["0003"].FragmentType=V,s.c._info["0004"].FragmentType=V,s.c._info["0100"].FragmentType=C,s.c._info["0101"].FragmentType=class extends M{constructor(){super()}get _animation_type(){return"emotion"}get FragmentConstructor(){return v}},s.c._info["0102"].FragmentType=C,s.c._info["0103"].FragmentType=C,s.c._info["0104"].FragmentType=C,s.c._info["0105"].FragmentType=C,s.c._info["0106"].FragmentType=C,s.c._info["0107"].FragmentType=C,s.c._info["0108"].FragmentType=C,s.c._info["0109"].FragmentType=C,s.c._info["0110"].FragmentType=C,s.c._info["0170"].FragmentType=class extends C{constructor(){super(),this.use_category=null}async load(t,e,i,s){if(!s&&""!=s)throw new TypeError("use_category");return this.use_category=s.slice(2,4),super.load(t,e,i)}get _animation_type(){return"action"}get FragmentConstructor(){return g}get _raw_textures(){return this._raw[this.use_category]}get _base_path(){return this._url+this.use_category}},s.c._info["019"].FragmentType=class extends S{constructor(){super()}get type(){return this._raw.info.tamingMob}get actionMap(){return this._raw.characterAction}get emotionMap(){return this._raw.characterEmotion}adj_pos(t,e,i){const s=this.fragments[0];if(s){const n=s.getTexture(i);if(n)return t.plus(n.navel.minus(e.navel))}return t}getFrameCount(t){return t.slots.body.fragments.body.textures[t._ride_action].length}getDelay(t){const e=Math.trunc(this._raw[t._ride_action][t.action_frame].delay);return Number.isSafeInteger(e)?e:120}get _animation_type(){return"_ride_action"}get FragmentConstructor(){return x}get FragmentTextureConstructor(){return u}};class k{constructor(){this._ordered_slot=[],this._hair=null,this._hair2=null,this._hairMix2=null,this._hair3=null,this._hairMix3=null,this.body=null,this.head=null,this.face=null,this.hair=null,this.cap=null,this.accessoryFace=null,this.accessoryEyes=null,this.accessoryEars=null,this.coat=null,this.longcoat=null,this.pants=null,this.shoes=null,this.glove=null,this.cape=null,this.shield=null,this.weapon=null,this.tamingMob=null,Object.defineProperty(this,"_ordered_slot",{configurable:!0,writable:!0,enumerable:!1,value:[]}),Object.defineProperty(this,"_hair",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hair2",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hairMix2",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hair3",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hairMix3",{writable:!0,enumerable:!1,value:null})}get hair(){return this._hair}set hair(t){this._hair=t,t&&(this._hair2&&this._hairMix2&&(this.hairColor2=this.hairColor2,this.hairMix2=this.hairMix2),this._hair3&&this._hairMix3&&(this.hairColor3=this.hairColor3,this.hairMix3=this.hairMix3))}async __loadColoredHair(t){const e=s.a.getColorHairID(this.hair.id,t),i=s.c.get(e);if(i){const t=`/Character/${i.path+(i.path?"/":"")+e}`,s=void 0;let n=new V;return await n.load(t,e,i,s),n}}get hairColor2(){if(this._hair2)return Number(s.a.getHairColor(this._hair2.id))}set hairColor2(t){if(!t)return void console.error(new TypeError);let e=s.a.getColorHairID(this.hair.id,t);this._hair2&&e==this._hair2.id||(e==this._hair.id?(this._hair2=null,this.hairMix2=0):(this.hair.$promise_hair2=this.__loadColoredHair(t),this.hair.$promise_hair2.then(t=>{delete this.hair.$promise_hair2,this._hair2=t,this._hair2&&null!=this.hairMix2&&(this.hairMix2=this.hairMix2)})))}get hairMix2(){return this._hairMix2}set hairMix2(t){t=Number(t),Promise.resolve(this.hair.$promise_hair2).then(()=>{let e=this._hair2,i=this.hair;if(e&&i){for(let s in e.fragments)for(let n in e.fragments[s].textures)for(let o=0;o<e.fragments[s].textures[n].length;++o){let r=e.fragments[s].textures[n][o],a=i.fragments[s].textures[n][o];a&&(a.graph2=r,a.graph2.opacity=t)}this._hairMix2=t}})}get hairColor3(){if(this._hair3)return Number(s.a.getHairColor(this._hair3.id))}set hairColor3(t){if(!t)return void console.error(new TypeError);let e=s.a.getColorHairID(this.hair.id,t);this._hair3&&this._hair3.id==e||(this._hair.id==e||this._hair2.id==e?(this._hair3=null,this.hairMix3=0):(this.hair.$promise_hair3=this.__loadColoredHair(t),this.hair.$promise_hair3.then(t=>{delete this.hair.$promise_hair3,this._hair3=t,this._hair3&&null!=this.hairMix3&&(this.hairMix3=this.hairMix3)})))}get hairMix3(){return this._hairMix3}set hairMix3(t){t=Number(t),Promise.resolve(this.hair.$promise_hair3).then(()=>{let e=this._hair3,i=this.hair;if(e&&i){for(let s in e.fragments)for(let n in e.fragments[s].textures)for(let o=0;o<e.fragments[s].textures[n].length;++o){let r=e.fragments[s].textures[n][o],a=i.fragments[s].textures[n][o];a&&(a.graph3=r,a.graph3.opacity=t)}this._hairMix3=t}})}async _use(t,e,i){if(!t)return;const n=s.c.get(t);if(n){let s,o=`/Character/${n.path+(n.path?"/":"")+t}`;if(e instanceof w)alert("CharacterSlots # _use: param loadedEquip ??"),s=e;else{e&&alert("CharacterSlots # _use: param loadedEquip ??"),s=new(n.FragmentType||C)}0,e||await s.load(o,t,n,i)?(this[n.slot]&&this[n.slot]._unload(),this[n.slot]=s,this._ordered_slot[s.slot_order]=s):console.warn("item("+t+") is not exist")}}_unuse(t){if(!t)return;let e,i;t instanceof w?(t=(i=t).id,e=i.categoryInfo):e=s.c.get(t);const n=e.slot;if("head"!=n&&"body"!=n&&this[n]&&this[n].id==t){i=this[n];for(let t in i.islot){let e=i.islot[t];this._ordered_slot[e]&&this._ordered_slot[e]._unload(),delete this._ordered_slot[e]}return this[n]=null,!0}return!1}_clear(){this.face=null,this.hair=null,this.cap=null,this.accessoryFace=null,this.accessoryEyes=null,this.accessoryEars=null,this.coat=null,this.longcoat=null,this.pants=null,this.shoes=null,this.glove=null,this.cape=null,this.shield=null;let t=this.head,e=this.body;this._ordered_slot=[],t&&(this._ordered_slot[t.slot_order]=t),e&&(this._ordered_slot[e.slot_order]=e)}_stringify(){let t=["c"];if(this.body&&t.push(this.body.id),this.head&&t.push(this.head.id),this.face&&t.push(this.face.id+"|"+this.face.id),this.hair){let e=[];e.push(this.hair.id),this.hairColor2&&this.hairMix2>0&&e.push(this.hairColor2+"%"+Math.trunc(100*this.hairMix2)),this.hairColor3&&this.hairMix3>0&&e.push(this.hairColor3+"%"+Math.trunc(100*this.hairMix3)),t.push(e.join("|"))}return this.cap&&t.push(this.cap.id),this.accessoryFace&&t.push(this.accessoryFace.id),this.accessoryEyes&&t.push(this.accessoryEyes.id),this.accessoryEars&&t.push(this.accessoryEars.id),this.coat&&t.push(this.coat.id),this.longcoat&&t.push(this.longcoat.id),this.pants&&t.push(this.pants.id),this.shoes&&t.push(this.shoes.id),this.glove&&t.push(this.glove.id),this.shield&&t.push(this.shield.id),this.cape&&t.push(this.cape.id),this.weapon&&t.push(this.weapon.id),t.join(",")}toJSON(){let t=[];return this.body&&t.push(this.body.id),this.head&&t.push(this.head.id),this.face&&t.push(this.face.id),this.hair&&t.push(this.hair.id),this.cap&&t.push(this.cap.id),this.accessoryFace&&t.push(this.accessoryFace.id),this.accessoryEyes&&t.push(this.accessoryEyes.id),this.accessoryEars&&t.push(this.accessoryEars.id),this.coat&&t.push(this.coat.id),this.longcoat&&t.push(this.longcoat.id),this.pants&&t.push(this.pants.id),this.shoes&&t.push(this.shoes.id),this.glove&&t.push(this.glove.id),this.shield&&t.push(this.shield.id),this.cape&&t.push(this.cape.id),this.weapon&&t.push(this.weapon.id),t}*enumerate(){this.face&&(yield this.face),this.hair&&(yield this.hair),yield*this.enumerate_equip()}*enumerate_equip(){this.cap&&(yield this.cap),this.accessoryFace&&(yield this.accessoryFace),this.accessoryEyes&&(yield this.accessoryEyes),this.accessoryEars&&(yield this.accessoryEars),this.coat&&(yield this.coat),this.longcoat&&(yield this.longcoat),this.pants&&(yield this.pants),this.shoes&&(yield this.shoes),this.glove&&(yield this.glove),this.shield&&(yield this.shield),this.cape&&(yield this.cape),this.weapon&&(yield this.weapon)}*enumerate_face(){this.face&&(yield this.face),this.accessoryFace&&(yield this.accessoryFace)}}class I{constructor(){this.ear=void 0,this.useEquip=[],this.unuseEquip=[],this.hair2=void 0,this.hairMix2=void 0,this.weapon=void 0,this.weaponType=void 0}clear(){this.ear=void 0,this.useEquip=[],this.unuseEquip=[],this.hair2=void 0,this.hairMix2=void 0,this.weaponType=void 0}}class P{constructor(){this._$dirty=0,this.job=null,this.subJob=null,this.actani=new h.a,this.speed=1,this.fixed_speed=!1,this.hideBody=!1,this._ride_action="stand1",this._action="stand1",this._action_frame=0,this._emotion="blink",this._emotion_frame=0,this._emotion_time=0,this._emotion_frame_sequence=[0,1,2,1],this.slots=new k,this.__require_update=!0,this.__frag_list=[],this.$$changeLog=new I}_clone(){alert(this.constructor.name+"::_clone");let t=new this.constructor;if(t){t.speed=0,t.x=this.x,t.y=this.y,t.angle=this.angle,t.action=this.action,t.action_frame=this.action_frame,t.emotion=this._emotion,t.emotion_frame=this.emotion_frame;for(let e in this.slots){this.slots[e]&&(t.slots[e]=this.slots[e])}return t}}_waitFrameTexturesLoaded(){let t=[];for(let e in this.slots){let i=this.slots[e];if(i)for(let e in i.fragments){let s=i.fragments[e],n=s.getFrameCount(this);for(let e=0;e<n;++e){let i=s.getFrameTexture(this,e);i&&!i._isLoaded_or_doload()&&t.push(i.$promise)}}}return Promise.all(t)}initAnimation(){this.action="stand1",this._action_frame=0,this.emotion="blink",this._emotion_time=0,this._emotion_frame=0}getSpeed(){return this.fixed_speed?1:this.speed}get elfEar(){if(this.slots.head)return this.slots.head.elfEar}set elfEar(t){this.slots.head&&(this.slots.head.elfEar=t)}get lefEar(){if(this.slots.head)return this.slots.head.lefEar}set lefEar(t){this.slots.head&&(this.slots.head.lefEar=t)}get highlefEar(){if(this.slots.head)return this.slots.head.highlefEar}set highlefEar(t){this.slots.head&&(this.slots.head.highlefEar=t)}get ear(){if(this.slots.head)return this.slots.head.lefEar?"lef":this.slots.head.elfEar?"elf":this.slots.head.highlefEar?"highlef":"human"}set ear(t){this.slots.head?"elf"==t?(this.slots.head.elfEar=!0,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear=t):"lef"==t?(this.slots.head.lefEar=!0,this.slots.head.elfEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear=t):"highlef"==t?(this.slots.head.elfEar=!1,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!0,this.$$changeLog.ear=t):(this.slots.head.elfEar=!1,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear="human"):this.$$changeLog.ear=void 0}get action(){return this._action}set action(t){if(this.slots.tamingMob){let e;this._ride_action=t,this.slots.tamingMob.actionMap?"hideBody"==(e=this.slots.tamingMob.actionMap[t])?(this.hideBody=!0,this._action=t,this.actani._action!=t&&this.actani.reload(t),this.__require_update|=!0):(this.hideBody=!1,this._action=e,this.actani._action!=e&&this.actani.reload(e),this.__require_update|=!0):(this._action="rope"==t?"rope":"ladder"==t?"ladder":"sit",this.actani._action!=t&&this.actani.reload(t),this.__require_update|=!0)}else this.hideBody=!1,this._ride_action=null,this.actani._action!=t&&this.slots.body&&(this._action=t,this.actani.reload(t),this.__require_update|=!0)}get action_frame(){return this._action_frame}set action_frame(t){this._action_frame=t,this.__require_update|=!0}get emotion(){return this._emotion}set emotion(t){this._emotion!=t&&this.slots.face&&this.slots.face.fragments.face.textures[t]&&(this._emotion=t,this._emotion_frame=0,this._emotion_time=0,this._emotion_frame_sequence=[...D(this.emotion_frame_count)],this.__require_update|=!0)}*emotion_frame_sequence_generator(t){for(;;)for(yield*D(t);Math.random()<.5;)yield 0}get emotion_frame(){return this._emotion_frame_sequence[this._emotion_frame%this._emotion_frame_sequence.length]}set emotion_frame(t){this._emotion_frame=t,this._emotion_time=0,this.__require_update|=!0}_get_emotion_next_frame(t){let e=this._emotion_frame+t;return e=e<0?this._emotion_frame_sequence.length-1:e%this._emotion_frame_sequence.length,this._emotion_frame_sequence[e]}get emotion_time(){return this._emotion_time}set emotion_time(t){this.emotion_frame_count&&(t<this.emotion_delay?this._emotion_time=t:(this._emotion_time=0,++this._emotion_frame,this.__require_update|=!0))}get emotion_delay(){return this.slots.face?this.slots.face.getDelay(this):60}get emotion_frame_count(){try{if(this.slots.face)return this.slots.face.getFrameCount(this)}catch(t){}return 0}_update(t){let e=t*this.getSpeed();this.actani&&(this.actani.isEnd()&&this.actani.loop&&this.actani.reset(),this.actani.update(e,this)),this.emotion_time+=t;for(let t in this.slots){let i=this.slots[t];i&&i.effect&&i.effect.enable&&i.effect.update(e)}}update(t){this._update(t)}__forceUpdate(t){this._$dirty=Math.random(),this._update(0|t),this.__update_frag_list()}_draw(t,e,i,s,n){t.pushGlobalAlpha(),this.__require_update&&(this.__update_frag_list(),this.__require_update=!1),this.__draw_list(t,this.__frag_list,e,i,s,n),t.popGlobalAlpha()}__draw_list(t,e,i,s,n,o){t.pushMatrix(),t.translate(i,s),t.rotate(window.m_a||n),o&&t.scale(-1,1);for(let e in this.slots){let i=this.slots[e];i&&i.effect&&i.effect.render(t,this)}for(let i in e){e[i].render(t,this)}t.popMatrix()}__update_frag_list(){this.__frag_list=[];let t={};for(let e=2;e<=3;++e){let i=this.slots["_hair"+e];this.__add_equip_to_frag_list(t,i)}for(let e in this.slots._ordered_slot){let i=this.slots._ordered_slot[e];this.__add_equip_to_frag_list(t,i)}{let e=!1;for(let i in t){let s=t[i];for(let t in s){let i=s[t];if(e){if(i._place.startsWith("face"))continue}else i._place.startsWith("backHair")&&(e=!0);this.__add_frag_to_list(i)}}}{let t=this.__frag_list[114];t&&this.__frag_list.push(t)}this._calcBoundBox()}__add_equip_to_frag_list(t,e){if(null!=e&&!(e>0)){for(let i in e.vslot){t[e.vslot[i]]=[]}for(let i in e.fragments){let s=_[i];if(null!=s){let n=e.fragments[i].getTexture(this);n&&(t[s]?t[s].push(n):t[s]=[n])}else if("default"==i){let n=e.fragments[i].getTexture(this);s=e._raw.info.islot,n&&(t[s]?t[s].push(n):t[s]=[n])}else{let t=e.fragments[i].getTexture(this);t&&this.__add_frag_to_list(t)}}}}__add_frag_to_list(t){t.update(this),this.__frag_list[t.z]=t}_calcBoundBox(){let t=0,e=0,i=0,s=0;for(let n in this.__frag_list){let o=this.__frag_list[n];if(o.texture&&o.relative){let n=o.relative.x,r=o.relative.y,a=n+o.width,l=r+o.height;t=Math.min(t,n),e=Math.min(e,r),i=Math.max(i,a),s=Math.max(s,l)}}return this._boundBox=new l.Rectangle(Math.trunc(t),Math.trunc(e),Math.trunc(i-t),Math.trunc(s-e)),this._boundBox}toJSON(){let t={hair2:this.slots._hair2.id,hairMix2:this.slots.hairMix2,slots:this.slots.toJSON()};return this.slots.head.elfEar?t.ear="elf":this.slots.head.lefEar?t.ear="lef":this.slots.head.highlefEar&&(t.ear="highlef"),t}}class $ extends P{constructor(){super(),this.x=0,this.y=0,this.z=5,this.tx=0,this.ty=0,this.angle=0,this.front=-1,this.__load_task=[],this.render=function(t){},this._boundBox=null}static async Init(){let t=await Promise.all([$get.data("/zmap"),$get.data("/smap"),f.Init(),h.a.Init()]);c={},Object.keys(t[0]).reverse().forEach((t,e)=>c[t]=e+1),_=t[1]}load(){this.use("00002012"),this.use("00012012");let t=Promise.all([...this.__load_task]);return function(t,e){e.then(function(e){t.initAnimation(),t.render=t._render})}(this,t),t}update(t){this.waitLoaded(),super.update(t)}_render(t){const e=Math.trunc(this.x+this.tx),i=Math.trunc(this.y+this.ty);this._draw(t,e,i,this.angle,this.front>0)}_setup_test(){this.use("00026509"),this.use("00044041"),this.use("01053169"),this.use("01071077")}async __synchronize(t){this.__forceUpdate(t),await this.waitLoaded(),await this._waitFrameTexturesLoaded()}async waitLoaded(){let t=this.__load_task;t&&t.length&&await Promise.all(t).then(()=>{this.__load_task=[]})}async use(t,e){switch(e||(e=s.c.getJobWeaponCategory(this.job)),t[0]){case"0":{s.c.isCashWeapon(t)?this.$$changeLog.weapon=t:this.$$changeLog.useEquip.push(t);let i=this.slots._use(t,null,e);this.__load_task.push(i),await i,t.startsWith("019")&&(this.action=this.action),this.__update_frag_list(),this._calcBoundBox()}}}unuse(t){if("0"==t[0]){let e=this.slots._unuse(t);return e&&(this.$$changeLog.unuseEquip.push(t),this._calcBoundBox()),e}}_parse(t){if(!t)return;let e=t.split(",");this.slots._clear(),e.forEach((t,e,i)=>{if(t.indexOf("|")>=0){const e=t.split("|"),i=s.c.get(e[0]);let n;if("face"==i.slot)n=e[1],this.$$changeLog.useEquip.push(n),this.use(n);else if("hair"==i.slot){const t=this.slots;let i=e[1],s=e[2];n=e[0],this.$$changeLog.useEquip.push(n),this.use(n).then(()=>{if(i&&i.indexOf("%")>=0){let e=i.split("%");const s=e[0],n=e[1]/100;this.$$changeLog.hair2=s,this.$$changeLog.hairMix2=n,t.hairColor2=s,t.hairMix2=n}if(s&&s.indexOf("%")>=0){let e=s.split("%");const i=e[0],n=e[1]/100;this.$$changeLog.hair3=i,this.$$changeLog.hairMix3=n,t.hairColor3=e[0],t.hairMix4=e[1]/100}})}else"weapon"==i.slot&&(this.$$changeLog.weaponType=e[1],this.$$changeLog.weapon=n,this.use.apply(this,e,e[1]))}else Number.isFinite(parseInt(t,10))&&this.use(t)})}get hairColor(){return this.slots.hair?s.a.getHairColor(this.slots.hair.id):"0"}set hairColor(t){if(this.slots.hair&&t!=this.hairColor){let e=s.a.getColorHairID(this.slots.hair.id,t);this.use(e)}}get faceColor(){return this.slots.face?s.a.getFaceColor(this.slots.face.id):"0"}set faceColor(t){if(this.slots.face&&t!=this.faceColor){let e=s.a.getColorFaceID(this.slots.face.id,t);this.use(e)}}commitChange(t){if(t.ear&&(this.ear=t.ear),this.useEquip)for(let t of this.useEquip)this.use(t);if(this.unuseEquip)for(let t of this.unuseEquip)this.unuse(t);t.hair2&&t.hairMix2&&(this.slots.hairColor2=t.hair2,this.slots.hairMix2=t.hairMix2),t.hair3&&t.hairMix3,t.weapon&&t.weaponType&&this.use(t.weapon,t.weaponType)}_stringify(t){let e=this.slots._stringify();return t?`chara._parse('${e}')`:e}_outlink(){if(this.slots.body&&this.slots.body.id&&this.slots.face&&this.slots.face.id&&this.action&&this.emotion){let t="https://labs.maplestory.io/api/GMS/latest/character/center/"+this.slots.body.id+"/",e=[...this.slots.enumerate()].map(t=>parseInt(t.id,10));return e[0]=this.slots.face.id+":"+this.emotion,t+=e.join(","),t+="/"+this.action+"?showears="+(this.elfEar?"true":"false"),t+="&showLefEars="+(this.lefEar?"true":"false")}console.log("character need body, face, action, emotion")}_download(){window.open(this._outlink())}_save_as_svg(){this.__texture_to_base64().then(t=>{let e=this.id+".svg",i='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" >';i+='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">\n',i+='<g transform="translate(32, 96)">',t.forEach(function(t){if(t&&t.relative){let e=t.classList;i+=`\t<image class="${e}" opacity="${t.visible?t.opacity:0}" x="${t.relative.x}" y="${t.relative.y}" width="${t.width}" height="${t.height}" xlink:href="${t._url}"></image>\n`}}),i+="</g>",i+='<text x="0" y="122" fill="transparent">'+this._stringify(!1)+"</text>",i+="</svg>",DownloadData(i,"image/svg+xml;utf8",e)})}_save_as_png(t,e){let i=this._calcBoundBox(),s=i.size,n=-i.left,o=i.height;try{t.$swapCanvas()}catch(t){return void console.error(t)}const r=t._ctx2.canvas.width,a=t._ctx2.canvas.height;t.ctx.canvas.width=s.x,t.ctx.canvas.height=s.y;try{this._draw(t,n,o,0,!1)}catch(t){console.error(t)}let l=t.ctx.canvas.toDataURL("image/png");{let t=document.createElement("a"),i=`${e?e+".":""}${this.action}[${this.action_frame}].${this.emotion}[${this.emotion_frame}].png`;t.id=i,t.download=i,t.href=l,document.body.appendChild(t),t.click(),document.body.removeChild(t)}t.ctx.canvas.width=r,t.ctx.canvas.height=a;try{t.$swapCanvas()}catch(t){console.error(t)}return l}async __texture_to_base64(){let t=[];return this.__frag_list.forEach(function(e){if(e){if(e._url.startsWith("data:")?t.push(e):t.push(async function(){return e.texture.$src=e._url,e._url=await T(e._url),e}()),e.graph2){let i=e.graph2._url;i.startsWith("data:")?t.push(e.graph2):t.push(async function(){return e.texture.$src=e._url,e.graph2._url=await T(i),e.graph2}())}if(e.graph3){let i=e.graph3._url;i.startsWith("data:")?t.push(e.graph3):t.push(async function(){return e.texture.$src=e._url,e.graph3._url=await T(i),e.graph3}())}}}),Promise.all(t)}}function*D(t){let e=0;for(;e<t;++e)yield e;for(e-=2;e>0;--e)yield e}function T(t){return new Promise(function(e,i){let s=new XMLHttpRequest;s.onload=function(){let t=new FileReader;t.onloadend=function(){e(t.result)},t.onerror=function(t){i(t)},t.readAsDataURL(s.response)},s.open("GET",t),s.responseType="blob",s.send()})}Object(n.AddInitTask)($.Init())},,function(t,e,i){"use strict";i.r(e),i.d(e,"AddInitTask",function(){return h}),i.d(e,"InitAll",function(){return c});var s=i(358),n=i.n(s),o=(i(401),i(402),i(403),i(404),i(405),i(406),i(407),i(408),i(409),i(410),i(411),i(412),i(375),i(339)),r=i.n(o),a=i(337);window.jQuery=n.a,window.$=n.a,r.a.config.productionTip=!1,r.a.use(a.default),window.onwheel||(window.onwheel=function(){});let l=[];function h(t){l.push(t)}function c(){let t=Promise.all(l);return l=[],t}},,function(t,e,i){"use strict";i.r(e),i.d(e,"ChatBalloon",function(){return n});i(332);var s=i(349);class n{constructor(){this._raw=null,this.style=null}async load(t){if(null==t)throw new TypeError;if(n.cache[t]){let e=n.cache[t];Object.assign(this,e)}else{const e=[this._base_path,t].join("/");this.style=t;let i=$get.data(e);n.cache[t]=this,this.$promise=i,Object.defineProperty(this,"_raw",{value:await i}),delete this.$promise;const o=Number("clr"in this._raw?this._raw.clr:defCol),r=(((4278190080&o)>>>24|(16777215&o)<<8)>>>0).toString(16).padStart(8,"0");this.color=-1!=this._raw.clr&&this._raw.clr?"#"+r:"white",this.nw=new s.a(this._raw.nw),this.n=new s.a(this._raw.n),this.ne=new s.a(this._raw.ne),this.w=new s.a(this._raw.w),this.c=new s.a(this._raw.c),this.e=new s.a(this._raw.e),this.sw=new s.a(this._raw.sw),this.s=new s.a(this._raw.s),this.se=new s.a(this._raw.se),this.arrow=new s.a(this._raw.arrow)}}draw(t,e,i,s){let n=e.match(/(.{1,12})/g);if(!n.length)return;const o=t.ctx,r=this.c.height;o.fillStyle=this.color,o.font="12px 微軟正黑體",o.textAlign="center",o.textBaseline="hanging";const a=3*this.n.width;let l=Math.max.apply(null,n.map(t=>o.measureText(t).width+0+0));l<a&&(l=a);const h=Math.trunc(l/2/this.n.width)*this.n.width,c=2*h,_=n.length*r+0+0;i-=h,s=s-_-this.arrow.height,this.nw.draw2(i,s),this.n._drawPattern(i,s,c,this.n.height),this.ne.draw2(i+c,s);{const t=this.w.width-this.w.x;this.w._drawPattern(i+t,s,this.w.width,_),this.c._drawPattern(i+t,s,c,_),this.e._drawPattern(i+t+c,s,this.e.width,_)}{const t=1&this.arrow.width,e=Math.trunc(this.arrow.width/2),n=h-e;this.sw.draw2(i,s+_),this.s._drawPattern(i,s+_,n,this.s.height),this.s._drawPattern(i+h+e+t,s+_,n-t,this.s.height),this.se.draw2(i+c,s+_),this.arrow.draw2(i-e+h,s+_)}for(let t=0,e=s;t<n.length;++t,e+=r){let s=n[t];o.fillText(s,i+h+0,e+0)}}get _base_path(){return"/UI/ChatBalloon"}}n.cache=window.$images_ChatBalloon||{},window.$images_ChatBalloon=n.cache},function(t,e,i){"use strict";i.r(e);i(332);var s=i(349);class n{constructor(){this._raw=null}async _load(t){Object.defineProperty(this,"_raw",{value:await $get.data(t)})}_load_top(){this.nw=new s.a(this._raw.nw),this.n=new s.a(this._raw.n),this.ne=new s.a(this._raw.ne)}_load_center(){this.w=new s.a(this._raw.w),this.c=new s.a(this._raw.c),this.e=new s.a(this._raw.e)}_load_bottom(){this.sw=new s.a(this._raw.sw),this.s=new s.a(this._raw.s),this.se=new s.a(this._raw.se)}_load_arrow(){this.arrow=new s.a(this._raw.arrow)}_load_color(t){const e=Number("clr"in this._raw?this._raw.clr:t),i=(((4278190080&e)>>>24|(16777215&e)<<8)>>>0).toString(16).padStart(8,"0");this.color=-1!=this._raw.clr&&this._raw.clr?"#"+i:"white"}_draw_top(t,e,i,s,n){const o=2*s;this.nw.draw2(e,i),this.n._drawPatterncx(x,i,o,this.n.height),this.ne.draw2(e+o,i)}_draw_center(t,e,i,s,n){const o=2*s,r=this.w.width-this.w.x;this.w._drawPattern(e+r,i,this.w.width,n),this.c._drawPattern(e+r,i,o,n),this.e._drawPattern(e+r+o,i,this.e.width,n)}_draw_bottom(t,e,i,s,n){const o=2*s;this.sw.draw2(e,i+n),this.s._drawPattern(e,i+n,s,this.s.height),this.se.draw2(e+o,i+n)}_draw_bottom_and_arrow(t,e,i,s,n){const o=2*s,r=1&this.arrow.width,a=Math.trunc(this.arrow.width/2),l=s-a;this.sw.draw2(e,i+n),this.s._drawPattern(e,i+n,l,this.s.height),this.s._drawPattern(e+s+a+r,i+n,l-r,this.s.height),this.se.draw2(e+o,i+n),this.arrow.draw2(e-a+s,i+n)}}i.d(e,"NameLabel",function(){return o});class o extends n{constructor(){super(),this.style=null,this.color=null,this.w=null,this.c=null,this.e=null}async load(t){if(null==t)throw new TypeError;if(o.cache[t]){let e=o.cache[t];Object.assign(this,e)}else{const e=[this._base_path,t].join("/");this.style=t;let i=this._load(e);o.cache[t]=this,this.$promise=i,await i,delete this.$promise,this._load_center(),this._load_color("white")}}draw(t,e,i,s){const n=t.ctx;n.fillStyle=this.color,n.font="12px 微軟正黑體",n.textAlign="center",n.textBaseline="hanging";let o=this.c.height,r=n.measureText(e).width;const a=i-(r=Math.max(2*this.c.width,r))/2,l=s+Math.min(this.w.y,this.e.y);this.w.draw2(a,l),this.c._drawPattern(a,l,r-this.e.x,o),this.e.draw2(a+r,l),n.fillText(e,i,l)}get _base_path(){return"/UI/NameTag"}static get(t){let e=o.cache[t];return e||(e=new o).load(t),e}}o.cache=window.$images_NameLabel||{},window.$images_NameLabel=o.cache},function(t,e,i){"use strict";i.r(e);var s=i(337),n=i(377),o=i(397),r={props:["items"],methods:{getValue:function(){let t=$(this.$el).sortable("toArray");if(t.length!=this.items.length)throw new Error("Can't get value before update.");let e={};for(let i=0;i<t.length;++i)e[t[i]]=i;let i=[];for(let s=0;s<t.length;++s){const n=t[s];i[s]=this.items[e[n]]}this.$emit("update:items",i),this.$emit("input",i)}},mounted:function(){let t=$(this.$el);t.sortable({update:this.getValue.bind(this)}),t.disableSelection()},beforeUpdate:function(){this.$nextTick(function(){if(!this.items)return;let t=$(this.$el),e=[];for(let t=0;t<this.items.length;++t){const i=this.items[t].id;(e[t]=$("#"+i)).remove()}for(let i=0;i<e.length;++i)t.append(e);t.sortable()})},updated:function(){$(this.$el).sortable()},watch:{items:function(t){}}},a=(i(430),i(352)),l=Object(a.a)(r,function(){var t=this,e=t.$createElement;return(t._self._c||e)("ul",[t._l(t.items,function(e,i){return t._t("default",null,{item:e,index:i})})],2)},[],!1,null,null,null).exports,h={data:function(){return{active:!1}}},c=(i(432),Object(a.a)(h,function(){var t=this.$createElement;return(this._self._c||t)("div",{class:this.active?"active":""},[this._t("default")],2)},[],!1,null,"550d0e17",null).exports);var _={mixins:[{props:{position:{default:function(){return{x:0,y:0,my:"left top",at:"left top",collision:"flip"}}}},methods:{calcPosition:function(t){let e,i=Object.assign({x:0,y:0,my:"left top",at:"left top",collision:"flip"},this.position);if((e=i.my.replace(/[+-\d]/g,"").split(" ")).length>=2){let s=t.x||i.x,n=t.y||i.y;s>0?e[0]+="+"+s||"":s<0&&(e[0]+=s||""),n>0?e[1]+="+"+n||"":n<0&&(e[1]+=n||""),e=e.join(" ")}return i.my=e,i},setPosition:function(t){$(this.$el).position(t)}},watch:{position:{handler:function(t){let e=this.calcPosition(t);e.of?alert("JQueryUI.position(option)\nlost option.of:selector"):this.setPosition(e)},deep:!0}}}],props:{show:!0},data:function(){return{_cp_onclick:null}},methods:{},watch:{show:function(t){t?this._cp_onclick||(this._cp_onclick=function(){this.$emit("close")}.bind(this),$(window).on("mousedown",this._cp_onclick)):($(window).off("mousedown",this._cp_onclick),this._cp_onclick=null)}}},u=(i(434),Object(a.a)(_,function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"menu-frame"},[e("transition",{attrs:{name:"menu"}},[this.show?e("div",{staticClass:"menu"},[this._t("default")],2):this._e()])],1)},[],!1,null,null,null).exports),m=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"inline-flex",width:"100%"}},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.selected_category,expression:"selected_category"}],staticStyle:{flex:"1"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selected_category=e.target.multiple?i:i[0]}}},[t._l(t.categoryGroupList,function(e,s){return[e.length>1?[i("optgroup",{attrs:{label:s}},t._l(e,function(e){return i("option",{domProps:{value:e.id_prefix}},[t._v(t._s(e.categoryName))])}))]:[i("option",{domProps:{value:e[0].id_prefix}},[t._v(t._s(e[0].categoryName))])]]})],2),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.search_text,expression:"search_text"}],ref:"input_search",attrs:{type:"search",list:"search_param"},domProps:{value:t.search_text},on:{keydown:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.searchNextText(e):null},input:function(e){e.target.composing||(t.search_text=e.target.value)}}}),t._v(" "),i("datalist",{attrs:{id:"search_param"}},[i("option",{attrs:{value:"劍"}},[t._v("item Name")]),t._v(" "),i("option",{attrs:{value:"01302000"}},[t._v("item ID")]),t._v(" "),i("option",{attrs:{value:"<attr>:/<regexp>/"}}),t._v(" "),i("option",{attrs:{value:"$style:/21158/"}},[t._v("face | hair")]),t._v(" "),i("option",{attrs:{value:"$foreign:/true/"}},[t._v("external resource")]),t._v(" "),i("option",{domProps:{value:"__v:/"+t.DATA_TAG_VERSION+"/"}},[t._v("current version")])]),t._v(" "),i("div",{staticStyle:{position:"relative",display:"inline-block"}},[i("button",{directives:[{name:"ui",rawName:"v-ui:show.mouseenter",value:200,expression:"200",arg:"show",modifiers:{mouseenter:!0}},{name:"ui",rawName:"v-ui:hide.mouseleave",value:200,expression:"200",arg:"hide",modifiers:{mouseleave:!0}},{name:"ui",rawName:"v-ui:ref",value:"setting",expression:"'setting'",arg:"ref"}],staticStyle:{padding:"0"}},[i("span",{staticClass:"ui-icon ui-icon-gear"})]),t._v(" "),i("div",{directives:[{name:"ui",rawName:"v-ui:hide",arg:"hide"},{name:"ui",rawName:"v-ui:show.mouseenter",value:200,expression:"200",arg:"show",modifiers:{mouseenter:!0}},{name:"ui",rawName:"v-ui:hide.mouseleave",value:200,expression:"200",arg:"hide",modifiers:{mouseleave:!0}},{name:"ui",rawName:"v-ui:ref",value:"setting",expression:"'setting'",arg:"ref"}],ref:"setting",staticStyle:{position:"absolute",left:"0",top:"0",background:"#e9e9e9",border:"1px solid #ddd",width:"12em","text-align":"left",padding:"0.25em 0.5em"}},[i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.onlyShowSearchResult,expression:"onlyShowSearchResult"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.onlyShowSearchResult)?t._i(t.onlyShowSearchResult,null)>-1:t.onlyShowSearchResult},on:{change:function(e){var i=t.onlyShowSearchResult,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&(t.onlyShowSearchResult=i.concat([null])):o>-1&&(t.onlyShowSearchResult=i.slice(0,o).concat(i.slice(o+1)))}else t.onlyShowSearchResult=n}}}),t._v("Only show result of search")])]),t._v(" "),i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.displayMode,expression:"displayMode"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.displayMode)?t._i(t.displayMode,null)>-1:t.displayMode},on:{change:function(e){var i=t.displayMode,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&(t.displayMode=i.concat([null])):o>-1&&(t.displayMode=i.slice(0,o).concat(i.slice(o+1)))}else t.displayMode=n}}}),t._v("display: "+t._s(t.displayMode?"plain":"list"))])])])])])}],d={props:{buttons:{type:Array,required:!0},type:{type:String,default:"checkbox"},active:{type:[Number,Array],required:!1}},methods:{onclick:function(t){let e;if("checkbox"==this.type){const i=this.active.indexOf(t);i>=0?(e=[...this.active]).splice(i,1):e=[...this.active,t];const s=this.buttons;let n=e.map(function(t){return s[t]});this.$emit("update:active",e),this.$emit("change",n)}else this.$emit("update:active",t),this.$emit("change",this.buttons[t])},_update_element:function(){let t;if("checkbox"==this.type){if(!this.active)return;t=this.active}else{if(!Number.isInteger(this.active))return;t=[this.active]}let e=this.$el;[...this.$el.querySelectorAll(".active")].forEach(function(t){t.classList.remove("active")});t.forEach(function(t){let i=e.querySelector(`[data-id="${t}"]`);i&&i.classList.toggle("active")})}},watch:{active:function(){this._update_element()}},mounted:function(){this._update_element()}},p=(i(436),Object(a.a)(d,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ui-button-group"},t._l(t.buttons,function(e,s){return i("button",{style:e.style,attrs:{"data-id":s},on:{click:function(e){t.onclick(s)}}},[t._t("default",null,{text:e.text,value:e.value,index:s})],2)}))},[],!1,null,null,null).exports),f=i(353);let y=[{text:"Cash",value:"cash",style:{}},{text:"Standard",value:"standard",style:{}},{text:"Female",value:"female",style:{}},{text:"Male",value:"male",style:{}},{text:"Universal",value:"neutral",style:{}},{text:"Unlimited",value:"unlimited",style:{}},{text:"Beginner",value:"beginner",style:{}},{text:"Warrior",value:"warrior",style:{}},{text:"Magician",value:"magician",style:{}},{text:"Bowman",value:"bowman",style:{}},{text:"Thief",value:"thief",style:{}},{text:"Pirate",value:"pirate",style:{}}];const g=[{text:"黑",value:"0",style:{background:"#333333"}},{text:"藍",value:"1",style:{background:"#0000ff"}},{text:"紅",value:"2",style:{background:"#ff0000"}},{text:"綠",value:"3",style:{background:"#00ff00"}},{text:"棕",value:"4",style:{background:"#804040"}},{text:"青",value:"5",style:{background:"#00ffc0"}},{text:"紫",value:"6",style:{background:"#8000ff"}},{text:"粉",value:"7",style:{background:"#ff00ff"}},{text:"銀",value:"8",style:{background:"#C0C0C0"}}],v=[{text:"黑",value:"0",style:{background:"#333333"}},{text:"紅",value:"1",style:{background:"#ff0000"}},{text:"橙",value:"2",style:{background:"#ff8040"}},{text:"黃",value:"3",style:{background:"#ffff00"}},{text:"綠",value:"4",style:{background:"#00ff00"}},{text:"藍",value:"5",style:{background:"#0000ff"}},{text:"紫",value:"6",style:{background:"#8000ff"}},{text:"棕",value:"7",style:{background:"#804040"}}];class x{static cash(t){return t.cash>0}static standard(t){return null==t.cash||0==t.cash}static female(t){return 1==t.gender}static male(t){return 0==t.gender}static neutral(t){return 2==t.gender}static unlimited(t){return 0==t.reqJob||null==t.reqJob}static beginner(t){return-1==t.reqJob}static warrior(t){return t.reqJob>0&&1&t.reqJob}static magician(t){return t.reqJob>0&&2&t.reqJob}static bowman(t){return t.reqJob>0&&4&t.reqJob}static thief(t){return t.reqJob>0&&8&t.reqJob}static pirate(t){return t.reqJob>0&&16&t.reqJob}}x.list=[];for(let t=0;t<y.length;++t){let e=x[y[t].value];x.list[t]=e}const b=new class{constructor(){this.pageSize=100}calcPage(t){return Math.trunc(t/this.pageSize)}};var A={data:function(){return{search_text:"",search_next:-1,column_count:5,loaded_equip_list:[],loaded_category:null,equip_list:[],search_equip_result:[],selected_category:"0000",filters:[],face_color:0,hair_color:0,hair_color2:0,hair_mix2:0,page:0,face_names:null,hair_names:null,onlyShowSearchResult:!0,displayMode:!0}},computed:{DATA_TAG_VERSION:()=>window.DATA_TAG+window.DATA_VERSION,categoryGroupList:function(){let t={},e={};return Object.values(f.c._info).forEach(i=>{let s;if(i.slot){let t=i.slot.match(/^[0-9a-z]+/);s=t?t[0].toLocaleLowerCase():i.slot}else{i.categoryName}t[s]||(t[s]=[]);let n=i.categoryName||i.listPath;e[n]||(t[s].push(i),e[n]=1)}),t},filter_buttons:()=>y,face_color_buttons:()=>g,hair_color_buttons:()=>v,__count_of_item_in_page:function(){const t=this.page*b.pageSize,e=Math.min(t+b.pageSize,this.equip_list.length)-t;return Math.min(Math.max(0,e),this.equip_list.length)},__count_of_page:function(){return Math.ceil(this.equip_list.length/b.pageSize)}},methods:{getHairMixColor1CSS(){return Object.assign({"clip-path":"polygon(50% 0%, 0% 20%, 0% 90%, 100% 90%, 100% 20%)"},v[this.hair_color].style)},getHairMixColor2CSS(){return Object.assign({"clip-path":"polygon(0% 10%, 0% 80%, 50% 100%, 100% 80%, 100% 10%)"},null!=this.hair_color2?v[this.hair_color2].style:{})},copyImageUrl:function(t,e){let i=t.currentTarget.querySelector("img");if(i)if(i.src.startsWith("data:image/")){if(window.confirm("圖示可能不存在，確定要複製圖示位置？")){let t=f.c.getIconRawUrl(e);copyToClipboard(t)}}else copyToClipboard(i.src)},copyInnerText:function(t){let e=t.currentTarget,i=e.innerText;copyToClipboard(i),SelectText(e)},copyText:function(t,e){copyToClipboard(e)},search_equip:async function(t){if(this.clearSearch(),!t||""==t)return this.search_equip_result=[],void(this.onlyShowSearchResult&&await this.loadList());{await this.loadList();let e=this.search_equip_result;this.search_equip_result=[];try{let i=t.match(/^(.+):\/(.+)\/$/);if(i)try{let t=i[1];if("$style"==t&&Number.isSafeInteger(Number(i[2]))){let t=i[2];if(this._is_category_hair()){let e=f.a.getColorHairID(String(t),0);this.search_equip_result=this.equip_list.filter(function(t,i){let s=null==t.id||f.a.getColorHairID(t.id,0);if(s&&-1!=s.indexOf(e))return t.$page=b.calcPage(i),!0})}else if(this._is_category_face()){let e=f.a.getColorFaceID(String(t),0);this.search_equip_result=this.equip_list.filter(function(t,i){let s=null==t.id||f.a.getColorFaceID(t.id,0);if(s&&-1!=s.indexOf(e))return t.$page=b.calcPage(i),!0})}}if(0==this.search_equip_result.length){let e=RegExp(i[2]);this.search_equip_result=this.equip_list.filter(function(i,s){if(null!=i[t]&&e.test(i[t]))return i.$page=b.calcPage(s),!0}),this.search_equip_result&&this.search_equip_result[0]&&this.search_equip_result[0][t]&&this.search_equip_result[0][t].localeCompare&&this.search_equip_result.sort(function(e,i){let s=e[t],n=i[t];return s.localeCompare(n)})}}catch(t){return void(this.search_equip_result=[])}else this.search_equip_result=this.equip_list.filter(function(e,i){if(e.id&&e.id.indexOf(t)>=0||e.name&&(e.name.indexOf(t)>=0||e.name.toLowerCase().indexOf(t.toLowerCase())>=0))return e.$page=b.calcPage(i),!0}),this.search_equip_result.sort(function(t,e){return t.name&&e.name?t.name.localeCompare(e.name):0})}catch(t){this.search_equip_result=e}e=null,this.search_equip_result.length?this.searchNextText():console.log("no search: "+t)}this.onlyShowSearchResult&&(this.page=0,this.equip_list=this.search_equip_result)},searchNextText:function(t){if(this.onlyShowSearchResult)return;let e=(this.search_next+1)%this.search_equip_result.length,i=this.search_equip_result[e];if(i){const t=i.$page;this.change_page(t),this.$nextTick(function(){window.location.hash="item"+i.id,this.$refs.input_search.focus()}),this.search_next=e}},clearSearch:function(){this.search_next=-1,window.location.hash=""},change_page:function(t){this.page!=t&&(this.$refs.content.scrollTop=0),this.page=t,this.clearSearch()},__get_category_slot:function(){const t=f.c.get(this.selected_category);return t?t.slot:null},_is_category_face:function(){return"face"==this.__get_category_slot()},_is_category_hair:function(){return"hair"==this.__get_category_slot()},__get_color:function(){return this._is_category_face()?this.face_color:this._is_category_hair()?this.hair_color:""},loadList:async function(){if(null==this.selected_category)return;this.clearSearch();const t=this.selected_category,e=f.c.get(t),i=e.listPath||e.path||e.slot,s=i+this.__get_color();let n=[];if(s!=this.loaded_category||0==this.loaded_equip_list.length){if(!(n=JSON.parse(await $get.asset(`equips/${s}.json`)))||!n.length)return void alert("? "+s);if(await concat_external_resource(s,n),"weapon"==e.slot&&"0170"!=this.selected_category){let e=JSON.parse(await $get.asset("equips/0170.json")),i=t.slice(2,4),s=e.filter(t=>t.__t.indexOf(i)>=0);n=n.concat(s)}n.forEach(f.b[i]||f.b._equip),this.loaded_equip_list=n,this.loaded_category=s}else n=[...this.loaded_equip_list];if(n.length>0){let t=this.__get_filter();t&&(n=n.filter(t))}if(this.equip_list=n,n.length>0){const t=this.__count_of_page;t>0?this.page>=t&&(this.page=t-1):this.page=0,n.sort((t,e)=>t.id-e.id)}this.equip_list=n},__get_filter:function(){if(!this.filters.length)return null;const t=x.list,e=this.filters.map(function(e){return i=>!t[e](i)});return e.length?function(t){return e.every(function(e){return e(t)})}:void 0},__get_item:function(t){const e=this.page*b.pageSize;return this.equip_list[e+t]},__get_item_id:function(t){return this.__get_item(t).id},__get_item_name:function(t){return this.__get_item(t).name||"[null]"},__get_item_name_ex:function(t){return this.__get_item(t)._name||"[null]"},__get_item_icon_url:function(t){let e=this.__get_item(t);return e.icon&&e.icon[""]?e.icon[""]:"images/warning.png"},__face_or_hair_img_onerror:async function(t){let e=this.__get_item(t);if(e){if(e.icon&&e.icon[""]){let t=e.icon[""];if(t.startsWith("images/")){let i=t.split("/"),s=i.splice(i.length-1,1);i[1]="ls";let n=JSON.parse(await $get(i.join("/"))),o=n.indexOf(s)+1;if(o<n.length)return s=n[o],i[1]="images",void(e.icon[""]=i.join("/")+"/"+s)}}e.icon[""]="images/warning.png"}else alert("error: this.__get_item(index)\nindex="+t)},clickItem:function(t,e){if("0170"==this.selected_category){let t=this.__get_item(e);console.groupCollapsed("沒有設定職業，無法使用點裝武器"),console.log("click cash weapon: [%o] %o %o",t.id,t.name,t),console.groupEnd()}else{let i=this.__get_item(e);this.$emit("clickItem",{event:t,id:i.id,category:this.selected_category,equip:i}),console.log("Use equip: [%o] %o %o",i.id,i.name,i)}},hoverItem:function(t,e){let i=this.__get_item(e);this.$emit("hoverItem",{event:t,id:i.id,category:this.selected_category,equip:i})},mouseleaveItem:function(t,e){let i=this.__get_item(e);this.$emit("mouseleaveItem",{event:t,id:i.id,category:this.selected_category,equip:i})},selected_category_onchange:function(t){"0002"==t?this.face_color=Number(window.chara.renderer.faceColor):"0003"!=t&&"0004"!=t||(this.hair_color=Number(window.chara.renderer.hairColor),window.chara.renderer.slots.hairColor2&&window.chara.renderer.slots.hairMix2&&(this.hair_color2=Number(window.chara.renderer.slots.hairColor2),this.hair_mix2=Math.trunc(100*Number(window.chara.renderer.slots.hairMix2)))),this.search_equip(this.search_text)}},watch:{search_text:function(t,e){this.search_equip(t)},onlyShowSearchResult:async function(t){t?this.search_equip(this.search_text):this.search_text&&await this.loadList()},selected_category:function(t){this.selected_category_onchange(t)},filters:async function(){await this.loadList()},face_color:async function(){this.$emit("faceColor",{color:this.face_color}),await this.loadList()},hair_color:async function(){this.$emit("hairColor",{color:this.hair_color}),await this.loadList()},hair_color2:async function(){this.$emit("hairColor2",{color:this.hair_color2,mix:this.hair_mix2/100})},hair_mix2:async function(){this.$emit("hairMix2",{color:this.hair_color2,mix:this.hair_mix2/100})}},mounted:function(){this.selected_category="0000",this.selected_category_onchange(this.selected_category)},directives:{focus:{inserted:function(t){t.focus()}}},components:{"ui-draggable":n.a,"ui-button-group":p},mixins:[o.a]},w=(i(438),Object(a.a)(A,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ui-draggable",{staticClass:"ui-dialog ui-equip-box",attrs:{zIndex:t.zIndex,position:t.position}},[t.minimum?i("div",{staticClass:"header",style:t.header_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._v("\n\t\tEquip box\n\t\t"),i("div",{staticClass:"header-buttons"},[i("button",{staticClass:"header-button",on:{click:function(e){t.minimum=!t.minimum}}},[i("span",{staticClass:"ui-icon ui-icon-plus"})])])]):i("div",{staticClass:"header btn-group",style:t.header_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[i("div",{staticClass:"header",staticStyle:{"text-align":"left"}},[t._v("\n\t\t\tEquip box\n\t\t\t"),i("div",{staticClass:"header-buttons"},[i("button",{staticClass:"header-button",on:{click:function(e){t.minimum=!t.minimum}}},[i("span",{staticClass:"ui-icon ui-icon-minus"})])])]),t._v(" "),i("div",[t._m(0)]),t._v(" "),i("div",{staticClass:"button-area",staticStyle:{background:"lightgray"}},[i("ui-button-group",{staticClass:"filters",attrs:{type:"checkbox",buttons:t.filter_buttons,active:t.filters},on:{"update:active":function(e){t.filters=e}},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.text,s=t.value;return[i("img",{attrs:{src:"images/toolstrip_"+s+".png",alt:e}})]}}])}),t._v(" "),t._is_category_face()?i("ui-button-group",{staticClass:"face_color",attrs:{type:"radio",buttons:t.face_color_buttons,active:t.face_color},on:{"update:active":function(e){t.face_color=e}},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.text,n=e.value;return[i("span",{style:{background:"#"+n},attrs:{value:n,title:n+". "+s+"色臉型"}},[t._v(t._s(s))])]}}])}):t._e(),t._v(" "),t._is_category_hair()?[i("ui-button-group",{staticClass:"hair_color",attrs:{type:"radio",buttons:t.hair_color_buttons,active:t.hair_color},on:{"update:active":function(e){t.hair_color=e}},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.text,n=e.value;return[i("span",{style:{background:"#"+n},attrs:{value:n,title:n+". "+s+"色髮型 ("+n+")"}},[t._v(t._s(s))])]}}])}),t._v(" "),i("table",{staticClass:"hair_color",staticStyle:{"font-family":"monospace","text-shadow":"0 0 5px white","border-spacing":"1px"}},[i("tr",[i("td",{style:t.getHairMixColor1CSS()},[i("span",{staticStyle:{width:"3em",display:"inline-block"}},[t._v(t._s(String(100-t.hair_mix2))+"%")])]),t._v(" "),i("td",{staticStyle:{width:"100%"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.hair_mix2,expression:"hair_mix2",modifiers:{number:!0}}],staticStyle:{width:"100%"},attrs:{type:"range",min:"0",max:"100",step:"1"},domProps:{value:t.hair_mix2},on:{__r:function(e){t.hair_mix2=t._n(e.target.value)},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",{style:t.getHairMixColor2CSS()},[i("span",{staticStyle:{width:"3em",display:"inline-block"}},[t._v(t._s(String(t.hair_mix2))+"%")])])])]),t._v(" "),i("ui-button-group",{staticClass:"hair_color",attrs:{type:"radio",buttons:t.hair_color_buttons,active:t.hair_color2},on:{"update:active":function(e){t.hair_color2=e}},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.text,n=e.value;return[i("span",{style:{background:"#"+n},attrs:{value:n,title:n+". "+s+"色髮型 ("+n+")"}},[t._v(t._s(s))])]}}])})]:t._e()],2),t._v(" "),t.__count_of_item_in_page>0?i("div",{staticClass:"header pagination top"},[t._l(t.__count_of_page,function(e){return[t.page==e-1?i("a",{staticClass:"active",attrs:{title:e-1}},[t._v(t._s(e))]):i("a",{attrs:{title:e-1,href:"#"},on:{click:function(i){i.preventDefault(),t.change_page(e-1)}}},[t._v(t._s(e))])]})],2):t._e()]),t._v(" "),i("div",{ref:"content",staticClass:"content",style:t.content_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t.__count_of_item_in_page>0?[0==t.displayMode?[i("ul",{staticClass:"item-list",staticStyle:{width:"calc(6*48px)"}},[t._l(t.__count_of_item_in_page,function(e){return[i("li",{key:t.__get_item_id(e-1),staticClass:"list-item",attrs:{id:"item"+t.__get_item_id(e-1)},on:{click:function(i){return"button"in i||!t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])?"button"in i&&0!==i.button?null:void t.clickItem(i,e-1):null},mousemove:function(i){t.hoverItem(i,e-1)},mouseleave:function(i){t.mouseleaveItem(i,e-1)}}},[i("table",{staticClass:"item-detail",on:{contextmenu:function(t){t.preventDefault()}}},[i("tr",[i("td",{staticClass:"item-icon-outer-frame",attrs:{rowspan:"2"}},[i("div",{staticClass:"item-icon-frame",on:{mousedown:function(i){return"button"in i||!t._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])?"button"in i&&2!==i.button?null:void t.copyImageUrl(i,t.__get_item_id(e-1)):null}}},[i("img",{attrs:{src:t.__get_item_icon_url(e-1)},on:{error:function(i){t.__face_or_hair_img_onerror(e-1)}}})])]),t._v(" "),i("td",{on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])?"button"in e&&2!==e.button?null:void t.copyInnerText(e):null}}},[i("div",{staticClass:"item-name",style:t.__get_item(e-1).$foreign?"color: red":""},[t._v(t._s(t.__get_item_name(e-1)))])])]),t._v(" "),i("tr",[i("td",{staticClass:"item-id",on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])?"button"in e&&2!==e.button?null:void t.copyInnerText(e):null}}},[t._v(t._s(t.__get_item_id(e-1)))])])])])]})],2)]:[i("div",{staticClass:"item-list-sm",style:{width:"calc("+(t.column_count+1)+"*48px)"}},[t._l(t.__count_of_item_in_page,function(e){return[i("div",{key:t.__get_item_id(e-1),staticClass:"list-item-sm",attrs:{id:"item"+t.__get_item_id(e-1)},on:{contextmenu:function(t){t.preventDefault()},click:function(i){return"button"in i||!t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])?"button"in i&&0!==i.button?null:void t.clickItem(i,e-1):null},mousemove:function(i){t.hoverItem(i,e-1)},mouseleave:function(i){t.mouseleaveItem(i,e-1)}}},[i("table",{staticClass:"item-detail"},[i("tr",[i("td",{staticClass:"item-icon-outer-frame"},[i("div",{staticClass:"item-icon-frame-sm",on:{mousedown:[function(i){return"button"in i||!t._k(i.keyCode,"right",39,i.key,["Right","ArrowRight"])?"button"in i&&2!==i.button?null:void t.copyText(i,t.__get_item_name(e-1)):null},function(i){if("button"in i&&1!==i.button)return null;i.preventDefault(),t.copyText(i,t.__get_item_id(e-1))}]}},[i("img",{attrs:{src:t.__get_item_icon_url(e-1)},on:{error:function(i){t.__face_or_hair_img_onerror(e-1)}}})])])])])])]})],2)]]:[i("div",{pre:!0,attrs:{style:"cursor: default;"}},[t._v("\n\t\t\t\tNo search item\n\t\t\t")])]],2),t._v(" "),t.minimum?t._e():i("div",{staticClass:"footer",style:t.header_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t.minimum?t._e():i("div",{staticStyle:{"text-align":"center"}},[t.__count_of_item_in_page>0?i("div",{staticClass:"pagination bottom"},[t._l(t.__count_of_page,function(e){return[t.page==e-1?i("a",{staticClass:"active",attrs:{title:e-1}},[t._v(t._s(e))]):i("a",{attrs:{title:e-1,href:"#"},on:{click:function(i){i.preventDefault(),t.change_page(e-1)}}},[t._v(t._s(e))])]})],2):t._e()])])])},m,!1,null,null,null).exports),S=(i(339),{props:["chara"],computed:{frag_list:{get:function(){let t=[];this.chara.__forceUpdate();for(let e in this.chara.__frag_list){let i=this.chara.__frag_list[e];i.texture&&(t.push(i),i.graph2&&i.graph2.texture&&t.push(i.graph2),i.graph3&&i.graph3.texture&&t.push(i.graph3))}return t},set:function(t){}}},methods:{get_ft_src:function(t){return t.texture.src},get_ft_style:function(t){return{left:t.relative.x+"px",top:t.relative.y+"px",opacity:t.opacity,width:t.width+"px",height:t.height+"px",filter:t.filter.toString(),visibility:t.visible?"visible":"hidden"}}}}),C=(i(440),Object(a.a)(S,function(){var t=this,e=t.$createElement,i=t._self._c||e;return null!=t.chara?i("div",{staticClass:"frame"},[i("div",{staticClass:"center"},[t._l(t.frag_list,function(e){return[e.relative?i("img",{class:e.classList,style:t.get_ft_style(e),attrs:{src:t.get_ft_src(e)}}):t._e()]})],2)]):t._e()},[],!1,null,"370f889e",null).exports),B={props:["chara"],computed:{frag_list:{get:function(){let t=[];this.chara.__forceUpdate();for(let e in this.chara.__frag_list){let i=this.chara.__frag_list[e];i.texture&&(t.push(i),i.graph2&&i.graph2.texture&&t.push(i.graph2),i.graph3&&i.graph3.texture&&t.push(i.graph3))}return t},set:function(t){}}},data:function(){return{is_loading:!1,is_processing:!1}},methods:{get_ft_src:function(t){return t.texture.src},get_ft_style:function(t){return{left:t.relative.x+"px",top:t.relative.y+"px",opacity:t.visible?t.opacity:0,width:t.width+"px",height:t.height+"px",filter:t.filter.toString()}},fake:function(){let t=this;t.is_processing=!0,setTimeout(function(){t.is_processing=!1},1e3)},download2:function(){let t="data:image/svg+xml;utf8,"+this.$el.innerHTML;window.open(t)}},update:function(){this.$el.style.cursor="not-allowed",this.is_loading=!0},updated:function(){this.$el.style.cursor="default",this.is_loading=!1}},V=(i(442),Object(a.a)(B,function(){var t=this,e=t.$createElement,i=t._self._c||e;return null!=t.chara?i("div",{staticClass:"ui-character-frame"},[i("svg",{attrs:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0",y:"0",width:"64",height:"96"}},[i("g",{attrs:{transform:"translate(32, 96)"}},[t._l(t.frag_list,function(e){return[e.relative?i("image",{class:e.classList,attrs:{x:e.relative.x,y:e.relative.y,width:e.width,height:e.height,opacity:e.opacity,"xlink:href":t.get_ft_src(e)}}):t._e()]})],2)]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.is_loading?i("div",{staticClass:"ui-character-center"},[i("div",{staticClass:"ui-character-text"},[t._v("\n\t\t\t\tloading...\n\t\t\t")])]):t._e()]),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.is_processing?i("div",{staticClass:"ui-character-center"},[i("div",{staticClass:"ui-character-text"},[t._v("\n\t\t\t\tprocess...\n\t\t\t")])]):t._e()])],1):t._e()},[],!1,null,null,null).exports),M={props:["sceneChara"],data:function(){return{isShowDebug:!1,isShowEquipImageFilter:[]}},computed:{actions:()=>character_action_list,emotions:()=>character_emotion_list,chara:function(){return this.sceneChara.renderer},chara_angle:{get:function(){return Math.round(Math.degrees(this.sceneChara.renderer.angle))},set:function(t){this.sceneChara.renderer.angle=Math.radians(t)}}},methods:{pauseAnimation:function(){this.chara.speed=this.chara.speed?0:1},isEquip:function(t){return f.c.isEquip(t)},getEquipCategoryName:function(t){return f.c.get(t.id).categoryName}}},k=(i(444),Object(a.a)(M,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"UIEditCharacterAttribute",staticStyle:{display:"inline-block"}},[i("div",{staticStyle:{display:"inline-block","vertical-align":"top"}},[i("table",{staticStyle:{"border-collapse":"collapse","border-spacing":"0px"}},[i("tr",[i("td",[t.chara.speed?[i("button",{attrs:{title:"pause animation"},on:{click:t.pauseAnimation}},[i("img",{attrs:{src:"images/player_pause.png",alt:"pause"}})])]:[i("button",{attrs:{title:"play animation"},on:{click:t.pauseAnimation}},[i("img",{attrs:{src:"images/player_play.png",alt:"play"}})])]],2),t._v(" "),i("td",{attrs:{title:"animation speed"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.speed,expression:"chara.speed",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"5",step:"0.01"},domProps:{value:t.chara.speed},on:{input:function(e){e.target.composing||t.$set(t.chara,"speed",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[t.sceneChara.enablePhysics?i("button",{on:{click:function(e){t.sceneChara.enablePhysics=!1}}},[t._v("禁用物理")]):i("button",{on:{click:function(e){t.sceneChara.enablePhysics=!0}}},[t._v("啟用物理")])]),t._v(" "),i("td",[i("button",{on:{click:function(e){t.isShowDebug=!t.isShowDebug}}},[t._v("細節")])])]),t._v(" "),i("tr",[i("th",[t._v("動作")]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model",value:t.chara.action,expression:"chara.action"}],on:{clicl:function(e){t.update_frame_list("action")},change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.chara,"action",e.target.multiple?i:i[0])}}},[t.actions.length?t._l(t.actions,function(e){return i("option",[t._v(t._s(e))])}):i("option",{attrs:{disabled:"",value:""}},[t._v("請選擇")])],2)]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.action_frame,expression:"chara.action_frame",modifiers:{number:!0}}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.$set(t.chara,"action_frame",e.target.multiple?i:i[0])}}},[t.actions.length?t._l(t.chara.action_frame_count,function(e){return i("option",{domProps:{value:e-1}},[t._v(t._s(e-1))])}):i("option",{attrs:{disabled:""}},[t._v(" ---- ")])],2)])]),t._v(" "),i("tr",[i("th",[t._v("表情")]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model",value:t.chara.emotion,expression:"chara.emotion"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.chara,"emotion",e.target.multiple?i:i[0])}}},[t.emotions.length?t._l(t.emotions,function(e){return i("option",[t._v(t._s(e))])}):i("option",{attrs:{disabled:"",value:""}},[t._v("請選擇")])],2)]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.emotion_frame,expression:"chara.emotion_frame",modifiers:{number:!0}}],on:{clicl:function(e){t.update_frame_list("emotion")},change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.$set(t.chara,"emotion_frame",e.target.multiple?i:i[0])}}},[t.emotions.length?t._l(t.chara.emotion_frame_count,function(e){return i("option",{domProps:{value:e-1}},[t._v(t._s(e-1))])}):i("option",{attrs:{disabled:""}},[t._v(" ---- ")])],2)])]),t._v(" "),i("tr",{attrs:{title:"禁用物理後可設定角色的位置"}},[i("th",[t._v("位置")]),t._v(" "),i("td",{staticStyle:{display:"flex",position:"absolute"},attrs:{colspan:"3"}},[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.x,expression:"chara.x",modifiers:{number:!0}}],attrs:{disabled:t.sceneChara.enablePhysics,type:"number",min:"-9999",max:"9999"},domProps:{value:t.chara.x},on:{input:function(e){e.target.composing||t.$set(t.chara,"x",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.y,expression:"chara.y",modifiers:{number:!0}}],attrs:{disabled:t.sceneChara.enablePhysics,type:"number",min:"-9999",max:"9999"},domProps:{value:t.chara.y},on:{input:function(e){e.target.composing||t.$set(t.chara,"y",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.sceneChara.$layer,expression:"sceneChara.$layer",modifiers:{number:!0}}],attrs:{disabled:t.sceneChara.enablePhysics,type:"number",min:"0",max:"7"},domProps:{value:t.sceneChara.$layer},on:{input:function(e){e.target.composing||t.$set(t.sceneChara,"$layer",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),i("tr",{attrs:{title:"禁用物理後可設定角色的旋轉和方向"}},[i("td",{attrs:{colspan:"4"}},[i("label",[t._v("旋轉：\n\t\t\t\t\t\t"),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.chara_angle,expression:"chara_angle",modifiers:{number:!0}}],attrs:{disabled:t.sceneChara.enablePhysics,type:"number",min:"-180",max:"180",step:"10"},domProps:{value:t.chara_angle},on:{input:function(e){e.target.composing||(t.chara_angle=t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v("°\n\t\t\t\t\t")]),t._v(" "),i("label",[t._v("方向：\n\t\t\t\t\t\t"),i("select",{directives:[{name:"model",rawName:"v-model.number",value:t.chara.front,expression:"chara.front",modifiers:{number:!0}}],attrs:{disabled:t.sceneChara.enablePhysics},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(e){var i="_value"in e?e._value:e.value;return t._n(i)});t.$set(t.chara,"front",e.target.multiple?i:i[0])}}},[i("option",{attrs:{value:"1"}},[t._v("右")]),t._v(" "),i("option",{attrs:{value:"-1"}},[t._v("左")])])])])]),t._v(" "),i("tr",[i("th",{attrs:{rowspan:"2"}},[t._v("耳朵")]),t._v(" "),i("td",[i("label",{staticClass:"chara_ear"},[t._v("人類"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.chara.ear,expression:"chara.ear"}],attrs:{type:"radio",name:"chara_ear",value:"human",checked:""},domProps:{checked:t._q(t.chara.ear,"human")},on:{change:function(e){t.$set(t.chara,"ear","human")}}})])]),t._v(" "),i("td",[i("label",{staticClass:"chara_ear"},[t._v("妖精"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.chara.ear,expression:"chara.ear"}],attrs:{type:"radio",name:"chara_ear",value:"elf"},domProps:{checked:t._q(t.chara.ear,"elf")},on:{change:function(e){t.$set(t.chara,"ear","elf")}}})])]),t._v(" "),i("td",[i("label",{staticClass:"chara_ear"},[t._v("木雷普"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.chara.ear,expression:"chara.ear"}],attrs:{type:"radio",name:"chara_ear",value:"lef"},domProps:{checked:t._q(t.chara.ear,"lef")},on:{change:function(e){t.$set(t.chara,"ear","lef")}}})])])]),t._v(" "),i("tr",[i("td",[i("label",{staticClass:"chara_ear"},[t._v("亥雷普"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.chara.ear,expression:"chara.ear"}],attrs:{type:"radio",name:"chara_ear",value:"highlef"},domProps:{checked:t._q(t.chara.ear,"highlef")},on:{change:function(e){t.$set(t.chara,"ear","highlef")}}})])])])])]),t._v(" "),t.isShowDebug?i("div",{staticStyle:{width:"100%",display:"inline-block","user-select":"text"}},[i("hr"),t._v(" "),i("table",{staticStyle:{"border-spacing":"0px","border-collapse":"collapse",width:"100%"}},[t._l(t.chara.slots._ordered_slot,function(e,s){return[e?[i("tr",{on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td",[t._v("\n\t\t\t\t\t\t\t"+t._s(t.getEquipCategoryName(e))+"\n\t\t\t\t\t\t")]),t._v(" "),i("td",{staticStyle:{width:"32px",height:"32px"}},[i("img",{staticClass:"equip-icon",attrs:{src:e.getIconUrl()}})]),t._v(" "),i("td",[i("div",[t._v(t._s(e.name))]),t._v(" "),i("div",[t._v(t._s(e.id))])]),t._v(" "),i("td")]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("tr",{directives:[{name:"show",rawName:"v-show",value:t.isShowEquipImageFilter[s],expression:"isShowEquipImageFilter[index]"}],on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td"),t._v(" "),i("td",[t._v("opacity")]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.opacity,expression:"equip.opacity",modifiers:{number:!0}}],attrs:{type:"range",min:"0.01",max:"1",step:"0.01"},domProps:{value:e.opacity},on:{__r:function(i){t.$set(e,"opacity",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.opacity,expression:"equip.opacity",modifiers:{number:!0}}],attrs:{type:"number",min:"0.01",max:"1",step:"0.01"},domProps:{value:e.opacity},on:{input:function(i){i.target.composing||t.$set(e,"opacity",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("button",{staticClass:"btn",on:{click:function(t){e.opacity=1}}},[t._v("×")])])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("tr",{directives:[{name:"show",rawName:"v-show",value:t.isShowEquipImageFilter[s],expression:"isShowEquipImageFilter[index]"}],on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td"),t._v(" "),i("td",[t._v("hue")]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.hue,expression:"equip.filter.hue",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"359"},domProps:{value:e.filter.hue},on:{__r:function(i){t.$set(e.filter,"hue",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.hue,expression:"equip.filter.hue",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"359"},domProps:{value:e.filter.hue},on:{input:function(i){i.target.composing||t.$set(e.filter,"hue",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("button",{staticClass:"btn",on:{click:function(t){e.filter.hue=0}}},[t._v("×")])])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("tr",{directives:[{name:"show",rawName:"v-show",value:t.isShowEquipImageFilter[s],expression:"isShowEquipImageFilter[index]"}],on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td"),t._v(" "),i("td",[t._v("sat")]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.sat,expression:"equip.filter.sat",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"999"},domProps:{value:e.filter.sat},on:{__r:function(i){t.$set(e.filter,"sat",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.sat,expression:"equip.filter.sat",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"999"},domProps:{value:e.filter.sat},on:{input:function(i){i.target.composing||t.$set(e.filter,"sat",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("button",{staticClass:"btn",on:{click:function(t){e.filter.sat=100}}},[t._v("×")])])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("tr",{directives:[{name:"show",rawName:"v-show",value:t.isShowEquipImageFilter[s],expression:"isShowEquipImageFilter[index]"}],on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td"),t._v(" "),i("td",[t._v("bri")]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.bri,expression:"equip.filter.bri",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"999"},domProps:{value:e.filter.bri},on:{__r:function(i){t.$set(e.filter,"bri",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.bri,expression:"equip.filter.bri",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"999"},domProps:{value:e.filter.bri},on:{input:function(i){i.target.composing||t.$set(e.filter,"bri",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("button",{staticClass:"btn",on:{click:function(t){e.filter.bri=100}}},[t._v("×")])])])]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("tr",{directives:[{name:"show",rawName:"v-show",value:t.isShowEquipImageFilter[s],expression:"isShowEquipImageFilter[index]"}],on:{mouseover:function(e){t.isShowEquipImageFilter[s]=!0},mouseleave:function(e){t.isShowEquipImageFilter[s]=!1}}},[i("td"),t._v(" "),i("td",[t._v("contrast")]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.contrast,expression:"equip.filter.contrast",modifiers:{number:!0}}],attrs:{type:"range",min:"0",max:"999"},domProps:{value:e.filter.contrast},on:{__r:function(i){t.$set(e.filter,"contrast",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.filter.contrast,expression:"equip.filter.contrast",modifiers:{number:!0}}],attrs:{type:"number",min:"0",max:"999"},domProps:{value:e.filter.contrast},on:{input:function(i){i.target.composing||t.$set(e.filter,"contrast",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("button",{staticClass:"btn",on:{click:function(t){e.filter.contrast=100}}},[t._v("×")])])])])]:t._e()]})],2)]):t._e()])},[],!1,null,"10601658",null).exports),I=i(365);var P={store:new s.default.Store({state:{},actions:{}}),data:function(){return{spawns:[],m:{type:"m",id:8880141,x:0,y:0,mobTime:0,f:0,hide:0,fh:1,cy:0,rx0:0,rx1:0},is_clear:!0}},computed:{},methods:{onCollapsed:function(){this.hidePreview()},showPreview:async function(t,e){let i=t.currentTarget,s="m"==e.type?"Mob":"Npc",n=this.$root.$refs.smallTip,o=await I.b.loadLifeDesc(e),r=$get.imageUrl(`/${s}/${e.id}/stand/0`);n.html=["<div>"+o.name+"</div>"+`<img src="${r}" />`],n.show(function(){n.setPosition({my:"right center",at:"left center",of:i,collision:"fit"})})},hidePreview:function(t){this.$root.$refs.smallTip.hide()},addSpawn:function(){if(scene_map&&scene_map.lifeMgr){this.m.type.match(/m|n/)||window.alert("life type: 'm' or 'n'");let t=new I.a(this.m);t.y=t.cy,scene_map.lifeMgr.spawnPoints.push(t)}this.reload()},reload:function(){const t=scene_map.lifeMgr.spawnPoints;this.spawns=new Array(t.length);for(let e=0;e<t.length;++e)this.$set(this.spawns,e,t[e]);this.is_clear=!1,this.$emit("resize")},removeAll:function(){this.is_clear=!0,this.spawns=[],this.$emit("resize")},killAll:function(){scene_map.lifeMgr.entities.forEach(t=>t.die())}},mounted:function(){this.$on("onCollapsed",this.onCollapsed)}},D=(i(446),Object(a.a)(P,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ui-life-list"},[i("table",[i("thead",[i("tr",[i("td",{attrs:{colspan:"9"}},[i("button",{staticStyle:{float:"right"},attrs:{title:"Issues: not work"},on:{click:t.removeAll}},[t._v("Remove all")]),t._v(" "),i("button",{staticStyle:{float:"right"},attrs:{title:"Issues: not work ??"},on:{click:t.reload}},[t._v("reload")]),t._v(" "),i("button",{staticStyle:{float:"right"},on:{click:t.killAll}},[t._v("Kill all")])])]),t._v(" "),t._m(0),t._v(" "),i("tr",{staticClass:"item new-item",on:{mouseover:function(e){t.showPreview(e,t.m)},mouseleave:t.hidePreview}},[i("td",[i("button",{staticClass:"input",on:{click:t.addSpawn}},[t._v("add")])]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.m.id,expression:"m.id"}],staticClass:"input-mobid",attrs:{type:"number",id:"mob-id",min:"1",max:"9999999"},domProps:{value:t.m.id},on:{input:function(e){e.target.composing||t.$set(t.m,"id",e.target.value)}}})]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model",value:t.m.type,expression:"m.type"}],attrs:{id:"mob-type"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.m,"type",e.target.multiple?i:i[0])}}},[i("option",{attrs:{value:"m"}},[t._v("Mob")]),t._v(" "),i("option",{attrs:{value:"n"}},[t._v("Npc")])])]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.m.x,expression:"m.x",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",id:"mob-x"},domProps:{value:t.m.x},on:{input:function(e){e.target.composing||t.$set(t.m,"x",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.m.cy,expression:"m.cy",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",id:"mob-y"},domProps:{value:t.m.cy},on:{input:function(e){e.target.composing||t.$set(t.m,"cy",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.m.f,expression:"m.f"}],staticClass:"input",attrs:{type:"checkbox",id:"mob-flip"},domProps:{checked:Array.isArray(t.m.f)?t._i(t.m.f,null)>-1:t.m.f},on:{change:function(e){var i=t.m.f,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.m,"f",i.concat([null])):o>-1&&t.$set(t.m,"f",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.m,"f",n)}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.m.fh,expression:"m.fh",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",id:"mob-fh"},domProps:{value:t.m.fh},on:{input:function(e){e.target.composing||t.$set(t.m,"fh",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.m.rx0,expression:"m.rx0",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",id:"mob-rx0"},domProps:{value:t.m.rx0},on:{input:function(e){e.target.composing||t.$set(t.m,"rx0",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.m.rx1,expression:"m.rx1",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number",id:"mob-rx1"},domProps:{value:t.m.rx1},on:{input:function(e){e.target.composing||t.$set(t.m,"rx1",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})])])]),t._v(" "),i("tbody",t._l(t.spawns,function(e,s){return i("tr",{staticClass:"item",on:{mouseover:function(i){t.showPreview(i,e)},mouseleave:t.hidePreview}},[i("td",[i("button",{staticClass:"input",staticStyle:{"text-align":"center"},attrs:{title:"preview"}},[t._v(t._s(s))])]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.id,expression:"spawn.id"}],staticClass:"input-mobid",attrs:{type:"number",min:"1",max:"9999999"},domProps:{value:e.id},on:{input:function(i){i.target.composing||t.$set(e,"id",i.target.value)}}})]),t._v(" "),i("td",[i("select",{directives:[{name:"model",rawName:"v-model",value:e.type,expression:"spawn.type"}],on:{change:function(i){var s=Array.prototype.filter.call(i.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(e,"type",i.target.multiple?s:s[0])}}},[i("option",{attrs:{value:"m"}},[t._v("Mob")]),t._v(" "),i("option",{attrs:{value:"n"}},[t._v("Npc")])])]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.x,expression:"spawn.x",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number"},domProps:{value:e.x},on:{input:function(i){i.target.composing||t.$set(e,"x",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.cy,expression:"spawn.cy",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number"},domProps:{value:e.cy},on:{input:function(i){i.target.composing||t.$set(e,"cy",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.f,expression:"spawn.f"}],staticClass:"input",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.f)?t._i(e.f,null)>-1:e.f},on:{change:function(i){var s=e.f,n=i.target,o=!!n.checked;if(Array.isArray(s)){var r=t._i(s,null);n.checked?r<0&&t.$set(e,"f",s.concat([null])):r>-1&&t.$set(e,"f",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(e,"f",o)}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.fh,expression:"spawn.fh",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number"},domProps:{value:e.fh},on:{input:function(i){i.target.composing||t.$set(e,"fh",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.rx0,expression:"spawn.rx0",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number"},domProps:{value:e.rx0},on:{input:function(i){i.target.composing||t.$set(e,"rx0",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),i("td",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:e.rx1,expression:"spawn.rx1",modifiers:{number:!0}}],staticClass:"input",attrs:{type:"number"},domProps:{value:e.rx1},on:{input:function(i){i.target.composing||t.$set(e,"rx1",t._n(i.target.value))},blur:function(e){t.$forceUpdate()}}})])])}))])])},[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("tr",[i("td",[i("label",{attrs:{for:"mob-preview"}},[t._v("\n\t\t\t\t\t\t#\n\t\t\t\t\t")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-id"}},[t._v("ID")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-type"}},[t._v("type")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-x"}},[t._v("x")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-y"}},[t._v("y")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-flip"}},[t._v("flip")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-fh"}},[t._v("fh")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-rx0"}},[t._v("rx0")])]),t._v(" "),i("td",[i("label",{attrs:{for:"mob-rx1"}},[t._v("rx1")])])])}],!1,null,"ea11de16",null).exports),T={props:["objs","displayMode"],data:function(){return{aaaa:0}},methods:{isShowRX:function(t){return 4==t||5==t},isShowRY:function(t){return 5==t||7==t},isShowCX:function(t){return 1==t||3==t||4==t||6==t||7==t},isShowCY:function(t){return 2==t||3==t||5==t||6==t||7==t},get_ObjPath_style:function(t){let e=t.display_aabb?{background:t.aabb_color}:{};return e["border-bottom"]="1px solid black",e},scrollIntoView:function(t,e){const i=e.aabb.center;$gv.m_viewRect.setCenter(i.x,i.y),e.$select(),t.currentTarget.scrollIntoView(),this.aaaa++},fupdate:function(){this.$forceUpdate()},copyToClipboard:function(t,e){window.SelectText(t.currentTarget)}}},G=(i(448),Object(a.a)(T,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticStyle:{display:"none"}},[t._v(t._s(t.aaaa))]),t._v(" "),t._l(t.objs,function(e,s){return[i("div",[i("div",{staticClass:"info sticky",style:t.get_ObjPath_style(e),attrs:{title:"select it and scroll into view"},on:{click:function(i){t.scrollIntoView(i,e)}}},[i("span",[t._v("["+t._s(s)+"]")]),t._v(" "),i("span",{staticClass:"text",on:{contextmenu:function(i){i.preventDefault(),t.copyToClipboard(i,e._url)}}},[t._v(t._s(e._url))])]),t._v(" "),i("div",{staticClass:"view"},[2!=t.displayMode?i("div",{staticClass:"info"},[i("table",{staticClass:"table"},[i("tr",[i("td",[t._v("type(sign)")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.type,callback:function(i){t.$set(e,"type",t._n(i))},expression:"obj.type"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("x")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.x,callback:function(i){t.$set(e,"x",t._n(i))},expression:"obj.x"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("y")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.y,callback:function(i){t.$set(e,"y",t._n(i))},expression:"obj.y"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("z")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.z,callback:function(i){t.$set(e,"z",t._n(i))},expression:"obj.z"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("zM")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.zM,callback:function(i){t.$set(e,"zM",t._n(i))},expression:"obj.zM"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("flip")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",min:"0",max:"1"},model:{value:e.f,callback:function(i){t.$set(e,"f",t._n(i))},expression:"obj.f"}})],1)]),t._v(" "),null!=e.typeb?[i("tr",[i("td",[t._v("typeb")]),t._v(" "),i("td",[i("input-select",{staticClass:"input",model:{value:e.typeb,callback:function(i){t.$set(e,"typeb",t._n(i))},expression:"obj.typeb"}},[i("option",{attrs:{value:"0",title:""}},[t._v("default")]),t._v(" "),i("option",{attrs:{value:"1",title:"horizontal fill"}},[t._v("repeat-x")]),t._v(" "),i("option",{attrs:{value:"2",title:"vertical fill"}},[t._v("repeat-y")]),t._v(" "),i("option",{attrs:{value:"3",title:"fill"}},[t._v("fill")]),t._v(" "),i("option",{attrs:{value:"4",title:"horizontal roll"}},[t._v("roll-x")]),t._v(" "),i("option",{attrs:{value:"5",title:"vertical roll"}},[t._v("roll-y")]),t._v(" "),i("option",{attrs:{value:"6",title:"horizontal fill roll"}},[t._v("fill roll-x")]),t._v(" "),i("option",{attrs:{value:"7",title:"vertical fill roll"}},[t._v("fill roll-y")])])],1)]),t._v(" "),i("tr",[i("td",[t._v("a")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{min:"0",max:"255",type:"number"},model:{value:e.a,callback:function(i){t.$set(e,"a",t._n(i))},expression:"obj.a"}})],1)]),t._v(" "),t.isShowRX(e.typeb)?i("tr",[i("td",[t._v("rx")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"橫向滾動速度"},model:{value:e.rx,callback:function(i){t.$set(e,"rx",t._n(i))},expression:"obj.rx"}})],1)]):t._e(),t._v(" "),t.isShowRY(e.typeb)?i("tr",[i("td",[t._v("ry")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"縱向滾動速度"},model:{value:e.ry,callback:function(i){t.$set(e,"ry",t._n(i))},expression:"obj.ry"}})],1)]):t._e(),t._v(" "),t.isShowCX(e.typeb)?i("tr",[i("td",[t._v("cx")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",min:"0",title:"橫向間隔"},model:{value:e.cx,callback:function(i){t.$set(e,"cx",t._n(i))},expression:"obj.cx"}})],1)]):t._e(),t._v(" "),t.isShowCY(e.typeb)?i("tr",[i("td",[t._v("cy")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",min:"0",title:"縱向間隔"},model:{value:e.cy,callback:function(i){t.$set(e,"cy",t._n(i))},expression:"obj.cy"}})],1)]):t._e()]:t._e()],2)]):i("div",{staticClass:"info"},[i("div",[t._v(t._s(e.constructor.name))]),t._v(" "),i("div",[i("table",{staticClass:"tb"},t._l(e._raw,function(e,s){return i("tr",[i("td",[t._v(t._s(s))]),t._v(" "),i("td",[t._v(t._s(e))])])}))])]),t._v(" "),e.textures.length&&e.textures[e.frame].texture?i("div",{staticClass:"imgbox"},[i("div",{staticClass:"info"},[e.textures[e.frame]._url.length>300?[i("a",[t._v("...")])]:[i("a",{attrs:{href:e.textures[e.frame]._url}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(e._texture_base_path)),"MapBackBase"!=e.constructor.name?i("span",{staticClass:"red-text"},[t._v("/"+t._s(e.frame))]):t._e()])]],2),t._v(" "),i("div",[i("img",{staticClass:"img",attrs:{src:e.textures[e.frame].texture.src}})])]):t._e(),t._v(" "),1==t.displayMode?i("div",{staticClass:"info"},[e.textures.length&&e.textures[e.frame].texture?i("table",{staticClass:"table"},[i("tr",[i("td",[t._v("frame")]),t._v(" "),i("td",[i("input-number",{staticClass:"input-sm",attrs:{min:0,max:e.textures.length-1,type:"number"},on:{input:t.fupdate},model:{value:e.frame,callback:function(i){t.$set(e,"frame",t._n(i))},expression:"obj.frame"}}),t._v(" / "+t._s(e.textures.length-1))],1)]),t._v(" "),i("tr",[i("td",[t._v("center:")]),t._v(" "),i("td",[i("div",{staticClass:"input-xy"},[i("input-number",{attrs:{type:"number"},model:{value:e.textures[e.frame].x,callback:function(i){t.$set(e.textures[e.frame],"x",t._n(i))},expression:"obj.textures[obj.frame].x"}}),t._v(" "),i("input-number",{attrs:{type:"number"},model:{value:e.textures[e.frame].y,callback:function(i){t.$set(e.textures[e.frame],"y",t._n(i))},expression:"obj.textures[obj.frame].y"}})],1)])]),t._v(" "),i("tr",[i("td",[t._v("size:")]),t._v(" "),i("td",[t._v(t._s(e.textures[e.frame]._raw.__h)+" * "+t._s(e.textures[e.frame]._raw.__h))])]),t._v(" "),i("tr",[i("td",[t._v("opacity")]),t._v(" "),i("td",[i("div",{staticClass:"input-xy"},[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.textures[e.frame].a0,callback:function(i){t.$set(e.textures[e.frame],"a0",t._n(i))},expression:"obj.textures[obj.frame].a0"}}),t._v(" "),i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.textures[e.frame].a1,callback:function(i){t.$set(e.textures[e.frame],"a1",t._n(i))},expression:"obj.textures[obj.frame].a1"}})],1)])]),t._v(" "),i("tr",[i("td",[t._v("delay")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number"},model:{value:e.textures[e.frame].delay,callback:function(i){t.$set(e.textures[e.frame],"delay",t._n(i))},expression:"obj.textures[obj.frame].delay"}})],1)]),t._v(" "),i("tr",[i("td",[t._v("move")]),t._v(" "),i("td",[i("input-select",{staticClass:"input",model:{value:e.textures[e.frame].movetype,callback:function(i){t.$set(e.textures[e.frame],"movetype",t._n(i))},expression:"obj.textures[obj.frame].movetype"}},[i("option",{attrs:{value:"0",title:""}},[t._v("static")]),t._v(" "),i("option",{attrs:{value:"1",title:""}},[t._v("橫向移動")]),t._v(" "),i("option",{attrs:{value:"2",title:""}},[t._v("縱向移動")]),t._v(" "),i("option",{attrs:{value:"3",title:""}},[t._v("旋轉")])])],1)]),t._v(" "),1==e.textures[e.frame].movetype?i("tr",[i("td",[t._v("moveW")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"移動寬"},model:{value:e.textures[e.frame].movew,callback:function(i){t.$set(e.textures[e.frame],"movew",t._n(i))},expression:"obj.textures[obj.frame].movew"}})],1)]):2==e.textures[e.frame].movetype?i("tr",[i("td",[t._v("moveH")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"移動高"},model:{value:e.textures[e.frame].moveh,callback:function(i){t.$set(e.textures[e.frame],"moveh",t._n(i))},expression:"obj.textures[obj.frame].moveh"}})],1)]):t._e(),t._v(" "),3==e.textures[e.frame].movetype?i("tr",[i("td",[t._v("moveR")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"旋轉週期(ms/π)"},model:{value:e.textures[e.frame].mover,callback:function(i){t.$set(e.textures[e.frame],"mover",t._n(i))},expression:"obj.textures[obj.frame].mover"}})],1)]):0!=e.textures[e.frame].movetype?i("tr",[i("td",[t._v("moveP")]),t._v(" "),i("td",[i("input-number",{staticClass:"input",attrs:{type:"number",title:"移動週期"},model:{value:e.textures[e.frame].movep,callback:function(i){t.$set(e.textures[e.frame],"movep",t._n(i))},expression:"obj.textures[obj.frame].movep"}})],1)]):t._e(),t._v(" "),t._m(0,!0)]):t._e()]):t._e(),t._v(" "),2==t.displayMode||e.constructor.name.endsWith("SkeletalAnim")?i("div",{staticClass:"info"},[i("table",{staticClass:"tb"},t._l(e._raw,function(e,s){return i("tr",[i("td",[t._v(t._s(s))]),t._v(" "),i("td",[t._v(t._s(e))])])}))]):t._e()])]),t._v(" "),i("hr")]})],2)},[function(){var t=this.$createElement,e=this._self._c||t;return e("tr",[e("td"),this._v(" "),e("td")])}],!1,null,"6e4fb2d8",null).exports),L=i(366),R=i(335);var E={store:new s.default.Store({state:{charaList:[],chara:null,selected:null,_last_id:0,progressValue:0,progressMaximum:0},getters:{lastId:function(t,e){return"chara_"+t._last_id}},mutations:{clear:function(t){t.charaList=[]},increaseId(t){t._last_id+=1},increaseProgress:function(t,e){t.progressValue+=e.amount,t.progressValue>=t.progressMaximum&&(t.progressValue=0,t.progressMaximum=0)},increaseProgressMax:function(t,e){t.progressMaximum+=e.amount}},actions:{isIdExist:function(t,e){const i=t.state;if(e&&e.id){const t=e.id;for(let e=0;e<i.charaList.length;++e){if(i.charaList[e].id==t)return!0}}return!1},sortCharaById:function(t,e){const i=t.state;i.charaList=i.charaList.sort((t,e)=>{return i(t.id)-i(e.id);function i(e){if(!t)return 0;return 0|Number(e).split("_")[1]}})},selectChara:function(t,e){const i=t.state,s=e.id;let n=-1;for(let t=0;t<i.charaList.length;++t){if(i.charaList[t].id==s){n=t;break}}if(n>=0){const t=i.charaList[n];if(t.$remote)return;try{if(i.chara&&(i.chara.enablePhysics=!1),t.enablePhysics=!0,t.$physics){const e=t.renderer.x/$gv.CANVAS_SCALE,i=t.renderer.y/$gv.CANVAS_SCALE;t.$physics.setPosition(e,i,!0)}}catch(t){}return window.chara=i.chara=t,i.selected=s,s}},_addChara:async function(t,e){const i=t.state;if(e&&e.chara instanceof L.a){const s=e.chara;return await s.renderer.__synchronize(),i.charaList.push(s),t.dispatch("selectChara",{id:s.id}),t.commit("increaseProgress",{amount:1}),s}},_createChara:async function(t,e){window.$io&&e&&e.remote_chara&&(e.emplace=e.remote_chara);t.state;t.commit("increaseId");const i=t.getters.lastId;let s;(s=e&&e.remote_chara?new L.c(window.scene_map):new L.b(window.scene_map)).id=i,await s.renderer.load(),t.commit("increaseProgress",{amount:1}),e?e.chara instanceof L.a?(s.renderer._parse(e.chara.renderer._stringify(!1)),s.renderer.x=e.chara.renderer.x,s.renderer.y=e.chara.renderer.y):e.emplace&&(s.id=e.emplace.id,s.renderer._parse(e.emplace.code)):s.renderer._setup_test();let n=await t.dispatch("_addChara",{chara:s});try{window.scene_map&&window.scene_map.addChara(n)}catch(t){console.error(t)}return n},createChara:async function(t,e){return t.commit("increaseProgressMax",{amount:2}),await t.dispatch("_createChara",e)},loadCharacters:async function(t){t.state;let e=JSON.parse(window.localStorage.getItem("chara_list"));if(e){t.commit("clear"),t.commit("increaseProgressMax",{amount:2*e.length});for(let i=0;i<e.length;++i){const s=e[i];await t.dispatch("isIdExist",{id:s.id})?console.log("character: "+s.id+"is exist"):(console.log("load character["+i+"]: "+s.id),await t.dispatch("_createChara",{emplace:{id:s.id,code:s.code}}))}}},saveCharacters:function(t){let e=[];t.state.charaList.forEach(function(t,i){const s=t.id,n=t.renderer._stringify(!1);e[i]={id:s,code:n}}),window.localStorage.setItem("chara_list",JSON.stringify(e))}}}),data:function(){let t=window.innerWidth/1366,e=window.innerHeight/768;return{dirty:0,is_show_chara_dl_menu:!1,mapEditorMode:"layeredObject",displayMode:0,selectedLayer:0,wnd_debug_style:{background:"#ffffff",padding:"0 0.5em"},wnds:{menu:{name:"$menu",visable:!0,pos:{x:0,y:0}},character_list:{name:"Characters",visable:!0,pos:{x:900*t,y:220*e}},character_attribute:{name:"Character attribute",visable:!0,pos:{x:900*t,y:0*e}},equip_box:{name:"Equip box",visable:!0,pos:{x:0*t,y:50*e}},spawnpoint:{name:"Spawn point",visable:!1,pos:{x:350*t,y:0*e}},debug_window:{name:"Map editor (Debug)",visable:!1,pos:{x:0*t,y:100*e}}},gv:$gv}},computed:Object.assign(s.default.mapState({charaList:"charaList",selected:"selected",chara:"chara",progressValue:"progressValue",progressMaximum:"progressMaximum"}),{}),methods:{scene_map:function(){return window.scene_map},loadCharacters:function(){console.log("load character"),this.$store.dispatch("loadCharacters")},saveCharacters:function(){console.log("save characters"),alert("save characters"),this.$store.dispatch("saveCharacters")},selectChara:function(t){console.log("select character: "+t),this.$store.dispatch("selectChara",{id:t})},addNewChara:function(){console.log("create new character"),this.$store.dispatch("createChara")},addCloneChara:function(){this.chara&&(console.log("clone character: "+this.chara.id),this.$store.dispatch("createChara",{chara:this.chara}))},oninput_sort:function(t){this.$store.state.charaList=t},faceColor:async function({color:t}){this.chara&&this.chara&&null!=t&&(this.$store.commit("increaseProgressMax",{amount:2}),this.chara.renderer.faceColor=t,this.$store.commit("increaseProgress",{amount:1}),await this.chara.renderer.__synchronize(0),this.$store.commit("increaseProgress",{amount:1}),app.updateScreen())},hairColor:async function({color:t}){this.chara&&this.chara&&null!=t&&(this.$store.commit("increaseProgressMax",{amount:2}),this.chara.renderer.hairColor=t,this.$store.commit("increaseProgress",{amount:1}),await this.chara.renderer.__synchronize(0),this.$store.commit("increaseProgress",{amount:1}),app.updateScreen())},$hairMixColor2:function({color:t,mix:e}){const i=this;this.$store.commit("increaseProgressMax",{amount:1}),this.chara.renderer.slots.hairColor2=t,Promise.all([this.chara.renderer.slots.hair.$promise_hair2,this.chara.renderer.slots.hair.$promise_hair3]).then(async function(t,s){await i.chara.renderer.__synchronize(0),i.chara.renderer.slots.hairMix2=e,app.updateScreen(),i.$store.commit("increaseProgress",{amount:1})}).catch(function(t){i.$store.commit("increaseProgress",{amount:1})})},hairColor2:function(t){this.$hairMixColor2(t)},hairMix2:function(t){this.$hairMixColor2(t)},clickItem:function(t){let{id:e,category:i,equip:s}=t;if(this.chara){if(window.$io)return this.chara.useItem(e,i).then(function(t){console.log("can't use item: "+e)});if(!f.c.isEquip(e)||!this.chara.renderer.unuse(e)){this.$store.commit("increaseProgressMax",{amount:2});try{this.chara.useItem(e,i,s)}catch(t){throw this.$store.commit("increaseProgressMax",{amount:-2}),t}this.$store.commit("increaseProgress",{amount:1});try{this.chara.renderer.__synchronize(0).then(()=>{this.$store.commit("increaseProgress",{amount:1}),app.updateScreen()})}catch(t){throw this.$store.commit("increaseProgress",{amount:1}),app.updateScreen(),t}}}},hoverItem:function(t){this.$emit("hoverItem",t)},mouseleaveItem:function(t){this.$emit("mouseleaveItem",t)},openCharacterDLMenu:function(t,e){let i=this;i.$store.dispatch("selectChara",{id:e}).then(function(){i.is_show_chara_dl_menu=!0,i.$nextTick(function(){i.$refs.chara_dl_menu.setPosition({my:"left top",of:t})})})},closeCharacterDLMenu:function(){this.is_show_chara_dl_menu=!1},copyCharaCode:function(){let t=this.chara.renderer._stringify(!1);copyToClipboard(t)},_save_as_png:function(){this.chara.renderer._save_as_png(R.engine,this.chara.id)}},mounted:function(){let t=document.getElementById("bgm");this.$refs.bgm_outer.appendChild(t)},components:{"ui-draggable":n.a,"ui-dialog":o.a,"ui-sortable":l,"ui-trigger":c,"ui-menu":u,"ui-character":C,"ui-character-svg":V,"ui-character-attribute":k,"ui-equip-box":w,"ui-mob-list":D,"ui-map-editor":G}},F=(i(450),Object(a.a)(E,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"dialog-group Editor",on:{contextmenu:function(t){if(t.target!==t.currentTarget)return null;t.preventDefault()}}},[i("ui-dialog",{attrs:{position:t.wnds.menu.pos,width:"302px"}},[i("template",{slot:"header"},[t._v("\n\t\t\tMenu\n\t\t")]),t._v(" "),[i("details",{attrs:{open:""}},[i("summary",[t._v("bgm")]),t._v(" "),i("div",{ref:"bgm_outer"})]),t._v(" "),i("details",{attrs:{open:""}},[i("summary",[t._v("window")]),t._v(" "),i("p"),t._l(t.wnds,function(e,s){return e.name.startsWith("$")?t._e():i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:e.visable,expression:"wnd.visable"}],attrs:{type:"checkbox",checked:""},domProps:{checked:Array.isArray(e.visable)?t._i(e.visable,null)>-1:e.visable},on:{click:function(e){t.$refs[s]&&t.$refs[s].requireOrder(e)},change:function(i){var s=e.visable,n=i.target,o=!!n.checked;if(Array.isArray(s)){var r=t._i(s,null);n.checked?r<0&&t.$set(e,"visable",s.concat([null])):r>-1&&t.$set(e,"visable",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(e,"visable",o)}}}),t._v(" "+t._s(e.name)+"\n\t\t\t\t\t\t")])])}),t._v(" "),i("p")],2)],t._v(" "),[i("details",[i("summary",[t._v("scene")]),t._v(" "),i("p"),i("div",[i("label",[t._v("\n\t\t\t\t\t\t\tMap "),i("input",{on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.gv.scene_map.load(e.target.value.padStart(9,"0"))}}})])]),t._v(" "),i("div",[i("fieldset",[i("legend",[t._v("map")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_is_rendering_map,expression:"gv.m_is_rendering_map"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_is_rendering_map)?t._i(t.gv.m_is_rendering_map,null)>-1:t.gv.m_is_rendering_map},on:{change:function(e){var i=t.gv.m_is_rendering_map,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_is_rendering_map",i.concat([null])):o>-1&&t.$set(t.gv,"m_is_rendering_map",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_is_rendering_map",n)}}}),t._v("Map")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_back,expression:"gv.m_display_back"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_back)?t._i(t.gv.m_display_back,null)>-1:t.gv.m_display_back},on:{change:function(e){var i=t.gv.m_display_back,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_back",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_back",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_back",n)}}}),t._v("back")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_front,expression:"gv.m_display_front"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_front)?t._i(t.gv.m_display_front,null)>-1:t.gv.m_display_front},on:{change:function(e){var i=t.gv.m_display_front,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_front",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_front",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_front",n)}}}),t._v("front")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_mapobj,expression:"gv.m_display_mapobj"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_mapobj)?t._i(t.gv.m_display_mapobj,null)>-1:t.gv.m_display_mapobj},on:{change:function(e){var i=t.gv.m_display_mapobj,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_mapobj",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_mapobj",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_mapobj",n)}}}),t._v("object")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_maptile,expression:"gv.m_display_maptile"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_maptile)?t._i(t.gv.m_display_maptile,null)>-1:t.gv.m_display_maptile},on:{change:function(e){var i=t.gv.m_display_maptile,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_maptile",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_maptile",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_maptile",n)}}}),t._v("tile")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_portal,expression:"gv.m_display_portal"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_portal)?t._i(t.gv.m_display_portal,null)>-1:t.gv.m_display_portal},on:{change:function(e){var i=t.gv.m_display_portal,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_portal",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_portal",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_portal",n)}}}),t._v("portal")])]),t._v(" "),i("fieldset",[i("legend",[t._v("map")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_particle_system,expression:"gv.m_display_particle_system"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_particle_system)?t._i(t.gv.m_display_particle_system,null)>-1:t.gv.m_display_particle_system},on:{change:function(e){var i=t.gv.m_display_particle_system,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_particle_system",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_particle_system",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_particle_system",n)}}}),t._v("particle system")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_skeletal_anim,expression:"gv.m_display_skeletal_anim"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_skeletal_anim)?t._i(t.gv.m_display_skeletal_anim,null)>-1:t.gv.m_display_skeletal_anim},on:{change:function(e){var i=t.gv.m_display_skeletal_anim,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_skeletal_anim",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_skeletal_anim",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_skeletal_anim",n)}}}),t._v("skeletal animation")])]),t._v(" "),i("fieldset",[i("legend",[t._v("life")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_life,expression:"gv.m_display_life"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_life)?t._i(t.gv.m_display_life,null)>-1:t.gv.m_display_life},on:{change:function(e){var i=t.gv.m_display_life,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_life",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_life",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_life",n)}}}),t._v("life")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_player,expression:"gv.m_display_player"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_player)?t._i(t.gv.m_display_player,null)>-1:t.gv.m_display_player},on:{change:function(e){var i=t.gv.m_display_player,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_player",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_player",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_player",n)}}}),t._v("player")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_other_player,expression:"gv.m_display_other_player"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_other_player)?t._i(t.gv.m_display_other_player,null)>-1:t.gv.m_display_other_player},on:{change:function(e){var i=t.gv.m_display_other_player,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_other_player",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_other_player",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_other_player",n)}}}),t._v("other player")])]),t._v(" "),i("fieldset",[i("legend",[t._v("character")]),t._v(" "),i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_name_label,expression:"gv.m_display_name_label"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_name_label)?t._i(t.gv.m_display_name_label,null)>-1:t.gv.m_display_name_label},on:{change:function(e){var i=t.gv.m_display_name_label,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_name_label",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_name_label",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_name_label",n)}}}),t._v("顯示名牌")])]),t._v(" "),i("div",[i("label",[t._v("名牌"),i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.NameLabel_default_style,expression:"gv.NameLabel_default_style"}],attrs:{type:"number",min:"0"},domProps:{value:t.gv.NameLabel_default_style},on:{input:function(e){e.target.composing||t.$set(t.gv,"NameLabel_default_style",e.target.value)}}})])]),t._v(" "),i("div",[i("label",[t._v("聊天"),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.gv.ChatBalloon_default_style,expression:"gv.ChatBalloon_default_style",modifiers:{number:!0}}],attrs:{type:"number",min:"0"},domProps:{value:t.gv.ChatBalloon_default_style},on:{input:function(e){e.target.composing||t.$set(t.gv,"ChatBalloon_default_style",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),i("div",[i("label",[t._v("聊天顯示時間"),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.gv.ChatBalloon_display_duration,expression:"gv.ChatBalloon_display_duration",modifiers:{number:!0}}],attrs:{type:"number",min:"0"},domProps:{value:t.gv.ChatBalloon_display_duration},on:{input:function(e){e.target.composing||t.$set(t.gv,"ChatBalloon_display_duration",t._n(e.target.value))},blur:function(e){t.$forceUpdate()}}}),t._v("毫秒")])])])]),t._v(" "),i("p")]),t._v(" "),i("details",[i("summary",[t._v("editor")]),t._v(" "),i("p",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_foothold,expression:"gv.m_display_foothold"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_foothold)?t._i(t.gv.m_display_foothold,null)>-1:t.gv.m_display_foothold},on:{change:function(e){var i=t.gv.m_display_foothold,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_foothold",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_foothold",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_foothold",n)}}}),t._v(" foothold")]),t._v(" "),i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_selected_object,expression:"gv.m_display_selected_object"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_selected_object)?t._i(t.gv.m_display_selected_object,null)>-1:t.gv.m_display_selected_object},on:{change:function(e){var i=t.gv.m_display_selected_object,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_selected_object",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_selected_object",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_selected_object",n)}}}),t._v(" selected object")])])]),t._v(" "),i("details",[i("summary",[t._v("debug")]),t._v(" "),i("p"),i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_debug_info,expression:"gv.m_display_debug_info"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_debug_info)?t._i(t.gv.m_display_debug_info,null)>-1:t.gv.m_display_debug_info},on:{change:function(e){var i=t.gv.m_display_debug_info,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_debug_info",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_debug_info",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_debug_info",n)}}}),t._v(" debug info")])]),t._v(" "),i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_display_physics_debug,expression:"gv.m_display_physics_debug"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_display_physics_debug)?t._i(t.gv.m_display_physics_debug,null)>-1:t.gv.m_display_physics_debug},on:{change:function(e){var i=t.gv.m_display_physics_debug,s=e.target,n=!!s.checked;if(Array.isArray(i)){var o=t._i(i,null);s.checked?o<0&&t.$set(t.gv,"m_display_physics_debug",i.concat([null])):o>-1&&t.$set(t.gv,"m_display_physics_debug",i.slice(0,o).concat(i.slice(o+1)))}else t.$set(t.gv,"m_display_physics_debug",n)}}}),t._v(" physics debug")])]),t._v(" "),t._l(t.gv.m_debugDraw.flagNames,function(e){return i("div",[i("label",[i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.gv.m_debugDraw[e],expression:"gv.m_debugDraw[flagName]",modifiers:{number:!0}}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.gv.m_debugDraw[e])?t._i(t.gv.m_debugDraw[e],null)>-1:t.gv.m_debugDraw[e]},on:{change:function(i){var s=t.gv.m_debugDraw[e],n=i.target,o=!!n.checked;if(Array.isArray(s)){var r=t._n(null),a=t._i(s,r);n.checked?a<0&&t.$set(t.gv.m_debugDraw,e,s.concat([r])):a>-1&&t.$set(t.gv.m_debugDraw,e,s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.gv.m_debugDraw,e,o)}}}),t._v(" "+t._s(e.slice(5)))])])}),t._v(" "),i("div",[i("label",[t._v("axis length "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.gv.m_debugDraw.axis_length,expression:"gv.m_debugDraw.axis_length"}],attrs:{type:"number",step:"0.1"},domProps:{value:t.gv.m_debugDraw.axis_length},on:{input:function(e){e.target.composing||t.$set(t.gv.m_debugDraw,"axis_length",e.target.value)}}})])]),t._v(" "),i("p")],2)]],2),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ui-dialog",{directives:[{name:"show",rawName:"v-show",value:t.wnds.character_list.visable,expression:"wnds.character_list.visable"}],ref:"character_list",attrs:{position:t.wnds.character_list.pos,width:"16.1em",height:"50vh"}},[i("template",{slot:"header"},[t._v("\n\t\t\t\tCharacters\n\t\t\t\t"),t.progressMaximum?[t._v("\n\t\t\t\t\t[loading: "+t._s(t.progressValue)+" / "+t._s(t.progressMaximum)+"]\n\t\t\t\t")]:t._e()],2),t._v(" "),i("template",{slot:"content"},[i("div",{style:{filter:"blur("+(t.progressMaximum?3:0)+"px)"}},[i("div",[i("span",[t._v(t._s(t.charaList.length)+" characters")]),t._v(" "),i("div",{staticClass:"chara-ls-btn-group"},[i("button",{staticClass:"chara-ls-btn",attrs:{title:"Add new"},on:{click:t.addNewChara}},[i("img",{attrs:{src:"images/toolstrip_character.png",alt:"Add new"}})]),t._v(" "),i("button",{staticClass:"chara-ls-btn",attrs:{title:"Add clone"},on:{click:t.addCloneChara}},[i("img",{attrs:{src:"images/toolstrip_duplicate.png",alt:"Add clone"}})]),t._v(" "),i("button",{staticClass:"chara-ls-btn",attrs:{title:"Load"},on:{click:t.loadCharacters}},[i("span",{staticClass:"ui-icon ui-icon-folder-open",attrs:{alt:"📂"}})]),t._v(" "),i("button",{staticClass:"chara-ls-btn",attrs:{title:"Save all"},on:{click:t.saveCharacters}},[i("img",{attrs:{src:"images/toolstrip_save_all.png",alt:"Save all"}})])])]),t._v(" "),i("ui-sortable",{staticClass:"ui-character-list",attrs:{items:t.charaList},on:{input:t.oninput_sort},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.item,n=e.index;return[i("li",{key:s.id,class:[t.selected==s.id?"active":"",s.id].join(" "),attrs:{id:s.id,title:s.id},on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.selectChara(s.id):null}}},[i("table",{staticStyle:{width:"100%"}},[i("tr",{on:{contextmenu:function(e){e.preventDefault(),t.openCharacterDLMenu(e,s.id)}}},[i("td",[t._v(t._s(n))]),t._v(" "),i("td",[t._v(t._s(s.id))]),t._v(" "),i("td",{staticStyle:{position:"relative"}},[i("ui-character",{attrs:{chara:s.renderer}})],1)])])])]}}])})],1),t._v(" "),t.progressMaximum?i("div",{staticClass:"loading"},[i("div",[i("progress",{attrs:{max:t.progressMaximum},domProps:{value:t.progressValue}}),t._v(" "),i("div",[t._v("loading ["+t._s(t.progressValue)+" / "+t._s(t.progressMaximum)+"]")])])]):t._e()])],2)],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ui-dialog",{directives:[{name:"show",rawName:"v-show",value:t.wnds.character_attribute.visable,expression:"wnds.character_attribute.visable"}],ref:"character_list",attrs:{position:t.wnds.character_attribute.pos,width:"20em",height:"50vh"}},[i("template",{slot:"header"},[t._v("\n\t\t\t\tCharacter attribute\n\t\t\t")]),t._v(" "),i("template",{slot:"content"},[null!=t.chara?i("div",[i("ui-character-attribute",{attrs:{sceneChara:t.chara}})],1):t._e()])],2)],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ui-dialog",{directives:[{name:"show",rawName:"v-show",value:t.wnds.spawnpoint.visable,expression:"wnds.spawnpoint.visable"}],ref:"spawnpoint",attrs:{position:t.wnds.spawnpoint.pos,height:"50vh"},on:{"update:position":function(e){t.$set(t.wnds.spawnpoint,"pos",e)}}},[i("template",{slot:"header"},[t._v("\n\t\t\t\tSpawn point\n\t\t\t")]),t._v(" "),i("template",{slot:"content"},[i("ui-mob-list",{on:{resize:function(e){t.$refs.spawnpoint.reset_content_style()}}})],1)],2)],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ui-equip-box",{directives:[{name:"show",rawName:"v-show",value:t.wnds.equip_box.visable,expression:"wnds.equip_box.visable"}],ref:"equip_box",attrs:{position:t.wnds.equip_box.pos,width:"20em",height:400},on:{clickItem:t.clickItem,hoverItem:t.hoverItem,mouseleaveItem:t.mouseleaveItem,faceColor:t.faceColor,hairColor:t.hairColor,hairColor2:t.hairColor2,hairMix2:t.hairMix2}})],1),t._v(" "),i("transition",{attrs:{name:"fade"}},[t.mapEditorMode.startsWith("layered")?[i("ui-dialog",{directives:[{name:"show",rawName:"v-show",value:t.wnds.debug_window.visable,expression:"wnds.debug_window.visable"}],attrs:{position:t.wnds.debug_window.pos,width:"40vw",height:"70vh"}},[i("template",{slot:"header"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.mapEditorMode,expression:"mapEditorMode"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.mapEditorMode=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"background"}},[t._v("background")]),t._v(" "),i("option",{attrs:{value:"frontground"}},[t._v("frontground")]),t._v(" "),i("option",{attrs:{value:"layeredObject"}},[t._v("layered object")]),t._v(" "),i("option",{attrs:{value:"layeredTile"}},[t._v("layered tile")])]),t._v("\n\t\t\t\t\tmode "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.displayMode,expression:"displayMode"}],staticStyle:{width:"1.8em"},attrs:{type:"number",min:"0",max:"2"},domProps:{value:t.displayMode},on:{input:function(e){e.target.composing||(t.displayMode=e.target.value)}}}),t._v(" "),i("button",{on:{click:function(e){t.dirty++}}},[t._v(t._s(t.dirty))])]),t._v(" "),i("template",{slot:"content"},[t.scene_map()&&t.scene_map()[t.mapEditorMode].length?i("div",{style:t.wnd_debug_style},[i("div",{staticStyle:{background:"white"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.wnd_debug_style.background,expression:"wnd_debug_style.background"}],attrs:{type:"color",title:"window background color"},domProps:{value:t.wnd_debug_style.background},on:{input:function(e){e.target.composing||t.$set(t.wnd_debug_style,"background",e.target.value)}}}),t._v(" "),i("label",[t._v("layer "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.selectedLayer,expression:"selectedLayer"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.selectedLayer=e.target.multiple?i:i[0]}}},t._l(t.scene_map()[t.mapEditorMode].length,function(e){return i("option",[t._v(t._s(e-1))])}))]),t._v(" "),i("span",[t._v(t._s(t.scene_map()[t.mapEditorMode][t.selectedLayer].length)+" objs")])]),t._v(" "),i("hr"),t._v(" "),i("ui-map-editor",{attrs:{objs:t.scene_map()[t.mapEditorMode][t.selectedLayer],displayMode:t.displayMode}})],1):t._e()])],2)]:[i("ui-dialog",{directives:[{name:"show",rawName:"v-show",value:t.wnds.debug_window.visable,expression:"wnds.debug_window.visable"}],attrs:{position:t.wnds.debug_window.pos,width:"40vw",height:"70vh"}},[i("template",{slot:"header"},[i("select",{directives:[{name:"model",rawName:"v-model",value:t.mapEditorMode,expression:"mapEditorMode"}],on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.mapEditorMode=e.target.multiple?i:i[0]}}},[i("option",{attrs:{value:"background"}},[t._v("background")]),t._v(" "),i("option",{attrs:{value:"frontground"}},[t._v("frontground")]),t._v(" "),i("option",{attrs:{value:"layeredObject"}},[t._v("layered object")]),t._v(" "),i("option",{attrs:{value:"layeredTile"}},[t._v("layered tile")])]),t._v("\n\t\t\t\t\ttex info "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.displayMode,expression:"displayMode"}],staticStyle:{width:"1.8em"},attrs:{type:"number",min:"0",max:"2"},domProps:{value:t.displayMode},on:{input:function(e){e.target.composing||(t.displayMode=e.target.value)}}}),t._v(" "),i("button",{on:{click:function(e){t.dirty--}}},[t._v(t._s(t.dirty))])]),t._v(" "),i("template",{slot:"content"},[t.scene_map()&&t.scene_map()[t.mapEditorMode].length?i("div",{style:t.wnd_debug_style},[i("div",{staticStyle:{background:"white"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.wnd_debug_style.background,expression:"wnd_debug_style.background"}],attrs:{type:"color"},domProps:{value:t.wnd_debug_style.background},on:{input:function(e){e.target.composing||t.$set(t.wnd_debug_style,"background",e.target.value)}}})]),t._v(" "),i("hr"),t._v(" "),i("ui-map-editor",{attrs:{objs:t.scene_map()[t.mapEditorMode],displayMode:t.displayMode}})],1):t._e()])],2)]],2),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("ui-menu",{ref:"chara_dl_menu",staticStyle:{position:"absolute",width:"8em","z-index":"99999"},attrs:{show:t.is_show_chara_dl_menu},on:{close:t.closeCharacterDLMenu}},[t.chara?[i("a",{on:{click:t._save_as_png}},[t._v("Save as PNG")]),t._v(" "),i("a",{on:{click:function(e){t.chara.renderer._save_as_svg()}}},[t._v("Save as SVG")]),t._v(" "),0==t.progressMaximum||t.progressValue>=t.progressMaximum?[i("a",{attrs:{href:t.chara.renderer._outlink()}},[t._v("Outlink")])]:[i("div",{attrs:{title:"loading..."}},[t._v("Outlink")])],t._v(" "),i("a",{on:{click:t.copyCharaCode}},[t._v("Copy code")])]:[i("a",{staticClass:"disable"},[t._v("Save as SVG")]),t._v(" "),i("a",{staticClass:"disable",attrs:{href:"javascript:void(0)"}},[t._v("Outlink")]),t._v(" "),i("a",{staticClass:"disable"},[t._v("Copy code")])]],2)],1)],1)},[],!1,null,"1e192451",null));e.default=F.exports},function(t,e,i){"use strict";i.r(e);var s=i(339),n=i.n(s),o=i(337),r=new o.default.Store({state:{root:{},loadingTasks:[]},mutations:{_beforeLoad:function(t,e){e&&e.task&&t.loadingTasks.push(e.task)},_onload:function(t,e){let i=t.loadingTasks.indexOf(e.task);i>=0&&t.loadingTasks.splice(i,1);const s=e.path.split("/");if(s){let i=0,o=t.root;for(;i<s.length-1;++i){let t=s[i];o=n.a.set(o,t,o[t]||{})}let r=e.data,a=o[s[i]];if(a&&"object"==typeof a)for(let t in r)n.a.set(a,t,r[t]||a[t]);else void 0!==r&&n.a.set(o,s[i],e.data)}}},actions:{waitAllLoaded:async function(t,e){await Promise.all(t.state.loadingTasks),t.state.loadingTasks=[]},loadData:async function(t,e){let i=$get.data(e.path);t.commit("_beforeLoad",{task:i});let s=await i;return t.commit("_onload",{path:e.path,task:i,data:s}),s}}});let a={template:"<div :data-p='p' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)'><slot/></div>",store:r,props:["p"],computed:{path:function(){let t,e=this._getPathArray();for(e=[].concat(...e.map(t=>t.split("/")));(t=e.indexOf(".."))>0;)e.splice(t-1,2);return e.join("/")},_path:function(){let t,e=this._getPathArray();for(e=[].concat(...e.map(t=>t.split("/")));(t=e.indexOf(".."))>0;)e.splice(t-1,2);return e.join("/")}},methods:{_getPathArray:function(){let t=[];for(let e=this.$parent;e;e=e.$parent){const i=e.path;if(i){t.unshift(i);break}}return this.p&&"."!=this.p&&t.push(this.p),t},getGuiParent:function(){let t;for(t=this.$parent;t;t=t.$parent)if(null!=t.p||null!=t.m_data)return t},__getData:function(){const t=this.path.split("/");let e=this.$store.state.root[""],i=[];for(let s in t){const n=t[s];if(i[s]=e,n in e&&!(e=e[n]))return}return e},_getData:function(t,e){let i=t.getData();return e.split("/").reduce((e,i)=>{if(null!=e&&i){if("."==i)return t._getData(t.getGuiParent(),t.p);if(".."==i){const e=t.getGuiParent();return e._getData(e.getGuiParent(),e.p)}return e[i]}},i)},getData:function(){return this.__getData()||{}},mouseenter:function(t){this.$emit("mouseenter",t)},mouseleave:function(t){this.$emit("mouseleave",t)},mousedown:function(t){this.$emit("mousedown",t)},mouseup:function(t){this.$emit("mouseup",t)},mousemove:function(t){this.$emit("mouseup",t)},click:function(t){this.$emit("click",t)}}},l=n.a.extend({mixins:[a,{template:"<div :data-p='p' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)'><slot v-if='m_data' /></div>",data:function(){return{_$promise:null,m_data:null}},methods:{getData:function(){return this.m_data}},created:function(){this._$promise=this.$store.dispatch("loadData",{path:this.path}),this._$promise.then(t=>{this.m_data=t})}}]}),h=(n.a.extend({name:"gui-view",template:"<table class='view' ><tr><td :title='`(object)`+propName' :rowspan='entries.length+1'><div class='view-s'><button @click='collapsed=!collapsed'><span v-if='collapsed'>-</span><span v-else>+</span></button><span style='padding: 0 4px;'>{{propName}}</span></div></td><td></td></tr><tr v-if='collapsed' v-for='(d, i) in entries'><template v-if='d[0]==``'><td title='(image)'>(image)</td><td><img :src='d[1]'/></td></template><td v-else-if='typeof d[1] == `object`'><gui-view :p='encodeURI(d[0])' /></td><template v-else><td title='(property)'>{{d[0]}}</td><td :title='`(${typeof d[1]})`'>{{d[1]}}</td></template></tr></table>",data:function(){return{collapsed:!1}},methods:{},computed:{propName:function(){return decodeURI(this.p)},entries:function(){return Object.entries(this.getData())}},mixins:[a]}),{template:"<div :data-p='p' :style='style_frame'><div :style='style'><img :data-src='img_path' :src='img' :style='img_style' /><slot /></div></div>",data:function(){return{}},computed:{img_path:function(){return $get.imageUrl(this._path)},data_path:function(){return"data"+this._path},style_frame:function(){let t={zIndex:this.z};const e=-this.origin.x,i=-this.origin.y;return t.marginLeft=e+"px",t.marginTop=i+"px",t},style:function(){this.origin.x,this.origin.y;return{position:"relative"}},img_style:function(){return{display:"inline-block",width:this.width+"px",height:this.height+"px"}},texture:function(){return this.getData()},img:function(){let t=this.texture;return $get.imageUrl(t[""]?t[""]:"/warning")},width:function(){let t=this.texture;return t.__w?t.__w:0},height:function(){let t=this.texture;return t.__h?t.__h:0},origin:function(){let t=this.texture;return t.origin?t.origin:{x:0,y:0}},z:function(){let t=this.texture;return t.z?t.z:0}}}),c=n.a.extend({mixins:[a,h]}),_=n.a.extend({mixins:[a,h,{template:"<div :data-src='img_path' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)' :style='img_style'><slot /></div>",computed:{img_style:function(){const t=-this.origin.x,e=-this.origin.y;return{background:`url(${this.img}) no-repeat`,position:"absolute",left:t+"px",top:e+"px",width:this.width+"px",height:this.height+"px"}}}}]}),u=n.a.extend({mixins:[c,{template:"<div :data-src='img_path' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)' :style='{ background:`url(${img}) no-repeat` }'><slot /></div>"}]}),m=n.a.extend({mixins:[c,{template:"<div :data-src='img_path' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)' :style='{ background:`url(${img})` }'><slot /></div>"}]}),d=n.a.extend({mixins:[c,{template:"<div :style='{ background:`url(${img})` }'><input :data-src='img_path' style='border: none; outline: none; background: transparent;' /><slot /></div>"}]}),p=n.a.extend({mixins:[c,{template:"<div :data-p='p' :style='style_frame'><div :style='style'><slot :path='img_path' :img='img' :width='width' :height='height' /></div></div>"}]}),f=n.a.extend({mixins:[_,{template:"<div :data-src='img_path' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)' :style='img_style'><slot /></div>",computed:{img_style:function(){return{position:"absolute",left:-this.origin.x+"px",top:-this.origin.y+"px",width:this.width+"px",height:this.height+"px"}}}}]}),y=n.a.extend({mixins:[a,{template:"<div @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @mousemove='mousemove($event)' @click='click($event)' :data-p='p'><gui-texture :p='bp' style='display: inline-block;'></gui-texture></div>",props:{enabled:{type:Boolean,default:!0}},data:function(){return{m_state:"normal",aniFrame:0,stateMap:{normal:"normal",pressed:"pressed",disabled:"disabled",mouseOver:"mouseOver"}}},computed:{state:{get:function(){return this.m_state},set:function(t){if(this.enabled){this.stateMap[t]&&(this.m_state=t)}else this.m_state="disabled"}},bp:function(){return this.enabled?this.stateMap[this.m_state]+"/"+this.aniFrame:this.stateMap.disabled+"/"+this.aniFrame}},methods:{mouseenter:function(t){this.state="mouseOver",this.$emit("mouseenter",t)},mouseleave:function(t){this.state="normal",this.$emit("mouseleave",t)},mousedown:function(t){this.state="pressed",this.$emit("mousedown",t)},mouseup:function(t){this.state="mouseOver",this.$emit("mouseup",t)},click:function(t){this.$emit("click",t)}},watch:{disabled:function(t){}},components:{"gui-texture":c}}]});var g={store:r,components:{gui:a,"gui-root":l,"gui-texture":c,"gui-texture-s":_,"gui-background":u,"gui-extend-bg":m,"gui-frame":p,"gui-frame-s":f,"gui-button":y,"gui-button-s":n.a.extend({mixins:[y,{template:"<gui-texture-s :p='bp' @mouseenter='mouseenter($event)' @mouseleave='mouseleave($event)' @mousedown='mousedown($event)' @mouseup='mouseup($event)' @click='click($event)'></gui-texture-s>",components:{"gui-texture-s":_}}]}),"gui-input":d,center:{template:'<div class="c2 center_frame"><div class="c3 center"><slot/></div></div>'},"center-hr":{template:'<div class="c2 center_frame_hr"><div class="c3 center_hr"><slot/></div></div>'}}},v=i(352),x=Object(v.a)(g,function(){var t=this.$createElement;return(this._self._c||t)("div")},[],!1,null,null,null).exports,b=i(374);var A={props:["chara"],data:function(){return{system:{resolution:{x:1366,y:768},optionMenu:{resolution:{"1366 x 768":{x:1366,y:768},"1024 x 720":{x:1366,y:768},"800 x 600":{x:1366,y:768}}},_$window_resize:null},ui:{quickSlotFold:!0,chat:{displayInput:!0,inputText:"",size:"max",maxHistory:10,history:[],inputHistory:[]}}}},computed:{stat:{get:function(){return this.chara&&this.chara.stat?this.chara.stat:new b.CharacterStat},set:function(){this.$forceUpdate()}}},methods:{trigger_editor_mode:function(){$gv.m_editor_mode=!$gv.m_editor_mode,app.vue.editor_mode=$gv.m_editor_mode},enterChatText:async function(t){const e=this.chara;await e.say(t)&&(this.pushChatHistory(0,e.chatCtrl.style,e.id+" : "+t),this.ui.chat.inputText="")},pushChatHistory:function(t,e,i){this.ui.chat.history.push(new class{constructor(t,e,i){this.type=t,this.style=e,this.text=i}}(t,e,i)),this.ui.chat.history.length>this.ui.chat.maxHistory&&this.ui.chat.history.shift()},_window_onresize:function(t){const e=window.innerHeight;this.system.resolution.y=e,this.updatePosition()},updatePosition:function(){this.$refs.status&&$(this.$refs.status.$el).position({my:"center bottom",at:"center top+33",of:$(this.$refs.expBar.$el)}),this.$refs.menu&&$(this.$refs.menu.$el).position({my:"left bottom",at:"center+110 top+33",of:$(this.$refs.expBar.$el)})},myUpdate:function(){this.$nextTick(async()=>{this.updatePosition()})}},mounted:function(){window.$statusBar=this,this.system._$window_resize=this._window_onresize.bind(this),window.addEventListener("resize",this.system._$window_resize),this._window_onresize()},beforeDestroy:function(){window.removeEventListener("resize",this.system._$window_resize)},updated:function(){this.myUpdate()},mixins:[x]},w=(i(476),Object(v.a)(A,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{position:"absolute",left:"0",top:"0"}},[i("div",{style:{position:"relative",width:t.system.resolution.x+"px",height:t.system.resolution.y+"px","line-height":0}},[i("gui-root",{attrs:{p:"/UI/StatusBar3"}},[i("gui",{attrs:{p:"mainBar"}},[i("div",{staticStyle:{position:"absolute",bottom:"0",width:"100%"}},[i("gui",{ref:"expBar",staticStyle:{position:"absolute",bottom:"0"},attrs:{p:"EXPBar"}},[i("gui",{attrs:{p:String(t.system.resolution.x)}},[i("gui-texture",{staticStyle:{position:"relative",top:"0"},attrs:{p:"layer:back"}}),t._v(" "),i("gui-frame",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"layer:gauge"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path;return[i("img",{style:{display:"inline-block","clip-path":"polygon(0% 0%, "+t.stat.getExpPercentS()+"% 0%, "+t.stat.getExpPercentS()+"% 100%, 0% 100%)"},attrs:{"data-src":n,src:s}}),t._v(" "),i("div",{style:{position:"absolute",height:"100%",top:"0",left:t.stat.getExpPercentS()+"%"}},[i("gui-texture",{staticStyle:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},attrs:{p:"../../layer:effect"}})],1)]}}])}),t._v(" "),i("gui-texture",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"layer:cover"}})],1)],1),t._v(" "),i("gui",{ref:"status",staticStyle:{position:"relative",display:"inline-block","padding-bottom":"10px"},attrs:{p:"status"}},[i("gui-texture",{staticStyle:{position:"absolute"},attrs:{p:"backgrnd"}}),t._v(" "),i("gui-frame",{staticStyle:{position:"absolute"},attrs:{p:"gauge/hp/layer:0"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path;return[i("img",{style:{display:"inline-block","clip-path":"polygon(0% 0%, "+t.stat.getHpPercentS()+"% 0%, "+t.stat.getHpPercentS()+"% 100%, 0% 100%)"},attrs:{"data-src":n,src:s}}),t._v(" "),i("div",{staticStyle:{position:"absolute",margin:"auto",bottom:"2px"}},[i("table",{staticClass:"table"},[i("tr",[i("td",{staticStyle:{width:"50%"}},[i("div",{staticStyle:{float:"right",display:"inline-flex"}},t._l(String(t.stat.hp),function(t,e){return i("gui-texture",{key:e,staticStyle:{flex:"1"},attrs:{p:"../../number/"+t}})}))]),t._v(" "),i("td",{attrs:{width:"1"}},[i("gui-texture",{attrs:{p:"../../number/%5c"}})],1),t._v(" "),i("td",{staticStyle:{width:"50%"}},[i("div",{staticStyle:{display:"inline-flex"}},t._l(String(t.stat.mhp),function(t,e){return i("gui-texture",{key:e,staticStyle:{flex:"1"},attrs:{p:"../../number/"+t}})}))])])])])]}}])}),t._v(" "),i("gui-frame",{staticStyle:{position:"absolute"},attrs:{p:"gauge/mp/layer:0"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path;return[i("img",{style:{display:"inline-block","clip-path":"polygon(0% 0%, "+t.stat.getMpPercentS()+"% 0%, "+t.stat.getMpPercentS()+"% 100%, 0% 100%)"},attrs:{"data-src":n,src:s}}),t._v(" "),i("div",{staticStyle:{position:"absolute",margin:"auto",bottom:"2px"}},[i("table",{staticClass:"table"},[i("tr",[i("td",{staticStyle:{width:"50%"}},[i("div",{staticStyle:{float:"right",display:"inline-flex"}},t._l(String(t.stat.mp),function(t,e){return i("gui-texture",{key:e,staticStyle:{flex:"1"},attrs:{p:"../../number/"+t}})}))]),t._v(" "),i("td",{attrs:{width:"1"}},[i("gui-texture",{attrs:{p:"../../number/%5c"}})],1),t._v(" "),i("td",{staticStyle:{width:"50%"}},[i("div",{staticStyle:{display:"inline-flex"}},t._l(String(t.stat.mmp),function(t,e){return i("gui-texture",{key:e,staticStyle:{flex:"1"},attrs:{p:"../../number/"+t}})}))])])])])]}}])}),t._v(" "),i("gui-texture",{staticStyle:{position:"relative"},attrs:{p:"layer:cover"}}),t._v(" "),i("gui-texture",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"layer:Lv"}},[i("div",{staticStyle:{display:"inline-flex"}},t._l(String(t.stat.level),function(t,e){return i("gui-texture",{key:e,staticStyle:{flex:"1"},attrs:{p:"../lvNumber/"+t}})})),t._v(" "),i("div",{staticClass:"text-fff-334",staticStyle:{"z-index":"20","margin-left":"19px",display:"inline-block",transform:"translateY(-2px)"}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.chara?t.chara.id:"")+"\n\t\t\t\t\t\t\t")])])],1),t._v(" "),t.ui.quickSlotFold?i("gui",{ref:"menu",staticStyle:{position:"relative",display:"inline-block","padding-bottom":"10px"},attrs:{p:"menu"}},[i("gui-button",{staticStyle:{position:"relative"},attrs:{p:"button:Menu"},on:{click:function(e){t.trigger_editor_mode()}}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"button:Setting"},on:{click:function(e){t.trigger_editor_mode()}}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"button:Community"},on:{click:function(e){t.trigger_editor_mode()}}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"button:Character"},on:{click:function(e){t.trigger_editor_mode()}}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"button:Event"},on:{click:function(e){t.trigger_editor_mode()}}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",top:"0"},attrs:{p:"button:CashShop"},on:{click:function(e){t.trigger_editor_mode()}}})],1):t._e(),t._v(" "),i("gui",{style:{position:"absolute",bottom:0,"padding-bottom":"13px",right:t.ui.quickSlotFold?"-208px":"3px"},attrs:{p:"quickSlot"}},[i("gui-frame",{staticStyle:{position:"relative",left:"0",top:"0"},attrs:{p:"backgrnd"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path;return[i("img",{style:t.ui.quickSlotFold?{"clip-path":"polygon(0% 0%, 350px 0%, 350px 100%, 0% 100%)"}:{},attrs:{"data-src":n,src:s}})]}}])}),t._v(" "),i("gui-frame",{staticStyle:{position:"absolute",left:"0",top:"0"},attrs:{p:"layer:cover"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path;return[i("img",{style:t.ui.quickSlotFold?{"clip-path":"polygon(0% 0%, 350px 0%, 350px 100%, 0% 100%)"}:{},attrs:{"data-src":n,src:s}})]}}])}),t._v(" "),t.ui.quickSlotFold?[i("gui-button",{staticStyle:{position:"absolute",left:"0",top:"0"},attrs:{p:"button:Extend"},on:{click:function(e){t.ui.quickSlotFold=!1}}})]:[i("gui-button",{staticStyle:{position:"absolute",left:"0",top:"0"},attrs:{p:"button:Fold"},on:{click:function(e){t.ui.quickSlotFold=!0}}})]],2)],1)]),t._v(" "),i("gui",{staticStyle:{position:"absolute",left:"0",bottom:"0","padding-bottom":"13px"},attrs:{p:"chat"}},[i("div",{staticStyle:{position:"relative"}},[i("gui",{staticStyle:{position:"relative",width:"100%",height:"100%"},attrs:{p:"ingame/view/"+t.ui.chat.size}},[i("gui-frame",{attrs:{p:"top"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path,o=e.width,r=e.height;return[i("img",{style:{width:o+"px",height:r+"px"},attrs:{"data-src":n,src:s}}),t._v(" "),i("div",{style:{position:"absolute",left:0,top:0,width:o+"px",height:r+"px"}},[i("gui",{attrs:{p:"../.."}},["max"==t.ui.chat.size?[i("gui-button",{staticStyle:{position:"absolute",left:"3px",top:"3px"},attrs:{p:"drag"}}),t._v(" "),i("gui-button",{staticStyle:{position:"absolute",right:"3px",top:"3px"},attrs:{p:"btMin"},on:{click:function(e){t.ui.chat.size="min"}}})]:t._e()],2)],1)]}}])}),t._v(" "),"max"==t.ui.chat.size?i("table",{staticClass:"table",staticStyle:{width:"100%"}},[i("tr",{staticStyle:{height:"100%","line-height":"0"}},[i("td",[i("gui-extend-bg",{staticStyle:{height:"100%"},attrs:{p:"center"}},[i("table",{staticClass:"table",staticStyle:{width:"calc(100% - 16px)"}},[t._l(t.ui.chat.history,function(e){return i("tr",[i("td",[i("div",{staticClass:"chat-text"},[t._v(t._s(e.text))])])])}),t._v(" "),t._l(t.ui.chat.maxHistory-t.ui.chat.history.length,function(t){return i("tr",[i("td",[i("div",{staticClass:"chat-text"})])])})],2)])],1)])]):t._e(),t._v(" "),i("gui-frame",{attrs:{p:"bottom"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=e.path,o=e.width,r=e.height;return[i("img",{style:{width:o+"px",height:r+"px"},attrs:{"data-src":n,src:s}}),t._v(" "),i("div",{style:{position:"absolute",left:0,top:0,width:o+"px",height:r+"px"}},["max"!=t.ui.chat.size?[i("gui-button",{staticStyle:{position:"absolute",right:"3px",bottom:"8px"},attrs:{p:"../../btMax"},on:{click:function(e){t.ui.chat.size="max"}}})]:t._e()],2)]}}])}),t._v(" "),"max"!=t.ui.chat.size&&t.ui.chat.history.length>0?i("div",{staticStyle:{position:"absolute",left:"0",top:"8px"}},[i("gui-button",{staticStyle:{display:"block",position:"relative",left:"3px",top:"3px"},attrs:{p:"ingame/view/drag"}}),t._v(" "),i("div",{staticClass:"chat-text"},[t._v(t._s(t.ui.chat.history[t.ui.chat.history.length-1].text))])],1):t._e()],1)],1),t._v(" "),t.ui.chat.displayInput?i("div",{staticStyle:{position:"relative"}},[i("gui-texture",{attrs:{p:"ingame/input/layer:backgrnd"}}),t._v(" "),i("div",{staticStyle:{position:"absolute",top:"0",width:"0px","margin-left":"4px","margin-top":"5px"}},[i("gui-button",{attrs:{p:"common/chatTarget/all"}})],1),t._v(" "),i("gui-frame",{staticStyle:{position:"absolute",top:"0",display:"inline-block","font-family":"monospace"},attrs:{p:"ingame/input/layer:chatEnter"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.img,n=(e.path,e.width),o=e.height;return[i("div",{style:{width:n+"px",height:o+"px",background:"url("+s+")"},attrs:{"data-src":s}},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.ui.chat.inputText,expression:"ui.chat.inputText"}],staticStyle:{width:"100%",padding:"2px","padding-left":"5px",border:"none",outline:"none",color:"white",background:"transparent"},attrs:{type:"text"},domProps:{value:t.ui.chat.inputText},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.enterChatText(t.ui.chat.inputText.slice(0,70))},input:function(e){e.target.composing||t.$set(t.ui.chat,"inputText",e.target.value)}}})])]}}])})],1):t._e()])],1)],1)])},[],!1,null,"06654c7d",null).exports),S=i(353),C=i(377),B=i(397),V={components:{"ui-draggable":C.a,"ui-dialog":B.a},mixins:[B.a]},M=(i(478),Object(v.a)(V,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ui-draggable",{staticClass:"ui-dialog",attrs:{zIndex:t.zIndex,position:t.position},on:{"update:position":t.updateDialogPosition}},[i("div",{ref:"header",staticClass:"header",style:t.content_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._t("header"),t._v(" "),t._t("content"),t._v(" "),t._t("default")],2),t._v(" "),i("div",{ref:"footer",staticClass:"footer",on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._t("footer")],2)])},[],!1,null,"66062b27",null).exports);let k={Equip:{1:"cap",2:"accessoryFace",3:"accessoryEyes",4:"accessoryEars",5:"coat",5:"longcoat",6:"pants",7:"shoes",8:"glove",9:"cape",10:"shield",11:"weapon"},Cash:{}};Object.keys(k.Equip).forEach(t=>{k.Cash[t+100]=k.Equip[t]}),window.$WND_EQUIP_SLOT_MAP=k;var I={name:"equip-slot",props:{chara:{required:!0}},data:function(){return{guiData:null,sType:"Equip",wndStyle:{width:0,height:0},typeList:[]}},methods:{alert:function(t){},getCharaEquipIconPos:function(t){if(this.chara&&this.chara.renderer){let e=this.chara.renderer.slots[t];if(e&&e._raw&&e._raw.info&&e._raw.info.icon&&e._raw.info.icon.origin){const t=this.slot_imgWidth,i=this.slot_imgHeight;e._raw.info.icon.origin;let s=e._raw.info.icon;return{x:(t-s.__w)/2,y:(i-s.__h)/2}}}return{x:0,y:0}},getCharaEquipIconUrl:function(t){if(this.chara&&this.chara.renderer){let e=this.chara.renderer.slots[t];if(e)return e.getIconUrl()}return""}},computed:{slotMap:{get:function(){return k},set:function(t){k=t}}},mounted:async function(){if(this.guiData=await this.$refs.gui_root._$promise,this.typeList.length=0,this.guiData)for(let t in this.guiData)switch(t){case"Zero_Cash":case"Angel_Cash":case"totem":break;case"backgrnd":case"backgrnd2":case"tabbar":case"Tab":break;default:this.typeList.push(t)}this.slot_imgWidth=this.guiData.Equip.Slots[1].__w,this.slot_imgHeight=this.guiData.Equip.Slots[1].__h,this.wndStyle.width=this.guiData.backgrnd.__w+"px",this.wndStyle.height=this.guiData.backgrnd.__h+"px"},components:{"window-base":M},mixins:[x]},P=Object(v.a)(I,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("window-base",[i("template",{slot:"content"},[i("div",{style:t.wndStyle},[i("gui-root",{ref:"gui_root",attrs:{p:"/UI/UIWindow4/Equip"}},[i("gui-texture-s",{attrs:{p:"backgrnd"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"backgrnd2"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"tabbar"}}),t._v(" "),i("gui-frame-s",{staticClass:"header",attrs:{p:"backgrnd"}}),t._v(" "),i("gui-frame-s",{attrs:{p:"backgrnd2"}}),t._v(" "),t.guiData?[t._l(t.guiData.Tab.disabled,function(e,s){return[t.typeList[s]!=t.sType?[i("gui-texture-s",{staticClass:"ui-clickable",attrs:{p:"Tab/disabled/"+s},on:{click:function(e){t.sType=t.typeList[s]}}})]:t._e()]}),t._v(" "),t.typeList.indexOf(t.sType)>=0?[i("gui-texture-s",{attrs:{p:"Tab/enabled/"+t.typeList.indexOf(t.sType)}})]:t._e(),t._v(" "),t.sType?[i("gui-texture-s",{attrs:{p:t.sType+"/backgrnd"}}),t._v(" "),t._l(t.guiData[t.sType].Slots,function(e,s){return[i("div",{attrs:{title:s},on:{click:function(e){t.alert(s)}}},[i("gui-texture-s",{attrs:{p:t.sType+"/Slots/"+s}}),t._v(" "),t.slotMap[t.sType]?i("img",{style:{position:"absolute",left:t.getCharaEquipIconPos(t.slotMap[t.sType][s]).x-e.origin.x+"px",top:t.getCharaEquipIconPos(t.slotMap[t.sType][s]).y-e.origin.y+"px"},attrs:{src:t.getCharaEquipIconUrl(t.slotMap[t.sType][s])}}):t._e()],1)]})]:t._e()]:t._e(),t._v(" "),i("select",{directives:[{name:"model",rawName:"v-model",value:t.sType,expression:"sType"}],staticStyle:{position:"absolute",left:"1em",bottom:"1.5em"},on:{change:function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.sType=e.target.multiple?i:i[0]}}},t._l(t.typeList,function(e){return i("option",{domProps:{value:e}},[t._v("\n\t\t\t\t\t\t"+t._s(e)+"\n\t\t\t\t\t")])}))],2)],1)])],2)},[],!1,null,null,null).exports,D=i(373);var T={props:{itemSlot:{required:!0},slots:{required:!0}},methods:{drag:function(t,e){t.dataTransfer.setData("text/x-item",JSON.stringify(e))},allowDrop:function(t,e){[...t.dataTransfer.types].includes("text/x-item")&&t.preventDefault()},drop:function(t,e){t.preventDefault();let i=D.b.parse(t.dataTransfer.getData("text/x-item")),s=this.slots[i.slot],n=s.slot;{let t=this.slots[e];t&&(t.slot=n),s.slot=e,this.$set(this.slots,s.slot,s),t?this.$set(this.slots,t.slot,t):this.slots[n]=null}},onPickItem:function(t,e){this.onMouseleaveItem(t,e.data._raw.info),this.$emit("pickItem",{event:t,itemSlot:e})},onUseItem:function(t,e){this.onMouseleaveItem(t,e.data._raw.info),this.$emit("useItem",{event:t,itemSlot:e})},onHoverItem:function(t,e){t.buttons?this.onMouseleaveItem(t,e):this.$emit("hoverItem",{event:t,equip:e})},onMouseleaveItem:function(t,e){this.$emit("mouseleaveItem",{event:t,equip:e})},getSlotStyle:function(t){return{position:"absolute",left:36*Math.trunc(t%4)+"px",top:36*Math.trunc(t/4)+"px",width:"32px",height:"32px"}},getItemIconUrl:function(t){let e=t.data;return S.c.getIconUrl(e.id)},getItemIconStyle:function(t){let e=t.data._raw.info.icon;return{position:"absolute",left:(32-e.__w)/2+"px",top:(32-e.__h)/2+"px"}}}},G=(i(480),Object(v.a)(T,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:t.getSlotStyle(t.itemSlot.slot),attrs:{draggable:"true"},on:{dragstart:function(e){t.drag(e,t.itemSlot)},dragover:function(e){t.allowDrop(e,t.itemSlot.slot)},drop:function(e){t.drop(e,t.itemSlot.slot)},mousedown:[function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.onPickItem(e,t.itemSlot):null},function(e){return"button"in e||!t._k(e.keyCode,"right",39,e.key,["Right","ArrowRight"])?"button"in e&&2!==e.button?null:void t.$emit("showMenu",e,t.itemSlot):null}],dblclick:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.onUseItem(e,t.itemSlot):null},mousemove:function(e){t.onHoverItem(e,t.itemSlot.data._raw.info)},mouseleave:function(e){t.onMouseleaveItem(e,t.itemSlot.data._raw.info)},contextmenu:function(t){t.preventDefault()}}},[i("img",{style:t.getItemIconStyle(t.itemSlot),attrs:{src:t.getItemIconUrl(t.itemSlot)}}),t._v(" "),i("span",{staticClass:"wnd-item-sn"},[t._v(t._s(t.itemSlot.SN))])])},[],!1,null,null,null).exports);let L=n.a.extend({mixins:[x.components["gui-button-s"],{props:["sp"],data:function(){return{m_state:"normal",stateMap:{normal:"0",mouseOver:"1",pressed:"2"}}},computed:{bp:function(){return this.enabled?this.sp+this.stateMap[this.m_state]:this.sp}}}]});var R={props:{target:{},step:{type:Number,default:1},enabled:{type:Boolean,default:!0}},data:function(){return{thumbStyle:{position:"absolute",left:0,top:"0"},_mouse_y:0,_onscroll_target:null,_track_mouse_listener:null}},computed:{maxHeight:function(){return this.$refs.track.$el.offsetHeight},thumbY:{get:function(){return parseFloat(this.thumbStyle.top)},set:function(t){t=Math.max(t,0),t=Math.min(t,this.maxHeight-26),this.thumbStyle.top=t+"px",this.$emit("scroll",t)}}},methods:{_getMousePosY:function(t){return t.target.classList.contains("track")?t.offsetY:-this.target.getBoundingClientRect().top+t.clientY-13},_calcThumbY:function(t){let e=t-13;if(this.step){const t=this.target;let i=t.offsetHeight,s=this.maxHeight,n=Math.trunc(t.scrollHeight/s)*s,o=e/i*n;e=(o=Math.trunc(o/this.step)*this.step)/n*i}this.thumbY=e,this._scrollTo(e)},moveStep:function(t){if(this.step){let e=t*this.step;this._scroll(e),this._onscroll()}},_onmousemove:function(t){if(1==t.buttons){let e=this._getMousePosY(t);this._calcThumbY(e),this._set_tracking_mousemove()}},_set_tracking_mousemove:function(){this._track_mouse_listener||(this._track_mouse_listener=(t=>{1==t.buttons?this._onmousemove(t):(window.removeEventListener("mousemove",this._track_mouse_listener),this._track_mouse_listener=null)}),window.addEventListener("mousemove",this._track_mouse_listener))},_onmousewheel:function(t){let e;this.step?(t.preventDefault(),e=Math.sign(t.deltaY)*this.step):e=t.deltaY,this._scroll(e),this._onscroll()},_scroll:function(t){const e=this.target;let i=e.scrollTop+t;e.scrollTo(0,i)},_scrollTo:function(t){const e=this.target;let i=e.offsetHeight,s=this.maxHeight,n=Math.trunc(e.scrollHeight/s)*s;e.scrollTo(0,t/i*n)},_onscroll:function(t){const e=this.target;let i=e.offsetHeight,s=this.maxHeight,n=Math.trunc(e.scrollHeight/s)*s,o=e.scrollTop/n*i;this.thumbY=o},_bindScrollEvent:function(){const t=this.target;t&&(this._onscroll_target&&t.removeEventListener("scroll",this._onscroll_target),this.step?(this._onscroll_target=this._onmousewheel.bind(this),t.addEventListener("mousewheel",this._onscroll_target)):(this._onscroll_target=this._onscroll.bind(this),t.addEventListener("scroll",this._onscroll_target)))}},mounted:function(){this._bindScrollEvent()},beforeDestroy:function(){this.target.removeEventListener("scroll",this._onscroll_target),this._track_mouse_listener&&window.removeEventListener("mousemove",this._track_mouse_listener)},watch:{target:function(t){this._bindScrollEvent()}},mixins:[x],components:{"vscr-button":L}},E=(i(482),i(484)),F=i.n(E),q=Object(v.a)(R,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("gui-root",{attrs:{p:"/UI/Basic/VScr9"}},[i("gui",{attrs:{p:t.enabled?"enabled":"disabled"}},[i("div",{staticClass:"vscr-scrollbar",on:{mousewheel:t._onmousewheel}},[i("vscr-button",{staticClass:"vscr-decrement",attrs:{enabled:t.enabled,sp:"prev"},on:{click:function(e){t.moveStep(-1)}}}),t._v(" "),i("vscr-button",{staticClass:"vscr-increment",attrs:{enabled:t.enabled,sp:"next"},on:{click:function(e){t.moveStep(1)}}}),t._v(" "),i("gui-extend-bg",{ref:"track",staticClass:"vscr-track",attrs:{p:"base"},on:{mousedown:t._onmousemove,mousemove:t._onmousemove}},[i("div",{style:t.thumbStyle},[i("vscr-button",{staticClass:"vscr-thumb",attrs:{enabled:t.enabled,p:"../../enabled",sp:"thumb"}})],1)])],1)])],1)},[],!1,null,"0eba351b",null);"function"==typeof F.a&&F()(q);var j=q.exports;var N={name:"item-slot",props:{chara:{required:!0}},data:function(){return{guiData:null,isCollapsed:!0,sType:0,typeList:[0,1,2,3,4],typeNameList:["裝備","消耗","其他","裝飾","特殊"],wndStyle:{width:0,height:0},pageStyle:{position:"absolute",left:"10px",top:"50px",width:"153px",height:"212px"},slotsPanelStyle:{width:"140px",height:"1148px"},scrollStep:36,is_show_menu:!1,menu_style:{position:"fixed",left:"0px",top:"0px"},current_slotItem:null}},computed:{slots:function(){return this.chara.items[this.sType]}},methods:{showMenu:function(t,e){this.current_slotItem=e,this.menu_style.left=t.clientX+"px",this.menu_style.top=t.clientY-18+"px",this.is_show_menu=!0;let i=this.closeMenu.bind(this);window.addEventListener("click",i,{once:!0,passive:!0,capture:!0})},closeMenu:function(t){this.is_show_menu=!1},removeItem:function(){this.chara.removeItem(this.sType,this.current_slotItem.slot)},allowDrop:function(t,e){return G.methods.allowDrop.call(this,t,e)},drop:function(t,e){return G.methods.drop.call(this,t,e)},getSlotStyle:function(t){return G.methods.getSlotStyle.call(this,t)},onPickItem:function(){return this.$emit("pickItem",...arguments)},onUseItem:function(t){let e=t.event,i=t.itemSlot;const s=i.data.id;if(170!=S.c.isCashWeapon(s))return this.chara.useItem(s),this.$emit("useItem",{event:e,itemSlot:i});{let t=i.data._raw.info;console.groupCollapsed("沒有設定職業，無法使用點裝武器"),console.log("click cash weapon: [%s] %s %o",t.id,t.name,t),console.groupEnd()}},onHoverItem:function(){return this.$emit("hoverItem",...arguments)},onMouseleaveItem:function(){return this.$emit("mouseleaveItem",...arguments)}},mounted:async function(){this.guiData=await this.$refs.gui_root._$promise,this.isCollapsed?(this.wndStyle.width=this.guiData.backgrnd.__w+"px",this.wndStyle.height=this.guiData.backgrnd.__h+"px"):(this.wndStyle.width=this.guiData.FullBackgrnd.__w+"px",this.wndStyle.height=this.guiData.FullBackgrnd.__h+"px")},components:{"window-base":M,"ui-slot-item":G,"ui-v-scrollbar":j},mixins:[x]},O=(i(485),Object(v.a)(N,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("window-base",[i("template",{slot:"content"},[i("div",{style:t.wndStyle},[i("gui-root",{ref:"gui_root",attrs:{p:"/UI/UIWindow2/Item"}},[[t.isCollapsed?i("div",[i("gui-texture-s",{attrs:{p:"backgrnd"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"backgrnd2"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"backgrnd3"}}),t._v(" "),i("gui-frame-s",{staticClass:"header",attrs:{p:"backgrnd"}}),t._v(" "),i("gui-frame-s",{attrs:{p:"backgrnd2"}})],1):i("div",[i("gui-texture-s",{attrs:{p:"FullBackgrnd"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"FullBackgrnd2"}}),t._v(" "),i("gui-texture-s",{attrs:{p:"FullBackgrnd3"}}),t._v(" "),i("gui-frame-s",{staticClass:"header",attrs:{p:"FullBackgrnd"}}),t._v(" "),i("gui-frame-s",{attrs:{p:"FullBackgrnd2"}})],1)],t._v(" "),t.guiData?[t.typeList.indexOf(t.sType)>=0?[i("gui-texture-s",{attrs:{p:"Tab/enabled/"+t.typeList.indexOf(t.sType)}})]:t._e(),t._v(" "),t._l(t.guiData.Tab.disabled,function(e,s){return[t.typeList[s]!=t.sType?[i("gui-texture-s",{staticClass:"ui-clickable",attrs:{p:"Tab/disabled/"+s},on:{click:function(e){t.sType=t.typeList[s]}}})]:t._e()]})]:t._e()],2),t._v(" "),i("div",{staticClass:"slots-viewport",style:t.pageStyle},[i("div",{ref:"slots_panel",staticClass:"slots-container"},[i("div",[t._l(128,function(e){return[i("div",{style:t.getSlotStyle(e-1),on:{dragover:function(i){t.allowDrop(i,e-1)},drop:function(i){t.drop(i,e-1)}}},[i("span",{staticClass:"wnd-item-slot-num"},[t._v(t._s(e-1))])])]})],2),t._v(" "),t.chara&&t.chara.items?i("div",{style:t.slotsPanelStyle},[t._l(t.chara.items[t.sType].filter(function(t){return!!t}),function(e){return[e.data?[i("ui-slot-item",{attrs:{itemSlot:e,slots:t.slots},on:{pickItem:t.onPickItem,useItem:t.onUseItem,hoverItem:t.onHoverItem,mouseleaveItem:t.onMouseleaveItem,showMenu:t.showMenu}})]:t._e()]})],2):t._e()]),t._v(" "),i("ui-v-scrollbar",{attrs:{target:t.$refs.slots_panel,step:t.scrollStep}})],1)],1)]),t._v(" "),t.is_show_menu?i("template",{slot:"footer"},[i("gui-root",{attrs:{p:"/UI/CashShop/CSLockerNew/Normal"}},[i("div",{staticClass:"slot-menu",style:t.menu_style,on:{mouseout:function(e){if(e.target!==e.currentTarget)return null;t.closeMenu(e)},contextmenu:function(t){t.preventDefault()}}},[i("gui-texture",{attrs:{p:"backgrnd"}}),t._v(" "),i("gui-button-s",{staticClass:"Bt BtRebate",attrs:{p:"BtRebate",enabled:!1}}),t._v(" "),i("gui-button-s",{staticClass:"Bt BtDelete",attrs:{p:"BtDelete"},on:{click:t.removeItem}})],1)])],1):t._e()],2)},[],!1,null,"05ec9993",null).exports);class z{static baseJob(t){return Number((t%500).toString()[0])}}const U={template:'<img v-data="src"></img>',props:{origin:{type:String,default:"",required:!1},flip:{type:String,default:"",required:!1},scale:{type:Array,default:null,required:!1},src:{type:String,default:"",required:!1}},directives:{data:function(t,e,i){const s=e.value,n=i.context;t.src=s,n.scale&&function(e){t.onload=function(t){let i=t.target.naturalWidth*e[0],s=t.target.naturalHeight*e[1];t.target.style.width=`${i}px`,t.target.style.height=`${s}px`}}(n.scale),(s.startsWith("/")||s.startsWith("http"))&&function(t,e){if(e.src.indexOf("maplestory.io")>=0)return;let i=e.src.replace("images/","/data/");$get(i).then(function(s){try{let n=JSON.parse(s);e.style.transform="","-"==t.origin&&(e.style.transform=" scale(-1, -1)"),e.style.transform+=` translate3d(${n.origin.x}px, ${n.origin.y}px, ${0|n.z})`,"-"==t.origin&&(e.style.transform+=" scale(-1, -1)")}catch(t){console.warn("path to JSON ?: "+i),console.warn("JSON ?: "+s),console.warn(t)}})}(n,t)}}};class J{constructor(){this.components={texture:U},this.props=["attrName","equip","stat"],this.methods={getReqState:this.getReqState,digitCharArray:this.digitCharArray,getReqAttrName:this.getReqAttrName},this.render=function(t){let e=this.getReqState(),i=this.digitCharArray(),s=this.getReqAttrName();return t("div",{class:{c3:!0,"UIToolTip ":!0,"equip-req":!0}},[t("texture",{attrs:{src:`images/UI/UIToolTip/Item/Equip/${J.prototype.getReqState.call(this)}/req${s}`}}),t("div",{class:{UIToolTip:!0,"req-digit":!0}},[t("texture",{attrs:{src:`images/UI/UIToolTip/Item/Equip/${e}/${i[0]}`}}),t("texture",{attrs:{src:`images/UI/UIToolTip/Item/Equip/${e}/${i[1]}`}}),t("texture",{attrs:{src:`images/UI/UIToolTip/Item/Equip/${e}/${i[2]}`}})])])}}getReqAttrName(){return this.attrName.toUpperCase()}getReqState(){const t=this.equip[`req${this.attrName}`],e=this.stat[this.attrName.toLowerCase()];return 0!=t&&null!=t&&null!=e?e>=t?"Can":"Cannot":"Disabled"}digitCharArray(){const t=0|this.equip[`req${this.attrName}`];return Number(t).toFixed(0).padStart(3,"0")}data(){return{imgUrl:"images/UI/UIToolTip/Item/Equip/"}}}var W={props:{equip:{required:!1},chara:{required:!1},state:{required:!1},isShow:{default:!0},isShowDebug:{default:!0}},computed:{stat:{get:function(){return this.chara&&this.chara.stat?this.chara.stat:new b.CharacterStat},set:function(){this.$forceUpdate()}}},methods:{_update_frame:function(){let t=$(this.$el).children(".frame"),e=t.children(".content").height();t.innerHeight(e)},canUseEquip:function(){return class{constructor(t,e){}static isUnlimited(t){return 0==t}static isBeginner(t){return-1==t}static isWarrior(t){return 1==t}static isMagician(t){return 2==t}static isBowman(t){return 4==t}static isThief(t){return 8==t}static isPirate(t){return 16==t}static canUseEquip(t,e){let i=1<<z.baseJob(t)-1;return e>0?i&&e:0==e||null==e||(-1==e?(consolw.error("Not implement beginner job"),!0):void 0)}}.canUseEquip(this.stat._job,this.equip.reqJob)},adjAttr:function(t){return t>0?"+"+t:t.toString()},getEquipCategoryName:function(){return S.c.get(this.equip.id).categoryName},hasPotential:()=>!1,shouldShowAttr(t){return null!=this.equip[t]&&this.equip[t]>0},isEquip(){return S.c.isEquip(this.equip.id)},getIconUrl(){return $get.imageUrl(this.equip.icon[""])},onload_icon(t){const e=t.target;e.style.width=2*e.naturalWidth+"px",e.style.height=2*e.naturalHeight+"px"}},updated:function(){this._update_frame()},mounted:function(){$(this.$el).draggable(),this._update_frame()},watch:{"state.display":function(t){if(t)$(this.$el).stop().show();else $(this.$el).hide()},"state.position":function(t){this.state.display&&t&&$(this.$el).position(t)}},components:{texture:U,"equip-req":new J,"equip-req-level":new class extends J{constructor(){super()}getReqAttrName(){return"LEV"}getReqState(){const t=this.equip[`req${this.attrName}`],e=this.stat[this.attrName.toLowerCase()];return 0!=t&&null!=t&&null!=e?e>=t?"YellowNumber":"Cannot":"Disabled"}}}},H=(i(487),Object(v.a)(W,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"UIToolTip"},[null!=t.chara&&null!=t.stat&&null!=t.equip?[t.isShow?i("div",{staticClass:"UIToolTip frame",staticStyle:{"/*height":"658px"}},[t._m(0),t._v(" "),t._m(1),t._v(" "),i("div",{staticClass:"UIToolTip content"},[i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"13px"}}),t._v(" "),t.equip.max_start<=15?i("div",[i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"10px"}}),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"8px"}})]):t._e(),t._v(" "),t.equip.max_start>15?i("div",[i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"10px"}}),t._v(" "),i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"7px"}})]):t._e(),t._v(" "),i("div",{staticClass:"c3 UIToolTip title",staticStyle:{"z-index":"2",position:"relative",width:"100%",height:"22px","text-align":"center","text-shadow":"1px 1px 0 black, 0 0 1px white"}},[i("span",{style:t.equip.$foreign?"color: red":""},[t._v(t._s(t.equip.name))])]),t._v(" "),i("div",[i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"2px","font-size":"12px","text-align":"center"}}),t._v(" "),t.hasPotential()?i("div",[i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"16px","text-align":"center"}},[t._v("(稀有道具)")])]):t._e(),t._v(" "),t.equip["無法交換"]?i("div",[i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"16px","font-size":"12px","text-align":"center"}},[t._v("無法交換")])]):t._e()]),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"8px"}}),t._v(" "),i("div",{staticClass:"c2 UIToolTip dotline",staticStyle:{position:"relative",width:"100%",height:"2px"}}),t._v(" "),i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"6px"}}),t._v(" "),i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"85px"}},[i("div",{staticStyle:{float:"left",position:"relative",width:"12px",height:"100%"}}),t._v(" "),i("div",{staticStyle:{float:"left",position:"relative",width:"83px",height:"100%"}},[i("texture",{staticStyle:{position:"absolute",top:"2px"},attrs:{src:"images/UI/UIToolTip/Item/ItemIcon/base"}}),t._v(" "),t.hasPotential()?i("div",[i("texture",{staticStyle:{position:"absolute",left:"2px",top:"4px"},attrs:{src:"images/UI/UIToolTip/Item/ItemIcon/"+t.equip.potential_level}})],1):t._e(),t._v(" "),"icon"in t.equip?i("img",{staticClass:"UIToolTip equip-icon",attrs:{src:t.getIconUrl()},on:{load:function(e){t.onload_icon(e)}}}):t._e(),t._v(" "),i("texture",{staticStyle:{position:"absolute",left:"8px",top:"10px"},attrs:{src:"images/UI/UIToolTip/Item/ItemIcon/cover"}})],1),t._v(" "),i("div",{staticStyle:{float:"left",position:"relative",top:"1px",width:"160px",height:"100%"}},[i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"155px",height:"50px"}},[i("div",{staticStyle:{position:"relative",float:"right"}},[t._v("攻擊力增加量")]),t._v(" "),i("div",{staticClass:"UIToolTip attack-digit",staticStyle:{clear:"right"}},[i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Summary/incline/0"}})],1)]),t._v(" "),i("div",{staticClass:"UIToolTip attrLeft",staticStyle:{float:"left",width:"50%"}},[i("equip-req-level",{attrs:{"attr-name":"Level",equip:t.equip,stat:t.stat}}),t._v(" "),i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"9px","margin-left":"2px"}}),t._v(" "),i("equip-req",{attrs:{"attr-name":"STR",equip:t.equip,stat:t.stat}}),t._v(" "),i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"3px","margin-left":"2px"}}),t._v(" "),i("equip-req",{attrs:{"attr-name":"DEX",equip:t.equip,stat:t.stat}})],1),t._v(" "),i("div",{staticClass:"UIToolTip attrRight",staticStyle:{float:"left",width:"50%"}},[i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"15px","margin-left":"2px"}}),t._v(" "),i("equip-req",{attrs:{"attr-name":"LUK",equip:t.equip,stat:t.stat}}),t._v(" "),i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"3px","margin-left":"2px"}}),t._v(" "),i("equip-req",{attrs:{"attr-name":"INT",equip:t.equip,stat:t.stat}})],1)])]),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"20px"}}),t._v(" "),i("div",{staticClass:"c1 UIToolTip req-job",staticStyle:{position:"relative",width:"100%",height:"30px"}},[i("div",{staticStyle:{position:"relative",left:"13px"}},[i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/normal"}}),t._v(" "),t.equip.reqJob<0?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/0",origin:"-"}}):0==t.equip.reqJob||null==t.equip.reqJob?i("div",[i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/0",origin:"-"}}),t._v(" "),i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/1",origin:"-"}}),t._v(" "),i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/2",origin:"-"}}),t._v(" "),i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/3",origin:"-"}}),t._v(" "),i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/4",origin:"-"}}),t._v(" "),i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/enable/5",origin:"-"}})],1):i("div",[1&t.equip.reqJob?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/"+(t.canUseEquip()?"enable":"disable")+"/1",origin:"-"}}):t._e(),t._v(" "),2&t.equip.reqJob?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/"+(t.canUseEquip()?"enable":"disable")+"/2",origin:"-"}}):t._e(),t._v(" "),4&t.equip.reqJob?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/"+(t.canUseEquip()?"enable":"disable")+"/3",origin:"-"}}):t._e(),t._v(" "),8&t.equip.reqJob?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/"+(t.canUseEquip()?"enable":"disable")+"/4",origin:"-"}}):t._e(),t._v(" "),16&t.equip.reqJob?i("texture",{attrs:{src:"images/UI/UIToolTip/Item/Equip/Job/"+(t.canUseEquip()?"enable":"disable")+"/5",origin:"-"}}):t._e()],1)],1),t._v(" "),"reqSpecJob"in t.equip?i("div"):t._e()]),t._v(" "),i("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"4px"}}),t._v(" "),i("div",{staticClass:"c1 UIToolTip dotline",staticStyle:{position:"relative",width:"100%",height:"2px"}}),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"5px"}}),t._v(" "),i("div",{staticClass:"UIToolTip attribute"},[t.isEquip()?i("div",[i("div",{staticClass:"c1"},[i("span",[t._v("裝備分類 : "+t._s(t.getEquipCategoryName()))])])]):t._e(),t._v(" "),t.shouldShowAttr("incSTR")?i("div",{staticClass:"c2"},[i("span",[t._v("力量 :\t  \t   "+t._s(t.adjAttr(t.equip.incSTR)))])]):t._e(),t._v(" "),t.shouldShowAttr("incSTRr")?i("div",{staticClass:"c3"},[i("span",[t._v("力量 :\t\t   "+t._s(t.adjAttr(t.equip.incSTRr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incDEX")?i("div",{staticClass:"c3"},[i("span",[t._v("敏捷 :\t\t   "+t._s(t.adjAttr(t.equip.incDEX)))])]):t._e(),t._v(" "),t.shouldShowAttr("incDEXr")?i("div",{staticClass:"c3"},[i("span",[t._v("敏捷 :\t\t   "+t._s(t.adjAttr(t.equip.incDEXr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incINT")?i("div",{staticClass:"c3"},[i("span",[t._v("智力 :\t\t   "+t._s(t.adjAttr(t.equip.incINT)))])]):t._e(),t._v(" "),t.shouldShowAttr("incINTr")?i("div",{staticClass:"c3"},[i("span",[t._v("智力 :\t\t   "+t._s(t.adjAttr(t.equip.incINTr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incLUK")?i("div",{staticClass:"c3"},[i("span",[t._v("幸運 :\t\t   "+t._s(t.adjAttr(t.equip.incLUK)))])]):t._e(),t._v(" "),t.shouldShowAttr("incLUKr")?i("div",{staticClass:"c3"},[i("span",[t._v("幸運 :\t\t   "+t._s(t.adjAttr(t.equip.incLUKr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incAllStat")?i("div",{staticClass:"c3"},[i("span",[t._v("所有属性 :\t   "+t._s(t.adjAttr(t.equip.incAllStat)))])]):t._e(),t._v(" "),t.shouldShowAttr("incMHP")?i("div",{staticClass:"c3"},[i("span",[t._v("MaxHP :\t  \t   "+t._s(t.adjAttr(t.equip.incMHP)))])]):t._e(),t._v(" "),t.shouldShowAttr("incMHPr")?i("div",{staticClass:"c3"},[i("span",[t._v("MaxHP :\t\t   "+t._s(t.adjAttr(t.equip.incMHPr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incMMP")?i("div",{staticClass:"c3"},[i("span",[t._v("MaxMP :\t  \t   "+t._s(t.adjAttr(t.equip.incMMP)))])]):t._e(),t._v(" "),t.shouldShowAttr("incMMPr")?i("div",{staticClass:"c3"},[i("span",[t._v("MaxMP :\t\t   "+t._s(t.adjAttr(t.equip.incMMPr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incMDF")?i("div",{staticClass:"c3"},[i("span",[t._v("MaxDF :\t\t   "+t._s(t.adjAttr(t.equip.incMDF)))])]):t._e(),t._v(" "),t.shouldShowAttr("incPAD")?i("div",{staticClass:"c3"},[i("span",[t._v("攻擊力 :\t\t   "+t._s(t.adjAttr(t.equip.incPAD)))])]):t._e(),t._v(" "),t.shouldShowAttr("incPADr")?i("div",{staticClass:"c3"},[i("span",[t._v("攻擊力 :\t\t   "+t._s(t.adjAttr(t.equip.incPADr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incMAD")?i("div",{staticClass:"c3"},[i("span",[t._v("魔法力 :\t\t   "+t._s(t.adjAttr(t.equip.incMAD)))])]):t._e(),t._v(" "),t.shouldShowAttr("incMADr")?i("div",{staticClass:"c3"},[i("span",[t._v("魔法力 :\t\t   "+t._s(t.adjAttr(t.equip.incMADr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incPDD")?i("div",{staticClass:"c3"},[i("span",[t._v("物理防禦力 :     "+t._s(t.adjAttr(t.equip.incPDD)))])]):t._e(),t._v(" "),t.shouldShowAttr("incPDDr")?i("div",{staticClass:"c3"},[i("span",[t._v("物理防禦力 :     "+t._s(t.adjAttr(t.equip.incPDDr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incMDD")?i("div",{staticClass:"c3"},[i("span",[t._v("魔法防禦力 :     "+t._s(t.adjAttr(t.equip.incMDD)))])]):t._e(),t._v(" "),t.shouldShowAttr("incMDDr")?i("div",{staticClass:"c3"},[i("span",[t._v("魔法防禦力 :     "+t._s(t.adjAttr(t.equip.incMDDr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incACC")?i("div",{staticClass:"c3"},[i("span",[t._v("命中值 :\t\t   "+t._s(t.adjAttr(t.equip.incACC)))])]):t._e(),t._v(" "),t.shouldShowAttr("incACCr")?i("div",{staticClass:"c3"},[i("span",[t._v("命中值 :\t\t   "+t._s(t.adjAttr(t.equip.incACCr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incEVA")?i("div",{staticClass:"c3"},[i("span",[t._v("回避值 :\t\t   "+t._s(t.adjAttr(t.equip.incEVA)))])]):t._e(),t._v(" "),t.shouldShowAttr("incEVAr")?i("div",{staticClass:"c3"},[i("span",[t._v("回避值 :\t\t   "+t._s(t.adjAttr(t.equip.incEVAr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incSpeed")?i("div",{staticClass:"c3"},[i("span",[t._v("移动速度 :\t\t   "+t._s(t.adjAttr(t.equip.incSpeed)))])]):t._e(),t._v(" "),t.shouldShowAttr("incJump")?i("div",{staticClass:"c3"},[i("span",[t._v("跳跃力 :\t\t   "+t._s(t.adjAttr(t.equip.incJump)))])]):t._e(),t._v(" "),t.shouldShowAttr("incCraft")?i("div",{staticClass:"c3"},[i("span",[t._v("手技 :\t\t   "+t._s(t.adjAttr(t.equip.incCraft)))])]):t._e(),t._v(" "),t.shouldShowAttr("damR")?i("div",{staticClass:"c3"},[i("span",[t._v("总伤害 :  \t\t   "+t._s(t.adjAttr(t.equip.damR)))])]):t._e(),t._v(" "),t.shouldShowAttr("incDAMr")?i("div",{staticClass:"c3"},[i("span",[t._v("总伤害 :\t  \t   "+t._s(t.adjAttr(t.equip.incDAMr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incCr")?i("div",{staticClass:"c3"},[i("span",[t._v("爆击率 :\t\t   "+t._s(t.adjAttr(t.equip.incCr))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incPVPDamage")?i("div",{staticClass:"c3"},[i("span",[t._v("大乱斗时追加攻击力"+t._s(t.adjAttr(t.equip.incPVPDamage))+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incPQEXPr")?i("div",{staticClass:"c3"},[i("span",[t._v("组队任务经验值增加"+t._s(t.equip.incPQEXPr)+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incBDR")?i("div",{staticClass:"c3"},[i("span",[t._v("攻击BOSS怪物时，伤害+"+t._s(t.equip.incBDR)+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("bdR")?i("div",{staticClass:"c3"},[i("span",[t._v("攻击BOSS怪物时，伤害+"+t._s(t.equip.bdR)+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("incIMDR")?i("div",{staticClass:"c3"},[i("span",[t._v("無視怪物防禦力"+t._s(t.equip.incIMDR)+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("imdR")?i("div",{staticClass:"c3"},[i("span",[t._v("無視怪物防禦力"+t._s(t.equip.imdR)+"%")])]):t._e(),t._v(" "),t.shouldShowAttr("limitBreak")?i("div",{staticClass:"c3"},[i("span",[t._v("伤害上限突破至"+t._s(t.equip.limitBreak)+"。")])]):t._e(),t._v(" "),t.shouldShowAttr("reduceReq")?i("div",{staticClass:"c3"},[i("span",[t._v("装备等级降低 : -"+t._s(t.equip.reduceReq)+"。")])]):t._e(),t._v(" "),t.shouldShowAttr("knockback")?i("div",{staticClass:"c3"},[i("span",[t._v("直接攻击时"+t._s(t.equip.knockback)+"的比率发生后退现象。")])]):t._e(),t._v(" "),t.shouldShowAttr("tuc")?i("div",{staticClass:"c1"},[i("span",[t._v("可使用捲軸次數 : "+t._s(t.equip.tuc))])]):t._e()]),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"9px"}}),t._v(" "),t.hasPotential()?i("div",[i("div",{staticClass:"c2 UIToolTip dotline",staticStyle:{position:"relative",width:"100%",height:"2px"}}),t._v(" "),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"22px"}}),t._v(" "),t._m(2)]):t._e(),t._v(" "),t.equip.desc?i("div",[i("div",{staticClass:"c2 UIToolTip dotline",staticStyle:{position:"relative",width:"100%",height:"2px"}}),t._v(" "),i("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"5px"}}),t._v(" "),i("div",{staticStyle:{"padding-left":"12px"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.equip.desc)+"\n\t\t\t\t\t\t"),i("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"13px"}})])]):t._e(),t._v(" "),t._e()])]):t._e(),t._v(" "),t.isShowDebug?i("div",{staticClass:"debug-info"},[i("div",{attrs:{contenteditable:"true",spellcheck:"false"}},[i("span",[t._v("id   : ")]),t._v(t._s(t.equip.id))]),t._v(" "),t.equip._name?i("div",{attrs:{contenteditable:"true",spellcheck:"false"}},[i("span",[t._v("nameEn: ")]),t._v(t._s(t.equip._name))]):i("div",{attrs:{contenteditable:"true",spellcheck:"false"}},[i("span",[t._v("name : ")]),t._v(t._s(t.equip.name))]),t._v(" "),i("div",[t._v("Added in: "+t._s(t.equip.__v))]),t._v(" "),i("div",{attrs:{contenteditable:"true",spellcheck:"false"}},[i("span",[t._v("islot: ")]),t._v(t._s(t.equip.islot))]),t._v(" "),i("div",{attrs:{contenteditable:"true",spellcheck:"false"}},[i("span",[t._v("vslot: ")]),t._v(t._s(t.equip.vslot))])]):t._e()]:t._e()],2)},[function(){var t=this.$createElement,e=this._self._c||t;return e("table",{staticStyle:{position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%"}},[e("thead",[e("tr",[e("td",{staticClass:"UIToolTip border-head",attrs:{colspan:"3"}})])]),this._v(" "),e("tbody",{staticStyle:{height:"auto"}},[e("tr",[e("td",{staticClass:"UIToolTip border-left"}),this._v(" "),e("td",{staticClass:"UIToolTip container"}),this._v(" "),e("td",{staticClass:"UIToolTip border-right"})])]),this._v(" "),e("tfoot",[e("tr",[e("td",{staticClass:"UIToolTip border-foot",attrs:{colspan:"3"}})])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"custom-fixed"},[e("div",{staticClass:"UIToolTip Item-Frame-cover"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"UIToolTip attribute",staticStyle:{height:"48px","font-size":"11px"}},[e("div",{staticClass:"c1",staticStyle:{position:"relative",width:"100%",height:"33%"}},[this._v("DEX : +6%")]),this._v(" "),e("div",{staticClass:"c2",staticStyle:{position:"relative",width:"100%",height:"33%"}},[this._v("STR : +3%")]),this._v(" "),e("div",{staticClass:"c3",staticStyle:{position:"relative",width:"100%",height:"33%"}},[this._v("DEX : +12")])])}],!1,null,null,null).exports),X={mixins:[B.a,x],data:function(){return{html:[],is_show:!1,guiData:null}},methods:{_getImgStyle:function(t,e,i,s){let n,o,r=this.guiData,a={};return r&&(o=r[t])&&(n=o[""])?(e&&(a.width=o.__w+"px"),i&&(a.height=o.__h+"px"),a.background=`url(${n}) ${s?"repeat":"no-repeat"}`,a):a},show:function(t){this.is_show=!0,t&&this.$nextTick(function(){t()})},hide:function(t){this.is_show=!1,t&&this.$nextTick(function(){t()})},$position:function(...t){let e;t.length>1&&(e=t.pop()),$(this.$el).position(...t),e&&this.$nextTick(function(){e()})},setPosition:function(...t){let e;t.length>1&&(e=t.pop()),$(this.$el).position(...t),e&&this.$nextTick(function(){e()})}},mounted:async function(){this.hide(),this.guiData=await this.$refs.gui_root._$promise},components:{"ui-draggable":C.a}},Z=(i(489),i(491)),Y=i.n(Z),Q=Object(v.a)(X,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ui-draggable",{attrs:{zIndex:t.zIndex,position:t.position}},[i("gui-root",{ref:"gui_root",attrs:{p:"/UI/UIToolTip/Item/Frame2"}},[t.is_show?i("div",{staticClass:"header frame",on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t.guiData?i("div",{staticClass:"frame-warp"},[i("table",{staticClass:"frame-inner"},[i("tr",[i("td",{style:t._getImgStyle("nw",!0,!0,!1)}),t._v(" "),i("td",{style:t._getImgStyle("n",!1,!0,!0)}),t._v(" "),i("td",{style:t._getImgStyle("ne",!0,!0,!1)})]),t._v(" "),i("tr",[i("td",{style:t._getImgStyle("w",!0,!1,!0)}),t._v(" "),i("td",{style:t._getImgStyle("c",!1,!1,!0)}),t._v(" "),i("td",{style:t._getImgStyle("e",!0,!1,!0)})]),t._v(" "),i("tr",[i("td",{style:t._getImgStyle("sw",!0,!0,!1)}),t._v(" "),i("td",{style:t._getImgStyle("s",!1,!0,!0)}),t._v(" "),i("td",{style:t._getImgStyle("se",!0,!0,!1)})])])]):t._e(),t._v(" "),i("div",{ref:"content",staticClass:"header content"},[t._l([].concat(t.html).reverse(),function(e,s){return i("div",{class:"z"+(t.html.length-s),domProps:{innerHTML:t._s(e)}})}),t._v(" "),t._t("default")],2)]):t._e()])],1)},[],!1,null,"40c717aa",null);"function"==typeof Y.a&&Y()(Q);var K=Q.exports,tt=i(342);function et(t,e,i){return t.data.directives.filter(function(t){return t.name==e&&t.arg==i})}function it(t,e,i){let s=i.context;const n=Object.keys(e.modifiers);n.length?n.forEach(function(n){$(t).off(n),$(t).on(n,function(){let t=et(i,"ui","ref");if(t[0]){let i=s.$refs[t[0].value];$(i).stop()[e.arg](e.value)}})}):"ref"!=e.arg&&s.$nextTick(function(){let t=et(i,"ui","ref");if(t[0]){let i=s.$refs[t[0].value];$(i).stop()[e.arg](e.value)}})}n.a.config.productionTip=!1,n.a.use(o.default),n.a.directive("ui",{bind:it,componentUpdated:it,unbind:function(t,e,i){const s=Object.keys(e.modifiers);s.length&&s.forEach(function(e){$(t).off(e)})}}),n.a.directive("declare",{bind:function(t,e,i){let s=i.context;for(let t in e.modifiers)n.a.set(s[e.arg],t,e.value)}}),n.a.component("input-number",{template:"<input :value='value' :step='step' :min='min' :max='max' @input='update($event.target.value)' @wheel.stop.prevent='wheel' type='number' />",props:["value","step","min","max"],methods:{update:function(t){t=Math.max(this.min||-1/0,Math.min(t,this.max||1/0)),this.$emit("input",t),this.$parent.$forceUpdate()},wheel:function(t){let e=null!=this.step?this.step:1,i=Number(t.target.value);t.deltaY<0?i+=e:t.deltaY>0&&(i-=e),this.update(i)}}}),n.a.component("input-select",{template:"<select ref='input' :value='value' @input='update($event.target.value)' @wheel.stop.prevent='wheel'><slot></slot></select>",props:["value"],methods:{update:function(t){this.$emit("input",t),this.$parent.$forceUpdate()},wheel:function(t){const e=[...this.$el.children].map(t=>t.value),i=e.length;let s=e.indexOf(t.target.value);t.deltaY<0?s-=1:t.deltaY>0&&(s+=1),s=s>=0?s%i:i-1,this.update(e[s])}}});var st={store:tt.default.store,data:function(){return{$gv:window.$gv,equip:null,isShowEquipTip:!0,isShowUIEquipWnd:!1,isShowUIItemWnd:!1,m_is_always_show_tip:!1,ItemTip_state:{display:!1,position:null},onkeydown:null}},computed:{chara:{get:function(){return this.$store.state.chara},set:function(){this.$forceUpdate()}},editor_mode:{get:function(){return $gv.m_editor_mode},set:function(t){$gv.m_editor_mode=t}}},methods:{showItemTip:function(t){if(t){let{event:e,equip:i}=t;this.equip=i,this.ItemTip_state.display=!0,this.m_is_always_show_tip?this.ItemTip_state.position=null:this.ItemTip_state.position={my:"left top",at:`left+${e.clientX+1} top+${e.clientY+1}`,of:document.body,collision:"fit",using:function(t){let e=$(this).stop().animate(t,300,"easeOutExpo").offset().top;e<0&&$(this).css("top",t.top-e)}}}else this.ItemTip_state.display=!0,this.m_is_always_show_tip&&(this.ItemTip_state.position=null)},hideItemTip:function(t){this.m_is_always_show_tip||(this.ItemTip_state.display=!1)},_onkeydown:function(t){switch(t.key){case"e":this.isShowUIEquipWnd=!this.isShowUIEquipWnd;break;case"i":this.isShowUIItemWnd=!this.isShowUIItemWnd}}},watch:{editor_mode:function(t){!t&&this.$refs.statusBar&&(this.$refs.statusBar.$forceUpdate(),this.$refs.statusBar.updated&&this.$refs.statusBar.updated())}},mounted:function(){let t=this;this.onkeydown=function(e){"INPUT"!=e.target.tagName&&t._onkeydown(e)},window.addEventListener("keydown",this.onkeydown),document.getElementById("m_is_always_show_tip").addEventListener("change",function(e){e=e||event,t.m_is_always_show_tip=!!e.target.checked,t.m_is_always_show_tip?t.showItemTip():t.hideItemTip()}),t.m_is_always_show_tip?t.showItemTip():t.hideItemTip()},beforeDestroy:function(){window.removeEventListener("keydown",this.onkeydown)},components:{editor:tt.default,"ui-tool-tip":H,"frame-2":K,"status-bar":w,"ui-window-equip":P,"ui-window-item":O}},nt=(i(492),Object(v.a)(st,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{position:"absolute",width:"100%",height:"100%",top:"0px",left:"0px","user-select":"none"}},[i("transition",{staticStyle:{position:"absolute"},attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.editor_mode,expression:"editor_mode"}],staticClass:"scene-editor;"},[i("editor",{ref:"editor",on:{hoverItem:function(e){t.showItemTip.apply(void 0,arguments)},mouseleaveItem:function(e){t.hideItemTip.apply(void 0,arguments)}}})],1)]),t._v(" "),i("transition",{staticStyle:{position:"absolute"},attrs:{name:"fade"}},[i("status-bar",{directives:[{name:"show",rawName:"v-show",value:!t.editor_mode,expression:"!editor_mode"}],ref:"statusBar",attrs:{chara:t.chara}})],1),t._v(" "),i("transition",{staticStyle:{position:"absolute"},attrs:{name:"fade"}},[i("ui-window-equip",{directives:[{name:"show",rawName:"v-show",value:t.isShowUIEquipWnd,expression:"isShowUIEquipWnd"}],attrs:{chara:t.chara},on:{hoverItem:function(e){t.showItemTip.apply(void 0,arguments)},mouseleaveItem:function(e){t.hideItemTip.apply(void 0,arguments)}}})],1),t._v(" "),i("transition",{staticStyle:{position:"absolute"},attrs:{name:"fade"}},[i("ui-window-item",{directives:[{name:"show",rawName:"v-show",value:t.isShowUIItemWnd,expression:"isShowUIItemWnd"}],attrs:{chara:t.chara},on:{hoverItem:function(e){t.showItemTip.apply(void 0,arguments)},mouseleaveItem:function(e){t.hideItemTip.apply(void 0,arguments)}}})],1),t._v(" "),i("div",{staticClass:"gui",staticStyle:{"z-index":"100",position:"absolute",width:"0",height:"0"},on:{contextmenu:function(t){t.preventDefault()}}},[t.isShowEquipTip?i("ui-tool-tip",{attrs:{isShow:t.isShowEquipTip,equip:t.equip,chara:t.chara,state:t.ItemTip_state}}):t._e()],1),t._v(" "),i("frame-2",{ref:"smallTip",staticStyle:{position:"absolute"}})],1)},[],!1,null,null,null));e.default=nt.exports},,function(t,e,i){"use strict";function s(t,...e){}i.d(e,"b",function(){return s}),i.d(e,"x",function(){return n}),i.d(e,"r",function(){return o}),i.d(e,"s",function(){return r}),i.d(e,"P",function(){return a}),i.d(e,"z",function(){return l}),i.d(e,"D",function(){return h}),i.d(e,"k",function(){return c}),i.d(e,"l",function(){return _}),i.d(e,"v",function(){return u}),i.d(e,"n",function(){return m}),i.d(e,"Q",function(){return d}),i.d(e,"G",function(){return p}),i.d(e,"H",function(){return f}),i.d(e,"T",function(){return y}),i.d(e,"y",function(){return g}),i.d(e,"w",function(){return v}),i.d(e,"I",function(){return x}),i.d(e,"J",function(){return b}),i.d(e,"E",function(){return A}),i.d(e,"F",function(){return w}),i.d(e,"p",function(){return S}),i.d(e,"S",function(){return C}),i.d(e,"t",function(){return B}),i.d(e,"B",function(){return V}),i.d(e,"O",function(){return M}),i.d(e,"N",function(){return k}),i.d(e,"C",function(){return I}),i.d(e,"A",function(){return P}),i.d(e,"K",function(){return $}),i.d(e,"L",function(){return D}),i.d(e,"M",function(){return T}),i.d(e,"o",function(){return G}),i.d(e,"R",function(){return L}),i.d(e,"u",function(){return R}),i.d(e,"m",function(){return E}),i.d(e,"a",function(){return F}),i.d(e,"c",function(){return q}),i.d(e,"d",function(){return j}),i.d(e,"j",function(){return N}),i.d(e,"U",function(){return O}),i.d(e,"q",function(){return z}),i.d(e,"h",function(){return U}),i.d(e,"i",function(){return J}),i.d(e,"e",function(){return W}),i.d(e,"f",function(){return H}),i.d(e,"g",function(){return X});const n=1e37,o=1e-5,r=o*o,a=3.14159265359,l=2,h=8,c=.1,_=2,u=.008,m=2/180*a,d=2*u,p=8,f=32,y=1,g=.2,v=8/180*a,x=2,b=x*x,A=.5*a,w=A*A,S=.2,C=.75,B=-1,V=2147483647,M=.75,k=1,I=.25,P=.5,$=2,D=$*$,T=256,G=2.5,L=.5,R=.01,E=2/180*a;function F(t){return null}function q(t){}function j(t,...e){}class N{constructor(t=0,e=0,i=0){this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}toString(){return this.major+"."+this.minor+"."+this.revision}}const O=new N(2,3,2),z=313;function U(t){return parseInt(t,10)}function J(t){return Math.abs(parseInt(t,10))}function W(t,e){let i=[];for(let s=0;s<t;++s)i.push(e(s));return i}function H(t){const e=[];for(let i=0;i<t;++i)e.push(null);return e}function X(t,e=0){const i=[];for(let s=0;s<t;++s)i.push(e);return i}},function(t,e,i){"use strict";i.d(e,"E",function(){return n}),i.d(e,"D",function(){return o}),i.d(e,"F",function(){return r}),i.d(e,"a",function(){return a}),i.d(e,"n",function(){return l}),i.d(e,"m",function(){return h}),i.d(e,"e",function(){return c}),i.d(e,"x",function(){return _}),i.d(e,"j",function(){return u}),i.d(e,"v",function(){return m}),i.d(e,"h",function(){return d}),i.d(e,"w",function(){return p}),i.d(e,"p",function(){return f}),i.d(e,"g",function(){return y}),i.d(e,"q",function(){return g}),i.d(e,"f",function(){return v}),i.d(e,"u",function(){return x}),i.d(e,"b",function(){return b}),i.d(e,"c",function(){return A}),i.d(e,"d",function(){return w}),i.d(e,"o",function(){return S}),i.d(e,"i",function(){return C}),i.d(e,"r",function(){return B}),i.d(e,"s",function(){return V}),i.d(e,"A",function(){return M}),i.d(e,"B",function(){return k}),i.d(e,"C",function(){return $}),i.d(e,"k",function(){return G}),i.d(e,"l",function(){return L}),i.d(e,"t",function(){return R}),i.d(e,"z",function(){return N}),i.d(e,"y",function(){return O});var s=i(345);const n=s.P/180,o=180/s.P,r=2*s.P,a=Math.abs,l=Math.min,h=Math.max;function c(t,e,i){return t<e?e:t>i?i:t}function _(t,e){const i=t[0];t[0]=e[0],e[0]=i}function u(t){return isFinite(t)}function m(t){return t*t}function d(t){return 1/Math.sqrt(t)}const p=Math.sqrt,f=Math.pow;function y(t){return t*n}function g(t){return t*o}const v=Math.cos,x=Math.sin,b=Math.acos,A=Math.asin,w=Math.atan2;function S(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1}function C(t){return t>0&&0==(t&t-1)}function B(){return 2*Math.random()-1}function V(t,e){return(e-t)*Math.random()+t}class M{constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new M(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,e){return this.x+=t,this.y+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,e){return this.x-=t,this.y-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SelfMulSub(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}LengthSquared(){const t=this.x,e=this.y;return t*t+e*e}Normalize(){const t=this.Length();if(t>=s.r){const e=1/t;this.x*=e,this.y*=e}return t}SelfNormalize(){const t=this.Length();if(t>=s.r){const e=1/t;this.x*=e,this.y*=e}return this}SelfRotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const e=this.x;return this.x=t*this.y,this.y=-t*e,this}SelfCrossSV(t){const e=this.x;return this.x=-t*this.y,this.y=t*e,this}SelfMinV(t){return this.x=l(this.x,t.x),this.y=l(this.y,t.y),this}SelfMaxV(t){return this.x=h(this.x,t.x),this.y=h(this.y,t.y),this}SelfAbs(){return this.x=a(this.x),this.y=a(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}static MakeArray(t){return Object(s.e)(t,t=>new M)}static AbsV(t,e){return function(t,e){return e.x=a(t.x),e.y=a(t.y),e}(t,e)}static MinV(t,e,i){return function(t,e,i){return i.x=l(t.x,e.x),i.y=l(t.y,e.y),i}(t,e,i)}static MaxV(t,e,i){return function(t,e,i){return i.x=h(t.x,e.x),i.y=h(t.y,e.y),i}(t,e,i)}static ClampV(t,e,i,s){return function(t,e,i,s){return s.x=c(t.x,e.x,i.x),s.y=c(t.y,e.y,i.y),s}(t,e,i,s)}static RotateV(t,e,i){return function(t,e,i){const s=t.x,n=t.y,o=Math.cos(e),r=Math.sin(e);return i.x=o*s-r*n,i.y=r*s+o*n,i}(t,e,i)}static DotVV(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(t,e)}static CrossVV(t,e){return function(t,e){return t.x*e.y-t.y*e.x}(t,e)}static CrossVS(t,e,i){return function(t,e,i){const s=t.x;return i.x=e*t.y,i.y=-e*s,i}(t,e,i)}static CrossVOne(t,e){return function(t,e){const i=t.x;return e.x=t.y,e.y=-i,e}(t,e)}static CrossSV(t,e,i){return function(t,e,i){const s=e.x;return i.x=-t*e.y,i.y=t*s,i}(t,e,i)}static CrossOneV(t,e){return function(t,e){const i=t.x;return e.x=-t.y,e.y=i,e}(t,e)}static AddVV(t,e,i){return I(t,e,i)}static SubVV(t,e,i){return P(t,e,i)}static MulSV(t,e,i){return function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}(t,e,i)}static MulVS(t,e,i){return function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}(t,e,i)}static AddVMulSV(t,e,i,s){return function(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}(t,e,i,s)}static SubVMulSV(t,e,i,s){return function(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}(t,e,i,s)}static AddVCrossSV(t,e,i,s){return function(t,e,i,s){const n=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*n,s}(t,e,i,s)}static MidVV(t,e,i){return function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}(t,e,i)}static ExtVV(t,e,i){return function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}(t,e,i)}static IsEqualToV(t,e){return function(t,e){return t.x===e.x&&t.y===e.y}(t,e)}static DistanceVV(t,e){return function(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}(t,e)}static DistanceSquaredVV(t,e){return function(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s}(t,e)}static NegV(t,e){return function(t,e){return e.x=-t.x,e.y=-t.y,e}(t,e)}}M.ZERO=new M(0,0),M.UNITX=new M(1,0),M.UNITY=new M(0,1),M.s_t0=new M,M.s_t1=new M,M.s_t2=new M,M.s_t3=new M;const k=new M(0,0);function I(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}function P(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}class ${constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}Clone(){return new $(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}SetXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}SelfAddXYZ(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SelfSubXYZ(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}SelfMul(t){return this.x*=t,this.y*=t,this.z*=t,this}static DotV3V3(t,e){return D(t,e)}static CrossV3V3(t,e,i){return T(t,e,i)}}function D(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function T(t,e,i){const s=t.x,n=t.y,o=t.z,r=e.x,a=e.y,l=e.z;return i.x=n*l-o*a,i.y=o*r-s*l,i.z=s*a-n*r,i}$.ZERO=new $(0,0,0),$.s_t0=new $;class G{constructor(){this.ex=new M(1,0),this.ey=new M(0,1)}Clone(){return(new G).Copy(this)}static FromVV(t,e){return(new G).SetVV(t,e)}static FromSSSS(t,e,i,s){return(new G).SetSSSS(t,e,i,s)}static FromAngle(t){return(new G).SetAngle(t)}SetSSSS(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}SetVV(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){const e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;return 0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.y=-o*s,t.ey.y=o*e,t}Solve(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}SelfAbs(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}SelfInv(){return this.GetInverse(this)}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}SelfSubM(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}static AbsM(t,e){return function(t,e){const i=t.ex,s=t.ey;return e.ex.x=a(i.x),e.ex.y=a(i.y),e.ey.x=a(s.x),e.ey.y=a(s.y),e}(t,e)}static MulMV(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+n.x*r,i.y=s.y*o+n.y*r,i}(t,e,i)}static MulTMV(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+s.y*r,i.y=n.x*o+n.y*r,i}(t,e,i)}static AddMM(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.ex,r=e.ey;return i.ex.x=s.x+o.x,i.ex.y=s.y+o.y,i.ey.x=n.x+r.x,i.ey.y=n.y+r.y,i}(t,e,i)}static MulMM(t,e,i){return function(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,c=e.ey.y;return i.ex.x=s*a+o*l,i.ex.y=n*a+r*l,i.ey.x=s*h+o*c,i.ey.y=n*h+r*c,i}(t,e,i)}static MulTMM(t,e,i){return function(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,h=e.ey.x,c=e.ey.y;return i.ex.x=s*a+n*l,i.ex.y=o*a+r*l,i.ey.x=s*h+n*c,i.ey.y=o*h+r*c,i}(t,e,i)}}G.IDENTITY=new G;class L{constructor(){this.ex=new $(1,0,0),this.ey=new $(0,1,0),this.ez=new $(0,0,1)}Clone(){return(new L).Copy(this)}SetVVV(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}Solve33(t,e,i,s){const n=this.ex.x,o=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,h=this.ey.z,c=this.ez.x,_=this.ez.y,u=this.ez.z;let m=n*(l*u-h*_)+o*(h*c-a*u)+r*(a*_-l*c);return 0!==m&&(m=1/m),s.x=m*(t*(l*u-h*_)+e*(h*c-a*u)+i*(a*_-l*c)),s.y=m*(n*(e*u-i*_)+o*(i*c-t*u)+r*(t*_-e*c)),s.z=m*(n*(l*i-h*e)+o*(h*t-a*i)+r*(a*e-l*t)),s}Solve22(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}GetInverse22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*s,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=D(this.ex,T(this.ey,this.ez,$.s_t0));0!==e&&(e=1/e);const i=this.ex.x,s=this.ey.x,n=this.ez.x,o=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(o*a-r*r),t.ex.y=e*(n*r-s*a),t.ex.z=e*(s*r-n*o),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-s*s)}static MulM33V3(t,e,i){return function(t,e,i){const s=e.x,n=e.y,o=e.z;return i.x=t.ex.x*s+t.ey.x*n+t.ez.x*o,i.y=t.ex.y*s+t.ey.y*n+t.ez.y*o,i.z=t.ex.z*s+t.ey.z*n+t.ez.z*o,i}(t,e,i)}static MulM33XYZ(t,e,i,s,n){return function(t,e,i,s,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,n}(t,e,i,s,n)}static MulM33V2(t,e,i){return function(t,e,i){const s=e.x,n=e.y;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}(t,e,i)}static MulM33XY(t,e,i,s){return function(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}(t,e,i,s)}}L.IDENTITY=new L;class R{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Clone(){return(new R).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}SetAngle(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static MulRR(t,e,i){return E(t,e,i)}static MulTRR(t,e,i){return F(t,e,i)}static MulRV(t,e,i){return q(t,e,i)}static MulTRV(t,e,i){return j(t,e,i)}}function E(t,e,i){const s=t.c,n=t.s,o=e.c,r=e.s;return i.s=n*o+s*r,i.c=s*o-n*r,i}function F(t,e,i){const s=t.c,n=t.s,o=e.c,r=e.s;return i.s=s*r-n*o,i.c=s*o+n*r,i}function q(t,e,i){const s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o-n*r,i.y=n*o+s*r,i}function j(t,e,i){const s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}R.IDENTITY=new R;class N{constructor(){this.p=new M,this.q=new R}Clone(){return(new N).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.SetAngle(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}static MulXV(t,e,i){return function(t,e,i){const s=t.q.c,n=t.q.s,o=e.x,r=e.y;return i.x=s*o-n*r+t.p.x,i.y=n*o+s*r+t.p.y,i}(t,e,i)}static MulTXV(t,e,i){return function(t,e,i){const s=t.q.c,n=t.q.s,o=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}(t,e,i)}static MulXX(t,e,i){return function(t,e,i){return E(t.q,e.q,i.q),I(q(t.q,e.p,i.p),t.p,i.p),i}(t,e,i)}static MulTXX(t,e,i){return function(t,e,i){return F(t.q,e.q,i.q),j(t.q,P(e.p,t.p,i.p),i.p),i}(t,e,i)}}N.IDENTITY=new N;class O{constructor(){this.localCenter=new M,this.c0=new M,this.c=new M,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new O).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){const i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;const s=i*this.a0+e*this.a;return t.q.SetAngle(s),t.p.SelfSub(q(t.q,this.localCenter,M.s_t0)),t}Advance(t){const e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}Normalize(){const t=r*Math.floor(this.a0/r);this.a0-=t,this.a-=t}}},function(t,e,i){"use strict";i.d(e,"e",function(){return s}),i.d(e,"d",function(){return h}),i.d(e,"f",function(){return c}),i.d(e,"i",function(){return _}),i.d(e,"j",function(){return n}),i.d(e,"h",function(){return u}),i.d(e,"p",function(){return m}),i.d(e,"k",function(){return o}),i.d(e,"g",function(){return d}),i.d(e,"c",function(){return p}),i.d(e,"l",function(){return f}),i.d(e,"m",function(){return y}),i.d(e,"a",function(){return g}),i.d(e,"n",function(){return v}),i.d(e,"b",function(){return x}),i.d(e,"o",function(){return S});var s,n,o,r=i(345),a=i(346),l=i(360);!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(s||(s={}));class h{constructor(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}get key(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key}set key(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(t){this._indexA=t,this._key_invalid=!0}get indexB(){return this._indexB}set indexB(t){this._indexB=t,this._key_invalid=!0}get typeA(){return this._typeA}set typeA(t){this._typeA=t,this._key_invalid=!0}get typeB(){return this._typeB}set typeB(t){this._typeB=t,this._key_invalid=!0}}class c{constructor(){this.cf=new h}Copy(t){return this.key=t.key,this}Clone(){return(new c).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}class _{constructor(){this.localPoint=new a.A,this.normalImpulse=0,this.tangentImpulse=0,this.id=new c}static MakeArray(t){return Object(r.e)(t,t=>new _)}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(n||(n={}));class u{constructor(){this.points=_.MakeArray(r.z),this.localNormal=new a.A,this.localPoint=new a.A,this.type=n.e_unknown,this.pointCount=0}Reset(){for(let t=0;t<r.z;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=n.e_unknown,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<r.z;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new u).Copy(this)}}class m{constructor(){this.normal=new a.A,this.points=a.A.MakeArray(r.z),this.separations=Object(r.g)(r.z)}Initialize(t,e,i,s,o){if(0!==t.pointCount)switch(t.type){case n.e_circles:{this.normal.Set(1,0);const n=a.z.MulXV(e,t.localPoint,m.Initialize_s_pointA),l=a.z.MulXV(s,t.points[0].localPoint,m.Initialize_s_pointB);a.A.DistanceSquaredVV(n,l)>r.s&&a.A.SubVV(l,n,this.normal).SelfNormalize();const h=a.A.AddVMulSV(n,i,this.normal,m.Initialize_s_cA),c=a.A.SubVMulSV(l,o,this.normal,m.Initialize_s_cB);a.A.MidVV(h,c,this.points[0]),this.separations[0]=a.A.DotVV(a.A.SubVV(c,h,a.A.s_t0),this.normal)}break;case n.e_faceA:{a.t.MulRV(e.q,t.localNormal,this.normal);const n=a.z.MulXV(e,t.localPoint,m.Initialize_s_planePoint);for(let e=0;e<t.pointCount;++e){const r=a.z.MulXV(s,t.points[e].localPoint,m.Initialize_s_clipPoint),l=i-a.A.DotVV(a.A.SubVV(r,n,a.A.s_t0),this.normal),h=a.A.AddVMulSV(r,l,this.normal,m.Initialize_s_cA),c=a.A.SubVMulSV(r,o,this.normal,m.Initialize_s_cB);a.A.MidVV(h,c,this.points[e]),this.separations[e]=a.A.DotVV(a.A.SubVV(c,h,a.A.s_t0),this.normal)}}break;case n.e_faceB:{a.t.MulRV(s.q,t.localNormal,this.normal);const n=a.z.MulXV(s,t.localPoint,m.Initialize_s_planePoint);for(let s=0;s<t.pointCount;++s){const r=a.z.MulXV(e,t.points[s].localPoint,m.Initialize_s_clipPoint),l=o-a.A.DotVV(a.A.SubVV(r,n,a.A.s_t0),this.normal),h=a.A.AddVMulSV(r,l,this.normal,m.Initialize_s_cB),c=a.A.SubVMulSV(r,i,this.normal,m.Initialize_s_cA);a.A.MidVV(c,h,this.points[s]),this.separations[s]=a.A.DotVV(a.A.SubVV(c,h,a.A.s_t0),this.normal)}this.normal.SelfNeg()}}}}function d(t,e,i,s){let n;for(n=0;n<i.pointCount;++n){const e=i.points[n].id.key;t[n]=o.b2_removeState;for(let i=0,r=s.pointCount;i<r;++i)if(s.points[i].id.key===e){t[n]=o.b2_persistState;break}}for(;n<r.z;++n)t[n]=o.b2_nullState;for(n=0;n<s.pointCount;++n){const t=s.points[n].id.key;e[n]=o.b2_addState;for(let s=0,r=i.pointCount;s<r;++s)if(i.points[s].id.key===t){e[n]=o.b2_persistState;break}}for(;n<r.z;++n)e[n]=o.b2_nullState}m.Initialize_s_pointA=new a.A,m.Initialize_s_pointB=new a.A,m.Initialize_s_cA=new a.A,m.Initialize_s_cB=new a.A,m.Initialize_s_planePoint=new a.A,m.Initialize_s_clipPoint=new a.A,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(o||(o={}));class p{constructor(){this.v=new a.A,this.id=new c}static MakeArray(t){return Object(r.e)(t,t=>new p)}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}class f{constructor(){this.p1=new a.A,this.p2=new a.A,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}class y{constructor(){this.normal=new a.A,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}class g{constructor(){this.lowerBound=new a.A,this.upperBound=new a.A,this.m_cache_center=new a.A,this.m_cache_extent=new a.A}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){const t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;let i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()}GetCenter(){return a.A.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return a.A.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}Combine1(t){return this.lowerBound.x=Object(a.n)(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Object(a.n)(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Object(a.m)(this.upperBound.x,t.upperBound.x),this.upperBound.y=Object(a.m)(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Object(a.n)(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Object(a.n)(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Object(a.m)(t.upperBound.x,e.upperBound.x),this.upperBound.y=Object(a.m)(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,i){return i.Combine2(t,e),i}Contains(t){let e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let i=-r.x,s=r.x;const n=e.p1.x,o=e.p1.y,l=e.p2.x-e.p1.x,h=e.p2.y-e.p1.y,c=Object(a.a)(l),_=Object(a.a)(h),u=t.normal;if(c<r.r){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{const t=1/l;let e=(this.lowerBound.x-n)*t,o=(this.upperBound.x-n)*t,r=-1;if(e>o){const t=e;e=o,o=t,r=1}if(e>i&&(u.x=r,u.y=0,i=e),i>(s=Object(a.n)(s,o)))return!1}if(_<r.r){if(o<this.lowerBound.y||this.upperBound.y<o)return!1}else{const t=1/h;let e=(this.lowerBound.y-o)*t,n=(this.upperBound.y-o)*t,r=-1;if(e>n){const t=e;e=n,n=t,r=1}if(e>i&&(u.x=0,u.y=r,i=e),i>(s=Object(a.n)(s,n)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}TestOverlap(t){const e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(s>0||n>0)}}function v(t,e){const i=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.x-e.upperBound.x,o=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0)&&!(n>0||o>0)}function x(t,e,i,n,o){let r=0;const l=e[0],h=e[1],c=a.A.DotVV(i,l.v)-n,_=a.A.DotVV(i,h.v)-n;if(c<=0&&t[r++].Copy(l),_<=0&&t[r++].Copy(h),c*_<0){const e=c/(c-_),i=t[r].v;i.x=l.v.x+e*(h.v.x-l.v.x),i.y=l.v.y+e*(h.v.y-l.v.y);const n=t[r].id;n.cf.indexA=o,n.cf.indexB=l.id.cf.indexB,n.cf.typeA=s.e_vertex,n.cf.typeB=s.e_face,++r}return r}const b=new l.b,A=new l.f,w=new l.c;function S(t,e,i,s,n,o){const a=b.Reset();a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,s),a.transformA.Copy(n),a.transformB.Copy(o),a.useRadii=!0;const h=A.Reset();h.count=0;const c=w.Reset();return Object(l.a)(c,h,a),c.distance<10*r.r}},function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"c",function(){return s}),i.d(e,"b",function(){return r});var s,n=i(346);class o{constructor(){this.mass=0,this.center=new n.A(0,0),this.I=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(s||(s={}));class r{constructor(t,e){this.m_type=s.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}},function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return r});var s=i(333),n=(i(332),i(335));class o extends n.Graph{constructor(t,e){t?(super(e,{width:t.__w,height:t.__h}),this._raw=t,e?this._url=e:!1!==o.isTexture(t)&&(this._url=t[""])):super()}static isTexture(t){if(t)if(t.hasOwnProperty("")){if("string"==typeof t[""])return!0}else if(!t.__isEmpty)throw console.group("no texture"),console.warn(t),console.groupEnd(),new Error("no texture");return!1}static isTextureHasData(t){return t&&"string"==typeof t[""]&&t[""].startsWith("data:image/")}set z(t){this._order=t}get z(){return this._order}_get(t,e,i){if(this._raw){if(e in this._raw)return i(this._raw[e])}else;return t}draw(){this._engine.drawGraph(this)}draw2(t,e){this._engine.drawGraph2(this,t-this.x,e-this.y)}draw2i(t,e){this._engine.drawGraph2(this,Math.trunc(t-this.x+.5),Math.trunc(e-this.y+.5))}}class r extends o{constructor(t,e){super(t,e);var i=this._get(new s.Vec2(0,0),"origin",s.Vec2.get);this.x=i.x,this.y=i.y,this.z=this._get(0,"z",Number),this.delay=this._get(100,"delay",Number)}drawPattern(t,e,i,s){if(!this.isLoaded())return;const n=this._engine.ctx;n.save();try{n.rect(t,e,i,s),n.clip();let o=t,r=t+i,a=e+s;for(let t=e;t<a;t+=this.height)for(let e=o;e<r;e+=this.width)this.draw2(e,t)}catch(t){console.error(t)}n.restore()}drawHorizontalPattern(t,e,i){if(!this.isLoaded())return;const s=this._engine.ctx;s.save();try{const s=t+i;for(let i=t;i<s;i+=this.width)this.draw2(i,e)}catch(t){console.error(t)}s.restore()}drawVerticalPattern(t,e,i){if(!this.isLoaded())return;const s=this._engine.ctx;s.save();try{const s=e+i;for(let i=e;i<s;i+=this.height)this.draw2(t,i)}catch(t){console.error(t)}s.restore()}_drawPattern(t,e,i,s){if(!this.isLoaded())return;const n=Math.trunc(i/this.width)*this.width,o=Math.trunc(s/this.height)*this.height,r=t,a=e,l=t+n,h=e+s;let c,_;if(s>=this.height){for(c=a;c<h;c+=this.height)if(i>=this.width){for(_=r;_<l;_+=this.width)this.draw2(_,c);let t=i-n;t>0&&this._engine._drawImage(this,0,0,t,this.height,_-this.x,c-this.y,t,this.height)}else this._engine._drawImage(this,0,0,i,this.height,r-this.x,c-this.y,i,this.height);let t=s-o;t>0&&(console.error(new Error("未完成")),this._engine._drawImage(this,0,0,this.width,t,r-this.x,c-this.y,this.width,t))}else console.error(new Error("未完成")),this._engine._drawImage(this,0,0,this.width,s,r-this.x,a-this.y,this.width,s)}_drawHorizontalPattern(t,e,i){if(!this.isLoaded())return;this._engine.ctx;const s=t+i;for(let i=t;i<s;i+=this.width)this.draw2(i,e)}_drawVerticalPattern(t,e,i){if(!this.isLoaded())return;this._engine.ctx;const s=e+i;for(let i=e;i<s;i+=this.height)this.draw2(t,i)}drawPattern4i(t,e,i,s){this.drawPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5),Math.trunc(s+.5))}drawHorizontalPattern3i(t,e,i){this.drawHorizontalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}drawVerticalPattern3i(t,e,i){this.drawVerticalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}_drawPattern4i(t,e,i,s){this._drawPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5),Math.trunc(s+.5))}_drawHorizontalPattern3i(t,e,i){this._drawHorizontalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}_drawVerticalPattern3i(t,e,i){this._drawVerticalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}}},,,function(t,e,i){"use strict";function s(t,e,i,s,n,o,r,a){var l,h="function"==typeof t?t.options:t;if(e&&(h.render=e,h.staticRenderFns=i,h._compiled=!0),s&&(h.functional=!0),o&&(h._scopeId="data-v-"+o),r?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},h._ssrRegister=l):n&&(l=a?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(h.functional){h._injectStyles=l;var c=h.render;h.render=function(t,e){return l.call(e),c(t,e)}}else{var _=h.beforeCreate;h.beforeCreate=_?[].concat(_,l):[l]}return{exports:t,options:h}}i.d(e,"a",function(){return s})},function(t,e,i){"use strict";i.d(e,"c",function(){return o}),i.d(e,"d",function(){return r}),i.d(e,"b",function(){return f}),i.d(e,"a",function(){return b});const s=[],n={};window.character_emotion_list=["blink","hit","smile","troubled","cry","angry","bewildered","stunned","vomit","oops","cheers","chu","wink","pain","glitter","despair","love","shine","blaze","hum","bowing","hot","dam","qBlue"],window.character_action_list=["walk1","walk2","stand1","stand2","alert","swingO1","swingO2","swingO3","swingOF","swingT1","swingT2","swingT3","swingTF","swingP1","swingP2","swingPF","stabO1","stabO2","stabOF","stabT1","stabT2","stabTF","shoot1","shoot2","shootF","proneStab","prone","heal","fly","jump","sit","ladder","rope"];class o{constructor(t,e,i,s,n,o,r){this.id_prefix=t,this.path=e,this.slot=s,this.listPath=i,this.categoryName=n,this.FragmentType=null,this.dataDir=null,this.stringDir=null,this.iconPath=null,this.iconRawPath=null;{let a,l,h,c;switch(s){case"head":h="stand1/0/head",c="stand1/0/head";break;case"body":h="stand1/0/body",c="stand1/0/body";break;case"hair":h="stand1/0/hair",c="stand1/0/hair";break;case"face":h="blink/0/face",c="blink/0/face";break;default:h="info/icon",c="info/iconRaw"}if("5"==t)a=`/Item/${e}/${t}/`,l="/String/Pet/",alert("Pet");else switch(t[1]){case"0":if(Math.trunc(t)<=1){a="/Character/",l=null;break}case"1":let h=e+(e?"/":"");a="/Character/"+h,l="/String/Eqp/Eqp/"+(r||h);break;case"2":a=`/Item/${e}/${t}/`,l="/String/Consume/";break;case"3":a=`/Item/${e}/${t}/`,l="/String/Ins/";break;case"4":a=`/Item/${e}/${t}/`,l="/String/Etc/";break;case"5":a=`/Item/${e}/${t}/`,l="/String/Cash/";break;default:throw new Error("unknow item type, param: %o",[t,e,i,s,n,o])}Object.defineProperties(this,{type:{value:o},dataDir:{value:a},stringDir:{value:l},iconPath:{value:h},iconRawPath:{value:c}})}}static async getItem(t){let e,i=o.get(t);if(!i)return null;if("0"!=t.padStart(8,"0")[0])throw new Error("itemId: "+t);try{e=await Promise.all([p.data(i.dataDir+t),i.stringDir?p.data(i.stringDir+Number(t)).then(t=>t,()=>({name:"<"+t+">"})):{name:"<"+t+">"}])}catch(t){throw new t}let s=Object.assign(e[0],e[1]);return s.id=t,s.info&&(s.info.id=t,s.info.name=s.name,s.desc&&(s.info.desc=s.desc),s.info.__v=window.DATA_TAG+window.DATA_VERSION,s.info.icon||(s.info.icon={}),s.info.iconRaw||(s.info.iconRaw={}),s.info.icon[""]||(s.info.icon[""]=o.getIconUrl(t)),s.info.iconRaw[""]&&(s.info.iconRaw[""]=o.getIconRawUrl(t))),s}static getIconRawUrl(t){let e=o.get(t);return e?"0"==t[0]?p.imageUrl(e.dataDir+t+"/"+e.iconRawPath):void 0:null}static getIconUrl(t){let e=o.get(t);return e?"0"==t[0]?p.imageUrl(e.dataDir+t+"/"+e.iconPath):void 0:null}static get(t){let e;if(null==t||""==t)throw new TypeError;if("0"==t[0])if(4==t.length){if(e=o._info[t])return e}else{if(6==t.length)return o._info[t];if(3==t.length)return o._info[t];if(e=o._info[t.slice(0,4)])return e;if(e=o._info[t.slice(0,6)])return e;if(e=o._info[t.slice(0,3)])return e}return console.warn("unknow item type, itemId: "+t),null}static getTypeId(){return Math.trunc(_id/1e6)}static getCategory(){return Math.trunc(_id/1e4)}static isItem(t){return 0!=Math.trunc(t/1e6)}static isEquip(t){if(!t)throw TypeError();let e=Number(t);if(!Number.isSafeInteger(e))throw TypeError();return 1==Math.trunc(e/1e6)}static isChair(t){if(!t)throw TypeError();let e=Number(t);if(!Number.isSafeInteger(e))throw TypeError();return 301==Math.trunc(e/1e4)}static getSubCategory(t){return Math.trunc(t/1e4)}static isCashWeapon(t){return 170==Math.trunc(t/1e4)}static getJobWeaponCategory(t){console.warn("getJobWeaponCategory: 未完成")}}window.$ItemCategoryInfo=o,o.type={Equip:"Equip",Consume:"Consume",Etc:"Etc",Install:"Install",Cash:"Cash"},o.typeName={0:"Equip",1:"Consume",2:"Etc",3:"Install",4:"Cash"},o.typeId={Equip:0,Consume:1,Etc:2,Install:3,Cash:4},o._info={"0000":new o("0000","","body","body","<body>","Equip"),"0001":new o("0001","","head","head","<head>","Equip"),"0002":new o("0002","Face","Face","face","臉型","Equip"),"0003":new o("0003","Hair","Hair","hair","髮型","Equip"),"0004":new o("0004","Hair","Hair","hair","髮型","Equip"),"0100":new o("0100","Cap","Cap","cap","帽子","Equip"),"0101":new o("0101","Accessory","accessoryFace","accessoryFace","臉飾","Equip"),"0102":new o("0102","Accessory","accessoryEyes","accessoryEyes","眼飾","Equip"),"0103":new o("0103","Accessory","accessoryEars","accessoryEars","耳環","Equip"),"0104":new o("0104","Coat","Coat","coat","上衣","Equip"),"0105":new o("0105","Longcoat","Longcoat","longcoat","套服","Equip"),"0106":new o("0106","Pants","Pants","pants","褲子","Equip"),"0107":new o("0107","Shoes","Shoes","shoes","鞋子","Equip"),"0108":new o("0108","Glove","Glove","glove","手套","Equip"),"0109":new o("0109","Shield","Shield","shield","盾牌","Equip"),"0110":new o("0110","Cape","Cape","cape","披風","Equip"),"0121":new o("0121","Weapon","閃亮克魯","weapon","閃亮克魯","Equip"),"0122":new o("0122","Weapon","靈魂射手","weapon","靈魂射手","Equip"),"0123":new o("0123","Weapon","魔劍","weapon","魔劍","Equip"),"0124":new o("0124","Weapon","能量劍","weapon","能量劍","Equip"),"0125":new o("0125","Weapon","幻獸棒","weapon","幻獸棒","Equip"),"0126":new o("0126","Weapon","ESP限制器","weapon","ESP限制器","Equip"),"0127":new o("0127","Weapon","鎖鏈","weapon","鎖鏈","Equip"),"0128":new o("0128","Weapon","魔力護腕","weapon","魔力護腕","Equip"),"0130":new o("0130","Weapon","單手劍","weapon","單手劍","Equip"),"0131":new o("0131","Weapon","單手斧","weapon","單手斧","Equip"),"0132":new o("0132","Weapon","單手錘","weapon","單手錘","Equip"),"0133":new o("0133","Weapon","短劍","weapon","短劍","Equip"),"0134":new o("0134","Weapon","雙刀","weapon","雙刀","Equip"),"013526":new o("013526","Weapon","靈魂之環","weapon","靈魂之環","Equip"),"013530":new o("013530","Weapon","控制器","weapon","控制器","Equip"),"0136":new o("0136","Weapon","手杖","weapon","手杖","Equip"),"0137":new o("0137","Weapon","短杖","weapon","短杖","Equip"),"0138":new o("0138","Weapon","長杖","weapon","長杖","Equip"),"0140":new o("0140","Weapon","雙手劍","weapon","雙手劍","Equip"),"0141":new o("0141","Weapon","雙手斧","weapon","雙手斧","Equip"),"0142":new o("0142","Weapon","雙手棍","weapon","雙手棍","Equip"),"0143":new o("0143","Weapon","槍","weapon","槍","Equip"),"0144":new o("0144","Weapon","矛","weapon","矛","Equip"),"0145":new o("0145","Weapon","弓","weapon","弓","Equip"),"0146":new o("0146","Weapon","弩","weapon","弩","Equip"),"0147":new o("0147","Weapon","拳套","weapon","拳套","Equip"),"0148":new o("0148","Weapon","指虎","weapon","指虎","Equip"),"0149":new o("0149","Weapon","火槍","weapon","火槍","Equip"),"0150":new o("0150","Weapon","鏟","weapon","鏟","Equip"),"0151":new o("0151","Weapon","鎬","weapon","鎬","Equip"),"0152":new o("0152","Weapon","雙弩槍","weapon","雙弩槍","Equip"),"0153":new o("0153","Weapon","加農砲","weapon","加農砲","Equip"),"0154":new o("0154","Weapon","太刀","weapon","太刀","Equip"),"0155":new o("0155","Weapon","扇子","weapon","扇子","Equip"),"0156":new o("0156","Weapon","琉","weapon","琉","Equip"),"0157":new o("0157","Weapon","璃","weapon","璃","Equip"),"0158":new o("0158","Weapon","重拳槍","weapon","重拳槍","Equip"),"0170":new o("0170","Weapon","0170","weapon","點裝武器","Equip"),"019":new o("019","TamingMob","TamingMob","tamingMob","騎寵","Equip","Taming/"),"0301":new o("0301","Install","Chair","install","椅子","Item")},o._categoryList=function(t){let e=[],i=new Set;for(let s in t){let n=t[s],o=n.categoryName||n.listPath;i.has(o)||(i.add(o),e.push({key:o,value:s}))}return e}(o._info);class r{static isEquipExist(t,e){const i=e.listPath,s=r.equip_map[i];return!s||s.has(t)}static async loadArchive(t){a(n,"/",JSON.parse(await r.get(t)))}static get(t){return new Promise(function(e,i){let n=new XMLHttpRequest;n.open("GET",t,!0),n.timeout=6e5,n.onload=function(){404==this.status||500==this.status?(s.push(t),i(this.status+": "+t)):200==this.status?e(this.responseText):this.status},n.ontimeout=function(e){i("timeout: "+t)},n.onabort=function(e){i("abort: "+t)},n.send()})}static get root_path(){return window.$ROOT_PATH}static get archive(){return n}static get failed_urls(){return s}}function a(t,e,i){e.endsWith("/")&&(e=e.slice(0,e.length-1));let s,n=e.split("/"),o=t,r=n.length-1;for(s=0;s<r;++s){let t=n[s];null==o[t]&&(o[t]={}),o=o[t]}let a=o[n[r]];if(a instanceof Promise)delete o[n[r]],o[n[r]]=i;else if(a&&"object"==typeof a)for(let t in i)a[t]=i[t]||a[t];else void 0!==i&&(o[n[r]]=i)}function l(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i,s=e.split("/"),n=t,o=s.length-1;for(i=0;i<o;++i){let t=s[i];if(!n[t])return;n=n[t]}return n[s[o]]}window.$ResourceManager=r;const h=Symbol("$pack"),c=RegExp.prototype.test.bind(/^(([a-zA-Z^\:]+)(\:.*)$|\/\/)/);function _(t,e,i){return c(t)?void 0:""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH)?(i&&(e[h]=!0),t=t.slice(window.$ROOT_PATH.length),a(n,t,e)):a(n,t,e)}function u(t,e){let i=m(t);if(i)return l(n,i)}function m(t){if(!c(t)&&""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH))return t.slice(window.$ROOT_PATH.length)}function d(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i=l(t,e);if(i)return i instanceof Promise?new Promise(async function(s,n){await i,s(await d(t,e))}):i;{let i,s=e.split("/"),n=t,o=s.length-1;for(i=0;i<o;++i){let o=s[i];if(n[o]instanceof Promise)return new Promise(async function(i,s){await n[o],i(await d(t,e))});if(!n[o])return;n=n[o]}let r=n[s[o]];return r instanceof Promise?new Promise(async function(i,s){await r,i(await d(t,e))}):r}}let p=function(t){return r.get(t)};p.pack=async function(t){let e,i=m(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e&&e[h])return e;{0;const i=p.packUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!0),e}();return _(t,s,!0),await s}},p.packSync=function(t){let e=u(t);if(e)return e},p.data=async function(t){let e,i=m(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e)return e;{const i=p.dataUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!1),e}();return _(t,s,!1),await s}},p.dataSync=function(t){let e=u(t);if(e)return e},p.list=async function(t){let e,i=m(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e)return e;{const i=p.listUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!1),e}();return _(t,s,!1),await s}},p.listSync=function(t){let e=u(t);if(e)return Object.keys(e)},p.dataUrl=function(t){if(c(t))return t;if(!t.startsWith("data"))return`${window.$ROOT_PATH}data${t}.json`;throw new Error("Not game data: "+t)},p.packUrl=function(t){if(c(t))return t;if(!t.startsWith("pack"))return`${window.$ROOT_PATH}pack${t}.json`;throw new Error("Not game pack: "+t)},p.listUrl=function(t){if(c(t))return t;if(!t.startsWith("ls"))return`${window.$ROOT_PATH}ls${t}.json`;throw new Error(t)},p.imageUrl=function(t){if(c(t))return t;if(!t.startsWith("images"))return`${window.$ROOT_PATH}images${t}.png`;throw new Error("Not game images: "+t)},p.soundMp3Url=function(t){if(c(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.mp3`;throw new Error("Not game sound: "+t)},p.soundWavUrl=function(t){if(c(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.wav`;throw new Error("Not game sound: "+t)},p.assetUrl=function(t){return`${window.$ROOT_PATH}${t}`},p.asset=function(t){return p(p.assetUrl(t))},window.$get=p;class f{static head(t){t.gender=2}static body(t){t.gender=2}static Face(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||4==e?1:0}static Hair(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||2==e||4==e||7==e?1:0}static Cap(t){f._equip(t)}static accessoryFace(t){f._equip(t)}static accessoryEyes(t){f._equip(t)}static accessoryEars(t){f._equip(t)}static Coat(t){f._equip(t)}static Longcoat(t){f._equip(t)}static Pants(t){f._equip(t)}static Shoes(t){f._equip(t)}static Glove(t){f._equip(t)}static Shield(t){f._equip(t)}static Cape(t){f._equip(t)}static _equip(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=0==e?0:1==e?1:2}}const y=/(\d{4,7})\d$/,g=/(\d{2,5})\d(\d{2})$/,v=/\d{4,7}(\d)$/,x=/\d{2,5}(\d)\d{2}$/;class b{static*enumHairColor(t){let e=t.match(y);for(let t=0;t<10;++t){yield e[1]+t}}static*enumFaceColor(t){let e=t.match(g);for(let t=0;t<10;++t){yield e[1]+t+e[2]}}static getColorHairID(t,e){return t.match(y)[1]+e%10}static getColorFaceID(t,e){let i=t.match(g);return i[1]+e%10+i[2]}static isHairStyleEqual(t,e){return b.getColorHairID(t,0)==b.getColorHairID(e,0)}static isFaceStyleEqual(t,e){return b.getColorFaceID(t,0)==b.getColorFaceID(e,0)}static getHairColor(t){if(t){let e=(t=String(t)).match(v);if(e)return e[1]}}static getFaceColor(t){if(t){let e=(t=String(t)).match(x);if(e)return e[1]}}}var A={Equip:{Hat:"Cap",Cape:"Cape",Top:"Coat",Overall:"Longcoat",Glove:"Glove",Bottom:"Pants",Shield:"Shield",Shoes:"Shoes","Eye Decoration":"accessoryEyes",Earrings:"accessoryEars","Face Accessory":"accessoryFace",Face:"Face",Hair:"Hair"}};r.external={equip:{}},r.equip_map={};for(let t in A.Equip){let e=A.Equip[t];r.external.equip[e]=[],r.equip_map[e]=null}for(let t=0;t<9;++t){let e="Face"+t;r.external.equip[e]=[],r.equip_map[e]=null}for(let t=0;t<8;++t){let e="Hair"+t;r.external.equip[e]=[],r.equip_map[e]=null}async function w(t){let e;t=t||"/items.json";try{if(!(e=r._external_raw=JSON.parse(await p.asset("equip.json"))))throw Error("'/equip' is empty")}catch(t){if(!(e=r._external_raw=JSON.parse(await p("//labs.maplestory.io/api/gms/latest/item/category/equip"))))return}for(let t=0;t<e.length;++t){const i=e[t],s=String(i.id).padStart(8,"0");try{if(!i.typeInfo||!A[i.typeInfo.overallCategory])continue;let t=i.typeInfo.overallCategory.toLowerCase(),e=A[i.typeInfo.overallCategory][i.typeInfo.subCategory];if(!e)continue;"Face"==e?e+=b.getFaceColor(s):"Hair"==e&&(e+=b.getHairColor(s));let n={id:s,name:i.name,desc:i.desc,cash:i.isCash?1:0,icon:{"":`//labs.maplestory.io/api/gms/latest/item/${i.id}/icon`}};r.external[t][e].push(n)}catch(t){console.error("external resource: id("+s+")"),console.error(t)}}}let S=w();async function C(t,e){await S,B(t,e),concat_external_resource=B}function B(t,e){try{const i=r.external.equip[t];if(!i)return;let s=r.equip_map[t];s||(s=new Map,e.forEach(t=>{s.set(t.id,t)}),r.equip_map[t]=s),i.forEach(t=>{let i=t.id;if(s.has(i)){let e=s.get(i);e._name=t.name||"",e._desc=t.desc||""}else t.$foreign=!0,e.push(t)})}catch(t){console.error(t)}}window.concat_external_resource=C,window.trigger_update_external_equip_list=function(){S=w(),window.concat_external_resource=C},window.load_extern_item_data=async function(t){let e=JSON.parse(await p(`//labs.maplestory.io/api/gms/latest/item/${t}`)),i={},s=e.frameBooks.default?e.frameBooks.default.frames[0]:null;for(let t in e.frameBooks){let n=e.frameBooks[t],o=[];for(let t=0;t<n.frames.length;++t){let e=n.frames[t]||s;if(!e||!e.effects)continue;let i=e.effects,r={};for(let t in i){let e=i[t];e.image&&(r[t]={"":"data:image/png;base64,"+e.image,origin:e.originOrZero||e.origin||e.center,map:e.mapOffset,z:e.position})}o[t]=r}i[t]=o}return i.info={islot:e.metaInfo.equip.islot,vslot:e.metaInfo.equip.vslot,icon:e.metaInfo.icon?"data:image/png;base64,"+e.metaInfo.icon.iconRaw:"",cash:e.metaInfo.cash&&e.metaInfo.cash.cash?1:0},i}},function(t,e,i){"use strict";i.d(e,"a",function(){return u}),i.d(e,"b",function(){return m});var s=i(356),n=(i(371),i(359),i(367),i(355),i(365),i(380),i(357));const o=Math.PI/180;let r=new s.b2Vec2;const a={width:25/$gv.CANVAS_SCALE,height:48/$gv.CANVAS_SCALE,density:1,get foot_width(){return.5*a.width},get foot_j_width(){return.4*a.width}};window.JUMP_FORCE=555,window.MOVEMENT_VELOCITY=125/$gv.CANVAS_SCALE,window.$LADDER_SPEED=125/$gv.CANVAS_SCALE,window.PLAYER_USE_WHEEL_WALKER=!1,window.FOOT_FRICTION=1,window.MOVEMENT_POWER=14e4,window.MOVEMENT_STOP_POWER=14e4,window.PORTAL_COOLDOWN=1e3;class l{constructor(){this._begin_jump=!1,this.jump=!0,this.jump_count=0,this._drop=!0,this.walk=!1,this.prone=!1,this.dropDown=!1,this._fly=!1,this.brake=!0,this.front=-1,this.ladder=!1,this.ladder_move_dir=0,this.invincible=0,this.freeze=!1,this.invokeSkill=!1,this.portal_cooldown=0,this.knockback=0,this.outOfControl=!1}}class h{constructor(t,e,i){this.foothold=t,this.position=e,this.priority=i}}class c{constructor(){this.disable=!1,this.chara_profile=Object.assign({},a),this.setMovementSpeed(100),this.body=null,this.foot_walk=null,this.walker=null,this.$foothold=null,this.prev_$fh=null,this.leave_$fh=null,this._foothold=null,this._foot_at=new s.b2Vec2,this._foothold_priority=0,this._foot_contact_list=[],this.portal=null,this.ladder=null,this._walker_omega=1,this.jump_force=JUMP_FORCE,this.state=new l}setPosition(t,e,i){const n=e-this.chara_profile.foot_width-.75*this.chara_profile.height*.5,o=e-this.chara_profile.foot_width;this.body.SetPositionXY(t,n);try{if(this.foot_walk&&this.foot_walk.SetPositionXY(t,o),i){const t=new s.b2Vec2(0,0);this.body.ConstantVelocity(t),this.foot_walk&&this.foot_walk.ConstantVelocity(t)}}catch(t){}}getPosition(){const t=this.foot_walk.GetPosition();return new s.b2Vec2(t.x,t.y+this.chara_profile.foot_width)}_usePortal(t){if(!t.enable||this.state.portal_cooldown>0)return!1;const e=t.mapRenderer,i=e.controller,s=t.getMap();if(t.exeScript)t.exeScript(this);else{if(!s)return console.log("portal: $o",t),!1;if(s==e.map_id){const i=t.tn.match(/(^[a-z_]+)(\d+$)/)||t.tn.match(/(^[a-z]+)\d+_\d+$/),s=i[1];if("hp"==s){let i=t.tn,s=e.portalMgr.portals.find(function(t){return i==t.pn});this._gotoPortal(s)}else{if("pt_go"!=s)return console.log(`portal.pn: ${t.pn}, portal.tn: ${t.tn}, %o`,t),!1;{const t=parseInt(i[2],10),s=e.portalMgr.portals[t];this._gotoPortal(s)}}}else i.doAfterStep(function(){e.unload(),e.load(s)})}return this.state.portal_cooldown=PORTAL_COOLDOWN,!0}_gotoPortal(t){t.mapRenderer.controller.doAfterStep(()=>{const e=t.x/$gv.CANVAS_SCALE,i=(t.y-3)/$gv.CANVAS_SCALE;this.setPosition(e,i,!0)})}contactLadder(t){this.ladder=t||null}leaveLadder(){this.body.m_world.onceUnlock(()=>{this._useLadder(!1),this.contactLadder(null,null)})}useLadder(t){this.body.m_world.onceUnlock(()=>{this._useLadder(t)})}_useLadder(t){const e=this.body.m_world;if(t){if(this.ladder&&!this.$ladder_pj){const t=this.ladder.body;(t.GetAngle()||t.GetAngularVelocity())&&(this.body.SetAngle(t.GetAngle()),this.body.SetFixedRotation(!1)),this.state.ladder=!0,this.state.jump=!1,this.state.jump_count=0,this.body.SetAwake(!0),this.body.SetLinearVelocity2(0,0),this.body.m_type=s.b2BodyType.b2_kinematicBody,this.foot_walk.SetAwake(!0),this.foot_walk.SetLinearVelocity2(0,0),this.foot_walk.m_type=s.b2BodyType.b2_kinematicBody,this.walker.SetMotorSpeed(0);let i=this.ladder.calcHeight()/$gv.CANVAS_SCALE;this.setPosition(t.GetPosition().x,this.getPosition().y);let n=new s.b2PrismaticJointDef;n.bodyA=t,n.bodyB=this.foot_walk,n.localAxisA.Set(0,1),n.lowerTranslation=-this.chara_profile.foot_width,n.upperTranslation=i+this.chara_profile.foot_width,n.enableLimit=!0,n.maxMotorForce=1e3*this._getMass();let o=e.CreateJoint(n);this.$ladder_pj=o}}else this.ladder&&this.state.ladder&&(this.state.ladder=!1,this.body.SetAwake(!0),this.body.SetLinearVelocity2(0,0),this.body.m_type=s.b2BodyType.b2_dynamicBody,this.foot_walk.SetAwake(!0),this.foot_walk.SetLinearVelocity2(0,0),this.foot_walk.m_type=s.b2BodyType.b2_dynamicBody),this.$ladder_pj&&(e.DestroyJoint(this.$ladder_pj),delete this.$ladder_pj,this.body.SetAngle(0),this.body.SetFixedRotation(!0))}remove_sticky(){this.$sticky_pj&&(this.body.m_world.DestroyJoint(this.$sticky_pj),this.$sticky_pj=null)}actionJump(){this.state._begin_jump=!0,++this.state.jump_count}actionDropdown(){this.leave_$fh=this.$foothold,this.$foothold=null,this.state.dropDown=!0,this.body.SetAwake(!0)}control(t){if(this._isCanMove())if(this.state.ladder&&this.$ladder_pj){const e=this.ladder.body,i=window.$LADDER_SPEED||1;if(e&&(e.GetAngle()||e.GetAngularVelocity())&&(this.body.SetAngle(e.GetAngle()),this.body.SetFixedRotation(!1)),t.up&&!t.down?(this.state.ladder_move_dir=-1,this.$ladder_pj.EnableMotor(!0),this.$ladder_pj.SetMotorSpeed(-i)):t.down&&!t.up?(this.state.ladder_move_dir=1,this.$ladder_pj.EnableMotor(!0),this.$ladder_pj.SetMotorSpeed(i)):(this.state.ladder_move_dir=0,this.$ladder_pj.EnableMotor(!1),this.body.SetLinearVelocity2(0,0),this.foot_walk.SetLinearVelocity2(0,0)),t.jump){const e=this.body.m_world,s=this._getMass();t.left&&t.right?this.useLadder(!1):t.left?(this.useLadder(!1),e.doAfterStep(()=>{this.body.ApplyLinearImpulseToCenter2(-i*s,0)})):t.right&&(this.useLadder(!1),e.doAfterStep(()=>{this.body.ApplyLinearImpulseToCenter2(i*s,0)}))}}else if(this.$ladder_pj)this.useLadder(!1);else{if(this.state.outOfControl)return void this.walker.EnableMotor(!1);if(this.walker.EnableMotor(!0),this.portal&&t.up){let t=this.portal;if(this._usePortal(t))return void(this.portal=null)}if(this.ladder&&(t.down&&this.$foothold&&this.ladder.body.GetLocalPoint(this.getPosition(),r).y<=0||t.up&&!this.$foothold&&this.ladder.body.GetLocalPoint(this.getPosition(),r).y>0))return this.state.ladder_move_dir=0,void this.useLadder(!0);const e=this._walker_omega,i=this.body.GetLinearVelocity();if(this.state.jump||this.state.dropDown)this.state.prone=!1;else{if(t.down&&t.jump)return void this.actionDropdown();if(t.down)return void(this.state.prone=!0);this.state.prone=!1}if(t.left&&!t.right)this.state.walk=!0,this.state.front=-1,this.walker.SetMotorSpeed(-e),this.walker.SetMaxMotorTorque(MOVEMENT_POWER),this.remove_sticky();else if(t.right&&!t.left)this.state.walk=!0,this.state.front=1,this.walker.SetMotorSpeed(e),this.walker.SetMaxMotorTorque(MOVEMENT_POWER),this.remove_sticky();else{if(this.state.walk=!1,this.state.jump)this.walker.SetMotorSpeed(0);else{let t=i.x;t>50*s.b2_linearSlop?this.walker.SetMotorSpeed(-t*Math.PI/2/Math.PI/this.chara_profile.width/2):t<-50*s.b2_linearSlop?this.walker.SetMotorSpeed(-t*Math.PI/2/Math.PI/this.chara_profile.width/2):this.walker.SetMotorSpeed(0)}this.walker.SetMaxMotorTorque(MOVEMENT_STOP_POWER),this.state.止滑&&this.sticky(this.getPosition())}t.jump&&this._isCanJump()&&(this.remove_sticky(),this.actionJump())}}_isCanJump(){return!this.state.jump&&!this.isDrop()}_isCanMove(){return!this.state.freeze&&!this.state.knockback}setMovementSpeed(t){if(!(Number.isSafeInteger(t)||!Number.isNaN(t)&&Number.isFinite(t)))throw new TypeError("increment_percent must is number");let e=(100+t)/100;e>0?this._setWalkerOmegaFromVelocity(MOVEMENT_VELOCITY*e):this._setWalkerOmegaFromVelocity(0)}setMovementSpeedPixel(t){let e=t/$gv.CANVAS_SCALE;this._walker_omega=e>0?e:0}_setWalkerOmegaFromVelocity(t){this._walker_omega=t/(Math.PI*this.chara_profile.width)*Math.PI}setjumpForce(t){if(!(Number.isSafeInteger(t)||!Number.isNaN(t)&&Number.isFinite(t)))throw new TypeError("increment_percent must is number");let e=(100+t)/100;if(e<=0)this.jump_force=0;else{this.body.GetWorld().GetGravity();this.jump_force=JUMP_FORCE*e}}_getMass(){return this.body.GetMass()+this.foot_walk.GetMass()}setGravityScale(t){this.body.SetGravityScale(t),this.foot_walk.SetGravityScale(t)}get _body_category(){return"body"}_create(t){let e=new s.b2Vec2(1/$gv.CANVAS_SCALE,-2/$gv.CANVAS_SCALE),i=e.y+.75*this.chara_profile.height*.5,r=new s.b2BodyDef,a=new s.b2FixtureDef,l=new s.b2PolygonShape;r.type=s.b2BodyType.b2_dynamicBody,r.bullet=!0,r.position.Set(e.x,e.y),r.userData=this,a.userData=this,this.body=t.CreateBody(r),this.body.SetFixedRotation(!0),this.body.$type="player",a.filter.Copy(n.FilterHelper.get(this._body_category)),l.SetAsBox(.5*this.chara_profile.width,.75*this.chara_profile.height*.5,s.b2Vec2.ZERO,0),a.density=this.chara_profile.density,a.friction=0,a.restitution=0,a.shape=l,this.fixture=this.body.CreateFixture(a),this.fixture.$type="player",a.filter.Copy(n.FilterHelper.get("foot"));{r.type=s.b2BodyType.b2_dynamicBody,r.position.Set(e.x,i),this.foot_walk=t.CreateBody(r);let n=new s.b2CircleShape;n.m_p.Set(0,0),n.m_radius=this.chara_profile.foot_width,a.shape=n,a.density=this.chara_profile.density,a.friction=FOOT_FRICTION,a.restitution=0;let o=this.foot_walk.CreateFixture(a);o.$type="pl_ft_walk",this._set_foot_listener(o)}this.foot_walk.$type="pl_ft_walk";{let n;(n=PLAYER_USE_WHEEL_WALKER?new s.b2WheelJointDef:new s.b2RevoluteJointDef)instanceof s.b2RevoluteJointDef&&n.Initialize(this.body,this.foot_walk,new s.b2Vec2(e.x,i)),n instanceof s.b2WheelJointDef&&n.Initialize(this.body,this.foot_walk,new s.b2Vec2(e.x,i),new s.b2Vec2(0,-1)),n.enableMotor=!0,n.maxMotorTorque=MOVEMENT_POWER,n instanceof s.b2RevoluteJointDef&&(n.enableLimit=!1,n.lowerAngle=0*o,n.upperAngle=-0*o,n.referenceAngle=0),n instanceof s.b2WheelJointDef&&(n.frequencyHz=10,n.dampingRatio=1),this.walker=t.CreateJoint(n)}this.body.addStep(this.Step.bind(this)),this.body.addAfterStep(this.AfterStep.bind(this)),this.setMovementSpeed(0),this.setjumpForce(0)}_destroy(){const t=this.body.m_world;this.body?(t.DestroyBody(this.body),this.body=null):console.log("this already dead"),this.foot_walk&&(t.DestroyBody(this.foot_walk),this.foot_walk=null)}_isFromSelfContact(t,e){let i=t.GetBody().GetUserData(),s=e.GetBody().GetUserData();return!!(i&&s&&i.body&&s.body&&i.body==s.body)}_ignoreSelfContact(t,e,i){return!!this._isFromSelfContact(e,i)&&(t.SetEnabled(!1),!0)}_set_foot_listener(t){t.beginContact=this.__beginContact_walker,t.endContact=this.__endContact_walker,t.preSolve=this.__preSolve_walker}__beginContact_walker(t,e,i){if(this._ignoreSelfContact(t,e,i))return;let s=i.m_body;if(s)switch(s.$type){case"portal":this._beginContactPortal(i.m_userData)}}__endContact_walker(t,e,i){if(this._ignoreSelfContact(t,e,i))return;let s=i.m_body;if(s)switch(s.$type){case"portal":this._endContactPortal(i.m_userData)}}__preSolve_walker(t,e,i,s){this._ignoreSelfContact(t,i,s)||"pl_ft_walk"!=i.$type||"pl_ft_walk"!=s.$type||t.SetEnabled(!1)}_beginContactPortal(t){this.portal=t,t.enable?t.script?console.log("goto map: "+t.getMap()+"; "+t.script):console.log("goto map: "+t.getMap()):console.log("contact portal: %o",t)}_endContactPortal(t){this.portal==t&&(this.portal=null)}__priority_foothold_contact(t,e){return t.is_wall?0:this.$foothold&&this.$foothold.chain!=t.chain&&this.$foothold!=t&&!this.state.dropDown&&this._foot_at&&e.y<this._foot_at.y&&!(!this.$foothold.prev||this.$foothold.prev==t.id&&t.y1<this.$foothold.y1||!this.$foothold.next||this.$foothold.next==t.id&&t.y2<this.$foothold.y2)?1:2}_which_foothold_contact(t,e){if(t.is_wall)return!0;let i=this.__priority_foothold_contact(t,e);if(i>0){if(!this._foothold_priority||i>=this._foothold_priority)return this._foothold=t,this._foot_at=e.Clone(),this._foothold_priority=i,!0;{for(let s of this._foot_contact_list)if(t==s.foothold)return s.priority=i,s.position=e,!1;let s=new h(t,e,i);this._foot_contact_list.push(s),this._foot_contact_list.sort((t,e)=>t.priority-e.priority)}}return!1}sticky(t){const e=this.body.m_world;e.onceUnlock(()=>{if(this.$sticky_pj)return;let i=new s.b2PrismaticJointDef;i.Initialize(e.mapBound_body,this.body,t,new s.b2Vec2(0,1)),i.lowerTranslation=0,i.upperTranslation=0,i.enableLimit=!0,i.maxMotorForce=1e3*this._getMass();let n=e.CreateJoint(i);this.$sticky_pj=n})}isDrop(){return this.state.dropDown||this.state._drop}_endContactFoothold(){for(let t=0;t<this._endContactFootholdList.length;++t){let e=this._endContactFootholdList[t];e==this._$fallEdge?this._$fallEdge=null:e==this._foothold&&(this._foothold=null,this._foot_at=null),this.$foothold&&e==this.$foothold&&(this.prev_$fh=this.$foothold,this.$foothold=null),this.leave_$fh&&this.leave_$fh==e&&(this.leave_$fh=null)}this._endContactFootholdList.length=0}Step(t){if(this.state._drop=!1,this._foothold=null,this._foot_at=null,this.state.ladder)this.state.jump=!1,this.state.jump_count=0;else{if(this.state._begin_jump){const t=this._getMass(),e=new s.b2Vec2(0,-t*this.jump_force);this.body.ApplyForceToCenter(e)}this.state.knockback>0&&(this.state.knockback-=t,this.state.knockback>0?(this.state.outOfControl=!0,this.walker.EnableMotor(!1)):(this.state.knockback=0,this.state.outOfControl=!1,this.walker.EnableMotor(!0))),this.state.invincible>0&&(this.state.invincible-=t,this.state.invincible>0||(this.state.invincible=0)),this.state.portal_cooldown&&(this.state.portal_cooldown-=t,this.state.portal_cooldown>0||(this.state.portal_cooldown=0))}}AfterStep(){if(this.state.ladder){if(this.$ladder_pj){const t=this.$ladder_pj.GetUpperLimit(),e=this.$ladder_pj.GetLowerLimit(),i=this.$ladder_pj.GetJointTranslation();this.state.ladder_move_dir>0&&i>t?this.useLadder(!1):this.state.ladder_move_dir<0&&i<e&&this.useLadder(!1)}}else{if(!this.state.dropDown&&(this.body.m_awakeFlag&&this.foot_walk.m_awakeFlag&&(this.$foothold=this._foothold),!this._foothold&&this._foot_contact_list.length)){let t=this._foot_contact_list.pop();this.$foothold=t.foothold,this._foothold=t.foothold,this._foot_at=t.position,this._foothold_priority=t.priority}this.$foothold?(this.state.jump=!1,this.state.jump_count=0,this.$foothold,this._foothold):(this._foot_contact_list.length=0,this.state.jump=!0,this.state._begin_jump=!1,this._foothold)}}getLayer(){let t=this.$foothold?this.$foothold.layer:this.prev_$fh?this.prev_$fh.layer:this.leave_$fh?this.leave_$fh.layer:5;return this.state.ladder?t+1:t}}class _ extends c{constructor(){super(...arguments),this.chara=null}forceMove(t,e){const i=this._getMass(),n=new s.b2Vec2(t*i,e*i);this.body.ApplyLinearImpulseToCenter(n)}knockback(t,e,i=1e3){let s,n;s=-t*this.state.front,n=-e,this.forceMove(s,n),this.state.knockback=i,this.state.outOfControl=!0}_create_anchor(t){let e=new s.b2MouseJointDef;return e.bodyA=t.ground.bodies[0],e.bodyB=this.body,e.target.Copy(this.getPosition()),e.maxForce=1e3*this._getMass(),t.CreateJoint(e)}moveTo(t){const e=this.body;if(0==t.elapsed)e.ConstantVelocityWorldCenter2(vx,vy);else{const i=.7,s=1-i;let n,o,r=t.x-pos.x,a=t.y-pos.y,l=r/(t.elapsed/$gv.FRAME_ELAPSED),h=a/(t.elapsed/$gv.FRAME_ELAPSED),c=e.GetLinearVelocity();t.pState.jump?this.setGravityScale(0):(this.setGravityScale(1),t.pState.walk||l?this.walker.EnableMotor(!1):this.walker.EnableMotor(!0)),n=l?t.vx?Math.sign(t.vx)==Math.sign(l)?c.x*s+t.vx*i:c.x*s+l*i:l:0,o=h?t.vy?Math.sign(t.vy)==Math.sign(h)?c.y*s+t.vy*i:c.y*s+h*i:h:0,e.ConstantVelocityWorldCenter2(n,o)}}}class u extends _{constructor(){super(...arguments)}_create(t){super._create(t),window.SCREEN_PRINTLN(()=>"x",()=>this.getPosition().x.toFixed(3)+" * "+$gv.CANVAS_SCALE+" = "+(this.getPosition().x*$gv.CANVAS_SCALE).toFixed(0)),window.SCREEN_PRINTLN(()=>"y",()=>this.getPosition().y.toFixed(3)+" * "+$gv.CANVAS_SCALE+" = "+(this.getPosition().y*$gv.CANVAS_SCALE).toFixed(0)),window.SCREEN_PRINTLN(()=>"jump",()=>this.state.jump),window.SCREEN_PRINTLN(()=>"_drop",()=>this.state._drop),window.SCREEN_PRINTLN(()=>"ddrop",()=>this.state.dropDown),window.SCREEN_PRINTLN(()=>"$fh",()=>this.$foothold?this.$foothold.id:null),window.SCREEN_PRINTLN(()=>"$fh->c",()=>this.$foothold?this.$foothold.chain.id:null),window.SCREEN_PRINTLN(()=>"_fh",()=>this._foothold?this._foothold.id:null),window.SCREEN_PRINTLN(()=>"p$fh",()=>this.prev_$fh?this.prev_$fh.id:null),window.SCREEN_PRINTLN(()=>"leave_$fh",()=>this.leave_$fh?this.leave_$fh.id:null),window.SCREEN_PRINTLN(()=>"(jump && !$fh)",()=>this.state.jump&&!this.$foothold),window.SCREEN_PRINTLN(()=>"vel.x",()=>(this.body.m_linearVelocity.x*$gv.CANVAS_SCALE).toFixed(0)),window.SCREEN_PRINTLN(()=>"vel.y",()=>(this.body.m_linearVelocity.y*$gv.CANVAS_SCALE).toFixed(0))}Step(t){if(super.Step(t),1!=$gv.input_keyDown.B||$gv.mouse_dl){if($gv.input_keyDown.B>0&&$gv.mouse_dl){const t=$gv.m_viewRect.center,e=$gv.m_viewRect.left+$gv.mouse_x-t.x,i=$gv.m_viewRect.top+$gv.mouse_y-t.y;this.body.SetLinearVelocity(new s.b2Vec2(e/$gv.CANVAS_SCALE,i/$gv.CANVAS_SCALE)),this.foot_walk.SetLinearVelocity(new s.b2Vec2(e/$gv.CANVAS_SCALE,i/$gv.CANVAS_SCALE))}else if($gv.mouse_dm&&$gv.mouse_dm%12==1){const t=$gv.m_viewRect.left+$gv.mouse_x,e=$gv.m_viewRect.top+$gv.mouse_y;this.setPosition(t/$gv.CANVAS_SCALE,e/$gv.CANVAS_SCALE,!0)}}else{const t=$gv.m_viewRect.left+$gv.mouse_x,e=$gv.m_viewRect.top+$gv.mouse_y;this.setPosition(t/$gv.CANVAS_SCALE,e/$gv.CANVAS_SCALE,!0)}}get renderer(){return this._$renderer}set renderer(t){this._$renderer=t}}class m extends _{constructor(){super(...arguments),this._anchor=null}_create(t){super._create(t),window.$io?this._anchor=this._create_anchor(t):this.moveTo=super.moveTo}moveTo(t){this._anchor.m_targetA.x=t.x,this._anchor.m_targetA.y=t.y}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});i(332),i(354);var s=i(341);class n{constructor(){this.$objectid=null,this.$layer=null,this.$physics=null,Object.defineProperty(this,"$physics",{configurable:!0,enumerable:!1,writable:!0,value:null}),this.renderer=null}create(){}destroy(){}set enablePhysics(t){this.$physics&&(this.$physics.enable=t,this.$physics.state.freeze=!t)}get enablePhysics(){return!!this.$physics&&this.$physics.enable}_applyState(){throw new Error("Not implement")}update(t){this.renderer.update(t)}render(t){this.renderer.render(t)}damage(t,e){console.log(this.$objectid+" 被 "+t.$objectid+" 攻擊，減少 "+e+" HP")}knockback(t,e,i){}__drawName(t,e,i){if($gv.m_display_name_label){if(i&&"0"!=i){let n=s.NameLabel.get(i);if(n&&!n.$promise){const i=this.renderer;return void n.draw(t,e,i.x,i.y)}}this.__drawName_default(t,e)}}__drawName_default(t,e,i="#FFF",s="#000B"){const n=t.ctx,o=this.renderer;n.font="12px 微軟正黑體",n.textBaseline="middle",n.textAlign="start";const r=n.measureText(e).width+3,a=Math.trunc(o.x)-.5*r,l=Math.trunc(o.y),h=a+2,c=a,_=l,u=l+2,m=a+r,d=m+2,p=l+2+12+2,f=l+2+12;n.beginPath(),n.moveTo(h,_),n.lineTo(m,_),n.arcTo(d,_,d,u,2),n.lineTo(d,f),n.arcTo(d,p,m,p,2),n.lineTo(h,p),n.arcTo(c,p,c,f,2),n.lineTo(c,u),n.arcTo(c,_,h,_,2),n.fillStyle=s,n.fill(),n.fillStyle=i,n.fillText(e,h,.5*(_+p))}}},function(t,e,i){const s=i(370),{FilterHelper:n}=i(357),{b2Vec2:o,b2Body:r,b2Fixture:a,b2Contact:l,b2Manifold:h,b2ContactImpulse:c,b2ContactListener:_}=s;window.$box2d=s;let u=new o;r.prototype.$type=null,r.prototype.Step=function(t){if(this._on_step)for(let e of this._on_step)e(t)},r.prototype.AfterStep=function(t){if(this._on_after_step)for(let e of this._on_after_step)e(t)},r.prototype.addStep=function(t){this._on_step=this._on_step||[],this._on_step.push(t)},r.prototype.addAfterStep=function(t){this._on_after_step=this._on_after_step||[],this._on_after_step.push(t)},r.prototype.SetLinearVelocity2=function(t,e){u.x=t,u.y=e,this.SetLinearVelocity(u,!0)},r.prototype.ApplyForceToCenter2=function(t,e){u.x=t,u.y=e,this.ApplyForceToCenter(u,!0)},r.prototype.ApplyLinearImpulseToCenter2=function(t,e){u.x=t,u.y=e,this.ApplyLinearImpulseToCenter(u,!0)},r.prototype.Acceleration=function(t,e,i){i||(i=this.GetWorldCenter());let s=o.SubVV(t,e,u),n=this.GetMass(),r=n*s.x,a=n*s.y,l=u.Set(r,a);this.ApplyLinearImpulse(l,i,!0)},r.prototype.AccelerationX=function(t,e,i){i||(i=this.GetWorldCenter());let s=t-e.x,n=this.GetMass()*s,o=u.Set(n,0);this.ApplyLinearImpulse(o,i,!0)},r.prototype.AccelerationY=function(t,e,i){i||(i=this.GetWorldCenter());let s=t-e.y,n=this.GetMass()*s,o=u.Set(0,n);this.ApplyLinearImpulse(o,i,!0)},r.prototype.ConstantVelocity=function(t,e){this.Acceleration(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},r.prototype.ConstantVelocity2=function(t,e,i,s){const n=new o(t,e),r=new o(i,s),a=this.GetLinearVelocity(),l=this.GetMass();let h=new o,c=o.SubVV(n,a,h);h.x=l*c.x,h.y=l*c.y,this.ApplyLinearImpulse(h,r,!0)},r.prototype.ConstantVelocityWorldCenter2=function(t,e){const i=new o(t,e),s=this.GetLinearVelocity(),n=this.GetMass();let r=new o,a=o.SubVV(i,s,r);r.x=n*a.x,r.y=n*a.y,this.ApplyLinearImpulseToCenter(r,!0)},r.prototype.ConstantVelocityX=function(t,e){this.AccelerationX(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},r.prototype.ConstantVelocityY=function(t,e){this.AccelerationY(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},a.prototype.beginContact=function(t,e,i){},a.prototype.endContact=function(t,e,i){},a.prototype.preSolve=function(t,e,i,s){},a.prototype.postSolve=function(t,e,i,s){},a.prototype.getOwnerID=function(){let t=this.GetUserData();if(t&&t.owner)return t.owner.id};t.exports=Object.assign(s,{FixtureContactListener:class{beginContact(t,e,i){}endContact(t,e,i){}preSolve(t,e,i,s){}postSolve(t,e,i,s){}},FilterHelper:n})},function(t,e,i){"use strict";i.r(e),i.d(e,"FilterHelper",function(){return a});var s=i(361),n=i(370);let o={},r=1;class a extends s.a{ignore(t){let e=o["s_"+t];this.maskBits=(this.maskBits&~e.categoryBits)>>>0,e.maskBits=(e.maskBits&~this.categoryBits)>>>0}addCategory(t){let e=o["s_"+t];this.categoryBits=this.categoryBits|e.categoryBits}static get(t,e){let i=o["s_"+t];if(e){let t=o["s_"+e];console.warn("filter: "+e+"%o",t)}return i}static registerCategory(t){let e=o["s_"+t]=new a;return e.groupIndex=0,e.categoryBits=r,e.maskBits=4294967295,e.name=t,r<<=1,e}static get next_category(){return o}static get filter_preset(){return o}}const l=[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,1,1,0,1,1,1],[1,0,0,1,0,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0],[1,1,0,0,0,0,1,0,0,0,0,0],[1,1,0,0,1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,0,0,1,0,0,0,0,0]];!function(){let t=[a.registerCategory("default"),a.registerCategory("body"),a.registerCategory("foothold"),a.registerCategory("foot"),a.registerCategory("bullet"),a.registerCategory("pvp_bullet"),a.registerCategory("mob"),a.registerCategory("mob_bullet"),a.registerCategory("portal"),a.registerCategory("ladder"),a.registerCategory("map_obj"),a.registerCategory("map_border")];for(let e=0;e<l.length;++e)for(let i=0;i<l[e].length;++i)l[e][i]||(t[e].maskBits=(t[e].maskBits&~(1<<i))>>>0)}(),function(){let t=new n.b2ContactFilter;function e(t){return{GetFilterData:()=>a.get(t),GetBody:()=>({GetType:()=>2,ShouldCollideConnected:()=>!0})}}t.ShouldCollide(e("body"),e("ladder")),t.ShouldCollide(e("ladder"),e("body")),t.ShouldCollide(e("foot"),e("portal")),t.ShouldCollide(e("portal"),e("foot"))}()},,function(t,e,i){"use strict";i.d(e,"a",function(){return _});var s=i(356),n=(i(379),i(371)),o=i(380),r=i(354),a=i(381),l=(i(336),i(332),i(357));window.$gravityAcc=2e3,window.$positionIterations=3,window.$velocityIterations=8,window.$particleIterations=1,window.$particleRadius=10;const h=new s.b2Vec2(0,window.$gravityAcc/$gv.CANVAS_SCALE);class c extends s.b2ContactListener{BeginContact(t){const e=t.m_fixtureA,i=t.m_fixtureB,s=t.m_indexA,n=t.m_indexB;e.beginContact.call(e.m_userData,t,e,i,s,n),i.beginContact.call(i.m_userData,t,i,e,n,s)}EndContact(t){const e=t.m_fixtureA,i=t.m_fixtureB,s=t.m_indexA,n=t.m_indexB;e.endContact.call(e.m_userData,t,e,i,s,n),i.endContact.call(i.m_userData,t,i,e,n,s)}PreSolve(t,e){const i=t.m_fixtureA,s=t.m_fixtureB,n=t.m_indexA,o=t.m_indexB;i.preSolve.call(i.m_userData,t,e,i,s,n,o),s.preSolve.call(s.m_userData,t,e,s,i,o,n)}PostSolve(t,e){const i=t.m_fixtureA,s=t.m_fixtureB,n=t.m_indexA,o=t.m_indexB;i.postSolve.call(i.m_userData,t,e,i,s,n,o),s.postSolve.call(s.m_userData,t,e,s,i,o,n)}}class _ extends s.b2World{constructor(){super(h),this.m_debugDraw=$gv.m_debugDraw,this.SetDebugDraw(this.m_debugDraw),this.SetContactListener(new c),this.ground=new n.a,this.ladderRope=[],this.mapBound_body=null,this.stop=!1,this.$_mouseJoint=null,this._onceAfterStep=[],this._destryBodyList=[],this._DestroyBody=this.DestroyBody,this.DestroyBody=(t=>{this.m_locked?this._destryBodyList.push(t):this._DestroyBody(t)}),this.draw_foothold_path_count=1}$test_b2ParticleSystem(){const t=s.b2ParticleFlag.b2_elasticParticle,e=new s.b2ParticleSystemDef;this.m_particleSystem=this.CreateParticleSystem(e),this.m_particleSystem.SetGravityScale(0),this.m_particleSystem.SetRadius(10/$gv.CANVAS_SCALE),this.m_particleSystem.SetDamping(.2);{const e=new s.b2CircleShape;e.m_p.Set(0,2),e.m_radius=3;const i=new s.b2ParticleGroupDef;i.flags=t,i.shape=e;const n=this.m_particleSystem.CreateParticleGroup(i);i.flags&s.b2ParticleFlag.b2_colorMixingParticle&&this.ColorParticleGroup(n,0)}window.m_particleSystem=this.m_particleSystem,this.$vbo_ps=null}async load(t){this.ground.load(t,this),this.ladderRope=o.a.load(t,this)}unload(){this.IsLocked()?console.error("world is locked, world can not unload"):(this.ground.unload(this),this.ladderRope.length=0,this.DestroyBody(this.mapBound_body))}createMob(t){let e=new a.a(t);return e._create(this),e}destroyMob(t){return t.$physics._destroy(this),t.$physics=null,!0}createNpc(t){return null}destroyNpc(t){return!1}createPortal(t){const e=t.compute_rectangle(0);if(e){const i=e.width/2/$gv.CANVAS_SCALE*.4,n=e.height/2/$gv.CANVAS_SCALE*.2;let o,r=new s.b2BodyDef,a=new s.b2FixtureDef;a.filter.Copy(l.FilterHelper.get("portal")),r.userData=t,r.type=s.b2BodyType.b2_staticBody,r.position.Set(t.x/$gv.CANVAS_SCALE,t.y/$gv.CANVAS_SCALE);let h=this.CreateBody(r);h.$type="portal",o=new s.b2PolygonShape,window.MAP_PORTAL_FULL_SIZE?o.SetAsBox(e.width/2/$gv.CANVAS_SCALE,e.height/2/$gv.CANVAS_SCALE,new s.b2Vec2(-t.textures[0].x/$gv.CANVAS_SCALE,-t.textures[0].y/$gv.CANVAS_SCALE),0):o.SetAsBox(i,n,new s.b2Vec2(0,-n),0),a.isSensor=!0,a.shape=o,a.filter=l.FilterHelper.get("portal"),a.userData=t,a.$type="portal";h.CreateFixture(a);return t.body=h,h}}_createMapBound(t){let{left:e,top:i,right:n,bottom:o}=t;e/=$gv.CANVAS_SCALE,n/=$gv.CANVAS_SCALE,i/=$gv.CANVAS_SCALE,o/=$gv.CANVAS_SCALE;let r=new s.b2BodyDef,a=new s.b2FixtureDef,h=new s.b2EdgeShape;a.$type="MapBorder",a.shape=h,a.filter.Copy(l.FilterHelper.get("map_border"));let c=this.CreateBody(r);c.$type="MapBorder",h.m_vertex1.Set(e,i),h.m_vertex2.Set(n,i),c.CreateFixture(a),h.m_vertex1.Set(e,o),h.m_vertex2.Set(n,o),c.CreateFixture(a),h.m_vertex1.Set(e,i),h.m_vertex2.Set(e,o),c.CreateFixture(a),h.m_vertex1.Set(n,i),h.m_vertex2.Set(n,o),c.CreateFixture(a),this.player&&this.player.setPosition(.5*(n+e),.5*(o+i),!0),this.mapBound_body=c}$createPlayer(t,e){t&&e||alert("$createPlayer(sceneObject, renderer)");let i=new r.a;return i._create(this),i.chara=t,i.renderer=e,this.player=i,i}$createRemotePlayer(t,e){t&&e||alert("$createRemotePlayer(sceneObject, renderer)");let i=new r.b;return i._create(this),i.renderer=e,i}onceUnlock(t){this.m_locked?this._onceAfterStep.push(t):t()}doAfterStep(t){this._onceAfterStep.push(t)}$_mouseDown(t){if(null!=this.$_mouseJoint)return;let e=new s.b2AABB,i=new s.b2Vec2;i.Set(.001,.001),s.b2Vec2.SubVV(t,i,e.lowerBound),s.b2Vec2.AddVV(t,i,e.upperBound);let n=null;if(this.QueryAABB(function(e){if(e.GetBody().GetType()!=s.b2BodyType.b2_staticBody){if(e.TestPoint(t))return n=e,!1}return!0},e),n){let e=n.GetBody(),i=new s.b2MouseJointDef;i.bodyA=this.ground.bodies[0],i.bodyB=e,i.target.Copy(t),i.maxForce=1e3*e.GetMass(),this.$_mouseJoint=this.CreateJoint(i),e.SetAwake(!0)}}$_mouseUp(t){this.$_mouseJoint&&(this.DestroyJoint(this.$_mouseJoint),this.$_mouseJoint=null)}$_mouseMove(t){this.$_mouseJoint&&this.$_mouseJoint.SetTarget(t)}$_onMouseEvent(){const t=($gv.m_viewRect.left+$gv.mouse_x)/$gv.CANVAS_SCALE,e=($gv.m_viewRect.top+$gv.mouse_y)/$gv.CANVAS_SCALE,i=new s.b2Vec2(t,e);$gv.mouse_dl&&this.$_mouseDown(i),$gv.mouse_ul&&($gv.mouse_ul=0,this.$_mouseUp(i)),$gv.mouse_move&&($gv.mouse_move=0,this.$_mouseMove(i))}update(t){if(!this.stop){this.$_onMouseEvent();for(let e=this.GetBodyList();e;e=e.m_next)e.Step(t);super.Step(1/$gv.MAX_FPS,window.$velocityIterations,window.$positionIterations,window.$particleIterations);for(let e=this.GetBodyList();e;e=e.m_next)e.AfterStep(t);this._onceAfterStep&&(this._onceAfterStep.forEach(t=>t()),this._onceAfterStep.length=0),this._destryBodyList&&(this._destryBodyList.forEach(t=>this._DestroyBody(t)),this._destryBodyList.length=0)}}render(t){const e=t.ctx,i=window.chara?window.chara.$physics:this.player;if($gv.m_display_physics_debug){const t=this.m_debugDraw;this.m_debugDraw.m_ctx=e;e.canvas.width,e.canvas.height;if(e.save(),e.scale(t.canvasScale,t.canvasScale),e.lineWidth/=t.canvasScale,e.scale(t.viewZoom,t.viewZoom),e.lineWidth/=t.viewZoom,this.DrawDebugData(),i&&i.body){const t=i.getPosition();e.fillStyle="#F00A",i.state.front>0?e.fillRect(t.x,t.y,1,1):i.state.front<0?e.fillRect(t.x-1,t.y,1,1):e.fillRect(t.x-.5,t.y,1,1)}e.restore()}if($gv.m_display_particleSystem)if(t.gl){const t=this.gl;if(this.$vbo_ps){const e=this.m_particleSystem.GetParticleCount(),i=this.m_particleSystem.GetPositionBuffer();let s=new Float32Array(2*e);for(let t=0;t<e;t+=2)s[t+0]=i[t].x,s[t+1]=i[t].y;t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW)}else{let e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e);const i=this.m_particleSystem.GetParticleCount(),s=this.m_particleSystem.GetPositionBuffer();let n=new Float32Array(2*i);for(let t=0;t<i;t+=2)n[t+0]=s[t].x,n[t+1]=s[t].y;t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW),this.$vbo_ps=e}for(let e=this.m_particleSystem.m_groupList;e;e=e.m_next){let i=e.GetParticleCount(),s=e.GetBufferIndex();t.drawArrays(t.POINTS,s,i)}}else if(e)if($gv.func)$gv.func.call(this,e,t);else{const i=this.m_particleSystem.m_positionBuffer.data;this.m_particleSystem.m_colorBuffer.data,this.m_particleSystem.m_weightBuffer.data;t.pushMatrix();const s=window.$particleRadius,n=2*s;if(!this.$particle_grd){let t=e.createRadialGradient(s,s,0,s,s,n);t.addColorStop(0,"#0744"),t.addColorStop(1,"#07440"),this.$particle_grd=t}for(let o=this.m_particleSystem.m_groupList;o;o=o.m_next)for(let r=o.m_firstIndex;r<o.m_lastIndex;++r){let o=i[r].x*$gv.CANVAS_SCALE-s,a=i[r].y*$gv.CANVAS_SCALE-s;t.setTransform(1,0,0,1,$gv.m_viewRect.left+o,$gv.m_viewRect.top+a),e.beginPath(),e.fillStyle=this.$particle_grd,e.fillRect(s,s,2*n,2*n)}t.popMatrix()}if($gv.m_display_foothold){let s,n;if(e.save(),this.ground.$drawDebugInfo(t),i&&i._foothold&&i._foothold.$drawDebugInfo2(t,"#FF0"),i&&(s=i.$foothold,n=i.ladder),s&&this.draw_foothold_path_count){s.$drawDebugInfo2(t,"#F00");let n=this.draw_foothold_path_count;if(e.lineWidth=2.5,e.strokeStyle="#00FE",i.state.front>0)for(s=this.ground.footholds[s.next];s&&(s._drawLine(e),!(--n<=0));s=this.ground.footholds[s.next]);else if(i.state.front<0)for(s=this.ground.footholds[s.prev];s&&(s._drawLine(e),!(--n<=0));s=this.ground.footholds[s.prev]);}this.ladderRope.forEach(t=>{const i=t.calcWidth();e.beginPath(),e.rect(t.x-.5*i,t.y1,i,t.y2-t.y1),e.fillStyle=t==n?"#E117":"#EB17",e.fill()}),e.restore()}}}},function(t,e,i){"use strict";i.d(e,"d",function(){return o}),i.d(e,"f",function(){return r}),i.d(e,"b",function(){return a}),i.d(e,"c",function(){return l}),i.d(e,"h",function(){return h}),i.d(e,"i",function(){return c}),i.d(e,"j",function(){return _}),i.d(e,"k",function(){return u}),i.d(e,"g",function(){return m}),i.d(e,"e",function(){return d}),i.d(e,"a",function(){return w});var s=i(345),n=i(346);class o{constructor(){this.m_buffer=n.A.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}GetSupport(t){let e=0,i=n.A.DotVV(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.A.DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e}GetSupportVertex(t){let e=0,i=n.A.DotVV(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.A.DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}class r{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}class a{constructor(){this.proxyA=new o,this.proxyB=new o,this.transformA=new n.z,this.transformB=new n.z,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}class l{constructor(){this.pointA=new n.A,this.pointB=new n.A,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}let h=0,c=0,_=0;function u(){h=0,c=0,_=0}class m{constructor(){this.wA=new n.A,this.wB=new n.A,this.w=new n.A,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class d{constructor(){this.m_v1=new m,this.m_v2=new m,this.m_v3=new m,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}ReadCache(t,e,i,o,r){this.m_count=t.count;const a=this.m_vertices;for(let s=0;s<this.m_count;++s){const l=a[s];l.indexA=t.indexA[s],l.indexB=t.indexB[s];const h=e.GetVertex(l.indexA),c=o.GetVertex(l.indexB);n.z.MulXV(i,h,l.wA),n.z.MulXV(r,c,l.wB),n.A.SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){const e=t.metric,i=this.GetMetric();(i<.5*e||2*e<i||i<s.r)&&(this.m_count=0)}if(0===this.m_count){const t=a[0];t.indexA=0,t.indexB=0;const s=e.GetVertex(0),l=o.GetVertex(0);n.z.MulXV(i,s,t.wA),n.z.MulXV(r,l,t.wB),n.A.SubVV(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const e=this.m_vertices;for(let i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return n.A.NegV(this.m_v1.w,t);case 2:{const e=n.A.SubVV(this.m_v2.w,this.m_v1.w,t);return n.A.CrossVV(e,n.A.NegV(this.m_v1.w,n.A.s_t0))>0?n.A.CrossOneV(e,t):n.A.CrossVOne(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return n.A.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return n.A.CrossVV(n.A.SubVV(this.m_v2.w,this.m_v1.w,n.A.s_t0),n.A.SubVV(this.m_v3.w,this.m_v1.w,n.A.s_t1));default:return 0}}Solve2(){const t=this.m_v1.w,e=this.m_v2.w,i=n.A.SubVV(e,t,d.s_e12),s=-n.A.DotVV(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);const o=n.A.DotVV(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const r=1/(o+s);this.m_v1.a=o*r,this.m_v2.a=s*r,this.m_count=2}Solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=n.A.SubVV(e,t,d.s_e12),o=n.A.DotVV(t,s),r=n.A.DotVV(e,s),a=-o,l=n.A.SubVV(i,t,d.s_e13),h=n.A.DotVV(t,l),c=n.A.DotVV(i,l),_=-h,u=n.A.SubVV(i,e,d.s_e23),m=n.A.DotVV(e,u),p=n.A.DotVV(i,u),f=-m,y=n.A.CrossVV(s,l),g=y*n.A.CrossVV(e,i),v=y*n.A.CrossVV(i,t),x=y*n.A.CrossVV(t,e);if(a<=0&&_<=0)return this.m_v1.a=1,void(this.m_count=1);if(r>0&&a>0&&x<=0){const t=1/(r+a);return this.m_v1.a=r*t,this.m_v2.a=a*t,void(this.m_count=2)}if(c>0&&_>0&&v<=0){const t=1/(c+_);return this.m_v1.a=c*t,this.m_v3.a=_*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(r<=0&&f<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(c<=0&&p<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(p>0&&f>0&&g<=0){const t=1/(p+f);return this.m_v2.a=p*t,this.m_v3.a=f*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const b=1/(g+v+x);this.m_v1.a=g*b,this.m_v2.a=v*b,this.m_v3.a=x*b,this.m_count=3}}d.s_e12=new n.A,d.s_e13=new n.A,d.s_e23=new n.A;const p=new d,f=[0,0,0],y=[0,0,0],g=new n.A,v=new n.A,x=new n.A,b=new n.A,A=new n.A;function w(t,e,i){++h;const o=i.proxyA,r=i.proxyB,a=i.transformA,l=i.transformB,u=p;u.ReadCache(e,o,a,r,l);const m=u.m_vertices,d=f,w=y;let S=0,C=s.x,B=C,V=0;for(;V<20;){S=u.m_count;for(let t=0;t<S;++t)d[t]=m[t].indexA,w[t]=m[t].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3()}if(3===u.m_count)break;C=B=u.GetClosestPoint(g).LengthSquared();const t=u.GetSearchDirection(v);if(t.LengthSquared()<s.s)break;const e=m[u.m_count];e.indexA=o.GetSupport(n.t.MulTRV(a.q,n.A.NegV(t,n.A.s_t0),b)),n.z.MulXV(a,o.GetVertex(e.indexA),e.wA),e.indexB=r.GetSupport(n.t.MulTRV(l.q,t,A)),n.z.MulXV(l,r.GetVertex(e.indexB),e.wB),n.A.SubVV(e.wB,e.wA,e.w),++V,++c;let i=!1;for(let t=0;t<S;++t)if(e.indexA===d[t]&&e.indexB===w[t]){i=!0;break}if(i)break;++u.m_count}if(_=Object(n.m)(_,V),u.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.A.DistanceVV(t.pointA,t.pointB),t.iterations=V,u.WriteCache(e),i.useRadii){const e=o.m_radius,i=r.m_radius;if(t.distance>e+i&&t.distance>s.r){t.distance-=e+i;const s=n.A.SubVV(t.pointB,t.pointA,x);s.Normalize(),t.pointA.SelfMulAdd(e,s),t.pointB.SelfMulSub(i,s)}else{const e=n.A.MidVV(t.pointA,t.pointB,g);t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0}}}},function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"c",function(){return l}),i.d(e,"d",function(){return h}),i.d(e,"b",function(){return c});var s=i(345),n=i(346),o=i(347),r=i(348);class a{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}Clone(){return(new a).Copy(this)}Copy(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex,this}}class l{constructor(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new a}}class h{constructor(t){this.aabb=new o.a,this.childIndex=0,this.treeNode=null,this.fixture=t}}class c{constructor(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=null,this.m_proxyCount=0,this.m_filter=new a,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.Copy(t),this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){if(this.m_body)return;let t=this.m_body.GetContactList();for(;t;){const e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}const e=this.m_body.GetWorld();if(null===e)return;const i=e.m_contactManager.m_broadPhase;for(let t=0;t<this.m_proxyCount;++t)i.TouchProxy(this.m_proxies[t].treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}ComputeDistance(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}RayCast(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}GetMassData(t=new r.a){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetAABB(t){return this.m_proxies[t].aabb}Dump(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}Create(t){this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_next=null,this.m_filter.Copy(t.filter),this.m_isSensor=t.isSensor,this.m_proxies=Object(s.e)(this.m_shape.GetChildCount(),t=>new h(this)),this.m_proxyCount=0,this.m_density=t.density}Destroy(){}CreateProxies(t,e){this.m_proxyCount=this.m_shape.GetChildCount();for(let i=0;i<this.m_proxyCount;++i){const s=this.m_proxies[i]=new h(this);this.m_shape.ComputeAABB(s.aabb,e,i),s.treeNode=t.CreateProxy(s.aabb,s),s.childIndex=i}}DestroyProxies(t){for(let e=0;e<this.m_proxyCount;++e){const i=this.m_proxies[e];i.treeNode.userData=null,t.DestroyProxy(i.treeNode),i.treeNode=null}this.m_proxyCount=0}Synchronize(t,e,i){if(0!==this.m_proxyCount)for(let s=0;s<this.m_proxyCount;++s){const o=this.m_proxies[s],r=c.Synchronize_s_aabb1,a=c.Synchronize_s_aabb2;this.m_shape.ComputeAABB(r,e,s),this.m_shape.ComputeAABB(a,i,s),o.aabb.Combine2(r,a);const l=n.A.SubVV(i.p,e.p,c.Synchronize_s_displacement);t.MoveProxy(o.treeNode,o.aabb,l)}}}c.Synchronize_s_aabb1=new o.a,c.Synchronize_s_aabb2=new o.a,c.Synchronize_s_displacement=new n.A},,function(t,e,i){"use strict";i.d(e,"a",function(){return s}),i.d(e,"b",function(){return o}),i.d(e,"c",function(){return r});i(378),i(355);class s{constructor(){this.allAttack=[],this.skill=null}}const n=Symbol("targetObject");class o{constructor(){this[n]=null,this.allDamage=[]}getTargetObject(){return this[n]}setTargetObject(t){this[n]=t}get objectid(){return this[n].$objectid}set objectid(t){if(Number.isSafeInteger(t)){let e=scene_map.lifeMgr.entities[t];this.setTargetObject(e)}}addDamage(t,e){this.allDamage.push(new r(t,e))}}class r{constructor(t,e){this.realDamage=t,this.critical=e}_validating(){return Number.isSafeInteger(this.realDamage)}_draw(t){const e=t.ctx;Number.isSafeInteger(this.realDamage)||(e.filter="gray-scale(1)",e.filter="none")}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});i(332);class s{constructor(t){this.opacity=t&&t.opacity||1}clone(){return new s(this)}mul(t){return t?new s({opacity:this.opacity*t.opacity}):this.clone()}selfMultiply(t){t&&(this.opacity,t.opacity)}}},function(t,e,i){"use strict";var s=i(338),n=i(333),o=i(332),r=(i(335),i(349)),a=i(368);window.MobAnimationSpeed=1,window.$mob_name={};class l extends a.a{constructor(){super()}static get __info(){return{noFlip:1,level:230,maxHP:"??????",maxMP:1e5,speed:0,PADamage:22e3,PDRate:300,MADamage:24e3,MDRate:30,acc:9999,eva:750,pushed:1e9,fs:10,summonType:1,category:1,elemAttr:"P2H2F2I2S2L2D2",mobType:"3N",firstAttack:1,hideHP:1,boss:1,hpTagColor:1,hpTagBgcolor:5,showNotRemoteDam:1,defaultHP:"측정불가",defaultMP:"측정불가",ignoreMoveImpact:1}}static async loadDescription(t){if(!l._desc[t]){let e=[l._get_desc_base_path(),Number(t)].join("/"),i=await $get.data(e);return l._desc[t]=i,i}return l._desc[t]}async load(t){return await super.load.apply(this,arguments)}isFlyMob(){return!!this._raw.flySpeed}_getFirstAttackName(){return"skill"+this._raw.info.firstAttack}update(t){t*=window.MobAnimationSpeed,super.update(t)}static get _animations(){return['"stand"','"fly"','"move"','"jump"',"`hit${$index}`","`die${$index}`","`skill${$index}`"]}static _get_desc_base_path(){return"/String/Mob"}static get _base_path(){return"/Mob"}}l._desc={},window.NpcAnimationSpeed=1;class h extends a.a{constructor(){super()}static async loadDescription(t){if(!h._desc[t]){let e=[h._get_desc_base_path(),Number(t)].join("/"),i=await $get.data(e);return h._desc[t]=i,i}return h._desc[t]}update(t){t*=window.NpcAnimationSpeed,super.update(t)}static get _animations(){return['"stand"']}static _get_desc_base_path(){return"/String/Npc"}static get _base_path(){return"/Npc"}}function c(t,e){return t-e+Math.random()*e*2}function _(t,e){const i=o.ColorRGB.fromInt24(t),s=o.ColorRGB.fromInt24(e),n=Math.max(0,Math.min(c(i.r,s.r),255)),r=Math.max(0,Math.min(c(i.g,s.g),255)),a=Math.max(0,Math.min(c(i.b,s.b),255));return new o.ColorRGB(n,r,a)}h._desc={};class u{constructor(t){this._initParam(t),this.life=0,this.pos=new n.Vec2(0,0),this.opacity=1,this.scale=this.startScale,this.color=new o.ColorRGB(255,255,255)}_initParam(t){this.lifeMax=c(t.life,t.lifeVar);const e=c(t.angle,t.angleVar)*Math.PI/180;this.startColor=_(t.startColor,t.startColorVar),this.color_d=_(t.endColor,t.endColorVar).selfSub(this.startColor);const i=Math.max(1,t.texture.width),s=Math.max(1,t.texture.height),o=1==i?s:1==s?1:Math.min(i,s);this.startScale=c(t.startSize,t.startSizeVar)/o;const r=c(t.endSize,t.endSizeVar)/o;if(this.scale_d=r-this.startScale,this.startX=c(t.posX,t.posVarX),this.startY=c(t.posY,t.posVarY),this.emitterMode=t.emitterType?1:0,this.emitterMode)1==this.emitterMode&&alert("Particle.EMITTER_MODE.RADIUS");else{this.gravity=new n.Vec2(t.GRAVITY.x,t.GRAVITY.y);const i=c(t.GRAVITY.speed,t.GRAVITY.speedVar);this.dir=new n.Vec2(Math.cos(e)*i,-Math.sin(e)*i),this.radialAccel=c(t.GRAVITY.radialAccel||0,t.GRAVITY.radialAccelVar||0),this.tangentialAccel=c(t.GRAVITY.tangentialAccel||0,t.GRAVITY.tangentialAccelVar||0),this.rotationIsDir=!!t.GRAVITY.rotationIsDir}}update(t){const e=t/1e3,i=Math.max(0,Math.min(this.life/this.lifeMax,1));{let t,i=(t=this.pos.x||this.pos.y?new n.Vec2(this.pos.x,this.pos.y).normalize():new n.Vec2(0,0)).clone();t=t.mul(this.radialAccel);let s=i.x;i.x=-i.y,i.y=s,i=i.mul(this.tangentialAccel);let o=t.add(i);o=(o=o.add(this.gravity)).mul(e),this.dir=this.dir.add(o);let r=this.dir.mul(e);this.pos=this.pos.add(r)}this.scale=Math.max(0,this.startScale+this.scale_d*i),this.color=o.ColorRGB.add(this.startColor,o.ColorRGB.scale(this.color_d,i)),this.opacity=1-i,this.life+=t}isEnd(){return this.life>=this.lifeMax}draw(t,e,i,s){const n=this.scale,o=this.startX+this.pos.x+i,r=this.startY+this.pos.y+s;t.globalAlpha=this.opacity;let a=this.color.toHSV();t.drawColoredGraph2(e,o,r,n,n,a)}}class m{constructor(){this.GRAVITY=new n.Vec2,this.life=0,this.lifeVar=0,this.duration=0,this.totalParticle=0}}class d extends m{constructor(){super(),this.x=0,this.y=0,this.particles=[],this.time=0,this.delta=0,this.delay=1/0,this.duration=-1}clone(){let t=new d;return Object.assign(t,this),t.particles=[],t.time=0,t.delta=0,t}evaluate(){let t=this.totalParticle*this.delay;for(let e=0;e<this.totalParticle;++e){const i=new u(this),s=t-e*this.delay;i.life+=s,i.update(s),i.life=s,this.particles.push(i)}}async load(t){this.particleName=t;let e=await $get.data(this._particle_path);if(Object.assign(this,e),this.GRAVITY.x=e.GRAVITY.x,this.GRAVITY.y=e.GRAVITY.y,this.life=1e3*e.life,this.lifeVar=1e3*e.lifeVar,this.duration=1e3*e.duration,this.delay=this.life/this.totalParticle,_experimental_particle){const t=this;return new Promise(function(i,s){let n=new Image;n.onload=function(){let s=new r.a(e.texture);!0===_experimental_particle?s._url=function(t){let e=new o.ImageDataHelper,i=e.imageToImagedata(t);for(let t=0;t<i.height;++t)for(let e=0;e<4*i.width;++e)i.data[t*i.width*4+4*e+1]=0,i.data[t*i.width*4+4*e+2]=0;return e.imagedataToDataURL(i)}(this):s._url="data:image/svg+xml;utf-8,"+encodeURIComponent(`\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${this.naturalWidth}" height="${this.naturalHeight}">\n\t<defs>\n\t\t<mask id="Mask">\n\t\t\t<image xlink:href="${new URL("images"+t._texture_base_path,window.location).href}"/>\n\t\t</mask>\n\t</defs>\n\t<g>\n\t\t<rect width="${this.naturalWidth}" height="${this.naturalHeight}" fill="red" mask="url(#Mask)"/>\n\t</g>\n</svg>`),t.texture=s,i()},n.src="images"+t._texture_base_path})}this.texture=new r.a(e.texture),this.texture._url="images"+this._texture_base_path}update(t){this.particles.length<this.totalParticle&&(!this.time||this.time>this.delay)&&(this.particles.push(new u(this)),this.time=0),this.particles=this.particles.filter(e=>!e.isEnd()&&(e.update(t),!0)),this.time+=t,this.delta+=t}isEnd(){return this.delta>this.duration&&-1!=this.duration}render(t,e,i,s){const n=t.ctx;t.ctx.setTransform(1,0,0,1,Math.trunc(-$gv.m_viewRect.x),Math.trunc(-$gv.m_viewRect.y)),6==this.blendFuncDst&&5==this.blendFuncSrc||(n.globalCompositeOperation="lighter");for(let n=0;n<this.particles.length;++n){const o=this.particles[n];if(!o.isEnd()){const n=this.x+i,r=this.y+s,a=this.texture.width*o.scale,l=this.texture.height*o.scale;e&&!e.collide4f2(n+o.startX+o.pos.x,r+o.startY+o.pos.y,a,l)||o.draw(t,this.texture,n,r)}}n.globalCompositeOperation="source-over",t.globalAlpha=1}get _particle_path(){return["/Effect/particle",this.particleName].join("/")}get _texture_base_path(){return[this._particle_path,"texture"].join("/")}}var p=i(359),f=(i(371),i(381),i(355));i.d(e,"a",function(){return P}),i.d(e,"b",function(){return $}),i.d(e,"c",function(){return R}),window.enable_skeletal_anim=!0;const y={Back:{},Obj:{},Tile:{}};async function g(t,e){if(!y[t][e]){let i=`/Map/${t}/${e}`;y[t][e]=await $get.data(i),null==y[t][e]&&console.warn("Empty package: "+i)}if(y[t][e])return y[t][e]}window.$map_sprite=y,$gv.allQuest={};class v extends r.a{constructor(t,e,i){super(t,e),i=i||v.raw_default,this.a0=this._get(-1,"a0",Number),this.a1=this._get(-1,"a1",Number),this.movetype=this._get(i.movetype,"moveType",Number),this.movew=this._get(i.movew,"moveW",Number),this.moveh=this._get(i.moveh,"moveH",Number),this.movep=this._get(i.movep,"moveP",Number),this.mover=this._get(i.mover,"moveR",Number)}draw(t,e,i,s,n,o){let r=n/this.delay,a=0<=this.a0||0<=this.a1?(0>this.a0?0:this.a0)*(1-r)+(0>this.a1?0:this.a1)*r:255,l=0;switch(this.movetype){case 1:i+=this.movew*Math.sin(0==this.movep?o/1e3:2*o*Math.PI/this.movep);break;case 2:s+=this.moveh*Math.sin(0==this.movep?o/1e3:2*o*Math.PI/this.movep);break;case 3:0!=this.mover&&(l=o/this.mover)}t.ctx;t.loadIdentity(),t.translate(Math.trunc(.5-$gv.m_viewRect.x),Math.trunc(.5-$gv.m_viewRect.y)),t.globalAlpha=Math.max(0,Math.min(a/255,1)),t._drawRotaGraph(this,i,s,l,e)}}v.raw_default={a0:-1,a1:-1,movetype:0,movew:0,moveh:0,movep:0,mover:0};class x{constructor(t){null==t&&console.error(t),this._raw=t,this.textures=[],this.frame=0,this.time=0,this.delta=0,this.quest=t.quest;for(let e in t.quest)$gv.allQuest[e]||($gv.allQuest[e]=new Set),$gv.allQuest[e].add(t.quest[e]);this._load_object_info(),this._load_back_info(),this._load_tile_info(),this.aabb=null,this.display_aabb=!1,this.aabb_color=null}_load_object_info(){this.type=this._get(0,"sign",Number),this.x=this._get(0,"x",Number),this.y=this._get(0,"y",Number),this.z=this._get(0,"z",Number),this.zM=this._get(0,"zM",Number),this.f=this._get(0,"f",Number),this.name=this._raw.name,this._url=null}_load_back_info(){this.typeb=this._get(0,"type",Number),(this.typeb<0||this.typeb>7)&&(alert("MapBackBase.typeb: "+this.typeb),console.warn("MapBackBase.typeb: "+this.typeb)),this.a=this._get(0,"a",Number),this.rx=this._get(0,"rx",Number),this.ry=this._get(0,"ry",Number),this.cx=this._get(0,"cx",Number),this.cy=this._get(0,"cy",Number),this.backTags=this._raw.backTags}_load_tile_info(){this.flow=this._get(0,"flow",Number),1&this.flow&&!this.cx&&(this.cx=1e3),2&this.flow&&!this.cy&&(this.cy=1e3)}load(){let t=this._load_texture(0,null);this.textures[0]=t;for(let e=1;e in this._texture_raw;++e)this.textures[e]=this._load_texture(e,t);this.__calc_aabb()}_load_texture(){}unload(){this.textures=[]}__calc_aabb(){if(this.textures.length>=1){let t=0;for(let e=0;e<this.textures.length;++e){t|=this.textures[e].mover}const e=this.compute_max_rectangle();if(t){const t=Math.round(Math.sqrt(e.width**2+e.height**2)),i=Math.round(.5*t);this.aabb=new n.Rectangle(this.x-i,this.y-i,t,t)}else this.aabb=e}}_get(t,e,i){return e in this._raw?i?i(this._raw[e]):this._raw[e]:t}update(t){const e=this.textures.length;e>1&&(this.time=this.time+t,this.time>this.textures[this.frame].delay&&(this.frame=++this.frame,this.time=0,this.frame>=e&&(this.frame=0))),this.delta+=t,$gv.m_editor_mode&&this.aabb&&this.$editor_mouse()}_update_and_preload(t){const e=this.textures.length;if(e>1){const i=this.textures[this.frame];this.time=this.time+t,i.isLoaded()||i.__loadTexture(),this.time>i.delay&&(this.frame=++this.frame,this.time=0,this.frame>=e&&(this.frame=0,delete this.update));const s=this.textures[this.frame+1];s&&!s.isLoaded()&&s.__loadTexture()}this.delta+=t,$gv.m_editor_mode&&this.aabb&&this.$editor_mouse()}$editor_mouse(){$gv.m_viewRect;const t=$gv.m_viewRect.left+$gv.mouse_x,e=$gv.m_viewRect.top+$gv.mouse_y;0==this.typeb&&this.aabb.collide4f2(t,e,1,1)?(this.display_aabb=!0,1!=$gv.mouse_dl||window.m_selected_object==this&&null!=window.m_selected_object?null==window.m_hover_object?(window.m_hover_object=this,this.aabb_color="rgba(0,255,0,0.25)"):this.aabb_color="rgba(0,0,255,0.25)":this.$select()):this.$unselect(),window.m_selected_object==this&&(this.display_aabb=!0,this.aabb_color="rgba(255,0,0,0.5)")}$select(){window.m_selected_object&&window.m_selected_object.$unselect(),window.m_selected_object=this,window.m_hover_object=null,$gv.mouse_dl=0}$unselect(){this.display_aabb=!1}$isRepeatX(){return 1==this.typeb||4==this.typeb}$isRepeatY(){return 2==this.typeb||5==this.typeb}compute_rectangle(t){const e=this.textures[t];if(e){const t=e.width,i=e.height;return new n.Rectangle(this.x-(this.f?-e.x+t:e.x),this.y-e.y,t,i)}}compute_max_rectangle(){if(this.textures.length>0){let{left:t,top:e,right:i,bottom:s}=this.compute_rectangle(0);for(let n=1;n<this.textures.length;++n){let o=this.compute_rectangle(n);t=Math.min(t,o.left),e=Math.min(e,o.top),i=Math.max(i,o.right),s=Math.max(s,o.bottom)}return n.Rectangle.parse(t,e,i,s)}return null}__draw_texture(t,e,i,s,n){if(0!=this.typeb||!this.aabb||this.aabb.collide(n)){let n=this.textures[e];if(e&&!n.isLoaded())for(let t=e-1;t>=0&&!(n=this.textures[e]).isLoaded();--t);n.draw(t,this.f,this.x+i,this.y+s,this.time,this.delta)}if($gv.m_display_selected_object&&$gv.m_editor_mode&&this.aabb&&this.display_aabb){const e=t.ctx,i=Math.trunc(.5-n.left+this.aabb.left),s=Math.trunc(.5-n.top+this.aabb.top);t.loadIdentity(),t.globalAlpha=1,e.beginPath(),e.rect(i,s,this.aabb.width,this.aabb.height),e.fillStyle=this.aabb_color||"rgba(20,255,20,0.5)",e.fill(),e.lineWidth=3,e.setLineDash([3,3]),e.lineDashOffset=0,e.strokeStyle="rgba(0,0,0,0.5)",e.stroke(),e.setLineDash([3,3]),e.lineDashOffset=3,e.strokeStyle="rgba(255,255,255,0.5)",e.stroke(),e.setLineDash([]),e.lineWidth=1}}__draw(t,e,i,s){this.__draw_texture(t,this.frame,e,i,s)}_draw(t,e,i,s,n,o){let r=this.textures[this.frame];if(null==r)return;let{left:a,top:l,right:h,bottom:c}=o,_=this.x-(this.f?-r.x+r.width:r.x),u=this.y-r.y,m=0==this.cx?r.width:this.cx,d=0==this.cy?r.height:this.cy,p=a-(m+(a-s-_)%m),f=l-(d+(l-n-u)%d),y=h+(m-(h-s-_)%m),g=c+(d-(c-n-u)%d);if(e)if(i)for(let e=f;e<g;e+=d)for(let i=p;i<y;i+=m)this.__draw(t,i-_,e-u,o);else for(let e=p;e<y;e+=m)this.__draw(t,e-_,n,o);else if(i)for(let e=f;e<g;e+=d)this.__draw(t,s,e-u,o);else this.__draw(t,s,n,o)}draw(t,e,i){if(!this.textures.length)return;let s=(this.rx+100)*e.x/100,n=(this.ry+100)*e.y/100;switch(this.typeb){case 0:this._draw(t,!1,!1,s,n,i);break;case 1:this._draw(t,!0,!1,s,n,i);break;case 2:this._draw(t,!1,!0,s,n,i);break;case 3:this._draw(t,!0,!0,s,n,i);break;case 4:this._draw(t,!0,!1,Math.trunc(this.delta/200*this.rx),n,i);break;case 5:this._draw(t,!1,!0,s,Math.trunc(this.delta/200*this.ry),i);break;case 6:this._draw(t,!0,!0,Math.trunc(this.delta/200*this.rx),n,i);break;case 7:this._draw(t,!0,!0,s,Math.trunc(this.delta/200*this.ry),i)}}get _texture_base_path(){throw new Error("Not implement")}}class b extends x{constructor(t){super(t),null==this._raw.cx||this._raw.ry&&-100!=this._raw.ry||(this._raw.rx?//!= null && != 0
null!=this._raw.cy?this.typeb=6:this.typeb=4:this.typeb=1),null==this._raw.cy||this._raw.rx&&-100!=this._raw.rx||(this._raw.ry?//!= null && != 0
null!=this._raw.cx?this.typeb=7:this.typeb=5:this.typeb=2),this.update=this._update_and_preload}_load_texture(t,e){let i=["/Map","Obj",this._texture_base_path,t].join("/"),s=new v(this._texture_raw[t],void 0,e);return s._url=i,s}get _texture_base_path(){return[this._raw.oS,this._raw.l0,this._raw.l1,this._raw.l2].join("/")}get _texture_raw(){try{return y.Obj[this._raw.oS][this._raw.l0][this._raw.l1][this._raw.l2]}catch(t){}return null}}class A extends b{constructor(t){super(t),this.groups=[]}async load(t){let e=new d;await e.load(t);let i=Object.keys(this._raw).map(e=>{let i=parseInt(e,10);return Number.isSafeInteger(i)?i:(console.warn("MapParticle."+t+".id: "+e),null)}).filter(t=>null!=t);for(let t of i)this.groups[t]=e.clone(),this.groups[t].x=this._raw[t].x,this.groups[t].y=this._raw[t].y,this.groups[t].evaluate()}update(t){for(let e=0;e<this.groups.length;++e){this.groups[e].update(t)}}draw(t,e,i){for(let s=0;s<this.groups.length;++s){const n=this.groups[s];let o=(this.rx+100)*e.x/100,r=(this.ry+100)*e.y/100;n.render(t,i,o,r)}}static construct(t,e){let i=[],s=[];for(let e in t.particle){let n=t.particle[e],o=new A(n);i.push(o.load(e)),s.push(o)}return e.particleList=s,i}}class w extends b{constructor(t,e){super(t),this.ssanim=null,this._fname=null}get _folder(){const t=this._raw;return`/Map/Obj/${t.oS}/${t.l0}/${t.l1}/${t.l2}`}async load(){if(!SSAnim)return null;{const t=this._raw;let e;e=new SSAnim;try{await e.load(this._folder),e.update(0)}catch(t){return void console.error(t)}if(t.spineRandomStart){let t=e.anim_length*Math.random();e.setAnimTime(t)}const i=Math.round(Math.sqrt(e.width**2+e.height**2)),s=Math.round(.5*i);this.aabb=new n.Rectangle(this.x-s,this.y-s,i,i),this.ssanim=e}}unload(){this.ssanim&&(this.ssanim.unload(),this.ssanim=null)}update(t){this.delta+=t,this.ssanim&&window.enable_skeletal_anim&&this.ssanim.update(t)}draw(t,e,i){if($gv.m_display_skeletal_anim){const e=Math.trunc(.5-$gv.m_viewRect.x+this.x),i=Math.trunc(.5-$gv.m_viewRect.y+this.y);if(t.ctx.setTransform(1,0,0,-1,e,i),this.ssanim&&this.ssanim.render(),this.display_aabb){const e=t.ctx;t.ctx.setTransform(1,0,0,1,Math.trunc(.5-$gv.m_viewRect.x),Math.trunc(.5-$gv.m_viewRect.y)),e.beginPath(),e.rect(this.x-.5*this.ssanim.width,this.y-this.ssanim.height,this.ssanim.width,this.ssanim.height),e.fillStyle="rgba(20,255,20,0.5)",e.fill()}}}}class S extends b{constructor(t,e){super(t),this._info=e,this.update=this._update_and_preload}load(){let t=new v(this._texture_raw);this.textures[0]=t,this.textures[0]._url=["/Map","Tile",this._info.tS,this._raw.u,this._raw.no].join("/"),this.__calc_aabb()}get _texture_raw(){try{return y.Tile[this._info.tS][this._raw.u][this._raw.no]}catch(t){}return null}get _texture_base_path(){return[this._info.tS,this._raw.u,this._raw.no].join("/")}}class C extends b{constructor(t,e){super(t),this.mapRenderer=e,this.tm=null,this.tn=null,this.pn=null,this.script=null,this.enable=null,this.state=null,this.states=null,this.skin=null,this.update=this._update_and_preload}load(){this.tm=this._get("","tm",String).padStart(9,"0"),this.tn=this._get("","tn",String),this.pn=this._get("","pn",String),this.script=this._get(null,"script",String),this.enable=""!=this.tm&&"999999999"!=this.tm,this._loadTexture()}unload(){this.body&&(this.body.GetWorld().DestroyBody(this.body),this.body=null)}getMap(){if(this.enable)return this.tm}draw(t,e,i){this.enable?super.draw(t,e,i):this.__display_mode&&super.draw(t,e,i)}_loadTexture(){"game"==this.__display_mode?this.type="p":this.type="q";const t=C._portals_raw;this.textures.length=0;const e=C._type_map[this._raw.pt];if("editor"==this.__display_mode){let i=new v(t.editor[e]);i._url=[this._texture_base_path,this.__display_mode,e].join("/"),this.textures[0]=i}else if(t.game[e]){let i=null!=this.skin?this.skin:"default";if("0"in t.game[e][i]){let s=t.game[e][i];for(let t in s){let n=new v(s[t]);n._url=[this._texture_base_path,this.__display_mode,e,i,t].join("/"),this.textures.push(n)}}else{this.states=Object.keys(t.game[e][i]),this.state=this.states[1%this.states.length];let s=t.game[e][i][this.state];for(let t in s){let n=new v(s[t]);n._url=[this._texture_base_path,this.__display_mode,e,i,this.state,t].join("/"),this.textures.push(n)}}}this.delta=0,this.time=0,this.frame=0}get _texture_base_path(){return"/Map/MapHelper/portal"}get _getTexturePath(){return this.__display_mode,["/Map/MapHelper/portal",this.__display_mode].join("/")}get __display_mode(){return $gv.m_editor_mode?"editor":"game"}static async Init(){C._portals_raw=await $get.data("/Map/MapHelper/portal"),C._type_map=Object.keys(C._portals_raw.editor)}}C._portals_raw={},C._type_map={},C._script={};class B{constructor(){this.portals=null,this.__display_mode=this.__display_mode}async load(t,e){let i=[];for(let s=0;s in t.portal;++s){let n=t.portal[s],o=new C(n,e);o.load(),e.controller.createPortal(o),i.push(o)}this.portals=i}unload(){for(let t=0;t<this.portals.length;++t){this.portals[t].unload()}}update(t){if(this.__display_mode!=$gv.m_editor_mode){this.__display_mode=$gv.m_editor_mode;for(let e=0;e<this.portals.length;++e){let i=this.portals[e];i._loadTexture(),i.update(t)}}else for(let e=0;e<this.portals.length;++e){this.portals[e].update(t)}}draw(t,e,i){for(let s=0;s<this.portals.length;++s){this.portals[s].draw(t,e,i)}}}class V extends x{constructor(t){super(t)}}class M extends V{constructor(t){super(t),this.update=this._update_and_preload}load(){let t=["/Map","Back",this._texture_base_path].join("/");if(this._raw.bS){this._texture_raw&&(this.textures[0]=new v(this._texture_raw),this.textures[0]._url=t)}else console.warn("MapBack path ?: "+t)}get _texture_base_path(){return[this._raw.bS,"back",this._raw.no].join("/")}get _texture_raw(){return this._raw.bS&&this._raw.no?y.Back[this._raw.bS].back[this._raw.no]:null}}class k extends V{constructor(t){super(t),this.update=this._update_and_preload}_load_texture(t,e){let i=["/Map","Back",this._texture_base_path,t].join("/"),s=new v(this._texture_raw[t]);return s._url=i,s}get _texture_base_path(){return[this._raw.bS,"ani",this._raw.no].join("/")}get _texture_raw(){try{return y.Back[this._raw.bS].ani[this._raw.no]}catch(t){}return null}}class I extends V{constructor(t){super(t),this.ssanim=null}get _folder(){const t=this._raw;return`/Map/Back/${t.bS}/spine/${t.no}`}async load(){if(!SSAnim)return null;{let t=new SSAnim;try{await t.load(this._folder),t.update(0)}catch(t){return void console.error(t)}this.ssanim=t}}unload(){this.ssanim&&(this.ssanim.unload(),this.ssanim=null)}update(t){this.ssanim&&window.enable_skeletal_anim&&this.ssanim.update(t)}draw(t,e,i){if($gv.m_display_skeletal_anim&&this.ssanim){const e=Math.trunc(.5-$gv.m_viewRect.x+this.x),i=Math.trunc(.5-$gv.m_viewRect.y+this.y);t.ctx.setTransform(1,0,0,-1,e,i),this.ssanim.render()}}}class P{constructor(t,e){Object.assign(this,t),this.spawnId=e,this.time=0,this.count=0,t instanceof P||(this.fh=t.fh-1)}increaseLife(){++this.count,this.time=0}decreaseLife(){--this.count,this.time=0}getTimeElapsedAfterLifeSpawn(){return this.time}getNowCountOfLifeWasSpawn(){return this.count}clone(){return new this.constructor(this)}}class $ extends f.a{constructor(t,e){super();this.renderer=null,this.is_dead=!1,this.spawn=t,this.x=t.x,this.y=t.cy,this.z=5,this.angle=0,this.front=Number(t.f)?1:-1,this.opacity=Number(t.hide)?.5:1,this.lifeId=e}static Create(t,e,i){let s;if("m"==t.type)s=new D(t,i);else{if("n"!=t.type)return void alert("map life type: "+t.type);s=new T(t,i)}return s&&s.load(t.id,e),s}static async loadLifeDesc(t){let e,i=t.id;switch(t.type){case"m":e=l.loadDescription(i);break;case"n":e=h.loadDescription(i);break;default:return void alert("map life type: "+t.type)}return e}async load(t,e){this.renderer?await this.renderer.load(t):alert("Unknow type of life in map")}_destroy(t){throw new Error("Not implement")}die(t){throw new Error("Not implement")}update(t){this.renderer.update(t)}draw(t){t.globalAlpha=Math.max(0,Math.min(this.opacity,1)),this.renderer.draw(t,this.x,this.y,this.angle,this.front<0)}}class D extends ${constructor(t,e){super(t,e),this.renderer=new l,this.$physics=null,this.skills={},this.hp=1e5}async load(t,e){await super.load(t),this.$physics=e.createMob(this),this.$physics._loadAction(this.renderer.actions),await this._load_skill_by_mob_id(t);try{this._load_skill_info();const t=this.renderer._raw.info.attack[this.renderer._raw.info.firstAttack].info;if(this.skill_map[t]){const e=this.skill_map[t].skill_list[0];this.invokeSkill(e.skill,e.level)}}catch(t){}}damage(t,e){this.is_dead||(this.hp-=e,console.log(`Mob(${this.$objectid}) 被 ${t.$objectid} 攻擊，減少 ${e} HP，剩下 ${this.hp}`),this.hp<=0&&this.die())}knockback(t,e,i){}_applyState(t){t.jump?this.renderer.action="jump":t.walk?this.renderer.action="move":this.renderer.action="stand"}update(t){this.$physics&&(this.is_dead?this.$physics.stop():this._applyState(this.$physics.state)),this.renderer.update(t)}draw(t){$gv.m_display_mob&&super.draw(t)}_load_skill_info(){const t=this.renderer._raw;let e=t.info.attack;t.info.skill;e[1].info,t.info.skill[0].info,e[1].info,t.skill1.info;var i={};for(let e,s=1;(e="skill"+s)in t;++s){let s=t[e];s.info&&(i[s.info]={anim:e,skill_list:[]})}var s={};for(let e in t.info.skill){let n=t.info.skill[e];s[n.skill+"."+n.level]=n,i[n.info]&&(s[n.skill+"."+n.level].$anim=i[n.info].anim,i[n.info].skill_list.push(n))}this.skill_map=i,this.skill_info=s}_load_skill_by_mob_id(t){let e=[];switch(t){case"8880140":case"8880141":{const t=i(413).FlowerTrap,e=i(398).FairyDust;this.skills={1:new t,2:new t,3:new t,4:new e(null,null),5:{load(){},invoke:function(t){console.info("invoke LaserRain")}},6:{load(){},invoke:function(t){console.info("invoke ForcedTelepor")}},7:{load(){},invoke:function(t){console.info("invoke Dragon")}},8:{load(){},invoke:function(t){console.info("invoke Rush")}},9:{load(){},invoke:function(t){console.info("invoke WelcomeBarrage")}},10:new e(null,null)},this.skill_map_action=[];for(let t=1;t<=10;++t)switch(t){case 1:case 2:case 3:break;case 4:case 10:this.skill_map_action[t]="skill1";break;case 5:break;case 6:this.skill_map_action[t]="skill4";break;case 7:this.skill_map_action[t]="skill2"}}}for(let t in this.skills){const i=this.skills[t];e.push(i.load(t))}return Promise.all(e)}invokeSkill(t,e){const i=this.skills[e];if(i){const t=this.skill_map_action[e];t&&(this.renderer.action=t),i.invoke(e)}else console.warn({"unknow skill":t,level:e})}_destroy(t){let e=this.spawn;e instanceof P&&e.decreaseLife(),t.destroyMob(this),this.renderer=null}die(t=1){this.renderer.action="die"+t,this.is_dead=!0}}class T extends ${constructor(t,e){super(t,e),this.renderer=new h}draw(t){$gv.m_display_npc&&super.draw(t)}_destroy(t){this.spawn.decreaseLife(),t.destroyNpc(this),this.renderer=null}die(t){this.is_dead=!0}}let G=1;class L{constructor(t){this._raw=null,this.spawnPoints=[],this.entities=[],this.mapController=t}load(t){let e=[];this._raw=t.life;let i=Object.keys(this._raw).map(t=>{let e=parseInt(t,10);return Number.isSafeInteger(e)?e:(console.warn("MapLife.spawnId: "+t),null)}).filter(t=>null!=t);for(let t of i){let i=new P(this._raw[t],t);e.push($.loadLifeDesc(i)),this.spawnPoints.push(i)}return Promise.all(e)}unload(){for(let t=0;t<this.entities.length;++t){const e=this.entities[t];"m"==e.spawn.type&&e.$physics._destroy(this.mapController)}this.spawnPoints=[],this.entities=[]}update(t){for(let e=0;e<this.spawnPoints.length;++e){let i=this.spawnPoints[e];i.time+=t,i.time>=1e3&&i.count<G&&(i.increaseLife(),this.spawn(i))}for(let e=0;e<this.entities.length;++e){let i=this.entities[e];if(i){if(i.renderer.action&&i.renderer.action.startsWith("die")){const t=i.renderer.actions[i.renderer.action];if(t&&t.isEnd()){this.destroyLife(i);continue}}i.update(t)}}}spawn(t){let e=0;for(;e<this.entities.length&&this.entities[e];++e);let i=$.Create(t,this.mapController,e);e<this.entities.length?this.entities[e]=i:this.entities.push(i)}spawnNpc(t,e,i,s=!1,n=0){let o=new P({type:"n",x:0|e,y:0|i,cy:0|i,id:t,fh:n,is_dummy:!0});this.spawn(o)}spawnMob(t,e,i,s=!1,n=0){let o=new P({type:"m",x:0|e,y:0|i,cy:0|i,id:t,fh:n,is_dummy:!0});this.spawn(o)}destroyLife(t){t instanceof $||(alert("MapLifeManager.killLife: can't kill non life"),console.error("MapLifeManager.killLife: can't kill non life")),t._destroy(this.mapController),delete this.entities[t.lifeId]}destroyAll(){this.entities.forEach(t=>this.destroyLife(t))}draw(t,e,i,s){for(let e=0;e<this.entities.length;++e){let i=this.entities[e];i&&(null!=i.z&&i.z==s||null==s)&&i.draw(t)}}}class R{constructor(){this.stamp=0,this.background=[],this.frontground=[],this.layeredObject=[],this.layeredTile=[],this.backTags={},this.namedObject={},this.controller=new p.a,this.lifeMgr=new L(this.controller),this.portalMgr=new B,this.particleList=null,this.mapBound=null,this.quest={},this._url=null,this.$load_tasks=[],this.$promise=null,this.$loading_status="loading",this.onload=null}static async _Init(){let t=null,e={};t=await $get.data("/String/Map");for(let i in t)for(let s in t[i])e[s]=t[i][s],e[s].$region=i;R._map_names=e,window.$MapNames=R._map_names}static Init(){return Promise.all([this._Init(),C.Init()])}isActivated(t){if(t)for(let e in t)if(this.quest[e]!=t[e])return!1;return!0}get $map_sprite(){return window.$map_sprite}async _constructBack(t){if(!("back"in t))return;let e=new Map;for(let i=0;i in t.back;++i){let s=t.back[i];const n=this._url+`back/${i}`;let o;if(0==s.ani)o=new M(s);else if(1==s.ani)o=new k(s);else{if(2!=s.ani)throw new Error("ob.ani: "+s.ani);o=new I(s)}if(o._url=n,null!=o.backTags&&(this.backTags[o.backTags]=o),2!=s.ani)if(o._raw.bS){let t="Back/"+o._raw.bS;e.has(t)||e.set(t,g("Back",o._raw.bS))}else console.warn("MapBack: map.back["+i+"].bS = "+o._raw.bS);0!=s.front?this.frontground.push(o):this.background.push(o)}await Promise.all([...e.values()]);for(let t=0;t<this.frontground.length;++t){this.frontground[t].load()}for(let t=0;t<this.background.length;++t){this.background[t].load()}}async _constructLayeredObject(t){let e=new Map;for(let i=0,s=t[i];!E(s);s=t[++i]){let t=this.__constructLayeredObject_obj(i,s,e),n=this.__constructLayeredObject_tile(i,s,e);n.sort((t,e)=>t.z-e.z),t.sort((t,e)=>t.z-e.z),this.layeredObject[i]=t,this.layeredTile[i]=n}await Promise.all([...e.values()]);for(let t=0;t<this.layeredObject.length;++t){const e=this.layeredObject[t];for(let t=0;t<e.length;++t){e[t].load()}}for(let t=0;t<this.layeredTile.length;++t){const e=this.layeredTile[t];for(let t=0;t<e.length;++t){e[t].load()}}}__constructLayeredObject_tile(t,e,i){const s=e.info;let n=[];if(s.tS){let t="Tile/"+s.tS;i.has(t)||i.set(t,g("Tile",s.tS))}else Object.keys(e.tile).length&&console.warn("["+t+"].tile = "+JSON.stringify(e.tile));for(let i=0,o=e.tile[i];!E(o);i++,o=e.tile[i]){let e=new S(o,s);e._url=this._url+`${t}/tile/${i}`,n.push(e)}return n}__constructLayeredObject_obj(t,e,i){let s=[];for(let n=0,o=e.obj[n];!E(o);n++,o=e.obj[n]){let e;if(o.spineAni){switch(o.spineAni){case"animation":break;case"idle":console.warn("spine animation: idle ??");break;default:console.groupCollapsed("unknow spine:"+o.spineAni),console.warn(`LayeredObject[${t}][${n}]`),console.warn(o),console.groupEnd()}e=new w(o)}else{let t="Obj/"+(e=new b(o))._raw.oS;i.has(t)||i.set(t,g("Obj",e._raw.oS))}e._url=this._url+`${t}/obj/${n}`,null!=e.name&&(this.namedObject[e.name]=e),s.push(e)}return s}__compute_top_bottom_border(t){let e=null,i=null;for(let s=0;s<t.length;++s){const n=t[s];for(let t=0;t<n.length;++t){let s=n[t].compute_max_rectangle();s&&null!=e&&null!=i?(e=Math.min(e,s.top),i=Math.max(i,s.bottom)):(e=s.top,i=s.bottom)}}return{top:e,bottom:i}}_compute_top_bottom_border(){let t=this.__compute_top_bottom_border(this.layeredObject),e=this.__compute_top_bottom_border(this.layeredTile);return{top:Math.min(t.top,e.top),bottom:Math.max(t.bottom,e.bottom)}}_compute_map_bound(t){if(this.mapBound&&!t)return this.mapBound;const e=this._raw.info;let i,s;if(null!=e.VRLeft&&null!=e.VRTop&&null!=e.VRRight&&null!=e.VRBottom)i=e.VRTop,s=e.VRBottom;else{let t=this._compute_top_bottom_border();i=t.top,s=t.bottom}const o=this.controller.ground._compute_left_right_border();let r=n.Rectangle.parse(o.left,i,o.right,s);return this.mapBound=r,r}get _window_title(){return this.mapName?`${[this.mapName,this.streetName].join("·")} (${this.map_id})`:`${this.map_id}`}_get_map_data_url(t){return`/Map/Map/Map${t.slice(0,1)}/${t}`}async load(t,e){if(!e&&null!=t&&this.map_id==t&&null!=this._raw)return this.isLoaded()&&this.unload(),void this._load(this._raw);const i=this._get_map_data_url(t);let s=await $get.data(i);if(s){if(s.info&&s.info.link){const t=this._get_map_data_url(s.info.link);if(!(s=await $get.data(t)))return void alert("map-link not exit")}this.isLoaded()&&this.unload(),this._url=i,this.map_id=t,this._load(s)}else alert("map not exit")}_load(t){const e=this.map_id;this.$loading_status="loading",$gv.allQuest={},this.controller.stop=!0,R._map_names[e]&&(this.mapName=R._map_names[e].mapName,this.streetName=R._map_names[e].streetName),this.$load_tasks=[],this._loadBgm(t),this.$load_tasks.push(this._constructBack(t,this)),this.$load_tasks.push(this._constructLayeredObject(t,this).then(t=>{})),this.$load_tasks.push(this.portalMgr.load(t,this).then(t=>{})),this.$load_tasks.push(this.__constructMiniMap(t,this)),this.$load_tasks.push(this.controller.load(t,this)),this.$load_tasks.push(this.lifeMgr.load(t,this)),this.$load_tasks.push(A.construct(t,this)),this.$promise=Promise.all(this.$load_tasks),this.$promise.then(t=>{const e=this._compute_map_bound(),i=e.center;$gv.m_viewRect.setCenter(i.x,i.y),this.controller._createMapBound(e),this.controller.stop=!1,this.$load_tasks=[],this.$promise=null,delete this.$loading_status,console.log("completed scene_map.waitLoaded: [...]")}),this._raw=t,this._script(),this.onload&&this.onload.call(this),console.log("End scene_map.load")}_script(){switch(this.map_id){case"450004150":case"450004450":case"450004750":this.lifeMgr.spawnMob("8880166",1e3,47,!1,0),this.lifeMgr.spawnMob("8880140",1e3,47,!1,0)}}reload(){this.unload(),this._load(this._raw)}unload(){this.$loading_status="loading";for(let t=0;t<this.background.length;++t)this.background[t].unload();this.background=[];for(let t=0;t<this.frontground.length;++t)this.frontground[t].unload();this.frontground=[];for(let t=0;t<this.layeredObject.length;++t){let e=this.layeredObject[t];for(let t=0;t<e.length;++t)e[t].unload()}this.layeredObject=[];for(let t=0;t<this.layeredTile.length;++t){let e=this.layeredTile[t];for(let t=0;t<e.length;++t)e[t].unload()}this.layeredTile=[],this.backTags={},this.particleList=null,this.controller.unload(),this.lifeMgr.unload(),this.portalMgr.unload(),y.Back={},y.Obj={},y.Tile={}}_getBgmPath(t){let e=t.info.bgm,i=e.indexOf("/");return["","Sound",e.slice(0,i)+e.slice(i)].join("/")}_loadBgm(t){const e=document.getElementById("bgm");if(e){const i=this._getBgmPath(t);this._bgm_path=i;const s=$get.soundMp3Url(i);e.innerHTML=`<source src="${s}" type="audio/mpeg">`,e.autoplay=!0}else console.error(new TypeError("#bgm"))}playBgm(){document.getElementById("bgm").play()}pauseBgm(){document.getElementById("bgm").pause()}__constructMiniMap(t){t.miniMap?(this.width=t.miniMap.width,this.height=t.miniMap.height,this.centerX=t.miniMap.centerX,this.centerY=t.miniMap.centerY):(this.width=0,this.height=0,this.centerX=0,this.centerY=0)}_miniMap_src(){return this._url+"miniMap/canvas"}async waitLoaded(){await this.$promise}isLoaded(){return(!this.$load_tasks||!this.$load_tasks.length)&&this._raw&&!this.$loading_status}update(t){window.m_hover_object=null,($gv.mouse_dm||$gv.mouse_dr)&&(window.m_selected_object=null),null!=t&&(this.stamp=t,this.lifeMgr.update(t),this.isLoaded()&&this.controller.update(t))}_addChara(t){try{let e=this.portalMgr.portals.filter(t=>"sp"==t.pn),i=e[Math.trunc(100*Math.random())%e.length];const s=t.$physics,n=i.x/$gv.CANVAS_SCALE,o=i.y/$gv.CANVAS_SCALE;s.setPosition(n,o),s.body.SetAwake(!0)}catch(t){console.error(t)}}addChara(t){this.$promise?this.$promise.then(()=>{this._addChara(t)}):this._addChara(t)}applyCamera(t){t.ctx.setTransform(1,0,0,1,Math.trunc(-$gv.m_viewRect.x),Math.trunc(-$gv.m_viewRect.y))}beginRender(t){t.pushGlobalAlpha()}endRender(t){t.popGlobalAlpha()}renderLife(t,e){if(!$gv.m_display_life)return;const i=n.Vec2.empty,s=$gv.m_viewRect;this.lifeMgr.draw(t,i,s,e)}renderPortal(t){if(!$gv.m_display_portal)return;const e=n.Vec2.empty,i=$gv.m_viewRect;this.portalMgr.update(this.stamp),this.portalMgr.draw(t,e,i)}renderFrontground(t){if(!$gv.m_display_front)return;const e=$gv.m_viewRect.center,i=$gv.m_viewRect;for(let s=0;s<this.frontground.length;++s){let n=this.frontground[s];this.isActivated(n.quest)&&(n.update(this.stamp),n.draw(t,e,i))}}renderLayeredObject(t,e){if(!$gv.m_display_mapobj)return;const i=n.Vec2.empty,s=$gv.m_viewRect,o=this.layeredObject[e];for(let e=0;e<o.length;++e){let n=o[e];this.isActivated(n.quest)&&(n.update(this.stamp),n.draw(t,i,s))}}renderLayeredTile(t,e){if(!$gv.m_display_maptile)return;const i=n.Vec2.empty,s=$gv.m_viewRect,o=this.layeredTile[e];for(let e=0;e<o.length;++e){let n=o[e];this.isActivated(n.quest)&&(n.update(this.stamp),n.draw(t,i,s))}}renderBackground(t){if(!$gv.m_display_back)return;const e=$gv.m_viewRect.center,i=$gv.m_viewRect;for(let s=0;s<this.background.length;++s){let n=this.background[s];this.isActivated(n.quest)&&(n.update(this.stamp),n.draw(t,e,i))}}renderParticle(t){if(!$gv.m_display_particle_system)return;const e=$gv.m_viewRect.center,i=$gv.m_viewRect;for(let s=0;s<this.particleList.length;++s){let n=this.particleList[s];this.isActivated(n.quest)&&(n.update(this.stamp),n.draw(t,e,i))}}}function E(t){if("object"==typeof t&&null==t)throw new Error;return void 0===t||null==t}Object(s.AddInitTask)(R.Init())},function(t,e,i){"use strict";var s=i(353),n=(i(332),i(355)),o=i(336),r=i(340),a=(i(354),i(373)),l=i(378),h=i(374),c=(i(367),i(399)),_=i(363),u=i(383);class m{constructor(t,e){this.type=t,this.data=e}}class d extends u.a{constructor(t){super(),this.action=t}}class p extends u.a{constructor(t){super(),this.skill_id=t}}i(365);var f=i(400),y=i(334),g=(i(369),i(376)),v=(i(364),i(333));class x extends y.Animation{constructor(t){super(t),this.is_loop=!0,this.z=t.z,this.pos=t.pos,this._offset=null,this._host=null}init(t,e){this._host=t,this._offset=e}isEnd(){return!this._host._player.chair}_addToScene(t){let e=this._host._player.$layer+this.z;e=e>=0?e:0,t.layers[e].add(this)}render(t,e){const i=this._host._player.renderer,s=i.x,n=i.y,o=i.angle,r=i.front>0;if(t.globalAlpha=e.opacity,this._offset){const e=this._offset;this.draw(t,s+e.x,n+e.y,0,r)}else if(1==this.pos){const e=.5*-this.texture.height;this.draw(t,s,n+e,0,r)}else this.draw(t,s,n,o,r)}}class b{constructor(){this._raw=null,this._player=null,this.bodyRelMove=null,this.id=null,this.effects=[],this.$promise=null}init(t){Object.defineProperties(this,{_player:{value:t}})}async load(t){if(!t.startsWith("0301"))throw new TypeError("Not chair");this.id=t,this.$promise=s.c.getItem(t);const e=await this.$promise;let i;if(delete this.$promise,delete this._raw,Object.defineProperties(this,{_raw:{configurable:!1,writable:!1,value:e}}),this._raw.info.bodyRelMove)this.bodyRelMove=new v.Vec2(this._raw.info.bodyRelMove.x,this._raw.info.bodyRelMove.y);else if(e.effect&&e.effect[0].origin.y<0){let t=e.effect[0].__h;i=new v.Vec2(0,1.5*-t)}e.effect[0].origin.y;for(let t in e)if(t.startsWith("effect")){const s=new x(e[t]);s.init(this,i),s.load(),this.effects.push(s)}}addToScene(t){for(let e of this.effects)e._addToScene(t)}getIconUrl(){return this._raw.info.icon[""]}getIconRawUrl(){return this._raw.info.iconRaw[""]}}i.d(e,"a",function(){return S}),i.d(e,"b",function(){return C}),i.d(e,"c",function(){return B}),window.$addItem_repeatEquip=!1;class A{constructor(){this.style=0,this.text="",this.$outputText=null,this.elapsed=0,this._isDisplay=!1}enter(t){this.text=String(t),this.$outputText=null,this.isDisplay=!0}update(t){const e=this.displayDuration;this.elapsed>e?this.isDisplay=!1:this.elapsed+=t}async draw(t,e){if(this._isDisplay){const i=this.style||$gv.ChatBalloon_default_style;let s=r.ChatBalloon.cache[i];s||(s=new r.ChatBalloon,await s.load(i));const n=this.colon,o=e.renderer,a=o._boundBox;this.$outputText||(this.$outputText=e.id+n+this.text),s.draw(t,this.$outputText,o.x,o.y-a.height)}}get isDisplay(){return this._isDisplay}set isDisplay(t){this._isDisplay=!!t,this.elapsed=0}get colon(){return" : "}get $maxLength(){return 70}get displayDuration(){return $gv.ChatBalloon_display_duration}}const w=[{ArrowUp:new m("Action",new d("up")),ArrowLeft:new m("Action",new d("left")),ArrowDown:new m("Action",new d("down")),ArrowRight:new m("Action",new d("right")),z:new m("Skill",new p("23001002")),x:new m("Skill",new p("1001005")),c:new m("Skill",new p("64120000")),v:new m("Skill",new p("23121000"))},{w:new m("Action",new d("up")),a:new m("Action",new d("left")),s:new m("Action",new d("down")),d:new m("Action",new d("right")),q:new m("Action",new d("jump")),f:new m("Skill",new p("23001002")),x:new m("Skill",new p("1001005")),c:new m("Skill",new p("64120000")),v:new m("Skill",new p("23121000"))}];class S extends n.a{constructor(){super(),this.renderer=null,this.$layer=5,this.name=null,this.stat=new h.CharacterStat,this.activeSkills=new Map,this.chair=null,this.chatCtrl=new A,this.labelStyle=0,this.$inPacket={},this.$inPacket.move=null,this.$outPacket={},this.$outPacket.move=null}get id(){return this.name}set id(t){this.name=t}get $objectid(){return this.name}set $objectid(t){this.name=t}damage(t,e){console.log("Player("+this.$objectid+") 被 "+t.$objectid+" 攻擊，減少 "+e+" HP")}knockback(t,e,i){this.$physics.knockback(e,i,1e3)}$move(t){let e=t||this.$inPacket.move;this.$inPacket.move=e}_remote_control(){let t=this.$inPacket.move;if(t&&t.path&&t.path.length){const e=this.renderer;let i=t.path.shift();i.isAwake&&(this.$physics.moveTo(i),this.$physics.state=i.pState,e.front=i.pState.front),i.action&&(e.action=i.action),i.emotion&&(e.emotion=i.emotion)}}$moveItem(t,e,i){}sitChair(t){this.chair?console.log("already sit"):(this.chair=new b,this.chair.init(this),this.chair.load(t).then(()=>{this.chair.addToScene(g.a);{const t=this.chair.bodyRelMove;t&&(this.renderer.x+=t.x,this.renderer.y+=t.y),this.chair._raw.info.sitAction?this.renderer.action=this.chair._raw.info.sitAction:this.renderer.action="sit",this.chair._raw.info.sitEmotion&&(this.renderer.emotion=window.character_emotion_list[this.chair._raw.info.sitEmotion])}this.enablePhysics=!1,this.$physics.body.SetAwake(!1),this.$physics.foot_walk.SetAwake(!1)}))}noSit(){this.enablePhysics=!0,this.$physics.body.SetAwake(!0),this.$physics.foot_walk.SetAwake(!0);{const t=this.chair.bodyRelMove;t&&(this.renderer.x-=t.x,this.renderer.y-=t.y),this.renderer.action="stand1",this.renderer.emotion="blink"}this.chair=null}invokeSkill(t){let e=new l.b;return e.load(t,this),this.activeSkills.set(t,e),e}update(t){const e=this.renderer;if(this.chatCtrl.update(t),this.activeSkills.forEach(e=>{e&&(e.isEnd()?this.activeSkills.delete(e.skillId):e.update(t,this),this._handleAttack(),e.attackInfo.allAttack.length=0)}),this._player_control(),$gv.m_editor_mode?e.speed>0&&this.$physics&&this.enablePhysics&&this._applyState({front:this.$physics.state.front}):this.$physics&&this._applyState(this.$physics.state),this.$physics&&e&&this.enablePhysics){const t=this.$physics.getPosition(),i=Math.trunc(t.x*$gv.CANVAS_SCALE+.5),s=Math.trunc(t.y*$gv.CANVAS_SCALE+.5);e.x=i,e.y=s,this.$physics.body.GetAngle()||this.$physics.body.GetAngularVelocity()?e.angle=this.$physics.body.GetAngle():e.angle=0,this.$layer=this.$physics.getLayer()}e.update(t)}_$drawName(t){const e=this.id;this.__drawName(t,e,this.labelStyle||$gv.NameLabel_default_style)}_$drawChatBalloon(t){this.chatCtrl.draw(t,this)}_player_control(){}_applyState(t){const e=this.renderer,i=this.$physics.state;if(!i.invokeSkill){const{front:s,jump:n,walk:o,prone:r,fly:a,ladder:l}=t,h=chara.enablePhysics;null!=s&&(e.front=s),l?h&&this.$physics.ladder&&(this.$physics.ladder.isLadder()?e.action="ladder":e.action="rope",i.ladder_move_dir?chara.renderer.actani.isEnd()&&(chara.renderer.actani.reset(),e.actani.loop=!1):e.actani._is_end=!0):n?(e.action="jump",e.actani.loop=!1):o?(e.action="walk1",e.actani.loop=!0):r?(e.action="prone",e.actani.loop=!1):a?(e.action="fly",e.actani.loop=!0):(e.action="stand1",e.actani.loop=!0);for(let t=0;t<=9;++t)if($gv.input_keyDown[t]){let i=["blink","hit","smile","troubled","cry","angry","bewildered","stunned","vomit","oops"],s=i[t%i.length];e.emotion=s}}}_handleAttack(){if(window.$io)throw new Error("未完成");this.activeSkills.forEach(t=>{const e=t.attackInfo;for(let t=0;t<e.allAttack.length;++t){const i=e.allAttack[t],s=i.getTargetObject();for(let t=0;t<i.allDamage.length;++t){let e,n=this.stat.getCurrentMaxBaseDamage()-this.stat.getCurrentMinBaseDamage(),o=this.stat.getCurrentMinBaseDamage()+Math.random()*n,r=i.allDamage[t]=new _.c;Math.trunc(100*Math.random())<this.stat.critRate&&(o*=1+this.stat.critDamage/100,r.critical=!0),o=Math.trunc(o),r.realDamage=o,s.damage(this,o),e=r.critical?"NoCri":"NoRed",f.a.addDamagePair(this.m_damageSkin||"default",e,r,s.x+(i.allDamage.length>1?25-25*(1-t&1):0),s.y,100*t)}s.knockback(this,16,16)}})}}class C extends S{constructor(t){super(),this.renderer=new o.CharacterRenderer,this.$physics=t.controller.$createPlayer(this,this.renderer),this.$layer=5,this.id=null,this.items=new Array(5);for(let t=0;t<5;++t){this.items[t]=new Array(128);for(let e=0;e<128;++e)this.items[t][e]=new a.b(e,null,null,0)}this.stat.onJobChange(this._onJobChange.bind(this))}_onJobChange(){const t=this.stat.job;console.log("Player("+this.$objectid+") change job: "+t)}_applyState(t){super._applyState(t),this.$recMove()}_player_control(){if(!this.$physics)return;const t=w[$gv.m_editor_mode?1:0];let e={},i=0==this.activeSkills.size;for(let i in t){const s=t[i];if(!s)continue;const n=$gv.input_keyDown[i];$gv.input_keyUp[i];switch(s.type){case"Command":break;case"Action":if(n){const t=s.data;this.chair?"left"!=t.action&&"right"!=t.action&&"jump"!=t.action||this.noSit():e[t.action]=n}break;case"Item":if(n){const t=s.data;this.useItem(t.data.id)}}}if(!this.chair)for(let s in t){const n=t[s];if(!n)continue;const o=$gv.input_keyDown[s],r=$gv.input_keyUp[s];if("Skill"==n.type){const t=n.data,s=t.skill_id;let a=this.activeSkills.get(s);o&&i&&(a=this.invokeSkill(t.skill_id)),a&&a.control(e,o,r)}}this.$physics.control(e)}addItem(t,e){if(window.$io)throw new Error("未完成");{let i={incDEXr:Math.trunc(3*Math.random()),timeLimited:Date()};Object(a.a)(t,i).then(t=>{this._addItem(t,e)},function(t){console.warn(t)})}}_addItem(t,e){let i=t.id,s=t.getSlot();for(let n=0;n<this.items[s].length;++n)if(this.items[s][n].isEmpty()){if(window.$addItem_repeatEquip)return this.items[s][n].assign(n,123,t,s?e:1),console.info(`give ${this.id}: ${i} * ${e}`),!0;if(0!=s)return this.items[s][n].assign(n,123,t,e),console.info(`give ${this.id}: ${i} * ${e}`),!0;if(this.items[s][n].assign(n,123,t,1),0==--e)return console.info(`repeat give ${this.id}: ${i}`),!0}return!1}async removeItem(t,e){if(window.$io)throw new Error("未完成");return this._removeItem(t,e)}_removeItem(t,e){this.items[t][e]._clear()}moveItemToSlot(t,e){}findItem(t){for(let e=0;e<this.items.length;++e)for(let i=0;i<this.items[e].length;++i){let n=this.items[e][i];if(n&&n.data&&n.data.id==t)return{typeName:s.c.typeName[e],itemSlot:n}}return{typeName:null,itemSlot:null}}useItem(t){if(window.$io)window.$io.emit("useItem",{itemId:t});else{function e(){this.renderer.use(t)}this.findItem(t).itemSlot?($gv.m_editor_mode?console.log(`使用道具：${t}。`):(console.log(`消耗道具：${t}。未完成`),this._consume(t,1)),s.c.isChair(t)?this.sitChair(t):e.call(this)):$gv.m_editor_mode?(this.addItem(t,1),s.c.isChair(t)?this.sitChair(t):e.call(this)):console.log("無法使用不存在的道具。")}}async say(t){if(window.$io){let e=await window.$io.emit("chat",{$style:this.chatCtrl.style,text:t});return e&&this.chatCtrl.enter(t),e}return this.chatCtrl.enter(t),!0}$emit(t){if(this.$outPacket.move)t.emit("charaMove",this.$outPacket.move),this.$outPacket.move=null;else{let e=new c.$Packet_CharacterMove;e.capture(this),t.emit("charaMove",e)}this.$outPacket.move=null}$recMove(){let t=this.$outPacket.move||new c.$Packet_CharacterMove;t.capture(this),this.$outPacket.move=t}}class B extends S{constructor(t){super(),this.renderer=new o.CharacterRenderer,this.$physics=t.controller.$createPlayer(this,this.renderer)}get $remote(){return!0}_player_control(){this._remote_control()}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});i(354);class s{constructor(){this.x=null,this.y=null,this.vx=void 0,this.vy=void 0,this.fx=void 0,this.fy=void 0,this.pState=null,this.elapsed=0,this.isAwake=void 0,this.action=void 0,this.action_frame=void 0,this.emotion=void 0,this.emotion_frame=void 0}}class n extends s{}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return LifeRenderer});var _Sprite_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(349),_Animation_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(334);class LifeRenderer{constructor(){this._url="",this.id=null,this.actions={},this._action="stand",this._raw=null}get name(){return this.constructor._desc[this.id].name}getDefaultAction(){return this.actions.stand?"stand":this.actions.fly?"fly":(alert(this.constructor.name+" ("+this.id+") default must is 'stand' or 'fly'"),new Error(this.constructor.name+" ("+this.id+") default must is 'stand' or 'fly'"))}get action(){return this._action}set action(t){this._action!=t&&(this._action=t,this.actions[t]&&this.actions[t].reset())}async load(t){let e=[],i=this;if(this.id=t,this._url=[this.constructor._base_path,this.id].join("/"),!this.constructor._desc[t]){let i=this.constructor.loadDescription(t);e.push(i)}let s=$get.data(this._url).then(async function(t){i._raw=t,i._raw&&(await i._construct_actions(),i._action=i.getDefaultAction())});return e.push(s),Promise.all(e)}async _construct_actions(){for(var tasks=[],i=0;i<this.constructor._animations.length;++i)for(var t=this.constructor._animations[i],$index=1;;++$index){let action;var name=eval(t);if(!(name in this._raw))break;if(action=new _Animation_js__WEBPACK_IMPORTED_MODULE_1__.Animation(this._raw[name],[this._url,name].join("/")),action.is_loop=!1,tasks.push(action.load()),this.actions[name]=action,!name.endsWith($index))break}await Promise.all(tasks)}update(t){if(this.actions[this.action]){this.actions[this.action].update(t)}}draw(t,e,i,s,n){if(this.actions[this.action]){this.actions[this.action].draw(t,e,i,s,n)}}paint(t){alert("Not Implement"),render(t)}static async loadDescription(t){alert("Not Implement")}static get _animations(){throw new Error("Not implement")}static _get_desc_base_path(){throw new Error("Not implement")}static get _base_path(){throw new Error("Not implement")}}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return o});i(334),i(332);var s=i(364);class n{constructor(){this.opacity=1}destroy(){}isEnd(){console.error("Not implement")}update(t){throw new Error}render(t,e){throw new Error}}class o{constructor(){this.objects=[],this.rendering_option=new s.a}add(t){this.objects.push(t)}clear(){this.objects.length=0}update(t){this.objects=this.objects.filter(function(e){return e.isEnd&&e.destroy?e.isEnd()?(e.destroy(),!1):(e.update(t),!0):(console.error("%o: %o",e.constructor?e.constructor.name:typeof e,e),!1)})}render(t,e){const i=this.rendering_option.mul(e);i.opacity>0&&(t.pushGlobalAlpha(),this.objects.forEach(function(e){e.render(t,i)}),t.popGlobalAlpha())}}},function(t,e,i){"use strict";i.r(e);var s,n=i(345),o=i(346);class r{constructor(t=.5,e=.5,i=.5,s=1){this.r=t,this.g=e,this.b=i,this.a=s}Clone(){return(new r).Copy(this)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}GetColor(t){return t.Copy(this),t}SetColor(t){this.Copy(t)}Set(t,e,i,s=1){t instanceof r?this.Copy(t):this.SetRGBA(t,e,i,s)}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,s){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=s/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}SelfMul_0_1(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul_0_1(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this}Mix(t,e){r.MixColors(this,t,e)}static MixColors(t,e,i){const s=i*(e.r-t.r),n=i*(e.g-t.g),o=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=n,t.b+=o,t.a+=r,e.r-=s,e.g-=n,e.b-=o,e.a-=r}MakeStyleString(t=this.a){return r.MakeStyleString(this.r,this.g,this.b,t)}static MakeStyleString(t,e,i,s=1){return t*=255,e*=255,i*=255,s<1?`rgba(${t},${e},${i},${s})`:`rgb(${t},${e},${i})`}}r.RED=new r(1,0,0),r.GREEN=new r(0,1,0),r.BLUE=new r(0,0,1),function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_particleBit=32]="e_particleBit",t[t.e_controllerBit=64]="e_controllerBit",t[t.e_all=63]="e_all"}(s||(s={}));class a{constructor(){this.m_drawFlags=0}SetFlags(t){this.m_drawFlags=t}GetFlags(){return this.m_drawFlags}AppendFlags(t){this.m_drawFlags|=t}ClearFlags(t){this.m_drawFlags&=~t}PushTransform(t){}PopTransform(t){}DrawPolygon(t,e,i){}DrawSolidPolygon(t,e,i){}DrawCircle(t,e,i){}DrawSolidCircle(t,e,i,s){}DrawParticles(t,e,i,s){}DrawSegment(t,e,i){}DrawTransform(t){}}class l{constructor(){this.m_start=Date.now()}Reset(){return this.m_start=Date.now(),this}GetMilliseconds(){return Date.now()-this.m_start}}class h{constructor(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}GetCount(){return this.m_count}GetMinCount(){return this.m_min_count}GetMaxCount(){return this.m_max_count}ResetCount(){const t=this.m_count;return this.m_count=0,t}ResetMinCount(){this.m_min_count=0}ResetMaxCount(){this.m_max_count=0}Increment(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}Decrement(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}class c{constructor(t){this.m_stack=[],this.m_count=0,this.m_stack=[],this.m_count=0}Reset(){return this.m_count=0,this}Push(t){this.m_stack[this.m_count]=t,this.m_count++}Pop(){this.m_count--;const t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}GetCount(){return this.m_count}}class _{}class u{}var m=i(347),d=i(360);function p(t){if(null===t)throw new Error;return t}class f{constructor(t=0){this.m_id=0,this.aabb=new m.a,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}IsLeaf(){return null===this.child1}}class y{constructor(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0}GetUserData(t){return t.userData}GetFatAABB(t){return t.aabb}Query(t,e){if(null===this.m_root)return;const i=y.s_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const s=i.Pop();if(null!==s&&s.aabb.TestOverlap(e))if(s.IsLeaf()){if(!t(s))return}else i.Push(s.child1),i.Push(s.child2)}}RayCast(t,e){if(null===this.m_root)return;const i=e.p1,s=e.p2,n=o.A.SubVV(s,i,y.s_r);n.Normalize();const r=o.A.CrossOneV(n,y.s_v),a=o.A.AbsV(r,y.s_abs_v);let l=e.maxFraction;const h=y.s_segmentAABB;let c=i.x+l*(s.x-i.x),_=i.y+l*(s.y-i.y);h.lowerBound.x=Object(o.n)(i.x,c),h.lowerBound.y=Object(o.n)(i.y,_),h.upperBound.x=Object(o.m)(i.x,c),h.upperBound.y=Object(o.m)(i.y,_);const u=y.s_stack.Reset();for(u.Push(this.m_root);u.GetCount()>0;){const n=u.Pop();if(null===n)continue;if(!Object(m.n)(n.aabb,h))continue;const d=n.aabb.GetCenter(),p=n.aabb.GetExtents();if(!(Object(o.a)(o.A.DotVV(r,o.A.SubVV(i,d,o.A.s_t0)))-o.A.DotVV(a,p)>0))if(n.IsLeaf()){const r=y.s_subInput;r.p1.Copy(e.p1),r.p2.Copy(e.p2),r.maxFraction=l;const a=t(r,n);if(0===a)return;a>0&&(l=a,c=i.x+l*(s.x-i.x),_=i.y+l*(s.y-i.y),h.lowerBound.x=Object(o.n)(i.x,c),h.lowerBound.y=Object(o.n)(i.y,_),h.upperBound.x=Object(o.m)(i.x,c),h.upperBound.y=Object(o.m)(i.y,_))}else u.Push(n.child1),u.Push(n.child2)}}AllocateNode(){if(this.m_freeList){const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.userData=null,t}return new f(y.s_node_id++)}FreeNode(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.userData=null,this.m_freeList=t}CreateProxy(t,e){const i=this.AllocateNode(),s=n.k,o=n.k;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-o,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+o,i.userData=e,i.height=0,this.InsertLeaf(i),i}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);const s=n.k+n.l*(i.x>0?i.x:-i.x),o=n.k+n.l*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-s,t.aabb.lowerBound.y=e.lowerBound.y-o,t.aabb.upperBound.x=e.upperBound.x+s,t.aabb.upperBound.y=e.upperBound.y+o,this.InsertLeaf(t),!0}InsertLeaf(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const e=t.aabb;let i,s,n=this.m_root;for(;!n.IsLeaf();){i=n.child1,s=n.child2;const t=n.aabb.GetPerimeter(),o=y.s_combinedAABB;o.Combine2(n.aabb,e);const r=o.GetPerimeter(),a=2*r,l=2*(r-t);let h;const c=y.s_aabb;let _,u,m;if(i.IsLeaf()?(c.Combine2(e,i.aabb),h=c.GetPerimeter()+l):(c.Combine2(e,i.aabb),_=i.aabb.GetPerimeter(),h=(u=c.GetPerimeter())-_+l),s.IsLeaf()?(c.Combine2(e,s.aabb),m=c.GetPerimeter()+l):(c.Combine2(e,s.aabb),_=s.aabb.GetPerimeter(),m=(u=c.GetPerimeter())-_+l),a<h&&a<m)break;n=h<m?i:s}const r=n,a=r.parent,l=this.AllocateNode();for(l.parent=a,l.userData=null,l.aabb.Combine2(e,r.aabb),l.height=r.height+1,a?(a.child1===r?a.child1=l:a.child2=l,l.child1=r,l.child2=t,r.parent=l,t.parent=l):(l.child1=r,l.child2=t,r.parent=l,t.parent=l,this.m_root=l),n=t.parent;null!==n;)i=(n=this.Balance(n)).child1,s=n.child2,n.height=1+Object(o.m)(i.height,s.height),n.aabb.Combine2(i.aabb,s.aabb),n=n.parent}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=t.parent,i=e&&e.parent;let s;if(s=e.child1===t?e.child2:e.child1,i){i.child1===e?i.child1=s:i.child2=s,s.parent=i,this.FreeNode(e);let t=i;for(;t;){const e=(t=this.Balance(t)).child1,i=t.child2;t.aabb.Combine2(e.aabb,i.aabb),t.height=1+Object(o.m)(e.height,i.height),t=t.parent}}else this.m_root=s,s.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=p(t.child1),i=p(t.child2),s=i.height-e.height;if(s>1){const s=p(i.child1),n=p(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>n.height?(i.child2=s,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.m)(e.height,n.height),i.height=1+Object(o.m)(t.height,s.height)):(i.child2=n,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.m)(e.height,s.height),i.height=1+Object(o.m)(t.height,n.height)),i}if(s<-1){const s=p(e.child1),n=p(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,s.height>n.height?(e.child2=s,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.m)(i.height,n.height),e.height=1+Object(o.m)(t.height,s.height)):(e.child2=n,t.child1=s,s.parent=t,t.aabb.Combine2(i.aabb,s.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.m)(i.height,s.height),e.height=1+Object(o.m)(t.height,n.height)),e}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}static GetAreaNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;let e=t.aabb.GetPerimeter();return e+=y.GetAreaNode(t.child1),e+=y.GetAreaNode(t.child2)}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root.aabb.GetPerimeter();return y.GetAreaNode(this.m_root)/t}ComputeHeightNode(t){if(t.IsLeaf())return 0;const e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+Object(o.m)(e,i)}ComputeHeight(){return this.ComputeHeightNode(this.m_root)}ValidateStructure(t){if(null===t)return;this.m_root;const e=t,i=e.child1,s=e.child2;e.IsLeaf()||(this.ValidateStructure(i),this.ValidateStructure(s))}ValidateMetrics(t){if(null===t)return;const e=t,i=e.child1,s=e.child2;e.IsLeaf()||(y.s_aabb.Combine2(i.aabb,s.aabb),this.ValidateMetrics(i),this.ValidateMetrics(s))}Validate(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);let t=this.m_freeList;for(;null!==t;)t=t.parent}static GetMaxBalanceNode(t,e){if(null===t)return e;if(t.height<=1)return e;const i=t.child1,s=t.child2,n=Object(o.a)(s.height-i.height);return Object(o.m)(e,n)}GetMaxBalance(){return y.GetMaxBalanceNode(this.m_root,0)}RebuildBottomUp(){this.Validate()}static ShiftOriginNode(t,e){if(null===t)return;if(t.height<=1)return;const i=t.child1,s=t.child2;y.ShiftOriginNode(i,e),y.ShiftOriginNode(s,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)}ShiftOrigin(t){y.ShiftOriginNode(this.m_root,t)}}y.s_stack=new c(256),y.s_r=new o.A,y.s_v=new o.A,y.s_abs_v=new o.A,y.s_segmentAABB=new m.a,y.s_subInput=new m.l,y.s_combinedAABB=new m.a,y.s_aabb=new m.a,y.s_node_id=0;class g{constructor(){this.proxyA=null,this.proxyB=null}}class v{constructor(){this.m_tree=new y,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}CreateProxy(t,e){const i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetFatAABB(t){return this.m_tree.GetFatAABB(t)}GetUserData(t){return this.m_tree.GetUserData(t)}TestOverlap(t,e){const i=this.m_tree.GetFatAABB(t),s=this.m_tree.GetFatAABB(e);return Object(m.n)(i,s)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];if(null===e)continue;const i=t=>{if(t.m_id===e.m_id)return!0;this.m_pairCount===this.m_pairBuffer.length&&(this.m_pairBuffer[this.m_pairCount]=new g);const i=this.m_pairBuffer[this.m_pairCount];return t.m_id<e.m_id?(i.proxyA=t,i.proxyB=e):(i.proxyA=e,i.proxyB=t),++this.m_pairCount,!0},s=this.m_tree.GetFatAABB(e);this.m_tree.Query(i,s)}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(x);let e=0;for(;e<this.m_pairCount;){const i=this.m_pairBuffer[e],s=this.m_tree.GetUserData(i.proxyA),n=this.m_tree.GetUserData(i.proxyB);for(t.AddPair(s,n),++e;e<this.m_pairCount;){const t=this.m_pairBuffer[e];if(t.proxyA.m_id!==i.proxyA.m_id||t.proxyB.m_id!==i.proxyB.m_id)break;++e}}}Query(t,e){this.m_tree.Query(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}function x(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}let b=0,A=0,w=0,S=0,C=0,B=0,V=0;function M(){b=0,A=0,w=0,S=0,C=0,B=0,V=0}const k=new o.z,I=new o.z,P=new o.A,$=new o.A,D=new o.A,T=new o.A,G=new o.A;class L{constructor(){this.proxyA=new d.d,this.proxyB=new d.d,this.sweepA=new o.y,this.sweepB=new o.y,this.tMax=0}}var R,E;!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(R||(R={}));class F{constructor(){this.state=R.e_unknown,this.t=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(E||(E={}));class q{constructor(){this.m_sweepA=new o.y,this.m_sweepB=new o.y,this.m_type=E.e_unknown,this.m_localPoint=new o.A,this.m_axis=new o.A}Initialize(t,e,i,s,n,r){this.m_proxyA=e,this.m_proxyB=s;const a=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);const l=k,h=I;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(h,r),1===a){this.m_type=E.e_points;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyB.GetVertex(t.indexB[0]),s=o.z.MulXV(l,e,P),n=o.z.MulXV(h,i,$);o.A.SubVV(n,s,this.m_axis);const r=this.m_axis.Normalize();return this.m_localPoint.SetZero(),r}if(t.indexA[0]===t.indexA[1]){this.m_type=E.e_faceB;const e=this.m_proxyB.GetVertex(t.indexB[0]),i=this.m_proxyB.GetVertex(t.indexB[1]);o.A.CrossVOne(o.A.SubVV(i,e,o.A.s_t0),this.m_axis).SelfNormalize();const s=o.t.MulRV(h.q,this.m_axis,D);o.A.MidVV(e,i,this.m_localPoint);const n=o.z.MulXV(h,this.m_localPoint,$),r=this.m_proxyA.GetVertex(t.indexA[0]),a=o.z.MulXV(l,r,P);let c=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),s);return c<0&&(this.m_axis.SelfNeg(),c=-c),c}{this.m_type=E.e_faceA;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyA.GetVertex(t.indexA[1]);o.A.CrossVOne(o.A.SubVV(i,e,o.A.s_t0),this.m_axis).SelfNormalize();const s=o.t.MulRV(l.q,this.m_axis,D);o.A.MidVV(e,i,this.m_localPoint);const n=o.z.MulXV(l,this.m_localPoint,P),r=this.m_proxyB.GetVertex(t.indexB[0]),a=o.z.MulXV(h,r,$);let c=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),s);return c<0&&(this.m_axis.SelfNeg(),c=-c),c}}FindMinSeparation(t,e,i){const s=k,n=I;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case E.e_points:{const i=o.t.MulTRV(s.q,this.m_axis,T),r=o.t.MulTRV(n.q,o.A.NegV(this.m_axis,o.A.s_t0),G);t[0]=this.m_proxyA.GetSupport(i),e[0]=this.m_proxyB.GetSupport(r);const a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),h=o.z.MulXV(s,a,P),c=o.z.MulXV(n,l,$);return o.A.DotVV(o.A.SubVV(c,h,o.A.s_t0),this.m_axis)}case E.e_faceA:{const i=o.t.MulRV(s.q,this.m_axis,D),r=o.z.MulXV(s,this.m_localPoint,P),a=o.t.MulTRV(n.q,o.A.NegV(i,o.A.s_t0),G);t[0]=-1,e[0]=this.m_proxyB.GetSupport(a);const l=this.m_proxyB.GetVertex(e[0]),h=o.z.MulXV(n,l,$);return o.A.DotVV(o.A.SubVV(h,r,o.A.s_t0),i)}case E.e_faceB:{const i=o.t.MulRV(n.q,this.m_axis,D),r=o.z.MulXV(n,this.m_localPoint,$),a=o.t.MulTRV(s.q,o.A.NegV(i,o.A.s_t0),T);e[0]=-1,t[0]=this.m_proxyA.GetSupport(a);const l=this.m_proxyA.GetVertex(t[0]),h=o.z.MulXV(s,l,P);return o.A.DotVV(o.A.SubVV(h,r,o.A.s_t0),i)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,i){const s=k,n=I;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case E.e_points:{const i=this.m_proxyA.GetVertex(t),r=this.m_proxyB.GetVertex(e),a=o.z.MulXV(s,i,P),l=o.z.MulXV(n,r,$);return o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.m_axis)}case E.e_faceA:{const t=o.t.MulRV(s.q,this.m_axis,D),i=o.z.MulXV(s,this.m_localPoint,P),r=this.m_proxyB.GetVertex(e),a=o.z.MulXV(n,r,$);return o.A.DotVV(o.A.SubVV(a,i,o.A.s_t0),t)}case E.e_faceB:{const e=o.t.MulRV(n.q,this.m_axis,D),i=o.z.MulXV(n,this.m_localPoint,$),r=this.m_proxyA.GetVertex(t),a=o.z.MulXV(s,r,P);return o.A.DotVV(o.A.SubVV(a,i,o.A.s_t0),e)}default:return 0}}}const j=new l,N=new d.f,O=new d.b,z=new d.c,U=new q,J=[0],W=[0],H=new o.y,X=new o.y;function Z(t,e){const i=j.Reset();++w,t.state=R.e_unknown,t.t=e.tMax;const s=e.proxyA,r=e.proxyB,a=H.Copy(e.sweepA),l=X.Copy(e.sweepB);a.Normalize(),l.Normalize();const h=e.tMax,c=s.m_radius+r.m_radius,_=Object(o.m)(n.v,c-3*n.v),u=.25*n.v;let m=0;let p=0;const f=N;f.count=0;const y=O;for(y.proxyA=e.proxyA,y.proxyB=e.proxyB,y.useRadii=!1;;){const e=k,i=I;a.GetTransform(e,m),l.GetTransform(i,m),y.transformA.Copy(e),y.transformB.Copy(i);const c=z;if(Object(d.a)(c,f,y),c.distance<=0){t.state=R.e_overlapped,t.t=0;break}if(c.distance<_+u){t.state=R.e_touching,t.t=m;break}const g=U;g.Initialize(f,s,a,r,l,m);let v=!1,x=h,b=0;for(;;){const e=J,i=W;let s=g.FindMinSeparation(e,i,x);if(s>_+u){t.state=R.e_separated,t.t=h,v=!0;break}if(s>_-u){m=x;break}let r=g.Evaluate(e[0],i[0],m);if(r<_-u){t.state=R.e_failed,t.t=m,v=!0;break}if(r<=_+u){t.state=R.e_touching,t.t=m,v=!0;break}let a=0,l=m,c=x;for(;;){let t=0;t=1&a?l+(_-r)*(c-l)/(s-r):.5*(l+c),++a,++B;const n=g.Evaluate(e[0],i[0],t);if(Object(o.a)(n-_)<u){x=t;break}if(n>_?(l=t,r=n):(c=t,s=n),50===a)break}if(V=Object(o.m)(V,a),++b===n.D)break}if(++p,++S,v)break;if(20===p){t.state=R.e_failed,t.t=m;break}}C=Object(o.m)(C,p);const g=i.GetMilliseconds();A=Object(o.m)(A,g),b+=g}const Y=new o.A,Q=new o.A;function K(t,e,i,s,n){t.pointCount=0;const r=o.z.MulXV(i,e.m_p,Y),a=o.z.MulXV(n,s.m_p,Q),l=o.A.DistanceSquaredVV(r,a),h=e.m_radius+s.m_radius;l>h*h||(t.type=m.j.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0)}const tt=new o.A,et=new o.A,it=new o.A;function st(t,e,i,s,r){t.pointCount=0;const a=o.z.MulXV(r,s.m_p,tt),l=o.z.MulTXV(i,a,et);let h=0,c=-n.x;const _=e.m_radius+s.m_radius,u=e.m_count,d=e.m_vertices,p=e.m_normals;for(let t=0;t<u;++t){const e=o.A.DotVV(p[t],o.A.SubVV(l,d[t],o.A.s_t0));if(e>_)return;e>c&&(c=e,h=t)}const f=h,y=(f+1)%u,g=d[f],v=d[y];if(c<n.r)return t.pointCount=1,t.type=m.j.e_faceA,t.localNormal.Copy(p[h]),o.A.MidVV(g,v,t.localPoint),t.points[0].localPoint.Copy(s.m_p),void(t.points[0].id.key=0);const x=o.A.DotVV(o.A.SubVV(l,g,o.A.s_t0),o.A.SubVV(v,g,o.A.s_t1)),b=o.A.DotVV(o.A.SubVV(l,v,o.A.s_t0),o.A.SubVV(g,v,o.A.s_t1));if(x<=0){if(o.A.DistanceSquaredVV(l,g)>_*_)return;t.pointCount=1,t.type=m.j.e_faceA,o.A.SubVV(l,g,t.localNormal).SelfNormalize(),t.localPoint.Copy(g),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else if(b<=0){if(o.A.DistanceSquaredVV(l,v)>_*_)return;t.pointCount=1,t.type=m.j.e_faceA,o.A.SubVV(l,v,t.localNormal).SelfNormalize(),t.localPoint.Copy(v),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else{const e=o.A.MidVV(g,v,it);if((c=o.A.DotVV(o.A.SubVV(l,e,o.A.s_t1),p[f]))>_)return;t.pointCount=1,t.type=m.j.e_faceA,t.localNormal.Copy(p[f]).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}}const nt=new o.A,ot=new o.A,rt=new o.A,at=new o.A;function lt(t,e,i,s,r){const a=t.m_vertices,l=t.m_normals,h=s.m_count,c=s.m_vertices,_=o.t.MulRV(e.q,l[i],nt),u=o.t.MulTRV(r.q,_,ot);let m=0,d=n.x;for(let t=0;t<h;++t){const e=o.A.DotVV(c[t],u);e<d&&(d=e,m=t)}const p=o.z.MulXV(e,a[i],rt),f=o.z.MulXV(r,c[m],at);return o.A.DotVV(o.A.SubVV(f,p,o.A.s_t0),_)}const ht=new o.A,ct=new o.A;function _t(t,e,i,s,r){const a=e.m_count,l=e.m_normals,h=o.A.SubVV(o.z.MulXV(r,s.m_centroid,o.A.s_t0),o.z.MulXV(i,e.m_centroid,o.A.s_t1),ht),c=o.t.MulTRV(i.q,h,ct);let _=0,u=-n.x;for(let t=0;t<a;++t){const e=o.A.DotVV(l[t],c);e>u&&(u=e,_=t)}let m=lt(e,i,_,s,r);const d=(_+a-1)%a,p=lt(e,i,d,s,r),f=(_+1)%a,y=lt(e,i,f,s,r);let g=0,v=0,x=0;if(p>m&&p>y)x=-1,g=d,v=p;else{if(!(y>m))return t[0]=_,m;x=1,g=f,v=y}for(;(m=lt(e,i,_=-1===x?(g+a-1)%a:(g+1)%a,s,r))>v;)g=_,v=m;return t[0]=g,v}const ut=new o.A;const mt=m.c.MakeArray(2),dt=m.c.MakeArray(2),pt=m.c.MakeArray(2),ft=[0],yt=[0],gt=new o.A,vt=new o.A,xt=new o.A,bt=new o.A,At=new o.A,wt=new o.A,St=new o.A,Ct=new o.A;function Bt(t,e,i,s,r){t.pointCount=0;const a=e.m_radius+s.m_radius,l=ft;l[0]=0;const h=_t(l,e,i,s,r);if(h>a)return;const c=yt;c[0]=0;const _=_t(c,s,r,e,i);if(_>a)return;let u,d,p,f,y=0,g=0;_>.98*h+.001?(u=s,d=e,p=r,f=i,y=c[0],t.type=m.j.e_faceB,g=1):(u=e,d=s,p=i,f=r,y=l[0],t.type=m.j.e_faceA,g=0);const v=mt;!function(t,e,i,s,r,a){const l=e.m_normals,h=r.m_count,c=r.m_vertices,_=r.m_normals,u=o.t.MulTRV(a.q,o.t.MulRV(i.q,l[s],o.A.s_t0),ut);let d=0,p=n.x;for(let t=0;t<h;++t){const e=o.A.DotVV(u,_[t]);e<p&&(p=e,d=t)}const f=d,y=(f+1)%h,g=t[0];o.z.MulXV(a,c[f],g.v);const v=g.id.cf;v.indexA=s,v.indexB=f,v.typeA=m.e.e_face,v.typeB=m.e.e_vertex;const x=t[1];o.z.MulXV(a,c[y],x.v);const b=x.id.cf;b.indexA=s,b.indexB=y,b.typeA=m.e.e_face,b.typeB=m.e.e_vertex}(v,u,p,y,d,f);const x=u.m_count,b=u.m_vertices,A=y,w=(y+1)%x,S=b[A],C=b[w],B=o.A.SubVV(C,S,gt);B.Normalize();const V=o.A.CrossVOne(B,vt),M=o.A.MidVV(S,C,xt),k=o.t.MulRV(p.q,B,At),I=o.A.CrossVOne(k,bt),P=o.z.MulXV(p,S,St),$=o.z.MulXV(p,C,Ct),D=o.A.DotVV(I,P),T=-o.A.DotVV(k,P)+a,G=o.A.DotVV(k,$)+a,L=dt,R=pt;let E;const F=o.A.NegV(k,wt);if((E=Object(m.b)(L,v,F,T,A))<2)return;if((E=Object(m.b)(R,L,k,G,w))<2)return;t.localNormal.Copy(V),t.localPoint.Copy(M);let q=0;for(let e=0;e<n.z;++e){const i=R[e];if(o.A.DotVV(I,i.v)-D<=a){const e=t.points[q];if(o.z.MulTXV(f,i.v,e.localPoint),e.id.Copy(i.id),g){const t=e.id.cf;e.id.cf.indexA=t.indexB,e.id.cf.indexB=t.indexA,e.id.cf.typeA=t.typeB,e.id.cf.typeB=t.typeA}++q}}t.pointCount=q}const Vt=new o.A,Mt=new o.A,kt=new o.A,It=new o.A,Pt=new o.A,$t=new o.A,Dt=new o.A,Tt=new m.f;function Gt(t,e,i,s,n){t.pointCount=0;const r=o.z.MulTXV(i,o.z.MulXV(n,s.m_p,o.A.s_t0),Vt),a=e.m_vertex1,l=e.m_vertex2,h=o.A.SubVV(l,a,Mt),c=o.A.DotVV(h,o.A.SubVV(l,r,o.A.s_t0)),_=o.A.DotVV(h,o.A.SubVV(r,a,o.A.s_t0)),u=e.m_radius+s.m_radius,d=Tt;if(d.cf.indexB=0,d.cf.typeB=m.e.e_vertex,_<=0){const i=a,n=o.A.SubVV(r,i,kt);if(o.A.DotVV(n,n)>u*u)return;if(e.m_hasVertex0){const t=e.m_vertex0,i=a,s=o.A.SubVV(i,t,It);if(o.A.DotVV(s,o.A.SubVV(i,r,o.A.s_t0))>0)return}return d.cf.indexA=0,d.cf.typeA=m.e.e_vertex,t.pointCount=1,t.type=m.j.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(d),void t.points[0].localPoint.Copy(s.m_p)}if(c<=0){const i=l,n=o.A.SubVV(r,i,kt);if(o.A.DotVV(n,n)>u*u)return;if(e.m_hasVertex3){const t=e.m_vertex3,i=l,s=o.A.SubVV(t,i,Pt);if(o.A.DotVV(s,o.A.SubVV(r,i,o.A.s_t0))>0)return}return d.cf.indexA=1,d.cf.typeA=m.e.e_vertex,t.pointCount=1,t.type=m.j.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(d),void t.points[0].localPoint.Copy(s.m_p)}const p=o.A.DotVV(h,h),f=$t;f.x=1/p*(c*a.x+_*l.x),f.y=1/p*(c*a.y+_*l.y);const y=o.A.SubVV(r,f,kt);if(o.A.DotVV(y,y)>u*u)return;const g=Dt.Set(-h.y,h.x);o.A.DotVV(g,o.A.SubVV(r,a,o.A.s_t0))<0&&g.Set(-g.x,-g.y),g.Normalize(),d.cf.indexA=0,d.cf.typeA=m.e.e_face,t.pointCount=1,t.type=m.j.e_faceA,t.localNormal.Copy(g),t.localPoint.Copy(a),t.points[0].id.Copy(d),t.points[0].localPoint.Copy(s.m_p)}class Lt{constructor(){this.type=0,this.index=0,this.separation=0}}class Rt{constructor(){this.vertices=o.A.MakeArray(n.D),this.normals=o.A.MakeArray(n.D),this.count=0}}class Et{constructor(){this.m_polygonB=new Rt,this.m_xf=new o.z,this.m_centroidB=new o.A,this.m_v0=new o.A,this.m_v1=new o.A,this.m_v2=new o.A,this.m_v3=new o.A,this.m_normal0=new o.A,this.m_normal1=new o.A,this.m_normal2=new o.A,this.m_normal=new o.A,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new o.A,this.m_upperLimit=new o.A,this.m_radius=0,this.m_front=!1}Collide(t,e,i,s,r){o.z.MulTXX(i,r,this.m_xf),o.z.MulXV(this.m_xf,s.m_centroid,this.m_centroidB),this.m_v0.Copy(e.m_vertex0),this.m_v1.Copy(e.m_vertex1),this.m_v2.Copy(e.m_vertex2),this.m_v3.Copy(e.m_vertex3);const a=e.m_hasVertex0,l=e.m_hasVertex3,h=o.A.SubVV(this.m_v2,this.m_v1,Et.s_edge1);h.Normalize(),this.m_normal1.Set(h.y,-h.x);const c=o.A.DotVV(this.m_normal1,o.A.SubVV(this.m_centroidB,this.m_v1,o.A.s_t0));let _=0,u=0,d=!1,p=!1;if(a){const t=o.A.SubVV(this.m_v1,this.m_v0,Et.s_edge0);t.Normalize(),this.m_normal0.Set(t.y,-t.x),d=o.A.CrossVV(t,h)>=0,_=o.A.DotVV(this.m_normal0,o.A.SubVV(this.m_centroidB,this.m_v0,o.A.s_t0))}if(l){const t=o.A.SubVV(this.m_v3,this.m_v2,Et.s_edge2);t.Normalize(),this.m_normal2.Set(t.y,-t.x),p=o.A.CrossVV(h,t)>0,u=o.A.DotVV(this.m_normal2,o.A.SubVV(this.m_centroidB,this.m_v2,o.A.s_t0))}a&&l?d&&p?(this.m_front=_>=0||c>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=_>=0||c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=u>=0||_>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=_>=0&&c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?d?(this.m_front=_>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=_>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?p?(this.m_front=c>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count;for(let t=0;t<s.m_count;++t)o.z.MulXV(this.m_xf,s.m_vertices[t],this.m_polygonB.vertices[t]),o.t.MulRV(this.m_xf.q,s.m_normals[t],this.m_polygonB.normals[t]);this.m_radius=2*n.Q,t.pointCount=0;const f=this.ComputeEdgeSeparation(Et.s_edgeAxis);if(0===f.type)return;if(f.separation>this.m_radius)return;const y=this.ComputePolygonSeparation(Et.s_polygonAxis);if(0!==y.type&&y.separation>this.m_radius)return;let g;g=0===y.type?f:y.separation>.98*f.separation+.001?y:f;const v=Et.s_ie,x=Et.s_rf;if(1===g.type){t.type=m.j.e_faceA;let e=0,i=o.A.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(let t=1;t<this.m_polygonB.count;++t){const s=o.A.DotVV(this.m_normal,this.m_polygonB.normals[t]);s<i&&(i=s,e=t)}const s=e,n=(s+1)%this.m_polygonB.count,r=v[0];r.v.Copy(this.m_polygonB.vertices[s]),r.id.cf.indexA=0,r.id.cf.indexB=s,r.id.cf.typeA=m.e.e_face,r.id.cf.typeB=m.e.e_vertex;const a=v[1];a.v.Copy(this.m_polygonB.vertices[n]),a.id.cf.indexA=0,a.id.cf.indexB=n,a.id.cf.typeA=m.e.e_face,a.id.cf.typeB=m.e.e_vertex,this.m_front?(x.i1=0,x.i2=1,x.v1.Copy(this.m_v1),x.v2.Copy(this.m_v2),x.normal.Copy(this.m_normal1)):(x.i1=1,x.i2=0,x.v1.Copy(this.m_v2),x.v2.Copy(this.m_v1),x.normal.Copy(this.m_normal1).SelfNeg())}else{t.type=m.j.e_faceB;const e=v[0];e.v.Copy(this.m_v1),e.id.cf.indexA=0,e.id.cf.indexB=g.index,e.id.cf.typeA=m.e.e_vertex,e.id.cf.typeB=m.e.e_face;const i=v[1];i.v.Copy(this.m_v2),i.id.cf.indexA=0,i.id.cf.indexB=g.index,i.id.cf.typeA=m.e.e_vertex,i.id.cf.typeB=m.e.e_face,x.i1=g.index,x.i2=(x.i1+1)%this.m_polygonB.count,x.v1.Copy(this.m_polygonB.vertices[x.i1]),x.v2.Copy(this.m_polygonB.vertices[x.i2]),x.normal.Copy(this.m_polygonB.normals[x.i1])}x.sideNormal1.Set(x.normal.y,-x.normal.x),x.sideNormal2.Copy(x.sideNormal1).SelfNeg(),x.sideOffset1=o.A.DotVV(x.sideNormal1,x.v1),x.sideOffset2=o.A.DotVV(x.sideNormal2,x.v2);const b=Et.s_clipPoints1,A=Et.s_clipPoints2;let w=0;if((w=Object(m.b)(b,v,x.sideNormal1,x.sideOffset1,x.i1))<n.z)return;if((w=Object(m.b)(A,b,x.sideNormal2,x.sideOffset2,x.i2))<n.z)return;1===g.type?(t.localNormal.Copy(x.normal),t.localPoint.Copy(x.v1)):(t.localNormal.Copy(s.m_normals[x.i1]),t.localPoint.Copy(s.m_vertices[x.i1]));let S=0;for(let e=0;e<n.z;++e){let i;if((i=o.A.DotVV(x.normal,o.A.SubVV(A[e].v,x.v1,o.A.s_t0)))<=this.m_radius){const i=t.points[S];1===g.type?(o.z.MulTXV(this.m_xf,A[e].v,i.localPoint),i.id=A[e].id):(i.localPoint.Copy(A[e].v),i.id.cf.typeA=A[e].id.cf.typeB,i.id.cf.typeB=A[e].id.cf.typeA,i.id.cf.indexA=A[e].id.cf.indexB,i.id.cf.indexB=A[e].id.cf.indexA),++S}}t.pointCount=S}ComputeEdgeSeparation(t){const e=t;e.type=1,e.index=this.m_front?0:1,e.separation=n.x;for(let t=0;t<this.m_polygonB.count;++t){const i=o.A.DotVV(this.m_normal,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v1,o.A.s_t0));i<e.separation&&(e.separation=i)}return e}ComputePolygonSeparation(t){const e=t;e.type=0,e.index=-1,e.separation=-n.x;const i=Et.s_perp.Set(-this.m_normal.y,this.m_normal.x);for(let t=0;t<this.m_polygonB.count;++t){const s=o.A.NegV(this.m_polygonB.normals[t],Et.s_n),r=o.A.DotVV(s,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v1,o.A.s_t0)),a=o.A.DotVV(s,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v2,o.A.s_t0)),l=Object(o.n)(r,a);if(l>this.m_radius)return e.type=2,e.index=t,e.separation=l,e;if(o.A.DotVV(s,i)>=0){if(o.A.DotVV(o.A.SubVV(s,this.m_upperLimit,o.A.s_t0),this.m_normal)<-n.n)continue}else if(o.A.DotVV(o.A.SubVV(s,this.m_lowerLimit,o.A.s_t0),this.m_normal)<-n.n)continue;l>e.separation&&(e.type=2,e.index=t,e.separation=l)}return e}}Et.s_edge1=new o.A,Et.s_edge0=new o.A,Et.s_edge2=new o.A,Et.s_ie=m.c.MakeArray(2),Et.s_rf=new class{constructor(){this.i1=0,this.i2=0,this.v1=new o.A,this.v2=new o.A,this.normal=new o.A,this.sideNormal1=new o.A,this.sideOffset1=0,this.sideNormal2=new o.A,this.sideOffset2=0}},Et.s_clipPoints1=m.c.MakeArray(2),Et.s_clipPoints2=m.c.MakeArray(2),Et.s_edgeAxis=new Lt,Et.s_polygonAxis=new Lt,Et.s_n=new o.A,Et.s_perp=new o.A;const Ft=new Et;function qt(t,e,i,s,n){Ft.Collide(t,e,i,s,n)}var jt=i(348);class Nt extends jt.b{constructor(t=0){super(jt.c.e_circleShape,t),this.m_p=new o.A}Clone(){return(new Nt).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const i=o.z.MulXV(t,this.m_p,Nt.TestPoint_s_center),s=o.A.SubVV(e,i,Nt.TestPoint_s_d);return o.A.DotVV(s,s)<=Object(o.v)(this.m_radius)}ComputeDistance(t,e,i,s){const n=o.z.MulXV(t,this.m_p,Nt.ComputeDistance_s_center);return o.A.SubVV(e,n,i),i.Normalize()-this.m_radius}RayCast(t,e,i,s){const r=o.z.MulXV(i,this.m_p,Nt.RayCast_s_position),a=o.A.SubVV(e.p1,r,Nt.RayCast_s_s),l=o.A.DotVV(a,a)-Object(o.v)(this.m_radius),h=o.A.SubVV(e.p2,e.p1,Nt.RayCast_s_r),c=o.A.DotVV(a,h),_=o.A.DotVV(h,h),u=c*c-_*l;if(u<0||_<n.r)return!1;let m=-(c+Object(o.w)(u));return 0<=m&&m<=e.maxFraction*_&&(m/=_,t.fraction=m,o.A.AddVMulSV(a,m,h,t.normal).SelfNormalize(),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_p,Nt.ComputeAABB_s_p);t.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}ComputeMass(t,e){const i=Object(o.v)(this.m_radius);t.mass=e*n.P*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+o.A.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){const r=o.z.MulXV(i,this.m_p,new o.A),a=-(o.A.DotVV(t,r)-e);if(a<-this.m_radius+n.r)return 0;if(a>this.m_radius)return s.Copy(r),n.P*this.m_radius*this.m_radius;const l=this.m_radius*this.m_radius,h=a*a,c=l*(Object(o.c)(a/this.m_radius)+n.P/2)+a*Object(o.w)(l-h),_=-2/3*Object(o.p)(l-h,1.5)/c;return s.x=r.x+t.x*_,s.y=r.y+t.y*_,c}Dump(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}Nt.TestPoint_s_center=new o.A,Nt.TestPoint_s_d=new o.A,Nt.ComputeDistance_s_center=new o.A,Nt.RayCast_s_position=new o.A,Nt.RayCast_s_s=new o.A,Nt.RayCast_s_r=new o.A,Nt.ComputeAABB_s_p=new o.A;class Ot extends jt.b{constructor(){super(jt.c.e_polygonShape,n.Q),this.m_centroid=new o.A(0,0),this.m_vertices=o.A.MakeArray(n.D),this.m_normals=o.A.MakeArray(n.D),this.m_count=0}Clone(){return(new Ot).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count;for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(t,e=t.length,i=0){if(e<3)return this.SetAsBox(1,1);let s=Object(o.n)(e,n.D);const r=Ot.Set_s_ps;let a=0;for(let e=0;e<s;++e){const s=t[i+e];let l=!0;for(let t=0;t<a;++t)if(o.A.DistanceSquaredVV(s,r[t])<.5*n.v*(.5*n.v)){l=!1;break}l&&r[a++].Copy(s)}if((s=a)<3)return this.SetAsBox(1,1);let l=0,h=r[0].x;for(let t=1;t<s;++t){const e=r[t].x;(e>h||e===h&&r[t].y<r[l].y)&&(l=t,h=e)}const c=Ot.Set_s_hull;let _=0,u=l;for(;;){c[_]=u;let t=0;for(let e=1;e<s;++e){if(t===u){t=e;continue}const i=o.A.SubVV(r[t],r[c[_]],Ot.Set_s_r),s=o.A.SubVV(r[e],r[c[_]],Ot.Set_s_v),n=o.A.CrossVV(i,s);n<0&&(t=e),0===n&&s.LengthSquared()>i.LengthSquared()&&(t=e)}if(++_,u=t,t===l)break}this.m_count=_;for(let t=0;t<_;++t)this.m_vertices[t].Copy(r[c[t]]);for(let t=0;t<_;++t){const e=this.m_vertices[t],i=this.m_vertices[(t+1)%_],s=o.A.SubVV(i,e,o.A.s_t0);o.A.CrossVOne(s,this.m_normals[t]).SelfNormalize()}return Ot.ComputeCentroid(this.m_vertices,_,this.m_centroid),this}SetAsArray(t,e=t.length){return this.Set(t,e)}SetAsBox(t,e,i,s=0){if(this.m_count=4,this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i instanceof o.A){this.m_centroid.Copy(i);const t=new o.z;t.SetPosition(i),t.SetRotationAngle(s);for(let e=0;e<this.m_count;++e)o.z.MulXV(t,this.m_vertices[e],this.m_vertices[e]),o.t.MulRV(t.q,this.m_normals[e],this.m_normals[e])}return this}TestPoint(t,e){const i=o.z.MulTXV(t,e,Ot.TestPoint_s_pLocal);for(let t=0;t<this.m_count;++t){if(o.A.DotVV(this.m_normals[t],o.A.SubVV(i,this.m_vertices[t],o.A.s_t0))>0)return!1}return!0}ComputeDistance(t,e,i,s){const r=o.z.MulTXV(t,e,Ot.ComputeDistance_s_pLocal);let a=-n.x;const l=Ot.ComputeDistance_s_normalForMaxDistance.Copy(r);for(let t=0;t<this.m_count;++t){const e=o.A.DotVV(this.m_normals[t],o.A.SubVV(r,this.m_vertices[t],o.A.s_t0));e>a&&(a=e,l.Copy(this.m_normals[t]))}if(a>0){const e=Ot.ComputeDistance_s_minDistance.Copy(l);let s=a*a;for(let t=0;t<this.m_count;++t){const i=o.A.SubVV(r,this.m_vertices[t],Ot.ComputeDistance_s_distance),n=i.LengthSquared();s>n&&(e.Copy(i),s=n)}return o.t.MulRV(t.q,e,i),i.Normalize(),Math.sqrt(s)}return o.t.MulRV(t.q,l,i),a}RayCast(t,e,i,s){const n=o.z.MulTXV(i,e.p1,Ot.RayCast_s_p1),r=o.z.MulTXV(i,e.p2,Ot.RayCast_s_p2),a=o.A.SubVV(r,n,Ot.RayCast_s_d);let l=0,h=e.maxFraction,c=-1;for(let t=0;t<this.m_count;++t){const e=o.A.DotVV(this.m_normals[t],o.A.SubVV(this.m_vertices[t],n,o.A.s_t0)),i=o.A.DotVV(this.m_normals[t],a);if(0===i){if(e<0)return!1}else i<0&&e<l*i?(l=e/i,c=t):i>0&&e<h*i&&(h=e/i);if(h<l)return!1}return c>=0&&(t.fraction=l,o.t.MulRV(i.q,this.m_normals[c],t.normal),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(s);for(let t=0;t<this.m_count;++t){const i=o.z.MulXV(e,this.m_vertices[t],Ot.ComputeAABB_s_v);o.A.MinV(i,s,s),o.A.MaxV(i,n,n)}const r=this.m_radius;s.SelfSubXY(r,r),n.SelfAddXY(r,r)}ComputeMass(t,e){const i=Ot.ComputeMass_s_center.SetZero();let s=0,n=0;const r=Ot.ComputeMass_s_s.SetZero();for(let t=0;t<this.m_count;++t)r.SelfAdd(this.m_vertices[t]);r.SelfMul(1/this.m_count);for(let t=0;t<this.m_count;++t){const e=o.A.SubVV(this.m_vertices[t],r,Ot.ComputeMass_s_e1),a=o.A.SubVV(this.m_vertices[(t+1)%this.m_count],r,Ot.ComputeMass_s_e2),l=o.A.CrossVV(e,a),h=.5*l;s+=h,i.SelfAdd(o.A.MulSV(h*(1/3),o.A.AddVV(e,a,o.A.s_t0),o.A.s_t1));const c=e.x,_=e.y,u=a.x,m=a.y;n+=1/3*.25*l*(c*c+u*c+u*u+(_*_+m*_+m*m))}t.mass=e*s,i.SelfMul(1/s),o.A.AddVV(i,r,t.center),t.I=e*n,t.I+=t.mass*(o.A.DotVV(t.center,t.center)-o.A.DotVV(i,i))}Validate(){for(let t=0;t<this.m_count;++t){const e=t,i=(t+1)%this.m_count,s=this.m_vertices[e],n=o.A.SubVV(this.m_vertices[i],s,Ot.Validate_s_e);for(let t=0;t<this.m_count;++t){if(t===e||t===i)continue;const r=o.A.SubVV(this.m_vertices[t],s,Ot.Validate_s_v);if(o.A.CrossVV(n,r)<0)return!1}}return!0}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){const r=o.t.MulTRV(i.q,t,Ot.ComputeSubmergedArea_s_normalL),a=e-o.A.DotVV(t,i.p),l=Ot.ComputeSubmergedArea_s_depths;let h=0,c=-1,_=-1,u=!1;for(let t=0;t<this.m_count;++t){l[t]=o.A.DotVV(r,this.m_vertices[t])-a;const e=l[t]<-n.r;t>0&&(e?u||(c=t-1,h++):u&&(_=t-1,h++)),u=e}switch(h){case 0:if(u){const t=Ot.ComputeSubmergedArea_s_md;return this.ComputeMass(t,1),o.z.MulXV(i,t.center,s),t.mass}return 0;case 1:-1===c?c=this.m_count-1:_=this.m_count-1}const m=(c+1)%this.m_count,d=(_+1)%this.m_count,p=(0-l[c])/(l[m]-l[c]),f=(0-l[_])/(l[d]-l[_]),y=Ot.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[c].x*(1-p)+this.m_vertices[m].x*p,this.m_vertices[c].y*(1-p)+this.m_vertices[m].y*p),g=Ot.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[_].x*(1-f)+this.m_vertices[d].x*f,this.m_vertices[_].y*(1-f)+this.m_vertices[d].y*f);let v=0;const x=Ot.ComputeSubmergedArea_s_center.SetZero();let b,A=this.m_vertices[m],w=m;for(;w!==d;){b=(w=(w+1)%this.m_count)===d?g:this.m_vertices[w];const t=.5*((A.x-y.x)*(b.y-y.y)-(A.y-y.y)*(b.x-y.x));v+=t,x.x+=t*(y.x+A.x+b.x)/3,x.y+=t*(y.y+A.y+b.y)/3,A=b}return x.SelfMul(1/v),o.z.MulXV(i,x,s),v}Dump(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.D);for(let e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}static ComputeCentroid(t,e,i){const s=i;s.SetZero();let n=0;const r=Ot.ComputeCentroid_s_pRef.SetZero();for(let i=0;i<e;++i){const a=r,l=t[i],h=t[(i+1)%e],c=o.A.SubVV(l,a,Ot.ComputeCentroid_s_e1),_=o.A.SubVV(h,a,Ot.ComputeCentroid_s_e2),u=.5*o.A.CrossVV(c,_);n+=u,s.x+=u*(1/3)*(a.x+l.x+h.x),s.y+=u*(1/3)*(a.y+l.y+h.y)}return s.SelfMul(1/n),s}}Ot.Set_s_ps=o.A.MakeArray(n.D),Ot.Set_s_hull=Object(n.g)(n.D),Ot.Set_s_r=new o.A,Ot.Set_s_v=new o.A,Ot.TestPoint_s_pLocal=new o.A,Ot.ComputeDistance_s_pLocal=new o.A,Ot.ComputeDistance_s_normalForMaxDistance=new o.A,Ot.ComputeDistance_s_minDistance=new o.A,Ot.ComputeDistance_s_distance=new o.A,Ot.RayCast_s_p1=new o.A,Ot.RayCast_s_p2=new o.A,Ot.RayCast_s_d=new o.A,Ot.ComputeAABB_s_v=new o.A,Ot.ComputeMass_s_center=new o.A,Ot.ComputeMass_s_s=new o.A,Ot.ComputeMass_s_e1=new o.A,Ot.ComputeMass_s_e2=new o.A,Ot.Validate_s_e=new o.A,Ot.Validate_s_v=new o.A,Ot.ComputeSubmergedArea_s_normalL=new o.A,Ot.ComputeSubmergedArea_s_depths=Object(n.g)(n.D),Ot.ComputeSubmergedArea_s_md=new jt.a,Ot.ComputeSubmergedArea_s_intoVec=new o.A,Ot.ComputeSubmergedArea_s_outoVec=new o.A,Ot.ComputeSubmergedArea_s_center=new o.A,Ot.ComputeCentroid_s_pRef=new o.A,Ot.ComputeCentroid_s_e1=new o.A,Ot.ComputeCentroid_s_e2=new o.A;class zt extends jt.b{constructor(){super(jt.c.e_edgeShape,n.Q),this.m_vertex1=new o.A,this.m_vertex2=new o.A,this.m_vertex0=new o.A,this.m_vertex3=new o.A,this.m_hasVertex0=!1,this.m_hasVertex3=!1}Set(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}Clone(){return(new zt).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}GetChildCount(){return 1}TestPoint(t,e){return!1}ComputeDistance(t,e,i,s){const n=o.z.MulXV(t,this.m_vertex1,zt.ComputeDistance_s_v1),r=o.z.MulXV(t,this.m_vertex2,zt.ComputeDistance_s_v2),a=o.A.SubVV(e,n,zt.ComputeDistance_s_d),l=o.A.SubVV(r,n,zt.ComputeDistance_s_s),h=o.A.DotVV(a,l);if(h>0){const t=o.A.DotVV(l,l);h>t?o.A.SubVV(e,r,a):a.SelfMulSub(h/t,l)}return i.Copy(a),i.Normalize()}RayCast(t,e,i,s){const n=o.z.MulTXV(i,e.p1,zt.RayCast_s_p1),r=o.z.MulTXV(i,e.p2,zt.RayCast_s_p2),a=o.A.SubVV(r,n,zt.RayCast_s_d),l=this.m_vertex1,h=this.m_vertex2,c=o.A.SubVV(h,l,zt.RayCast_s_e),_=t.normal.Set(c.y,-c.x).SelfNormalize(),u=o.A.DotVV(_,o.A.SubVV(l,n,o.A.s_t0)),m=o.A.DotVV(_,a);if(0===m)return!1;const d=u/m;if(d<0||e.maxFraction<d)return!1;const p=o.A.AddVMulSV(n,d,a,zt.RayCast_s_q),f=o.A.SubVV(h,l,zt.RayCast_s_r),y=o.A.DotVV(f,f);if(0===y)return!1;const g=o.A.DotVV(o.A.SubVV(p,l,o.A.s_t0),f)/y;return!(g<0||1<g)&&(t.fraction=d,o.t.MulRV(i.q,t.normal,t.normal),u>0&&t.normal.SelfNeg(),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_vertex1,zt.ComputeAABB_s_v1),n=o.z.MulXV(e,this.m_vertex2,zt.ComputeAABB_s_v2);o.A.MinV(s,n,t.lowerBound),o.A.MaxV(s,n,t.upperBound);const r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)}ComputeMass(t,e){t.mass=0,o.A.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}zt.ComputeDistance_s_v1=new o.A,zt.ComputeDistance_s_v2=new o.A,zt.ComputeDistance_s_d=new o.A,zt.ComputeDistance_s_s=new o.A,zt.RayCast_s_p1=new o.A,zt.RayCast_s_p2=new o.A,zt.RayCast_s_d=new o.A,zt.RayCast_s_e=new o.A,zt.RayCast_s_q=new o.A,zt.RayCast_s_r=new o.A,zt.ComputeAABB_s_v1=new o.A,zt.ComputeAABB_s_v2=new o.A;class Ut extends jt.b{constructor(){super(jt.c.e_chainShape,n.Q),this.m_count=0,this.m_prevVertex=new o.A,this.m_nextVertex=new o.A,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1}CreateLoop(t,e=t.length){this.m_count=e+1,this.m_vertices=o.A.MakeArray(this.m_count);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}CreateChain(t,e=t.length){this.m_count=e,this.m_vertices=o.A.MakeArray(e);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}SetPrevVertex(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}SetNextVertex(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}Clone(){return(new Ut).Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}GetChildCount(){return this.m_count-1}GetChildEdge(t,e){t.m_type=jt.c.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}TestPoint(t,e){return!1}ComputeDistance(t,e,i,s){const n=Ut.ComputeDistance_s_edgeShape;return this.GetChildEdge(n,s),n.ComputeDistance(t,e,i,0)}RayCast(t,e,i,s){const n=Ut.RayCast_s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[s]),n.m_vertex2.Copy(this.m_vertices[(s+1)%this.m_count]),n.RayCast(t,e,i,0)}ComputeAABB(t,e,i){const s=this.m_vertices[i],n=this.m_vertices[(i+1)%this.m_count],r=o.z.MulXV(e,s,Ut.ComputeAABB_s_v1),a=o.z.MulXV(e,n,Ut.ComputeAABB_s_v2);o.A.MinV(r,a,t.lowerBound),o.A.MaxV(r,a,t.upperBound)}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.D);for(let e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}Ut.ComputeDistance_s_edgeShape=new zt,Ut.RayCast_s_edgeShape=new zt,Ut.ComputeAABB_s_v1=new o.A,Ut.ComputeAABB_s_v2=new o.A;var Jt,Wt,Ht,Xt=i(361);!function(t){t[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"}(Jt||(Jt={}));class Zt{constructor(){this.type=Jt.b2_staticBody,this.position=new o.A(0,0),this.angle=0,this.linearVelocity=new o.A(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}}class Yt{constructor(t,e){this.m_type=Jt.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new o.z,this.m_xf0=new o.z,this.m_sweep=new o.y,this.m_linearVelocity=new o.A,this.m_angularVelocity=0,this.m_force=new o.A,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,t.bullet&&(this.m_bulletFlag=!0),t.fixedRotation&&(this.m_fixedRotationFlag=!0),t.allowSleep&&(this.m_autoSleepFlag=!0),t.awake&&(this.m_awakeFlag=!0),t.active&&(this.m_activeFlag=!0),this.m_world=e,this.m_xf.p.Copy(t.position),this.m_xf.q.SetAngle(t.angle),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=t.angle,this.m_sweep.a=t.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_gravityScale=t.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,t.type===Jt.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}CreateFixture(t,e){if(t instanceof Xt.c)return this.CreateFixtureDef(t);if(t instanceof jt.b&&"number"==typeof e)return this.CreateFixtureShapeDensity(t,e);throw new Error}CreateFixtureDef(t){if(this.m_world.IsLocked())return null;const e=new Xt.b(t,this);if(e.Create(t),this.m_activeFlag){const t=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(t,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}CreateFixtureShapeDensity(t,e=0){const i=Yt.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)}DestroyFixture(t){if(this.m_world.IsLocked())return;let e=this.m_fixtureList,i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}let s=this.m_contactList;for(;s;){const e=s.contact;s=s.next;const i=e.GetFixtureA(),n=e.GetFixtureB();t!==i&&t!==n||this.m_world.m_contactManager.Destroy(e)}if(this.m_activeFlag){const e=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(e)}t.Destroy(),t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,i){if(this.m_world.IsLocked())return;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;const s=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(t){this.SetTransformVec(t,this.GetAngle())}SetPositionXY(t,e){this.SetTransformXY(t,e,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==Jt.b2_staticBody&&(o.A.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==Jt.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}ApplyForce(t,e,i=!0){this.m_type===Jt.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===Jt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===Jt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,i=!0){this.m_type===Jt.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===Jt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===Jt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*o.A.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*o.A.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(t){if(this.m_world.IsLocked())return;if(this.m_type!==Jt.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*o.A.DotVV(t.center,t.center),this.m_invI=1/this.m_I);const e=Yt.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(this.m_sweep.c,e,o.A.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===Jt.b2_staticBody||this.m_type===Jt.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const t=Yt.ResetMassData_s_localCenter.SetZero();for(let e=this.m_fixtureList;e;e=e.m_next){if(0===e.m_density)continue;const i=e.GetMassData(Yt.ResetMassData_s_massData);this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*o.A.DotVV(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=Yt.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(this.m_sweep.c,e,o.A.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return o.z.MulXV(this.m_xf,t,e)}GetWorldVector(t,e){return o.t.MulRV(this.m_xf.q,t,e)}GetLocalPoint(t,e){return o.z.MulTXV(this.m_xf,t,e)}GetLocalVector(t,e){return o.t.MulTRV(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(t,this.m_sweep.c,o.A.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if(this.m_world.IsLocked())return;if(this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===Jt.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;const i=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next){const e=t.m_proxyCount;for(let s=0;s<e;++s)i.TouchProxy(t.m_proxies[s].treeNode)}}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){t?this.m_awakeFlag||(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}IsAwake(){return this.m_awakeFlag}SetActive(t){if(t!==this.IsActive())if(this.m_activeFlag=t,t){const t=this.m_world.m_contactManager.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(t,this.m_xf)}else{const t=this.m_world.m_contactManager.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies(t);let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null}}IsActive(){return this.m_activeFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}Dump(t){const e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");let i="";switch(this.m_type){case Jt.b2_staticBody:i="b2BodyType.b2_staticBody";break;case Jt.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case Jt.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(let i=this.m_fixtureList;i;i=i.m_next)t("  {\n"),i.Dump(t,e),t("  }\n");t("}\n")}SynchronizeFixtures(){const t=Yt.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),o.t.MulRV(t.q,this.m_sweep.localCenter,t.p),o.A.SubVV(this.m_sweep.c0,t.p,t.p);const e=this.m_world.m_contactManager.m_broadPhase;for(let i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(e,t,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a),o.t.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.A.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return(this.m_type!==Jt.b2_staticBody||t.m_type!==Jt.b2_staticBody)&&this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),o.t.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.A.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}Yt.CreateFixtureShapeDensity_s_def=new Xt.c,Yt.SetMassData_s_oldCenter=new o.A,Yt.ResetMassData_s_localCenter=new o.A,Yt.ResetMassData_s_oldCenter=new o.A,Yt.ResetMassData_s_massData=new jt.a,Yt.SynchronizeFixtures_s_xf1=new o.z,function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"}(Wt||(Wt={})),function(t){t[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits"}(Ht||(Ht={}));class Qt{constructor(){this.linear=new o.A,this.angularA=0,this.angularB=0}SetZero(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}Set(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}class Kt{constructor(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e}}class te{constructor(t){this.type=Wt.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1,this.type=t}}class ee{constructor(t){this.m_type=Wt.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new Kt(this,t.bodyB),this.m_edgeB=new Kt(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_userData=t.userData}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetAnchorA(t){return t.SetZero()}GetAnchorB(t){return t.SetZero()}GetReactionForce(t,e){return e.SetZero()}GetReactionTorque(t){return 0}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsActive(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}GetCollideConnected(){return this.m_collideConnected}Dump(t){t("// Dump is not supported for this joint type.\n")}ShiftOrigin(t){}InitVelocityConstraints(t){}SolveVelocityConstraints(t){}SolvePositionConstraints(t){return!1}}class ie extends te{constructor(){super(Wt.e_distanceJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.length=1,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=o.A.DistanceVV(i,s),this.frequencyHz=0,this.dampingRatio=0}}class se extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_gamma=0,this.m_impulse=0,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=t.length}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){this.m_length=t}Length(){return this.m_length}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(u,this.m_lalcB,this.m_rB),this.m_u.x=a.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-e.y-this.m_rA.y;const m=this.m_u.Length();m>n.v?this.m_u.SelfMul(1/m):this.m_u.SetZero();const d=o.A.CrossVV(this.m_rA,this.m_u),p=o.A.CrossVV(this.m_rB,this.m_u);let f=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=0!==f?1/f:0,this.m_frequencyHz>0){const e=m-this.m_length,i=2*n.P*this.m_frequencyHz,s=2*this.m_mass*this.m_dampingRatio*i,o=this.m_mass*i*i,r=t.step.dt;this.m_gamma=r*(s+r*o),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=e*r*o*this.m_gamma,f+=this.m_gamma,this.m_mass=0!==f?1/f:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(this.m_impulse,this.m_u,se.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*o.A.CrossVV(this.m_rA,e),h.SelfMulAdd(this.m_invMassB,e),c+=this.m_invIB*o.A.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,se.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,se.SolveVelocityConstraints_s_vpB),l=o.A.DotVV(this.m_u,o.A.SubVV(a,r,o.A.s_t0)),h=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=h;const c=o.A.MulSV(h,this.m_u,se.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*o.A.CrossVV(this.m_rA,c),s.SelfMulAdd(this.m_invMassB,c),n+=this.m_invIB*o.A.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){if(this.m_frequencyHz>0)return!0;const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;this.m_qA.SetAngle(i),this.m_qB.SetAngle(r);const a=o.t.MulRV(this.m_qA,this.m_lalcA,this.m_rA),l=o.t.MulRV(this.m_qB,this.m_lalcB,this.m_rB),h=this.m_u;h.x=s.x+l.x-e.x-a.x,h.y=s.y+l.y-e.y-a.y;let c=this.m_u.Normalize()-this.m_length;c=Object(o.e)(c,-n.y,n.y);const _=-this.m_mass*c,u=o.A.MulSV(_,h,se.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,u),i-=this.m_invIA*o.A.CrossVV(a,u),s.SelfMulAdd(this.m_invMassB,u),r+=this.m_invIB*o.A.CrossVV(l,u),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(o.a)(c)<n.v}}se.InitVelocityConstraints_s_P=new o.A,se.SolveVelocityConstraints_s_vpA=new o.A,se.SolveVelocityConstraints_s_vpB=new o.A,se.SolveVelocityConstraints_s_P=new o.A,se.SolvePositionConstraints_s_P=new o.A;class ne extends te{constructor(){super(Wt.e_areaJoint),this.world=null,this.bodies=[],this.frequencyHz=0,this.dampingRatio=0}AddBody(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}class oe extends ee{constructor(t){super(t),this.m_bodies=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_impulse=0,this.m_targetLengths=null,this.m_targetArea=0,this.m_normals=null,this.m_joints=null,this.m_deltas=null,this.m_delta=null,this.m_bodies=t.bodies,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_targetLengths=Object(n.g)(t.bodies.length),this.m_normals=o.A.MakeArray(t.bodies.length),this.m_joints=Object(n.f)(t.bodies.length),this.m_deltas=o.A.MakeArray(t.bodies.length),this.m_delta=new o.A;const e=new ie;e.frequencyHz=t.frequencyHz,e.dampingRatio=t.dampingRatio,this.m_targetArea=0;for(let i=0;i<this.m_bodies.length;++i){const s=this.m_bodies[i],n=this.m_bodies[(i+1)%this.m_bodies.length],r=s.GetWorldCenter(),a=n.GetWorldCenter();this.m_targetLengths[i]=o.A.DistanceVV(r,a),this.m_targetArea+=o.A.CrossVV(r,a),e.Initialize(s,n,r,a),this.m_joints[i]=t.world.CreateJoint(e)}this.m_targetArea*=.5}GetAnchorA(t){return t.SetZero()}GetAnchorB(t){return t.SetZero()}GetReactionForce(t,e){return e.SetZero()}GetReactionTorque(t){return 0}SetFrequency(t){this.m_frequencyHz=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}GetDampingRatio(){return this.m_dampingRatio}Dump(t){t("Area joint dumping is not supported.\n")}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,r=t.positions[s.m_islandIndex].c,a=this.m_deltas[e];o.A.SubVV(r,n,a)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],s=t.velocities[i.m_islandIndex].v,n=this.m_deltas[e];s.x+=i.m_invMass*n.y*.5*this.m_impulse,s.y+=i.m_invMass*-n.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,i=0;for(let s=0;s<this.m_bodies.length;++s){const n=this.m_bodies[s],r=t.velocities[n.m_islandIndex].v,a=this.m_deltas[s];e+=a.LengthSquared()/n.GetMass(),i+=o.A.CrossVV(r,a)}const s=-2*i/e;this.m_impulse+=s;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],n=t.velocities[i.m_islandIndex].v,o=this.m_deltas[e];n.x+=i.m_invMass*o.y*.5*s,n.y+=i.m_invMass*-o.x*.5*s}}SolvePositionConstraints(t){let e=0,i=0;for(let s=0;s<this.m_bodies.length;++s){const r=this.m_bodies[s],a=this.m_bodies[(s+1)%this.m_bodies.length],l=t.positions[r.m_islandIndex].c,h=t.positions[a.m_islandIndex].c,c=o.A.SubVV(h,l,this.m_delta);let _=c.Length();_<n.r&&(_=1),this.m_normals[s].x=c.y/_,this.m_normals[s].y=-c.x/_,e+=_,i+=o.A.CrossVV(l,h)}i*=.5;const s=.5*(this.m_targetArea-i)/e;let r=!0;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],a=t.positions[i.m_islandIndex].c,l=(e+1)%this.m_bodies.length,h=o.A.AddVV(this.m_normals[e],this.m_normals[l],this.m_delta);h.SelfMul(s);const c=h.LengthSquared();c>Object(o.v)(n.y)&&h.SelfMul(n.y/Object(o.w)(c)),c>Object(o.v)(n.v)&&(r=!1),a.x+=h.x,a.y+=h.y}return r}}class re extends te{constructor(){super(Wt.e_frictionJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.maxForce=0,this.maxTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}class ae extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_linearImpulse=new o.A,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.k,this.m_angularMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_linearMass.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(e),h=this.m_qB.SetAngle(n);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const c=o.t.MulRV(l,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const _=o.t.MulRV(h,this.m_lalcB,this.m_rB),u=this.m_invMassA,m=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,f=this.m_K;if(f.ex.x=u+m+d*c.y*c.y+p*_.y*_.y,f.ex.y=-d*c.x*c.y-p*_.x*_.y,f.ey.x=f.ex.y,f.ey.y=u+m+d*c.x*c.x+p*_.x*_.x,f.GetInverse(this.m_linearMass),this.m_angularMass=d+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;i.SelfMulSub(u,e),s-=d*(o.A.CrossVV(this.m_rA,e)+this.m_angularImpulse),r.SelfMulAdd(m,e),a+=p*(o.A.CrossVV(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,c=t.step.dt;{const t=n-i;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,r=c*this.m_maxTorque;this.m_angularImpulse=Object(o.e)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-s),n+=h*e}{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),ae.SolveVelocityConstraints_s_Cdot_v2),_=o.k.MulMV(this.m_linearMass,t,ae.SolveVelocityConstraints_s_impulseV).SelfNeg(),u=ae.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(_);const m=c*this.m_maxForce;this.m_linearImpulse.LengthSquared()>m*m&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(m)),o.A.SubVV(this.m_linearImpulse,u,_),e.SelfMulSub(r,_),i-=l*o.A.CrossVV(this.m_rA,_),s.SelfMulAdd(a,_),n+=h*o.A.CrossVV(this.m_rB,_)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ae.SolveVelocityConstraints_s_Cdot_v2=new o.A,ae.SolveVelocityConstraints_s_impulseV=new o.A,ae.SolveVelocityConstraints_s_oldImpulseV=new o.A;class le extends te{constructor(){super(Wt.e_gearJoint),this.joint1=null,this.joint2=null,this.ratio=1}}class he extends ee{constructor(t){let e,i;super(t),this.m_joint1=null,this.m_joint2=null,this.m_typeA=Wt.e_unknownJoint,this.m_typeB=Wt.e_unknownJoint,this.m_bodyC=null,this.m_bodyD=null,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localAnchorC=new o.A,this.m_localAnchorD=new o.A,this.m_localAxisC=new o.A,this.m_localAxisD=new o.A,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new o.A,this.m_lcB=new o.A,this.m_lcC=new o.A,this.m_lcD=new o.A,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new o.A,this.m_JvBD=new o.A,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_qC=new o.t,this.m_qD=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_lalcC=new o.A,this.m_lalcD=new o.A,this.m_joint1=t.joint1,this.m_joint2=t.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const s=this.m_bodyA.m_xf,n=this.m_bodyA.m_sweep.a,r=this.m_bodyC.m_xf,a=this.m_bodyC.m_sweep.a;if(this.m_typeA===Wt.e_revoluteJoint){const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.SetZero(),e=n-a-this.m_referenceAngleA}else{const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.Copy(i.m_localXAxisA);const n=this.m_localAnchorC,a=o.t.MulTRV(r.q,o.A.AddVV(o.t.MulRV(s.q,this.m_localAnchorA,o.A.s_t0),o.A.SubVV(s.p,r.p,o.A.s_t1),o.A.s_t0),o.A.s_t0);e=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const l=this.m_bodyB.m_xf,h=this.m_bodyB.m_sweep.a,c=this.m_bodyD.m_xf,_=this.m_bodyD.m_sweep.a;if(this.m_typeB===Wt.e_revoluteJoint){const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.SetZero(),i=h-_-this.m_referenceAngleB}else{const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.Copy(e.m_localXAxisA);const s=this.m_localAnchorD,n=o.t.MulTRV(c.q,o.A.AddVV(o.t.MulRV(l.q,this.m_localAnchorB,o.A.s_t0),o.A.SubVV(l.p,c.p,o.A.s_t1),o.A.s_t0),o.A.s_t0);i=o.A.DotVV(o.A.SubVV(n,s,o.A.s_t0),this.m_localAxisD)}this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*i,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const l=t.positions[this.m_indexC].a,h=t.velocities[this.m_indexC].v;let c=t.velocities[this.m_indexC].w;const _=t.positions[this.m_indexD].a,u=t.velocities[this.m_indexD].v;let m=t.velocities[this.m_indexD].w;const d=this.m_qA.SetAngle(e),p=this.m_qB.SetAngle(n),f=this.m_qC.SetAngle(l),y=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===Wt.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=o.t.MulRV(f,this.m_localAxisC,he.InitVelocityConstraints_s_u);o.A.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);const e=o.t.MulRV(f,this.m_lalcC,he.InitVelocityConstraints_s_rC);o.A.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);const i=o.t.MulRV(d,this.m_lalcA,he.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(t),this.m_JwC=o.A.CrossVV(e,t),this.m_JwA=o.A.CrossVV(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===Wt.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=o.t.MulRV(y,this.m_localAxisD,he.InitVelocityConstraints_s_u);o.A.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);const e=o.t.MulRV(y,this.m_lalcD,he.InitVelocityConstraints_s_rD);o.A.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);const i=o.t.MulRV(p,this.m_lalcB,he.InitVelocityConstraints_s_rB);o.A.MulSV(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*o.A.CrossVV(e,t),this.m_JwB=this.m_ratio*o.A.CrossVV(i,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),c-=this.m_iC*this.m_impulse*this.m_JwC,u.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),m-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=c,t.velocities[this.m_indexD].w=m}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=t.velocities[this.m_indexC].v;let a=t.velocities[this.m_indexC].w;const l=t.velocities[this.m_indexD].v;let h=t.velocities[this.m_indexD].w,c=o.A.DotVV(this.m_JvAC,o.A.SubVV(e,r,o.A.s_t0))+o.A.DotVV(this.m_JvBD,o.A.SubVV(s,l,o.A.s_t0));c+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*n-this.m_JwD*h);const _=-this.m_mass*c;this.m_impulse+=_,e.SelfMulAdd(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,s.SelfMulAdd(this.m_mB*_,this.m_JvBD),n+=this.m_iB*_*this.m_JwB,r.SelfMulSub(this.m_mC*_,this.m_JvAC),a-=this.m_iC*_*this.m_JwC,l.SelfMulSub(this.m_mD*_,this.m_JvBD),h-=this.m_iD*_*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=h}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=t.positions[this.m_indexC].c;let l=t.positions[this.m_indexC].a;const h=t.positions[this.m_indexD].c;let c=t.positions[this.m_indexD].a;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(r),m=this.m_qC.SetAngle(l),d=this.m_qD.SetAngle(c);let p,f;const y=this.m_JvAC,g=this.m_JvBD;let v,x,b,A,w=0;if(this.m_typeA===Wt.e_revoluteJoint)y.SetZero(),v=1,b=1,w+=this.m_iA+this.m_iC,p=i-l-this.m_referenceAngleA;else{const t=o.t.MulRV(m,this.m_localAxisC,he.SolvePositionConstraints_s_u),i=o.t.MulRV(m,this.m_lalcC,he.SolvePositionConstraints_s_rC),s=o.t.MulRV(_,this.m_lalcA,he.SolvePositionConstraints_s_rA);y.Copy(t),b=o.A.CrossVV(i,t),v=o.A.CrossVV(s,t),w+=this.m_mC+this.m_mA+this.m_iC*b*b+this.m_iA*v*v;const n=this.m_lalcC,r=o.t.MulTRV(m,o.A.AddVV(s,o.A.SubVV(e,a,o.A.s_t0),o.A.s_t0),o.A.s_t0);p=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.m_localAxisC)}if(this.m_typeB===Wt.e_revoluteJoint)g.SetZero(),x=this.m_ratio,A=this.m_ratio,w+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),f=r-c-this.m_referenceAngleB;else{const t=o.t.MulRV(d,this.m_localAxisD,he.SolvePositionConstraints_s_u),e=o.t.MulRV(d,this.m_lalcD,he.SolvePositionConstraints_s_rD),i=o.t.MulRV(u,this.m_lalcB,he.SolvePositionConstraints_s_rB);o.A.MulSV(this.m_ratio,t,g),A=this.m_ratio*o.A.CrossVV(e,t),x=this.m_ratio*o.A.CrossVV(i,t),w+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*A*A+this.m_iB*x*x;const n=this.m_lalcD,r=o.t.MulTRV(d,o.A.AddVV(i,o.A.SubVV(s,h,o.A.s_t0),o.A.s_t0),o.A.s_t0);f=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.m_localAxisD)}const S=p+this.m_ratio*f-this.m_constant;let C=0;return w>0&&(C=-S/w),e.SelfMulAdd(this.m_mA*C,y),i+=this.m_iA*C*v,s.SelfMulAdd(this.m_mB*C,g),r+=this.m_iB*C*x,a.SelfMulSub(this.m_mC*C,y),l-=this.m_iC*C*b,h.SelfMulSub(this.m_mD*C,g),c-=this.m_iD*C*A,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,t.positions[this.m_indexC].a=l,t.positions[this.m_indexD].a=c,0<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,s=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",s),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}he.InitVelocityConstraints_s_u=new o.A,he.InitVelocityConstraints_s_rA=new o.A,he.InitVelocityConstraints_s_rB=new o.A,he.InitVelocityConstraints_s_rC=new o.A,he.InitVelocityConstraints_s_rD=new o.A,he.SolvePositionConstraints_s_u=new o.A,he.SolvePositionConstraints_s_rA=new o.A,he.SolvePositionConstraints_s_rB=new o.A,he.SolvePositionConstraints_s_rC=new o.A,he.SolvePositionConstraints_s_rD=new o.A;class ce extends te{constructor(){super(Wt.e_motorJoint),this.linearOffset=new o.A(0,0),this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);const i=this.bodyA.GetAngle(),s=this.bodyB.GetAngle();this.angularOffset=s-i}}class _e extends ee{constructor(t){super(t),this.m_linearOffset=new o.A,this.m_angularOffset=0,this.m_linearImpulse=new o.A,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_linearError=new o.A,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.k,this.m_angularMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_K=new o.k,this.m_linearOffset.Copy(t.linearOffset),this.m_linearImpulse.SetZero(),this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor}GetAnchorA(){return this.m_bodyA.GetPosition()}GetAnchorB(){return this.m_bodyB.GetPosition()}GetReactionForce(t,e){return o.A.MulSV(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){o.A.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const c=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(a),u=o.t.MulRV(c,o.A.SubVV(this.m_linearOffset,this.m_localCenterA,o.A.s_t0),this.m_rA),m=o.t.MulRV(_,o.A.NegV(this.m_localCenterB,o.A.s_t0),this.m_rB),d=this.m_invMassA,p=this.m_invMassB,f=this.m_invIA,y=this.m_invIB,g=this.m_K;if(g.ex.x=d+p+f*u.y*u.y+y*m.y*m.y,g.ex.y=-f*u.x*u.y-y*m.x*m.y,g.ey.x=g.ex.y,g.ey.y=d+p+f*u.x*u.x+y*m.x*m.x,g.GetInverse(this.m_linearMass),this.m_angularMass=f+y,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),o.A.SubVV(o.A.AddVV(r,m,o.A.s_t0),o.A.AddVV(e,u,o.A.s_t1),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;s.SelfMulSub(d,e),n-=f*(o.A.CrossVV(u,e)+this.m_angularImpulse),l.SelfMulAdd(p,e),h+=y*(o.A.CrossVV(m,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,c=t.step.dt,_=t.step.inv_dt;{const t=n-i+_*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,r=c*this.m_maxTorque;this.m_angularImpulse=Object(o.e)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-s),n+=h*e}{const t=this.m_rA,u=this.m_rB,m=o.A.AddVV(o.A.SubVV(o.A.AddVV(s,o.A.CrossSV(n,u,o.A.s_t0),o.A.s_t0),o.A.AddVV(e,o.A.CrossSV(i,t,o.A.s_t1),o.A.s_t1),o.A.s_t2),o.A.MulSV(_*this.m_correctionFactor,this.m_linearError,o.A.s_t3),_e.SolveVelocityConstraints_s_Cdot_v2),d=o.k.MulMV(this.m_linearMass,m,_e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),p=_e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d);const f=c*this.m_maxForce;this.m_linearImpulse.LengthSquared()>f*f&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(f)),o.A.SubVV(this.m_linearImpulse,p,d),e.SelfMulSub(r,d),i-=l*o.A.CrossVV(t,d),s.SelfMulAdd(a,d),n+=h*o.A.CrossVV(u,d)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}_e.SolveVelocityConstraints_s_Cdot_v2=new o.A,_e.SolveVelocityConstraints_s_impulse_v2=new o.A,_e.SolveVelocityConstraints_s_oldImpulse_v2=new o.A;class ue extends te{constructor(){super(Wt.e_mouseJoint),this.target=new o.A,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7}}class me extends ee{constructor(t){super(t),this.m_localAnchorB=null,this.m_targetA=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_beta=0,this.m_impulse=null,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=null,this.m_localCenterB=null,this.m_invMassB=0,this.m_invIB=0,this.m_mass=null,this.m_C=null,this.m_qB=null,this.m_lalcB=null,this.m_K=null,this.m_localAnchorB=new o.A,this.m_targetA=new o.A,this.m_impulse=new o.A,this.m_rB=new o.A,this.m_localCenterB=new o.A,this.m_mass=new o.k,this.m_C=new o.A,this.m_qB=new o.t,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_targetA.Copy(t.target),o.z.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0}SetTarget(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_qB.SetAngle(i),l=this.m_bodyB.GetMass(),h=2*n.P*this.m_frequencyHz,c=2*l*this.m_dampingRatio*h,_=l*(h*h),u=t.step.dt;this.m_gamma=u*(c+u*_),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*_*this.m_gamma,o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(a,this.m_lalcB,this.m_rB);const m=this.m_K;m.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,m.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,m.ey.x=m.ex.y,m.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,m.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*o.A.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let i=t.velocities[this.m_indexB].w;const s=o.A.AddVCrossSV(e,i,this.m_rB,me.SolveVelocityConstraints_s_Cdot),n=o.k.MulMV(this.m_mass,o.A.AddVV(s,o.A.AddVV(this.m_C,o.A.MulSV(this.m_gamma,this.m_impulse,o.A.s_t0),o.A.s_t0),o.A.s_t0).SelfNeg(),me.SolveVelocityConstraints_s_impulse),r=me.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(n);const a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),o.A.SubVV(this.m_impulse,r,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*o.A.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.Copy(this.m_targetA)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t,this.m_impulse,e)}GetReactionTorque(t){return 0}Dump(t){t("Mouse joint dumping is not supported.\n")}ShiftOrigin(t){this.m_targetA.SelfSub(t)}}me.SolveVelocityConstraints_s_Cdot=new o.A,me.SolveVelocityConstraints_s_impulse=new o.A,me.SolveVelocityConstraints_s_oldImpulse=new o.A;class de extends te{constructor(){super(Wt.e_prismaticJoint),this.localAnchorA=null,this.localAnchorB=null,this.localAxisA=null,this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.localAxisA=new o.A(1,0)}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class pe extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localXAxisA=new o.A,this.m_localYAxisA=new o.A,this.m_referenceAngle=0,this.m_impulse=new o.C(0,0,0),this.m_motorImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_limitState=Ht.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new o.A(0,0),this.m_perp=new o.A(0,0),this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new o.l,this.m_K3=new o.l,this.m_K2=new o.k,this.m_motorMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_localXAxisA.Copy(t.localAxisA).SelfNormalize(),o.A.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=t.referenceAngle,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=o.t.MulRV(_,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=o.t.MulRV(u,this.m_lalcB,this.m_rB),p=o.A.AddVV(o.A.SubVV(a,e,o.A.s_t0),o.A.SubVV(d,m,o.A.s_t1),pe.InitVelocityConstraints_s_d),f=this.m_invMassA,y=this.m_invMassB,g=this.m_invIA,v=this.m_invIB;if(o.t.MulRV(_,this.m_localXAxisA,this.m_axis),this.m_a1=o.A.CrossVV(o.A.AddVV(p,m,o.A.s_t0),this.m_axis),this.m_a2=o.A.CrossVV(d,this.m_axis),this.m_motorMass=f+y+g*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),o.t.MulRV(_,this.m_localYAxisA,this.m_perp),this.m_s1=o.A.CrossVV(o.A.AddVV(p,m,o.A.s_t0),this.m_perp),this.m_s2=o.A.CrossVV(d,this.m_perp),this.m_K.ex.x=f+y+g*this.m_s1*this.m_s1+v*this.m_s2*this.m_s2,this.m_K.ex.y=g*this.m_s1+v*this.m_s2,this.m_K.ex.z=g*this.m_s1*this.m_a1+v*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=g+v,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=g*this.m_a1+v*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=f+y+g*this.m_a1*this.m_a1+v*this.m_a2*this.m_a2,this.m_enableLimit){const t=o.A.DotVV(this.m_axis,p);Object(o.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*n.v?this.m_limitState=Ht.e_equalLimits:t<=this.m_lowerTranslation?this.m_limitState!==Ht.e_atLowerLimit&&(this.m_limitState=Ht.e_atLowerLimit,this.m_impulse.z=0):t>=this.m_upperTranslation?this.m_limitState!==Ht.e_atUpperLimit&&(this.m_limitState=Ht.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Ht.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Ht.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=o.A.AddVV(o.A.MulSV(this.m_impulse.x,this.m_perp,o.A.s_t0),o.A.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,o.A.s_t1),pe.InitVelocityConstraints_s_P),i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.SelfMulSub(f,e),r-=g*i,h.SelfMulAdd(y,e),c+=v*n}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==Ht.e_equalLimits){const c=o.A.DotVV(this.m_axis,o.A.SubVV(s,e,o.A.s_t0))+this.m_a2*n-this.m_a1*i;let _=this.m_motorMass*(this.m_motorSpeed-c);const u=this.m_motorImpulse,m=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+_,-m,m),_=this.m_motorImpulse-u;const d=o.A.MulSV(_,this.m_axis,pe.SolveVelocityConstraints_s_P),p=_*this.m_a1,f=_*this.m_a2;e.SelfMulSub(r,d),i-=l*p,s.SelfMulAdd(a,d),n+=h*f}const c=o.A.DotVV(this.m_perp,o.A.SubVV(s,e,o.A.s_t0))+this.m_s2*n-this.m_s1*i,_=n-i;if(this.m_enableLimit&&this.m_limitState!==Ht.e_inactiveLimit){const t=o.A.DotVV(this.m_axis,o.A.SubVV(s,e,o.A.s_t0))+this.m_a2*n-this.m_a1*i,u=pe.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),m=this.m_K.Solve33(-c,-_,-t,pe.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(m),this.m_limitState===Ht.e_atLowerLimit?this.m_impulse.z=Object(o.m)(this.m_impulse.z,0):this.m_limitState===Ht.e_atUpperLimit&&(this.m_impulse.z=Object(o.n)(this.m_impulse.z,0));const d=-c-(this.m_impulse.z-u.z)*this.m_K.ez.x,p=-_-(this.m_impulse.z-u.z)*this.m_K.ez.y,f=this.m_K.Solve22(d,p,pe.SolveVelocityConstraints_s_f2r);f.x+=u.x,f.y+=u.y,this.m_impulse.x=f.x,this.m_impulse.y=f.y,m.x=this.m_impulse.x-u.x,m.y=this.m_impulse.y-u.y,m.z=this.m_impulse.z-u.z;const y=o.A.AddVV(o.A.MulSV(m.x,this.m_perp,o.A.s_t0),o.A.MulSV(m.z,this.m_axis,o.A.s_t1),pe.SolveVelocityConstraints_s_P),g=m.x*this.m_s1+m.y+m.z*this.m_a1,v=m.x*this.m_s2+m.y+m.z*this.m_a2;e.SelfMulSub(r,y),i-=l*g,s.SelfMulAdd(a,y),n+=h*v}else{const t=this.m_K.Solve22(-c,-_,pe.SolveVelocityConstraints_s_df2);this.m_impulse.x+=t.x,this.m_impulse.y+=t.y;const u=o.A.MulSV(t.x,this.m_perp,pe.SolveVelocityConstraints_s_P),m=t.x*this.m_s1+t.y,d=t.x*this.m_s2+t.y;e.SelfMulSub(r,u),i-=l*m,s.SelfMulAdd(a,u),n+=h*d}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,u=this.m_invIB,m=o.t.MulRV(a,this.m_lalcA,this.m_rA),d=o.t.MulRV(l,this.m_lalcB,this.m_rB),p=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,m,o.A.s_t1),pe.SolvePositionConstraints_s_d),f=o.t.MulRV(a,this.m_localXAxisA,this.m_axis),y=o.A.CrossVV(o.A.AddVV(p,m,o.A.s_t0),f),g=o.A.CrossVV(d,f),v=o.t.MulRV(a,this.m_localYAxisA,this.m_perp),x=o.A.CrossVV(o.A.AddVV(p,m,o.A.s_t0),v),b=o.A.CrossVV(d,v);let A=pe.SolvePositionConstraints_s_impulse;const w=o.A.DotVV(v,p),S=r-i-this.m_referenceAngle;let C=Object(o.a)(w),B=Object(o.a)(S),V=!1,M=0;if(this.m_enableLimit){const t=o.A.DotVV(f,p);Object(o.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*n.v?(M=Object(o.e)(t,-n.y,n.y),C=Object(o.m)(C,Object(o.a)(t)),V=!0):t<=this.m_lowerTranslation?(M=Object(o.e)(t-this.m_lowerTranslation+n.v,-n.y,0),C=Object(o.m)(C,this.m_lowerTranslation-t),V=!0):t>=this.m_upperTranslation&&(M=Object(o.e)(t-this.m_upperTranslation-n.v,0,n.y),C=Object(o.m)(C,t-this.m_upperTranslation),V=!0)}if(V){const t=h+c+_*x*x+u*b*b,e=_*x+u*b,i=_*x*y+u*b*g;let s=_+u;0===s&&(s=1);const n=_*y+u*g,o=h+c+_*y*y+u*g*g,r=this.m_K3;r.ex.SetXYZ(t,e,i),r.ey.SetXYZ(e,s,n),r.ez.SetXYZ(i,n,o),A=r.Solve33(-w,-S,-M,A)}else{const t=h+c+_*x*x+u*b*b,e=_*x+u*b;let i=_+u;0===i&&(i=1);const s=this.m_K2;s.ex.Set(t,e),s.ey.Set(e,i);const n=s.Solve(-w,-S,pe.SolvePositionConstraints_s_impulse1);A.x=n.x,A.y=n.y,A.z=0}const k=o.A.AddVV(o.A.MulSV(A.x,v,o.A.s_t0),o.A.MulSV(A.z,f,o.A.s_t1),pe.SolvePositionConstraints_s_P),I=A.x*x+A.y+A.z*y,P=A.x*b+A.y+A.z*g;return e.SelfMulSub(h,k),i-=_*I,s.SelfMulAdd(c,k),r+=u*P,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,C<=n.v&&B<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,pe.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,pe.GetJointTranslation_s_pB),i=o.A.SubVV(e,t,pe.GetJointTranslation_s_d),s=this.m_bodyA.GetWorldVector(this.m_localXAxisA,pe.GetJointTranslation_s_axis);return o.A.DotVV(i,s)}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;o.A.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=o.t.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const s=o.t.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=o.A.AddVV(t.m_sweep.c,i,o.A.s_t0),r=o.A.AddVV(e.m_sweep.c,s,o.A.s_t1),a=o.A.SubVV(r,n,o.A.s_t2),l=t.GetWorldVector(this.m_localXAxisA,this.m_axis),h=t.m_linearVelocity,c=e.m_linearVelocity,_=t.m_angularVelocity,u=e.m_angularVelocity;return o.A.DotVV(a,o.A.CrossSV(_,l,o.A.s_t0))+o.A.DotVV(l,o.A.SubVV(o.A.AddVCrossSV(c,u,s,o.A.s_t0),o.A.AddVCrossSV(h,_,i,o.A.s_t1),o.A.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}SetMotorSpeed(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}pe.InitVelocityConstraints_s_d=new o.A,pe.InitVelocityConstraints_s_P=new o.A,pe.SolveVelocityConstraints_s_P=new o.A,pe.SolveVelocityConstraints_s_f2r=new o.A,pe.SolveVelocityConstraints_s_f1=new o.C,pe.SolveVelocityConstraints_s_df3=new o.C,pe.SolveVelocityConstraints_s_df2=new o.A,pe.SolvePositionConstraints_s_d=new o.A,pe.SolvePositionConstraints_s_impulse=new o.C,pe.SolvePositionConstraints_s_impulse1=new o.A,pe.SolvePositionConstraints_s_P=new o.A,pe.GetJointTranslation_s_pA=new o.A,pe.GetJointTranslation_s_pB=new o.A,pe.GetJointTranslation_s_d=new o.A,pe.GetJointTranslation_s_axis=new o.A;class fe extends te{constructor(){super(Wt.e_pulleyJoint),this.groundAnchorA=new o.A(-1,1),this.groundAnchorB=new o.A(1,1),this.localAnchorA=new o.A(-1,0),this.localAnchorB=new o.A(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,e,i,s,n,r,a){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=o.A.DistanceVV(n,i),this.lengthB=o.A.DistanceVV(r,s),this.ratio=a}}class ye extends ee{constructor(t){super(t),this.m_groundAnchorA=new o.A,this.m_groundAnchorB=new o.A,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new o.A,this.m_uB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_groundAnchorA.Copy(t.groundAnchorA),this.m_groundAnchorB.Copy(t.groundAnchorB),this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_lengthA=t.lengthA,this.m_lengthB=t.lengthB,this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(u,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(a).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);const m=this.m_uA.Length(),d=this.m_uB.Length();m>10*n.v?this.m_uA.SelfMul(1/m):this.m_uA.SetZero(),d>10*n.v?this.m_uB.SelfMul(1/d):this.m_uB.SetZero();const p=o.A.CrossVV(this.m_rA,this.m_uA),f=o.A.CrossVV(this.m_rB,this.m_uB),y=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=y+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(-this.m_impulse,this.m_uA,ye.InitVelocityConstraints_s_PA),i=o.A.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,ye.InitVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*o.A.CrossVV(this.m_rA,e),h.SelfMulAdd(this.m_invMassB,i),c+=this.m_invIB*o.A.CrossVV(this.m_rB,i)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,ye.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,ye.SolveVelocityConstraints_s_vpB),l=-o.A.DotVV(this.m_uA,r)-this.m_ratio*o.A.DotVV(this.m_uB,a),h=-this.m_mass*l;this.m_impulse+=h;const c=o.A.MulSV(-h,this.m_uA,ye.SolveVelocityConstraints_s_PA),_=o.A.MulSV(-this.m_ratio*h,this.m_uB,ye.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,c),i+=this.m_invIA*o.A.CrossVV(this.m_rA,c),s.SelfMulAdd(this.m_invMassB,_),n+=this.m_invIB*o.A.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const c=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=this.m_uA.Copy(e).SelfAdd(h).SelfSub(this.m_groundAnchorA),u=this.m_uB.Copy(s).SelfAdd(c).SelfSub(this.m_groundAnchorB),m=_.Length(),d=u.Length();m>10*n.v?_.SelfMul(1/m):_.SetZero(),d>10*n.v?u.SelfMul(1/d):u.SetZero();const p=o.A.CrossVV(h,_),f=o.A.CrossVV(c,u),y=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*f*f;let v=y+this.m_ratio*this.m_ratio*g;v>0&&(v=1/v);const x=this.m_constant-m-this.m_ratio*d,b=Object(o.a)(x),A=-v*x,w=o.A.MulSV(-A,_,ye.SolvePositionConstraints_s_PA),S=o.A.MulSV(-this.m_ratio*A,u,ye.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,w),i+=this.m_invIA*o.A.CrossVV(h,w),s.SelfMulAdd(this.m_invMassB,S),r+=this.m_invIB*o.A.CrossVV(c,S),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,b<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse*this.m_uB.x,t*this.m_impulse*this.m_uB.y)}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,ye.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return o.A.DistanceVV(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,ye.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return o.A.DistanceVV(t,e)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}ye.InitVelocityConstraints_s_PA=new o.A,ye.InitVelocityConstraints_s_PB=new o.A,ye.SolveVelocityConstraints_s_vpA=new o.A,ye.SolveVelocityConstraints_s_vpB=new o.A,ye.SolveVelocityConstraints_s_PA=new o.A,ye.SolveVelocityConstraints_s_PB=new o.A,ye.SolvePositionConstraints_s_PA=new o.A,ye.SolvePositionConstraints_s_PB=new o.A,ye.GetCurrentLengthA_s_p=new o.A,ye.GetCurrentLengthB_s_p=new o.A;class ge extends te{constructor(){super(Wt.e_revoluteJoint),this.localAnchorA=new o.A(0,0),this.localAnchorB=new o.A(0,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class ve extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_impulse=new o.C,this.m_motorImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.l,this.m_motorMass=0,this.m_limitState=Ht.e_inactiveLimit,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Ht.e_inactiveLimit}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const h=this.m_qA.SetAngle(e),c=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(h,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(c,this.m_lalcB,this.m_rB);const _=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,d=this.m_invIB,p=m+d===0;if(this.m_mass.ex.x=_+u+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*d,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*d,this.m_mass.ez.x=-this.m_rA.y*m-this.m_rB.y*d,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=_+u+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*d,this.m_mass.ez.y=this.m_rA.x*m+this.m_rB.x*d,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=m+d,this.m_motorMass=m+d,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!p||(this.m_motorImpulse=0),this.m_enableLimit&&!p){const t=r-e-this.m_referenceAngle;Object(o.a)(this.m_upperAngle-this.m_lowerAngle)<2*n.n?this.m_limitState=Ht.e_equalLimits:t<=this.m_lowerAngle?(this.m_limitState!==Ht.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Ht.e_atLowerLimit):t>=this.m_upperAngle?(this.m_limitState!==Ht.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Ht.e_atUpperLimit):(this.m_limitState=Ht.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Ht.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=ve.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,e),s-=m*(o.A.CrossVV(this.m_rA,e)+this.m_motorImpulse+this.m_impulse.z),a.SelfMulAdd(u,e),l+=d*(o.A.CrossVV(this.m_rB,e)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,c=l+h===0;if(this.m_enableMotor&&this.m_limitState!==Ht.e_equalLimits&&!c){const e=n-i-this.m_motorSpeed;let s=-this.m_motorMass*e;const r=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+s,-a,a),i-=l*(s=this.m_motorImpulse-r),n+=h*s}if(this.m_enableLimit&&this.m_limitState!==Ht.e_inactiveLimit&&!c){const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),ve.SolveVelocityConstraints_s_Cdot1),c=n-i,_=this.m_mass.Solve33(t.x,t.y,c,ve.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===Ht.e_equalLimits)this.m_impulse.SelfAdd(_);else if(this.m_limitState===Ht.e_atLowerLimit){if(this.m_impulse.z+_.z<0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,ve.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}else if(this.m_limitState===Ht.e_atUpperLimit){if(this.m_impulse.z+_.z>0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,ve.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}const u=ve.SolveVelocityConstraints_s_P.Set(_.x,_.y);e.SelfMulSub(r,u),i-=l*(o.A.CrossVV(this.m_rA,u)+_.z),s.SelfMulAdd(a,u),n+=h*(o.A.CrossVV(this.m_rB,u)+_.z)}else{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),ve.SolveVelocityConstraints_s_Cdot_v2),c=this.m_mass.Solve22(-t.x,-t.y,ve.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=c.x,this.m_impulse.y+=c.y,e.SelfMulSub(r,c),i-=l*o.A.CrossVV(this.m_rA,c),s.SelfMulAdd(a,c),n+=h*o.A.CrossVV(this.m_rB,c)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);let h=0,c=0;const _=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==Ht.e_inactiveLimit&&!_){const t=r-i-this.m_referenceAngle;let e=0;if(this.m_limitState===Ht.e_equalLimits){const i=Object(o.e)(t-this.m_lowerAngle,-n.w,n.w);e=-this.m_motorMass*i,h=Object(o.a)(i)}else if(this.m_limitState===Ht.e_atLowerLimit){let i=t-this.m_lowerAngle;h=-i,i=Object(o.e)(i+n.n,-n.w,0),e=-this.m_motorMass*i}else if(this.m_limitState===Ht.e_atUpperLimit){let i=t-this.m_upperAngle;h=i,i=Object(o.e)(i-n.n,0,n.w),e=-this.m_motorMass*i}i-=this.m_invIA*e,r+=this.m_invIB*e}{a.SetAngle(i),l.SetAngle(r),o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const t=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const n=o.t.MulRV(l,this.m_lalcB,this.m_rB),h=o.A.SubVV(o.A.AddVV(s,n,o.A.s_t0),o.A.AddVV(e,t,o.A.s_t1),ve.SolvePositionConstraints_s_C_v2);c=h.Length();const _=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,d=this.m_invIB,p=this.m_K;p.ex.x=_+u+m*t.y*t.y+d*n.y*n.y,p.ex.y=-m*t.x*t.y-d*n.x*n.y,p.ey.x=p.ex.y,p.ey.y=_+u+m*t.x*t.x+d*n.x*n.x;const f=p.Solve(h.x,h.y,ve.SolvePositionConstraints_s_impulse).SelfNeg();e.SelfMulSub(_,f),i-=m*o.A.CrossVV(t,f),s.SelfMulAdd(u,f),r+=d*o.A.CrossVV(n,f)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,c<=n.v&&h<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_enableMotor!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){this.m_maxMotorTorque=t}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){this.m_motorSpeed!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ve.InitVelocityConstraints_s_P=new o.A,ve.SolveVelocityConstraints_s_P=new o.A,ve.SolveVelocityConstraints_s_Cdot_v2=new o.A,ve.SolveVelocityConstraints_s_Cdot1=new o.A,ve.SolveVelocityConstraints_s_impulse_v3=new o.C,ve.SolveVelocityConstraints_s_reduced_v2=new o.A,ve.SolveVelocityConstraints_s_impulse_v2=new o.A,ve.SolvePositionConstraints_s_C_v2=new o.A,ve.SolvePositionConstraints_s_impulse=new o.A;class xe extends te{constructor(){super(Wt.e_ropeJoint),this.localAnchorA=new o.A(-1,0),this.localAnchorB=new o.A(1,0),this.maxLength=0}}class be extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_maxLength=0,this.m_length=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_state=Ht.e_inactiveLimit,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_maxLength=t.maxLength}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,h=t.velocities[this.m_indexB].v;let c=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),u=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(u,this.m_lalcB,this.m_rB),this.m_u.Copy(a).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();const m=this.m_length-this.m_maxLength;if(this.m_state=m>0?Ht.e_atUpperLimit:Ht.e_inactiveLimit,!(this.m_length>n.v))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);const d=o.A.CrossVV(this.m_rA,this.m_u),p=o.A.CrossVV(this.m_rB,this.m_u),f=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=0!==f?1/f:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(this.m_impulse,this.m_u,be.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*o.A.CrossVV(this.m_rA,e),h.SelfMulAdd(this.m_invMassB,e),c+=this.m_invIB*o.A.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,be.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,be.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength;let h=o.A.DotVV(this.m_u,o.A.SubVV(a,r,o.A.s_t0));l<0&&(h+=t.step.inv_dt*l);let c=-this.m_mass*h;const _=this.m_impulse;this.m_impulse=Object(o.n)(0,this.m_impulse+c),c=this.m_impulse-_;const u=o.A.MulSV(c,this.m_u,be.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,u),i-=this.m_invIA*o.A.CrossVV(this.m_rA,u),s.SelfMulAdd(this.m_invMassB,u),n+=this.m_invIB*o.A.CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const c=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=this.m_u.Copy(s).SelfAdd(c).SelfSub(e).SelfSub(h),u=_.Normalize();let m=u-this.m_maxLength;m=Object(o.e)(m,0,n.y);const d=-this.m_mass*m,p=o.A.MulSV(d,_,be.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,p),i-=this.m_invIA*o.A.CrossVV(h,p),s.SelfMulAdd(this.m_invMassB,p),r+=this.m_invIB*o.A.CrossVV(c,p),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,u-this.m_maxLength<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t*this.m_impulse,this.m_u,e)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxLength(t){this.m_maxLength=t}GetMaxLength(){return this.m_maxLength}GetLimitState(){return this.m_state}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}be.InitVelocityConstraints_s_P=new o.A,be.SolveVelocityConstraints_s_vpA=new o.A,be.SolveVelocityConstraints_s_vpB=new o.A,be.SolveVelocityConstraints_s_P=new o.A,be.SolvePositionConstraints_s_P=new o.A;class Ae extends te{constructor(){super(Wt.e_weldJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class we extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new o.C(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.l,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.l,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const h=this.m_qA.SetAngle(e),c=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(h,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(c,this.m_lalcB,this.m_rB);const _=this.m_invMassA,u=this.m_invMassB,m=this.m_invIA,d=this.m_invIB,p=this.m_K;if(p.ex.x=_+u+this.m_rA.y*this.m_rA.y*m+this.m_rB.y*this.m_rB.y*d,p.ey.x=-this.m_rA.y*this.m_rA.x*m-this.m_rB.y*this.m_rB.x*d,p.ez.x=-this.m_rA.y*m-this.m_rB.y*d,p.ex.y=p.ey.x,p.ey.y=_+u+this.m_rA.x*this.m_rA.x*m+this.m_rB.x*this.m_rB.x*d,p.ez.y=this.m_rA.x*m+this.m_rB.x*d,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=m+d,this.m_frequencyHz>0){p.GetInverse22(this.m_mass);let i=m+d;const s=i>0?1/i:0,o=r-e-this.m_referenceAngle,a=2*n.P*this.m_frequencyHz,l=2*s*this.m_dampingRatio*a,h=s*a*a,c=t.step.dt;this.m_gamma=c*(l+c*h),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*c*h*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else p.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);const e=we.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,e),s-=m*(o.A.CrossVV(this.m_rA,e)+this.m_impulse.z),a.SelfMulAdd(u,e),l+=d*(o.A.CrossVV(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,h=this.m_invIB;if(this.m_frequencyHz>0){const t=n-i,c=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=l*c,n+=h*c;const _=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),we.SolveVelocityConstraints_s_Cdot1),u=o.l.MulM33XY(this.m_mass,_.x,_.y,we.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=u.x,this.m_impulse.y+=u.y;const m=u;e.SelfMulSub(r,m),i-=l*o.A.CrossVV(this.m_rA,m),s.SelfMulAdd(a,m),n+=h*o.A.CrossVV(this.m_rB,m)}else{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),we.SolveVelocityConstraints_s_Cdot1),c=n-i,_=o.l.MulM33XYZ(this.m_mass,t.x,t.y,c,we.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(_);const u=we.SolveVelocityConstraints_s_P.Set(_.x,_.y);e.SelfMulSub(r,u),i-=l*(o.A.CrossVV(this.m_rA,u)+_.z),s.SelfMulAdd(a,u),n+=h*(o.A.CrossVV(this.m_rB,u)+_.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,u=this.m_invIB;o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=o.t.MulRV(l,this.m_lalcB,this.m_rB);let p,f;const y=this.m_K;if(y.ex.x=h+c+m.y*m.y*_+d.y*d.y*u,y.ey.x=-m.y*m.x*_-d.y*d.x*u,y.ez.x=-m.y*_-d.y*u,y.ex.y=y.ey.x,y.ey.y=h+c+m.x*m.x*_+d.x*d.x*u,y.ez.y=m.x*_+d.x*u,y.ex.z=y.ez.x,y.ey.z=y.ez.y,y.ez.z=_+u,this.m_frequencyHz>0){const t=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,m,o.A.s_t1),we.SolvePositionConstraints_s_C1);p=t.Length(),f=0;const n=y.Solve22(t.x,t.y,we.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(h,n),i-=_*o.A.CrossVV(m,n),s.SelfMulAdd(c,n),r+=u*o.A.CrossVV(d,n)}else{const t=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,m,o.A.s_t1),we.SolvePositionConstraints_s_C1),n=r-i-this.m_referenceAngle;p=t.Length(),f=Object(o.a)(n);const a=y.Solve33(t.x,t.y,n,we.SolvePositionConstraints_s_impulse).SelfNeg(),l=we.SolvePositionConstraints_s_P.Set(a.x,a.y);e.SelfMulSub(h,l),i-=_*(o.A.CrossVV(this.m_rA,l)+a.z),s.SelfMulAdd(c,l),r+=u*(o.A.CrossVV(this.m_rB,l)+a.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,p<=n.v&&f<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}we.InitVelocityConstraints_s_P=new o.A,we.SolveVelocityConstraints_s_Cdot1=new o.A,we.SolveVelocityConstraints_s_impulse1=new o.A,we.SolveVelocityConstraints_s_impulse=new o.C,we.SolveVelocityConstraints_s_P=new o.A,we.SolvePositionConstraints_s_C1=new o.A,we.SolvePositionConstraints_s_P=new o.A,we.SolvePositionConstraints_s_impulse=new o.C;class Se extends te{constructor(){super(Wt.e_wheelJoint),this.localAnchorA=new o.A(0,0),this.localAnchorB=new o.A(0,0),this.localAxisA=new o.A(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}}class Ce extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localXAxisA=new o.A,this.m_localYAxisA=new o.A,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new o.A,this.m_ay=new o.A,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_localXAxisA.Copy(t.localAxisA),o.A.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_ax.SetZero(),this.m_ay.SetZero()}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(t){this.m_frequencyHz=t}GetSpringFrequencyHz(){return this.m_frequencyHz}SetSpringDampingRatio(t){this.m_dampingRatio=t}GetSpringDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,a=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,h=t.velocities[this.m_indexA].v;let c=t.velocities[this.m_indexA].w;const _=t.positions[this.m_indexB].c,u=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let d=t.velocities[this.m_indexB].w;const p=this.m_qA.SetAngle(l),f=this.m_qB.SetAngle(u);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const y=o.t.MulRV(p,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const g=o.t.MulRV(f,this.m_lalcB,this.m_rB),v=o.A.SubVV(o.A.AddVV(_,g,o.A.s_t0),o.A.AddVV(a,y,o.A.s_t1),Ce.InitVelocityConstraints_s_d);if(o.t.MulRV(p,this.m_localYAxisA,this.m_ay),this.m_sAy=o.A.CrossVV(o.A.AddVV(v,y,o.A.s_t0),this.m_ay),this.m_sBy=o.A.CrossVV(g,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){o.t.MulRV(p,this.m_localXAxisA,this.m_ax),this.m_sAx=o.A.CrossVV(o.A.AddVV(v,y,o.A.s_t0),this.m_ax),this.m_sBx=o.A.CrossVV(g,this.m_ax);const a=e+i+s*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(a>0){this.m_springMass=1/a;const e=o.A.DotVV(v,this.m_ax),i=2*n.P*this.m_frequencyHz,s=2*this.m_springMass*this.m_dampingRatio*i,r=this.m_springMass*i*i,l=t.step.dt;this.m_gamma=l*(s+l*r),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*l*r*this.m_gamma,this.m_springMass=a+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const e=o.A.AddVV(o.A.MulSV(this.m_impulse,this.m_ay,o.A.s_t0),o.A.MulSV(this.m_springImpulse,this.m_ax,o.A.s_t1),Ce.InitVelocityConstraints_s_P),i=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,s=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.SelfMulSub(this.m_invMassA,e),c-=this.m_invIA*i,m.SelfMulAdd(this.m_invMassB,e),d+=this.m_invIB*s}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=c,t.velocities[this.m_indexB].w=d}SolveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,n=this.m_invIB,r=t.velocities[this.m_indexA].v;let a=t.velocities[this.m_indexA].w;const l=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;{const t=o.A.DotVV(this.m_ax,o.A.SubVV(l,r,o.A.s_t0))+this.m_sBx*h-this.m_sAx*a,c=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;const _=o.A.MulSV(c,this.m_ax,Ce.SolveVelocityConstraints_s_P),u=c*this.m_sAx,m=c*this.m_sBx;r.SelfMulSub(e,_),a-=s*u,l.SelfMulAdd(i,_),h+=n*m}{const e=h-a-this.m_motorSpeed;let i=-this.m_motorMass*e;const r=this.m_motorImpulse,l=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+i,-l,l),a-=s*(i=this.m_motorImpulse-r),h+=n*i}{const t=o.A.DotVV(this.m_ay,o.A.SubVV(l,r,o.A.s_t0))+this.m_sBy*h-this.m_sAy*a,c=-this.m_mass*t;this.m_impulse+=c;const _=o.A.MulSV(c,this.m_ay,Ce.SolveVelocityConstraints_s_P),u=c*this.m_sAy,m=c*this.m_sBy;r.SelfMulSub(e,_),a-=s*u,l.SelfMulAdd(i,_),h+=n*m}t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=h}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const c=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=o.A.AddVV(o.A.SubVV(s,e,o.A.s_t0),o.A.SubVV(c,h,o.A.s_t1),Ce.SolvePositionConstraints_s_d),u=o.t.MulRV(a,this.m_localYAxisA,this.m_ay),m=o.A.CrossVV(o.A.AddVV(_,h,o.A.s_t0),u),d=o.A.CrossVV(c,u),p=o.A.DotVV(_,this.m_ay),f=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let y;y=0!==f?-p/f:0;const g=o.A.MulSV(y,u,Ce.SolvePositionConstraints_s_P),v=y*m,x=y*d;return e.SelfMulSub(this.m_invMassA,g),i-=this.m_invIA*v,s.SelfMulAdd(this.m_invMassB,g),r+=this.m_invIB*x,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(o.a)(p)<=n.v}GetDefinition(t){return t}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new o.A),s=e.GetWorldPoint(this.m_localAnchorB,new o.A),n=o.A.SubVV(s,i,new o.A),r=t.GetWorldVector(this.m_localXAxisA,new o.A);return o.A.DotVV(n,r)}GetPrismaticJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;o.A.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=o.t.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const s=o.t.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=o.A.AddVV(t.m_sweep.c,i,o.A.s_t0),r=o.A.AddVV(e.m_sweep.c,s,o.A.s_t1),a=o.A.SubVV(r,n,o.A.s_t2),l=t.GetWorldVector(this.m_localXAxisA,new o.A),h=t.m_linearVelocity,c=e.m_linearVelocity,_=t.m_angularVelocity,u=e.m_angularVelocity;return o.A.DotVV(a,o.A.CrossSV(_,l,o.A.s_t0))+o.A.DotVV(l,o.A.SubVV(o.A.AddVCrossSV(c,u,s,o.A.s_t0),o.A.AddVCrossSV(h,_,i,o.A.s_t1),o.A.s_t0))}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}SetMotorSpeed(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}SetMaxMotorTorque(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t}GetMotorTorque(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Ce.InitVelocityConstraints_s_d=new o.A,Ce.InitVelocityConstraints_s_P=new o.A,Ce.SolveVelocityConstraints_s_P=new o.A,Ce.SolvePositionConstraints_s_d=new o.A,Ce.SolvePositionConstraints_s_P=new o.A;class Be{static Create(t,e){let i=null;switch(t.type){case Wt.e_distanceJoint:i=new se(t);break;case Wt.e_mouseJoint:i=new me(t);break;case Wt.e_prismaticJoint:i=new pe(t);break;case Wt.e_revoluteJoint:i=new ve(t);break;case Wt.e_pulleyJoint:i=new ye(t);break;case Wt.e_gearJoint:i=new he(t);break;case Wt.e_wheelJoint:i=new Ce(t);break;case Wt.e_weldJoint:i=new we(t);break;case Wt.e_frictionJoint:i=new ae(t);break;case Wt.e_ropeJoint:i=new be(t);break;case Wt.e_motorJoint:i=new _e(t);break;case Wt.e_areaJoint:i=new oe(t)}return i}static Destroy(t,e){}}function Ve(t,e){return Object(o.w)(t*e)}function Me(t,e){return t>e?t:e}class ke{constructor(){this.other=null,this.contact=null,this.prev=null,this.next=null}}class Ie{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new ke,this.m_nodeB=new ke,this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new m.h,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new m.h}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),n.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}Evaluate(t,e,i){}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=Ve(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=Me(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=Ve(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Me(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let i=!1;const s=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),o=this.m_fixtureB.IsSensor(),r=n||o,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),h=a.GetTransform(),c=l.GetTransform();if(r){const t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();i=Object(m.o)(t,this.m_indexA,e,this.m_indexB,h,c),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,h,c),i=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;const i=e.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const s=this.m_oldManifold.points[t];if(s.id.key===i.key){e.normalImpulse=s.normalImpulse,e.tangentImpulse=s.tangentImpulse;break}}}i!==s&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.BeginContact(this),s&&!i&&t&&t.EndContact(this),!r&&i&&t&&t.PreSolve(this,this.m_oldManifold)}ComputeTOI(t,e){const i=Ie.ComputeTOI_s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=n.v;const s=Ie.ComputeTOI_s_output;return Z(s,i),s.t}}Ie.ComputeTOI_s_input=new L,Ie.ComputeTOI_s_output=new F;class Pe extends Ie{constructor(){super()}static Create(t){return new Pe}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){K(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class $e extends Ie{constructor(){super()}static Create(t){return new $e}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){Bt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class De extends Ie{constructor(){super()}static Create(t){return new De}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){st(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Te extends Ie{constructor(){super()}static Create(t){return new Te}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){Gt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Ge extends Ie{constructor(){super()}static Create(t){return new Ge}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){qt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Le extends Ie{constructor(){super()}static Create(t){return new Le}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),o=s,r=Le.Evaluate_s_edge;o.GetChildEdge(r,this.m_indexA),Gt(t,r,e,n,i)}}Le.Evaluate_s_edge=new zt;class Re extends Ie{constructor(){super()}static Create(t){return new Re}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),o=s,r=Re.Evaluate_s_edge;o.GetChildEdge(r,this.m_indexA),qt(t,r,e,n,i)}}Re.Evaluate_s_edge=new zt;class Ee{constructor(){this.pool=null,this.createFcn=null,this.destroyFcn=null,this.primary=!1}}class Fe{constructor(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}AddType(t,e,i,s){const o=Object(n.e)(256,e=>t(this.m_allocator));function r(e){return o.length>0?o.pop():t(e)}function a(t,e){o.push(t)}this.m_registers[i][s].pool=o,this.m_registers[i][s].createFcn=r,this.m_registers[i][s].destroyFcn=a,this.m_registers[i][s].primary=!0,i!==s&&(this.m_registers[s][i].pool=o,this.m_registers[s][i].createFcn=r,this.m_registers[s][i].destroyFcn=a,this.m_registers[s][i].primary=!1)}InitializeRegisters(){this.m_registers=[];for(let t=0;t<jt.c.e_shapeTypeCount;t++){this.m_registers[t]=[];for(let e=0;e<jt.c.e_shapeTypeCount;e++)this.m_registers[t][e]=new Ee}this.AddType(Pe.Create,Pe.Destroy,jt.c.e_circleShape,jt.c.e_circleShape),this.AddType(De.Create,De.Destroy,jt.c.e_polygonShape,jt.c.e_circleShape),this.AddType($e.Create,$e.Destroy,jt.c.e_polygonShape,jt.c.e_polygonShape),this.AddType(Te.Create,Te.Destroy,jt.c.e_edgeShape,jt.c.e_circleShape),this.AddType(Ge.Create,Ge.Destroy,jt.c.e_edgeShape,jt.c.e_polygonShape),this.AddType(Le.Create,Le.Destroy,jt.c.e_chainShape,jt.c.e_circleShape),this.AddType(Re.Create,Re.Destroy,jt.c.e_chainShape,jt.c.e_polygonShape)}Create(t,e,i,s){const n=t.GetType(),o=i.GetType(),r=this.m_registers[n][o];if(r.createFcn){const n=r.createFcn(this.m_allocator);return r.primary?n.Reset(t,e,i,s):n.Reset(i,s,t,e),n}return null}Destroy(t){const e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));const s=e.GetType(),n=i.GetType();this.m_registers[s][n].destroyFcn(t,this.m_allocator)}}class qe{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){}SayGoodbyeParticle(t,e){}}class je{ShouldCollide(t,e){const i=t.GetBody(),s=e.GetBody();if(s.GetType()===Jt.b2_staticBody&&i.GetType()===Jt.b2_staticBody)return!1;if(!s.ShouldCollideConnected(i))return!1;const n=t.GetFilterData(),o=e.GetFilterData();return n.groupIndex===o.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&o.categoryBits)&&0!=(n.categoryBits&o.maskBits)}ShouldCollideFixtureParticle(t,e,i){return!0}ShouldCollideParticleParticle(t,e,i){return!0}}je.b2_defaultFilter=new je;class Ne{constructor(){this.normalImpulses=Object(n.g)(n.z),this.tangentImpulses=Object(n.g)(n.z),this.count=0}}class Oe{BeginContact(t){}EndContact(t){}BeginContactFixtureParticle(t,e){}EndContactFixtureParticle(t,e){}BeginContactParticleParticle(t,e){}EndContactParticleParticle(t,e){}PreSolve(t,e){}PostSolve(t,e){}}Oe.b2_defaultListener=new Oe;class ze{ReportFixture(t){return!0}ReportParticle(t,e){return!1}ShouldQueryParticleSystem(t){return!0}}class Ue{ReportFixture(t,e,i,s){return s}ReportParticle(t,e,i,s,n){return 0}ShouldQueryParticleSystem(t){return!0}}class Je{constructor(){this.m_broadPhase=new v,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=je.b2_defaultFilter,this.m_contactListener=Oe.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=null,this.m_contactFactory=new Fe(this.m_allocator)}AddPair(t,e){let i=t.fixture,s=e.fixture,n=t.childIndex,o=e.childIndex,r=i.GetBody(),a=s.GetBody();if(r===a)return;let l=a.GetContactList();for(;l;){if(l.other===r){const t=l.contact.GetFixtureA(),e=l.contact.GetFixtureB(),r=l.contact.GetChildIndexA(),a=l.contact.GetChildIndexB();if(t===i&&e===s&&r===n&&a===o)return;if(t===s&&e===i&&r===o&&a===n)return}l=l.next}if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,s))return;const h=this.m_contactFactory.Create(i,n,s,o);null!==h&&(i=h.GetFixtureA(),s=h.GetFixtureB(),n=h.GetChildIndexA(),o=h.GetChildIndexB(),r=i.m_body,a=s.m_body,h.m_prev=null,h.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=h),this.m_contactList=h,h.m_nodeA.contact=h,h.m_nodeA.other=a,h.m_nodeA.prev=null,h.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=h.m_nodeA),r.m_contactList=h.m_nodeA,h.m_nodeB.contact=h,h.m_nodeB.other=r,h.m_nodeB.prev=null,h.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=h.m_nodeB),a.m_contactList=h.m_nodeB,i.IsSensor()||s.IsSensor()||(r.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}FindNewContacts(){this.m_broadPhase.UpdatePairs(this)}Destroy(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),n=t.GetChildIndexB(),o=e.GetBody(),r=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){const e=t;t=e.m_next,this.Destroy(e);continue}t.m_filterFlag=!1}const a=o.IsAwake()&&o.m_type!==Jt.b2_staticBody,l=r.IsAwake()&&r.m_type!==Jt.b2_staticBody;if(!a&&!l){t=t.m_next;continue}const h=e.m_proxies[s].treeNode,c=i.m_proxies[n].treeNode;if(this.m_broadPhase.TestOverlap(h,c))t.Update(this.m_contactListener),t=t.m_next;else{const e=t;t=e.m_next,this.Destroy(e)}}}}class We{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}class He{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}class Xe{constructor(){this.c=new o.A,this.a=0}static MakeArray(t){return Object(n.e)(t,t=>new Xe)}}class Ze{constructor(){this.v=new o.A,this.w=0}static MakeArray(t){return Object(n.e)(t,t=>new Ze)}}class Ye{constructor(){this.step=new He,this.positions=null,this.velocities=null}}class Qe{constructor(){this.rA=new o.A,this.rB=new o.A,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}static MakeArray(t){return Object(n.e)(t,t=>new Qe)}}class Ke{constructor(){this.points=Qe.MakeArray(n.z),this.normal=new o.A,this.tangent=new o.A,this.normalMass=new o.k,this.K=new o.k,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}static MakeArray(t){return Object(n.e)(t,t=>new Ke)}}class ti{constructor(){this.localPoints=o.A.MakeArray(n.z),this.localNormal=new o.A,this.localPoint=new o.A,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new o.A,this.localCenterB=new o.A,this.invIA=0,this.invIB=0,this.type=m.j.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}static MakeArray(t){return Object(n.e)(t,t=>new ti)}}class ei{constructor(){this.step=new He,this.contacts=null,this.count=0,this.positions=null,this.velocities=null,this.allocator=null}}class ii{constructor(){this.normal=new o.A,this.point=new o.A,this.separation=0}Initialize(t,e,i,s){const n=ii.Initialize_s_pointA,r=ii.Initialize_s_pointB,a=ii.Initialize_s_planePoint,l=ii.Initialize_s_clipPoint;switch(t.type){case m.j.e_circles:o.z.MulXV(e,t.localPoint,n),o.z.MulXV(i,t.localPoints[0],r),o.A.SubVV(r,n,this.normal).SelfNormalize(),o.A.MidVV(n,r,this.point),this.separation=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.normal)-t.radiusA-t.radiusB;break;case m.j.e_faceA:o.t.MulRV(e.q,t.localNormal,this.normal),o.z.MulXV(e,t.localPoint,a),o.z.MulXV(i,t.localPoints[s],l),this.separation=o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l);break;case m.j.e_faceB:o.t.MulRV(i.q,t.localNormal,this.normal),o.z.MulXV(i,t.localPoint,a),o.z.MulXV(e,t.localPoints[s],l),this.separation=o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l),this.normal.SelfNeg()}}}ii.Initialize_s_pointA=new o.A,ii.Initialize_s_pointB=new o.A,ii.Initialize_s_planePoint=new o.A,ii.Initialize_s_clipPoint=new o.A;class si{constructor(){this.m_step=new He,this.m_positions=null,this.m_velocities=null,this.m_allocator=null,this.m_positionConstraints=ti.MakeArray(1024),this.m_velocityConstraints=Ke.MakeArray(1024),this.m_contacts=null,this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=Object(o.m)(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new ti}if(this.m_velocityConstraints.length<this.m_count){const t=Object(o.m)(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new Ke}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const e=this.m_contacts[t],i=e.m_fixtureA,s=e.m_fixtureB,n=i.GetShape(),o=s.GetShape(),r=n.m_radius,a=o.m_radius,l=i.GetBody(),h=s.GetBody(),c=e.GetManifold(),_=c.pointCount,u=this.m_velocityConstraints[t];u.friction=e.m_friction,u.restitution=e.m_restitution,u.tangentSpeed=e.m_tangentSpeed,u.indexA=l.m_islandIndex,u.indexB=h.m_islandIndex,u.invMassA=l.m_invMass,u.invMassB=h.m_invMass,u.invIA=l.m_invI,u.invIB=h.m_invI,u.contactIndex=t,u.pointCount=_,u.K.SetZero(),u.normalMass.SetZero();const m=this.m_positionConstraints[t];m.indexA=l.m_islandIndex,m.indexB=h.m_islandIndex,m.invMassA=l.m_invMass,m.invMassB=h.m_invMass,m.localCenterA.Copy(l.m_sweep.localCenter),m.localCenterB.Copy(h.m_sweep.localCenter),m.invIA=l.m_invI,m.invIB=h.m_invI,m.localNormal.Copy(c.localNormal),m.localPoint.Copy(c.localPoint),m.pointCount=_,m.radiusA=r,m.radiusB=a,m.type=c.type;for(let t=0;t<_;++t){const e=c.points[t],i=u.points[t];this.m_step.warmStarting?(i.normalImpulse=this.m_step.dtRatio*e.normalImpulse,i.tangentImpulse=this.m_step.dtRatio*e.tangentImpulse):(i.normalImpulse=0,i.tangentImpulse=0),i.rA.SetZero(),i.rB.SetZero(),i.normalMass=0,i.tangentMass=0,i.velocityBias=0,m.localPoints[t].Copy(e.localPoint)}}return this}InitializeVelocityConstraints(){const t=si.InitializeVelocityConstraints_s_xfA,e=si.InitializeVelocityConstraints_s_xfB,i=si.InitializeVelocityConstraints_s_worldManifold;for(let s=0;s<this.m_count;++s){const r=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],l=a.radiusA,h=a.radiusB,c=this.m_contacts[r.contactIndex].GetManifold(),_=r.indexA,u=r.indexB,m=r.invMassA,d=r.invMassB,p=r.invIA,f=r.invIB,y=a.localCenterA,g=a.localCenterB,v=this.m_positions[_].c,x=this.m_positions[_].a,b=this.m_velocities[_].v,A=this.m_velocities[_].w,w=this.m_positions[u].c,S=this.m_positions[u].a,C=this.m_velocities[u].v,B=this.m_velocities[u].w;t.q.SetAngle(x),e.q.SetAngle(S),o.A.SubVV(v,o.t.MulRV(t.q,y,o.A.s_t0),t.p),o.A.SubVV(w,o.t.MulRV(e.q,g,o.A.s_t0),e.p),i.Initialize(c,t,l,e,h),r.normal.Copy(i.normal),o.A.CrossVOne(r.normal,r.tangent);const V=r.pointCount;for(let t=0;t<V;++t){const e=r.points[t];o.A.SubVV(i.points[t],v,e.rA),o.A.SubVV(i.points[t],w,e.rB);const s=o.A.CrossVV(e.rA,r.normal),a=o.A.CrossVV(e.rB,r.normal),l=m+d+p*s*s+f*a*a;e.normalMass=l>0?1/l:0;const h=r.tangent,c=o.A.CrossVV(e.rA,h),_=o.A.CrossVV(e.rB,h),u=m+d+p*c*c+f*_*_;e.tangentMass=u>0?1/u:0,e.velocityBias=0;const y=o.A.DotVV(r.normal,o.A.SubVV(o.A.AddVCrossSV(C,B,e.rB,o.A.s_t0),o.A.AddVCrossSV(b,A,e.rA,o.A.s_t1),o.A.s_t0));y<-n.T&&(e.velocityBias+=-r.restitution*y)}if(2===r.pointCount){const t=r.points[0],e=r.points[1],i=o.A.CrossVV(t.rA,r.normal),s=o.A.CrossVV(t.rB,r.normal),n=o.A.CrossVV(e.rA,r.normal),a=o.A.CrossVV(e.rB,r.normal),l=m+d+p*i*i+f*s*s,h=m+d+p*n*n+f*a*a,c=m+d+p*i*n+f*s*a;l*l<1e3*(l*h-c*c)?(r.K.ex.Set(l,c),r.K.ey.Set(c,h),r.K.GetInverse(r.normalMass)):r.pointCount=1}}}WarmStart(){const t=si.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],s=i.indexA,n=i.indexB,r=i.invMassA,a=i.invIA,l=i.invMassB,h=i.invIB,c=i.pointCount,_=this.m_velocities[s].v;let u=this.m_velocities[s].w;const m=this.m_velocities[n].v;let d=this.m_velocities[n].w;const p=i.normal,f=i.tangent;for(let e=0;e<c;++e){const s=i.points[e];o.A.AddVV(o.A.MulSV(s.normalImpulse,p,o.A.s_t0),o.A.MulSV(s.tangentImpulse,f,o.A.s_t1),t),u-=a*o.A.CrossVV(s.rA,t),_.SelfMulSub(r,t),d+=h*o.A.CrossVV(s.rB,t),m.SelfMulAdd(l,t)}this.m_velocities[s].w=u,this.m_velocities[n].w=d}}SolveVelocityConstraints(){const t=si.SolveVelocityConstraints_s_dv,e=si.SolveVelocityConstraints_s_dv1,i=si.SolveVelocityConstraints_s_dv2,s=si.SolveVelocityConstraints_s_P,n=si.SolveVelocityConstraints_s_a,r=si.SolveVelocityConstraints_s_b,a=si.SolveVelocityConstraints_s_x,l=si.SolveVelocityConstraints_s_d,h=si.SolveVelocityConstraints_s_P1,c=si.SolveVelocityConstraints_s_P2,_=si.SolveVelocityConstraints_s_P1P2;for(let u=0;u<this.m_count;++u){const m=this.m_velocityConstraints[u],d=m.indexA,p=m.indexB,f=m.invMassA,y=m.invIA,g=m.invMassB,v=m.invIB,x=m.pointCount,b=this.m_velocities[d].v;let A=this.m_velocities[d].w;const w=this.m_velocities[p].v;let S=this.m_velocities[p].w;const C=m.normal,B=m.tangent,V=m.friction;for(let e=0;e<x;++e){const i=m.points[e];o.A.SubVV(o.A.AddVCrossSV(w,S,i.rB,o.A.s_t0),o.A.AddVCrossSV(b,A,i.rA,o.A.s_t1),t);const n=o.A.DotVV(t,B)-m.tangentSpeed;let r=i.tangentMass*-n;const a=V*i.normalImpulse,l=Object(o.e)(i.tangentImpulse+r,-a,a);r=l-i.tangentImpulse,i.tangentImpulse=l,o.A.MulSV(r,B,s),b.SelfMulSub(f,s),A-=y*o.A.CrossVV(i.rA,s),w.SelfMulAdd(g,s),S+=v*o.A.CrossVV(i.rB,s)}if(1===m.pointCount){const e=m.points[0];o.A.SubVV(o.A.AddVCrossSV(w,S,e.rB,o.A.s_t0),o.A.AddVCrossSV(b,A,e.rA,o.A.s_t1),t);const i=o.A.DotVV(t,C);let n=-e.normalMass*(i-e.velocityBias);const r=Object(o.m)(e.normalImpulse+n,0);n=r-e.normalImpulse,e.normalImpulse=r,o.A.MulSV(n,C,s),b.SelfMulSub(f,s),A-=y*o.A.CrossVV(e.rA,s),w.SelfMulAdd(g,s),S+=v*o.A.CrossVV(e.rB,s)}else{const t=m.points[0],s=m.points[1];n.Set(t.normalImpulse,s.normalImpulse),o.A.SubVV(o.A.AddVCrossSV(w,S,t.rB,o.A.s_t0),o.A.AddVCrossSV(b,A,t.rA,o.A.s_t1),e),o.A.SubVV(o.A.AddVCrossSV(w,S,s.rB,o.A.s_t0),o.A.AddVCrossSV(b,A,s.rA,o.A.s_t1),i);let u=o.A.DotVV(e,C),d=o.A.DotVV(i,C);for(r.x=u-t.velocityBias,r.y=d-s.velocityBias,r.SelfSub(o.k.MulMV(m.K,n,o.A.s_t0));;){if(o.k.MulMV(m.normalMass,r,a).SelfNeg(),a.x>=0&&a.y>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,C,h),o.A.MulSV(l.y,C,c),o.A.AddVV(h,c,_),b.SelfMulSub(f,_),A-=y*(o.A.CrossVV(t.rA,h)+o.A.CrossVV(s.rA,c)),w.SelfMulAdd(g,_),S+=v*(o.A.CrossVV(t.rB,h)+o.A.CrossVV(s.rB,c)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=-t.normalMass*r.x,a.y=0,u=0,d=m.K.ex.y*a.x+r.y,a.x>=0&&d>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,C,h),o.A.MulSV(l.y,C,c),o.A.AddVV(h,c,_),b.SelfMulSub(f,_),A-=y*(o.A.CrossVV(t.rA,h)+o.A.CrossVV(s.rA,c)),w.SelfMulAdd(g,_),S+=v*(o.A.CrossVV(t.rB,h)+o.A.CrossVV(s.rB,c)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=0,a.y=-s.normalMass*r.y,u=m.K.ey.x*a.y+r.x,d=0,a.y>=0&&u>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,C,h),o.A.MulSV(l.y,C,c),o.A.AddVV(h,c,_),b.SelfMulSub(f,_),A-=y*(o.A.CrossVV(t.rA,h)+o.A.CrossVV(s.rA,c)),w.SelfMulAdd(g,_),S+=v*(o.A.CrossVV(t.rB,h)+o.A.CrossVV(s.rB,c)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=0,a.y=0,u=r.x,d=r.y,u>=0&&d>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,C,h),o.A.MulSV(l.y,C,c),o.A.AddVV(h,c,_),b.SelfMulSub(f,_),A-=y*(o.A.CrossVV(t.rA,h)+o.A.CrossVV(s.rA,c)),w.SelfMulAdd(g,_),S+=v*(o.A.CrossVV(t.rB,h)+o.A.CrossVV(s.rB,c)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}break}}this.m_velocities[d].w=A,this.m_velocities[p].w=S}}StoreImpulses(){for(let t=0;t<this.m_count;++t){let e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold();for(let t=0;t<e.pointCount;++t)i.points[t].normalImpulse=e.points[t].normalImpulse,i.points[t].tangentImpulse=e.points[t].tangentImpulse}}SolvePositionConstraints(){const t=si.SolvePositionConstraints_s_xfA,e=si.SolvePositionConstraints_s_xfB,i=si.SolvePositionConstraints_s_psm,s=si.SolvePositionConstraints_s_rA,r=si.SolvePositionConstraints_s_rB,a=si.SolvePositionConstraints_s_P;let l=0;for(let h=0;h<this.m_count;++h){const c=this.m_positionConstraints[h],_=c.indexA,u=c.indexB,m=c.localCenterA,d=c.invMassA,p=c.invIA,f=c.localCenterB,y=c.invMassB,g=c.invIB,v=c.pointCount,x=this.m_positions[_].c;let b=this.m_positions[_].a;const A=this.m_positions[u].c;let w=this.m_positions[u].a;for(let h=0;h<v;++h){t.q.SetAngle(b),e.q.SetAngle(w),o.A.SubVV(x,o.t.MulRV(t.q,m,o.A.s_t0),t.p),o.A.SubVV(A,o.t.MulRV(e.q,f,o.A.s_t0),e.p),i.Initialize(c,t,e,h);const _=i.normal,u=i.point,v=i.separation;o.A.SubVV(u,x,s),o.A.SubVV(u,A,r),l=Object(o.n)(l,v);const S=Object(o.e)(n.p*(v+n.v),-n.y,0),C=o.A.CrossVV(s,_),B=o.A.CrossVV(r,_),V=d+y+p*C*C+g*B*B,M=V>0?-S/V:0;o.A.MulSV(M,_,a),x.SelfMulSub(d,a),b-=p*o.A.CrossVV(s,a),A.SelfMulAdd(y,a),w+=g*o.A.CrossVV(r,a)}this.m_positions[_].a=b,this.m_positions[u].a=w}return l>-3*n.v}SolveTOIPositionConstraints(t,e){const i=si.SolveTOIPositionConstraints_s_xfA,s=si.SolveTOIPositionConstraints_s_xfB,r=si.SolveTOIPositionConstraints_s_psm,a=si.SolveTOIPositionConstraints_s_rA,l=si.SolveTOIPositionConstraints_s_rB,h=si.SolveTOIPositionConstraints_s_P;let c=0;for(let _=0;_<this.m_count;++_){const u=this.m_positionConstraints[_],m=u.indexA,d=u.indexB,p=u.localCenterA,f=u.localCenterB,y=u.pointCount;let g=0,v=0;m!==t&&m!==e||(g=u.invMassA,v=u.invIA);let x=0,b=0;d!==t&&d!==e||(x=u.invMassB,b=u.invIB);const A=this.m_positions[m].c;let w=this.m_positions[m].a;const S=this.m_positions[d].c;let C=this.m_positions[d].a;for(let t=0;t<y;++t){i.q.SetAngle(w),s.q.SetAngle(C),o.A.SubVV(A,o.t.MulRV(i.q,p,o.A.s_t0),i.p),o.A.SubVV(S,o.t.MulRV(s.q,f,o.A.s_t0),s.p),r.Initialize(u,i,s,t);const e=r.normal,_=r.point,m=r.separation;o.A.SubVV(_,A,a),o.A.SubVV(_,S,l),c=Object(o.n)(c,m);const d=Object(o.e)(n.S*(m+n.v),-n.y,0),y=o.A.CrossVV(a,e),B=o.A.CrossVV(l,e),V=g+x+v*y*y+b*B*B,M=V>0?-d/V:0;o.A.MulSV(M,e,h),A.SelfMulSub(g,h),w-=v*o.A.CrossVV(a,h),S.SelfMulAdd(x,h),C+=b*o.A.CrossVV(l,h)}this.m_positions[m].a=w,this.m_positions[d].a=C}return c>=-1.5*n.v}}si.InitializeVelocityConstraints_s_xfA=new o.z,si.InitializeVelocityConstraints_s_xfB=new o.z,si.InitializeVelocityConstraints_s_worldManifold=new m.p,si.WarmStart_s_P=new o.A,si.SolveVelocityConstraints_s_dv=new o.A,si.SolveVelocityConstraints_s_dv1=new o.A,si.SolveVelocityConstraints_s_dv2=new o.A,si.SolveVelocityConstraints_s_P=new o.A,si.SolveVelocityConstraints_s_a=new o.A,si.SolveVelocityConstraints_s_b=new o.A,si.SolveVelocityConstraints_s_x=new o.A,si.SolveVelocityConstraints_s_d=new o.A,si.SolveVelocityConstraints_s_P1=new o.A,si.SolveVelocityConstraints_s_P2=new o.A,si.SolveVelocityConstraints_s_P1P2=new o.A,si.SolvePositionConstraints_s_xfA=new o.z,si.SolvePositionConstraints_s_xfB=new o.z,si.SolvePositionConstraints_s_psm=new ii,si.SolvePositionConstraints_s_rA=new o.A,si.SolvePositionConstraints_s_rB=new o.A,si.SolvePositionConstraints_s_P=new o.A,si.SolveTOIPositionConstraints_s_xfA=new o.z,si.SolveTOIPositionConstraints_s_xfB=new o.z,si.SolveTOIPositionConstraints_s_psm=new ii,si.SolveTOIPositionConstraints_s_rA=new o.A,si.SolveTOIPositionConstraints_s_rB=new o.A,si.SolveTOIPositionConstraints_s_P=new o.A;class ni{constructor(){this.m_allocator=null,this.m_listener=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=Xe.MakeArray(1024),this.m_velocities=Ze.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}Initialize(t,e,i,s,n){for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=s,this.m_listener=n;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t){const e=Object(o.m)(2*this.m_positions.length,t);for(;this.m_positions.length<e;)this.m_positions[this.m_positions.length]=new Xe}if(this.m_velocities.length<t){const e=Object(o.m)(2*this.m_velocities.length,t);for(;this.m_velocities.length<e;)this.m_velocities[this.m_velocities.length]=new Ze}}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(t,e,i,s){const r=ni.s_timer.Reset(),a=e.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c);const s=e.m_sweep.a,n=this.m_velocities[t].v.Copy(e.m_linearVelocity);let o=e.m_angularVelocity;e.m_sweep.c0.Copy(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_type===Jt.b2_dynamicBody&&(n.x+=a*(e.m_gravityScale*i.x+e.m_invMass*e.m_force.x),n.y+=a*(e.m_gravityScale*i.y+e.m_invMass*e.m_force.y),o+=a*e.m_invI*e.m_torque,n.SelfMul(1/(1+a*e.m_linearDamping)),o*=1/(1+a*e.m_angularDamping)),this.m_positions[t].a=s,this.m_velocities[t].w=o}r.Reset();const l=ni.s_solverData;l.step.Copy(e),l.positions=this.m_positions,l.velocities=this.m_velocities;const h=ni.s_contactSolverDef;h.step.Copy(e),h.contacts=this.m_contacts,h.count=this.m_contactCount,h.positions=this.m_positions,h.velocities=this.m_velocities,h.allocator=this.m_allocator;const c=ni.s_contactSolver.Initialize(h);c.InitializeVelocityConstraints(),e.warmStarting&&c.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(l);t.solveInit=r.GetMilliseconds(),r.Reset();for(let t=0;t<e.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(l);c.SolveVelocityConstraints()}c.StoreImpulses(),t.solveVelocity=r.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const s=this.m_velocities[t].v;let r=this.m_velocities[t].w;const l=o.A.MulSV(a,s,ni.s_translation);if(o.A.DotVV(l,l)>n.J){const t=n.I/l.Length();s.SelfMul(t)}const h=a*r;if(h*h>n.F){r*=n.E/Object(o.a)(h)}e.x+=a*s.x,e.y+=a*s.y,i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r}r.Reset();let _=!1;for(let t=0;t<e.positionIterations;++t){const t=c.SolvePositionConstraints();let e=!0;for(let t=0;t<this.m_jointCount;++t){const i=this.m_joints[t].SolvePositionConstraints(l);e=e&&i}if(t&&e){_=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.m_sweep.c.Copy(this.m_positions[t].c),e.m_sweep.a=this.m_positions[t].a,e.m_linearVelocity.Copy(this.m_velocities[t].v),e.m_angularVelocity=this.m_velocities[t].w,e.SynchronizeTransform()}if(t.solvePosition=r.GetMilliseconds(),this.Report(c.m_velocityConstraints),s){let t=n.x;const e=n.u*n.u,i=n.m*n.m;for(let s=0;s<this.m_bodyCount;++s){const n=this.m_bodies[s];n.GetType()!==Jt.b2_staticBody&&(!n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>i||o.A.DotVV(n.m_linearVelocity,n.m_linearVelocity)>e?(n.m_sleepTime=0,t=0):(n.m_sleepTime+=a,t=Object(o.n)(t,n.m_sleepTime)))}if(t>=n.R&&_)for(let t=0;t<this.m_bodyCount;++t){this.m_bodies[t].SetAwake(!1)}}}SolveTOI(t,e,i){for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c),this.m_positions[t].a=e.m_sweep.a,this.m_velocities[t].v.Copy(e.m_linearVelocity),this.m_velocities[t].w=e.m_angularVelocity}const s=ni.s_contactSolverDef;s.contacts=this.m_contacts,s.count=this.m_contactCount,s.allocator=this.m_allocator,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities;const r=ni.s_contactSolver.Initialize(s);for(let s=0;s<t.positionIterations;++s){if(r.SolveTOIPositionConstraints(e,i))break}this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(let e=0;e<t.velocityIterations;++e)r.SolveVelocityConstraints();const a=t.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const s=this.m_velocities[t].v;let r=this.m_velocities[t].w;const l=o.A.MulSV(a,s,ni.s_translation);if(o.A.DotVV(l,l)>n.J){const t=n.I/l.Length();s.SelfMul(t)}const h=a*r;if(h*h>n.F){r*=n.E/Object(o.a)(h)}e.SelfMulAdd(a,s),i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r;const c=this.m_bodies[t];c.m_sweep.c.Copy(e),c.m_sweep.a=i,c.m_linearVelocity.Copy(s),c.m_angularVelocity=r,c.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){if(null!==this.m_listener)for(let e=0;e<this.m_contactCount;++e){const i=this.m_contacts[e];if(!i)continue;const s=t[e],n=ni.s_impulse;n.count=s.pointCount;for(let t=0;t<s.pointCount;++t)n.normalImpulses[t]=s.points[t].normalImpulse,n.tangentImpulses[t]=s.points[t].tangentImpulse;this.m_listener.PostSolve(i,n)}}}var oi,ri;ni.s_timer=new l,ni.s_solverData=new Ye,ni.s_contactSolverDef=new ei,ni.s_contactSolver=new si,ni.s_translation=new o.A,ni.s_impulse=new Ne,function(t){t[t.b2_waterParticle=0]="b2_waterParticle",t[t.b2_zombieParticle=2]="b2_zombieParticle",t[t.b2_wallParticle=4]="b2_wallParticle",t[t.b2_springParticle=8]="b2_springParticle",t[t.b2_elasticParticle=16]="b2_elasticParticle",t[t.b2_viscousParticle=32]="b2_viscousParticle",t[t.b2_powderParticle=64]="b2_powderParticle",t[t.b2_tensileParticle=128]="b2_tensileParticle",t[t.b2_colorMixingParticle=256]="b2_colorMixingParticle",t[t.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",t[t.b2_barrierParticle=1024]="b2_barrierParticle",t[t.b2_staticPressureParticle=2048]="b2_staticPressureParticle",t[t.b2_reactiveParticle=4096]="b2_reactiveParticle",t[t.b2_repulsiveParticle=8192]="b2_repulsiveParticle",t[t.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",t[t.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",t[t.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",t[t.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle"}(oi||(oi={}));class ai{constructor(){this.flags=0,this.position=new o.A,this.velocity=new o.A,this.color=new r,this.lifetime=0,this.userData=null,this.group=null}}function li(t,e,i){const s=Math.ceil(Math.sqrt(t/(.01*e))*i);return Object(o.e)(s,1,8)}class hi{constructor(){this.m_index=n.t}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}}!function(t){t[t.b2_solidParticleGroup=1]="b2_solidParticleGroup",t[t.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",t[t.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",t[t.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",t[t.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",t[t.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask"}(ri||(ri={}));class ci{constructor(){this.flags=0,this.groupFlags=0,this.position=new o.A,this.angle=0,this.linearVelocity=new o.A,this.angularVelocity=0,this.color=new r,this.strength=1,this.shape=null,this.shapes=null,this.shapeCount=0,this.stride=0,this.particleCount=0,this.positionData=null,this.lifetime=0,this.userData=null,this.group=null}}class _i{constructor(t){this.m_system=null,this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new o.A,this.m_linearVelocity=new o.A,this.m_angularVelocity=0,this.m_transform=new o.z,this.m_userData=null,this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(t){t|=this.m_groupFlags&ri.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){const i=_i.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(t,this.m_center,i),e)}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){if(!this.m_system.m_world.IsLocked())for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){const t=new o.A,e=new o.A;if(this.m_timestamp!==this.m_system.m_timestamp){const i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[t]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[t]);if(this.m_mass>0){const t=1/this.m_mass;this.m_center.SelfMul(t),this.m_linearVelocity.SelfMul(t)}this.m_inertia=0,this.m_angularVelocity=0;for(let s=this.m_firstIndex;s<this.m_lastIndex;s++)o.A.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),o.A.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*o.A.DotVV(t,t),this.m_angularVelocity+=i*o.A.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}_i.GetLinearVelocityFromWorldPoint_s_t0=new o.A;class ui{constructor(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=Object(n.e)(t,t=>null),this.m_capacity=t}Push(t){if(this.m_back>=this.m_capacity){for(let t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(Object(n.e)(this.m_capacity,t=>null)),this.m_capacity*=2):(this.m_buffer.concat(Object(n.e)(1,t=>null)),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_front,this.m_back,delete this.m_buffer[this.m_front],this.m_front++}Empty(){return this.m_front,this.m_back,this.m_front===this.m_back}Front(){return this.m_buffer[this.m_front]}}class mi{constructor(t){this.m_generatorBuffer=null,this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=null,this.m_generatorBuffer=Object(n.e)(t,t=>new mi.Generator),this.m_generatorCapacity=t}AddGenerator(t,e,i){this.m_generatorCount,this.m_generatorCapacity;let s=this.m_generatorBuffer[this.m_generatorCount++];s.center.Copy(t),s.tag=e,s.necessary=i}Generate(t,e){this.m_diagram;let i=1/t,s=new o.A(+n.x,+n.x),r=new o.A(-n.x,-n.x),a=0;for(let t=0;t<this.m_generatorCount;t++){let e=this.m_generatorBuffer[t];e.necessary&&(o.A.MinV(s,e.center,s),o.A.MaxV(r,e.center,r),++a)}if(0===a)return this.m_countX=0,void(this.m_countY=0);s.x-=e,s.y-=e,r.x+=e,r.y+=e,this.m_countX=1+Math.floor(i*(r.x-s.x)),this.m_countY=1+Math.floor(i*(r.y-s.y)),this.m_diagram=Object(n.e)(this.m_countX*this.m_countY,t=>null);let l=new ui(4*this.m_countX*this.m_countY);for(let t=0;t<this.m_generatorCount;t++){let e=this.m_generatorBuffer[t];e.center.SelfSub(s).SelfMul(i);let n=Math.floor(e.center.x),o=Math.floor(e.center.y);n>=0&&o>=0&&n<this.m_countX&&o<this.m_countY&&l.Push(new mi.Task(n,o,n+o*this.m_countX,e))}for(;!l.Empty();){let t=l.Front(),e=t.m_x,i=t.m_y,s=t.m_i,n=t.m_generator;l.Pop(),this.m_diagram[s]||(this.m_diagram[s]=n,e>0&&l.Push(new mi.Task(e-1,i,s-1,n)),i>0&&l.Push(new mi.Task(e,i-1,s-this.m_countX,n)),e<this.m_countX-1&&l.Push(new mi.Task(e+1,i,s+1,n)),i<this.m_countY-1&&l.Push(new mi.Task(e,i+1,s+this.m_countX,n)))}for(let t=0;t<this.m_countY;t++)for(let e=0;e<this.m_countX-1;e++){let i=e+t*this.m_countX,s=this.m_diagram[i],n=this.m_diagram[i+1];s!==n&&(l.Push(new mi.Task(e,t,i,n)),l.Push(new mi.Task(e+1,t,i+1,s)))}for(let t=0;t<this.m_countY-1;t++)for(let e=0;e<this.m_countX;e++){let i=e+t*this.m_countX,s=this.m_diagram[i],n=this.m_diagram[i+this.m_countX];s!==n&&(l.Push(new mi.Task(e,t,i,n)),l.Push(new mi.Task(e,t+1,i+this.m_countX,s)))}for(;!l.Empty();){let t=l.Front(),e=t.m_x,i=t.m_y,s=t.m_i,n=t.m_generator;l.Pop();let o=this.m_diagram[s],r=n;if(o!==r){let t=o.center.x-e,n=o.center.y-i,a=r.center.x-e,h=r.center.y-i;t*t+n*n>a*a+h*h&&(this.m_diagram[s]=r,e>0&&l.Push(new mi.Task(e-1,i,s-1,r)),i>0&&l.Push(new mi.Task(e,i-1,s-this.m_countX,r)),e<this.m_countX-1&&l.Push(new mi.Task(e+1,i,s+1,r)),i<this.m_countY-1&&l.Push(new mi.Task(e,i+1,s+this.m_countX,r)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let i=0;i<this.m_countX-1;i++){let s=i+e*this.m_countX,n=this.m_diagram[s],o=this.m_diagram[s+1],r=this.m_diagram[s+this.m_countX],a=this.m_diagram[s+1+this.m_countX];o!==r&&(n!==o&&n!==r&&(n.necessary||o.necessary||r.necessary)&&t(n.tag,o.tag,r.tag),a!==o&&a!==r&&(n.necessary||o.necessary||r.necessary)&&t(o.tag,a.tag,r.tag))}}}function di(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function pi(t,e){return t<e}function fi(t,e=0,i=t.length-e,s=pi){let n=e,o=[],r=0;for(;;){for(;n+1<i;i++){let e=t[n+Math.floor(Math.random()*(i-n))];o[r++]=i;for(let o=n-1;;){for(;s(t[++o],e););for(;s(e,t[--i]););if(o>=i)break;di(t,o,i)}}if(0===r)break;n=i,i=o[--r]}return t}function yi(t,e=0,i=t.length-e,s=pi){return fi(t,e,i,s)}function gi(t,e,i=t.length){let s=0;for(let n=0;n<i;++n)e(t[n])||(n!==s?di(t,s++,n):++s);return s}function vi(t,e,i,s,n=pi){let o=i-e;for(;o>0;){let i=Math.floor(o/2),r=e+i;n(t[r],s)?(e=++r,o-=i+1):o=i}return e}function xi(t,e,i,s,n=pi){let o=i-e;for(;o>0;){let i=Math.floor(o/2),r=e+i;n(s,t[r])?o=i:(e=++r,o-=i+1)}return e}function bi(t,e,i,s){let n=i;for(;e!==n;)di(t,e++,n++),n===s?n=i:e===i&&(i=n)}!function(t){t.Generator=class{constructor(){this.center=new o.A,this.tag=0,this.necessary=!1}};t.Task=class{constructor(t,e,i,s){this.m_x=0,this.m_y=0,this.m_i=0,this.m_generator=null,this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=s}}}(mi||(mi={}));class Ai{constructor(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){this.capacity,this.data.length;for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){let t=this.capacity?2*this.capacity:n.M;this.capacity,this.Reserve(t)}Free(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){for(let e=0;e<this.count;++e)t(this.data[e])||0;this.count=gi(this.data,t,this.count),this.count}Unique(t){this.count=function(t,e,i,s){if(e===i)return i;let n=e;for(;++e!==i;)s(t[n],t[e])||di(t,++n,e);return++n}(this.data,0,this.count,t)}}class wi extends ze{constructor(t){super(),this.m_system=t}ShouldQueryParticleSystem(t){return!1}ReportFixture(t){if(t.IsSensor())return!0;const e=t.GetShape().GetChildCount();for(let i=0;i<e;i++){const e=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(e);let n;for(;(n=s.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,n)}return!0}ReportParticle(t,e){return!1}ReportFixtureAndParticle(t,e,i){}}class Si{constructor(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new o.A,this.flags=0}SetIndices(t,e){t<=n.B&&n.B,this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&Object(o.a)(this.weight-t.weight)<.01&&o.A.DistanceSquaredVV(this.normal,t.normal)<1e-4}}class Ci{constructor(){this.index=0,this.body=null,this.fixture=null,this.weight=0,this.normal=new o.A,this.mass=0}}class Bi{constructor(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0}}class Vi{constructor(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new o.A(0,0),this.pb=new o.A(0,0),this.pc=new o.A(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0}}class Mi{constructor(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return(new Mi).Copy(this)}}class ki{constructor(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new ki.UserOverridableBuffer,this.m_flagsBuffer=new ki.UserOverridableBuffer,this.m_positionBuffer=new ki.UserOverridableBuffer,this.m_velocityBuffer=new ki.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new ki.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new ki.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new ki.UserOverridableBuffer,this.m_bodyContactCountBuffer=new ki.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new ki.UserOverridableBuffer,this.m_stuckParticleBuffer=new Ai(()=>0),this.m_proxyBuffer=new Ai(()=>new ki.Proxy),this.m_contactBuffer=new Ai(()=>new Si),this.m_bodyContactBuffer=new Ai(()=>new Ci),this.m_pairBuffer=new Ai(()=>new Bi),this.m_triadBuffer=new Ai(()=>new Vi),this.m_expirationTimeBuffer=new ki.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new ki.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Mi,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),t.lifetimeGranularity,this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(t,e){return(e+ki.yOffset>>>0<<ki.yShift)+(ki.xScale*t+ki.xOffset>>>0)>>>0}static computeRelativeTag(t,e,i){return t+(i<<ki.yShift)+(e<<ki.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(t){if(this.m_world.IsLocked(),this.m_world.IsLocked())return 0;if(this.m_count>=this.m_internalAllocatedCapacity){let t=this.m_count?2*this.m_count:n.M;this.ReallocateInternalAllocatedBuffers(t)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return n.t;this.DestroyOldestParticle(0,!1),this.SolveZombie()}let e=this.m_count++;this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new o.A).Copy(t.position),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new o.A).Copy(t.velocity),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new o.A).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0),!this.m_colorBuffer.data&&t.color.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new r).Copy(t.color)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);let i=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=t.lifetime>0;(this.m_expirationTimeBuffer.data||s)&&(this.SetParticleLifetime(e,s?t.lifetime:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[e]=e),i.index=e;let a=t.group;return this.m_groupBuffer[e]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,e),a.m_lastIndex,a.m_lastIndex=e+1):(a.m_firstIndex=e,a.m_lastIndex=e+1)),this.SetParticleFlags(e,t.flags),e}GetParticleHandleFromIndex(t){t>=0&&t<this.GetParticleCount()&&n.t,this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||((e=new hi).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(t,e=!1){let i=oi.b2_zombieParticle;e&&(i|=oi.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)}DestroyOldestParticle(t,e=!1){const i=this.GetParticleCount();this.m_indexByExpirationTimeBuffer.data;const s=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[s]>0?s:n,e)}DestroyParticlesInShape(t,e,i=!1){const s=ki.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked(),this.m_world.IsLocked())return 0;const n=new ki.DestroyParticlesInShapeCallback(this,t,e,i),o=s;return t.ComputeAABB(o,e,0),this.m_world.QueryAABB(n,o),n.Destroyed()}CreateParticleGroup(t){let e=ki.CreateParticleGroup_s_transform;if(this.m_world.IsLocked(),this.m_world.IsLocked())return null;let i=e;i.SetPositionAngle(t.position,t.angle);let s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,t.shapeCount,t,i),t.particleCount){t.positionData;for(let e=0;e<t.particleCount;e++){let s=t.positionData[e];this.CreateParticleForGroup(t,i,s)}}let n=this.m_count,o=new _i(this);o.m_firstIndex=s,o.m_lastIndex=n,o.m_strength=t.strength,o.m_userData=t.userData,o.m_transform.Copy(i),o.m_prev=null,o.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=o),this.m_groupList=o,++this.m_groupCount;for(let t=s;t<n;t++)this.m_groupBuffer[t]=o;this.SetGroupFlags(o,t.groupFlags);let r=new ki.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,n,r),t.group&&(this.JoinParticleGroups(t.group,o),o=t.group),o}JoinParticleGroups(t,e){if(this.m_world.IsLocked(),this.m_world.IsLocked())return;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),e.m_lastIndex,this.m_count,this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex),t.m_lastIndex,e.m_firstIndex;let i=new ki.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(let i=e.m_firstIndex;i<e.m_lastIndex;i++)this.m_groupBuffer[i]=t;let s=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);let e=t.GetParticleCount(),i=Object(n.e)(e,t=>new ki.ParticleListNode);ki.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);let s=ki.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,s),this.CreateParticleGroupsFromParticleList(t,i,s),this.UpdatePairsAndTriadsWithParticleList(t,i)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_count,this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&oi.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&oi.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}GetParticleFlags(t){return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}SetPositionBuffer(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}SetVelocityBuffer(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}SetColorBuffer(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}SetUserDataBuffer(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){let t=ki.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,i=0;for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],r=n.indexA,a=n.indexB,l=n.normal,h=o.A.SubVV(e[a],e[r],t),c=o.A.DotVV(h,l);c<0&&(i+=c*c)}return.5*this.GetParticleMass()*i}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){this.ValidateParticleIndex(t);let i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i){let t=this.GetParticleCount();for(let e=0;e<t;++e)this.m_indexByExpirationTimeBuffer.data[e]=e}let s=e/this.m_def.lifetimeGranularity,n=s>0?this.GetQuantizedTimeElapsed()+s:s;n!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=n,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ValidateParticleIndex(t),this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,i){let s=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),o=i.Clone().SelfMul(1/n);for(let i=t;i<e;i++)s[i].SelfAdd(o)}static IsSignificantForce(t){return 0!==t.x||0!==t.y}ParticleApplyForce(t,e){ki.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))}ApplyForce(t,e,i){let s=i.Clone().SelfMul(1/(e-t));if(ki.IsSignificantForce(s)){this.PrepareForceBuffer();for(let i=t;i<e;i++)this.m_forceBuffer[i].SelfAdd(s)}}GetNext(){return this.m_next}QueryAABB(t,e){if(0===this.m_proxyBuffer.count)return;let i=this.m_proxyBuffer.count,s=vi(this.m_proxyBuffer.data,0,i,ki.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),ki.Proxy.CompareProxyTag),n=xi(this.m_proxyBuffer.data,s,i,ki.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),ki.Proxy.CompareTagProxy),o=this.m_positionBuffer.data;for(let i=s;i<n;++i){let s=this.m_proxyBuffer.data[i].index,n=o[s];if(e.lowerBound.x<n.x&&n.x<e.upperBound.x&&e.lowerBound.y<n.y&&n.y<e.upperBound.y&&!t.ReportParticle(this,s))break}}QueryShapeAABB(t,e,i,s=0){let n=ki.QueryShapeAABB_s_aabb;e.ComputeAABB(n,i,s),this.QueryAABB(t,n)}QueryPointAABB(t,e,i=n.v){let s=ki.QueryPointAABB_s_aabb;s.lowerBound.Set(e.x-i,e.y-i),s.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,s)}RayCast(t,e,i){let s=ki.RayCast_s_aabb,n=ki.RayCast_s_p,r=ki.RayCast_s_v,a=ki.RayCast_s_n,l=ki.RayCast_s_point;if(0===this.m_proxyBuffer.count)return;let h=this.m_positionBuffer.data,c=s;o.A.MinV(e,i,c.lowerBound),o.A.MaxV(e,i,c.upperBound);let _,u=1,m=o.A.SubVV(i,e,r),d=o.A.DotVV(m,m),p=this.GetInsideBoundsEnumerator(c);for(;(_=p.GetNext())>=0;){let i=o.A.SubVV(e,h[_],n),s=o.A.DotVV(i,m),r=s*s-d*(o.A.DotVV(i,i)-this.m_squaredDiameter);if(r>=0){let n=Object(o.w)(r),h=(-s-n)/d;if(h>u)continue;if(h<0&&((h=(-s+n)/d)<0||h>u))continue;let c=o.A.AddVMulSV(i,h,m,a);c.Normalize();let p=t.ReportParticle(this,_,o.A.AddVMulSV(e,h,m,l),c,h);if((u=Object(o.n)(u,p))<=0)break}}}ComputeAABB(t){let e=this.GetParticleCount();t.lowerBound.x=+n.x,t.lowerBound.y=+n.x,t.upperBound.x=-n.x,t.upperBound.y=-n.x;let i=this.m_positionBuffer.data;for(let s=0;s<e;s++){let e=i[s];o.A.MinV(t.lowerBound,e,t.lowerBound),o.A.MaxV(t.upperBound,e,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}FreeBuffer(t,e){null!==t&&(t.length=0)}FreeUserOverridableBuffer(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(t,e,i){let s=t?t.slice():[];return s.length=i,s}ReallocateBuffer5(t,e,i,s,n){return n&&!t||e||(t=this.ReallocateBuffer3(t,i,s)),t}ReallocateBuffer4(t,e,i,s){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,s)}RequestBuffer(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(n.M),(t=[]).length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_internalAllocatedCapacity,this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function e(t,e){return e&&t>e?e:t}if(t=e(t=e(t=e(t=e(t=e(t=e(t,this.m_def.maxCount),this.m_flagsBuffer.userSuppliedCapacity),this.m_positionBuffer.userSuppliedCapacity),this.m_velocityBuffer.userSuppliedCapacity),this.m_colorBuffer.userSuppliedCapacity),this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);let e=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,e),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,e),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,e),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,i){let s=new ai;s.flags=t.flags,o.z.MulXV(e,i,s.position),o.A.AddVV(t.linearVelocity,o.A.CrossSV(t.angularVelocity,o.A.SubVV(s.position,t.position,o.A.s_t0),o.A.s_t0),s.velocity),s.color.Copy(t.color),s.lifetime=t.lifetime,s.userData=t.userData,this.CreateParticle(s)}CreateParticlesStrokeShapeForGroup(t,e,i){let s=ki.CreateParticlesStrokeShapeForGroup_s_edge,n=ki.CreateParticlesStrokeShapeForGroup_s_d,r=ki.CreateParticlesStrokeShapeForGroup_s_p,a=e.stride;0===a&&(a=this.GetParticleStride());let l=0,h=t.GetChildCount();for(let c=0;c<h;c++){let h=null;t.GetType()===jt.c.e_edgeShape?h=t:(t.GetType(),jt.c.e_chainShape,h=s,t.GetChildEdge(h,c));let _=o.A.SubVV(h.m_vertex2,h.m_vertex1,n),u=_.Length();for(;l<u;){let t=o.A.AddVMulSV(h.m_vertex1,l/u,_,r);this.CreateParticleForGroup(e,i,t),l+=a}l-=u}}CreateParticlesFillShapeForGroup(t,e,i){let s=ki.CreateParticlesFillShapeForGroup_s_aabb,n=ki.CreateParticlesFillShapeForGroup_s_p,r=e.stride;0===r&&(r=this.GetParticleStride());let a=o.z.IDENTITY,l=s;t.GetChildCount(),t.ComputeAABB(l,a,0);for(let s=Math.floor(l.lowerBound.y/r)*r;s<l.upperBound.y;s+=r)for(let o=Math.floor(l.lowerBound.x/r)*r;o<l.upperBound.x;o+=r){let r=n.Set(o,s);t.TestPoint(a,r)&&this.CreateParticleForGroup(e,i,r)}}CreateParticlesWithShapeForGroup(t,e,i){switch(t.GetType()){case jt.c.e_edgeShape:case jt.c.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case jt.c.e_polygonShape:case jt.c.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}}CreateParticlesWithShapesForGroup(t,e,i,s){let n=new ki.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(n,i,s)}CloneParticle(t,e){let i=new ai;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;let s=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){let e=this.m_handleIndexBuffer.data[t];e&&e.SetIndex(s),this.m_handleIndexBuffer.data[s]=e,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[s]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[s]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[s]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[s].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[s]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[s]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[s]=this.m_expirationTimeBuffer.data[t]),s}DestroyParticlesInGroup(t,e=!1){for(let i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}DestroyParticleGroup(t){this.m_groupCount,this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(t,e){return 0!=(t&(oi.b2_wallParticle|oi.b2_springParticle|oi.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&ri.b2_rigidParticleGroup)}UpdatePairsAndTriads(t,e,i){let s=ki.UpdatePairsAndTriads_s_dab,r=ki.UpdatePairsAndTriads_s_dbc,a=ki.UpdatePairsAndTriads_s_dca,l=this.m_positionBuffer.data,h=0;for(let i=t;i<e;i++)h|=this.m_flagsBuffer.data[i];if(h&ki.k_pairFlags)for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],r=n.indexA,a=n.indexB,h=this.m_flagsBuffer.data[r],c=this.m_flagsBuffer.data[a],_=this.m_groupBuffer[r],u=this.m_groupBuffer[a];if(r>=t&&r<e&&a>=t&&a<e&&!((h|c)&oi.b2_zombieParticle)&&(h|c)&ki.k_pairFlags&&(i.IsNecessary(r)||i.IsNecessary(a))&&ki.ParticleCanBeConnected(h,_)&&ki.ParticleCanBeConnected(c,u)&&i.ShouldCreatePair(r,a)){let t=this.m_pairBuffer.data[this.m_pairBuffer.Append()];t.indexA=r,t.indexB=a,t.flags=n.flags,t.strength=Object(o.n)(_?_.m_strength:1,u?u.m_strength:1),t.distance=o.A.DistanceVV(l[r],l[a])}yi(this.m_pairBuffer.data,0,this.m_pairBuffer.count,ki.ComparePairIndices),this.m_pairBuffer.Unique(ki.MatchPairIndices)}if(h&ki.k_triadFlags){let h=new mi(e-t);for(let s=t;s<e;s++){let t=this.m_flagsBuffer.data[s],e=this.m_groupBuffer[s];t&oi.b2_zombieParticle||!ki.ParticleCanBeConnected(t,e)||h.AddGenerator(l[s],s,i.IsNecessary(s))}let c=this.GetParticleStride();h.Generate(c/2,2*c);const _=this;let u=(t,e,h)=>{let c=_.m_flagsBuffer.data[t],u=_.m_flagsBuffer.data[e],m=_.m_flagsBuffer.data[h];if((c|u|m)&ki.k_triadFlags&&i.ShouldCreateTriad(t,e,h)){let i=l[t],d=l[e],p=l[h],f=o.A.SubVV(i,d,s),y=o.A.SubVV(d,p,r),g=o.A.SubVV(p,i,a),v=n.L*_.m_squaredDiameter;if(o.A.DotVV(f,f)>v||o.A.DotVV(y,y)>v||o.A.DotVV(g,g)>v)return;let x=_.m_groupBuffer[t],b=_.m_groupBuffer[e],A=_.m_groupBuffer[h],w=_.m_triadBuffer.data[_.m_triadBuffer.Append()];w.indexA=t,w.indexB=e,w.indexC=h,w.flags=c|u|m,w.strength=Object(o.n)(Object(o.n)(x?x.m_strength:1,b?b.m_strength:1),A?A.m_strength:1);let S=(i.x+d.x+p.x)/3,C=(i.y+d.y+p.y)/3;w.pa.x=i.x-S,w.pa.y=i.y-C,w.pb.x=d.x-S,w.pb.y=d.y-C,w.pc.x=p.x-S,w.pc.y=p.y-C,w.ka=-o.A.DotVV(g,f),w.kb=-o.A.DotVV(f,y),w.kc=-o.A.DotVV(y,g),w.s=o.A.CrossVV(i,d)+o.A.CrossVV(d,p)+o.A.CrossVV(p,i)}};h.GetNodes(u),yi(this.m_triadBuffer.data,0,this.m_triadBuffer.count,ki.CompareTriadIndices),this.m_triadBuffer.Unique(ki.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){let t=new ki.ReactiveFilter(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&=~oi.b2_reactiveParticle;this.m_allParticleFlags&=~oi.b2_reactiveParticle}static ComparePairIndices(t,e){let i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){let i=t.indexA-e.indexA;if(0!==i)return i<0;let s=t.indexB-e.indexB;return 0!==s?s<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){let i=t.GetBufferIndex(),s=t.GetParticleCount();for(let t=0;t<s;t++){let s=e[t];s.list=s,s.next=null,s.count=1,s.index=t+i}}MergeParticleListsInContact(t,e){let i=t.GetBufferIndex();for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],o=n.indexA,r=n.indexB;if(!t.ContainsParticle(o)||!t.ContainsParticle(r))continue;let a=e[o-i].list,l=e[r-i].list;if(a!==l){if(a.count<l.count){let t=a;a=l,l=t}a.count,l.count,ki.MergeParticleLists(a,l)}}}static MergeParticleLists(t,e){for(let i=e;;){i.list=t;let e=i.next;if(!e){i.next=t.next;break}i=e}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){let i=t.GetParticleCount(),s=e[0];for(let t=0;t<i;t++){let i=e[t];s.count<i.count&&(s=i)}return s}MergeZombieParticleListNodes(t,e,i){let s=t.GetParticleCount();for(let t=0;t<s;t++){let s=e[t];s!==i&&this.m_flagsBuffer.data[s.index]&oi.b2_zombieParticle&&ki.MergeParticleListAndNode(i,s)}}static MergeParticleListAndNode(t,e){e.list,e.count,e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}CreateParticleGroupsFromParticleList(t,e,i){let s=t.GetParticleCount(),n=new ci;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(let t=0;t<s;t++){let s=e[t];if(!s.count||s===i)continue;s.list;let o=this.CreateParticleGroup(n);for(let t=s;t;t=t.next){let e=t.index;this.m_flagsBuffer.data[e];oi.b2_zombieParticle;let i=this.CloneParticle(e,o);this.m_flagsBuffer.data[e]|=oi.b2_zombieParticle,t.index=i}}}UpdatePairsAndTriadsWithParticleList(t,e){let i=t.GetBufferIndex();for(let s=0;s<this.m_pairBuffer.count;s++){let n=this.m_pairBuffer.data[s],o=n.indexA,r=n.indexB;t.ContainsParticle(o)&&(n.indexA=e[o-i].index),t.ContainsParticle(r)&&(n.indexB=e[r-i].index)}for(let s=0;s<this.m_triadBuffer.count;s++){let n=this.m_triadBuffer.data[s],o=n.indexA,r=n.indexB,a=n.indexC;t.ContainsParticle(o)&&(n.indexA=e[o-i].index),t.ContainsParticle(r)&&(n.indexB=e[r-i].index),t.ContainsParticle(a)&&(n.indexC=e[a-i].index)}}ComputeDepth(){let t=[],e=0;for(let i=0;i<this.m_contactBuffer.count;i++){let s=this.m_contactBuffer.data[i],n=s.indexA,o=s.indexB,r=this.m_groupBuffer[n],a=this.m_groupBuffer[o];r&&r===a&&r.m_groupFlags&ri.b2_particleGroupNeedsUpdateDepth&&(t[e++]=s)}let i=[],s=0;for(let t=this.m_groupList;t;t=t.GetNext())if(t.m_groupFlags&ri.b2_particleGroupNeedsUpdateDepth){i[s++]=t,this.SetGroupFlags(t,t.m_groupFlags&~ri.b2_particleGroupNeedsUpdateDepth);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_accumulationBuffer[e]=0}for(let i=0;i<e;i++){let e=t[i],s=e.indexA,n=e.indexB,o=e.weight;this.m_accumulationBuffer[s]+=o,this.m_accumulationBuffer[n]+=o}this.m_depthBuffer;for(let t=0;t<s;t++){let e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++){let e=this.m_accumulationBuffer[t];this.m_depthBuffer[t]=e<.8?0:n.x}}let r=Object(o.w)(this.m_count)>>0;for(let i=0;i<r;i++){let i=!1;for(let s=0;s<e;s++){let e=t[s],n=e.indexA,o=e.indexB,r=1-e.weight,a=this.m_depthBuffer[n],l=this.m_depthBuffer[o],h=l+r,c=a+r;a>h&&(this.m_depthBuffer[n]=h,i=!0),l>c&&(this.m_depthBuffer[o]=c,i=!0)}if(!i)break}for(let t=0;t<s;t++){let e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++)this.m_depthBuffer[t]<n.x?this.m_depthBuffer[t]*=this.m_particleDiameter:this.m_depthBuffer[t]=0}}GetInsideBoundsEnumerator(t){let e=ki.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=ki.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),s=this.m_proxyBuffer.count,n=vi(this.m_proxyBuffer.data,0,s,e,ki.Proxy.CompareProxyTag),o=xi(this.m_proxyBuffer.data,0,s,i,ki.Proxy.CompareTagProxy);return new ki.InsideBoundsEnumerator(this,e,i,n,o)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e,i){let s=ki.AddContact_s_d,n=this.m_positionBuffer.data;this.m_contactBuffer;let r=o.A.SubVV(n[e],n[t],s),a=o.A.DotVV(r,r);if(a<this.m_squaredDiameter){let i=Object(o.h)(a);isFinite(i)||(i=198177537e11);let s=this.m_contactBuffer.data[this.m_contactBuffer.Append()];s.indexA=t,s.indexB=e,s.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],s.weight=1-a*i*this.m_inverseDiameter,o.A.MulSV(i,r,s.normal)}}FindContacts_Reference(t){this.m_contactBuffer;let e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let t=0,i=0;t<e;t++){let s=ki.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0);for(let i=t+1;i<e&&!(s<this.m_proxyBuffer.data[i].tag);i++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[i].index,this.m_contactBuffer);let n=ki.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);for(;i<e&&!(n<=this.m_proxyBuffer.data[i].tag);i++);let o=ki.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1);for(let s=i;s<e&&!(o<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}}FindContacts(t){this.FindContacts_Reference(t)}UpdateProxies_Reference(t){this.m_proxyBuffer;let e=this.m_positionBuffer.data,i=this.m_inverseDiameter;for(let t=0;t<this.m_proxyBuffer.count;++t){let s=this.m_proxyBuffer.data[t],n=e[s.index];s.tag=ki.computeTag(i*n.x,i*n.y)}}UpdateProxies(t){this.UpdateProxies_Reference(t)}SortProxies(t){this.m_proxyBuffer,fi(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,ki.Proxy.CompareProxyProxy)}FilterContacts(t){let e=this.GetParticleContactFilter();if(null===e)return;this.m_contactBuffer;const i=this;this.m_contactBuffer.RemoveIf(t=>t.flags&oi.b2_particleContactFilterParticle&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB))}NotifyContactListenerPreContact(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){let e=this.GetParticleContactListener();if(null!==e){for(let i=0;i<this.m_contactBuffer.count;++i){let s=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,s)}throw new Error}}static b2ParticleContactIsZombie(t){return(t.flags&oi.b2_zombieParticle)===oi.b2_zombieParticle}UpdateContacts(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);let e=new ki.b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(ki.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){let e=this.GetFixtureContactListener();if(null!==e){for(let i=0;i<this.m_bodyContactBuffer.count;i++){let s=this.m_bodyContactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,s)}throw new Error}}UpdateBodyContacts(){let t=ki.UpdateBodyContacts_s_aabb,e=new ki.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){let t=this.GetParticleCount();for(let e=0;e<t;e++)this.m_bodyContactCountBuffer.data[e]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[e]+1&&(this.m_consecutiveContactStepsBuffer.data[e]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);let i=t;this.ComputeAABB(i);let s=new ki.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(s,i),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}Solve(t){let e=ki.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&oi.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;let i=e.Copy(t);i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&ri.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&oi.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&oi.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&oi.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&oi.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&oi.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&ri.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&oi.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&oi.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&ki.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&oi.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&oi.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&ri.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&oi.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&ri.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&oi.b2_wallParticle&&this.SolveWall();for(let t=0;t<this.m_count;t++)this.m_positionBuffer.data[t].SelfMulAdd(i.dt,this.m_velocityBuffer.data[t])}}SolveCollision(t){let e=ki.SolveCollision_s_aabb,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=e;r.lowerBound.x=+n.x,r.lowerBound.y=+n.x,r.upperBound.x=-n.x,r.upperBound.y=-n.x;for(let e=0;e<this.m_count;e++){let n=s[e],a=i[e],l=a.x+t.dt*n.x,h=a.y+t.dt*n.y;r.lowerBound.x=Object(o.n)(r.lowerBound.x,Object(o.n)(a.x,l)),r.lowerBound.y=Object(o.n)(r.lowerBound.y,Object(o.n)(a.y,h)),r.upperBound.x=Object(o.m)(r.upperBound.x,Object(o.m)(a.x,l)),r.upperBound.y=Object(o.m)(r.upperBound.y,Object(o.m)(a.y,h))}let a=new ki.SolveCollisionCallback(this,t);this.m_world.QueryAABB(a,r)}LimitVelocity(t){let e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t);for(let t=0;t<this.m_count;t++){let s=e[t],n=o.A.DotVV(s,s);n>i&&s.SelfMul(Object(o.w)(i/n))}}SolveGravity(t){let e=ki.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,s=o.A.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let t=0;t<this.m_count;t++)i[t].SelfAdd(s)}SolveBarrier(t){let e=ki.SolveBarrier_s_aabb,i=ki.SolveBarrier_s_va,s=ki.SolveBarrier_s_vb,r=ki.SolveBarrier_s_pba,a=ki.SolveBarrier_s_vba,l=ki.SolveBarrier_s_vc,h=ki.SolveBarrier_s_pca,c=ki.SolveBarrier_s_vca,_=ki.SolveBarrier_s_qba,u=ki.SolveBarrier_s_qca,m=ki.SolveBarrier_s_dv,d=ki.SolveBarrier_s_f,p=this.m_positionBuffer.data,f=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++){0!=(this.m_flagsBuffer.data[t]&ki.k_barrierWallFlags)&&f[t].SetZero()}let y=n.o*t.dt,g=this.GetParticleMass();for(let n=0;n<this.m_pairBuffer.count;n++){let v=this.m_pairBuffer.data[n];if(v.flags&oi.b2_barrierParticle){let n=v.indexA,x=v.indexB,b=p[n],A=p[x],w=e;o.A.MinV(b,A,w.lowerBound),o.A.MaxV(b,A,w.upperBound);let S,C=this.m_groupBuffer[n],B=this.m_groupBuffer[x],V=this.GetLinearVelocity(C,n,b,i),M=this.GetLinearVelocity(B,x,A,s),k=o.A.SubVV(A,b,r),I=o.A.SubVV(M,V,a),P=this.GetInsideBoundsEnumerator(w);for(;(S=P.GetNext())>=0;){let e=p[S],i=this.m_groupBuffer[S];if(C!==i&&B!==i){let s,n,r=this.GetLinearVelocity(i,S,e,l),a=o.A.SubVV(e,b,h),p=o.A.SubVV(r,V,c),v=o.A.CrossVV(I,p),x=o.A.CrossVV(k,p)-o.A.CrossVV(a,I),A=o.A.CrossVV(k,a),w=_,C=u;if(0===v){if(0===x)continue;if(!((n=-A/x)>=0&&n<y))continue;if(o.A.AddVMulSV(k,n,I,w),o.A.AddVMulSV(a,n,p,C),!((s=o.A.DotVV(w,C)/o.A.DotVV(w,w))>=0&&s<=1))continue}else{let t=x*x-4*A*v;if(t<0)continue;let e=Object(o.w)(t),i=(-x-e)/(2*v),r=(-x+e)/(2*v);if(i>r){let t=i;i=r,r=t}if(n=i,o.A.AddVMulSV(k,n,I,w),o.A.AddVMulSV(a,n,p,C),s=o.A.DotVV(w,C)/o.A.DotVV(w,w),!(n>=0&&n<y&&s>=0&&s<=1)){if(!((n=r)>=0&&n<y))continue;if(o.A.AddVMulSV(k,n,I,w),o.A.AddVMulSV(a,n,p,C),!((s=o.A.DotVV(w,C)/o.A.DotVV(w,w))>=0&&s<=1))continue}}let B=m;B.x=V.x+s*I.x-r.x,B.y=V.y+s*I.y-r.y;let M=o.A.MulSV(g,B,d);if(this.IsRigidGroup(i)){let t=i.GetMass(),s=i.GetInertia();t>0&&i.m_linearVelocity.SelfMulAdd(1/t,M),s>0&&(i.m_angularVelocity+=o.A.CrossVV(o.A.SubVV(e,i.GetCenter(),o.A.s_t0),M)/s)}else f[S].SelfAdd(B);this.ParticleApplyForce(S,M.SelfMul(-t.inv_dt))}}}}}SolveStaticPressure(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);let e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,s=n.C*e,r=this.m_def.staticPressureRelaxation;for(let t=0;t<this.m_def.staticPressureIterations;t++){for(let t=0;t<this.m_count;t++)this.m_accumulationBuffer[t]=0;for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];if(e.flags&oi.b2_staticPressureParticle){let t=e.indexA,i=e.indexB,s=e.weight;this.m_accumulationBuffer[t]+=s*this.m_staticPressureBuffer[i],this.m_accumulationBuffer[i]+=s*this.m_staticPressureBuffer[t]}}for(let t=0;t<this.m_count;t++){let e=this.m_weightBuffer[t];if(this.m_flagsBuffer.data[t]&oi.b2_staticPressureParticle){let a=(this.m_accumulationBuffer[t]+i*(e-n.N))/(e+r);this.m_staticPressureBuffer[t]=Object(o.e)(a,0,s)}else this.m_staticPressureBuffer[t]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t],i=e.index,s=e.weight;this.m_weightBuffer[i]+=s}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t],i=e.indexA,s=e.indexB,n=e.weight;this.m_weightBuffer[i]+=n,this.m_weightBuffer[s]+=n}}SolvePressure(t){let e=ki.SolvePressure_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.GetCriticalPressure(t),a=this.m_def.pressureStrength*r,l=n.C*r;for(let t=0;t<this.m_count;t++){let e=this.m_weightBuffer[t],i=a*Object(o.m)(0,e-n.N);this.m_accumulationBuffer[t]=Object(o.n)(i,l)}if(this.m_allParticleFlags&ki.k_noPressureFlags)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&ki.k_noPressureFlags&&(this.m_accumulationBuffer[t]=0);if(this.m_allParticleFlags&oi.b2_staticPressureParticle){this.m_staticPressureBuffer;for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&oi.b2_staticPressureParticle&&(this.m_accumulationBuffer[t]+=this.m_staticPressureBuffer[t])}let h=t.dt/(this.m_def.density*this.m_particleDiameter),c=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let n=this.m_bodyContactBuffer.data[t],r=n.index,l=n.body,_=n.weight,u=n.mass,m=n.normal,d=i[r],p=this.m_accumulationBuffer[r]+a*_,f=o.A.MulSV(h*_*u*p,m,e);s[r].SelfMulSub(c,f),l.ApplyLinearImpulse(f,d,!0)}for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t],n=i.indexA,r=i.indexB,a=i.weight,l=i.normal,c=this.m_accumulationBuffer[n]+this.m_accumulationBuffer[r],_=o.A.MulSV(h*a*c,l,e);s[n].SelfSub(_),s[r].SelfAdd(_)}}SolveDamping(t){let e=ki.SolveDamping_s_v,i=ki.SolveDamping_s_f,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let h=this.m_bodyContactBuffer.data[t],c=h.index,_=h.body,u=h.weight,m=h.mass,d=h.normal,p=s[c],f=o.A.SubVV(_.GetLinearVelocityFromWorldPoint(p,o.A.s_t0),n[c],e),y=o.A.DotVV(f,d);if(y<0){let t=Object(o.m)(r*u,Object(o.n)(-a*y,.5)),e=o.A.MulSV(t*m*y,d,i);n[c].SelfMulAdd(l,e),_.ApplyLinearImpulse(e.SelfNeg(),p,!0)}}for(let t=0;t<this.m_contactBuffer.count;t++){let s=this.m_contactBuffer.data[t],l=s.indexA,h=s.indexB,c=s.weight,_=s.normal,u=o.A.SubVV(n[h],n[l],e),m=o.A.DotVV(u,_);if(m<0){let t=Object(o.m)(r*c,Object(o.n)(-a*m,.5)),e=o.A.MulSV(t*m,_,i);n[l].SelfAdd(e),n[h].SelfSub(e)}}}SolveRigidDamping(){let t=ki.SolveRigidDamping_s_t0,e=ki.SolveRigidDamping_s_t1,i=ki.SolveRigidDamping_s_p,s=ki.SolveRigidDamping_s_v,n=[0],r=[0],a=[0],l=[0],h=[0],c=[0],_=this.m_positionBuffer.data,u=this.m_def.dampingStrength;for(let i=0;i<this.m_bodyContactBuffer.count;i++){let m=this.m_bodyContactBuffer.data[i],d=m.index,p=this.m_groupBuffer[d];if(this.IsRigidGroup(p)){let i=m.body,f=m.normal,y=m.weight,g=_[d],v=o.A.SubVV(i.GetLinearVelocityFromWorldPoint(g,t),p.GetLinearVelocityFromWorldPoint(g,e),s),x=o.A.DotVV(v,f);if(x<0){this.InitDampingParameterWithRigidGroupOrParticle(n,r,a,!0,p,d,g,f),this.InitDampingParameter(l,h,c,i.GetMass(),i.GetInertia()-i.GetMass()*i.GetLocalCenter().LengthSquared(),i.GetWorldCenter(),g,f);let t=u*Object(o.n)(y,1)*this.ComputeDampingImpulse(n[0],r[0],a[0],l[0],h[0],c[0],x);this.ApplyDamping(n[0],r[0],a[0],!0,p,d,t,f),i.ApplyLinearImpulse(o.A.MulSV(-t,f,o.A.s_t0),g,!0)}}}for(let m=0;m<this.m_contactBuffer.count;m++){let d=this.m_contactBuffer.data[m],p=d.indexA,f=d.indexB,y=d.normal,g=d.weight,v=this.m_groupBuffer[p],x=this.m_groupBuffer[f],b=this.IsRigidGroup(v),A=this.IsRigidGroup(x);if(v!==x&&(b||A)){let m=o.A.MidVV(_[p],_[f],i),d=o.A.SubVV(this.GetLinearVelocity(x,f,m,t),this.GetLinearVelocity(v,p,m,e),s),w=o.A.DotVV(d,y);if(w<0){this.InitDampingParameterWithRigidGroupOrParticle(n,r,a,b,v,p,m,y),this.InitDampingParameterWithRigidGroupOrParticle(l,h,c,A,x,f,m,y);let t=u*g*this.ComputeDampingImpulse(n[0],r[0],a[0],l[0],h[0],c[0],w);this.ApplyDamping(n[0],r[0],a[0],b,v,p,t,y),this.ApplyDamping(l[0],h[0],c[0],A,x,f,-t,y)}}}}SolveExtraDamping(){let t=ki.SolveExtraDamping_s_v,e=ki.SolveExtraDamping_s_f,i=this.m_velocityBuffer.data,s=this.m_positionBuffer.data,n=this.GetParticleInvMass();for(let r=0;r<this.m_bodyContactBuffer.count;r++){let a=this.m_bodyContactBuffer.data[r],l=a.index;if(this.m_flagsBuffer.data[l]&ki.k_extraDampingFlags){let r=a.body,h=a.mass,c=a.normal,_=s[l],u=o.A.SubVV(r.GetLinearVelocityFromWorldPoint(_,o.A.s_t0),i[l],t),m=o.A.DotVV(u,c);if(m<0){let t=o.A.MulSV(.5*h*m,c,e);i[l].SelfMulAdd(n,t),r.ApplyLinearImpulse(t.SelfNeg(),_,!0)}}}}SolveWall(){let t=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&oi.b2_wallParticle&&t[e].SetZero()}SolveRigid(t){let e=ki.SolveRigid_s_position,i=ki.SolveRigid_s_rotation,s=ki.SolveRigid_s_transform,n=ki.SolveRigid_s_velocityTransform,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&ri.b2_rigidParticleGroup){l.UpdateStatistics();let h=i;h.SetAngle(t.dt*l.m_angularVelocity);let c=o.A.AddVV(l.m_center,o.A.SubVV(o.A.MulSV(t.dt,l.m_linearVelocity,o.A.s_t0),o.t.MulRV(h,l.m_center,o.A.s_t1),o.A.s_t0),e),_=s;_.SetPositionRotation(c,h),o.z.MulXX(_,l.m_transform,l.m_transform);let u=n;u.p.x=t.inv_dt*_.p.x,u.p.y=t.inv_dt*_.p.y,u.q.s=t.inv_dt*_.q.s,u.q.c=t.inv_dt*(_.q.c-1);for(let t=l.m_firstIndex;t<l.m_lastIndex;t++)o.z.MulXV(u,r[t],a[t])}}SolveElastic(t){let e=ki.SolveElastic_s_pa,i=ki.SolveElastic_s_pb,s=ki.SolveElastic_s_pc,n=ki.SolveElastic_s_r,r=ki.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,h=t.inv_dt*this.m_def.elasticStrength;for(let c=0;c<this.m_triadBuffer.count;c++){let _=this.m_triadBuffer.data[c];if(_.flags&oi.b2_elasticParticle){let c=_.indexA,u=_.indexB,m=_.indexC,d=_.pa,p=_.pb,f=_.pc,y=e.Copy(a[c]),g=i.Copy(a[u]),v=s.Copy(a[m]),x=l[c],b=l[u],A=l[m];y.SelfMulAdd(t.dt,x),g.SelfMulAdd(t.dt,b),v.SelfMulAdd(t.dt,A);let w=(y.x+g.x+v.x)/3,S=(y.y+g.y+v.y)/3;y.x-=w,y.y-=S,g.x-=w,g.y-=S,v.x-=w,v.y-=S;let C=n;C.s=o.A.CrossVV(d,y)+o.A.CrossVV(p,g)+o.A.CrossVV(f,v),C.c=o.A.DotVV(d,y)+o.A.DotVV(p,g)+o.A.DotVV(f,v);let B=C.s*C.s+C.c*C.c,V=Object(o.h)(B);isFinite(V)||(V=198177537e11),C.s*=V,C.c*=V;let M=h*_.strength;o.t.MulRV(C,d,r),o.A.SubVV(r,y,r),o.A.MulSV(M,r,r),x.SelfAdd(r),o.t.MulRV(C,p,r),o.A.SubVV(r,g,r),o.A.MulSV(M,r,r),b.SelfAdd(r),o.t.MulRV(C,f,r),o.A.SubVV(r,v,r),o.A.MulSV(M,r,r),A.SelfAdd(r)}}}SolveSpring(t){let e=ki.SolveSpring_s_pa,i=ki.SolveSpring_s_pb,s=ki.SolveSpring_s_d,n=ki.SolveSpring_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=t.inv_dt*this.m_def.springStrength;for(let h=0;h<this.m_pairBuffer.count;h++){let c=this.m_pairBuffer.data[h];if(c.flags&oi.b2_springParticle){let h=c.indexA,_=c.indexB,u=e.Copy(r[h]),m=i.Copy(r[_]),d=a[h],p=a[_];u.SelfMulAdd(t.dt,d),m.SelfMulAdd(t.dt,p);let f=o.A.SubVV(m,u,s),y=c.distance,g=f.Length(),v=l*c.strength,x=o.A.MulSV(v*(y-g)/g,f,n);d.SelfSub(x),p.SelfAdd(x)}}}SolveTensile(t){let e=ki.SolveTensile_s_weightedNormal,i=ki.SolveTensile_s_s,s=ki.SolveTensile_s_f,r=this.m_velocityBuffer.data;this.m_accumulation2Buffer;for(let t=0;t<this.m_count;t++)this.m_accumulation2Buffer[t]=new o.A,this.m_accumulation2Buffer[t].SetZero();for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];if(i.flags&oi.b2_tensileParticle){let t=i.indexA,s=i.indexB,n=i.weight,r=i.normal,a=o.A.MulSV((1-n)*n,r,e);this.m_accumulation2Buffer[t].SelfSub(a),this.m_accumulation2Buffer[s].SelfAdd(a)}}let a=this.GetCriticalVelocity(t),l=this.m_def.surfaceTensionPressureStrength*a,h=this.m_def.surfaceTensionNormalStrength*a,c=n.A*a;for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];if(e.flags&oi.b2_tensileParticle){let t=e.indexA,n=e.indexB,a=e.weight,_=e.normal,u=this.m_weightBuffer[t]+this.m_weightBuffer[n],m=o.A.SubVV(this.m_accumulation2Buffer[n],this.m_accumulation2Buffer[t],i),d=Object(o.n)(l*(u-2)+h*o.A.DotVV(m,_),c)*a,p=o.A.MulSV(d,_,s);r[t].SelfSub(p),r[n].SelfAdd(p)}}}SolveViscous(){let t=ki.SolveViscous_s_v,e=ki.SolveViscous_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.m_def.viscousStrength,r=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){let l=this.m_bodyContactBuffer.data[a],h=l.index;if(this.m_flagsBuffer.data[h]&oi.b2_viscousParticle){let a=l.body,c=l.weight,_=l.mass,u=i[h],m=o.A.SubVV(a.GetLinearVelocityFromWorldPoint(u,o.A.s_t0),s[h],t),d=o.A.MulSV(n*_*c,m,e);s[h].SelfMulAdd(r,d),a.ApplyLinearImpulse(d.SelfNeg(),u,!0)}}for(let i=0;i<this.m_contactBuffer.count;i++){let r=this.m_contactBuffer.data[i];if(r.flags&oi.b2_viscousParticle){let i=r.indexA,a=r.indexB,l=r.weight,h=o.A.SubVV(s[a],s[i],t),c=o.A.MulSV(n*l,h,e);s[i].SelfAdd(c),s[a].SelfSub(c)}}}SolveRepulsive(t){let e=ki.SolveRepulsive_s_f,i=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(let t=0;t<this.m_contactBuffer.count;t++){let n=this.m_contactBuffer.data[t];if(n.flags&oi.b2_repulsiveParticle){let t=n.indexA,r=n.indexB;if(this.m_groupBuffer[t]!==this.m_groupBuffer[r]){let a=n.weight,l=n.normal,h=o.A.MulSV(s*a,l,e);i[t].SelfSub(h),i[r].SelfAdd(h)}}}}SolvePowder(t){let e=ki.SolvePowder_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.m_def.powderStrength*this.GetCriticalVelocity(t),a=1-n.O,l=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let n=this.m_bodyContactBuffer.data[t],h=n.index;if(this.m_flagsBuffer.data[h]&oi.b2_powderParticle){let t=n.weight;if(t>a){let c=n.body,_=n.mass,u=i[h],m=n.normal,d=o.A.MulSV(r*_*(t-a),m,e);s[h].SelfMulSub(l,d),c.ApplyLinearImpulse(d,u,!0)}}}for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];if(i.flags&oi.b2_powderParticle){let t=i.weight;if(t>a){let n=i.indexA,l=i.indexB,h=i.normal,c=o.A.MulSV(r*(t-a),h,e);s[n].SelfSub(c),s[l].SelfAdd(c)}}}}SolveSolid(t){let e=ki.SolveSolid_s_f,i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);let s=t.inv_dt*this.m_def.ejectionStrength;for(let t=0;t<this.m_contactBuffer.count;t++){let n=this.m_contactBuffer.data[t],r=n.indexA,a=n.indexB;if(this.m_groupBuffer[r]!==this.m_groupBuffer[a]){let t=n.weight,l=n.normal,h=this.m_depthBuffer[r]+this.m_depthBuffer[a],c=o.A.MulSV(s*h*t,l,e);i[r].SelfSub(c),i[a].SelfAdd(c)}}}SolveForce(t){let e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass();for(let t=0;t<this.m_count;t++)e[t].SelfMulAdd(i,this.m_forceBuffer[t]);this.m_hasForce=!1}SolveColorMixing(){this.m_colorBuffer.data;const t=.5*this.m_def.colorMixingStrength;if(t)for(let e=0;e<this.m_contactBuffer.count;e++){let i=this.m_contactBuffer.data[e],s=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[n]&oi.b2_colorMixingParticle){let e=this.m_colorBuffer.data[s],i=this.m_colorBuffer.data[n];r.MixColors(e,i,t)}}}SolveZombie(){let t=0,e=[];for(let t=0;t<this.m_count;t++)e[t]=n.t;e.length,this.m_count;let i=0;for(let s=0;s<this.m_count;s++){let o=this.m_flagsBuffer.data[s];if(o&oi.b2_zombieParticle){let t=this.m_world.m_destructionListener;if(o&oi.b2_destructionListenerParticle&&t&&t.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){let t=this.m_handleIndexBuffer.data[s];t&&(t.SetIndex(n.t),this.m_handleIndexBuffer.data[s]=null)}e[s]=n.t}else{if(e[s]=t,s!==t){if(this.m_handleIndexBuffer.data){let e=this.m_handleIndexBuffer.data[s];e&&e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[t]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[s])}t++,i|=o}}let s=t=>t.index<0,r=t=>t.indexA<0||t.indexB<0,a=t=>t.index<0,l=t=>t.indexA<0||t.indexB<0,h=t=>t.indexA<0||t.indexB<0||t.indexC<0;for(let t=0;t<this.m_proxyBuffer.count;t++){let i=this.m_proxyBuffer.data[t];i.index=e[i.index]}this.m_proxyBuffer.RemoveIf(s);for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_contactBuffer.RemoveIf(r);for(let t=0;t<this.m_bodyContactBuffer.count;t++){let i=this.m_bodyContactBuffer.data[t];i.index=e[i.index]}this.m_bodyContactBuffer.RemoveIf(a);for(let t=0;t<this.m_pairBuffer.count;t++){let i=this.m_pairBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_pairBuffer.RemoveIf(l);for(let t=0;t<this.m_triadBuffer.count;t++){let i=this.m_triadBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB],i.indexC=e[i.indexC]}if(this.m_triadBuffer.RemoveIf(h),this.m_indexByExpirationTimeBuffer.data){let t=0;for(let i=0;i<this.m_count;i++){let s=e[this.m_indexByExpirationTimeBuffer.data[i]];s!==n.t&&(this.m_indexByExpirationTimeBuffer.data[t++]=s)}}for(let i=this.m_groupList;i;i=i.GetNext()){let s=t,n=0,r=!1;for(let t=i.m_firstIndex;t<i.m_lastIndex;t++){let i=e[t];i>=0?(s=Object(o.n)(s,i),n=Object(o.m)(n,i+1)):r=!0}s<n?(i.m_firstIndex=s,i.m_lastIndex=n,r&&i.m_groupFlags&ri.b2_solidParticleGroup&&this.SetGroupFlags(i,i.m_groupFlags|ri.b2_particleGroupNeedsUpdateDepth)):(i.m_firstIndex=0,i.m_lastIndex=0,i.m_groupFlags&ri.b2_particleGroupCanBeEmpty||this.SetGroupFlags(i,i.m_groupFlags|ri.b2_particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=i,this.m_needsUpdateAllParticleFlags=!1;for(let t=this.m_groupList;t;){let e=t.GetNext();t.m_groupFlags&ri.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(t),t=e}}SolveLifetimes(t){this.m_expirationTimeBuffer.data,this.m_indexByExpirationTimeBuffer.data,this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);let e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,s=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){fi(s,0,n,(t,e)=>{let s=i[t],n=i[e],o=s<=0;return o===n<=0?s>n:o}),this.m_expirationTimeBufferRequiresSorting=!1}for(let t=n-1;t>=0;--t){let n=s[t],o=i[n];if(e<o||o<=0)break;this.DestroyParticle(n)}}RotateBuffer(t,e,i){if(t!==e&&e!==i){if(bi(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&bi(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&bi(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&bi(this.m_consecutiveContactStepsBuffer.data,t,e,i),bi(this.m_positionBuffer.data,t,e,i),bi(this.m_velocityBuffer.data,t,e,i),bi(this.m_groupBuffer,t,e,i),this.m_hasForce&&bi(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&bi(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&bi(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&bi(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&bi(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){bi(this.m_handleIndexBuffer.data,t,e,i);for(let e=t;e<i;++e){let t=this.m_handleIndexBuffer.data[e];t&&t.SetIndex(s(t.GetIndex()))}}if(this.m_expirationTimeBuffer.data){bi(this.m_expirationTimeBuffer.data,t,e,i);let n=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data;for(let t=0;t<n;++t)o[t]=s(o[t])}for(let t=0;t<this.m_proxyBuffer.count;t++){let e=this.m_proxyBuffer.data[t];e.index=s(e.index)}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB)}for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t];e.index=s(e.index)}for(let t=0;t<this.m_pairBuffer.count;t++){let e=this.m_pairBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB)}for(let t=0;t<this.m_triadBuffer.count;t++){let e=this.m_triadBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB),e.indexC=s(e.indexC)}for(let t=this.m_groupList;t;t=t.GetNext())t.m_firstIndex=s(t.m_firstIndex),t.m_lastIndex=s(t.m_lastIndex-1)+1}function s(s){return s<t?s:s<e?s+i-e:s<i?s+t-e:s}}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){let e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return n.O*this.m_particleDiameter}GetParticleMass(){let t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){let t=this.m_inverseDiameter*(1/n.O);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&oi.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&oi.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&oi.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&oi.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(t,e,i){t.data=e,t.userSuppliedCapacity=i}SetGroupFlags(t,e){let i=t.m_groupFlags;(i^e)&ri.b2_solidParticleGroup&&(e|=ri.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&ri.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}RemoveSpuriousBodyContacts(){fi(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,ki.BodyContactCompare);let t=ki.RemoveSpuriousBodyContacts_s_n,e=ki.RemoveSpuriousBodyContacts_s_pos,i=ki.RemoveSpuriousBodyContacts_s_normal;const s=this;let r=-1,a=0;this.m_bodyContactBuffer.count=gi(this.m_bodyContactBuffer.data,l=>{if(l.index!==r&&(a=0,r=l.index),a++>3)return!0;let h=t.Copy(l.normal);h.SelfMul(s.m_particleDiameter*(1-l.weight));let c=o.A.AddVV(s.m_positionBuffer.data[l.index],h,e);if(!l.fixture.TestPoint(c)){let t=l.fixture.GetShape().GetChildCount();for(let e=0;e<t;e++){let t=i;if(l.fixture.ComputeDistance(c,t,e)<n.v)return!1}return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==n.t}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(t){return!(t&oi.b2_wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(t){return null!==t&&0!=(t.m_groupFlags&ri.b2_rigidParticleGroup)}GetLinearVelocity(t,e,i,s){return this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,s):s.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,i,s,n,r,a,l){t[0]=s>0?1/s:0,e[0]=n>0?1/n:0,i[0]=o.A.CrossVV(o.A.SubVV(a,r,o.A.s_t0),l)}InitDampingParameterWithRigidGroupOrParticle(t,e,i,s,n,o,r,a){if(s)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),r,a);else{let s=this.m_flagsBuffer.data[o];this.InitDampingParameter(t,e,i,s&oi.b2_wallParticle?0:this.GetParticleMass(),0,r,r,a)}}ComputeDampingImpulse(t,e,i,s,n,o,r){let a=t+e*i*i+s+n*o*o;return a>0?r/a:0}ApplyDamping(t,e,i,s,n,o,r,a){s?(n.m_linearVelocity.SelfMulAdd(r*t,a),n.m_angularVelocity+=r*i*e):this.m_velocityBuffer.data[o].SelfMulAdd(r*t,a)}}ki.xTruncBits=12,ki.yTruncBits=12,ki.tagBits=32,ki.yOffset=1<<ki.yTruncBits-1,ki.yShift=ki.tagBits-ki.yTruncBits,ki.xShift=ki.tagBits-ki.yTruncBits-ki.xTruncBits,ki.xScale=1<<ki.xShift,ki.xOffset=ki.xScale*(1<<ki.xTruncBits-1),ki.yMask=(1<<ki.yTruncBits)-1<<ki.yShift,ki.xMask=~ki.yMask,ki.DestroyParticlesInShape_s_aabb=new m.a,ki.CreateParticleGroup_s_transform=new o.z,ki.ComputeCollisionEnergy_s_v=new o.A,ki.QueryShapeAABB_s_aabb=new m.a,ki.QueryPointAABB_s_aabb=new m.a,ki.RayCast_s_aabb=new m.a,ki.RayCast_s_p=new o.A,ki.RayCast_s_v=new o.A,ki.RayCast_s_n=new o.A,ki.RayCast_s_point=new o.A,ki.k_pairFlags=oi.b2_springParticle,ki.k_triadFlags=oi.b2_elasticParticle,ki.k_noPressureFlags=oi.b2_powderParticle|oi.b2_tensileParticle,ki.k_extraDampingFlags=oi.b2_staticPressureParticle,ki.k_barrierWallFlags=oi.b2_barrierParticle|oi.b2_wallParticle,ki.CreateParticlesStrokeShapeForGroup_s_edge=new zt,ki.CreateParticlesStrokeShapeForGroup_s_d=new o.A,ki.CreateParticlesStrokeShapeForGroup_s_p=new o.A,ki.CreateParticlesFillShapeForGroup_s_aabb=new m.a,ki.CreateParticlesFillShapeForGroup_s_p=new o.A,ki.UpdatePairsAndTriads_s_dab=new o.A,ki.UpdatePairsAndTriads_s_dbc=new o.A,ki.UpdatePairsAndTriads_s_dca=new o.A,ki.AddContact_s_d=new o.A,ki.UpdateBodyContacts_s_aabb=new m.a,ki.Solve_s_subStep=new He,ki.SolveCollision_s_aabb=new m.a,ki.SolveGravity_s_gravity=new o.A,ki.SolveBarrier_s_aabb=new m.a,ki.SolveBarrier_s_va=new o.A,ki.SolveBarrier_s_vb=new o.A,ki.SolveBarrier_s_pba=new o.A,ki.SolveBarrier_s_vba=new o.A,ki.SolveBarrier_s_vc=new o.A,ki.SolveBarrier_s_pca=new o.A,ki.SolveBarrier_s_vca=new o.A,ki.SolveBarrier_s_qba=new o.A,ki.SolveBarrier_s_qca=new o.A,ki.SolveBarrier_s_dv=new o.A,ki.SolveBarrier_s_f=new o.A,ki.SolvePressure_s_f=new o.A,ki.SolveDamping_s_v=new o.A,ki.SolveDamping_s_f=new o.A,ki.SolveRigidDamping_s_t0=new o.A,ki.SolveRigidDamping_s_t1=new o.A,ki.SolveRigidDamping_s_p=new o.A,ki.SolveRigidDamping_s_v=new o.A,ki.SolveExtraDamping_s_v=new o.A,ki.SolveExtraDamping_s_f=new o.A,ki.SolveRigid_s_position=new o.A,ki.SolveRigid_s_rotation=new o.t,ki.SolveRigid_s_transform=new o.z,ki.SolveRigid_s_velocityTransform=new o.z,ki.SolveElastic_s_pa=new o.A,ki.SolveElastic_s_pb=new o.A,ki.SolveElastic_s_pc=new o.A,ki.SolveElastic_s_r=new o.t,ki.SolveElastic_s_t0=new o.A,ki.SolveSpring_s_pa=new o.A,ki.SolveSpring_s_pb=new o.A,ki.SolveSpring_s_d=new o.A,ki.SolveSpring_s_f=new o.A,ki.SolveTensile_s_weightedNormal=new o.A,ki.SolveTensile_s_s=new o.A,ki.SolveTensile_s_f=new o.A,ki.SolveViscous_s_v=new o.A,ki.SolveViscous_s_f=new o.A,ki.SolveRepulsive_s_f=new o.A,ki.SolvePowder_s_f=new o.A,ki.SolveSolid_s_f=new o.A,ki.RemoveSpuriousBodyContacts_s_n=new o.A,ki.RemoveSpuriousBodyContacts_s_pos=new o.A,ki.RemoveSpuriousBodyContacts_s_normal=new o.A,function(t){t.UserOverridableBuffer=class{constructor(){this.data=null,this.userSuppliedCapacity=0}};t.Proxy=class{constructor(){this.index=n.t,this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}};t.InsideBoundsEnumerator=class{constructor(e,i,s,n,o){this.m_system=e,this.m_xLower=(i&t.xMask)>>>0,this.m_xUpper=(s&t.xMask)>>>0,this.m_yLower=(i&t.yMask)>>>0,this.m_yUpper=(s&t.yMask)>>>0,this.m_first=n,this.m_last=o,this.m_first,this.m_last}GetNext(){for(;this.m_first<this.m_last;){let e=(this.m_system.m_proxyBuffer.data[this.m_first].tag&t.xMask)>>>0;if(e>=this.m_xLower&&e<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return n.t}};t.ParticleListNode=class{constructor(){this.list=null,this.next=null,this.count=0,this.index=0}};t.FixedSetAllocator=class{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}};t.FixtureParticle=class{constructor(t,e){this.second=n.t,this.first=t,this.second=e}};t.FixtureParticleSet=class extends t.FixedSetAllocator{Initialize(t,e){}Find(t){return n.t}};t.ParticlePair=class{constructor(t,e){this.first=n.t,this.second=n.t,this.first=t,this.second=e}};t.b2ParticlePairSet=class extends t.FixedSetAllocator{Initialize(t,e){}Find(t){return n.t}};t.ConnectionFilter=class{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,i){return!0}};t.DestroyParticlesInShapeCallback=class extends ze{constructor(t,e,i,s){super(),this.m_callDestructionListener=!1,this.m_destroyed=0,this.m_system=t,this.m_shape=e,this.m_xf=i,this.m_callDestructionListener=s,this.m_destroyed=0}ReportFixture(t){return!1}ReportParticle(t,e){return t===this.m_system&&(e>=0&&this.m_system.m_count,this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}Destroyed(){return this.m_destroyed}};t.JoinParticleGroupsFilter=class extends t.ConnectionFilter{constructor(t){super(),this.m_threshold=0,this.m_threshold=t}ShouldCreatePair(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}ShouldCreateTriad(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}};t.CompositeShape=class extends jt.b{constructor(t,e=t.length){super(jt.c.e_unknown,0),this.m_shapeCount=0,this.m_shapes=t,this.m_shapeCount=e}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(t,e){for(let i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}ComputeDistance(t,e,i,s){return 0}RayCast(t,e,i,s){return!1}ComputeAABB(t,e,i){let s=new m.a;t.lowerBound.x=+n.x,t.lowerBound.y=+n.x,t.upperBound.x=-n.x,t.upperBound.y=-n.x;for(let i=0;i<this.m_shapeCount;i++){let n=this.m_shapes[i].GetChildCount();for(let o=0;o<n;o++){let n=s;this.m_shapes[i].ComputeAABB(n,e,o),t.Combine1(n)}}}ComputeMass(t,e){}SetupDistanceProxy(t,e){}ComputeSubmergedArea(t,e,i,s){return 0}Dump(t){}};t.ReactiveFilter=class extends t.ConnectionFilter{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(t){return 0!=(this.m_flagsBuffer.data[t]&oi.b2_reactiveParticle)}};class e extends wi{constructor(t,e){super(t),this.m_contactFilter=e}ShouldCollideFixtureParticle(t,e,i){if(this.m_contactFilter){if(this.m_system.GetFlagsBuffer()[i]&oi.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}return!0}ReportFixtureAndParticle(e,i,s){let n=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,r=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp,a=this.m_system.m_positionBuffer.data[s],l=n,h=e.ComputeDistance(a,l,i);if(h<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,s)){let t=e.GetBody(),i=t.GetWorldCenter(),n=t.GetMass(),c=t.GetInertia()-n*t.GetLocalCenter().LengthSquared(),_=n>0?1/n:0,u=c>0?1/c:0,m=this.m_system.m_flagsBuffer.data[s]&oi.b2_wallParticle?0:this.m_system.GetParticleInvMass(),d=o.A.SubVV(a,i,r),p=o.A.CrossVV(d,l),f=m+_+u*p*p,y=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];y.index=s,y.body=t,y.fixture=e,y.weight=1-h*this.m_system.m_inverseDiameter,y.normal.Copy(l.SelfNeg()),y.mass=f>0?1/f:0,this.m_system.DetectStuckParticle(s)}}}e.ReportFixtureAndParticle_s_n=new o.A,e.ReportFixtureAndParticle_s_rp=new o.A,t.UpdateBodyContactsCallback=e;class i extends wi{constructor(t,e){super(t),this.m_step=e}ReportFixtureAndParticle(e,i,s){let r=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,a=t.SolveCollisionCallback.ReportFixtureAndParticle_s_output,l=t.SolveCollisionCallback.ReportFixtureAndParticle_s_input,h=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p,c=t.SolveCollisionCallback.ReportFixtureAndParticle_s_v,_=t.SolveCollisionCallback.ReportFixtureAndParticle_s_f,u=e.GetBody(),m=this.m_system.m_positionBuffer.data[s],d=this.m_system.m_velocityBuffer.data[s],p=a,f=l;if(0===this.m_system.m_iterationIndex){let t=o.z.MulTXV(u.m_xf0,m,r);e.GetShape().GetType()===jt.c.e_circleShape&&(t.SelfSub(u.GetLocalCenter()),o.t.MulRV(u.m_xf0.q,t,t),o.t.MulTRV(u.m_xf.q,t,t),t.SelfAdd(u.GetLocalCenter())),o.z.MulXV(u.m_xf,t,f.p1)}else f.p1.Copy(m);if(o.A.AddVMulSV(m,this.m_step.dt,d,f.p2),f.maxFraction=1,e.RayCast(p,f,i)){let t=p.normal,e=h;e.x=(1-p.fraction)*f.p1.x+p.fraction*f.p2.x+n.v*t.x,e.y=(1-p.fraction)*f.p1.y+p.fraction*f.p2.y+n.v*t.y;let i=c;i.x=this.m_step.inv_dt*(e.x-m.x),i.y=this.m_step.inv_dt*(e.y-m.y),this.m_system.m_velocityBuffer.data[s].Copy(i);let o=_;o.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.x-i.x),o.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.y-i.y),this.m_system.ParticleApplyForce(s,o)}}ReportParticle(t,e){return!1}}i.ReportFixtureAndParticle_s_p1=new o.A,i.ReportFixtureAndParticle_s_output=new m.m,i.ReportFixtureAndParticle_s_input=new m.l,i.ReportFixtureAndParticle_s_p=new o.A,i.ReportFixtureAndParticle_s_v=new o.A,i.ReportFixtureAndParticle_s_f=new o.A,t.SolveCollisionCallback=i}(ki||(ki={}));class Ii{constructor(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new Je,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new o.A,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new We,this.m_island=new ni,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}SetDestructionListener(t){this.m_destructionListener=t}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t}SetDebugDraw(t){this.m_debugDraw=t}CreateBody(t){if(this.IsLocked())return null;const e=new Yt(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){if(this.IsLocked())return;let e=t.m_jointList;for(;e;){const i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;let i=t.m_controllerList;for(;i;){const e=i;i=i.nextController,e.controller.RemoveBody(t)}let s=t.m_contactList;for(;s;){const t=s;s=s.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;let n=t.m_fixtureList;for(;n;){const e=n;n=n.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(e),e.DestroyProxies(this.m_contactManager.m_broadPhase),e.Destroy(),t.m_fixtureList=n,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}CreateJoint(t){if(this.IsLocked())return null;const e=Be.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const i=t.bodyA,s=t.bodyB;if(!t.collideConnected){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}return e}DestroyJoint(t){if(this.IsLocked())return;const e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const i=t.m_bodyA,s=t.m_bodyB;if(i.SetAwake(!0),s.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,Be.Destroy(t,null),--this.m_jointCount,!e){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}}CreateParticleSystem(t){if(this.IsLocked())return null;const e=new ki(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}DestroyParticleSystem(t){this.IsLocked()||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next))}CalculateReasonableParticleIterations(t){if(null===this.m_particleSystemList)return 1;return li(this.m_gravity.Length(),function(t){let e=n.x;for(let i=t.GetParticleSystemList();null!==i;i=i.m_next)e=Object(o.n)(e,i.GetRadius());return e}(this),t)}Step(t,e,i,s=this.CalculateReasonableParticleIterations(t)){const n=Ii.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;const o=Ii.Step_s_step;o.dt=t,o.velocityIterations=e,o.positionIterations=i,o.particleIterations=s,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;const r=Ii.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&o.dt>0){const t=Ii.Step_s_timer.Reset();for(let t=this.m_particleSystemList;t;t=t.m_next)t.Solve(o);this.Solve(o),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){const t=Ii.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=t.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}DrawParticleSystem(t){const e=t.GetParticleCount();if(e){const i=t.GetRadius(),s=t.GetPositionBuffer();if(t.m_colorBuffer.data){const n=t.GetColorBuffer();this.m_debugDraw.DrawParticles(s,i,n,e)}else this.m_debugDraw.DrawParticles(s,i,null,e)}}DrawDebugData(){if(null===this.m_debugDraw)return;const t=this.m_debugDraw.GetFlags(),e=Ii.DrawDebugData_s_color.SetRGB(0,0,0);if(t&s.e_shapeBit)for(let t=this.m_bodyList;t;t=t.m_next){const i=t.m_xf;this.m_debugDraw.PushTransform(i);for(let i=t.GetFixtureList();i;i=i.m_next)t.IsActive()?t.GetType()===Jt.b2_staticBody?(e.SetRGB(.5,.9,.5),this.DrawShape(i,e)):t.GetType()===Jt.b2_kinematicBody?(e.SetRGB(.5,.5,.9),this.DrawShape(i,e)):t.IsAwake()?(e.SetRGB(.9,.7,.7),this.DrawShape(i,e)):(e.SetRGB(.6,.6,.6),this.DrawShape(i,e)):(e.SetRGB(.5,.5,.3),this.DrawShape(i,e));this.m_debugDraw.PopTransform(i)}if(t&s.e_particleBit)for(let t=this.m_particleSystemList;t;t=t.m_next)this.DrawParticleSystem(t);if(t&s.e_jointBit)for(let t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(t&s.e_aabbBit){e.SetRGB(.9,.3,.9);const t=this.m_contactManager.m_broadPhase,i=Ii.DrawDebugData_s_vs;for(let s=this.m_bodyList;s;s=s.m_next)if(s.IsActive())for(let n=s.GetFixtureList();n;n=n.m_next)for(let s=0;s<n.m_proxyCount;++s){const o=n.m_proxies[s],r=t.GetFatAABB(o.treeNode);i[0].Set(r.lowerBound.x,r.lowerBound.y),i[1].Set(r.upperBound.x,r.lowerBound.y),i[2].Set(r.upperBound.x,r.upperBound.y),i[3].Set(r.lowerBound.x,r.upperBound.y),this.m_debugDraw.DrawPolygon(i,4,e)}}if(t&s.e_centerOfMassBit)for(let t=this.m_bodyList;t;t=t.m_next){const e=Ii.DrawDebugData_s_xf;e.q.Copy(t.m_xf.q),e.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(e)}if(t&s.e_controllerBit)for(let t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw)}QueryAABB(t,e){const i=this.m_contactManager.m_broadPhase;if(i.Query(function(e){const s=i.GetUserData(e).fixture;return t instanceof ze?t.ReportFixture(s):t(s)},e),t instanceof ze)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryAABB(t,e)}QueryShape(t,e,i){const s=this.m_contactManager.m_broadPhase;const n=Ii.QueryShape_s_aabb;if(e.ComputeAABB(n,i,0),s.Query(function(n){const o=s.GetUserData(n).fixture;return!Object(m.o)(e,0,o.GetShape(),0,i,o.GetBody().GetTransform())||(t instanceof ze?t.ReportFixture(o):t(o))},n),t instanceof ze)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,n)}QueryPoint(t,e){const i=this.m_contactManager.m_broadPhase;const s=Ii.QueryPoint_s_aabb;if(s.lowerBound.Set(e.x-n.v,e.y-n.v),s.upperBound.Set(e.x+n.v,e.y+n.v),i.Query(function(s){const n=i.GetUserData(s).fixture;return!n.TestPoint(e)||(t instanceof ze?t.ReportFixture(n):t(n))},s),t instanceof ze)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,s)}RayCast(t,e,i){const s=this.m_contactManager.m_broadPhase;const n=Ii.RayCast_s_input;if(n.maxFraction=1,n.p1.Copy(e),n.p2.Copy(i),s.RayCast(function(n,o){const r=s.GetUserData(o),a=r.fixture,l=r.childIndex,h=Ii.RayCast_s_output;if(a.RayCast(h,n,l)){const s=h.fraction,n=Ii.RayCast_s_point;return n.Set((1-s)*e.x+s*i.x,(1-s)*e.y+s*i.y),t instanceof Ue?t.ReportFixture(a,n,h.normal,s):t(a,n,h.normal,s)}return n.maxFraction},n),t instanceof Ue)for(let s=this.m_particleSystemList;s;s=s.m_next)t.ShouldQueryParticleSystem(s)&&s.RayCast(t,e,i)}RayCastOne(t,e){let i=null,s=1;return this.RayCast(function(t,e,n,o){return o<s&&(s=o,i=t),s},t,e),i}RayCastAll(t,e,i=[]){return this.RayCast(function(t,e,s,n){return i.push(t),1},t,e),i}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t,e=!0){if(!o.A.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){if(!this.IsLocked()){for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(t){if(this.m_locked)return;t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");let e=0;for(let i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(let t=this.m_jointList;t;t=t.m_next)t.m_index=e,++e;for(let e=this.m_jointList;e;e=e.m_next)e.m_type!==Wt.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"));for(let e=this.m_jointList;e;e=e.m_next)e.m_type===Wt.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"))}DrawJoint(t){const e=t.GetBodyA(),i=t.GetBodyB(),s=e.m_xf,n=i.m_xf,o=s.p,r=n.p,a=t.GetAnchorA(Ii.DrawJoint_s_p1),l=t.GetAnchorB(Ii.DrawJoint_s_p2),h=Ii.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case Wt.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,h);break;case Wt.e_pulleyJoint:{const e=t,i=e.GetGroundAnchorA(),s=e.GetGroundAnchorB();this.m_debugDraw.DrawSegment(i,a,h),this.m_debugDraw.DrawSegment(s,l,h),this.m_debugDraw.DrawSegment(i,s,h)}break;case Wt.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,h);break;default:this.m_debugDraw.DrawSegment(o,a,h),this.m_debugDraw.DrawSegment(a,l,h),this.m_debugDraw.DrawSegment(r,l,h)}}DrawShape(t,e){const i=t.GetShape();switch(i.m_type){case jt.c.e_circleShape:{const t=i,s=t.m_p,n=t.m_radius,r=o.A.UNITX;this.m_debugDraw.DrawSolidCircle(s,n,r,e)}break;case jt.c.e_edgeShape:{const t=i,s=t.m_vertex1,n=t.m_vertex2;this.m_debugDraw.DrawSegment(s,n,e)}break;case jt.c.e_chainShape:{const t=i,s=t.m_count,n=t.m_vertices;let o=n[0];this.m_debugDraw.DrawCircle(o,.05,e);for(let t=1;t<s;++t){const i=n[t];this.m_debugDraw.DrawSegment(o,i,e),this.m_debugDraw.DrawCircle(i,.05,e),o=i}}break;case jt.c.e_polygonShape:{const t=i,s=t.m_count,n=t.m_vertices;this.m_debugDraw.DrawSolidPolygon(n,s,e)}}}Solve(t){for(let t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag)continue;if(!s.IsAwake()||!s.IsActive())continue;if(s.GetType()===Jt.b2_staticBody)continue;e.Clear();let n=0;for(i[n++]=s,s.m_islandFlag=!0;n>0;){const t=i[--n];if(e.AddBody(t),t.SetAwake(!0),t.GetType()!==Jt.b2_staticBody){for(let s=t.m_contactList;s;s=s.next){const t=s.contact;if(t.m_islandFlag)continue;if(!t.IsEnabled()||!t.IsTouching())continue;const o=t.m_fixtureA.m_isSensor,r=t.m_fixtureB.m_isSensor;if(o||r)continue;e.AddContact(t),t.m_islandFlag=!0;const a=s.other;a.m_islandFlag||(i[n++]=a,a.m_islandFlag=!0)}for(let s=t.m_jointList;s;s=s.next){if(s.joint.m_islandFlag)continue;const t=s.other;t.IsActive()&&(e.AddJoint(s.joint),s.joint.m_islandFlag=!0,t.m_islandFlag||(i[n++]=t,t.m_islandFlag=!0))}}}const o=new We;e.Solve(o,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=o.solveInit,this.m_profile.solveVelocity+=o.solveVelocity,this.m_profile.solvePosition+=o.solvePosition;for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];i.GetType()===Jt.b2_staticBody&&(i.m_islandFlag=!1)}}for(let t=0;t<i.length&&i[t];++t)i[t]=null;const s=new l;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==Jt.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=s.GetMilliseconds()}SolveTOI(t){const e=this.m_island;if(e.Initialize(2*n.H,n.H,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let i=null,s=1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next){if(!t.IsEnabled())continue;if(t.m_toiCount>n.G)continue;let e=1;if(t.m_toiFlag)e=t.m_toi;else{const i=t.GetFixtureA(),s=t.GetFixtureB();if(i.IsSensor()||s.IsSensor())continue;const n=i.GetBody(),r=s.GetBody(),a=n.m_type,l=r.m_type,h=n.IsAwake()&&a!==Jt.b2_staticBody,c=r.IsAwake()&&l!==Jt.b2_staticBody;if(!h&&!c)continue;const _=n.IsBullet()||a!==Jt.b2_dynamicBody,u=r.IsBullet()||l!==Jt.b2_dynamicBody;if(!_&&!u)continue;let m=n.m_sweep.alpha0;n.m_sweep.alpha0<r.m_sweep.alpha0?(m=r.m_sweep.alpha0,n.m_sweep.Advance(m)):r.m_sweep.alpha0<n.m_sweep.alpha0&&(m=n.m_sweep.alpha0,r.m_sweep.Advance(m));const d=t.GetChildIndexA(),p=t.GetChildIndexB(),f=Ii.SolveTOI_s_toi_input;f.proxyA.SetShape(i.GetShape(),d),f.proxyB.SetShape(s.GetShape(),p),f.sweepA.Copy(n.m_sweep),f.sweepB.Copy(r.m_sweep),f.tMax=1;const y=Ii.SolveTOI_s_toi_output;Z(y,f);const g=y.t;e=y.state===R.e_touching?Object(o.n)(m+(1-m)*g,1):1,t.m_toi=e,t.m_toiFlag=!0}e<s&&(i=t,s=e)}if(null===i||1-10*n.r<s){this.m_stepComplete=!0;break}const r=i.GetFixtureA(),a=i.GetFixtureB(),l=r.GetBody(),h=a.GetBody(),c=Ii.SolveTOI_s_backup1.Copy(l.m_sweep),_=Ii.SolveTOI_s_backup2.Copy(h.m_sweep);if(l.Advance(s),h.Advance(s),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,!i.IsEnabled()||!i.IsTouching()){i.SetEnabled(!1),l.m_sweep.Copy(c),h.m_sweep.Copy(_),l.SynchronizeTransform(),h.SynchronizeTransform();continue}l.SetAwake(!0),h.SetAwake(!0),e.Clear(),e.AddBody(l),e.AddBody(h),e.AddContact(i),l.m_islandFlag=!0,h.m_islandFlag=!0,i.m_islandFlag=!0;for(let t=0;t<2;++t){const i=0===t?l:h;if(i.m_type===Jt.b2_dynamicBody)for(let t=i.m_contactList;t&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;t=t.next){const n=t.contact;if(n.m_islandFlag)continue;const o=t.other;if(o.m_type===Jt.b2_dynamicBody&&!i.IsBullet()&&!o.IsBullet())continue;const r=n.m_fixtureA.m_isSensor,a=n.m_fixtureB.m_isSensor;if(r||a)continue;const l=Ii.SolveTOI_s_backup.Copy(o.m_sweep);o.m_islandFlag||o.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.IsEnabled()&&n.IsTouching()?(n.m_islandFlag=!0,e.AddContact(n),o.m_islandFlag||(o.m_islandFlag=!0,o.m_type!==Jt.b2_staticBody&&o.SetAwake(!0),e.AddBody(o))):(o.m_sweep.Copy(l),o.SynchronizeTransform())}}const u=Ii.SolveTOI_s_subStep;u.dt=(1-s)*t.dt,u.inv_dt=1/u.dt,u.dtRatio=1,u.positionIterations=20,u.velocityIterations=t.velocityIterations,u.particleIterations=t.particleIterations,u.warmStarting=!1,e.SolveTOI(u,l.m_islandIndex,h.m_islandIndex);for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];if(i.m_islandFlag=!1,i.m_type===Jt.b2_dynamicBody){i.SynchronizeFixtures();for(let t=i.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}AddController(t){return t.m_world=this,t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}RemoveController(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t.m_world=null,t}}Ii.Step_s_step=new He,Ii.Step_s_stepTimer=new l,Ii.Step_s_timer=new l,Ii.DrawDebugData_s_color=new r(0,0,0),Ii.DrawDebugData_s_vs=o.A.MakeArray(4),Ii.DrawDebugData_s_xf=new o.z,Ii.QueryShape_s_aabb=new m.a,Ii.QueryPoint_s_aabb=new m.a,Ii.RayCast_s_input=new m.l,Ii.RayCast_s_output=new m.m,Ii.RayCast_s_point=new o.A,Ii.DrawJoint_s_p1=new o.A,Ii.DrawJoint_s_p2=new o.A,Ii.DrawJoint_s_color=new r(.5,.8,.8),Ii.SolveTOI_s_subStep=new He,Ii.SolveTOI_s_backup=new o.y,Ii.SolveTOI_s_backup1=new o.y,Ii.SolveTOI_s_backup2=new o.y,Ii.SolveTOI_s_toi_input=new L,Ii.SolveTOI_s_toi_output=new F;class Pi{constructor(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new o.A(0,0),this.damping=.1,this.k2=.9,this.k3=.1}}class $i{constructor(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_gravity=new o.A,this.m_damping=0,this.m_k2=1,this.m_k3=.1}GetVertexCount(){return this.m_count}GetVertices(){return this.m_ps}Initialize(t){this.m_count=t.count,this.m_ps=o.A.MakeArray(this.m_count),this.m_p0s=o.A.MakeArray(this.m_count),this.m_vs=o.A.MakeArray(this.m_count),this.m_ims=Object(n.g)(this.m_count);for(let e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();const i=t.masses[e];this.m_ims[e]=i>0?1/i:0}const e=this.m_count-1,i=this.m_count-2;this.m_Ls=Object(n.g)(e),this.m_as=Object(n.g)(i);for(let t=0;t<e;++t){const e=this.m_ps[t],i=this.m_ps[t+1];this.m_Ls[t]=o.A.DistanceVV(e,i)}for(let t=0;t<i;++t){const e=this.m_ps[t],i=this.m_ps[t+1],s=this.m_ps[t+2],n=o.A.SubVV(i,e,o.A.s_t0),r=o.A.SubVV(s,i,o.A.s_t1),a=o.A.CrossVV(n,r),l=o.A.DotVV(n,r);this.m_as[t]=Object(o.d)(a,l)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}Step(t,e){if(0===t)return;const i=Math.exp(-t*this.m_damping);for(let e=0;e<this.m_count;++e)this.m_p0s[e].Copy(this.m_ps[e]),this.m_ims[e]>0&&this.m_vs[e].SelfMulAdd(t,this.m_gravity),this.m_vs[e].SelfMul(i),this.m_ps[e].SelfMulAdd(t,this.m_vs[e]);for(let t=0;t<e;++t)this.SolveC2(),this.SolveC3(),this.SolveC2();const s=1/t;for(let t=0;t<this.m_count;++t)o.A.MulSV(s,o.A.SubVV(this.m_ps[t],this.m_p0s[t],o.A.s_t0),this.m_vs[t])}SolveC2(){const t=this.m_count-1;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=o.A.SubVV(i,t,$i.s_d),n=s.Normalize(),r=this.m_ims[e],a=this.m_ims[e+1];if(r+a===0)continue;const l=r/(r+a),h=a/(r+a);t.SelfMulSub(this.m_k2*l*(this.m_Ls[e]-n),s),i.SelfMulAdd(this.m_k2*h*(this.m_Ls[e]-n),s)}}SetAngle(t){const e=this.m_count-2;for(let i=0;i<e;++i)this.m_as[i]=t}SolveC3(){const t=this.m_count-2;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=this.m_ps[e+2],r=this.m_ims[e],a=this.m_ims[e+1],l=this.m_ims[e+2],h=o.A.SubVV(i,t,$i.s_d1),c=o.A.SubVV(s,i,$i.s_d2),_=h.LengthSquared(),u=c.LengthSquared();if(_*u==0)continue;const m=o.A.CrossVV(h,c),d=o.A.DotVV(h,c);let p=Object(o.d)(m,d);const f=o.A.MulSV(-1/_,h.SelfSkew(),$i.s_Jd1),y=o.A.MulSV(1/u,c.SelfSkew(),$i.s_Jd2),g=o.A.NegV(f,$i.s_J1),v=o.A.SubVV(f,y,$i.s_J2),x=y;let b=r*o.A.DotVV(g,g)+a*o.A.DotVV(v,v)+l*o.A.DotVV(x,x);if(0===b)continue;b=1/b;let A=p-this.m_as[e];for(;A>n.P;)A=(p-=2*n.P)-this.m_as[e];for(;A<-n.P;)A=(p+=2*n.P)-this.m_as[e];const w=-this.m_k3*b*A;t.SelfMulAdd(r*w,g),i.SelfMulAdd(a*w,v),s.SelfMulAdd(l*w,x)}}Draw(t){const e=new r(.4,.5,.7);for(let i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}$i.s_d=new o.A,$i.s_d1=new o.A,$i.s_d2=new o.A,$i.s_Jd1=new o.A,$i.s_Jd2=new o.A,$i.s_J1=new o.A,$i.s_J2=new o.A,i.d(e,"b2Assert",function(){return n.b}),i.d(e,"b2_maxFloat",function(){return n.x}),i.d(e,"b2_epsilon",function(){return n.r}),i.d(e,"b2_epsilon_sq",function(){return n.s}),i.d(e,"b2_pi",function(){return n.P}),i.d(e,"b2_maxManifoldPoints",function(){return n.z}),i.d(e,"b2_maxPolygonVertices",function(){return n.D}),i.d(e,"b2_aabbExtension",function(){return n.k}),i.d(e,"b2_aabbMultiplier",function(){return n.l}),i.d(e,"b2_linearSlop",function(){return n.v}),i.d(e,"b2_angularSlop",function(){return n.n}),i.d(e,"b2_polygonRadius",function(){return n.Q}),i.d(e,"b2_maxSubSteps",function(){return n.G}),i.d(e,"b2_maxTOIContacts",function(){return n.H}),i.d(e,"b2_velocityThreshold",function(){return n.T}),i.d(e,"b2_maxLinearCorrection",function(){return n.y}),i.d(e,"b2_maxAngularCorrection",function(){return n.w}),i.d(e,"b2_maxTranslation",function(){return n.I}),i.d(e,"b2_maxTranslationSquared",function(){return n.J}),i.d(e,"b2_maxRotation",function(){return n.E}),i.d(e,"b2_maxRotationSquared",function(){return n.F}),i.d(e,"b2_baumgarte",function(){return n.p}),i.d(e,"b2_toiBaumgarte",function(){return n.S}),i.d(e,"b2_invalidParticleIndex",function(){return n.t}),i.d(e,"b2_maxParticleIndex",function(){return n.B}),i.d(e,"b2_particleStride",function(){return n.O}),i.d(e,"b2_minParticleWeight",function(){return n.N}),i.d(e,"b2_maxParticlePressure",function(){return n.C}),i.d(e,"b2_maxParticleForce",function(){return n.A}),i.d(e,"b2_maxTriadDistance",function(){return n.K}),i.d(e,"b2_maxTriadDistanceSquared",function(){return n.L}),i.d(e,"b2_minParticleSystemBufferCapacity",function(){return n.M}),i.d(e,"b2_barrierCollisionTime",function(){return n.o}),i.d(e,"b2_timeToSleep",function(){return n.R}),i.d(e,"b2_linearSleepTolerance",function(){return n.u}),i.d(e,"b2_angularSleepTolerance",function(){return n.m}),i.d(e,"b2Alloc",function(){return n.a}),i.d(e,"b2Free",function(){return n.c}),i.d(e,"b2Log",function(){return n.d}),i.d(e,"b2Version",function(){return n.j}),i.d(e,"b2_version",function(){return n.U}),i.d(e,"b2_changelist",function(){return n.q}),i.d(e,"b2ParseInt",function(){return n.h}),i.d(e,"b2ParseUInt",function(){return n.i}),i.d(e,"b2MakeArray",function(){return n.e}),i.d(e,"b2MakeNullArray",function(){return n.f}),i.d(e,"b2MakeNumberArray",function(){return n.g}),i.d(e,"b2_pi_over_180",function(){return o.E}),i.d(e,"b2_180_over_pi",function(){return o.D}),i.d(e,"b2_two_pi",function(){return o.F}),i.d(e,"b2Abs",function(){return o.a}),i.d(e,"b2Min",function(){return o.n}),i.d(e,"b2Max",function(){return o.m}),i.d(e,"b2Clamp",function(){return o.e}),i.d(e,"b2Swap",function(){return o.x}),i.d(e,"b2IsValid",function(){return o.j}),i.d(e,"b2Sq",function(){return o.v}),i.d(e,"b2InvSqrt",function(){return o.h}),i.d(e,"b2Sqrt",function(){return o.w}),i.d(e,"b2Pow",function(){return o.p}),i.d(e,"b2DegToRad",function(){return o.g}),i.d(e,"b2RadToDeg",function(){return o.q}),i.d(e,"b2Cos",function(){return o.f}),i.d(e,"b2Sin",function(){return o.u}),i.d(e,"b2Acos",function(){return o.b}),i.d(e,"b2Asin",function(){return o.c}),i.d(e,"b2Atan2",function(){return o.d}),i.d(e,"b2NextPowerOfTwo",function(){return o.o}),i.d(e,"b2IsPowerOfTwo",function(){return o.i}),i.d(e,"b2Random",function(){return o.r}),i.d(e,"b2RandomRange",function(){return o.s}),i.d(e,"b2Vec2",function(){return o.A}),i.d(e,"b2Vec2_zero",function(){return o.B}),i.d(e,"b2Vec3",function(){return o.C}),i.d(e,"b2Mat22",function(){return o.k}),i.d(e,"b2Mat33",function(){return o.l}),i.d(e,"b2Rot",function(){return o.t}),i.d(e,"b2Transform",function(){return o.z}),i.d(e,"b2Sweep",function(){return o.y}),i.d(e,"b2Color",function(){return r}),i.d(e,"b2DrawFlags",function(){return s}),i.d(e,"b2Draw",function(){return a}),i.d(e,"b2Timer",function(){return l}),i.d(e,"b2Counter",function(){return h}),i.d(e,"b2GrowableStack",function(){return c}),i.d(e,"b2BlockAllocator",function(){return _}),i.d(e,"b2StackAllocator",function(){return u}),i.d(e,"b2ContactFeatureType",function(){return m.e}),i.d(e,"b2ContactFeature",function(){return m.d}),i.d(e,"b2ContactID",function(){return m.f}),i.d(e,"b2ManifoldPoint",function(){return m.i}),i.d(e,"b2ManifoldType",function(){return m.j}),i.d(e,"b2Manifold",function(){return m.h}),i.d(e,"b2WorldManifold",function(){return m.p}),i.d(e,"b2PointState",function(){return m.k}),i.d(e,"b2GetPointStates",function(){return m.g}),i.d(e,"b2ClipVertex",function(){return m.c}),i.d(e,"b2RayCastInput",function(){return m.l}),i.d(e,"b2RayCastOutput",function(){return m.m}),i.d(e,"b2AABB",function(){return m.a}),i.d(e,"b2TestOverlapAABB",function(){return m.n}),i.d(e,"b2ClipSegmentToLine",function(){return m.b}),i.d(e,"b2TestOverlapShape",function(){return m.o}),i.d(e,"b2DistanceProxy",function(){return d.d}),i.d(e,"b2SimplexCache",function(){return d.f}),i.d(e,"b2DistanceInput",function(){return d.b}),i.d(e,"b2DistanceOutput",function(){return d.c}),i.d(e,"b2_gjkCalls",function(){return d.h}),i.d(e,"b2_gjkIters",function(){return d.i}),i.d(e,"b2_gjkMaxIters",function(){return d.j}),i.d(e,"b2_gjk_reset",function(){return d.k}),i.d(e,"b2SimplexVertex",function(){return d.g}),i.d(e,"b2Simplex",function(){return d.e}),i.d(e,"b2Distance",function(){return d.a}),i.d(e,"b2Pair",function(){return g}),i.d(e,"b2BroadPhase",function(){return v}),i.d(e,"b2PairLessThan",function(){return x}),i.d(e,"b2TreeNode",function(){return f}),i.d(e,"b2DynamicTree",function(){return y}),i.d(e,"b2_toiTime",function(){return b}),i.d(e,"b2_toiMaxTime",function(){return A}),i.d(e,"b2_toiCalls",function(){return w}),i.d(e,"b2_toiIters",function(){return S}),i.d(e,"b2_toiMaxIters",function(){return C}),i.d(e,"b2_toiRootIters",function(){return B}),i.d(e,"b2_toiMaxRootIters",function(){return V}),i.d(e,"b2_toi_reset",function(){return M}),i.d(e,"b2TOIInput",function(){return L}),i.d(e,"b2TOIOutputState",function(){return R}),i.d(e,"b2TOIOutput",function(){return F}),i.d(e,"b2SeparationFunctionType",function(){return E}),i.d(e,"b2SeparationFunction",function(){return q}),i.d(e,"b2TimeOfImpact",function(){return Z}),i.d(e,"b2CollideCircles",function(){return K}),i.d(e,"b2CollidePolygonAndCircle",function(){return st}),i.d(e,"b2CollidePolygons",function(){return Bt}),i.d(e,"b2CollideEdgeAndCircle",function(){return Gt}),i.d(e,"b2CollideEdgeAndPolygon",function(){return qt}),i.d(e,"b2MassData",function(){return jt.a}),i.d(e,"b2ShapeType",function(){return jt.c}),i.d(e,"b2Shape",function(){return jt.b}),i.d(e,"b2CircleShape",function(){return Nt}),i.d(e,"b2PolygonShape",function(){return Ot}),i.d(e,"b2EdgeShape",function(){return zt}),i.d(e,"b2ChainShape",function(){return Ut}),i.d(e,"b2Filter",function(){return Xt.a}),i.d(e,"b2FixtureDef",function(){return Xt.c}),i.d(e,"b2FixtureProxy",function(){return Xt.d}),i.d(e,"b2Fixture",function(){return Xt.b}),i.d(e,"b2BodyType",function(){return Jt}),i.d(e,"b2BodyDef",function(){return Zt}),i.d(e,"b2Body",function(){return Yt}),i.d(e,"b2World",function(){return Ii}),i.d(e,"b2DestructionListener",function(){return qe}),i.d(e,"b2ContactFilter",function(){return je}),i.d(e,"b2ContactImpulse",function(){return Ne}),i.d(e,"b2ContactListener",function(){return Oe}),i.d(e,"b2QueryCallback",function(){return ze}),i.d(e,"b2RayCastCallback",function(){return Ue}),i.d(e,"b2Island",function(){return ni}),i.d(e,"b2Profile",function(){return We}),i.d(e,"b2TimeStep",function(){return He}),i.d(e,"b2Position",function(){return Xe}),i.d(e,"b2Velocity",function(){return Ze}),i.d(e,"b2SolverData",function(){return Ye}),i.d(e,"b2ContactManager",function(){return Je}),i.d(e,"b2MixFriction",function(){return Ve}),i.d(e,"b2MixRestitution",function(){return Me}),i.d(e,"b2ContactEdge",function(){return ke}),i.d(e,"b2Contact",function(){return Ie}),i.d(e,"b2ContactRegister",function(){return Ee}),i.d(e,"b2ContactFactory",function(){return Fe}),i.d(e,"b2VelocityConstraintPoint",function(){return Qe}),i.d(e,"b2ContactVelocityConstraint",function(){return Ke}),i.d(e,"b2ContactPositionConstraint",function(){return ti}),i.d(e,"b2ContactSolverDef",function(){return ei}),i.d(e,"b2PositionSolverManifold",function(){return ii}),i.d(e,"b2ContactSolver",function(){return si}),i.d(e,"b2CircleContact",function(){return Pe}),i.d(e,"b2PolygonContact",function(){return $e}),i.d(e,"b2PolygonAndCircleContact",function(){return De}),i.d(e,"b2EdgeAndCircleContact",function(){return Te}),i.d(e,"b2EdgeAndPolygonContact",function(){return Ge}),i.d(e,"b2ChainAndCircleContact",function(){return Le}),i.d(e,"b2ChainAndPolygonContact",function(){return Re}),i.d(e,"b2JointType",function(){return Wt}),i.d(e,"b2LimitState",function(){return Ht}),i.d(e,"b2Jacobian",function(){return Qt}),i.d(e,"b2JointEdge",function(){return Kt}),i.d(e,"b2JointDef",function(){return te}),i.d(e,"b2Joint",function(){return ee}),i.d(e,"b2JointFactory",function(){return Be}),i.d(e,"b2AreaJointDef",function(){return ne}),i.d(e,"b2AreaJoint",function(){return oe}),i.d(e,"b2DistanceJointDef",function(){return ie}),i.d(e,"b2DistanceJoint",function(){return se}),i.d(e,"b2FrictionJointDef",function(){return re}),i.d(e,"b2FrictionJoint",function(){return ae}),i.d(e,"b2GearJointDef",function(){return le}),i.d(e,"b2GearJoint",function(){return he}),i.d(e,"b2MotorJointDef",function(){return ce}),i.d(e,"b2MotorJoint",function(){return _e}),i.d(e,"b2MouseJointDef",function(){return ue}),i.d(e,"b2MouseJoint",function(){return me}),i.d(e,"b2PrismaticJointDef",function(){return de}),i.d(e,"b2PrismaticJoint",function(){return pe}),i.d(e,"b2_minPulleyLength",function(){return 2}),i.d(e,"b2PulleyJointDef",function(){return fe}),i.d(e,"b2PulleyJoint",function(){return ye}),i.d(e,"b2RevoluteJointDef",function(){return ge}),i.d(e,"b2RevoluteJoint",function(){return ve}),i.d(e,"b2RopeJointDef",function(){return xe}),i.d(e,"b2RopeJoint",function(){return be}),i.d(e,"b2WeldJointDef",function(){return Ae}),i.d(e,"b2WeldJoint",function(){return we}),i.d(e,"b2WheelJointDef",function(){return Se}),i.d(e,"b2WheelJoint",function(){return Ce}),i.d(e,"b2ParticleFlag",function(){return oi}),i.d(e,"b2ParticleDef",function(){return ai}),i.d(e,"b2CalculateParticleIterations",function(){return li}),i.d(e,"b2ParticleHandle",function(){return hi}),i.d(e,"b2ParticleGroupFlag",function(){return ri}),i.d(e,"b2ParticleGroupDef",function(){return ci}),i.d(e,"b2ParticleGroup",function(){return _i}),i.d(e,"b2GrowableBuffer",function(){return Ai}),i.d(e,"b2FixtureParticleQueryCallback",function(){return wi}),i.d(e,"b2ParticleContact",function(){return Si}),i.d(e,"b2ParticleBodyContact",function(){return Ci}),i.d(e,"b2ParticlePair",function(){return Bi}),i.d(e,"b2ParticleTriad",function(){return Vi}),i.d(e,"b2ParticleSystemDef",function(){return Mi}),i.d(e,"b2ParticleSystem",function(){return ki}),i.d(e,"b2RopeDef",function(){return Pi}),i.d(e,"b2Rope",function(){return $i})},function(t,e,i){"use strict";var s=i(356),n=i(333);i(359),i(332);class o{constructor(t){this.id=t,this.footholds=[],this.bound=new n.Rectangle,this.loop=!1}init(t,e,i){let n,o,l,h;n=t.x1,o=t.y1,l=t.x2,h=t.y2;for(let i=t,s=0;null!=i;i=e[i.next],++s)if(n=Math.min(n,i.x1,i.x2),o=Math.min(o,i.y1,i.y2),l=Math.max(l,i.x1,i.x2),h=Math.max(h,i.y1,i.y2),this.footholds.push(i),i.next==t.id){this.loop=!0;break}if(this.bound.parse(n,o,l,h),this.FootholdType=i,i==r)this.footholds.forEach((t,e)=>{t.init(this,e)});else if(i==a){let t=this.bound.center,e=new s.b2Transform;e.SetPositionXY(t.x,t.y),this.footholds.forEach((t,i)=>{t.init(this,i,e)})}}getFootholdFromContact(t){return this.footholds[t]}}class r{constructor(t,e,i,s){this._raw=t,this.layer=0|i,this.group=0|s,this.id=e,this.prev=t.prev?t.prev-1:null,this.next=t.next?t.next-1:null,this.chain=null,this.childIndex=null,this.body=null,this.m_angle=0,this.m_length=0,this.next_a=void 0,this.next_a_deg=void 0,this.$showDebugInfo=!1}getFootholdFromContact(){return this}init(t,e,i){let s,n,o,r;this.chain=t,this.childIndex=e,s=this.x1/$gv.CANVAS_SCALE,n=this.y1/$gv.CANVAS_SCALE;const a=(o=this.x2/$gv.CANVAS_SCALE)-s,l=(r=this.y2/$gv.CANVAS_SCALE)-n;0==l?(this.m_angle=a<0?Math.PI:0,this.m_length=a):0==a?(this.m_angle=l<0?.5*-Math.PI:.5*Math.PI,this.m_length=l):(this.m_angle=Math.atan2(l,a),this.m_length=Math.sqrt(l**2+a**2))}GetVertex1(){return new s.b2Vec2(this.x1/$gv.CANVAS_SCALE,this.y1/$gv.CANVAS_SCALE)}GetVertex2(){return new s.b2Vec2(this.x2/$gv.CANVAS_SCALE,this.y2/$gv.CANVAS_SCALE)}GetWorldCenter(){return this.body.GetWorldCenter()}GetLocalPoint(t,e){return this.body.GetLocalPoint(t,e)}GetLinearVelocityFromWorldPoint(t,e){return this.body.GetLinearVelocityFromWorldPoint(t,e)}GetLocalVector(t,e){return this.body.GetLocalVector(t,e)}get next_fh(){return this.body.m_world.ground.footholds[this.next]}get prev_fh(){return this.body.m_world.ground.footholds[this.prev]}get x1(){return this._raw.x1}get y1(){return this._raw.y1}get x2(){return this._raw.x2}get y2(){return this._raw.y2}get is_empty(){return this.is_first&&this.is_last}get is_first(){return 0==this._raw.prev}get is_last(){return 0==this._raw.next}get is_wall(){return this.x1==this.x2}get _is_horizontal_floor(){return this.y1==this.y2}_drawLine(t){t.beginPath(),t.moveTo(this.x1,this.y1),t.lineTo(this.x2,this.y2),t.stroke()}_drawLineV01(t){this.m_hasVertex0&&(t.beginPath(),t.moveTo(this.x0,this.y0),t.lineTo(this.x1,this.y1),t.stroke())}_drawLineV23(t){this.m_hasVertex3&&(t.beginPath(),t.moveTo(this.x2,this.y2),t.lineTo(this.x3,this.y3),t.stroke())}$_text_pos(t,e,i,s){return{x:(i+t)/2,y:Math.max(s,e)}}$drawDebugInfo(t){const e=t.ctx,i=this,s=`[${i.id}](${i.x1}, ${i.y1})[${i.group}]{${i._raw.piece}}∠${i.next_a_deg}`,n=e.textAlign,o=e.textBaseline,r=this.$_text_pos(i.x1,i.y1,i.x2,i.y2);e.textAlign="center",e.textBaseline="top",e.lineWidth=5,e.strokeStyle="#000",i._drawLine(e),e.lineWidth=2.5,e.strokeStyle="#FF00FF",i._drawLine(e),e.lineWidth=2.5,e.strokeStyle="#000",e.strokeText(s,r.x,r.y),e.fillStyle="#FFF",e.fillText(s,r.x,r.y),e.textAlign=n,e.textBaseline=o}$drawDebugInfo2(t,e){const i=t.ctx,s=this,n=`${s.prev}<${s.id}>${s.next} C{${s.chain.id}} (${s.x1}, ${s.y1})(${s.x2}, ${s.y2}) L[${s.layer}] G[${s.group}] P{${s._raw.piece}}∠${s.next_a_deg}`;let o=i.textAlign,r=i.textBaseline;const a=this.$_text_pos(s.x1,s.y1,s.x2,s.y2);i.textAlign="center",i.textBaseline="top",i.lineWidth=5,i.strokeStyle="#000",s._drawLine(i),i.lineWidth=2.5,i.strokeStyle=e||"#FF00FF",s._drawLine(i),i.lineWidth=2.5,i.strokeStyle="#000",i.strokeText(n,a.x,a.y),i.fillStyle="#FFF",i.fillText(n,a.x,a.y),i.textAlign=o,i.textBaseline=r}}class a extends r{constructor(t,e,i,n){super(t,e,i,n),this.m_xf=new s.b2Transform}init(t,e,i){super.init(t,e,i),s.b2Vec2.AddVV(this.GetVertex1(),this.GetVertex2(),this.m_xf.p),s.b2Vec2.MulVS(this.m_xf.p,.5,this.m_xf.p),this.m_xf.SetRotationAngle(this.m_angle),s.b2Transform.MulTXX(this.m_xf,i,this.m_xf)}GetWorldCenter(){const t=new s.b2Transform;return s.b2Transform.MulXX(this.m_xf,this.body.m_xf,t),t.p}GetLocalPoint(t,e){const i=new s.b2Transform;return s.b2Transform.MulXX(this.m_xf,this.body.m_xf,i),s.b2Transform.MulTXV(i,t,e)}GetLinearVelocityFromWorldPoint(t,e){const i=this.body;return s.b2Vec2.AddVCrossSV(i.m_linearVelocity,i.m_angularVelocity,s.b2Vec2.SubVV(t,this.GetWorldCenter(),s.b2Vec2.s_t0),e)}GetLocalVector(t,e){const i=new s.b2Transform;return s.b2Transform.MulXX(this.m_xf,this.body.m_xf,i),s.b2Rot.MulTRV(i.q,t,e)}}i(354);var l=i(357);i.d(e,"a",function(){return c});const h=r;window.CREATE_SOLID_FOOTHOLD=!1,window.CREATE_SOLID_AND_EDGE_FOOTHOLD=!1,window.USE_GHOST_VERTEX=!0,window.FOOTHOLD_IS_BULLET=!0;class c{constructor(){this.bodies=null,this.footholds=null,this.rectChains=null,this.init()}init(){this.footholds=[],this.bodies=[]}load(t,e){if(!("foothold"in t))return;for(let e in t.foothold){let i=t.foothold[e];for(let t in i){let s=i[t];for(let i in s){const n=i-1;let o=new h(s[i],n,e,t);this.footholds[n]=o}}}let i=[],s=0,n=this.rectChains=[];for(let t=0;t<this.footholds.length;++t){const l=this.footholds[t];if(null==l.chain){let t;for(let e=l;null!=e;e=this.footholds[e.prev])if(null!=e.prev&&e.prev==l.id){t=e;break}t||(t=l);let c=new o(s);c.init(t,this.footholds,h),h==r?window.CREATE_SOLID_AND_EDGE_FOOTHOLD?(this._create_foothold(e,c,!1),this._create_foothold(e,c,!0)):this._create_foothold(e,c,window.CREATE_SOLID_FOOTHOLD):h==a&&this._create_chain(e,c),i.push(c),n[s]=c.bound,s++}}}_create_chain(t,e){let i,n;{let n=new s.b2BodyDef;const o=e.bound.center;n.type=s.b2BodyType.b2_kinematicBody,n.position.Set(o.x/$gv.CANVAS_SCALE,o.y/$gv.CANVAS_SCALE),n.angle=0,n.gravityScale=0,n.linearDamping=1,n.bullet=!0,n.userData=this,(i=t.CreateBody(n)).$type="ground",this.bodies.push(i)}{n=new s.b2ChainShape;let t=[i.GetLocalPoint(e.footholds[0].GetVertex1(),new s.b2Vec2)];for(let n=0;n<e.footholds.length;++n){const o=e.footholds[n];t.push(i.GetLocalPoint(o.GetVertex2(),new s.b2Vec2)),o.body=i,o._chain=e}e.loop?n.CreateLoop(t):n.CreateChain(t)}{let t=new s.b2FixtureDef;t.shape=n,t.density=1,t.filter.Copy(l.FilterHelper.get("foothold")),t.friction=1,t.restitution=0,t.userData=e;let o=i.CreateFixture(t);o.endContact=this.endContact_bodyBase_oneway,o.preSolve=this.preSolveGround_bodyBase_oneway}}_create_foothold(t,e,i){let n,o=new s.b2BodyDef,r=new s.b2FixtureDef;n=i?new s.b2PolygonShape:new s.b2EdgeShape,o.type=s.b2BodyType.b2_kinematicBody,o.linearDamping=1,o.gravityScale=0,o.userData=this,o.bullet=window.FOOTHOLD_IS_BULLET,r.shape=n,r.density=1,r.filter.Copy(l.FilterHelper.get("foothold")),r.friction=1,r.restitution=0;for(let t=0;t<e.footholds.length;++t){const i=e.footholds[t];let n,o,r,l;n=i.x1/$gv.CANVAS_SCALE,o=i.y1/$gv.CANVAS_SCALE,r=i.x2/$gv.CANVAS_SCALE,l=i.y2/$gv.CANVAS_SCALE,a.call(this,i);const h=this.footholds[i.next];if(h){let t,e,a,c;t=h.x1/$gv.CANVAS_SCALE,e=h.y1/$gv.CANVAS_SCALE,a=h.x2/$gv.CANVAS_SCALE,c=h.y2/$gv.CANVAS_SCALE;let _=new s.b2Vec2(n-r,o-l),u=new s.b2Vec2(a-t,c-e),m=Math.atan2(s.b2Vec2.CrossVV(_,u),s.b2Vec2.DotVV(_,u));i.next_a=m,i.next_a_deg=Math.abs(Math.trunc(180*m/Math.PI))%180}}function a(e){s.b2Vec2.AddVV(e.GetVertex1(),e.GetVertex2(),o.position),s.b2Vec2.MulVS(o.position,.5,o.position);let a=.5*e.m_length;o.angle=e.m_angle;let l=t.CreateBody(o);if(l.$type="ground",i)n.SetAsBox(a,s.b2_polygonRadius);else if(n.m_vertex1.Set(-a,0),n.m_vertex2.Set(a,0),window.USE_GHOST_VERTEX){if(null!=e.prev){const t=this.footholds[e.prev];n.m_hasVertex0=!0,n.m_vertex0.Copy(t.GetVertex2())}if(null!=e.next){const t=this.footholds[e.next];n.m_hasVertex3=!0,n.m_vertex3.Copy(t.GetVertex1())}}r.userData=e;let h=l.CreateFixture(r);h.endContact=this.endContact_bodyBase_oneway,h.preSolve=this.preSolveGround_bodyBase_oneway,e.body=l,this.bodies.push(l)}}_compute_left_right_border(){let t=null,e=null;for(let i=0;i<this.footholds.length;++i){let s,n,o=this.footholds[i];o.x1<o.x2?(s=o.x1,n=o.x2):(s=o.x2,n=o.x1),(null==t||s<t)&&(t=s),(null==e||n>e)&&(e=n)}return{left:t,right:e}}beginContact_bodyBase_oneway(t,e,i,n,o){let r,a;i.$type;const l=i.GetBody(),h=this.getFootholdFromContact(n),c=i.GetUserData();if(!c||!c.body||"player"!=c.body.$type)return;if(c.state.ladder)return void t.SetEnabled(!1);const _=c.$foothold,u=c.foot_walk.GetWorldCenter();if(h.is_wall){t.SetFriction(0);const e=c.prev_$fh;if((!_||_.chain!=h.chain)&&e&&e.chain!=h.chain&&e.layer!=h.layer)return void t.SetEnabled(!1)}if(c.state.dropDown&&null!=c.leave_$fh){if(c.leave_$fh==_&&_!=h)return void t.SetEnabled(!1);if("pl_ft_walk"!=l.$type||c.leave_$fh.id==h.id||c.leave_$fh.chain.id==h.chain.id||null!=c.leave_$fh.prev&&c.leave_$fh.prev==h.id||null!=c.leave_$fh.next&&c.leave_$fh.next==h.id)return void t.SetEnabled(!1);{const e=c.foot_walk.GetWorldCenter();r=t.GetManifold().pointCount,a=new s.b2WorldManifold,t.GetWorldManifold(a);for(let t=0;t<r;++t){a.points[t].y>e.y&&(c.leave_$fh=null,c.state.dropDown=!1)}}}else c.state.dropDown=!1;if(c.leave_$fh&&c.leave_$fh==h)return void t.SetEnabled(!1);if(_&&(h.is_wall||h==c._foothold&&(h.y1<_.y1||h.y2<_.y2)||h!=c._foothold&&(h.y1>_.y1||h.y2>_.y2))&&_!=h&&(!c._$fallEdge||c._$fallEdge!=_)&&!(h.chain.id==_.chain.id||_.prev&&_.y1==h.y2||_.next&&_.y2==h.y1))return c.leave_$fh=h,void t.SetEnabled(!1);if(c._$fallEdge&&c._$fallEdge==h)return void t.SetEnabled(!1);const m=h.GetLocalPoint(u,new s.b2Vec2),d=s.b2_polygonRadius,p=c.chara_profile.foot_width;null==r&&(r=t.GetManifold().pointCount,a=new s.b2WorldManifold,t.GetWorldManifold(a));for(let t=0;t<r;++t){const e=a.points[t],i=h.GetLinearVelocityFromWorldPoint(e,new s.b2Vec2),n=l.GetLinearVelocityFromWorldPoint(e,new s.b2Vec2),o=new s.b2Vec2(n.x-i.x,n.y-i.y),r=h.GetLocalVector(o,new s.b2Vec2),y=h.GetLocalPoint(e,new s.b2Vec2);if(m.y<=-(p-d)||e.y>u.y&&y.y<=d)if(r.y>1){if(h.is_wall||c._which_foothold_contact(h,e))return void f(e)}else if(r.y>-1){if(h.is_wall||c._which_foothold_contact(h,e))return _&&(_.id,h.id),void f(e)}else if(h.is_wall){const t=u.y*$gv.CANVAS_SCALE;if(h.y2>=h.y1){if(t<=h.y1)return void f(e)}else if(t<=h.y2)return void f(e)}}function f(e){if(null==h.prev&&e.x*$gv.CANVAS_SCALE<h.x1||null==h.next&&e.x*$gv.CANVAS_SCALE>h.x2)return c.state.jump=!0,c._$fallEdge=h,c._foothold=null,c._foot_at=null,c.$foothold=null,void t.SetEnabled(!1)}t.SetEnabled(!1)}endContact_bodyBase_oneway(t,e,i,s,n){const o=i.GetUserData();if(!o)return;const r=this.getFootholdFromContact(s);if(o.prev_$fh=r,o._foot_contact_list.length&&o._foot_contact_list.forEach((t,e)=>{t.foothold==r&&o._foot_contact_list.splice(e,1)}),o._$fallEdge&&r==o._$fallEdge)o._$fallEdge=null;else if(o._foothold&&r==o._foothold)if(o._foot_contact_list.length){o.prev_$fh=o.$foothold;let t=o._foot_contact_list.pop();o.$foothold=t.foothold,o._foothold=t.foothold,o._foot_at=t.position,o._foothold_priority=t.priority}else o._foothold=null,o._foot_at=null;else if(o.$foothold&&r==o.$foothold)if(o._foot_contact_list.length){o.prev_$fh=o.$foothold;let t=o._foot_contact_list.pop();o.$foothold=t.foothold,o._foothold=t.foothold,o._foot_at=t.position,o._foothold_priority=t.priority}else o._foothold?(o.prev_$fh=o.$foothold,o.$foothold=o._foothold):(o.$foothold=null,o._foot_at=null);o.leave_$fh&&o.leave_$fh==r&&(o.leave_$fh=null)}preSolveGround_bodyBase_oneway(t,e,i,s,n,o){i.GetBody().GetUserData().beginContact_bodyBase_oneway.call(this,t,i,s,n,o)}unload(t){for(let e=0;e<this.bodies.length;++e)t.DestroyBody(this.bodies[e]);this.init()}addFoothold(t){this.footholds.push(new h(t))}$drawDebugInfo(t){if($gv.m_display_foothold){const e=t.ctx;e.lineJoin="round",e.lineCap="round";for(let e=0;e<this.footholds.length;++e){let i=this.footholds[e];null!=i&&(i.$showDebugInfo&&i.$drawDebugInfo(t))}}}$showDebugInfo(t,e,i,s){null==i&&(i=!0),null==s&&(s=!1);for(let n of this.footholds)n.layer==t&&n.group==e?n.$showDebugInfo=i:n.$showDebugInfo=s}$showDebugInfoByLayer(t,e,i){null==e&&(e=!0),null==i&&(i=!1);for(let s of this.footholds)s.layer==t?s.$showDebugInfo=e:s.$showDebugInfo=i}$hideAllDebugInfo(){for(let t of this.footholds)t.$showDebugInfo=!1}}c.Foothold=h},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(333);class n{constructor(){this.delay=0,this.move=null,this.action=0,this.frame=0}_load(t,e,i){this._raw=t,this.delay=t.delay,t.move?this.move=new s.Vec2(t.move.x,t.move.y):this.move=new s.Vec2(0,0),this.action=t.action||e,this.frame=t.frame||i}}class o{constructor(t){this.frames=null,this._action=null,this.time=0,this.frame=0,this.delay=0,this.loop=!1,this._is_end=!1}_load(t){this._action=t,this.frames=o.Adef[t]}reload(t){this.reset(),this._load(t)}reset(){this.time=0,this.frame=0,this._is_end=!1}update(t,e){if(!this.frames)return;const i=this.fdat;let s=0;i&&(this.time=this.time+t,i.delay<0&&(i.delay=-i.delay),i.delay>0?(s=i.delay,this.delay=0):(s=-i.delay,this.delay=s),this.time>s&&(this.frame=++this.frame,this.time=0),i.move?(e.tx=-i.move.x*e.front,e.ty=i.move.y):(e.tx=0,e.ty=0),this.isEnd()&&(e.tx=0,e.ty=0),e._ride_action||(e._action=i.action),e._action_frame=i.frame,this.frames&&null!=this.fdat?this.loop||(this._is_end=!1):this._is_end=!0,this.frames.length<=1&&(this._is_end=!0))}isEnd(){return this._is_end}getTotalTime(){return this.frames.reduce((t,e)=>t+e.delay,0)}get fdat(){return this.frames[this.frame]}static async Init(){let t=await $get.data(o._base_path),e=Object.assign({},t);delete e.info;for(let t in e){let i=e[t];e[t]=Object.values(i).map((e,i)=>{let s=new n;return s._load(e,t,i),s})}o.Adef=e,window.CharacterActionAnimationDefinition=e}static get _base_path(){return"/Character/00002000"}}o.Adef=null},function(t,e,i){"use strict";i.d(e,"a",function(){return m}),i.d(e,"b",function(){return d});var s=i(353),n=(i(349),i(383));let o={};window.$loadedItem=o;const r=[void 0,0,1,3,2,4];class a{constructor(t,e){this._raw=null,this.id=null,Object.defineProperties(this,{_raw:{value:e},id:{value:t}})}getSlot(){return r[this.id[1]]}}class l extends a{}class h extends a{}class c extends a{}class _ extends a{}class u extends a{getSlot(){return 7==this.id?r[this.id[0]]:r[this.id[1]]}}async function m(t,...e){if(7==t.length&&5==t[0])throw new Error("未完成 pet");let i,n,r=t[1];switch(r){case"0":if(!$gv.m_editor_mode)throw new Error("$gv.m_editor_mode: %o"+$gv.m_editor_mode);case"1":i=l;break;case"2":console.error("未完成 ItemConsume"),i=h;break;case"3":i=_;break;case"4":console.error("未完成 ItemEtc"),i=c;break;case"5":console.error("未完成 ItemCash"),i=u;break;default:throw new Error("?? typeId: "+r)}try{n=await s.c.getItem(t)}catch(t){throw t}if(!n)return console.warn("item not exist: "+t),null;o[t]=n;let a=new i(t,n);return e&&e.length&&Object.assign(a,...e),a}class d extends n.a{constructor(t,e,i,s){super(),this.SN=e,this.slot=t,this.amount=s,this.data=i}assign(t,e,i,s){this.SN=e,this.slot=t,this.amount=s,this.data=i}_clear(){this.data=null,this.amount=0}isEmpty(){return!this.data&&!this.amount}getData(){return this.data}setData(t){this.data=t}static parse(t){if(t.__proto__==String.prototype){let e=new d,i=JSON.parse(t);return Object.assign(e,i),e}throw new TypeError}}},function(t,e){class i{constructor(){this.hp=8855,this.mp=5246,this.mhp=28855,this.mmp=25246,this.exp=55,this.str=123,this.luk=4,this.dex=999,this.int=4}}Symbol("job");const s=Symbol("onJobChange");class n{constructor(){this.id=void 0,this.equips_code=null}}t.exports={CharacterStat:class extends i{constructor(t){super(),this._$sceneChara=t,this.level=150,this.critRate=50,this.critDamage=80}get job(){return this[symbolStatJob]}set job(t){this[symbolStatJob]=t,this[s],_onJobChange&&_onJobChange()}onJobChange(t){this[s]=t}_getTotalAttack(){return 100}getCurrentMaxBaseDamage(){return 1.3*(4*this.dex+this.str)*(this._getTotalAttack()/100)}getCurrentMinBaseDamage(){return 1.3*(this.dex+this.str)*(this._getTotalAttack()/100)}getCritRate(){return this.critRate}getCritDamage(){return this.critDamage}getHpPercentS(){return(100*this.hp/this.mhp).toFixed(0)}getMpPercentS(){return(100*this.mp/this.mmp).toFixed(0)}getExpPercentS(){return(100*this.exp/this.getNextExp()).toFixed(2)}getNextExp(){return 100}},$RemotePlayerData:n,$PlayerData:class extends n{constructor(){super(),this.stat=void 0}getRemoteData(){return{id:this.id,mapId:this.mapId,equips_code:this.equips_code}}}}},function(t,e){window.DownloadData=function(){let t=document.createElement("a");return document.body.appendChild(t),t.style="display: none",t.target="_blank",function(e,i,s){let n=new Blob([e],{type:i||"octet/stream"}),o=window.URL.createObjectURL(n);s&&""!=s?(t.href=o,t.download=s,t.click()):window.open(o,"_blank"),window.URL.revokeObjectURL(o)}}(),window.SelectText=function(t){var e,i;document.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(t),e.select()):window.getSelection&&(i=window.getSelection(),(e=document.createRange()).selectNodeContents(t),i.removeAllRanges(),i.addRange(e))},window.copyToClipboard=function(t){var e=$("<input>");$("body").append(e),e.val(t).select(),document.execCommand("copy"),e.remove()}},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var s=i(369),n=i(364);const o=new class{constructor(){this.layers=[],this.rendering_option=new n.a}addLayerBack(t){for(let e=0;e<t;++e)this.layers.push(new s.a)}update(t){for(let e of this.layers)e.update(t)}renderLayer(t,e){this.layers[e].render(t,this.rendering_option)}_renderAll(t){for(let e of this.layers)e.render(t,this.rendering_option)}};window.$sceneRenderer=o},function(t,e,i){"use strict";function s(){$gv.mouse_move=0,$gv.mouse_x=0,$gv.mouse_y=0,$gv.mouse_dl=0,$gv.mouse_ul=0,$gv.mouse_dm=0,$gv.mouse_um=0,$gv.mouse_dr=0,$gv.mouse_ur=0}var n={props:{handle:{type:String,default:"header",description:"class only"},zIndex:{type:Number,default:0},position:{default:function(){return{x:0,y:0}},required:!1}},data:function(){return{mouse_x0:0,mouse_y0:0,origin_x:0,origin_y:0,old_width:0,old_height:0,handle_mousemove:null,handle_mouseup:null}},methods:{mousemove:function(){if(s(),1==event.which){let t=this.$el,e=event.clientX-this.mouse_x0,i=event.clientY-this.mouse_y0;t.style.left=Math.max(e,0)+"px",t.style.top=Math.max(i,0)+"px";let s=t.parentElement.offsetWidth,n=t.parentElement.offsetHeight,o=t.offsetLeft,r=t.offsetTop,a=this.old_width,l=this.old_height;o<0&&(t.style.left="0px"),o+a>=s&&(t.style.left=s-a+"px"),r>=0&&(l<n?r+l>=n&&(t.style.top=n-l+"px"):t.style.top=-this.origin_y+"px"),r<0&&(t.style.top="0px")}else this.mouseup()},mousedown:function(t){if(s(),!t.target.classList.contains(this.handle))return;t.target.focus();let e=this.get_relative_position();if(this.mouse_x0=t.clientX-e.x,this.mouse_y0=t.clientY-e.y,1==t.which){let t=this.$el;this.old_width=t.offsetWidth,this.old_height=t.offsetHeight}let i=this;this.handle_mousemove=function(t){i.mousemove(t)},this.handle_mouseup=function(){i.mouseup()},window.addEventListener("mousemove",i.handle_mousemove),window.addEventListener("mouseup",i.handle_mouseup)},mouseup:function(){s(),window.removeEventListener("mousemove",this.handle_mousemove),window.removeEventListener("mouseup",this.handle_mouseup),this.$emit("update:position",this.get_relative_position())},get_relative_position:function(){return{x:this.$el.offsetLeft,y:this.$el.offsetTop}}},mounted:function(){let t,e,i=this.$el;if(t=this.position.x,e=this.position.y,this.position.x||this.position.y)this.$el.style.left=t+"px",this.$el.style.top=e+"px",this.origin_x=t,this.origin_y=e;else{let t=function(t){let e,i,s=t.style.left,n=t.style.top;return t.style.left="0px",e=t.offsetLeft,t.style.left=s,t.style.top="0px",i=t.offsetTop,t.style.top=n,{x:e,y:i}}(i);this.origin_x=t.x,this.origin_y=t.y}},watch:{zIndex:function(t){this.$el.style.zIndex=t},"position.x":function(t){this.$el.style.left=t+"px"},"position.y":function(t){this.$el.style.top=t+"px"}}},o=(i(420),i(352)),r=Object(o.a)(n,function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"ui-draggable",on:{mousedown:function(e){t.mousedown(e)}}},[t._t("default")],2)},[],!1,null,null,null);e.a=r.exports},function(t,e,i){"use strict";i(332);var s=i(349),n=i(334),o=(i(355),i(372),i(336),i(354),i(366),i(359),i(333),i(356)),r=i(363),a=i(357);class l{constructor(t,e,i){t&&e&&i||alert("new PBullet(owner, skill)"),this.owner=t,this.body=null,this.skill=e,this.bulletRenderer=i,this.bulletMoveFunc=null,this.front=1}_create(t){const e=this.owner.body.GetWorld();let i=new o.b2BodyDef,s=new o.b2FixtureDef,n=new o.b2PolygonShape;const r=.5*this.bulletRenderer.textures[0]._raw.__w/$gv.CANVAS_SCALE,l=.5*this.bulletRenderer.textures[0]._raw.__h/$gv.CANVAS_SCALE;let{x:c,y:_}=this.owner.body.GetWorldCenter();const u=this.owner.state.front;i.type=o.b2BodyType.b2_kinematicBody,u>0?i.position.Set(c+r,_):u<0?i.position.Set(c-r,_):i.position.Set(c,_),i.angle=0,i.gravityScale=0,i.allowSleep=!1,i.bullet=!0,i.fixedRotation=!0,i.userData=this,this.body=e.CreateBody(i),n.SetAsBox(r,l),s.shape=n,s.filter.Copy(a.FilterHelper.get("bullet")),s.userData=this;let m=this.body.CreateFixture(s);return t?Object.keys(o.FixtureContactListener.prototype).forEach(e=>m[e]=t[e]):m.preSolve=h,this}getPosition(){return this.body.GetPosition()}launch(t,e,i){t?(this.bulletMoveFunc=t,this.body.addStep(t.Step.bind(t,this)),this.body.addAfterStep(t.AfterStep.bind(t,this))):this.body.m_linearVelocity.Set(e,i)}destroy(){this.body&&(this.body.m_world.DestroyBody(this.body),this.body=null)}}function h(t,e,i,s){const n=s.m_userData;if(!n)return;const o=n.chara;if(!o)return;const r=i.m_userData;r.owner!=n&&(r.skill.addAttack(o),t.SetEnabled(!1),r.bulletRenderer.destroy(),r.destroy())}i.d(e,"a",function(){return u}),i.d(e,"b",function(){return y});class c extends n.Animation{constructor(t,e){super(t,e),this.x=0,this.y=0,this.targetRenderer=null,this.$physics=null,this.is_loop=!1,this.opacity=1}load(t){if(!this._raw)throw new Error("Not implement. skill data is loaded");Array.isArray(this._raw[0])?this.textures=this._raw[t]:this.textures=this._raw}destroy(){super.destroy(),this.$physics=null}update(t){this.$physics?this.update_p(t):this.targetRenderer&&this.update_r(t)}render(t){this.$physics?this.render_p(t):this.targetRenderer&&this.render_r(t)}update_p(t){super.update(t)}render_p(t){const e=this.$physics.getPosition(),i=this.$physics.front,s=e.x*$gv.CANVAS_SCALE,n=e.y*$gv.CANVAS_SCALE;this.x=s,this.y=n,t.globalAlpha=this.opacity,this.draw(t,s,n,0,i>0)}update_r(t){t*=this.targetRenderer.getSpeed(),super.update(t)}render_r(t){this.x=this.targetRenderer.x+this.targetRenderer.tx,this.y=this.targetRenderer.y+this.targetRenderer.ty,t.globalAlpha=this.opacity,this.draw(t,this.x,this.y,0,this.targetRenderer.front>0)}}class _ extends c{constructor(t,e){super(t,e)}}class u{constructor(){}static AddEffect(t){t.update(0),u._effects.push(t)}static Update(t){const e=u._effects;u._effects=e.filter(function(e){return e.isEnd()||e.update(t),!e.isEnd()||(e.destroy(),!1)})}static Render(t){t.pushGlobalAlpha();const e=u._effects;for(let i=0;i<e.length;++i)e[i].render(t);t.popGlobalAlpha()}}u._effects=[],window.$EffectManager=u;class m{constructor(){this.data=null,this.url=null,this.skillId=null,this.actType=0,this._owner=null,this._crr=null,this._actani=null,this.type=0,this._$is_end=!1,this.is_launch=!1,this.state=null}_init(){this._applyDefaultAction()}get is_end(){return this._$is_end}set is_end(t){this._$is_end=t,t&&(this.owner.$physics.state.invokeSkill=!1)}get owner(){return this._owner}set owner(t){t&&(this._owner=t,this._crr=t.renderer,this._crr&&(this._actani=this._crr.actani,this._actani))}get _owner_player(){return this._owner}set _owner_player(t){this.owner=t}_applyAction(t){if(this._actani&&this.data){this.data.action;this._actani.reload(t),this._actani.loop=!1,this.owner.$physics.state.invokeSkill=!0}}_applyDefaultAction(){const t=this.data.action;this._applyAction(t[this.actType])}async _load(t){const e=/^(\d+)\d{4}$/.exec(t)[1],i=`${this.constructor._base_path}/${e}/skill/${t}`,s=await $get.data(i);s?(this.data=s,this.url=i,this.skillId=t,this.type=this.data.info&&this.data.info.type||0,this.__proto__=this._decide_type().prototype,this._loadTexture(s),this._init()):alert("SkillAnimationBase")}_assign(t,e){this.data=t.data,this.url=t.url,this.skillId=t.skillId,this.type=t.type,this.__proto__=this._decide_type().prototype,this._init()}_loadTexture(){for(let e of this._effect_names){let i=this.data[e];i&&(this.data[e]=t(i,[this.url,e].join("/")))}function t(t){return"0"in t[0]?function(t){let e=[];for(let i=0;i in t;++i){let n=t[i];e[i]=[];for(let t=0;t in n;++t){let o=n[t],r=new s.a(o);e[i][t]=r}e[i].action=n.action}return e}(t):function(t){let e=[];for(let i=0;i in t;++i){let n=t[i],o=new s.a(n);e[i]=o}return e.action=t.action,e}(t)}}reset(){this._actani.reset(),this.is_launch=!1}control(t,e,i){}update(t){this.$promise||(this.is_launch=!0,this.is_end=!0,console.warn("Skill not implement: "+this.skillId))}_default_update(t){if(this._actani){if(this._actani.delay)return;this.is_launch||(this._addEffect(),this.is_launch=!0),this._actani.isEnd()&&(this.is_end=!0)}else this.is_launch=!0,this.is_end=!0}isEnd(){return this.is_end}addAttack(t){this._owner;let e=new r.b;e.setTargetObject(t),e.allDamage.length=this.data.common.attackCount,this.attackInfo.allAttack.push(e)}createBullet(t){let e,i;return(e=this._addEffect(t)).is_loop=!0,(i=new l(this.owner.$physics,this,e))._create(),i.launch(null,this.owner.$physics.state.front*(32|window.$BULLET_SPEED),0),e.$physics=i,i}_addDefaultEffect(t){this._applyDefaultAction(),this._addEffect("effect",t)}_addEffect(t="effect",e){let i=this.data[t].action;i&&this._applyAction(i);try{const i=this.actType;let s=new c(this.data[t],[this.url,t].join("/"));return e||(s.targetRenderer=this._crr),s.load(i),u.AddEffect(s),s}catch(t){}}_addHitEffect(t,e,i,s){let n=new _;n.target=i,n.load(this.url+"/hit/"+s,this.data.hit,s),u.AddEffect(n)}_decide_type(){const t=this.data.info;switch(this.type){case 1:case 2:if(t.rapidAttack)return p;break;case 40:if(t.casterMove&&t.avaliableInJumpingState)return f}return d}get _effect_names(){return["effect","hit"]}static get _base_path(){return"/Skill"}}class d extends m{constructor(){throw super(),new TypeError("constructor")}_init(){this._applyDefaultAction()}update(t){this._default_update(t)}}class p extends m{constructor(){throw super(),new TypeError("constructor")}_init(){this._applyDefaultAction(),this.state="prepare",this._state_func=this._prepare,this.current_effect=this._addEffect(this.state),this.time=0,this.tick=0,this.fadeTotalTime=this._actani.getTotalTime(),this._crr.fixed_speed=!0}_prepare(){this.current_effect.opacity=this.time/this.fadeTotalTime,this.current_effect.opacity>1&&(this.current_effect.opacity=1),this._actani.isEnd()&&(this.current_effect.opacity=0,this.current_effect.destroy(),this.state="keydown",this._state_func=this._keydown,this.current_effect=this._addEffect(this.state),this._actani.loop=!0,this.current_effect.is_loop=!0,this.time=0)}_keydown(){this._actani.isEnd()&&(this.time=0)}_keydownend(){this.current_effect.opacity=1-this.time/this.fadeTotalTime,this.current_effect.opacity<0&&(this.current_effect.opacity=0),this._actani.isEnd()&&(this.current_effect.opacity=0,this.current_effect.destroy(),this._crr.fixed_speed=!1,this.is_launch=!0,this.is_end=!0)}control(t,e,i){switch(this.state){case"prepare":case"keydown":e&&!i||(this.current_effect.opacity=0,this.current_effect.destroy(),this.state="keydownend",this._state_func=this._keydownend,this.current_effect=this._addEffect(this.state),this.fadeTotalTime=this._actani.getTotalTime(),this._actani.loop=!1,this.time=0)}}update(t){t*=this._crr.getSpeed(),this.time+=t,++this.tick,this._state_func(),this.tick%(3|window.$FIRE_BULLET_T)==(2|window.$FIRE_BULLET_T2)&&"keydownend"!=this.state&&this.createBullet("ball")}get _effect_names(){return["prepare","keydown","keydownend","hit","ball"]}}class f extends m{constructor(){throw super(),new TypeError("constructor")}_init(){this.jump_max_count=window.jump_max_count||2}jump2(){const t=this._crr,e=this._owner_player.$physics.foot_walk,i=this._owner_player.$physics.getPosition();console.log("pos: { x: %o, y: %o }",i.x,i.y),e.ConstantVelocityWorldCenter2((window.$NJmpX||40)*t.front,window.$NJmpY||0),this._addDefaultEffect()}control(t,e,i){if(!this._owner)return;const s=this._owner.$physics;if(0==s.state.jump_count){if(1!=e||!s.state.jump)return t.jump=t.jump?Math.max(e,t.jump):e,!1;this.jump2(),s.state.jump_count+=2}else s.state.jump&&1==e&&s.state.jump_count<this.jump_max_count&&(this.jump2(),s.state.jump_count+=1)}update(t){const e=this._owner.$physics;e.state.jump_count>1?(e.$foothold||this._actani.isEnd())&&(this.is_end=!0):e.$foothold?//!$physics._isCanJump()
this._actani.isEnd()?this.is_end=!0:$gv.m_editor_mode&&(this.is_end=!0):this._actani.isEnd()&&(this.is_end=!0)}}class y extends m{constructor(){super(),this.attackInfo=new r.a}load(t,e){if(this.owner=e,!t)throw new Error("1 argument required");if(String(t).length<=4)throw new Error("skill ID format");this.attackInfo.skill=t;let i=y.__loaded_skill[t];if(!i||!i.data){let i=this._load(t,e);return this.$promise=i,y.__loaded_skill[t]=this,i.then(()=>{delete this.$promise}),i}this._assign(i)}}y.__loaded_skill={},window.$SceneSkill=y},function(t,e,i){"use strict";var s=i(356);i(333);function n(t,e,i){return i?t|e:t&~e}class o extends s.b2Draw{constructor(t){super(...arguments),this.m_ctx=t,this.axis_length=1,this.viewRotation=new s.b2Rot(Object(s.b2DegToRad)(0)),this.viewZoom=1,this.flag_drawShape=!0,this.flag_drawJoint=!0,this.flag_drawAabb=!1,this.flag_drawCenterOfMass=!0,this.flag_drawController=!0,this.flag_drawParticle=!0}get canvasScale(){return $gv.CANVAS_SCALE}set canvasScale(t){$gv.CANVAS_SCALE=t}get viewRect(){return $gv.m_viewRect}set flag_drawAll(t){this.m_drawFlags=t?s.b2DrawFlags.e_all:s.b2DrawFlags.e_none}set flag_drawShape(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_shapeBit,t)}set flag_drawJoint(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_jointBit,t)}set flag_drawAabb(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_aabbBit,t)}set flag_drawPair(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_pairBit,t)}set flag_drawCenterOfMass(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_centerOfMassBit,t)}set flag_drawParticle(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_particleBit,t)}set flag_drawController(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_controllerBit,t)}get flag_drawAll(){this.m_drawFlags}get flag_drawShape(){return this.m_drawFlags&s.b2DrawFlags.e_shapeBit}get flag_drawJoint(){return this.m_drawFlags&s.b2DrawFlags.e_jointBit}get flag_drawAabb(){return this.m_drawFlags&s.b2DrawFlags.e_aabbBit}get flag_drawPair(){return this.m_drawFlags&s.b2DrawFlags.e_pairBit}get flag_drawCenterOfMass(){return this.m_drawFlags&s.b2DrawFlags.e_centerOfMassBit}get flag_drawParticle(){return this.m_drawFlags&s.b2DrawFlags.e_particleBit}get flag_drawController(){return this.m_drawFlags&s.b2DrawFlags.e_controllerBit}get flagNames(){return["flag_drawAll","flag_drawShape","flag_drawJoint","flag_drawAabb","flag_drawPair","flag_drawCenterOfMass","flag_drawParticle","flag_drawController"]}}o.prototype.PushTransform=function(t){let e=this.m_ctx;e.save(),e.transform(t.q.c,t.q.s,-t.q.s,t.q.c,t.p.x,t.p.y)},o.prototype.PopTransform=function(t){this.m_ctx.restore()},o.prototype.DrawPolygon=function(t,e,i){if(!e)return;let s=this.m_ctx;s.beginPath(),s.moveTo(t[0].x,t[0].y);for(let i=1;i<e;i++)s.lineTo(t[i].x,t[i].y);s.closePath(),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;let s=this.m_ctx;s.beginPath(),s.moveTo(t[0].x,t[0].y);for(let i=1;i<e;i++)s.lineTo(t[i].x,t[i].y);s.closePath(),s.fillStyle=i.MakeStyleString(.5),s.fill(),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawCircle=function(t,e,i){if(!e)return;let n=this.m_ctx;n.beginPath(),n.arc(t.x,t.y,e,0,2*s.b2_pi,!0),n.strokeStyle=i.MakeStyleString(1),n.stroke()},o.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;let o=this.m_ctx,r=t.x,a=t.y;o.beginPath(),o.arc(r,a,e,0,2*s.b2_pi,!0),o.moveTo(r,a),o.lineTo(r+i.x*e,a+i.y*e),o.fillStyle=n.MakeStyleString(.5),o.fill(),o.strokeStyle=n.MakeStyleString(1),o.stroke()},o.prototype.DrawParticles=function(t,e,i,s){const n=this.m_ctx;if(n)if(null!==i)for(let o=0;o<s;++o){let s=t[o],r=i[o];n.fillStyle=r.MakeStyleString(.5),n.fillRect(s.x-e,s.y-e,2*e,2*e)}else{n.fillStyle="rgba(255,255,255,0.5)",n.beginPath();for(let i=0;i<s;++i){let s=t[i];n.rect(s.x-e,s.y-e,2*e,2*e)}n.fill()}},o.prototype.DrawSegment=function(t,e,i){let s=this.m_ctx;s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawTransform=function(t){if(0==this.axis_length)return;let e=this.canvasScale;if(!this.viewRect.collide4f2(t.p.x*e,t.p.y*e,this.axis_length*e,this.axis_length*e))return;let i=this.m_ctx;this.PushTransform(t),i.beginPath(),i.moveTo(0,0),i.lineTo(this.axis_length,0),i.strokeStyle=s.b2Color.RED.MakeStyleString(1),i.stroke(),i.beginPath(),i.moveTo(0,0),i.lineTo(0,this.axis_length),i.strokeStyle=s.b2Color.GREEN.MakeStyleString(1),i.stroke(),this.PopTransform(t)},o.prototype.DrawPoint=function(t,e,i){let s=this.m_ctx;s.fillStyle=i.MakeStyleString(),e/=this.viewZoom;let n=(e/=this.canvasScale)/2;s.fillRect(t.x-n,t.y-n,e,e)},o.prototype.DrawString=function(t,e,i,s){let n=this.m_ctx;const r=n.font;let a=Array.prototype.slice.call(arguments),l=goog.string.format.apply(null,a.slice(2));n.save(),n.setTransform(1,0,0,1,0,0),n.font="18pt helvetica";let h=o.prototype.DrawString.s_color;n.fillStyle=h.MakeStyleString(),n.fillText(l,t,e),n.restore(),n.font=r},o.prototype.DrawString.s_color=new s.b2Color(.9,.6,.6),o.prototype.DrawStringWorld=function(t,e,i,n){let r=o.prototype.DrawStringWorld.s_p.Set(t,e),a=this.viewCenter;s.b2Vec2.SubVV(r,a,r);let l=this.viewRotation;s.b2Rot.MulTRV(l,r,r);let h=this.viewZoom;s.b2Vec2.MulSV(h,r,r);let c=this.canvasScale;s.b2Vec2.MulSV(c,r,r),r.y*=-1;let _=o.prototype.DrawStringWorld.s_cc.Set(.5*this.m_canvas.width,.5*this.m_canvas.height);s.b2Vec2.AddVV(r,_,r);let u=this.m_ctx;const m=u.font;let d=Array.prototype.slice.call(arguments),p=goog.string.format.apply(null,d.slice(2));u.save(),u.setTransform(1,0,0,1,0,0),u.font="18pt helvetica";let f=o.prototype.DrawStringWorld.s_color;u.fillStyle=f.MakeStyleString(),u.fillText(p,r.x,r.y),u.restore(),u.font=m},o.prototype.DrawStringWorld.s_p=new s.b2Vec2,o.prototype.DrawStringWorld.s_cc=new s.b2Vec2,o.prototype.DrawStringWorld.s_color=new s.b2Color(.5,.9,.5),o.prototype.DrawAABB=function(t,e){let i=this.m_ctx;i.strokeStyle=e.MakeStyleString();let s=t.lowerBound.x,n=t.lowerBound.y,o=t.upperBound.x-t.lowerBound.x,r=t.upperBound.y-t.lowerBound.y;i.strokeRect(s,n,o,r)},e.a=o},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(356),n=(i(359),i(354),i(357));class o{constructor(t){this.l=null,this.uf=null,this.x=null,this.y1=null,this.y2=null,this.page=null,this.piece=null,Object.assign(this,t)}isLadder(){return!!this.l}}class r extends o{constructor(t){super(t),this.body=null}calcHeight(){return this.y2-this.y1}calcHalfHeight(){return.5*(this.y2-this.y1)}calcWidth(){return this.isLadder()?16:4}calcHalfWidth(){return.5*(this.isLadder()?16:4)}calcLength(){return(this.y2-this.y1)/$gv.CANVAS_SCALE}_create(t){let e=new s.b2BodyDef,i=new s.b2FixtureDef,o=new s.b2PolygonShape;const r=this.x/$gv.CANVAS_SCALE,a=this.y1/$gv.CANVAS_SCALE,l=this.y2/$gv.CANVAS_SCALE,h=this.calcHalfWidth()/$gv.CANVAS_SCALE,c=.5*(l-a);e.type=s.b2BodyType.b2_kinematicBody,e.position.Set(r,a),e.angle=0,e.gravityScale=0,e.fixedRotation=!0,e.userData=this,this.body=t.CreateBody(e),o.SetAsBox(h,c+.5,new s.b2Vec2(0,c-.5),0),i.shape=o,i.filter.Copy(n.FilterHelper.get("ladder")),i.isSensor=!0,i.userData=this;let _=this.body.CreateFixture(i);return _.beginContact=this.beginContact.bind(this),_.endContact=this.endContact.bind(this),this}beginContact(t,e,i){const s=i.m_userData;s&&(s.state.ladder||s.contactLadder(this))}endContact(t,e,i){const s=i.m_userData;s&&s.leaveLadder()}}class a{static load(t,e){let i=[];for(let s in t.ladderRope){let n=t.ladderRope[s],o=parseInt(s,10)-1;o>=0&&Number.isSafeInteger(o);let a=new r(n);a._$index=s,a._create(e),i.push(a)}return i}}},function(t,e,i){"use strict";i.d(e,"a",function(){return c});var s=i(354);i(334);window.$MobAction_Move_Priority=2,window.$MobAction_Jump_Priority=1;class n{constructor(t){this._name=null,this._ani=t}get priority(){return 1}init(){}isValid(t){return!0}update(t){}isEnd(t){return!!this._ani.isEnd()&&(this.onEnd(t),!0)}onEnd(t){}}class o extends n{constructor(t){super(t),this._name="stand"}update(t){t.ikey.left=0,t.ikey.right=0}}class r extends n{constructor(t){super(t),this._name="move",this.front=0}get priority(){return window.$MobAction_Move_Priority}isValid(t){return!t.action._name.startsWith("attack")}}class a extends r{constructor(t){super(t),this.front=-1}isValid(t){return super.isValid(t)&&(!t.state.jump||this.front==t.state.front)}update(t){t.ikey.left=1,t.ikey.right=0}}class l extends r{constructor(t){super(t),this.front=1}isValid(t){return super.isValid(t)&&(!t.state.jump||this.front==t.state.front)}update(t){t.ikey.left=0,t.ikey.right=1}}class h extends n{constructor(t){super(t),this._name="jump"}get priority(){return window.$MobAction_Jump_Priority}init(){}isValid(t){let e=t.action._name;switch(t.action._name){case"attack":return!1;default:if(e.startsWith("attack"))return!1}return!t.state.jump}update(t){t.state.walk&&(t.state.front<0?t.ikey.left=1:t.state.front>0&&(t.ikey.right=1)),t.ikey.jump=1}onEnd(t){t.ikey.jump=0}}class c extends s.b{constructor(t){super(),this.attackTarget=!0,this._enable_rx=!1,this.chara=t,t&&(t.renderer.isFlyMob()?this.setMovementSpeed(this._info.flySpeed):this.setMovementSpeed(this._info.speed)),this.activityRegion=null,this.$debugControl=!1,this.ikey={},this.actions=[],this.action=null}_registerAction(t){this.actions.push(t)}_loadAction(t,e){e=e||{stand:[o],move:[a,l],jump:[h]},Object.keys(t).forEach(i=>{if(t[i]&&e[i]){const s=e[i];for(let e of s){let s=new e(t[i]),n=s.priority;0;for(let t=0;t<n;++t)this._registerAction(s)}}else console.warn("未完成 MobActionController: "+i)}),this.action=this.actions[0],this.action}get _info(){return this.chara.renderer._raw.info}get hasBodyDamage(){return 0!=this._info.bodyAttack&&1!=this._info.bodyAttack&&alert("bodyAttack:"+this._info.bodyAttack),0!=this._info.bodyAttack}get _speed(){return this._info.speed}get _pushed(){return this._info.pushed}get _fs(){return this._info.fs}get _category(){return this._info.category}get _body_category(){return"mob"}_create(t){super._create(t),this.setPosition(this.chara.x/$gv.CANVAS_SCALE,this.chara.y/$gv.CANVAS_SCALE,!0),this._appleMobCategory(this._category)}_appleMobCategory(t){switch(t){case 1:case 6:this.__setAsWalkOnlyMob();break;case 8:this.__setAsJumpDropMob();break;default:this.__setAsWalkOnlyMob()}this.chara.front=this.chara.spawn.f?1:-1}__setAsWalkOnlyMob(){const t=this.body.GetWorld().ground,e=this.chara.spawn.fh;if(e>=0){let i=t.footholds[e];this.activityRegion=t.rectChains[i.chain]}}__setAsJumpDropMob(){}isCanMove(){return!(this._info.ignoreMoveImpact||0==this._walker_omega||this._info.noFlip)}control(){if(this.isCanMove()){switch(this._category){case 1:case 6:this._control_basic(!1);break;case 8:this._control_basic(!0);break;default:this._control_basic(!1)}super.control(this.ikey)}}_control_basic(t){if(this.action){if(this.action.isEnd(this)){let t=this.actions.filter(t=>t.isValid(this)),e=Math.trunc(100*Math.random())%t.length;this.action=t[e],this.action,this.action.init()}this.action.update(this)}}stop(){const t={};this.ikey=t,super.control(t)}Step(){let t,e,i;if(super.Step(),this.control(),this.attackTarget&&this.activityRegion?(t=this.activityRegion.left,e=this.activityRegion.right,i=!0):this._enable_rx||(t=this.chara.spawn.rx0,e=this.chara.spawn.rx1,i=!1),i){const i=this.body.GetPosition(),s=i.x*$gv.CANVAS_SCALE,n=(i.y,$gv.CANVAS_SCALE,s-e);if(t-s>0){const e=this.foot_walk.GetPosition();this.body.SetPositionXY(t/$gv.CANVAS_SCALE,i.y),this.foot_walk.SetPositionXY(t/$gv.CANVAS_SCALE,e.y)}else if(n>0){const t=this.foot_walk.GetPosition();this.body.SetPositionXY(e/$gv.CANVAS_SCALE,i.y),this.foot_walk.SetPositionXY(e/$gv.CANVAS_SCALE,t.y),this.attackTarget||(this.state.front*=-1)}}}AfterStep(){super.AfterStep();const t=this.getPosition(),e=t.x*$gv.CANVAS_SCALE,i=t.y*$gv.CANVAS_SCALE;this.chara.x=e,this.chara.y=i,this._info.noFlip||(this.chara.front=-this.state.front)}}},function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return r}),i.d(e,"c",function(){return a});i(333);var s=i(334),n=i(355);class o{constructor(){this.createDelay=0,this.collisionDelay=0,this.duration=0,this.moveSpeed=0,this.angle=0,this.flip=!1,this.x=0,this.y=0,this._speed_x=0,this._speed_y=0}}class r extends n.a{constructor(t,e){super(),t=Object.assign(new this._BallDefinition,t),this.createDelay=t.createDelay,this.collisionDelay=t.collisionDelay,this.duration=t.duration,this.moveSpeed=t.moveSpeed,this.angle=t.angle*Math.PI/180,this.x=t.x,this.y=t.y,this.moveSpeed?(this._speed_x=Math.cos(this.angle+Math.PI)*this.moveSpeed,this._speed_y=Math.sin(this.angle+Math.PI)*this.moveSpeed):(this._speed_x=0,this._speed_y=0),this.state=this.E_BEFORE_CREATE}get E_BEFORE_CREATE(){return 0}get E_CREATED(){return 1}get E_BEGIN_COLLISION(){return 2}get E_ENG_COLLISION(){return 3}create(t){this.state=this.E_CREATED,this.collisionDelay>0&&(this.enablePhysics=!1)}begin_collision(){this.enablePhysics=!0,this.state=this.E_BEGIN_COLLISION}end_collision(){this.enablePhysics=!1,this.state=this.E_ENG_COLLISION}update(t,e){this.state==this.E_BEFORE_CREATE?(this.createDelay-=t,this.createDelay<=0&&this.create()):(this.state==this.E_CREATED?(this.collisionDelay-=t,this.collisionDelay<=0&&this.begin_collision()):this.state==this.E_BEGIN_COLLISION&&this.duration>0&&(this.duration-=t,this.duration&&this.end_collision()),window.$stop||(this.x+=this._speed_x*t/1e3,this.y+=this._speed_y*t/1e3),this.renderer.update(t))}render(t){if(this.state!=this.E_BEFORE_CREATE){const e=this.flip;this.renderer.draw(t,this.x,this.y,this.angle,e)}}get _BallDefinition(){throw new Error("Not implement")}}class a{constructor(t,e){this._raw=t,this._url=e,this.level=null,this.animations={}}async load(t){this.level=t,this._raw||this._url||(this._url=[this._base_path,t].join("/"),this._raw=await $get.data(this._url));for(let t of this._anima_name_list){let e=new s.Animation(this._raw[t],[this._url,t].join("/"));e.is_loop=!0,e.load(),this.animations[t]=e}}invoke(){throw new Error("Not implement")}get _anima_name_list(){throw new Error("Not implement")}get _base_path(){throw new Error("Not implement")}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});class s{}},function(t,e,i){var s=i(421);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("009f3464",s,!0,{})},function(t,e,i){var s=i(423);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("37287e38",s,!0,{})},function(t,e,i){var s=i(431);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("c9ae3650",s,!0,{})},function(t,e,i){var s=i(433);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("38713d8e",s,!0,{})},function(t,e,i){var s=i(435);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("7b9bb866",s,!0,{})},function(t,e,i){var s=i(437);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("3c9f94b0",s,!0,{})},function(t,e,i){var s=i(439);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("62027292",s,!0,{})},function(t,e,i){var s=i(441);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("d3a7d8a4",s,!0,{})},function(t,e,i){var s=i(443);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("166ef477",s,!0,{})},function(t,e,i){var s=i(445);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("da2cfcee",s,!0,{})},function(t,e,i){var s=i(447);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("613b7622",s,!0,{})},function(t,e,i){var s=i(449);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("4c329b45",s,!0,{})},function(t,e,i){var s=i(451);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("3c49887c",s,!0,{})},function(t,e,i){"use strict";let s=[];var n={props:{width:{default:""},height:{default:""},position:{required:!1}},data:function(){return{content_style:{},header_style:{},minimum:!1,zIndex:1}},computed:{},methods:{updateDialogPosition:function(t){this.$emit("update:position",t)},onCollapsed:function(){let t=this.$children[0].$children;for(let e=0;e<t.length;++e)t[e].$emit("onCollapsed")},compute_width:function(){return this.width},compute_height:function(){return this.height},show:function(){let t=$(this.$el);t.show.apply(t,arguments)},hide:function(){let t=$(this.$el);t.hide.apply(t,arguments)},requireOrder:function(){const t=s.indexOf(this);if(t>=0){s.splice(t,1)[0],s.push(this);for(let t=0;t<s.length;++t)s[t].__set_z_index(t+1)}},__set_z_index:function(t){this.zIndex=t},reset_content_style:function(){let t={};if(this.$refs.content){let e=this.compute_width();if(this.minimum)t.height="0px",t["min-height"]="0px",t["max-height"]="0px";else{let e=this.compute_height();t["max-height"]="number"==typeof e?parseFloat(e)+"px":e}t.width="number"==typeof e?parseFloat(e)+"px":e,t["max-width"]="number"==typeof e?parseFloat(e)+"px":e}this.content_style=t,this.header_style.width=this.content_style.width,this.header_style["max-width"]=this.content_style["max-width"]}},watch:{width:function(){this.reset_content_style()},height:function(){this.reset_content_style()},minimum:function(){this.reset_content_style()}},mounted:function(){s.push(this),this.zIndex=s.length,this.reset_content_style()},updated:function(){},components:{"ui-draggable":i(377).a}},o=(i(422),i(352)),r=Object(o.a)(n,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("ui-draggable",{staticClass:"ui-dialog",attrs:{zIndex:t.zIndex,position:t.position},on:{"update:position":t.updateDialogPosition}},[i("div",{ref:"header",staticClass:"header",style:t.header_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._t("header"),t._v(" "),i("div",{staticClass:"header-buttons"},[t.minimum?i("button",{staticClass:"header-button",on:{click:function(e){t.minimum=!1}}},[i("span",{staticClass:"ui-icon ui-icon-plus"})]):i("button",{staticClass:"header-button",on:{click:function(e){t.minimum=!0,t.onCollapsed()}}},[i("span",{staticClass:"ui-icon ui-icon-minus"})])])],2),t._v(" "),i("div",{ref:"content",staticClass:"content",style:t.content_style,on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._t("content"),t._v(" "),t._t("default")],2),t._v(" "),t.minimum?t._e():i("div",{ref:"footer",staticClass:"footer",on:{mousedown:function(e){return"button"in e||!t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])?"button"in e&&0!==e.button?null:void t.requireOrder(e):null}}},[t._t("footer")],2)])},[],!1,null,null,null);e.a=r.exports},function(t,e,i){"use strict";i.r(e),i.d(e,"FairyDustBall",function(){return a}),i.d(e,"FairyDustBallHit",function(){return l}),i.d(e,"FairyDust",function(){return h}),i.d(e,"_FairyDust",function(){return c});var s=i(333),n=(i(334),i(355)),o=i(382);class r extends o.b{constructor(){super(),this.scale=0}}class a extends o.a{constructor(t,e){super(t,e),this.x=1e3,this.y=-80,this.renderer=e["ball"+t.scale].clone()}create(t){this.$physics={state:{}},super.create(t)}get _BallDefinition(){return r}}class l extends n.a{constructor(t,e){super()}}class h extends o.c{constructor(t,e){super(t,e)}invoke(){const t=this._raw.s,e=this._raw.s2,i=this._raw.v,n=this._raw.v2,o=this._raw.w,r=this._raw.w2,l=this._raw.u;let h=this._raw.x;for(let c=0,_=s.Randomizer.randInt(o,o+r);c<_;c++){h+=s.Randomizer.nextInt(h);let o=new a({scale:s.Randomizer.nextInt(3),createDelay:l,moveSpeed:i+s.Randomizer.nextInt(n),angle:h+s.Randomizer.randInt(t,e)},this.animations);$gv.SceneObjectMgr.addToScene(10,o)}}get _anima_name_list(){return["ball0","ball1","ball2"]}get _base_path(){return"/Skill/MobSkill/238/level"}}class c extends h{constructor(t,e){super(t,e)}load(t){this._raw||this._url||(this._raw=window.MOB_SKILL_RAW[238].level[t],this._url=[this._base_path,t].join("/")),super.load(t)}}},function(t,e,i){let s=i(414),n=i(415),o=i(416),r=Object.assign({},s,n,o);t.exports=r},function(t,e,i){"use strict";i.d(e,"a",function(){return m});i(332);var s=i(349),n=i(369),o=(i(364),i(363));const r={};class a{constructor(){for(let t=0;t<=9;++t)this[t]=null;this.addedCanvasH=0}async _load(t){const e=await $get.data(t);Object.keys(e).forEach(i=>{let n=new s.a(e[i]);n._url=[t,i].join("/"),this[i]=n}),this.addedCanvasH=0|e.addedCanvasH}}function l(t){return 3*t.width/4}function h(t,e,i){t.strokeStyle="#F00",t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+10),t.stroke(),t.strokeStyle="#0F0",t.beginPath(),t.moveTo(e,i),t.lineTo(e+10,i),t.stroke()}a.prototype.Miss=null,a.prototype.guard=null,a.prototype.shot=null,a.prototype.effect=null;class c{constructor(){this._url=null,this.style=null,this.skin=null,this.textures=[],this.rand_y=[0];for(let t=1,e=Math.random()>.5?-1:1;t<c.max_display_digit;++t)this.rand_y[t]=Math.random()*c.max_rand_y*e,e*=-1}_copy(t){this._url=t._url,this.skin=t.skin,this.style=t.style,this.textures=t.textures,this._$promise&&(this._$promise=t._$promise)}async _load(t,e){let i,s=[];i="default"==t?this._default_base_path+e:this._skin_base_path+[t,e].join("/"),r[t]||(r[t]={}),r[t][e]=this,this._url=i,this.skin=t,this.style=e;for(let t=0;t<=1;++t){const e=i+t;this.textures[t]=new a,s[t]=this.textures[t]._load(e)}return await Promise.all(s),this}async load(t,e){let i;return r[t]&&(i=r[t][e]),i?this._copy(t,i):(this._$promise=this._load(t,e),await this._$promise,delete this._$promise),this}draw(t,e,i,s,n){let o,r=e.toFixed(0),a=0;a+=-(o=this.textures[1][r[0]]).x,a+=l(o);for(let t=1;t<r.length-1;++t)a+=l(o=this.textures[0][r[t]]);{let t=s-a/2;(o=this.textures[1][r[0]]).draw2(t,n),t+=l(o);for(let e=1;e<r.length;++e)(o=this.textures[0][r[e]]).draw2(t,n+this.rand_y[e]),t+=l(o)}if(this._display_axis){const e=t.ctx;let i=s-a/2;o=this.textures[1][r[0]],h(e,i,n),i+=l(o);for(let t=1;t<r.length;++t)o=this.textures[0][r[t]],h(e,i,n+this.rand_y[t]),i+=l(o)}}get _default_base_path(){return"/Effect/BasicEff"}get _skin_base_path(){return"/Effect/BasicEff/damageSkin/"}}c.loaded_skin=r,c.max_display_digit=Math.trunc(Math.log10(Number.MAX_SAFE_INTEGER)+1),c.max_rand_y=5;class _ extends n.b{constructor(t,e,i,s,n,o){super(),this.x=s,this.y=n,this.vy=_.move_y/_.time_tt,this.delay=o,this.time=0,this.state=0,this.damagePair=i,this.renderer,this._load(t,e)}_load(t,e,i){let s;r[t]&&(s=r[t][e]),s?(this.renderer=s,this._$promise=this.renderer._$promise):(this.renderer=new c,this._$promise=this.renderer.load(t,e)),this._$promise&&(this.render=this.$noRender,this._$promise.then(()=>{delete this.render,delete this._$promise}).catch(()=>{if(delete this._$promise,console.error(`Can't load damageSkin[${t}][${e}]`),i)throw Error();console.log(`try load damageSkin["default"][${e}]`),this._load("default",e,1)}))}$noRender(){}destroy(){this.state=2}isEnd(){return this.state>=1&&this.time>1e3}update(t){this.time+=t,this.delay&&this.time>=this.delay?(this.time=0,this.delay=0):(this.y+=this.vy*t,0==this.state?(this.vy=this.vy*_.move_avy,this.time>_.time_d1&&(this.time=0,this.state=1)):1==this.state&&(this.vy=this.vy*_.move_avy2,this.time<_.time_d2?this.opacity=1-this.time/_.time_d2:this.opacity=0))}render(t,e){t.globalAlpha=this.opacity*opt.opacity,this.renderer.draw(t,this.damagePair.realDamage,this.damagePair.critical,this.x,this.y)}}_.time_d1=1e3,_.time_d2=1e3,_.time_tt=_.time_d1+_.time_d2,_.move_y=-300,_.move_avy=1.001,_.move_avy2=.99;class u extends _{update(t){}isEnd(){return this.is_end}}const m=new class extends n.a{_addTest(t=9876543210,e=!1,i=0,s=0,n=0,r=null,a="NoRed"){this.objects.push(new _(r,a,new o.c(t,e),i,s,n))}_addTest2(t=9876543210,e=!1,i=0,s=0,n=0,r=null,a="NoRed"){this.objects.push(new u(r,a,new o.c(t,e),i,s,n))}_addAttack(t,e,i){i.allAttack.forEach(i=>{let s=i.getTargetObject();if(s){const n=s.$physics.getPosition();let o,r;o=n.x*$gv.CANVAS_SCALE,r=n.y*$gv.CANVAS_SCALE-70,i.allDamage.forEach(i=>{this.addDamagePair(t,e,i,o,r)})}})}addDamagePair(t,e,i,s,n,o=0){this.objects.push(new _(t,e,i,s,n,o))}};window.$damageNumberLayer=m,window.$DamageNumber=_,window.$DamageNumberTest=u,window.$DamageNumberRenderer=c},,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e),i.d(e,"FlowerTrapBall",function(){return r}),i.d(e,"FlowerTrap",function(){return a});var s=i(333),n=(i(334),i(355),i(382));class o extends n.b{constructor(){super(),this.size=0}}class r extends n.a{constructor(t,e){super(t,e),this.renderer=e[t.size].clone()}create(t){this.$physics={state:{}},super.create(t)}get _BallDefinition(){return o}}class a extends n.c{constructor(t,e){super(t,e),this.patterns={}}_invoke(t,e,i,s){const n=this._raw["pattern"+t];for(let t=0;t in n;++t){const o=n[t];let a,l,h;a=e+(s?-o.pos.x:o.pos.x),l=i+o.pos.y,h=o.angle-90;let c=new r({x:a,y:l,angle:h,size:o.size,createDelay:o.createDelay,collisionDelay:o.collisionDelay,duration:o.duration},this.animations);$gv.SceneObjectMgr.addToScene(10,c)}}invoke(){this._invoke(s.Randomizer.nextInt(3),1e3,48,s.Randomizer.nextBoolean())}get _anima_name_list(){return["XL","L","M","S"]}get _base_path(){return"/Skill/MobSkill/238/level"}}},function(t,e,i){"use strict";i.r(e),i.d(e,"$RequestPacket_SelectChara",function(){return s}),i.d(e,"$ResponsePacket_SelectChara",function(){return n});i(374);class s{constructor(){this.charaId=void 0}}class n{constructor(){this.charaData=null,this.remoteCharacters=null}}},function(t,e,i){"use strict";i.r(e),i.d(e,"$Packet_CharacterChat",function(){return s});class s{constructor(){this.type=null,this.$style=null,this.text=null}}},function(t,e,i){"use strict";i.r(e),i.d(e,"$Packet_CharacterMove",function(){return n});var s=i(367);class n{constructor(){this.id=void 0,this.path=[],this.stamp=(new Date).getTime()}capture(t){const e=t.$physics,i=e.body;let n=new s.a;{const e=t.renderer;n.action=e.action,n.emotion=e.emotion}if(n.isAwake=i.IsAwake(),n.isAwake){let t=e.getPosition(),s=i.GetLinearVelocity();n.x=t.x,n.y=t.y,n.vx=s.x,n.vy=s.y,n.pState=e.state,n.elapsed=(new Date).getTime()-this.stamp}this.path.push(n)}}},,,function(t,e,i){var s=i(477);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("4e0037c4",s,!0,{})},function(t,e,i){"use strict";var s=i(384);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-draggable {\n\tposition: absolute;\n\tdisplay: inline-block;\n\tuser-select: none;\n}\n",""])},function(t,e,i){"use strict";var s=i(385);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-dialog {\n\tborder-radius: 4px;\n}\n.ui-dialog > * {\n\t/*padding: 0.5em 1em;*/\n\t/*display: inline-block;*/\n\t/*width: 100%;*/\n}\n.ui-dialog > .header {\n\t/*cursor: default;*/\n\tpadding: 0.25em 0.5em;\n\tuser-select: none;\n\tbackground: #e9e9e9;\n\tborder: 1px solid #dddddd;\n\t/*border-top-left-radius: 4px;*/\n\t/*border-top-right-radius: 4px;*/\n\ttext-align: left;\n\tbox-sizing: border-box;\n}\n.ui-dialog > .header .header-buttons {\n\tdisplay: inline;\n\tright: 0.5em;\n\tmargin-right: 1px;\n\tposition: absolute;\n}\n.ui-dialog > .header .header-buttons > * {\n\tpadding: 0;\n\tborder: none;\n\tbackground: transparent;\n}\n.ui-dialog > .header .header-buttons > .header-button {\n}\n.ui-dialog > .header .header-buttons > .header-button:hover {\n\tbackground: lightgray;\n}\n.ui-dialog > .header .header-buttons > .header-button:active {\n\tbackground: lightblue;\n}\n.ui-dialog > .content {\n\tposition: relative;\n\tbackground: white;\n\tborder-left: 1px solid #dddddd;\n\tborder-right: 1px solid #dddddd;\n\tmin-width: 16em;\n\tmin-height: 10em;\n\t/*width: auto;*/\n\t/*height: auto;*/\n\toverflow: auto;\n\tbox-sizing: border-box;\n}\n.ui-dialog > .footer {\n\tpadding: 0.1em 0.25em;\n\tuser-select: none;\n\tbackground: #e9e9e9;\n\tborder: 1px solid #dddddd;\n\t/*border-bottom-left-radius: 4px;*/\n\t/*border-bottom-right-radius: 4px;*/\n\tbox-sizing: border-box;\n}\n",""])},function(t,e,i){var s=i(479);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("21a09c83",s,!0,{})},function(t,e,i){var s=i(481);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("0a7abc9e",s,!0,{})},function(t,e,i){var s=i(483);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("ba39c17e",s,!0,{})},function(t,e,i){var s=i(486);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("c76fbb76",s,!0,{})},function(t,e,i){var s=i(488);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("50030122",s,!0,{})},function(t,e,i){var s=i(490);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("2a6bbb22",s,!0,{})},function(t,e,i){"use strict";var s=i(386);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},function(t,e,i){"use strict";var s=i(387);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\ndiv[data-v-550d0e17] {\n\tmargin: 0;\n\tpadding: 0;\n}\n.active[data-v-550d0e17] {\n\tbackground: linear-gradient(to bottom, #ffec64 5%, #ffab23 100%);\n\tbackground-color: #ffec64;\n}\n",""])},function(t,e,i){"use strict";var s=i(388);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.menu-frame {\n\tuser-select: none;\n\tposition: absolute;\n\toverflow: hidden;\n}\n.menu {\n\tlist-style: none;\n\tmargin: 0;\n\tpadding: 0em 0em;\n\tbackground: #f0f9ff;\n\tborder: 1px solid darkgray;\n\tbox-shadow: 0.2em 0.2em 0.2em darkgray;\n}\n.menu > *:not(hr) {\n\tdisplay: block;\n\tpadding: 0.25em 1em 0.25em 1em;\n\tbackground: #f0f9ff;\n\tcursor: pointer;\n}\n.menu > *.disable {\n\tcursor: not-allowed;\n\tcolor: darkgray;\n}\n.menu > *:not(.disable):not(hr):hover {\n\tbackground: linear-gradient(to bottom, #4096ee 0%,#4096ee 100%);\n\tbox-shadow: inset 0 0 1px #1e69de;\n}\n.menu > *:not(.disable):not(hr):active {\n\tbackground: linear-gradient(to bottom, #6db3f2 0%,#54a3ee 50%,#3690f0 51%,#1e69de 100%);\n\tbox-shadow: inset 0 0 1px #1e69de;\n}\n.menu > hr {\n\tmargin: 0.2em 0;\n}\n.menu-enter-active {\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\twidth: 100%;\n\theight: 5em;\n\ttransition: .3s;\n}\n.menu-enter {\n\topacity: 0;\n\theight: 0;\n\twidth: 0;\n}\n.menu-leave-active {\n\ttransition: .4s;\n}\n.menu-leave-to {\n\topacity: 0;\n}\n",""])},function(t,e,i){"use strict";var s=i(389);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,'\n.ui-button-group input[type="radio"] {\n\tdisplay: none;\n}\n.ui-button-group {\n\tdisplay: flex;\n}\n.ui-button-group button {\n\tflex: 1;\n\tpadding: 0;\n\toutline: none;\n}\n/*.ui-button-group button > * {\n\twidth: 100%;\n\theight: 100%;\n}*/\n',""])},function(t,e,i){"use strict";var s=i(390);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-equip-box .header {\n\ttext-align: left;\n}\n.ui-equip-box .header.btn-group, .ui-equip-box .header .pagination {\n\ttext-align: center;\n}\n.ui-equip-box .pagination {\n\theight: 2em;\n\toverflow: auto;\n\tfont-size: initial;\n}\n.ui-equip-box .item-list {\n\tlist-style: none;\n\tmargin: auto;\n\tpadding: 1px;\n}\n.ui-equip-box .item-list-sm {\n\tmargin: auto;\n\tpadding: 1px;\n\tline-height: 0;\n\ttext-align: center;\n}\n.ui-equip-box .item-detail {\n\twidth: 100%;\n\tborder-spacing: 1px;\n}\n.ui-equip-box .list-item, .ui-equip-box .list-item-sm {\n\tborder: 1px solid black;\n\tborder-bottom: none;\n\tbackground: linear-gradient(to bottom, rgba(240,249,255,0.9) 0%,rgba(203,235,255,0.9) 30%,rgba(201,234,255,0.9) 50%,rgba(203,235,255,0.9) 70%,rgba(203,235,255,0.9) 70%,rgba(203,235,255,0.9) 75%,rgba(240,249,255,0.9) 100%);\n}\n.ui-equip-box .list-item-sm {\n\tdisplay: inline-block;\n\tborder: none;\n\toutline: 1px solid black;\n\tbox-shadow: inset 1px 1px 0 lightblue;\n}\n.ui-equip-box .list-item:target, .ui-equip-box .list-item-sm:target {\n\tbox-shadow: inset 0 0 0 1px red;\n\toutline: 1px solid red;\n\tposition: relative;\n}\n.ui-equip-box .list-item:last-child {\n\tborder-bottom: 1px solid black;\n}\n.ui-equip-box .list-item:hover, .ui-equip-box .list-item-sm:hover {\n\tbackground: aliceblue;\n}\n.ui-equip-box .list-item:active, .ui-equip-box .list-item-sm:active {\n\tbackground: lightgray;\n}\n.ui-equip-box .item-name {\n\tuser-select: text;\n\twidth: 12em;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.ui-equip-box .list-item:target .item-name {\n\tcolor: red;\n\tfont-weight: bold;\n}\n.ui-equip-box .item-id {\n\tuser-select: text;\n}\n.ui-equip-box .item-icon-outer-frame {\n\tposition: relative;\n\twidth: 48px;\n\theight: 48px;\n\tuser-select: none;\n}\n.ui-equip-box .item-icon-frame > img, .ui-equip-box .item-icon-frame-sm > img {\n\tmax-width: 48px;\n\tmax-height: 48px;\n\tdisplay: block;\n\tmargin: auto;\n}\n.ui-equip-box .filters button:hover {\n\tborder: 1px solid blue;\n\tborder-radius: 3px;\n\tbackground: rgba(240, 249, 255, 0.9);\n}\n.ui-equip-box .filters button:hover, .face_color button:hover, .hair_color button:hover {\n\tfilter: contrast(150%) brightness(110%);\n}\n.ui-equip-box .filters button.active {\n\tborder-radius: 3px;\n\tbackground-color: hsl(203, 0%, 70%);\n}\n.ui-equip-box .filters button.active img {\n\tfilter: grayscale(100%) brightness(90%) contrast(150%);\n}\n.ui-equip-box .filters button.active:hover {\n\tborder: 1px solid blue;\n\tbackground: rgba(240, 249, 255, 0.9);\n}\n.ui-equip-box .filters button.active:hover {\n\tfilter: contrast(150%) grayscale(100%) brightness(110%);\n}\n.ui-equip-box .face_color, hair_color {\n\tborder: 1px solid transparent;\n\ttext-shadow: 0 0 5px white, 0 0 10px white, 0 0 1px black;\n}\n.ui-equip-box .face_color button.active, .hair_color button.active {\n\tborder: 1px solid white;\n\tbox-shadow: 0 0 0.5em 0 blue, 0 0 1em 0 yellow;\n\tcolor: white;\n\ttext-shadow: 0 0 0.1em black, 0 0 0.5em black;\n\tz-index: 1;\n}\n.ui-equip-box .button-area > * {\n\tpadding-top: 1px;\n}\n.ui-equip-box .button-area {\n\tuser-select: none;\n}\n.ui-equip-box .button-area button {\n\ttext-align: center;\n\tcursor: pointer;\n\tborder: 1px solid transparent;\n\ttext-shadow: 0 0 5px white, 0 0 10px white, 0 0 1px black;\n\tfont-family: 微軟正黑體;\n\tfont-weight: bold;\n\tfont-size: 1em;\n}\n.ui-equip-box .button-area button > img {\n\tdisplay: block;\n\tmargin: auto;\n}\n",""])},function(t,e,i){"use strict";var s=i(391);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\ndiv.frame[data-v-370f889e] {\n\tdisplay: inline-block;\n\tposition: relative;\n\twidth: 64px;\n\theight: 96px;\n\n\tuser-select: none;\n\tbackground-position: 0px 0px, 10px 10px;\n\tbackground-size: 20px 20px;\n\tbackground-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%, #eee 100%),linear-gradient(45deg, #eee 25%, white 25%, white 75%, #eee 75%, #eee 100%);\n}\ndiv.center[data-v-370f889e] {\n\tposition: absolute;\n\tleft: 32px;\n\ttop: 96px;\n}\nimg[data-v-370f889e] {\n\tposition: absolute;\n}\n",""])},function(t,e,i){"use strict";var s=i(392);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-character-frame {\n\tdisplay: inline-block;\n\tposition: relative;\n\twidth: 64px;\n\theight: 96px;\n\n\tuser-select: none;\n\tbackground-position: 0px 0px, 10px 10px;\n\tbackground-size: 20px 20px;\n\tbackground-image: linear-gradient(45deg, #eee 25%, transparent 25%, transparent 75%, #eee 75%, #eee 100%),linear-gradient(45deg, #eee 25%, white 25%, white 75%, #eee 75%, #eee 100%);\n}\n.ui-character-center {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(0,0,0,0.2);\n\toverflow: hidden;\n\ttext-align: center;\n}\n.ui-character-text {\n\ttext-align: center;\n\tposition: absolute;\n\ttop: calc(50% - 0.5em);\n\tfont-weight: bold;\n\tcolor: white;\n\ttext-shadow: 0 0 1px black, 0 0 2px black, 0 0 5px black;\n}\n",""])},function(t,e,i){"use strict";var s=i(393);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.UIEditCharacterAttribute td > *[data-v-10601658] {\n\twidth: 100%;\n}\n.btn[data-v-10601658] {\n\tmargin: auto;\n\tpadding: 0;\n\tuser-select: none;\n}\n.chara_ear[data-v-10601658] {\n\twidth: 100%;\n\tdisplay: block;\n}\n.equip-icon[data-v-10601658] {\n\tmargin: auto;\n\tmax-width: 32px;\n\tmax-height: 32px;\n\twidth: auto !important;\n\theight: auto !important;\n}\n",""])},function(t,e,i){"use strict";var s=i(394);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-life-list[data-v-ea11de16] {\r\n\tpadding: 0 1px;\n}\ntable[data-v-ea11de16] {\r\n    border-collapse: collapse;\r\n    border-spacing: 0;\n}\ntr.new-item[data-v-ea11de16] {\r\n\tbackground: lightgray;\n}\ntr.item[data-v-ea11de16]:hover {\r\n\tbackground: lightblue;\r\n\toutline: 1px auto rgb(77, 144, 254);\n}\n.button[data-v-ea11de16] {\r\n\twidth: 100%;\n}\n.input[data-v-ea11de16] {\r\n  width: 2.7em;\n}\n.input[type=text][data-v-ea11de16] {\r\n  width: 4em;\n}\n.input[type=number][data-v-ea11de16] {\r\n  width: 4em;\n}\n.input[type=checkbox][data-v-ea11de16] {\r\n  width: 1em;\n}\n.input-mobid[type=number][data-v-ea11de16] {\r\n  width: 5em;\n}\r\n\r\n",""])},function(t,e,i){"use strict";var s=i(395);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.sticky[data-v-6e4fb2d8] {\r\n\tposition: sticky;\r\n\tleft: 0;\r\n\ttop: 0;\n}\n.info[data-v-6e4fb2d8] {\r\n\tbackground: #f5f5f5;\n}\n.view[data-v-6e4fb2d8] {\r\n\tdisplay: flex;\n}\n.view > div[data-v-6e4fb2d8] {\r\n\tflex: 100;\n}\n.imgbox[data-v-6e4fb2d8] {\r\n\tflex: 80;\n}\n.table[data-v-6e4fb2d8] {\r\n\tborder-collapse: collapse;\r\n\tborder-spacing: 0;\n}\n.input[data-v-6e4fb2d8] {\r\n\twidth: 5em;\n}\n.input-xy[data-v-6e4fb2d8] {\r\n\twidth: 8em;\n}\n.input-xy > *[data-v-6e4fb2d8] {\r\n\twidth: 4em;\n}\n.img[data-v-6e4fb2d8] {\r\n\tmax-width: 25vh;\r\n\tmax-height: 25vh;\r\n\tborder-bottom: 1px solid red;\r\n\tborder-left: 1px solid green;\n}\n.text[data-v-6e4fb2d8] {\r\n\tuser-select: text;\n}\n.red-text[data-v-6e4fb2d8] {\r\n\tcolor: red;\n}\n.tb[data-v-6e4fb2d8], .tb td[data-v-6e4fb2d8] {\r\n\tborder: 1px solid black;\r\n\tborder-collapse: collapse;\r\n\tborder-spacing: 0;\r\n\tuser-select: text;\n}\r\n\r\n",""])},function(t,e,i){"use strict";var s=i(396);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.dialog-group[data-v-1e192451] {\n\tposition: fixed;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n.ui-dialog .ui-equip-box-dialog.ui-dialog-content[data-v-1e192451] {\n\tpadding: 0;\n\twidth: 100% !important;\n}\n\n/*li.active {\n\tbackground-color: lightcyan;\n}\n*/\n.ui-character-list .active[data-v-1e192451] {\n\tbackground: linear-gradient(to bottom, #ffec64 5%, #ffab23 100%);\n\tbackground-color: #ffec64;\n}\n.ui-character-list[data-v-1e192451] {\n\tlist-style: none;\n\tpadding: 0;\n}\n.ui-character-list > li[data-v-1e192451] {\n\twidth: 16em;\n}\n.ui-character-list table[data-v-1e192451] {\n\twidth: 100%;\n\t/*border-collapse: collapse;*/\n}\n.ui-character-list td[data-v-1e192451]:nth-child(1) {\n\t/*border: 1px solid black;*/\n\twidth: 20%;\n}\n.ui-character-list td[data-v-1e192451]:nth-child(2) {\n\t/*border: 1px solid black;*/\n\twidth: 50%;\n}\n\n/*\n.ui-character-list td:first-child {\n}\n*/\n\n/*.ui-character-list td:last-child {\n\tfloat: right;\n}*/\n.chara-ls-btn-group[data-v-1e192451] {\n\tdisplay: inline;\n\tfloat: right;\n}\n.chara-ls-btn[data-v-1e192451] {\n    display: inline-flex;\n\twidth: 20px;\n\theight: 20px;\n\tpadding: 0;\n}\n.chara-ls-btn > *[data-v-1e192451] {\n\tmargin: auto;\n\tpadding: 0;\n}\n.loading[data-v-1e192451] {\n\tposition: absolute;\n\ttop:0;\n\tleft:0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: rgba(100, 100, 100, 0.5);\n\ttext-shadow: 1px 1px 0 white, 0 0 1px white;\n\t\n\tdisplay:flex;\n\talign-items:center;\n\tjustify-content:center;\n}\n\n/*\n\thttp://www.oxxostudio.tw/articles/201408/sticky-ball.html\n*/\n",""])},function(t,e,i){var s=i(493);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,i(351).default)("49643529",s,!0,{})},,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";var s=i(419);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.c1[data-v-06654c7d] {\r\n\tbackground: rgba(255, 0, 0, 0.25);\n}\n.c2[data-v-06654c7d] {\r\n\tbackground: rgba(0, 255, 0, 0.25);\n}\n.c3[data-v-06654c7d] {\r\n\tbackground: rgba(0, 0, 255, 0.25);\n}\n.outline[data-v-06654c7d] {\r\n\toutline: auto blue;\n}\n.block[data-v-06654c7d] {\r\n\twidth: calc(16em * 1.2);\r\n\theight: calc(9em * 1.2);\n}\n.block-sm[data-v-06654c7d] {\r\n\twidth: calc(16em * 0.6);\r\n\theight: calc(9em * 0.6);\n}\n.center_text_hr[data-v-06654c7d] {\r\n\ttext-align: center;\n}\n.center_frame[data-v-06654c7d] {\r\n\tposition: relative;\r\n\twidth: 100%;\r\n\theight: 100%;\n}\n.center[data-v-06654c7d] {\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\ttransform: translate(-50%, -50%);\n}\n.center_frame_hr[data-v-06654c7d] {\r\n\tposition: relative;\r\n\twidth: 100%;\n}\n.center_hr[data-v-06654c7d] {\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttransform: translate(-50%, 0);\n}\n.text-fff-334[data-v-06654c7d] {\r\n\tfont-size: 13px;\r\n\tcolor: white;\r\n\ttext-shadow: 0 0 1px #334, -1px -1px #334, 1px -1px #334, -1px 1px #334, 1px 1px #334;\n}\n.table[data-v-06654c7d] {\r\n\tborder-collapse: collapse;\r\n\tborder-spacing: 0px;\r\n\tpadding: 0;\n}\n.table td[data-v-06654c7d] {\r\n\tpadding: 0;\n}\n.table.view[data-v-06654c7d] {\r\n\tline-height: 16px;\r\n\tborder-collapse: separate;\r\n\tborder-spacing: 1px;\r\n\tpadding: 1px;\n}\n.table.view td[data-v-06654c7d] {\r\n\tpadding: 1px;\n}\n.view-s[data-v-06654c7d] {\r\n\tposition: sticky;\r\n\ttop: 0px;\n}\n.chat-text[data-v-06654c7d] {\r\n\tline-height: initial;\r\n\tpadding-bottom: 0.2em;\r\n\tpadding-left: 4px;\r\n\theight: 1.2em;\r\n\tcolor: white;\r\n\tfont-family: monospace;\n}\r\n\r\n",""])},function(t,e,i){"use strict";var s=i(424);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.ui-dialog[data-v-66062b27] {\n\tborder: 0;\n\tborder-radius: 11px;\n\tbackground: transparent;\n}\n.header[data-v-66062b27] {\n\tpadding: 0;\n\tborder: 0;\n\tborder-radius: 11px;\n\tbackground: transparent;\n}\n.content[data-v-66062b27] {\n\tpadding: 0;\n\tborder: 0;\n\tbackground: transparent;\n}\n.footer[data-v-66062b27] {\n\tpadding: 0;\n\tborder: 0;\n\theight: 0;\n\tbackground: transparent;\n}\n",""])},function(t,e,i){"use strict";var s=i(425);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.wnd-item-sn {\n\tdisplay: none;\n\tposition: absolute;\n\tright: 0;\n\tbottom: 0;\n\tcolor: #133;\n}\n",""])},function(t,e,i){"use strict";var s=i(426);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.vscr-viewport[data-v-0eba351b] {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 24em;\n\theight: 20em;\n\toverflow: hidden;\n}\n.vscr-container[data-v-0eba351b] {\n\twidth: 100%;\n\theight: 100%;\n\toverflow-y: scroll;\n\tbox-sizing: content-box;\n\tpadding-right: 11px;\n\tposition: absolute;\n}\n.vscr-scrollbar[data-v-0eba351b] {\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\twidth: 11px;\n\theight: 100%;\n}\n.vscr-track[data-v-0eba351b] {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 12px;\n\twidth: 11px;\n\theight: calc(100% - 24px);\n}\n.vscr-thumb[data-v-0eba351b] {\n\toutline: none;\n\tborder: none;\n\tpadding: 0;\n\twidth: 11px;\n\theight: 26px;\n}\n.vscr-decrement[data-v-0eba351b] {\n\toutline: none;\n\tborder: none;\n\tpadding: 0;\n\tposition: absolute;\n\tleft: 0px !important;\n\ttop: 0px !important;\n\twidth: 11px;\n\theight: 12px;\n}\n.vscr-increment[data-v-0eba351b] {\n\toutline: none;\n\tborder: none;\n\tpadding: 0;\n\tposition: absolute;\n\tleft: 0px !important;\n\ttop: unset !important;\n\tbottom: 0px !important;\n\twidth: 11px;\n\theight: 12px;\n}\n",""])},function(t,e){},function(t,e,i){"use strict";var s=i(427);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.wnd-item-slot-num[data-v-05ec9993] {\n\tcolor: gray;\n}\n.slots-viewport[data-v-05ec9993] {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\toverflow: hidden;\n}\n.slots-container[data-v-05ec9993] {\n\twidth: 100%;\n\theight: 100%;\n\toverflow-y: scroll;\n\tbox-sizing: content-box;\n\tpadding-right: 11px;\n\tposition: absolute;\n}\n.slot-menu[data-v-05ec9993] {\n\twidth: 80px;\n\theight: 48px;\n}\n.Bt[data-v-05ec9993] {\n\toutline: none;\n\tborder: none;\n}\n.BtRebate[data-v-05ec9993] {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n\twidth: 61px;\n\theight: 16px;\n}\n.BtDelete[data-v-05ec9993] {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n\twidth: 61px;\n\theight: 16px;\n}\n",""])},function(t,e,i){"use strict";var s=i(428);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*.c1 {\n\tbackground: rgba(255,0,128,0.5);\n}\n.c2 {\n\tbackground: rgba(128,255,0,0.5);\n}\n.c3 {\n\tbackground: rgba(0,128,255,0.5);\n}*/\n#UIToolTip {\n\tdisplay: inline-block;\n\tz-index: 9999;\n}\n.UIToolTip {\n\tfont-family: PMingLiU !important;\n\tfont-size: 12px;\n\tcolor: #FFF;\n}\n.UIToolTip.frame {\n\tposition: relative;\n\twidth: 261px;\n\t/*height: 200px;*/\n\tdisplay: inline-block;\n}\n.UIToolTip.frame table, .UIToolTip.frame thead, .UIToolTip.frame tbody, .UIToolTip.frame tfoot, .UIToolTip.frame tr, .UIToolTip.frame td {\n\tborder-spacing: 0;\n\tborder-collapse: collapse;\n\tmargin: 0px;\n\tpadding: 0px;\n}\n.UIToolTip.border-head {\n\twidth: 261px;\n\theight: 13px;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame/top);\n}\n.UIToolTip.border-left {\n\twidth: 13px;\n\theight: 3px;\n\tbackground-repeat: repeat-y;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame2/w);\n}\n.UIToolTip.container {\n\twidth: 235px;\n\theight: auto;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame2/c);\n}\n.UIToolTip.border-right {\n\twidth: 13px;\n\theight: 3px;\n\tbackground-repeat: repeat-y;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame2/e);\n}\n.UIToolTip.border-foot {\n\twidth: 261px;\n\theight: 13px;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame/bottom);\n}\n.UIToolTip.Item-Frame-cover {\n\tposition: absolute;\n\ttop: 3px;\n\tleft: 3px;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: url(/images/UI/UIToolTip/Item/Frame/cover);\n\tbackground-repeat: no-repeat;\n}\n.UIToolTip.content {\n\tposition: relative;\n\tleft: 0;\n\ttop: 0;\n\twidth: 261px;\n\t/*height: 658px;*/\n\t/*background: url(/bg_UIToolTip.png);*/\n}\n.UIToolTip.title {\n\tfont-weight: bold;\n\tfont-size: 15px;\n\tletter-spacing: -0px;\n}\n.UIToolTip.dotline {\n\tbackground: url(/images/UI/UIToolTip/Item/Frame/dotline);\n\tbackground-repeat: no-repeat;\n}\n.UIToolTip.attack-digit {\n\tfloat: right;\n\tposition: relative;\n\ttop: 3px;\n}\n.UIToolTip.attack-digit > img {\n\tmargin-left: -3px;\n\tmargin-top: 1px;\n}\n.UIToolTip.attribute {\n\tmargin-left: 12px;\n\tmargin-right: 12px;\n}\n.UIToolTip.attribute > div {\n\tposition: relative;\n\twidth: 100%;\n\theight: 16px;\n}\n.UIToolTip.req-job img {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n}\n.UIToolTip.attrLeft .UIToolTip.req-digit {\n\tposition: absolute;\n\tright: -1px;\n\twidth: 20px;\n\tdisplay: flex;\n\tflex-direction: row;\n}\n.UIToolTip.attrRight .UIToolTip.req-digit {\n\tposition: absolute;\n\tright: 1px;\n\twidth: 20px;\n}\n.UIToolTip.equip-req {\n\tposition: relative;\n\twidth: 100%;\n\theight: 6px;\n\tmargin-left: 2px;\n}\n.UIToolTip.equip-req > img {\n\tposition: absolute;\n}\n.UIToolTip.attrLeft .UIToolTip.req-digit > img {\n\tfloat: right;\n\tmargin-left: 1px;\n}\n.UIToolTip.attrRight .UIToolTip.req-digit > img {\n\tfloat: left;\n}\n.UIToolTip.equip-icon {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px;\n\tmargin: auto;\n\tbottom: 0;\n\tright: 0;\n}\n.debug-info {\n\tposition: absolute;\n\ttop: 0;\n\tright: 0;\n\ttransform: translateX(100%);\n\tdisplay: inline-block;\n\n\tbackground: rgba(255,255,255,0.7) !important;\n\tcolor: black !important;\n\n\tborder: double rgba(0,0,0,0.6);\n\tborder-radius: 10px;\n\tpadding: 0.5em 0.25em;\n\n\t/*\n\tfont-size: 1.2em;\n\ttext-shadow: rgb(255, 255, 255) 0 0 16px, rgb(255, 255, 255) 0 0 12px, rgb(255, 255, 255) 0 0 5px, rgb(255, 255, 255) 0 0 2px, rgba(0, 0, 0, 0.5) 0 0 1px;\n\t*/\n\ttext-shadow: 0 0 1px rgba(255, 255, 255, 0.5);\n\n\tfont-family: monospace;\n}\n.text-stroke {\n\ttext-shadow: -1px -1px black, 0px -1px black, 1px -1px black, -1px 0px black, 1px 0px black, -1px 1px black, -1px 0px black, 1px 1px black, 0 0 1px black;\n}\n",""])},function(t,e,i){"use strict";var s=i(429);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.frame[data-v-40c717aa] {\n\tposition: relative;\n\tdisplay: inline-block;\n}\n.frame-warp[data-v-40c717aa] {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\tline-height: 0;\n}\n.frame-inner[data-v-40c717aa] {\n\tborder-collapse: collapse;\n\tborder-spacing: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n.frame-inner tr[data-v-40c717aa], .frame-inner td[data-v-40c717aa] {\n\tpadding: 0;\n}\n.content[data-v-40c717aa] {\n\tposition: relative;\n\tpadding: 7px;\n\tcolor: white;\n}\n.z1[data-v-40c717aa] {\n\tz-index: 1;\n}\n.z2[data-v-40c717aa] {\n    position: absolute;\n\tz-index: 2;\n}\n",""])},function(t,e){},function(t,e,i){"use strict";var s=i(452);i.n(s).a},function(t,e,i){(t.exports=i(350)(!1)).push([t.i,"\n.fade-enter-active, .fade-leave-active {\n\ttransition: opacity .25s;\n}\n.fade-enter, .fade-leave-to /* .fade-leave-active in below version 2.1.8 */ {\n\topacity: 0;\n}\n.fade400-enter-active, .fade400-leave-active {\n\ttransition: opacity .5s;\n}\n.fade400-enter, .fade400-leave-to /* .fade400-leave-active in below version 2.1.8 */ {\n\topacity: 0;\n}\n.app-menu {\n\tz-index: 1;\n\tposition: absolute;\n}\n.scene-editor {\n\tz-index: 0;\n}\n",""])}])]);
//# sourceMappingURL=10.js.map