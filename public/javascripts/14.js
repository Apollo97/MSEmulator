(window.webpackJsonp=window.webpackJsonp||[]).push([[14,8,17],{334:function(t,e,i){"use strict";i.r(e),i.d(e,"AnimationBase",function(){return a}),i.d(e,"Animation",function(){return n});i(333),i(332);var s=i(349);window.m_draw_animation_texture_info=!1;class r{constructor(t,e){this._raw=t,this._url=e,this.frame=0,this.time=0,this.delta=0,this.textures=[],this.is_loop=!0,this.is_end=!1,this._url}getTotalTime(){return this.textures.reduce((t,e)=>t+e.delay,0)}clone(){let t=new this.constructor(this._raw,this._url);return t.textures=this.textures,t}load(){throw new Error("Not implement")}update(t){throw new Error("Not implement")}_resetFrame(){this.frame=0,this.time=0}reset(){this.frame=0,this.time=0,this.is_end=!1}get texture(){throw new Error("Not implement")}destroy(){this.is_loop=!1,this.is_end=!0}}class a extends r{constructor(t,e){super(t,e)}async load(){for(let t=0;t in this._raw;++t){let e=this._url+"/"+t,i=new s.a(this._raw[t]);i._url=e,this.textures[t]=i}this.textures[0]&&(this.textures[0].isLoaded()||this.textures[0].__loadTexture())}isEnd(){return this.is_end}_update(t){const e=this.textures.length;e>0&&(this.time=this.time+t,this.time>this.texture.delay&&(this.frame=++this.frame%e,this.time=0)),this.delta+=t}update(t){const e=this.textures.length;if(e>0&&(this.time=this.time+t,this.time>this.texture.delay)){if(this.frame=this.frame+1,this.frame>=e){if(!this.is_loop)return this.frame=e-1,void(this.is_end=!0);this.reset()}this.time=0}this.delta+=t}draw(t,e,i,s,r){let a=this.texture;t.drawRotaGraph(a,e,i,s,r)}get texture(){return this.textures[this.frame]}}class n extends a{constructor(t,e){super(t,e),this.draw=this._draw_and_preload}_draw_and_preload(t,e,i,s,r){let a;for(a=this.frame;a>=0;--a){let n=this.textures[a];if(n.isLoaded()){t.drawRotaGraph(n,e,i,s,r);break}}let n=this.textures[++a];n?n.isLoaded()||n.__loadTexture():delete this.draw}}},337:function(t,e,i){"use strict";i.r(e),i.d(e,"CharacterAnimationBase",function(){return M}),i.d(e,"CharacterRenderer",function(){return q});var s=i(354),r=i(338),a=i(334),n=(i(335),i(332)),o=i(349),h=i(333),l=i(370);let c={},u={};class d extends o.b{constructor(t,e){super(t,e),this._raw.origin&&(this._raw.origin.__proto__=h.Vec2.prototype);for(let t in this._raw.map)this._raw.map[t].__proto__=h.Vec2.prototype;this.relative=new h.Vec2(0,0),this.calcRelative=this._calcRelative,this.filter=new n.ImageFilter,this.opacity=1,this._slot=null,this._place=null,this.classList=null}get z(){return c[this._raw.z]||1}set z(t){console.warn("Not implement")}get order(){return this.z}set order(t){console.warn(new Error("Not implement").stack)}get origin(){return this._raw.origin||h.Vec2.empty}isHasAnchor(){return!!this._raw.map}get brow(){return this._raw.map.brow}isAnchorBrow(){return!!this._raw.map.brow}get neck(){return this._raw.map.neck}isAnchorNeck(){return!!this._raw.map.neck}get navel(){return this._raw.map.navel}isAnchorNavel(){return!!this._raw.map.navel}get hand(){return this._raw.map.hand}isAnchorHand(){return!!this._raw.map.hand}get handMove(){return this._raw.map.handMove}isAnchorHandMove(){return!!this._raw.map.handMove}get _earBelowHead(){return this._raw.map.earBelowHead}isAnchor_EarBelowHead(){return!!this._raw.map.earBelowHead}get _earOverHead(){return this._raw.map.earOverHead}isAnchor_EarOverHead(){return!!this._raw.map.earOverHead}_anchor(t,e,i){return e[i].sub(t[i]).add(e.origin.sub(t.origin))}_calcRelative(t){return this.calcRelative=this._getRelativeFunction(t),this.calcRelative(t)}_getRelativeFunction(t){return this.isHasAnchor()?this.isAnchorNeck()?this._calcRelative_neck:this.isAnchorBrow()?this._calcRelative_brow:this.isAnchorNavel()?this==t.slots.body?this._getOrigin:this._calcRelative_navel:this.isAnchorHand()?this._calcRelative_hand:this.isAnchorHandMove()?this._url.lastIndexOf("lHand")>0?this._calcRelative_handMove_lHand:this._calcRelative_handMove:void 0:this._calcRelativeEmpty}_calcRelativeEmpty(t){return h.Vec2.empty}_getOrigin(){return this.origin}_calcRelative_neck(t){const e=t.slots.body.fragments.body.getTexture(t);return this._anchor(this,e,"neck").sub(e.origin)}_calcRelative_brow(t){const e=t.slots.body.fragments.body.getTexture(t),i=t.slots.head.fragments.head.getTexture(t);return this._anchor(this,i,"brow").add(this._anchor(i,e,"neck")).sub(e.origin)}_calcRelative_navel(t){return t.slots.body.fragments.body.getTexture(t).navel.sub(this.navel,this.origin)}_calcRelative_hand(t){const e=t.slots.body.fragments.body.getTexture(t),i=t.slots.body.fragments.arm.getTexture(t);return null==i?h.Vec2.empty.sub(this.hand).sub(this.origin).sub(e.origin):this._anchor(this,i,"hand").sub(this._anchor(e,i,"navel")).sub(e.origin)}_calcRelative_handMove(t){return h.Vec2.empty.sub(this.origin).sub(this.handMove)}_calcRelative_handMove_lHand(t){return h.Vec2.empty.sub(this.origin)}update(t){this.relative=this.calcRelative(t)}render(t,e){if(!this.relative)return;const i=this.relative.x,s=this.relative.y;t.globalAlpha=this.opacity||1,this.filter.isEmpty?t.drawGraph2(this,i,s):(t.ctx.filter=this.filter.toString(),t.drawGraph2(this,i,s),t.ctx.filter="none")}}class _ extends d{constructor(...t){super(...t),this.graph2=null,this.graph3=null}update(t){this.relative=this.calcRelative(t),this.graph2&&(this.graph2.relative=this.relative),this.graph3&&(this.graph3.relative=this.relative)}render(t,e){this.relative&&(t.globalAlpha=this.opacity||1,this.filter.isEmpty?this._render(t):(t.ctx.filter=this.filter.toString(),this._render(t),t.ctx.filter="none"))}_render(t){const e=this.relative.x,i=this.relative.y;t.drawGraph2(this,e,i),this.graph2&&this.graph2.opacity&&(t.globalAlpha=this.graph2.opacity,t.drawGraph2(this.graph2,e,i)),this.graph3&&this.graph3.opacity&&(t.globalAlpha=this.graph3.opacity,t.drawGraph2(this.graph3,e,i))}}class f extends a.Animation{constructor(t,e){super(t,e),Object.defineProperty(this,"_raw",{value:t}),this.__getAttr("z",-1),this.__getAttr("pos",1),super.load()}__getAttr(t,e){t in this._raw?this[t]=this._raw[t]:this[t]=e}render(t,e,i,s){if(e)this.draw(t,0,0,-i,s);else{const e=.25*-this.texture.height;this.draw(t,0,e,0,s)}}}class p{constructor(){this._url=null,this._raw=null,this.animation={},this.action=null,this.time=0,this.frame=0,this.fixed=0,this.z=-2,this.action=1,this.actionExceptRotation=0}static async Init(){try{let t=p._list,e=$get.list("/Effect/ItemEff");t.clear(),e.forEach(e=>{t.add(parseInt(e,10))})}catch(t){return!1}}static async load(t){let e=new p;return await e.load(t),e}async load(t){const e=Number(t),i=`/Effect/ItemEff/${e}/effect`;if(!p._list.has(e))return null;let s=await $get.data(i);return s?await this._load(t,i,s):null}update(t,e){e in this.animation?this.action=e:this.action="default",this.animation[this.action]&&this.animation[this.action].update(t)}render(t,e){this.animation&&this.animation[this.action]&&this.animation[this.action].render(t,this.actionExceptRotation,e.angle,e.front>0)}async _load(t,e,i){this.id=t,Object.defineProperty(this,"_raw",{value:i}),this.__construct()}__construct(){this.__getAttr("fixed",0),this.__getAttr("z",-1),this.__getAttr("action",1),this.__getAttr("actionExceptRotation",0);for(let t in this._raw)this._raw[t]&&"object"==typeof this._raw[t]&&"0"in this._raw[t]&&(this.animation[t]=new f(this._raw[t],[this._url,t].join("/")))}__getAttr(t,e){t in this._raw?this[t]=this._raw[t]:this[t]=e}}p._list=new Set;class g{constructor(t){this.textures=t}getTexture(t,e){throw new Error("Not implement")}}class m extends g{constructor(t){super(t)}getTexture(t){return this.getFrameTexture(t,t.action_frame)}getFrameTexture(t,e){if(!(t.action in this.textures))return null;let i=this.textures[t.action][e];return i||null}}class w extends g{constructor(t){super(t)}getTexture(t){return this.getFrameTexture(t,t.emotion_frame)}getFrameTexture(t,e){if(!(t.emotion in this.textures))return null;return this.textures[t.emotion][e]}}class y{constructor(t){this.equip=t}get hue(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let r=t.fragments[e].textures[i][s];if(r)return r.filter.hue}}set hue(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let r=0;r<e.fragments[i].textures[s].length;++r){let a=e.fragments[i].textures[s][r];a&&(a.filter.hue=t)}}get sat(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let r=t.fragments[e].textures[i][s];if(r)return r.filter.sat}}set sat(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let r=0;r<e.fragments[i].textures[s].length;++r){let a=e.fragments[i].textures[s][r];a&&(a.filter.sat=t)}}get bri(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let r=t.fragments[e].textures[i][s];if(r)return r.filter.bri}}set bri(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let r=0;r<e.fragments[i].textures[s].length;++r){let a=e.fragments[i].textures[s][r];a&&(a.filter.bri=t)}}get contrast(){const t=this.equip;for(let e in t.fragments)for(let i in t.fragments[e].textures)for(let s=0;s<t.fragments[e].textures[i].length;++s){let r=t.fragments[e].textures[i][s];if(r)return r.filter.contrast}}set contrast(t){const e=this.equip;for(let i in e.fragments)for(let s in e.fragments[i].textures)for(let r=0;r<e.fragments[i].textures[s].length;++r){let a=e.fragments[i].textures[s][r];a&&(a.filter.contrast=t)}}toJSON(){return{hue:this.hue,sat:this.sat,bri:this.bri,contrast:this.contrast}}}class x{constructor(){}get _animation_type(){throw new Error("Not Implement")}isLoaded(){return!1}_unload(){}getFrameCount(t){return 0}getDelay(t){return 0}toJSON(){return{id:-1}}}class E extends x{constructor(){super(),this._raw=null,this.effect=null,this.fragments=null,this._onload=null,this.id=null,this.categoryInfo=null,this.slot_order=0,this.islot={},this.vslot={},this.filter=new y(this)}toJSON(){return{id:this.id,filter:this.filter.toJSON()}}isLoaded(){return null!=this.fragments}get _onload(){return this.__onload}set _onload(t){this.__onload=t,this.isLoaded()&&this.__onload.call(this,this)}async load(t,e,i,s){let r,a;return this.id=e,this.categoryInfo=i,r=this.__load(t,e,i),i.path&&(a=$get.data(`/String/Eqp/Eqp/${i.path}/${Number(e)}`).then(t=>{t&&(this.name=t.name,this.desc=t.desc)},t=>{this.name="["+e+"]",this.desc=""})),new Promise(function(t){Promise.all([r,a]).then(function(e){t(e[0])})})}async __load(t,e,i){let r;try{s.d.isEquipExist(e,i)&&(r=await $get.data(t))}catch(t){}try{!r&&load_extern_item_data&&(r=await load_extern_item_data(e))}catch(t){if(!r)return!1}return Object.defineProperty(this,"_raw",{value:r}),this.__load_slot(),this.__load_fragments(),this._onload&&this._onload.call(this,this),p.load(this.id).then(t=>this.effect=t),!0}__load_fragments(){const t=this.fragmentConstructor;let e=Object.keys(this._raw_textures),i={};for(let t of e)if("0"in this._raw_textures[t]){let e=this._base_path+t;i[t]=this.__load_frame_textures(this._raw_textures[t],e)}let s={};for(let t in i)for(let e in i[t])for(let r in i[t][e])r in s||(s[r]={}),t in s[r]||(s[r][t]=[]),s[r][t][e]=i[t][e][r];let r={};for(let e in s)r[e]=new t(s[e]);this.fragments=r}__load_frame_textures(t,e){let i=[];for(let s=0;s in t;++s){let r=`${e}/${s}`;i[s]=this.__load_place_textures(t[s],r)}return i}__load_place_textures(t,e){let i={};for(let s in t){let r=`${e}/${s}`,a=t[s];if(a){const t=this.FragmentTextureType;let e;""==a[""]?(e._url=r,i[s]=e):"string"==typeof a[""]?(e=new t(a),i[s]=e):"hairShade"==s&&(e=new t(a[0]),i[s]=e),e&&(e._slot=this.categoryInfo.slot,e._place=s,e.classList=[e._slot,"item"+this.id,e._place,e._raw.z,"z"+e.z].join(" "))}}return i}get FragmentTextureType(){return d}__load_slot(){if(!this._raw.info.islot)return;let t=this._raw.info.islot.match(/([A-Z][a-z0-9])/g);for(let e in t){const i=t[e],s=c[i];this.islot[i]=s,s>this.slot_order&&(this.slot_order=s)}let e=this._raw.info.vslot.match(/([A-Z][a-z0-9])/g);for(let t in e){const i=e[t];this.vslot[i]=i}}_unload(){this.fragments=null,this.effect}get opacity(){for(let t in this.fragments)for(let e in this.fragments[t].textures)for(let i=0;i<this.fragments[t].textures[e].length;++i){let s=this.fragments[t].textures[e][i];if(s)return s.opacity}}set opacity(t){for(let e in this.fragments)for(let i in this.fragments[e].textures)for(let s=0;s<this.fragments[e].textures[i].length;++s){let r=this.fragments[e].textures[i][s];r&&(r.opacity=t)}}setFilter(t,e,i){for(let s in this.fragments)for(let r in this.fragments[s].textures)for(let a=0;a<this.fragments[s].textures[r].length;++a){let n=this.fragments[s].textures[r][a];n&&(n.filter.hue=t,n.filter.sat=e,n.filter.bri=i)}}getIconUrl(){return s.c.getIconUrl(this.id)}getIconRawUrl(){return s.c.getIconRawUrl(this.id)}get _raw_textures(){return this._raw}get _base_path(){return this._url}}class b extends E{constructor(){super()}get _animation_type(){return"action"}getFrameCount(t){try{return t.slots.body.fragments.body.textures[t.action].length}catch(t){return 0}}getDelay(t){try{const e=this._raw[t.action][t.action_frame].delay;if(null!=e)return!isNaN(e)&&isFinite(e),e}catch(t){}return 120}get fragmentConstructor(){return m}}class v extends b{constructor(){super()}get FragmentTextureType(){return _}}class $ extends E{constructor(){super()}get _animation_type(){return"emotion"}getFrameCount(t){try{return t.slots.face.fragments.face.textures[t.emotion].length}catch(t){return 0}}getDelay(t){try{const e=this._raw[t.emotion][t.emotion_frame].delay;if(null!=e)//!isNaN(d) && isFinite(d)
return e}catch(t){}return 60}get fragmentConstructor(){return w}}s.c._info["0000"].fragmentType=class extends b{constructor(){super()}},s.c._info["0001"].fragmentType=class extends b{constructor(){super(),this.elfEarFragment=null,this.lefEarFragment=null,this.highlefEarFragment=null}__load_fragments(){super.__load_fragments(),this.fragments&&(this.fragments.ear&&(this.elfEarFragment=this.fragments.ear,delete this.fragments.ear),this.fragments.lefEar&&(this.lefEarFragment=this.fragments.lefEar,delete this.fragments.lefEar),this.fragments.highlefEar&&(this.highlefEarFragment=this.fragments.highlefEar,delete this.fragments.highlefEar))}get elfEar(){return null!=this.fragments.ear}set elfEar(t){this.elfEarFragment&&(t?this.fragments.ear=this.elfEarFragment:delete this.fragments.ear)}get lefEar(){return null!=this.fragments.lefEar}set lefEar(t){this.lefEarFragment&&(t?this.fragments.lefEar=this.lefEarFragment:delete this.fragments.lefEar)}get highlefEar(){return null!=this.fragments.highlefEar}set highlefEar(t){this.highlefEarFragment&&(t?this.fragments.highlefEar=this.highlefEarFragment:delete this.fragments.highlefEar)}},s.c._info["0002"].fragmentType=class extends ${constructor(){super()}},s.c._info["0003"].fragmentType=v,s.c._info["0004"].fragmentType=v,s.c._info["0100"].fragmentType=b,s.c._info["0101"].fragmentType=$,s.c._info["0102"].fragmentType=b,s.c._info["0103"].fragmentType=b,s.c._info["0104"].fragmentType=b,s.c._info["0105"].fragmentType=b,s.c._info["0106"].fragmentType=b,s.c._info["0107"].fragmentType=b,s.c._info["0108"].fragmentType=b,s.c._info["0109"].fragmentType=b,s.c._info["0110"].fragmentType=b,s.c._info["0170"].fragmentType=class extends b{constructor(){super(),this.use_category=null}async load(t,e,i,s){if(s||""==s)return this.use_category=s.slice(2,4),super.load(t,e,i);console.warn("no use_category")}get _raw_textures(){return this._raw[this.use_category]}get _base_path(){return this._url+this.use_category}};class T{constructor(){this._ordered_slot=[],this._hair=null,this._hair2=null,this._hairMix2=null,this._hair3=null,this._hairMix3=null,this.body=null,this.head=null,this.face=null,this.hair=null,this.cap=null,this.accessoryFace=null,this.accessoryEyes=null,this.accessoryEars=null,this.coat=null,this.longcoat=null,this.pants=null,this.shoes=null,this.glove=null,this.cape=null,this.shield=null,this.weapon=null,Object.defineProperty(this,"_ordered_slot",{configurable:!0,writable:!0,enumerable:!1,value:[]}),Object.defineProperty(this,"_hair",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hair2",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hairMix2",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hair3",{writable:!0,enumerable:!1,value:null}),Object.defineProperty(this,"_hairMix3",{writable:!0,enumerable:!1,value:null})}get hair(){return this._hair}set hair(t){this._hair=t,t&&(this._hair2&&this._hairMix2&&(this.hairColor2=this.hairColor2,this.hairMix2=this.hairMix2),this._hair3&&this._hairMix3&&(this.hairColor3=this.hairColor3,this.hairMix3=this.hairMix3))}async __loadColoredHair(t){const e=s.a.getColorHairID(this.hair.id,t),i=s.c.get(e);if(i){const t=`/Character/${i.path+(i.path?"/":"")+e}`,s=void 0;let r=new v;return await r.load(t,e,i,s),r}}get hairColor2(){if(this._hair2)return Number(s.a.getHairColor(this._hair2.id))}set hairColor2(t){if(!t)return void console.error(new TypeError);let e=s.a.getColorHairID(this.hair.id,t);this._hair2&&e==this._hair2.id||(e==this._hair.id?(this._hair2=null,this.hairMix2=0):(this.hair.$promise_hair2=this.__loadColoredHair(t),this.hair.$promise_hair2.then(t=>{delete this.hair.$promise_hair2,this._hair2=t,this._hair2&&null!=this.hairMix2&&(this.hairMix2=this.hairMix2)})))}get hairMix2(){return this._hairMix2}set hairMix2(t){t=Number(t),Promise.resolve(this.hair.$promise_hair2).then(()=>{let e=this._hair2,i=this.hair;if(e&&i){for(let s in e.fragments)for(let r in e.fragments[s].textures)for(let a=0;a<e.fragments[s].textures[r].length;++a){let n=e.fragments[s].textures[r][a],o=i.fragments[s].textures[r][a];o&&(o.graph2=n,o.graph2.opacity=t)}this._hairMix2=t}})}get hairColor3(){if(this._hair3)return Number(s.a.getHairColor(this._hair3.id))}set hairColor3(t){if(!t)return void console.error(new TypeError);let e=s.a.getColorHairID(this.hair.id,t);this._hair3&&this._hair3.id==e||(this._hair.id==e||this._hair2.id==e?(this._hair3=null,this.hairMix3=0):(this.hair.$promise_hair3=this.__loadColoredHair(t),this.hair.$promise_hair3.then(t=>{delete this.hair.$promise_hair3,this._hair3=t,this._hair3&&null!=this.hairMix3&&(this.hairMix3=this.hairMix3)})))}get hairMix3(){return this._hairMix3}set hairMix3(t){t=Number(t),Promise.resolve(this.hair.$promise_hair3).then(()=>{let e=this._hair3,i=this.hair;if(e&&i){for(let s in e.fragments)for(let r in e.fragments[s].textures)for(let a=0;a<e.fragments[s].textures[r].length;++a){let n=e.fragments[s].textures[r][a],o=i.fragments[s].textures[r][a];o&&(o.graph3=n,o.graph3.opacity=t)}this._hairMix3=t}})}async _use(t,e,i){if(!t)return;const r=s.c.get(t);if(r){let s,a=`/Character/${r.path+(r.path?"/":"")+t}`;if(e instanceof E)alert("CharacterSlots # _use: param loadedEquip ??"),s=e;else{e&&alert("CharacterSlots # _use: param loadedEquip ??"),s=new(r.fragmentType||b)}0,e||await s.load(a,t,r,i)?(this[r.slot]&&this[r.slot]._unload(),this[r.slot]=s,this._ordered_slot[s.slot_order]=s):console.warn("item("+t+") is not exist")}}_unuse(t){if(!t)return;let e,i;if(t instanceof E?(t=(i=t).id,e=i.categoryInfo):e=s.c.get(t),"head"!=e.slot&&"body"!=e.slot&&this[e.slot]&&this[e.slot].id==t){i=this[e.slot];for(let t in i.islot){let e=i.islot[t];this._ordered_slot[e]&&this._ordered_slot[e]._unload(),delete this._ordered_slot[e]}return!0}return!1}_clear(){this.face=null,this.hair=null,this.cap=null,this.accessoryFace=null,this.accessoryEyes=null,this.accessoryEars=null,this.coat=null,this.longcoat=null,this.pants=null,this.shoes=null,this.glove=null,this.cape=null,this.shield=null;let t=this.head,e=this.body;this._ordered_slot=[],t&&(this._ordered_slot[t.slot_order]=t),e&&(this._ordered_slot[e.slot_order]=e)}_stringify(){let t=["c"];if(this.body&&t.push(this.body.id),this.head&&t.push(this.head.id),this.face&&t.push(this.face.id+"|"+this.face.id),this.hair){let e=[];e.push(this.hair.id),this.hairColor2&&this.hairMix2>0&&e.push(this.hairColor2+"%"+Math.trunc(100*this.hairMix2)),this.hairColor3&&this.hairMix3>0&&e.push(this.hairColor3+"%"+Math.trunc(100*this.hairMix3)),t.push(e.join("|"))}return this.cap&&t.push(this.cap.id),this.accessoryFace&&t.push(this.accessoryFace.id),this.accessoryEyes&&t.push(this.accessoryEyes.id),this.accessoryEars&&t.push(this.accessoryEars.id),this.coat&&t.push(this.coat.id),this.longcoat&&t.push(this.longcoat.id),this.pants&&t.push(this.pants.id),this.shoes&&t.push(this.shoes.id),this.glove&&t.push(this.glove.id),this.shield&&t.push(this.shield.id),this.cape&&t.push(this.cape.id),this.weapon&&t.push(this.weapon.id),t.join(",")}toJSON(){let t=[];return this.body&&t.push(this.body.id),this.head&&t.push(this.head.id),this.face&&t.push(this.face.id),this.hair&&t.push(this.hair.id),this.cap&&t.push(this.cap.id),this.accessoryFace&&t.push(this.accessoryFace.id),this.accessoryEyes&&t.push(this.accessoryEyes.id),this.accessoryEars&&t.push(this.accessoryEars.id),this.coat&&t.push(this.coat.id),this.longcoat&&t.push(this.longcoat.id),this.pants&&t.push(this.pants.id),this.shoes&&t.push(this.shoes.id),this.glove&&t.push(this.glove.id),this.shield&&t.push(this.shield.id),this.cape&&t.push(this.cape.id),this.weapon&&t.push(this.weapon.id),t}*enumerate(){this.face&&(yield this.face),this.hair&&(yield this.hair),yield*this.enumerate_equip()}*enumerate_equip(){this.cap&&(yield this.cap),this.accessoryFace&&(yield this.accessoryFace),this.accessoryEyes&&(yield this.accessoryEyes),this.accessoryEars&&(yield this.accessoryEars),this.coat&&(yield this.coat),this.longcoat&&(yield this.longcoat),this.pants&&(yield this.pants),this.shoes&&(yield this.shoes),this.glove&&(yield this.glove),this.shield&&(yield this.shield),this.cape&&(yield this.cape),this.weapon&&(yield this.weapon)}*enumerate_face(){this.face&&(yield this.face),this.accessoryFace&&(yield this.accessoryFace)}}class C{constructor(){this.ear=void 0,this.useEquip=[],this.unuseEquip=[],this.hair2=void 0,this.hairMix2=void 0,this.weapon=void 0,this.weaponType=void 0}clear(){this.ear=void 0,this.useEquip=[],this.unuseEquip=[],this.hair2=void 0,this.hairMix2=void 0,this.weaponType=void 0}}class M{constructor(){this._$dirty=0,this.job=null,this.subJob=null,this.actani=new l.a,this.speed=1,this.fixed_speed=!1,this._action="stand1",this._action_frame=0,this._action_time=0,this._emotion="blink",this._emotion_frame=0,this._emotion_time=0,this._emotion_frame_sequence=[0,1,2,1],this.slots=new T,this.__require_update=!0,this.__frag_list=[],this.$$changeLog=new C}_clone(){alert(this.constructor.name+"::_clone");let t=new this.constructor;if(t){t.speed=0,t.x=this.x,t.y=this.y,t.angle=this.angle,t.action=this.action,t.action_frame=this.action_frame,t.emotion=this._emotion,t.emotion_frame=this.emotion_frame;for(let e in this.slots){this.slots[e]&&(t.slots[e]=this.slots[e])}return t}}_waitFrameTexturesLoaded(){let t=[];for(let e in this.slots){let i=this.slots[e];if(i){"function"!=typeof i.getFrameCount&&alert('typeof item.getFrameCount != "function"');let e=i.getFrameCount(this);for(let s in i.fragments){let r=i.fragments[s];for(let i=0;i<e;++i){let e=r.getFrameTexture(this,i);e&&!e._isLoaded_or_doload()&&t.push(e.$promise)}}}}return Promise.all(t)}initAnimation(){this.action="stand1",this._action_time=0,this._action_frame=0,this.emotion="blink",this._emotion_time=0,this._emotion_frame=0}getSpeed(){return this.fixed_speed?1:this.speed}get elfEar(){if(this.slots.head)return this.slots.head.elfEar}set elfEar(t){this.slots.head&&(this.slots.head.elfEar=t)}get lefEar(){if(this.slots.head)return this.slots.head.lefEar}set lefEar(t){this.slots.head&&(this.slots.head.lefEar=t)}get highlefEar(){if(this.slots.head)return this.slots.head.highlefEar}set highlefEar(t){this.slots.head&&(this.slots.head.highlefEar=t)}get ear(){if(this.slots.head)return this.slots.head.lefEar?"lef":this.slots.head.elfEar?"elf":this.slots.head.highlefEar?"highlef":"human"}set ear(t){this.slots.head?"elf"==t?(this.slots.head.elfEar=!0,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear=t):"lef"==t?(this.slots.head.lefEar=!0,this.slots.head.elfEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear=t):"highlef"==t?(this.slots.head.elfEar=!1,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!0,this.$$changeLog.ear=t):(this.slots.head.elfEar=!1,this.slots.head.lefEar=!1,this.slots.head.highlefEar=!1,this.$$changeLog.ear="human"):this.$$changeLog.ear=void 0}get action(){return this._action}set action(t){this.actani._action!=t&&this.slots.body&&(this._action=t,this.actani.reload(t),this.__require_update|=!0)}get action_frame(){const t=this.action_frame_count;return t?this._action_frame%t:0}set action_frame(t){this._action_time=0,this._action_frame=t,this.__require_update|=!0}_get_action_next_frame(t){const e=this.action_frame_count;if(e){let i=this._action_frame+t;return i<0?e-1:i%e}return 0}get action_time(){return this._action_time}set action_time(t){this.action_frame_count&&(t<this.action_delay?this._action_time=t:(this._action_time=0,++this._action_frame,this.__require_update|=!0))}get action_delay(){return this.slots.body?this.slots.body.getDelay(this):180}get action_frame_count(){try{if(this.slots.body)return this.slots.body.getFrameCount(this)}catch(t){}return 0}get emotion(){return this._emotion}set emotion(t){this._emotion!=t&&this.slots.face&&this.slots.face._action_list.indexOf(t)>=0&&(this._emotion=t,this._emotion_frame=0,this._emotion_time=0,this._emotion_frame_sequence=[...P(this.emotion_frame_count)],this.__require_update|=!0)}*emotion_frame_sequence_generator(t){for(;;)for(yield*P(t);Math.random()<.5;)yield 0}get emotion_frame(){return this._emotion_frame_sequence[this._emotion_frame%this._emotion_frame_sequence.length]}set emotion_frame(t){this._emotion_frame=t,this._emotion_time=0,this.__require_update|=!0}_get_emotion_next_frame(t){let e=this._emotion_frame+t;return e=e<0?this._emotion_frame_sequence.length-1:e%this._emotion_frame_sequence.length,this._emotion_frame_sequence[e]}get emotion_time(){return this._emotion_time}set emotion_time(t){this.emotion_frame_count&&(t<this.emotion_delay?this._emotion_time=t:(this._emotion_time=0,++this._emotion_frame,this.__require_update|=!0))}get emotion_delay(){return this.slots.face?this.slots.face.getDelay(this):60}get emotion_frame_count(){try{if(this.slots.face)return this.slots.face.getFrameCount(this)}catch(t){}return 0}_update(t){this.actani?(this.actani.isEnd()&&this.actani.loop&&this.actani.reset(),this.actani.update(t,this)):this.action_time+=t,this.emotion_time+=t;for(let e in this.slots){let i=this.slots[e];i&&i.effect&&i.effect.update(t)}}update(t){t*=this.getSpeed(),this._update(t)}__forceUpdate(t){this._$dirty=-Math.random()+3.1415926535897*Math.random(),this._update(0|t),this.__update_frag_list()}_draw(t,e,i,s,r){t.pushGlobalAlpha(),this.__require_update&&(this.__update_frag_list(),this.__require_update=!1),this.__draw_list(t,this.__frag_list,e,i,s,r),t.popGlobalAlpha()}__draw_list(t,e,i,s,r,a){t.pushMatrix(),t.translate(i,s),t.rotate(window.m_a||r),a&&t.scale(-1,1);for(let e in this.slots){let i=this.slots[e];i&&i.effect&&i.effect.render(t,this)}for(let i in e){e[i].render(t,this)}t.popMatrix()}__add_equip_to_frag_list(t,e){if(null!=e&&!(e>0)){for(let i in e.vslot){t[e.vslot[i]]=[]}for(let i in e.fragments){let s=u[i];if(null!=s){let r=e.fragments[i].getTexture(this);r&&(t[s]?t[s].push(r):t[s]=[r])}else if("default"==i){let r=e.fragments[i].getTexture(this);s=e._raw.info.islot,r&&(t[s]?t[s].push(r):t[s]=[r])}else{let t=e.fragments[i].getTexture(this);t&&this.__add_frag_to_list(t)}}}}__update_frag_list(){this.__frag_list=[];let t={};for(let e=2;e<=3;++e){let i=this.slots["_hair"+e];this.__add_equip_to_frag_list(t,i)}for(let e in this.slots._ordered_slot){let i=this.slots._ordered_slot[e];this.__add_equip_to_frag_list(t,i)}let e=!1;for(let i in t){let s=t[i];for(let t in s){let i=s[t];if(e){if(i._place.startsWith("face"))continue}else i._place.startsWith("backHair")&&(e=!0);this.__add_frag_to_list(i)}}{let t=this.__frag_list[114];t&&this.__frag_list.push(t)}this._calcBoundBox()}__add_frag_to_list(t){t.update(this),this.__frag_list[t.z]=t}_calcBoundBox(){let t=0,e=0,i=0,s=0;for(let r in this.__frag_list){let a=this.__frag_list[r];if(a.texture){let r=a.relative.x,n=a.relative.y,o=r+a.width,h=n+a.height;t=Math.min(t,r),e=Math.min(e,n),i=Math.max(i,o),s=Math.max(s,h)}}return this._boundBox=new h.Rectangle(Math.trunc(t),Math.trunc(e),Math.trunc(i-t),Math.trunc(s-e)),this._boundBox}toJSON(){let t={hair2:this.slots._hair2.id,hairMix2:this.slots.hairMix2,slots:this.slots.toJSON()};return this.slots.head.elfEar?t.ear="elf":this.slots.head.lefEar?t.ear="lef":this.slots.head.highlefEar&&(t.ear="highlef"),t}}class q extends M{constructor(){super(),this.x=0,this.y=0,this.z=5,this.tx=0,this.ty=0,this.angle=0,this.front=-1,this.__load_task=[],this.render=function(t){},this._boundBox=null}static async Init(){let t=await Promise.all([$get.data("/zmap"),$get.data("/smap"),p.Init(),l.a.Init()]);c={},Object.keys(t[0]).reverse().forEach((t,e)=>c[t]=e+1),u=t[1]}load(){this.use("00002012"),this.use("00012012");let t=Promise.all([...this.__load_task]);return function(t,e){e.then(function(e){t.initAnimation(),t.render=t._render})}(this,t),t}update(t){this.waitLoaded(),super.update(t)}_render(t){const e=Math.trunc(this.x+this.tx),i=Math.trunc(this.y+this.ty);this._draw(t,e,i,this.angle,this.front>=1)}_setup_test(){this.use("00026509"),this.use("00044041"),this.use("01053169"),this.use("01071077")}async __synchronize(t){this.__forceUpdate(t),await this.waitLoaded(),await this._waitFrameTexturesLoaded()}async waitLoaded(){let t=this.__load_task;t&&t.length&&await Promise.all(t).then(()=>{this.__load_task=[]})}async use(t,e){switch(e||(e=s.c.getJobWeaponCategory(this.job)),t[0]){case"0":s.c.isCashWeapon(t)?this.$$changeLog.weapon=t:this.$$changeLog.useEquip.push(t);let i=this.slots._use(t,null,e);this.__load_task.push(i),await i,this._calcBoundBox()}}unuse(t){if("0"==t[0]){let e=this.slots._unuse(t);return e&&(this.$$changeLog.unuseEquip.push(t),this._calcBoundBox()),e}}_parse(t){if(!t)return;let e=t.split(",");this.slots._clear(),e.forEach((t,e,i)=>{if(t.indexOf("|")>=0){const e=t.split("|"),i=s.c.get(e[0]);let r;if("face"==i.slot)r=e[1],this.$$changeLog.useEquip.push(r),this.use(r);else if("hair"==i.slot){const t=this.slots;let i=e[1],s=e[2];r=e[0],this.$$changeLog.useEquip.push(r),this.use(r).then(()=>{if(i&&i.indexOf("%")>=0){let e=i.split("%");const s=e[0],r=e[1]/100;this.$$changeLog.hair2=s,this.$$changeLog.hairMix2=r,t.hairColor2=s,t.hairMix2=r}if(s&&s.indexOf("%")>=0){let e=s.split("%");const i=e[0],r=e[1]/100;this.$$changeLog.hair3=i,this.$$changeLog.hairMix3=r,t.hairColor3=e[0],t.hairMix4=e[1]/100}})}else"weapon"==i.slot&&(this.$$changeLog.weaponType=e[1],this.$$changeLog.weapon=r,this.use.apply(this,e,e[1]))}else Number.isFinite(parseInt(t,10))&&this.use(t)})}get hairColor(){return this.slots.hair?s.a.getHairColor(this.slots.hair.id):"0"}set hairColor(t){if(this.slots.hair&&t!=this.hairColor){let e=s.a.getColorHairID(this.slots.hair.id,t);this.use(e)}}get faceColor(){return this.slots.face?s.a.getFaceColor(this.slots.face.id):"0"}set faceColor(t){if(this.slots.face&&t!=this.faceColor){let e=s.a.getColorFaceID(this.slots.face.id,t);this.use(e)}}commitChange(t){if(t.ear&&(this.ear=t.ear),this.useEquip)for(let t of this.useEquip)this.use(t);if(this.unuseEquip)for(let t of this.unuseEquip)this.unuse(t);t.hair2&&t.hairMix2&&(this.slots.hairColor2=t.hair2,this.slots.hairMix2=t.hairMix2),t.hair3&&t.hairMix3,t.weapon&&t.weaponType&&this.use(t.weapon,t.weaponType)}_stringify(t){let e=this.slots._stringify();return t?`chara._parse('${e}')`:e}_outlink(){if(this.slots.body&&this.slots.body.id&&this.slots.face&&this.slots.face.id&&this.action&&this.emotion){let t="https://labs.maplestory.io/api/GMS/latest/character/center/"+this.slots.body.id+"/",e=[...this.slots.enumerate()].map(t=>parseInt(t.id,10));return e[0]=this.slots.face.id+":"+this.emotion,t+=e.join(","),t+="/"+this.action+"?showears="+(this.elfEar?"true":"false"),t+="&showLefEars="+(this.lefEar?"true":"false")}console.log("character need body, face, action, emotion")}_download(){window.open(this._outlink())}_save_as_svg(){this.__texture_to_base64().then(t=>{let e=this.id+".svg",i='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" >';i+='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">\n',i+='<g transform="translate(32, 96)">',t.forEach(function(t){if(t){let e=t.classList;i+=`\t<image class="${e}" opacity="${t.opacity}" x="${t.relative.x}" y="${t.relative.y}" width="${t.width}" height="${t.height}" xlink:href="${t._url}"></image>\n`}}),i+="</g>",i+='<text x="0" y="122" fill="transparent">'+this._stringify(!1)+"</text>",i+="</svg>",DownloadData(i,"image/svg+xml;utf8",e)})}_save_as_png(t,e){let i=this._calcBoundBox(),s=i.size,r=-i.left,a=i.height;try{t.$swapCanvas()}catch(t){return void console.error(t)}const n=t._ctx2.canvas.width,o=t._ctx2.canvas.height;t.ctx.canvas.width=s.x,t.ctx.canvas.height=s.y;try{this._draw(t,r,a,0,!1)}catch(t){console.error(t)}let h=t.ctx.canvas.toDataURL("image/png");{let t=document.createElement("a"),i=`${e?e+".":""}${this.action}[${this.action_frame}].${this.emotion}[${this.emotion_frame}].png`;t.id=i,t.download=i,t.href=h,document.body.appendChild(t),t.click(),document.body.removeChild(t)}t.ctx.canvas.width=n,t.ctx.canvas.height=o;try{t.$swapCanvas()}catch(t){console.error(t)}return h}async __texture_to_base64(){let t=[];return this.__frag_list.forEach(function(e){if(e){if(e._url.startsWith("data:")?t.push(e):t.push(async function(){return e.texture.$src=e._url,e._url=await O(e._url),e}()),e.graph2){let i=e.graph2._url;i.startsWith("data:")?t.push(e.graph2):t.push(async function(){return e.texture.$src=e._url,e.graph2._url=await O(i),e.graph2}())}if(e.graph3){let i=e.graph3._url;i.startsWith("data:")?t.push(e.graph3):t.push(async function(){return e.texture.$src=e._url,e.graph3._url=await O(i),e.graph3}())}}}),Promise.all(t)}}function*P(t){let e=0;for(;e<t;++e)yield e;for(e-=2;e>0;--e)yield e}function O(t){return new Promise(function(e,i){let s=new XMLHttpRequest;s.onload=function(){let t=new FileReader;t.onloadend=function(){e(t.result)},t.onerror=function(t){i(t)},t.readAsDataURL(s.response)},s.open("GET",t),s.responseType="blob",s.send()})}Object(r.AddInitTask)(q.Init())},338:function(t,e,i){"use strict";i.r(e),i.d(e,"AddInitTask",function(){return l}),i.d(e,"InitAll",function(){return c});var s=i(358),r=i.n(s),a=(i(398),i(399),i(400),i(401),i(402),i(403),i(404),i(405),i(406),i(407),i(408),i(409),i(373),i(339)),n=i.n(a),o=i(336);window.jQuery=r.a,window.$=r.a,n.a.config.productionTip=!1,n.a.use(o.default),window.onwheel||(window.onwheel=function(){});let h=[];function l(t){h.push(t)}function c(){let t=Promise.all(h);return h=[],t}},349:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return n});var s=i(333),r=(i(332),i(335));class a extends r.Graph{constructor(t,e){t?(super(e,{width:t.__w,height:t.__h}),this._raw=t,e?this._url=e:!1!==a.isTexture(t)&&(this._url=t[""])):super()}static isTexture(t){if(t)if(t.hasOwnProperty("")){if("string"==typeof t[""])return!0}else if(!t.__isEmpty)throw console.group("no texture"),console.warn(t),console.groupEnd(),new Error("no texture");return!1}static isTextureHasData(t){return t&&"string"==typeof t[""]&&t[""].startsWith("data:image/")}set z(t){this._order=t}get z(){return this._order}_get(t,e,i){if(this._raw){if(e in this._raw)return i(this._raw[e])}else;return t}draw(){this._engine.drawGraph(this)}draw2(t,e){this._engine.drawGraph2(this,t-this.x,e-this.y)}draw2i(t,e){this._engine.drawGraph2(this,Math.trunc(t-this.x+.5),Math.trunc(e-this.y+.5))}}class n extends a{constructor(t,e){super(t,e);var i=this._get(new s.Vec2(0,0),"origin",s.Vec2.get);this.x=i.x,this.y=i.y,this.z=this._get(0,"z",Number),this.delay=this._get(100,"delay",Number)}drawPattern(t,e,i,s){if(!this.isLoaded())return;const r=this._engine.ctx;r.save();try{r.rect(t,e,i,s),r.clip();let a=t,n=t+i,o=e+s;for(let t=e;t<o;t+=this.height)for(let e=a;e<n;e+=this.width)this.draw2(e,t)}catch(t){console.error(t)}r.restore()}drawHorizontalPattern(t,e,i){if(!this.isLoaded())return;const s=this._engine.ctx;s.save();try{const s=t+i;for(let i=t;i<s;i+=this.width)this.draw2(i,e)}catch(t){console.error(t)}s.restore()}drawVerticalPattern(t,e,i){if(!this.isLoaded())return;const s=this._engine.ctx;s.save();try{const s=e+i;for(let i=e;i<s;i+=this.height)this.draw2(t,i)}catch(t){console.error(t)}s.restore()}_drawPattern(t,e,i,s){if(!this.isLoaded())return;const r=Math.trunc(i/this.width)*this.width,a=Math.trunc(s/this.height)*this.height,n=t,o=e,h=t+r,l=e+s;let c,u;if(s>=this.height){for(c=o;c<l;c+=this.height)if(i>=this.width){for(u=n;u<h;u+=this.width)this.draw2(u,c);let t=i-r;t>0&&this._engine._drawImage(this,0,0,t,this.height,u-this.x,c-this.y,t,this.height)}else this._engine._drawImage(this,0,0,i,this.height,n-this.x,c-this.y,i,this.height);let t=s-a;t>0&&(console.error(new Error("未完成")),this._engine._drawImage(this,0,0,this.width,t,n-this.x,c-this.y,this.width,t))}else console.error(new Error("未完成")),this._engine._drawImage(this,0,0,this.width,s,n-this.x,o-this.y,this.width,s)}_drawHorizontalPattern(t,e,i){if(!this.isLoaded())return;this._engine.ctx;const s=t+i;for(let i=t;i<s;i+=this.width)this.draw2(i,e)}_drawVerticalPattern(t,e,i){if(!this.isLoaded())return;this._engine.ctx;const s=e+i;for(let i=e;i<s;i+=this.height)this.draw2(t,i)}drawPattern4i(t,e,i,s){this.drawPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5),Math.trunc(s+.5))}drawHorizontalPattern3i(t,e,i){this.drawHorizontalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}drawVerticalPattern3i(t,e,i){this.drawVerticalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}_drawPattern4i(t,e,i,s){this._drawPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5),Math.trunc(s+.5))}_drawHorizontalPattern3i(t,e,i){this._drawHorizontalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}_drawVerticalPattern3i(t,e,i){this._drawVerticalPattern(Math.trunc(t+.5),Math.trunc(e+.5),Math.trunc(i+.5))}}},354:function(t,e,i){"use strict";i.d(e,"c",function(){return a}),i.d(e,"d",function(){return n}),i.d(e,"b",function(){return g}),i.d(e,"a",function(){return E});const s=[],r={};window.character_emotion_list=["blink","hit","smile","troubled","cry","angry","bewildered","stunned","vomit","oops","cheers","chu","wink","pain","glitter","despair","love","shine","blaze","hum","bowing","hot","dam","qBlue"],window.character_action_list=["walk1","walk2","stand1","stand2","alert","swingO1","swingO2","swingO3","swingOF","swingT1","swingT2","swingT3","swingTF","swingP1","swingP2","swingPF","stabO1","stabO2","stabOF","stabT1","stabT2","stabTF","shoot1","shoot2","shootF","proneStab","prone","heal","fly","jump","sit","ladder","rope"];class a{constructor(t,e,i,s,r,a="Equip"){5!=arguments.length&&alert("ItemCategoryInfo: "+[...arguments].join(",")),this.id_prefix=t,this.path=e,this.slot=s,this.listPath=i,this.categoryName=r,this.fragmentType=null,this.dataDir=null,this.iconPath=null,this.iconRawPath=null;{let t,i,r;switch(s){case"head":i="stand1/0/head",r="stand1/0/head";break;case"body":i="stand1/0/body",r="stand1/0/body";break;case"hair":i="stand1/0/hair",r="stand1/0/hair";break;case"face":i="blink/0/face",r="blink/0/face";break;default:i="info/icon",r="info/iconRaw"}"Equip"==a?t=`/Character/${e+(e?"/":"")}`:console.error("未完成"),Object.defineProperties(this,{dataDir:{value:t},iconPath:{value:i},iconRawPath:{value:r}})}}static getDataPath(t){const e=a.get(t);if(!e)return null;if("0"==t[0])return e.dataDir+t;throw new Error("未完成")}static getIconRawUrl(t){let e=a.get(t);return e?"0"==t[0]?p.imageUrl(e.dataDir+t+"/"+e.iconRawPath):void 0:null}static getIconUrl(t){let e=a.get(t);return e?"0"==t[0]?p.imageUrl(e.dataDir+t+"/"+e.iconPath):void 0:null}static async loadString(t){let e=a.get(t);if(!e)return null;let i=`/String/Eqp/Eqp/${e.path+(e.path?"/":"")}${Number(t)}`;return await p.data(i)}static get(t){let e;if(null==t||""==t)throw new TypeError;if(4==t.length){if(e=a._info[t])return e}else{if(e=a._info[t.slice(0,4)])return e;if(e=6==t.length?a._info[t]:a._info[t.slice(0,6)])return e}return console.warn("unknow item type, itemId: "+t),null}static getTypeId(){return Math.trunc(_id/1e6)}static getCategory(){return Math.trunc(_id/1e4)}static isItem(t){return 0!=Math.trunc(t/1e6)}static isEquip(t){if(null==t||""==t)return null;let e=Number(t),i=Math.trunc(e/1e4);return i>180&&i<2e3&&console.warn("?? equip: "+t),1==Math.trunc(e/1e6)}static getSubCategory(t){return Math.trunc(t/1e4)}static isCashWeapon(t){return 170==Math.trunc(t/1e4)}static getJobWeaponCategory(t){console.warn("getJobWeaponCategory: 未完成")}}a.type={Equip:"Equip",Consume:"Consume",Etc:"Etc",Install:"Install",Cash:"Cash"},a.typeName={0:"Equip",1:"Consume",2:"Etc",3:"Install",4:"Cash"},a.typeId={Equip:0,Consume:1,Etc:2,Install:3,Cash:4},a._info={"0000":new a("0000","","body","body","<body>"),"0001":new a("0001","","head","head","<head>"),"0002":new a("0002","Face","Face","face","臉型"),"0003":new a("0003","Hair","Hair","hair","髮型"),"0004":new a("0004","Hair","Hair","hair","髮型"),"0100":new a("0100","Cap","Cap","cap","帽子"),"0101":new a("0101","Accessory","accessoryFace","accessoryFace","臉飾"),"0102":new a("0102","Accessory","accessoryEyes","accessoryEyes","眼飾"),"0103":new a("0103","Accessory","accessoryEars","accessoryEars","耳環"),"0104":new a("0104","Coat","Coat","coat","上衣"),"0105":new a("0105","Longcoat","Longcoat","longcoat","套服"),"0106":new a("0106","Pants","Pants","pants","褲子"),"0107":new a("0107","Shoes","Shoes","shoes","鞋子"),"0108":new a("0108","Glove","Glove","glove","手套"),"0109":new a("0109","Shield","Shield","shield","盾牌"),"0110":new a("0110","Cape","Cape","cape","披風"),"0121":new a("0121","Weapon","閃亮克魯","weapon","閃亮克魯"),"0122":new a("0122","Weapon","靈魂射手","weapon","靈魂射手"),"0123":new a("0123","Weapon","魔劍","weapon","魔劍"),"0124":new a("0124","Weapon","能量劍","weapon","能量劍"),"0125":new a("0125","Weapon","幻獸棒","weapon","幻獸棒"),"0126":new a("0126","Weapon","ESP限制器","weapon","ESP限制器"),"0127":new a("0127","Weapon","鎖鏈","weapon","鎖鏈"),"0128":new a("0128","Weapon","魔力護腕","weapon","魔力護腕"),"0130":new a("0130","Weapon","單手劍","weapon","單手劍"),"0131":new a("0131","Weapon","單手斧","weapon","單手斧"),"0132":new a("0132","Weapon","單手錘","weapon","單手錘"),"0133":new a("0133","Weapon","短劍","weapon","短劍"),"0134":new a("0134","Weapon","雙刀","weapon","雙刀"),"013526":new a("013526","Weapon","靈魂之環","weapon","靈魂之環"),"013530":new a("013530","Weapon","控制器","weapon","控制器"),"0136":new a("0136","Weapon","手杖","weapon","手杖"),"0137":new a("0137","Weapon","短杖","weapon","短杖"),"0138":new a("0138","Weapon","長杖","weapon","長杖"),"0140":new a("0140","Weapon","雙手劍","weapon","雙手劍"),"0141":new a("0141","Weapon","雙手斧","weapon","雙手斧"),"0142":new a("0142","Weapon","雙手棍","weapon","雙手棍"),"0143":new a("0143","Weapon","槍","weapon","槍"),"0144":new a("0144","Weapon","矛","weapon","矛"),"0145":new a("0145","Weapon","弓","weapon","弓"),"0146":new a("0146","Weapon","弩","weapon","弩"),"0147":new a("0147","Weapon","拳套","weapon","拳套"),"0148":new a("0148","Weapon","指虎","weapon","指虎"),"0149":new a("0149","Weapon","火槍","weapon","火槍"),"0150":new a("0150","Weapon","鏟","weapon","鏟"),"0151":new a("0151","Weapon","鎬","weapon","鎬"),"0152":new a("0152","Weapon","雙弩槍","weapon","雙弩槍"),"0153":new a("0153","Weapon","加農砲","weapon","加農砲"),"0154":new a("0154","Weapon","太刀","weapon","太刀"),"0155":new a("0155","Weapon","扇子","weapon","扇子"),"0156":new a("0156","Weapon","琉","weapon","琉"),"0157":new a("0157","Weapon","璃","weapon","璃"),"0158":new a("0158","Weapon","重拳槍","weapon","重拳槍"),"0170":new a("0170","Weapon","0170","weapon","點裝武器")},a._categoryList=function(t){let e=[],i=new Set;for(let s in t){let r=t[s],a=r.categoryName||r.listPath;i.has(a)||(i.add(a),e.push({key:a,value:s}))}return e}(a._info);class n{static isEquipExist(t,e){const i=e.listPath,s=n.equip_map[i];return!s||s.has(t)}static async loadArchive(t){o(r,"/",JSON.parse(await n.get(t)))}static get(t){return new Promise(function(e,i){let r=new XMLHttpRequest;r.open("GET",t,!0),r.timeout=6e5,r.onload=function(){404==this.status||500==this.status?(s.push(t),i(this.status+": "+t)):200==this.status?e(this.responseText):this.status},r.ontimeout=function(e){i("timeout: "+t)},r.onabort=function(e){i("abort: "+t)},r.send()})}static get root_path(){return window.$ROOT_PATH}static get archive(){return r}static get failed_urls(){return s}}function o(t,e,i){e.endsWith("/")&&(e=e.slice(0,e.length-1));let s,r=e.split("/"),a=t,n=r.length-1;for(s=0;s<n;++s){let t=r[s];null==a[t]&&(a[t]={}),a=a[t]}let o=a[r[n]];if(o instanceof Promise)delete a[r[n]],a[r[n]]=i;else if(o&&"object"==typeof o)for(let t in i)o[t]=i[t]||o[t];else void 0!==i&&(a[r[n]]=i)}function h(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i,s=e.split("/"),r=t,a=s.length-1;for(i=0;i<a;++i){let t=s[i];if(!r[t])return;r=r[t]}return r[s[a]]}window.$ResourceManager=n;const l=Symbol("$pack"),c=RegExp.prototype.test.bind(/^(([a-zA-Z^\:]+)(\:.*)$|\/\/)/);function u(t,e,i){return c(t)?void 0:""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH)?(i&&(e[l]=!0),t=t.slice(window.$ROOT_PATH.length),o(r,t,e)):o(r,t,e)}function d(t,e){let i=_(t);if(i)return h(r,i)}function _(t){if(!c(t)&&""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH))return t.slice(window.$ROOT_PATH.length)}function f(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i=h(t,e);if(i)return i instanceof Promise?new Promise(async function(s,r){await i,s(await f(t,e))}):i;{let i,s=e.split("/"),r=t,a=s.length-1;for(i=0;i<a;++i){let a=s[i];if(r[a]instanceof Promise)return new Promise(async function(i,s){await r[a],i(await f(t,e))});if(!r[a])return;r=r[a]}let n=r[s[a]];return n instanceof Promise?new Promise(async function(i,s){await n,i(await f(t,e))}):n}}let p=function(t){return n.get(t)};p.pack=async function(t){let e,i=_(t);if(i&&(e=f(r,i)),e instanceof Promise)return await e;if(e&&e[l])return e;{0;const i=p.packUrl(t);let s=async function(){let s=await n.get(i);return e=JSON.parse(s),u(t,e,!0),e}();return u(t,s,!0),await s}},p.packSync=function(t){let e=d(t);if(e)return e},p.data=async function(t){let e,i=_(t);if(i&&(e=f(r,i)),e instanceof Promise)return await e;if(e)return e;{const i=p.dataUrl(t);let s=async function(){let s=await n.get(i);return e=JSON.parse(s),u(t,e,!1),e}();return u(t,s,!1),await s}},p.dataSync=function(t){let e=d(t);if(e)return e},p.list=async function(t){let e,i=_(t);if(i&&(e=f(r,i)),e instanceof Promise)return await e;if(e)return e;{const i=p.listUrl(t);let s=async function(){let s=await n.get(i);return e=JSON.parse(s),u(t,e,!1),e}();return u(t,s,!1),await s}},p.listSync=function(t){let e=d(t);if(e)return Object.keys(e)},p.dataUrl=function(t){if(c(t))return t;if(!t.startsWith("data"))return`${window.$ROOT_PATH}data${t}.json`;throw new Error("Not game data: "+t)},p.packUrl=function(t){if(c(t))return t;if(!t.startsWith("pack"))return`${window.$ROOT_PATH}pack${t}.json`;throw new Error("Not game pack: "+t)},p.listUrl=function(t){if(c(t))return t;if(!t.startsWith("ls"))return`${window.$ROOT_PATH}ls${t}.json`;throw new Error(t)},p.imageUrl=function(t){if(c(t))return t;if(!t.startsWith("images"))return`${window.$ROOT_PATH}images${t}.png`;throw new Error("Not game images: "+t)},p.soundMp3Url=function(t){if(c(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.mp3`;throw new Error("Not game sound: "+t)},p.soundWavUrl=function(t){if(c(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.wav`;throw new Error("Not game sound: "+t)},p.assetUrl=function(t){return`${window.$ROOT_PATH}${t}`},p.asset=function(t){return p(p.assetUrl(t))},window.$get=p;class g{static head(t){t.gender=2}static body(t){t.gender=2}static Face(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||4==e?1:0}static Hair(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||2==e||4==e||7==e?1:0}static Cap(t){g._equip(t)}static accessoryFace(t){g._equip(t)}static accessoryEyes(t){g._equip(t)}static accessoryEars(t){g._equip(t)}static Coat(t){g._equip(t)}static Longcoat(t){g._equip(t)}static Pants(t){g._equip(t)}static Shoes(t){g._equip(t)}static Glove(t){g._equip(t)}static Shield(t){g._equip(t)}static Cape(t){g._equip(t)}static _equip(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=0==e?0:1==e?1:2}}const m=/(\d{4,7})\d$/,w=/(\d{2,5})\d(\d{2})$/,y=/\d{4,7}(\d)$/,x=/\d{2,5}(\d)\d{2}$/;class E{static*enumHairColor(t){let e=t.match(m);for(let t=0;t<10;++t){yield e[1]+t}}static*enumFaceColor(t){let e=t.match(w);for(let t=0;t<10;++t){yield e[1]+t+e[2]}}static getColorHairID(t,e){return t.match(m)[1]+e%10}static getColorFaceID(t,e){let i=t.match(w);return i[1]+e%10+i[2]}static isHairStyleEqual(t,e){return E.getColorHairID(t,0)==E.getColorHairID(e,0)}static isFaceStyleEqual(t,e){return E.getColorFaceID(t,0)==E.getColorFaceID(e,0)}static getHairColor(t){if(t){let e=(t=String(t)).match(y);if(e)return e[1]}}static getFaceColor(t){if(t){let e=(t=String(t)).match(x);if(e)return e[1]}}}var b={Equip:{Hat:"Cap",Cape:"Cape",Top:"Coat",Overall:"Longcoat",Glove:"Glove",Bottom:"Pants",Shield:"Shield",Shoes:"Shoes","Eye Decoration":"accessoryEyes",Earrings:"accessoryEars","Face Accessory":"accessoryFace",Face:"Face",Hair:"Hair"}};n.external={equip:{}},n.equip_map={};for(let t in b.Equip){let e=b.Equip[t];n.external.equip[e]=[],n.equip_map[e]=null}for(let t=0;t<9;++t){let e="Face"+t;n.external.equip[e]=[],n.equip_map[e]=null}for(let t=0;t<8;++t){let e="Hair"+t;n.external.equip[e]=[],n.equip_map[e]=null}async function v(t){let e;t=t||"/items.json";try{if(!(e=n._external_raw=JSON.parse(await p.asset("equip.json"))))throw Error("'/equip' is empty")}catch(t){if(!(e=n._external_raw=JSON.parse(await p("//labs.maplestory.io/api/gms/latest/item/category/equip"))))return}for(let t=0;t<e.length;++t){const i=e[t],s=String(i.id).padStart(8,"0");try{if(!i.typeInfo||!b[i.typeInfo.overallCategory])continue;let t=i.typeInfo.overallCategory.toLowerCase(),e=b[i.typeInfo.overallCategory][i.typeInfo.subCategory];if(!e)continue;"Face"==e?e+=E.getFaceColor(s):"Hair"==e&&(e+=E.getHairColor(s));let r={id:s,name:i.name,desc:i.desc,cash:i.isCash?1:0,icon:{"":`//labs.maplestory.io/api/gms/latest/item/${i.id}/icon`}};n.external[t][e].push(r)}catch(t){console.error("external resource: id("+s+")"),console.error(t)}}}let $=v();async function T(t,e){await $,C(t,e),concat_external_resource=C}function C(t,e){try{const i=n.external.equip[t];if(!i)return;let s=n.equip_map[t];s||(s=new Map,e.forEach(t=>{s.set(t.id,t)}),n.equip_map[t]=s),i.forEach(t=>{let i=t.id;if(s.has(i)){let e=s.get(i);e._name=t.name||"",e._desc=t.desc||""}else t.$foreign=!0,e.push(t)})}catch(t){console.error(t)}}window.concat_external_resource=T,window.trigger_update_external_equip_list=function(){$=v(),window.concat_external_resource=T},window.load_extern_item_data=async function(t){let e=JSON.parse(await p(`//labs.maplestory.io/api/gms/latest/item/${t}`)),i={},s=e.frameBooks.default?e.frameBooks.default.frames[0]:null;for(let t in e.frameBooks){let r=e.frameBooks[t],a=[];for(let t=0;t<r.frames.length;++t){let e=r.frames[t]||s;if(!e||!e.effects)continue;let i=e.effects,n={};for(let t in i){let e=i[t];e.image&&(n[t]={"":"data:image/png;base64,"+e.image,origin:e.originOrZero||e.origin||e.center,map:e.mapOffset,z:e.position})}a[t]=n}i[t]=a}return i.info={islot:e.metaInfo.equip.islot,vslot:e.metaInfo.equip.vslot,icon:e.metaInfo.icon?"data:image/png;base64,"+e.metaInfo.icon.iconRaw:"",cash:e.metaInfo.cash&&e.metaInfo.cash.cash?1:0},i}},370:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var s=i(333);class r{constructor(){this.delay=0,this.move=null,this.action=0,this.frame=0}_load(t,e,i){this._raw=t,this.delay=t.delay,t.move?this.move=new s.Vec2(t.move.x,t.move.y):this.move=new s.Vec2(0,0),this.action=t.action||e,this.frame=t.frame||i}}class a{constructor(t){this.frames=null,this._action=null,this.time=0,this.frame=0,this.delay=0,this.loop=!1,this._is_end=!1}_load(t){this._action=t,this.frames=a.Adef[t]}reload(t){this.reset(),this._load(t)}reset(){this.time=0,this.frame=0,this._is_end=!1}update(t,e){if(!this.frames)return;const i=this.fdat;let s=0;i&&(this.time=this.time+t,i.delay<0&&(i.delay=-i.delay),i.delay>0?(s=i.delay,this.delay=0):(s=-i.delay,this.delay=s),this.time>s&&(this.frame=++this.frame,this.time=0),i.move?(e.tx=-i.move.x*e.front,e.ty=i.move.y):(e.tx=0,e.ty=0),this.isEnd()&&(e.tx=0,e.ty=0),e._action=i.action,e._action_frame=i.frame,this.frames&&null!=this.fdat?this.loop||(this._is_end=!1):this._is_end=!0,this.frames.length<=1&&(this._is_end=!0))}isEnd(){return this._is_end}getTotalTime(){return this.frames.reduce((t,e)=>t+e.delay,0)}get fdat(){return this.frames[this.frame]}static async Init(){let t=await $get.data(a._base_path),e=Object.assign({},t);delete e.info;for(let t in e){let i=e[t];e[t]=Object.values(i).map((e,i)=>{let s=new r;return s._load(e,t,i),s})}a.Adef=e,window.CharacterActionAnimationDefinition=e}static get _base_path(){return"/Character/00002000"}}a.Adef=null},373:function(t,e){window.DownloadData=function(){let t=document.createElement("a");return document.body.appendChild(t),t.style="display: none",t.target="_blank",function(e,i,s){let r=new Blob([e],{type:i||"octet/stream"}),a=window.URL.createObjectURL(r);s&&""!=s?(t.href=a,t.download=s,t.click()):window.open(a,"_blank"),window.URL.revokeObjectURL(a)}}(),window.SelectText=function(t){var e,i;document.body.createTextRange?((e=document.body.createTextRange()).moveToElementText(t),e.select()):window.getSelection&&(i=window.getSelection(),(e=document.createRange()).selectNodeContents(t),i.removeAllRanges(),i.addRange(e))},window.copyToClipboard=function(t){var e=$("<input>");$("body").append(e),e.val(t).select(),document.execCommand("copy"),e.remove()}}}]);
//# sourceMappingURL=14.js.map