(window.webpackJsonp=window.webpackJsonp||[]).push([[14,17],{333:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "AnimationBase", function() { return AnimationBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Animation", function() { return Animation; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(332);\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(331);\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(341);\n\ufeff\r\n\r\n\r\n\r\n\r\n\r\n\r\nwindow.m_draw_animation_texture_info = false;\r\n\r\nclass IAnimation {\r\n\tconstructor(raw, url) {\r\n\t\tthis._raw = null;\r\n\t\tthis._url = null;\r\n\t\t\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t_raw: {\r\n\t\t\t\tvalue: raw\r\n\t\t\t},\r\n\t\t\t_url: {\r\n\t\t\t\tvalue: url\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** elapsed time */\r\n\t\tthis.delta = 0;\r\n\r\n\t\t/** @type {Sprite[]} */\r\n\t\tthis.textures = [];\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_loop = true;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_end = false;\r\n\r\n\t\tif (!raw && !this._url) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.textures.reduce((pv, cv) => pv + cv.delay, 0);\r\n\t}\r\n\t\r\n\tclone() {\r\n\t\tlet newAnim = new this.constructor(this._raw, this._url);\r\n\t\tnewAnim.textures = this.textures;\r\n\t\treturn newAnim;\r\n\t}\r\n\t\r\n\tload() {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/** reset frame */\r\n\t_resetFrame() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t}\r\n\r\n\t/** restart */\r\n\treset() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t\tthis.is_end = false;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * remove at nextStep\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.is_loop = false;//防止重複\r\n\t\tthis.is_end = true;\r\n\t}\r\n}\r\n\r\n/**\r\n * process animation\r\n */\r\nclass AnimationBase extends IAnimation {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {!string} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t}\r\n\r\n\tload() {\r\n\t\tif (!this._raw) {\r\n\t\t\t//this._raw = await $get.data(this._url);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i in this._raw; ++i) {\r\n\t\t\t//let url = this._url + "/" + i;\r\n\r\n\t\t\tlet texture = new _Sprite_js__WEBPACK_IMPORTED_MODULE_2__[/* Sprite */ "a"](this._raw[i]);\r\n\r\n\t\t\t//texture._url = url;\r\n\r\n\t\t\tthis.textures[i] = texture;\r\n\t\t}\r\n\t\t\r\n\t\tif (this.textures[0]) {\r\n\t\t\tif (!this.textures[0].isLoaded()) {\r\n\t\t\t\tthis.textures[0].__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tisEnd() {\r\n\t\treturn this.is_end;\r\n\t}\r\n\r\n\t/**\r\n\t * aways loop\r\n\t * @param {number} stamp\r\n\t */\r\n\t_update(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = ++this.frame % fc;\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t\t//this.frame = Math.trunc(this.time / 1000) % fc;\r\n\t\t}\r\n\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = this.frame + 1;\r\n\t\t\t\tif (this.frame >= fc) {\r\n\t\t\t\t\tif (this.is_loop) {\r\n\t\t\t\t\t\tthis.reset();//make loop\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t//防止錯誤\r\n\t\t\t\t\t\tthis.frame = fc - 1;//this._resetFrame();\r\n\r\n\t\t\t\t\t\tthis.is_end = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw(renderer, x, y, angle, flip) {\r\n\t\tlet texture = this.texture;\r\n\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this.textures[this.frame];\r\n\t}\r\n}\r\n\r\n/**\r\n * animation rendering\r\n */\r\nclass Animation extends AnimationBase {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\tthis.draw = this._draw_and_preload;\r\n\t}\r\n\r\n\t/**\r\n\t * draw and load next frame\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\t_draw_and_preload(renderer, x, y, angle, flip) {\r\n\t\tlet frame;\r\n\r\n\t\t// if current frame is not loaded then render prev frame\r\n\t\tfor (frame = this.frame; frame >= 0; --frame) {\r\n\t\t\tlet texture = this.textures[frame];\r\n\r\n\t\t\tif (texture.isLoaded()) {\r\n\t\t\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//preload next frame\r\n\t\tlet texture = this.textures[++frame];\r\n\t\tif (texture) {//if frame < this.textures.length\r\n\t\t\tif (!texture.isLoaded()) {\r\n\t\t\t\ttexture.__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {//if all testure are loaded\r\n\t\t\tdelete this.draw;\r\n\t\t}\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzMzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvQW5pbWF0aW9uLmpzP2E0ZDUiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IFZlYzIgfSBmcm9tIFwiLi9tYXRoLmpzXCI7XHJcbmltcG9ydCB7IElHcmFwaCwgSVJlbmRlcmVyIH0gZnJvbSBcIi4vSVJlbmRlcmVyLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBTcHJpdGUgfSBmcm9tIFwiLi9TcHJpdGUuanNcIjtcclxuXHJcblxyXG53aW5kb3cubV9kcmF3X2FuaW1hdGlvbl90ZXh0dXJlX2luZm8gPSBmYWxzZTtcclxuXHJcbmNsYXNzIElBbmltYXRpb24ge1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHR0aGlzLl9yYXcgPSBudWxsO1xyXG5cdFx0dGhpcy5fdXJsID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xyXG5cdFx0XHRfcmF3OiB7XHJcblx0XHRcdFx0dmFsdWU6IHJhd1xyXG5cdFx0XHR9LFxyXG5cdFx0XHRfdXJsOiB7XHJcblx0XHRcdFx0dmFsdWU6IHVybFxyXG5cdFx0XHR9LFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5mcmFtZSA9IDA7XHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cclxuXHRcdC8qKiBlbGFwc2VkIHRpbWUgKi9cclxuXHRcdHRoaXMuZGVsdGEgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7U3ByaXRlW119ICovXHJcblx0XHR0aGlzLnRleHR1cmVzID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuaXNfbG9vcCA9IHRydWU7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuaXNfZW5kID0gZmFsc2U7XHJcblxyXG5cdFx0aWYgKCFyYXcgJiYgIXRoaXMuX3VybCkge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldFRvdGFsVGltZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLnRleHR1cmVzLnJlZHVjZSgocHYsIGN2KSA9PiBwdiArIGN2LmRlbGF5LCAwKTtcclxuXHR9XHJcblx0XHJcblx0Y2xvbmUoKSB7XHJcblx0XHRsZXQgbmV3QW5pbSA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKHRoaXMuX3JhdywgdGhpcy5fdXJsKTtcclxuXHRcdG5ld0FuaW0udGV4dHVyZXMgPSB0aGlzLnRleHR1cmVzO1xyXG5cdFx0cmV0dXJuIG5ld0FuaW07XHJcblx0fVxyXG5cdFxyXG5cdGxvYWQoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKiogcmVzZXQgZnJhbWUgKi9cclxuXHRfcmVzZXRGcmFtZSgpIHtcclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHR9XHJcblxyXG5cdC8qKiByZXN0YXJ0ICovXHJcblx0cmVzZXQoKSB7XHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHR0aGlzLmlzX2VuZCA9IGZhbHNlO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgdGV4dHVyZSgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiByZW1vdmUgYXQgbmV4dFN0ZXBcclxuXHQgKi9cclxuXHRkZXN0cm95KCkge1xyXG5cdFx0dGhpcy5pc19sb29wID0gZmFsc2U7Ly/pmLLmraLph43opIdcclxuXHRcdHRoaXMuaXNfZW5kID0gdHJ1ZTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBwcm9jZXNzIGFuaW1hdGlvblxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFuaW1hdGlvbkJhc2UgZXh0ZW5kcyBJQW5pbWF0aW9uIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0geyFhbnl9IHJhd1xyXG5cdCAqIEBwYXJhbSB7IXN0cmluZ30gdXJsXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocmF3LCB1cmwpIHtcclxuXHRcdHN1cGVyKHJhdywgdXJsKTtcclxuXHR9XHJcblxyXG5cdGxvYWQoKSB7XHJcblx0XHRpZiAoIXRoaXMuX3Jhdykge1xyXG5cdFx0XHQvL3RoaXMuX3JhdyA9IGF3YWl0ICRnZXQuZGF0YSh0aGlzLl91cmwpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIGluIHRoaXMuX3JhdzsgKytpKSB7XHJcblx0XHRcdC8vbGV0IHVybCA9IHRoaXMuX3VybCArIFwiL1wiICsgaTtcclxuXHJcblx0XHRcdGxldCB0ZXh0dXJlID0gbmV3IFNwcml0ZSh0aGlzLl9yYXdbaV0pO1xyXG5cclxuXHRcdFx0Ly90ZXh0dXJlLl91cmwgPSB1cmw7XHJcblxyXG5cdFx0XHR0aGlzLnRleHR1cmVzW2ldID0gdGV4dHVyZTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMudGV4dHVyZXNbMF0pIHtcclxuXHRcdFx0aWYgKCF0aGlzLnRleHR1cmVzWzBdLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0XHR0aGlzLnRleHR1cmVzWzBdLl9fbG9hZFRleHR1cmUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRpc0VuZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmlzX2VuZDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGF3YXlzIGxvb3BcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHRfdXBkYXRlKHN0YW1wKSB7XHJcblx0XHRjb25zdCBmYyA9IHRoaXMudGV4dHVyZXMubGVuZ3RoO1xyXG5cclxuXHRcdGlmIChmYyA+IDApIHsvLz8/XHJcblx0XHRcdHRoaXMudGltZSA9IHRoaXMudGltZSArIHN0YW1wO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMudGltZSA+IHRoaXMudGV4dHVyZS5kZWxheSkge1xyXG5cdFx0XHRcdHRoaXMuZnJhbWUgPSArK3RoaXMuZnJhbWUgJSBmYztcclxuXHRcdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8vdGhpcy5mcmFtZSA9IE1hdGgudHJ1bmModGhpcy50aW1lIC8gMTAwMCkgJSBmYztcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmRlbHRhICs9IHN0YW1wO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGNvbnN0IGZjID0gdGhpcy50ZXh0dXJlcy5sZW5ndGg7XHJcblxyXG5cdFx0aWYgKGZjID4gMCkgey8vPz9cclxuXHRcdFx0dGhpcy50aW1lID0gdGhpcy50aW1lICsgc3RhbXA7XHJcblxyXG5cdFx0XHRpZiAodGhpcy50aW1lID4gdGhpcy50ZXh0dXJlLmRlbGF5KSB7XHJcblx0XHRcdFx0dGhpcy5mcmFtZSA9IHRoaXMuZnJhbWUgKyAxO1xyXG5cdFx0XHRcdGlmICh0aGlzLmZyYW1lID49IGZjKSB7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5pc19sb29wKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMucmVzZXQoKTsvL21ha2UgbG9vcFxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdC8v6Ziy5q2i6Yyv6KqkXHJcblx0XHRcdFx0XHRcdHRoaXMuZnJhbWUgPSBmYyAtIDE7Ly90aGlzLl9yZXNldEZyYW1lKCk7XHJcblxyXG5cdFx0XHRcdFx0XHR0aGlzLmlzX2VuZCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0aGlzLmRlbHRhICs9IHN0YW1wO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyIC0gR3JhcGhMYXllclJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIsIHgsIHksIGFuZ2xlLCBmbGlwKSB7XHJcblx0XHRsZXQgdGV4dHVyZSA9IHRoaXMudGV4dHVyZTtcclxuXHRcdHJlbmRlcmVyLmRyYXdSb3RhR3JhcGgodGV4dHVyZSwgeCwgeSwgYW5nbGUsIGZsaXApO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgdGV4dHVyZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLnRleHR1cmVzW3RoaXMuZnJhbWVdO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIGFuaW1hdGlvbiByZW5kZXJpbmdcclxuICovXHJcbmV4cG9ydCBjbGFzcyBBbmltYXRpb24gZXh0ZW5kcyBBbmltYXRpb25CYXNlIHtcclxuXHRjb25zdHJ1Y3RvcihyYXcsIHVybCkge1xyXG5cdFx0c3VwZXIocmF3LCB1cmwpO1xyXG5cclxuXHRcdHRoaXMuZHJhdyA9IHRoaXMuX2RyYXdfYW5kX3ByZWxvYWQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBkcmF3IGFuZCBsb2FkIG5leHQgZnJhbWVcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXIgLSBHcmFwaExheWVyUmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICovXHJcblx0X2RyYXdfYW5kX3ByZWxvYWQocmVuZGVyZXIsIHgsIHksIGFuZ2xlLCBmbGlwKSB7XHJcblx0XHRsZXQgZnJhbWU7XHJcblxyXG5cdFx0Ly8gaWYgY3VycmVudCBmcmFtZSBpcyBub3QgbG9hZGVkIHRoZW4gcmVuZGVyIHByZXYgZnJhbWVcclxuXHRcdGZvciAoZnJhbWUgPSB0aGlzLmZyYW1lOyBmcmFtZSA+PSAwOyAtLWZyYW1lKSB7XHJcblx0XHRcdGxldCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1tmcmFtZV07XHJcblxyXG5cdFx0XHRpZiAodGV4dHVyZS5pc0xvYWRlZCgpKSB7XHJcblx0XHRcdFx0cmVuZGVyZXIuZHJhd1JvdGFHcmFwaCh0ZXh0dXJlLCB4LCB5LCBhbmdsZSwgZmxpcCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvL3ByZWxvYWQgbmV4dCBmcmFtZVxyXG5cdFx0bGV0IHRleHR1cmUgPSB0aGlzLnRleHR1cmVzWysrZnJhbWVdO1xyXG5cdFx0aWYgKHRleHR1cmUpIHsvL2lmIGZyYW1lIDwgdGhpcy50ZXh0dXJlcy5sZW5ndGhcclxuXHRcdFx0aWYgKCF0ZXh0dXJlLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0XHR0ZXh0dXJlLl9fbG9hZFRleHR1cmUoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7Ly9pZiBhbGwgdGVzdHVyZSBhcmUgbG9hZGVkXHJcblx0XHRcdGRlbGV0ZSB0aGlzLmRyYXc7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///333\n')},335:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CharacterAnimationBase", function() { return CharacterAnimationBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "CharacterRenderer", function() { return CharacterRenderer; });\n/* harmony import */ var _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(345);\n/* harmony import */ var _init_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(358);\n/* harmony import */ var _Animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(333);\n/* harmony import */ var _Engine_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(334);\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(331);\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(341);\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(332);\n/* harmony import */ var _CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(364);\n\ufeff\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet zMap = {};\r\nlet sMap = {};\r\n\r\n\r\n/**\r\n * 00026623.blink[1].brow has bug\r\n * \'Weapon/01702694\' is Longcoat(islot)\r\n * how to use cash-weapon (ex: 01702504|0152)\r\n */\r\n\r\n/**\r\n * multi-image-sprite\r\n */\r\nclass FragmentTexture extends _Sprite_js__WEBPACK_IMPORTED_MODULE_5__[/* SpriteBase */ "b"] {\r\n\t/**\r\n\t * @param {wzproperty} raw\r\n\t * @param {string} full_path\r\n\t */\r\n\tconstructor(raw, full_path) {\r\n\t\tsuper(raw, full_path);\r\n\r\n\t\tif (this._raw.origin) {\r\n\t\t\tthis._raw.origin.__proto__ = _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].prototype;\r\n\t\t}\r\n\r\n\t\tfor (let i in this._raw.map) {\r\n\t\t\tthis._raw.map[i].__proto__ = _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].prototype;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * if this.relative == null then remove this\r\n\t\t * @type {Vec2}\r\n\t\t */\r\n\t\tthis.relative = new _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"](0, 0);\r\n\t\t\r\n\t\tthis.calcRelative = this._calcRelative;//this._getRelativeFunction();//this.__old_calcRelative;//\r\n\r\n\t\tthis.filter = new _IRenderer_js__WEBPACK_IMPORTED_MODULE_4__["ImageFilter"]();\r\n\t\tthis.opacity = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.visible = true;\r\n\r\n\r\n\t\t/** @type {string} - extra property. */\r\n\t\tthis._slot = null;\r\n\r\n\t\t/** @type {string} - extra property. 在哪個部位 */\r\n\t\tthis._place = null;\r\n\r\n\t\t/** @type {string} - extra property: _slot itemId, _place, _raw.z z */\r\n\t\tthis.classList = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget z() {\r\n\t\treturn zMap[this._raw.z] || 1;\r\n\t}\r\n\tset z(not_value) {\r\n\t\tconsole.error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget order() {\r\n\t\tdebugger;\r\n\t\treturn this.z;\r\n\t}\r\n\tset order(not_value) {\r\n\t\tdebugger;\r\n\t\tconsole.error(new TypeError("Not implement"));\r\n\t}\r\n\r\n\t/** @returns {Vec2} */\r\n\tget origin() { return this._raw.origin || _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].empty; }\r\n\r\n\tisHasAnchor() { return !!this._raw.map; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget brow() { return this._raw.map.brow; }\r\n\tisAnchorBrow() { return !!this._raw.map.brow; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget neck() { return this._raw.map.neck; }\r\n\tisAnchorNeck() { return !!this._raw.map.neck; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget navel() { return this._raw.map.navel; }\r\n\tisAnchorNavel() { return !!this._raw.map.navel; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget hand() { return this._raw.map.hand; }\r\n\tisAnchorHand() { return !!this._raw.map.hand; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget handMove() { return this._raw.map.handMove; }\r\n\tisAnchorHandMove() { return !!this._raw.map.handMove; }\r\n\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earBelowHead() { return this._raw.map.earBelowHead; }\r\n\tisAnchor_EarBelowHead() { return !!this._raw.map.earBelowHead; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earOverHead() { return this._raw.map.earOverHead; }\r\n\tisAnchor_EarOverHead() { return !!this._raw.map.earOverHead; }\r\n\r\n\t/**\r\n\t * @param {FragmentTexture} that - this\r\n\t * @param {FragmentTexture} base - parent\r\n\t * @param {string} anchor - anchor name\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_anchor(that, base, anchor) {\r\n\t\treturn base[anchor].minus(that[anchor]).plus(base.origin.minus(that.origin));\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative(chara, body, head) {\r\n\t\tthis.calcRelative = this._getRelativeFunction(chara);\r\n\t\treturn this.calcRelative(chara, body, head);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getRelativeFunction(chara) {\r\n\t\tif (!this.isHasAnchor()) {\r\n\t\t\treturn this._calcRelativeEmpty;\r\n\t\t}\r\n\t\tif (this.isAnchorNeck()) {\r\n\t\t\treturn this._calcRelative_neck;\r\n\t\t}\r\n\t\tif (this.isAnchorBrow()) {\r\n\t\t\treturn this._calcRelative_brow;\r\n\t\t}\r\n\t\tif (this.isAnchorNavel()) {\r\n\t\t\tif (this == chara.slots.body) {\r\n\t\t\t\treturn this._getOrigin;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_navel;\r\n\t\t}\r\n\t\tif (this.isAnchorHand()) {\r\n\t\t\treturn this._calcRelative_hand;\r\n\t\t}\r\n\t\tif (this.isAnchorHandMove()) {\r\n\t\t\tif (this._url.lastIndexOf("lHand") > 0) {\r\n\t\t\t\treturn this._calcRelative_handMove_lHand;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_handMove;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelativeEmpty(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].empty;\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getOrigin(chara, body, head) {\r\n\t\treturn this.origin;\r\n\t}\r\n\t/**\r\n\t * neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_neck(chara, body, head) {\r\n\t\treturn this._anchor(this, body, "neck").minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * brow on the head & head on the neck & neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_brow(chara, body, head) {\r\n\t\treturn this._anchor(this, head, "brow").plus(this._anchor(head, body, "neck")).minus(body.origin);//anchor_brow+(-7,-33)\r\n\t}\r\n\t/**\r\n\t * this is origin point, no anchor\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_navel(chara, body, head) {\r\n\t\treturn body.navel.minus(this.navel).minus(this.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_hand(chara, body, head) {\r\n\t\tconst hand = chara.slots.body.fragments.arm.getTexture(chara);\r\n\t\tif (hand == null) {\r\n\t\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].empty.minus(this.hand).minus(this.origin).minus(body.origin);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this._anchor(this, hand, "hand").minus(this._anchor(body, hand, "navel")).minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].empty.minus(this.origin).minus(this.handMove);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove_lHand(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__["Vec2"].empty.minus(this.origin);\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!(this.relative && this.visible)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t\trenderer.ctx.filter = "none";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass BodyFragmentTexture extends FragmentTexture {\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tsuper.update(chara);\r\n\t\tthis.visible = !chara.hideBody;\r\n\t}\r\n}\r\n\r\nclass HairFragmentTexture extends FragmentTexture {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph2 = null;\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph3 = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.graph2) {\r\n\t\t\t\t\tthis.graph2.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.graph3) {\r\n\t\t\t\t\tthis.graph3.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!this.relative) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trenderer.globalAlpha = this.opacity || 1;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\tthis._render(renderer);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\tthis._render(renderer);\r\n\t\t\trenderer.ctx.filter = "none";\r\n\t\t}\r\n\t}\r\n\t_render(renderer) {\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.drawGraph2(this, x, y);\r\n\r\n\t\tif (this.graph2 && this.graph2.opacity) {//color2\r\n\t\t\trenderer.globalAlpha = this.graph2.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph2, x, y);\r\n\t\t}\r\n\t\tif (this.graph3 && this.graph3.opacity) {//color3\r\n\t\t\trenderer.globalAlpha = this.graph3.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph3, x, y);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass ItemEffectAnimation extends _Animation__WEBPACK_IMPORTED_MODULE_2__["Animation"] {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t\t\r\n\t\tObject.defineProperty(this, "_raw", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\t//this._url = this._url;\r\n\r\n\t\tthis.__getAttr("z", -1);\r\n\t\tthis.__getAttr("pos", 1);\r\n\r\n\t\tsuper.load();\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {boolean} actionExceptRotation\r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\trender(renderer, actionExceptRotation, angle, flip) {\r\n\t\tif (actionExceptRotation) {\r\n\t\t\tthis.draw(renderer, 0, 0, -angle, flip);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst oy = -this.texture.height * 0.25;\r\n\t\t\tthis.draw(renderer, 0, oy, 0, flip);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//\t/data/Effect/ItemEff/1102918\r\nclass ItemEffect {\r\n\tconstructor() {\r\n\t\tthis._url = null;\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {{[animationName:string]:ItemEffectAnimation}} */\r\n\t\tthis.animation = {};\r\n\r\n\t\tthis.action = null;\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\r\n\t\tthis.fixed = 0;\r\n\t\tthis.z = -2;\r\n\t\tthis.action = 1;\r\n\t\tthis.actionExceptRotation = 0;\r\n\t\t\r\n\t\tthis.enable = true;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\ttry {\r\n\t\t\t/** @type {Set<string>} */\r\n\t\t\tlet itemEffectList = ItemEffect._list;\r\n\r\n\t\t\t/** @type {string[]} */\r\n\t\t\tlet raw = await $get.list("/Effect/ItemEff");\r\n\r\n\t\t\titemEffectList.clear();\r\n\r\n\t\t\traw.forEach(id => {\r\n\t\t\t\titemEffectList.add(parseInt(id, 10));\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<ItemEffect>}\r\n\t */\r\n\tstatic async load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\r\n\t\tif (ItemEffect._list.has(id)) {\r\n\t\t\tlet eff = new ItemEffect();\r\n\t\t\tawait eff.load(equipID);\r\n\t\t\treturn eff;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tasync load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\t\tconst url = `/Effect/ItemEff/${id}/effect`;\r\n\t\tlet raw;\r\n\r\n\t\ttry {\r\n\t\t\traw = await $get.data(url);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\tif (raw) {\r\n\t\t\treturn this._load(equipID, url, raw);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t * @param {string} action\r\n\t */\r\n\tupdate(stamp, action) {\r\n\t\tif (action in this.animation) {\r\n\t\t\tthis.action = action;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.action = "default";\r\n\t\t}\r\n\r\n\t\tif (this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterRenderer} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (this.animation && this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].render(renderer, this.actionExceptRotation, chara.angle, chara.front > 0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} equipID\r\n\t * @param {object} raw_data\r\n\t */\r\n\t_load(equipID, url, raw) {\r\n\t\tthis.id = equipID;\r\n\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, "_raw", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__construct();\r\n\t}\r\n\t__construct() {\r\n\t\tthis.__getAttr("fixed", 0);\r\n\t\tthis.__getAttr("z", -1);\r\n\t\tthis.__getAttr("action", 1);\r\n\t\tthis.__getAttr("actionExceptRotation", 0);\r\n\r\n\t\tfor (let i in this._raw) {\r\n\t\t\tif (this._raw[i] && typeof this._raw[i] == "object" && \'0\' in this._raw[i]) {//animation has frames\r\n\t\t\t\tthis.animation[i] = new ItemEffectAnimation(this._raw[i], [this._url, i].join("/"));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n}\r\n/** @type {Set<string>} */\r\nItemEffect._list = new Set();\r\n\r\nclass CharacterFragmentBase {\r\n\t/**\r\n\t * @param {{[action:string]: FragmentTexture[]}} textures\r\n\t */\r\n\tconstructor(textures) {\r\n\t\t/** @type {{[action:string]: FragmentTexture[]}} - textures[action:string][frame:number] */\r\n\t\tthis.textures = textures;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterBodyFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.action_frame);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.action]) {\r\n\t\t\treturn this.textures[chara.action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterFaceFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.emotion_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.emotion in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.emotion][frame];\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.emotion]) {\r\n\t\t\treturn this.textures[chara.emotion].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterTamingMobFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara._action_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara._ride_action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara._ride_action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara._ride_action]) {\r\n\t\t\treturn this.textures[chara._ride_action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\nclass EquipImageFilter {\r\n\t/**\r\n\t * @param {CharacterAppearanceBase} equip\r\n\t */\r\n\tconstructor(equip) {\r\n\t\tthis.equip = equip;\r\n\t}\r\n\r\n\tget hue() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.hue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset hue(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget sat() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.sat;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset sat(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.sat = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget bri() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset bri(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.bri = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget contrast() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.contrast;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset contrast(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.contrast = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\thue: this.hue,\r\n\t\t\tsat: this.sat,\r\n\t\t\tbri: this.bri,\r\n\t\t\tcontrast: this.contrast,\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * @interface\r\n */\r\nclass ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tisLoaded() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\t_unload() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\ttoJSON() {\r\n\t\tthrow new Error("Not implement");\r\n\t\treturn {\r\n\t\t\tid: -1,//invalid ID\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * ??\r\n */\r\nclass _CharacterAppearanceBaseSlotLink extends ICharacterAppearanceBase {\r\n\tconstructor(slot_link) {\r\n\t\tsuper();\r\n\t\tthis.slot_link = slot_link;//??\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: slot_link,//??\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * character loader\r\n */\r\nclass CharacterAppearanceBase extends ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\t\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\t//this._url = null;\r\n\t\t\t\r\n\t\t/** @type {ItemEffect} */\r\n\t\tthis.effect = null;\r\n\r\n\t\t/**\r\n\t\t * @type {{[place:string]:CharacterFragmentBase}}\r\n\t\t */\r\n\t\tthis.fragments = null;\r\n\r\n\t\tthis._onload = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tthis.categoryInfo = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.slot_order = 0;\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.islot = {};\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.vslot = {};\r\n\r\n\t\tthis.filter = new EquipImageFilter(this);\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: this.id,\r\n\t\t\tfilter: this.filter.toJSON(),\r\n\t\t};\r\n\t}\r\n\r\n\tisLoaded() {\r\n\t\treturn this.fragments != null;\r\n\t}\r\n\r\n\t/** @type {function(CharacterAppearanceBase):void} */\r\n\tget _onload() {\r\n\t\treturn this.__onload;\r\n\t}\r\n\tset _onload(func) {\r\n\t\tthis.__onload = func;\r\n\t\tif (this.isLoaded()) {\r\n\t\t\tthis.__onload.call(this, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {void} use_category - no use\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tlet raw;\r\n\r\n\t\tthis.id = id;\r\n\t\tthis.categoryInfo = cateInfo;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ResourceManager */ "d"].isEquipExist(id, cateInfo)) {\r\n\t\t\t\traw = await _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].getItem(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (!raw && load_extern_item_data) {\r\n\t\t\t\traw = await load_extern_item_data(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, "_raw", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__load_slot();\r\n\r\n\t\tthis.__load_fragments();\r\n\r\n\t\tif (this._onload) {\r\n\t\t\tthis._onload.call(this, this);\r\n\t\t}\r\n\r\n\t\t//// if not body, head, face, hair then try load effect\r\n\t\t//if (id >= "00050000") {\r\n\t\t\t// load if exist\r\n\t\t\tItemEffect.load(this.id).then(a => this.effect = a);//01102918\t//01102915\r\n\t\t//}\r\n\r\n\t\treturn true;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tconst FragmentConstructor = this.FragmentConstructor;\r\n\r\n\t\t//Object.keys(this._raw_textures).map(k => { return \'0\' in this._raw_textures[k]; })\r\n\r\n\t\tlet action_list = Object.keys(this._raw_textures);\r\n\r\n\t\tlet textures = {};\r\n\t\tfor (let action of action_list) {\r\n\t\t\tif (typeof this._raw_textures[action] == "object" && "0" in this._raw_textures[action]) {\r\n\t\t\t\tlet _url = this._base_path + action;\r\n\r\n\t\t\t\ttextures[action] = this.__load_frame_textures(this._raw_textures[action], _url);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragment_textures = {};\r\n\t\tfor (let action in textures) {\r\n\t\t\tfor (let frame in textures[action]) {\r\n\t\t\t\tfor (let place in textures[action][frame]) {\r\n\t\t\t\t\tif (!(place in fragment_textures)) {\r\n\t\t\t\t\t\tfragment_textures[place] = {};\r\n\t\t\t\t\t\t//fragment_textures[place].visible = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!(action in fragment_textures[place])) {\r\n\t\t\t\t\t\tfragment_textures[place][action] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfragment_textures[place][action][frame] = textures[action][frame][place];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragments = {};\r\n\t\tfor (let frag in fragment_textures) {\r\n\t\t\tfragments[frag] = new FragmentConstructor(fragment_textures[frag]);\r\n\t\t}\r\n\t\tthis.fragments = fragments;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}[]} - array - textures[frame][place]\r\n\t */\r\n\t__load_frame_textures(_raw, _url) {\r\n\t\tlet textures = [];\r\n\t\tfor (let frame = 0; frame in _raw; ++frame) {\r\n\t\t\tlet url = `${_url}/${frame}`;\r\n\t\t\ttextures[frame] = this.__load_place_textures(_raw[frame], url);\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}} - object - textures[place]\r\n\t */\r\n\t__load_place_textures(_raw, _url) {\r\n\t\tlet textures = {};\r\n\t\tfor (let place in _raw) {\r\n\t\t\tlet path = `${_url}/${place}`;\r\n\t\t\tlet raw = _raw[place];\r\n\r\n\t\t\tif (raw) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tconst FragmentTextureConstructor = this.FragmentTextureConstructor;\r\n\t\t\t\tlet ft;\r\n\t\t\t\tif (raw[""] == "") {\r\n\t\t\t\t\tft._url = path;\r\n\t\t\t\t\t//ft._url = path;\r\n\t\t\t\t\ttextures[place] = ft\r\n\t\t\t\t}\r\n\t\t\t\telse if (typeof raw[""] == \'string\') {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw);\r\n\t\t\t\t\t//ft._url = raw[""];\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\telse if (place == "hairShade") {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw[0]);\r\n\t\t\t\t\t//ft._url = path + "/0";\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tft._slot = this.categoryInfo.slot;\r\n\t\t\t\t\tft._place = place;\r\n\r\n\t\t\t\t\tft.classList = [\r\n\t\t\t\t\t\tft._slot,\r\n\t\t\t\t\t\t"item" + this.id,\r\n\t\t\t\t\t\tft._place,\r\n\t\t\t\t\t\tft._raw.z,\r\n\t\t\t\t\t\t\'z\' + ft.z\r\n\t\t\t\t\t].join(\' \');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t__load_slot() {\r\n\t\tif (!this._raw.info.islot) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet islots = this._raw.info.islot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in islots) {\r\n\t\t\tconst slot = islots[i];\r\n\t\t\tconst slot_order = zMap[slot];\r\n\t\t\tthis.islot[slot] = slot_order;\r\n\t\t\t\t\r\n\t\t\tif (slot_order > this.slot_order) {//this.slot_order = Math.max(this.slot_order, slot_order);\r\n\t\t\t\tthis.slot_order = slot_order;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet vslots = this._raw.info.vslot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in vslots) {\r\n\t\t\tconst slot = vslots[i];\r\n\t\t\tthis.vslot[slot] = slot;\r\n\t\t}\r\n\t}\r\n\r\n\t_unload() {\r\n\t\tthis.fragments = null;\r\n\t\tthis.effect == null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget opacity() {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} opacity\r\n\t */\r\n\tset opacity(opacity) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.opacity = opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} hue 0 ~ 360\r\n\t * @param {number} sat 0 ~ 100\r\n\t * @param {number} bri 0 ~ 100\r\n\t */\r\n\tsetFilter(hue, sat, bri) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = hue;\r\n\t\t\t\t\t\tft.filter.sat = sat;\r\n\t\t\t\t\t\tft.filter.bri = bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get icon url\r\n\t * @see {@link ItemCategoryInfo.getIconUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconUrl() {\r\n\t\tconst icon = this._raw.info.icon;\r\n\t\tif (icon) {\r\n\t\t\treturn icon[""];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].getIconUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get iconRaw url\r\n\t * @see {@link ItemCategoryInfo.getIconRawUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconRawUrl() {\r\n\t\tconst iconRaw = this._raw.info.iconRaw;\r\n\t\tif (iconRaw) {\r\n\t\t\treturn iconRaw[""];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].getIconRawUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @type {string}\r\n\t */\r\n\tget _animation_type() {\r\n\t\tthrow new Error("Not Implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof CharacterFragmentBase}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\tthrow new Error("Not implement");\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {{[actions:string]:{["0"]:Sprite,[frames:string]:Sprite}}} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw;\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url;\r\n\t}\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nclass CharacterAppearance extends CharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == "face" || k == "delay" || k == "default"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara.action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.action][chara.action_frame].delay;\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n}\r\n\r\nclass CharacterBody extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquip extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquipCashWeapon extends CharacterEquip {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.use_category = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {string} use_category - cash-weapon as [category]\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tif (!use_category && use_category != "") {\r\n\t\t\tthrow new TypeError("use_category");\r\n\t\t}\r\n\r\n\t\tthis.use_category = use_category.slice(2, 4);\r\n\r\n\t\treturn super.load(url, id, cateInfo);\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {object} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw[this.use_category];\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url + this.use_category;\r\n\t}\r\n}\r\n\r\n\r\nclass CharacterHeadBase extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterHead extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.elfEarFragment = null;\r\n\t\tthis.lefEarFragment = null;\r\n\t\tthis.highlefEarFragment = null;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tsuper.__load_fragments()\r\n\t\t\r\n\t\tif (this.fragments) {\r\n\t\t\tif (this.fragments.ear) {\r\n\t\t\t\tthis.elfEarFragment = this.fragments.ear;\r\n\t\t\t\tdelete this.fragments.ear;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.lefEar) {\r\n\t\t\t\tthis.lefEarFragment = this.fragments.lefEar;\r\n\t\t\t\tdelete this.fragments.lefEar;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.highlefEar) {\r\n\t\t\t\tthis.highlefEarFragment = this.fragments.highlefEar;\r\n\t\t\t\tdelete this.fragments.highlefEar;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget elfEar() {\r\n\t\treturn this.fragments.ear != null;\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (!this.elfEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.ear = this.elfEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.ear;\r\n\t\t}\r\n\t}\r\n\r\n\tget lefEar() {\r\n\t\treturn this.fragments.lefEar != null;\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (!this.lefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.lefEar = this.lefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.lefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget highlefEar() {\r\n\t\treturn this.fragments.highlefEar != null;\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (!this.highlefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.highlefEar = this.highlefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.highlefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterHair extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * hair color mix\r\n\t * @override\r\n\t * @returns {typeof HairFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn HairFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterFaceBase extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == "delay" || k == "default"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.face.fragments.face.textures[chara.emotion].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.emotion][chara.emotion_frame].delay;\r\n\t\tif (d != null) {//!isNaN(d) && isFinite(d)\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n}\r\nclass CharacterFace extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "emotion";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\nclass CharacterFaceAcc extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "emotion";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterTamingMob extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget type() {\r\n\t\treturn this._raw.info.tamingMob;\r\n\t}\r\n\r\n\tget actionMap() {\r\n\t\treturn this._raw.characterAction;\r\n\t}\r\n\r\n\tget emotionMap() {\r\n\t\treturn this._raw.characterEmotion;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Vec2} relative\r\n\t * @param {FragmentTexture} body\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\tadj_pos(relative, body, chara) {\r\n\t\tconst frag = this.fragments[0];//default\r\n\t\tif (frag) {\r\n\t\t\tconst tm = frag.getTexture(chara);\r\n\t\t\tif (tm) {\r\n\t\t\t\treturn relative.plus(tm.navel.minus(body.navel));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn relative;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara._ride_action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = Math.trunc(this._raw[chara._ride_action][chara.action_frame].delay);//?? _ride_action_frame => action_frame\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn "_ride_action";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterTamingMobFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterTamingMobFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0000\'].FragmentType = CharacterBody;\t\t//\tbody\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0001\'].FragmentType = CharacterHead;\t\t//\telfEar\t\t\t-> CharacterHeadBase -> CharacterHead\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0002\'].FragmentType = CharacterFace;\t\t//\tFace\t\t\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFace\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0003\'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0004\'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0100\'].FragmentType = CharacterEquip;\t\t//\tCap\t\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0101\'].FragmentType = CharacterFaceAcc;\t\t//\taccessoryFace\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFaceAcc\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0102\'].FragmentType = CharacterEquip;\t\t//\taccessoryEyes\t-> CharacterEquip\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0103\'].FragmentType = CharacterEquip;\t\t//\taccessoryEars\t-> CharacterEquip\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0104\'].FragmentType = CharacterEquip;\t\t//\tCoat\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0105\'].FragmentType = CharacterEquip;\t\t//\tLongcoat\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0106\'].FragmentType = CharacterEquip;\t\t//\tPants\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0107\'].FragmentType = CharacterEquip;\t\t//\tShoes\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0108\'].FragmentType = CharacterEquip;\t\t//\tGlove\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0109\'].FragmentType = CharacterEquip;\t\t//\tShield\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0110\'].FragmentType = CharacterEquip;\t\t//\tCape\t\t\t-> CharacterBody\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'0170\'].FragmentType = CharacterEquipCashWeapon;\t//\tcash-weapon\t-> CharacterEquip\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"]._info[\'019\'].FragmentType = CharacterTamingMob;\t//\tTamingMob\t\t-> CharacterTamingMob\r\n\r\n\r\nclass CharacterSlots {\r\n\tconstructor() {\r\n\t\t\t\r\n\t\t/** @type {CharacterAppearanceBase[]} */\r\n\t\tthis._ordered_slot = [];\r\n\r\n\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis.hair = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair2 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix2 = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair3 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix3 = null;\r\n\r\n\r\n\t\t/** @type {CharacterEquipBody} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.head = null;\r\n\r\n\t\t/** @type {CharacterFace} */\r\n\t\tthis.face = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.hair = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 1 */\r\n\t\tthis.cap = null;\r\n\r\n\t\t/** @type {CharacterFace} - 2 */\r\n\t\tthis.accessoryFace = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 3*/\r\n\t\tthis.accessoryEyes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 4 */\r\n\t\tthis.accessoryEars = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.coat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.longcoat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 6 */\r\n\t\tthis.pants = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 7 */\r\n\t\tthis.shoes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 8 */\r\n\t\tthis.glove = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 9 */\r\n\t\tthis.cape = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 10 */\r\n\t\tthis.shield = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 11 */\r\n\t\tthis.weapon = null;\r\n\t\t\r\n\t\t/** @type {CharacterTamingMob} */\r\n\t\tthis.tamingMob = null;\r\n\t\t\r\n\t\t{\r\n\t\t\tObject.defineProperty(this, "_ordered_slot", {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: []\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, "_hair", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, "hair", {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn this._hair;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (value) {\r\n\t\t\t\t\tthis._hair = value;\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tif (this._hair2 && this._hairMix2) {\r\n\t\t\t\t\t\t\tthis.hairColor2 = this.hairColor2;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this._hair3 && this._hairMix3) {\r\n\t\t\t\t\t\t\tthis.hairColor3 = this.hairColor3;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, "_hair", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, "_hair2", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, "_hairMix2", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, "_hair3", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, "_hairMix3", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync __loadColoredHair(color) {\r\n\t\tconst id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getColorHairID(this.hair.id, color);\r\n\t\tconst cateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tconst url = `/Character/${cateInfo.path + (cateInfo.path ? "/" : "") + id}`;\r\n\t\t\tconst use_category = undefined;\r\n\r\n\t\t\tlet hair = new CharacterHair();\r\n\r\n\t\t\tawait hair.load(url, id, cateInfo, use_category);\r\n\r\n\t\t\treturn hair;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {number} */\r\n\tget hairColor2() {\r\n\t\tif (this._hair2) {\r\n\t\t\treturn Number(_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getHairColor(this._hair2.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor2(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc2Id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair2 || hc2Id != this._hair2.id) {\r\n\t\t\tif (hc2Id == this._hair.id) {\r\n\t\t\t\tthis._hair2 = null;\r\n\t\t\t\tthis.hairMix2 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair2 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair2.then(hair2 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair2;\r\n\r\n\t\t\t\t\tthis._hair2 = hair2;\r\n\t\t\t\t\tif (this._hair2 && this.hairMix2 != null) {\r\n\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix2 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairMix2() {\r\n\t\treturn this._hairMix2;\r\n\t}\r\n\tset hairMix2(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair2).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair2;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph2 = ft;\r\n\t\t\t\t\t\t\tori.graph2.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix2 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairColor3() {\r\n\t\tif (this._hair3) {\r\n\t\t\treturn Number(_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getHairColor(this._hair3.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor3(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc3Id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair3 || this._hair3.id != hc3Id) {\r\n\t\t\tif (this._hair.id == hc3Id || this._hair2.id == hc3Id) {\r\n\t\t\t\tthis._hair3 = null;\r\n\t\t\t\tthis.hairMix3 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair3 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair3.then(hair3 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair3;\r\n\r\n\t\t\t\t\tthis._hair3 = hair3;\r\n\t\t\t\t\tif (this._hair3 && this.hairMix3 != null) {\r\n\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix3 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} */\r\n\tget hairMix3() {\r\n\t\treturn this._hairMix3;\r\n\t}\r\n\tset hairMix3(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair3).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair3;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph3 = ft;\r\n\t\t\t\t\t\t\tori.graph3.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix3 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t//__order_slot() {\r\n\t//\tlet slot_map = new Map();\r\n\t//\r\n\t//\tfor (let i in this) {\r\n\t//\t\tlet equip = this[i];\r\n\t//\r\n\t//\t\tequip.cs\r\n\t//\t}\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {CharacterAppearanceBase} loadedEquip\r\n\t * @param {string} use_category - category which used of cash-weapon\r\n\t */\r\n\tasync _use(id, loadedEquip, use_category) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst cateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tlet url = `/Character/${cateInfo.path + (cateInfo.path ? "/":"") + id}`;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item;\r\n\r\n\t\t\tif (loadedEquip instanceof CharacterAppearanceBase) {\r\n\t\t\t\talert("CharacterSlots # _use: param loadedEquip ??");\r\n\t\t\t\tdebugger;\r\n\t\t\t\titem = loadedEquip;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (loadedEquip) {\r\n\t\t\t\t\talert("CharacterSlots # _use: param loadedEquip ??");\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t}\r\n\t\t\t\tconst fragmentType = cateInfo.FragmentType || CharacterEquip;\r\n\r\n\t\t\t\titem = new fragmentType();\r\n\t\t\t}\r\n\t\t\t/** _use_loaded_equip */\r\n\t\t\tif (0) {}\r\n\r\n\t\t\tlet is_exist = loadedEquip || await item.load(url, id, cateInfo, use_category);\r\n\t\t\tif (is_exist) {\r\n\t\t\t\t/** _use_loaded_equip */\r\n\t\t\t\tif (1) {\r\n\t\t\t\t\tif (this[cateInfo.slot]) {\r\n\t\t\t\t\t\tthis[cateInfo.slot]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis[cateInfo.slot] = item;\r\n\r\n\t\t\t\t\tthis._ordered_slot[item.slot_order] = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn("item(" + id + ") is not exist");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {boolean}\r\n\t */\r\n\t_unuse(id) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cateInfo, equip;\r\n\r\n\t\tif (id instanceof CharacterAppearanceBase) {\r\n\t\t\tequip = id;\r\n\t\t\tid = equip.id;\r\n\t\t\tcateInfo = equip.categoryInfo;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].get(id);\r\n\t\t}\r\n\t\t\r\n\t\tconst slotName = cateInfo.slot;\r\n\r\n\t\tif (slotName != "head" && slotName != "body") {\r\n\t\t\tif (this[slotName] && this[slotName].id == id) {\r\n\t\t\t\tequip = this[slotName];\r\n\t\t\t\tfor (let slot in equip.islot) {\r\n\t\t\t\t\tlet order = equip.islot[slot];\r\n\t\t\t\t\tif (this._ordered_slot[order]) {\r\n\t\t\t\t\t\tthis._ordered_slot[order]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdelete this._ordered_slot[order];\r\n\t\t\t\t}\r\n\t\t\t\tthis[slotName] = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t_clear() {\r\n\t\t//this.body = null;\r\n\t\t//this.head = null;\r\n\t\tthis.face = null;\r\n\t\tthis.hair = null;\r\n\t\tthis.cap = null;\r\n\t\tthis.accessoryFace = null;\r\n\t\tthis.accessoryEyes = null;\r\n\t\tthis.accessoryEars = null;\r\n\t\tthis.coat = null;\r\n\t\tthis.longcoat = null;\r\n\t\tthis.pants = null;\r\n\t\tthis.shoes = null;\r\n\t\tthis.glove = null;\r\n\t\tthis.cape = null;\r\n\t\tthis.shield = null;\r\n\r\n\t\t//temp\r\n\t\tlet head = this.head;\r\n\t\tlet body = this.body;\r\n\r\n\t\t//clear\r\n\t\tthis._ordered_slot = [];\r\n\r\n\t\t//restore\r\n\t\tif (head) {\r\n\t\t\tthis._ordered_slot[head.slot_order] = head;\r\n\t\t}\r\n\t\tif (body) {\r\n\t\t\tthis._ordered_slot[body.slot_order] = body;\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify() {\r\n\t\tlet slots = ["c"];\r\n\t\t\t\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id + "|" + this.face.id);\r\n\t\tif (this.hair) {\r\n\t\t\tlet ha = [];\r\n\t\t\tha.push(this.hair.id);\r\n\t\t\tif (this.hairColor2 && this.hairMix2 > 0) ha.push(this.hairColor2 + "%" + Math.trunc(this.hairMix2 * 100));\r\n\t\t\tif (this.hairColor3 && this.hairMix3 > 0) ha.push(this.hairColor3 + "%" + Math.trunc(this.hairMix3 * 100));\r\n\t\t\tslots.push(ha.join("|"));\r\n\t\t}\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots.join(",");\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\tlet slots = [];\r\n\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id);\r\n\t\tif (this.hair) slots.push(this.hair.id);\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots;\r\n\t}\r\n\r\n\t/**\r\n\t * returns: [face, hair, cap, ..., weapon]\r\n\t */\r\n\t*enumerate() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.hair) yield this.hair;\r\n\r\n\t\tyield* this.enumerate_equip();\r\n\t}\r\n\t*enumerate_equip() {\r\n\t\tif (this.cap) yield this.cap;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t\tif (this.accessoryEyes) yield this.accessoryEyes;\r\n\t\tif (this.accessoryEars) yield this.accessoryEars;\r\n\t\tif (this.coat) yield this.coat;\r\n\t\tif (this.longcoat) yield this.longcoat;\r\n\t\tif (this.pants) yield this.pants;\r\n\t\tif (this.shoes) yield this.shoes;\r\n\t\tif (this.glove) yield this.glove;\r\n\t\tif (this.shield) yield this.shield;\r\n\t\tif (this.cape) yield this.cape;\r\n\t\tif (this.weapon) yield this.weapon;\r\n\t}\r\n\t*enumerate_face() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t}\r\n}\r\n\r\nclass CharacterChangeLog {\r\n\tconstructor() {\r\n\t\t/** @type {"human"|"elf"|"lef"|"highlef"} */\r\n\t\tthis.ear = undefined;\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.useEquip = [];\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.unuseEquip = [];\r\n\t\t\r\n\t\t/** @type {string} - hair2 id */\r\n\t\tthis.hair2 = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.hairMix2 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hair3 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hairMix3 = undefined;\r\n\r\n\t\t/** @type {string} weapon => equip id */\r\n\t\tthis.weapon = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.ear = undefined;\r\n\t\tthis.useEquip = [];\r\n\t\tthis.unuseEquip = [];\r\n\t\tthis.hair2 = undefined;\r\n\t\tthis.hairMix2 = undefined;\r\n\t\t//this.hair3 = undefined;\r\n\t\t//this.hairMix3 = undefined;\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n}\r\n\r\nclass CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tthis._$dirty = 0;//force update vue\r\n\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.job = null;\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.subJob = null;\r\n\r\n\r\n\t\t/** @type {ActionAnimation} */\r\n\t\tthis.actani = new _CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__[/* ActionAnimation */ "a"]();\r\n\r\n\t\t/** @type {number} - animation speed rate */\r\n\t\tthis.speed = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.fixed_speed = false;\r\n\r\n\t\t/** @type {boolean} - pause animation */\r\n\t\tthis.pause = false;\r\n\r\n\r\n\t\tthis.hideBody = false;\r\n\r\n\t\tthis._ride_action = "stand1";\r\n\t\t\r\n\t\tthis._action = "stand1";\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\tthis._emotion = "blink";\r\n\t\tthis._emotion_frame = 0;\r\n\t\tthis._emotion_time = 0;\r\n\t\t//this._emotion_frame_sequence = [0, 1, 2, 1];\r\n\t\tthis._generator_emotion_frame = this.emotion_frame_sequence_generator(3, 0);//[0,1,2].length\r\n\t\t\r\n\t\tthis.blinkRate = 0.03;\r\n\r\n\t\t/** @type {CharacterSlots} */\r\n\t\tthis.slots = new CharacterSlots();\r\n\r\n\t\t/**\r\n\t\t * is require update render data\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.__require_update = true;\r\n\r\n\t\t/** @type {FragmentTexture[]} */\r\n\t\tthis.__frag_list = [];\r\n\r\n\t\t/** @type {CharacterChangeLog} **/\r\n\t\tthis.$$changeLog = new CharacterChangeLog();\r\n\t}\r\n\r\n\t_clone() {\r\n\t\talert(this.constructor.name + "::_clone");\r\n\r\n\t\t/** @type {CharacterAnimationBase} */\r\n\t\tlet nc = new this.constructor();//not must CharacterRender\r\n\t\tif (!nc) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnc.speed = 0;\r\n\r\n\t\tnc.x = this.x;\r\n\t\tnc.y = this.y;\r\n\t\tnc.angle = this.angle;\r\n\r\n\t\tnc.action = this.action;\r\n\t\tnc.action_frame = this.action_frame;\r\n\r\n\t\tnc.emotion = this._emotion;\r\n\t\tnc.emotion_frame = this.emotion_frame;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tnc.slots[i] = this.slots[i];//not need colne ?\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nc;\r\n\t}\r\n\t\t\r\n\t_waitFrameTexturesLoaded() {\r\n\t\tlet tasks = [];\r\n\t\tfor (let i in this.slots) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\t\tlet frag = item.fragments[j];\r\n\t\t\t\t\tlet count = frag.getFrameCount(this);\r\n\t\t\t\t\tfor (let k = 0; k < count; ++k) {\r\n\t\t\t\t\t\tlet ft = frag.getFrameTexture(this, k);\r\n\t\t\t\t\t\tif (ft && !ft._isLoaded_or_doload()) {\r\n\t\t\t\t\t\t\ttasks.push(ft.$promise);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\r\n\t/**\r\n\t * init animation status\r\n\t */\r\n\tinitAnimation() {\r\n\t\t/** @type {string} */\r\n\t\tthis.action = "stand1";\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.emotion = "blink";\r\n\t\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_frame = 0;\r\n\t}\r\n\r\n\t/** @type {number} - 0~1 */\r\n\tgetSpeed() {\r\n\t\tif (this.pause) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this.fixed_speed ? 1 : this.speed;\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget elfEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.elfEar;\r\n\t\t}\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.elfEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget lefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar;\r\n\t\t}\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.lefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget highlefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.highlefEar;\r\n\t\t}\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.highlefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {"human"|"elf"|"lef"|"highlef"} */\r\n\tget ear() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar ? "lef" : (this.slots.head.elfEar ? "elf" : (this.slots.head.highlefEar ? "highlef" : "human"));\r\n\t\t}\r\n\t}\r\n\tset ear(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tif (value == "elf") {\r\n\t\t\t\tthis.slots.head.elfEar = true;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == "lef") {\r\n\t\t\t\tthis.slots.head.lefEar = true;\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == "highlef") {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = true;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = "human";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$$changeLog.ear = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget action() {\r\n\t\t//if (this.slots.tamingMob) {\r\n\t\t//\tconst actmap = this.slots.tamingMob.actionMap;\r\n\t\t//\tif (actmap) {\r\n\t\t//\t\treturn actmap[this._action];\r\n\t\t//\t}\r\n\t\t//\treturn "sit";//default\r\n\t\t//}\r\n\t\treturn this._action;\r\n\t}\r\n\tset action(act) {\r\n\t\tif (this.slots.tamingMob) {\r\n\t\t\tlet _act;\r\n\r\n\t\t\tthis._ride_action = act;\r\n\r\n\t\t\tif (this.slots.tamingMob.actionMap) {\r\n\t\t\t\t_act = this.slots.tamingMob.actionMap[act];\r\n\r\n\t\t\t\tif (_act == "hideBody") {\r\n\t\t\t\t\tthis.hideBody = true;\r\n\r\n\t\t\t\t\t//TODO: hideBody act=?\r\n\r\n\t\t\t\t\tthis._action = act;\r\n\t\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.hideBody = false;\r\n\r\n\t\t\t\t\tthis._action = _act;\r\n\t\t\t\t\tif (this.actani._action != _act) {\r\n\t\t\t\t\t\tthis.actani.reload(_act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (act == "rope") {\r\n\t\t\t\t\tthis._action = "rope";//default\r\n\t\t\t\t}\r\n\t\t\t\telse if (act == "ladder") {\r\n\t\t\t\t\tthis._action = "ladder";//default\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._action = "sit";//default\r\n\t\t\t\t}\r\n\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t}\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.hideBody = false;\r\n\t\t\tthis._ride_action = null;\r\n\r\n\t\t\tif (this.actani._action != act && this.slots.body) {\r\n\t\t\t\tthis._action = act;\r\n\t\t\t\tthis.actani.reload(act);\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame() {\r\n\t\treturn this._action_frame;\r\n\t}\r\n\tset action_frame(value) {\r\n\t\tif (value === "") {//from $("input")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (false) {}\r\n\r\n\t\tthis._action_frame = value;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.body) {\r\n\t\t\t\treturn this.slots.body.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget emotion() {\r\n\t\treturn this._emotion;\r\n\t}\r\n\tset emotion(emo) {\r\n\t\tif (this._emotion != emo && this.slots.face && this.slots.face.fragments.face.textures[emo]) {\r\n\t\t\tthis._emotion = emo;\r\n\t\t\tthis._emotion_frame = 0;\r\n\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\tif (emo == "blink") {\r\n\t\t\t\tthis.blinkRate = 0.03;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.blinkRate = 1;\r\n\t\t\t}\r\n\r\n\t\t\t//this._emotion_frame_sequence = [...circularSequence(this.emotion_frame_count)];\r\n\t\t\tthis._generator_emotion_frame = this.emotion_frame_sequence_generator(this.emotion_frame_count, 0);\r\n\r\n\t\t\tthis.__require_update |= true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} count of frame\r\n\t * @param {number} start frame\r\n\t */\r\n\t*emotion_frame_sequence_generator(length, start) {\r\n\t\twhile (true) {\r\n\t\t\tif (Math.random() < this.blinkRate) {\r\n\t\t\t\tyield* linearSequence(length, start);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tyield 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @type {number} */\r\n\tget emotion_frame() {\r\n\t\treturn this._emotion_frame;\r\n\t\t//let f = this._emotion_frame_sequence[this._emotion_frame % this._emotion_frame_sequence.length];\r\n\t\t//return f;\r\n\t}\r\n\tset emotion_frame(value) {\r\n\t\tif (value === "") {//from $("input")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (false) {}\r\n\r\n\t\tthis._emotion_frame = value;\r\n\t\tthis._emotion_time = 0;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} next\r\n\t */\r\n\t_get_emotion_next_frame(next) {\r\n\t\tlet r = this._generator_emotion_frame.next().value;\r\n\t\t\r\n\t\tthis._generator_emotion_frame = this.emotion_frame_sequence_generator(this.emotion_frame_count, this._emotion_frame);\r\n\t\t\r\n\t\treturn r;\r\n\t\t\r\n\t\t//let f = this._emotion_frame + next;\r\n\t\t//f = f < 0 ? (this._emotion_frame_sequence.length - 1) : (f % this._emotion_frame_sequence.length);\r\n\t\t//return this._emotion_frame_sequence[f];\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_time() {\r\n\t\treturn this._emotion_time;\r\n\t}\r\n\tset emotion_time(time) {\r\n\t\tif (this.emotion_frame_count) {\r\n\t\t\tif (time < this.emotion_delay) {\r\n\t\t\t\tthis._emotion_time = time;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\t\tthis._emotion_frame = this._generator_emotion_frame.next().value;\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget emotion_delay() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn this.slots.face.getDelay(this);\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.face) {\r\n\t\t\t\treturn this.slots.face.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp - 0 <= stamp < Infinity\r\n\t */\r\n\t_update(_stamp) {\r\n\t\tif (this.pause) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet stamp = _stamp * this.getSpeed();\r\n\t\t\r\n\t\tif (this.actani) {\r\n\t\t\tif (this.actani.isEnd() && this.actani.loop) {\r\n\t\t\t\tthis.actani.reset();\r\n\t\t\t}\r\n\r\n\t\t\tthis.actani.update(stamp, this);\r\n\t\t}\r\n\r\n\t\tthis.emotion_time += _stamp;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet equip = this.slots[i];\r\n\t\t\tif (equip && equip.effect && equip.effect.enable) {\r\n\t\t\t\tequip.effect.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis._update(stamp);\r\n\t}\r\n\r\n\t__forceUpdate(stamp) {\r\n\t\tthis._$dirty = Math.random();\r\n\t\tthis._update(stamp | 0);\r\n\t\tthis.__update_frag_list();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} x\r\n\t * @param {number} y, \r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\t_draw(renderer, x, y, angle, flip) {\r\n\t\trenderer.pushGlobalAlpha();\r\n\r\n\t\tif (this.__require_update) {\r\n\t\t\tthis.__update_frag_list();\r\n\t\t\tthis.__require_update = false;\r\n\t\t}\r\n\r\n\t\t//list.filter(a=>a&&a._raw.map).forEach(a=>{ for (let i in a._raw.map) { if (q[i]) { q[i].push(a); } else { q[i] = [a]; } } })\r\n\t\tthis.__draw_list(renderer, this.__frag_list, x, y, angle, flip);\r\n\r\n\t\trenderer.popGlobalAlpha();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {FragmentTexture[]} list\r\n\t */\r\n\t__draw_list(renderer, list, x, y, angle, flip) {\r\n\t\trenderer.pushMatrix();\r\n\r\n\t\trenderer.translate(x, y);\r\n\t\t\r\n\t\tif (0) {}\r\n\r\n\t\trenderer.rotate(window.m_a || angle);\r\n\r\n\t\tif (flip) {\r\n\t\t\trenderer.scale(-1, 1);\r\n\t\t}\r\n\t\t//{\r\n\t\t//\tlet ctx = renderer.ctx;\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(100, 0);\r\n\t\t//\tctx.strokeStyle = "#F00";\r\n\t\t//\tctx.stroke();\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(0, 100);\r\n\t\t//\tctx.strokeStyle = "#0F0";\r\n\t\t//\tctx.stroke();\r\n\t\t//}\r\n\r\n\t\t{\r\n\t\t\tfor (let i in this.slots) {\r\n\t\t\t\tlet equip = this.slots[i];\r\n\t\t\t\tif (equip && equip.effect) {\r\n\t\t\t\t\tequip.effect.render(renderer, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i in list) {\r\n\t\t\t\tlet ft = list[i];\r\n\t\t\t\tft.render(renderer, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderer.popMatrix();\r\n\t}\r\n\t__update_frag_list() {\r\n\t\tthis.__frag_list = [];\r\n\t\t\r\n\t\t/** @type {Array<CharacterAppearanceBase>[]} */\r\n\t\tlet slots = {};\r\n\t\t\r\n\t\tfor (let i = 2; i <= 3; ++i) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots["_hair" + i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\tfor (let i in this.slots._ordered_slot) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots._ordered_slot[i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\t\r\n\t\t{//back\r\n\t\t\tlet is_back = false;\r\n\t\t\t\r\n\t\t\tfor (let i in slots) {\r\n\t\t\t\t/** @type {FragmentTexture[]} */\r\n\t\t\t\tlet fts = slots[i];\r\n\t\t\t\tfor (let j in fts) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = fts[j];\r\n\t\t\t\t\tif (is_back) {\r\n\t\t\t\t\t\tif (ft._place.startsWith("face")) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (ft._place.startsWith("backHair")) {\r\n\t\t\t\t\t\tis_back = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t{\r\n\t\t\tlet ae = this.__frag_list[114];//HACK: Ae\r\n\t\t\tif (ae) {\r\n\t\t\t\tthis.__frag_list.push(ae);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._calcBoundBox();\r\n\t}\r\n\t/**\r\n\t * @param {Array<CharacterAppearanceBase>[]} slots\r\n\t * @param {CharacterAppearanceBase} item\r\n\t */\r\n\t__add_equip_to_frag_list(slots, item) {\r\n\t\t// if equip not use then value is mumber(slot_order) where this.slots._ordered_slot\r\n\t\tif (item == null) {\r\n\t\t\treturn;//debugger;\r\n\t\t}\r\n\t\telse if (item > 0) {// typeof item == \'number\'; item != null && (item instanceof CharacterAppearanceBase || item >= 0)\r\n\t\t\treturn;//continue;\r\n\t\t}\r\n\r\n\t\t// init slots\r\n\t\tfor (let j in item.vslot) {\r\n\t\t\tlet slot = item.vslot[j];\r\n\t\t\tslots[slot] = [];\r\n\t\t}\r\n\r\n\t\tfor (let j in item.fragments) {//foreach equip place\r\n\t\t\tlet slot = sMap[j];\r\n\t\t\tif (slot != null) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (j == "default") {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tslot = item._raw.info.islot;\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//item.fragments[j].visible = true;\r\n\t\t}\r\n\t}\r\n\t/** @param {FragmentTexture} ft */\r\n\t__add_frag_to_list(ft) {\r\n\t\tft.update(this);\r\n\t\tthis.__frag_list[ft.z] = ft;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * calc current frame bound box and restore result\r\n\t * @returns {Rectangle}\r\n\t */\r\n\t_calcBoundBox() {\r\n\t\tlet left = 0, top = 0, right = 0, bottom = 0;\r\n\r\n\t\tfor (let i in this.__frag_list) {\r\n\t\t\tlet ft = this.__frag_list[i];\r\n\t\t\tif (ft.texture && ft.relative) {\r\n\t\t\t\tlet x0 = ft.relative.x;\r\n\t\t\t\tlet y0 = ft.relative.y;\r\n\t\t\t\tlet x1 = x0 + ft.width;\r\n\t\t\t\tlet y1 = y0 + ft.height;\r\n\r\n\t\t\t\tleft = Math.min(left, x0);\r\n\t\t\t\ttop = Math.min(top, y0);\r\n\t\t\t\tright = Math.max(right, x1);\r\n\t\t\t\tbottom = Math.max(bottom, y1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._boundBox = new _math_js__WEBPACK_IMPORTED_MODULE_6__["Rectangle"](\r\n\t\t\tMath.trunc(left),\r\n\t\t\tMath.trunc(top),\r\n\t\t\tMath.trunc(right - left),\r\n\t\t\tMath.trunc(bottom - top)\r\n\t\t);\r\n\t\treturn this._boundBox;\r\n\t}\r\n\t\r\n\ttoJSON() {\r\n\t\tlet obj = {\r\n\t\t\thair2: this.slots._hair2.id,\r\n\t\t\thairMix2: this.slots.hairMix2,\r\n\t\t\tslots: this.slots.toJSON(),\r\n\t\t};\r\n\r\n\t\tif (this.slots.head.elfEar) {\r\n\t\t\tobj.ear = "elf";\r\n\t\t}\r\n\t\telse if (this.slots.head.lefEar) {\r\n\t\t\tobj.ear = "lef";\r\n\t\t}\r\n\t\telse if (this.slots.head.highlefEar) {\r\n\t\t\tobj.ear = "highlef";\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nclass CharacterRenderer extends CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {number} - position x */\r\n\t\tthis.x = 0;\r\n\t\t/** @type {number} - position y */\r\n\t\tthis.y = 0;\r\n\r\n\t\t/** @type {number} - where layer */\r\n\t\tthis.z = 5;\r\n\r\n\t\t/** @type {number} - translate x once frame */\r\n\t\tthis.tx = 0;\r\n\t\t/** @type {number} - translate y once frame */\r\n\t\tthis.ty = 0;\r\n\t\t\r\n\t\tthis.angle = 0;\r\n\t\tthis.front = -1;\r\n\r\n\t\t/** @type {Promise<void>[]} */\r\n\t\tthis.__load_task = [];\r\n\r\n\t\t/** @type {function(IRenderer)} */\r\n\t\tthis.render = function (renderer) {\r\n\t\t\t//not ready to render\r\n\t\t\t//if load then set load render = _render\r\n\t\t}\r\n\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis._boundBox = null;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\tlet result = await Promise.all([\r\n\t\t\t$get.data("/zmap"),\r\n\t\t\t$get.data("/smap"),\r\n\t\t\tItemEffect.Init(),\r\n\t\t\t_CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__[/* ActionAnimation */ "a"].Init(),//action definition\r\n\t\t]);\r\n\t\t\r\n\t\tzMap = {};\r\n\t\tObject.keys(result[0]).reverse().forEach((k, i) => zMap[k] = i + 1);\r\n\r\n\t\tsMap = result[1];\r\n\t}\r\n\r\n\tload() {\r\n\t\t//load body and head for calc relative position\r\n\t\tthis.use("00002012");\r\n\t\tthis.use("00012012");\r\n\r\n\t\tlet $promise = Promise.all([...this.__load_task]);\r\n\t\t(function (that, $promise) {\r\n\t\t\t$promise.then(function (result) {\r\n\t\t\t\tthat.initAnimation();\r\n\t\t\t\tthat.render = that._render;\r\n\t\t\t});\r\n\t\t})(this, $promise);\r\n\r\n\t\treturn $promise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.waitLoaded();\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_render(renderer) {\r\n\t\tconst x = Math.trunc(this.x + this.tx);\r\n\t\tconst y = Math.trunc(this.y + this.ty);\r\n\t\t\r\n\t\tthis._draw(renderer, x, y, this.angle, this.front > 0);\r\n\t\t\r\n\t\t//this.tx = 0;//auto clear\r\n\t\t//this.ty = 0;//auto clear\r\n\t}\r\n\t\r\n\t_setup_test() {\r\n\t\tthis.use("00026509");\r\n\r\n\t\tthis.use("00044041");\r\n\r\n\t\t//this.use("01022274");\r\n\r\n\t\tthis.use("01053169");\r\n\r\n\t\tthis.use("01071077");\r\n\r\n\t\t//this.use("01102960");\r\n\t}\r\n\r\n\t\r\n\tasync __synchronize(stamp) {\r\n\t\tthis.__forceUpdate(stamp);\r\n\t\r\n\t\tawait this.waitLoaded();\r\n\t\tawait this._waitFrameTexturesLoaded();\r\n\t}\r\n\tasync waitLoaded() {\r\n\t\tlet tasks = this.__load_task;\r\n\t\tif (tasks && tasks.length) {\r\n\t\t\tawait Promise.all(tasks).then(() => {\r\n\t\t\t\tthis.__load_task = [];\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t//isLoading() {\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {string} category - category of cash-weapon\r\n\t */\r\n\tasync use(id, category) {\r\n\t\tif (!category) {\r\n\t\t\tcategory = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].getJobWeaponCategory(this.job);\r\n\t\t}\r\n\t\tconst item_type = id[0];\r\n\t\tswitch (item_type) {\r\n\t\t\tcase "0"://equip\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].isCashWeapon(id)) {\r\n\t\t\t\t\t\t//this.$$changeLog.weaponType = ss[1];/??\r\n\t\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\r\n\t\t\t\t\tlet task = this.slots._use(id, null, category);\r\n\t\t\t\t\tthis.__load_task.push(task);\r\n\t\t\t\t\tawait task;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (id.startsWith("019")) {\r\n\t\t\t\t\t\tthis.action = this.action;//force update action\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.__update_frag_list();\r\n\t\t\t\t\tthis._calcBoundBox();\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tunuse(id) {\r\n\t\tdebugger;\r\n\t\tif (id[0] == "0") {//equip\r\n\t\t\tlet result = this.slots._unuse(id);\r\n\t\t\tif (result) {\r\n\t\t\t\tthis.$$changeLog.unuseEquip.push(id);\r\n\t\t\t\tthis._calcBoundBox();\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\t_parse(code) {\r\n\t\tif (!code) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet es = code.split(",");\r\n\t\tthis.slots._clear();\r\n\t\tes.forEach((v, i, a) => {\r\n\t\t\tif (v.indexOf("|") >= 0) {\r\n\t\t\t\tconst ss = v.split("|");\r\n\t\t\t\tconst cate = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* ItemCategoryInfo */ "c"].get(ss[0]);\r\n\t\t\t\tlet id;\r\n\t\t\t\tif (cate.slot == "face") {\r\n\t\t\t\t\tid = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == "hair") {\r\n\t\t\t\t\tconst slots = this.slots;\r\n\t\t\t\t\tlet h2 = ss[1];\r\n\t\t\t\t\tlet h3 = ss[2];\r\n\t\t\t\t\t//\r\n\t\t\t\t\tid = ss[0];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id).then(() => {\r\n\t\t\t\t\t\tif (h2 && h2.indexOf("%") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h2.split("%");\r\n\t\t\t\t\t\t\tconst c2 = hc[0];\r\n\t\t\t\t\t\t\tconst m2 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair2 = c2;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix2 = m2;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor2 = c2;\r\n\t\t\t\t\t\t\tslots.hairMix2 = m2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (h3 && h3.indexOf("%") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h3.split("%");\r\n\t\t\t\t\t\t\tconst c3 = hc[0];\r\n\t\t\t\t\t\t\tconst m3 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair3 = c3;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix3 = m3;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor3 = hc[0];\r\n\t\t\t\t\t\t\tslots.hairMix4 = hc[1] / 100;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == "weapon") {\r\n\t\t\t\t\tthis.$$changeLog.weaponType = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\tthis.use.apply(this, ss, ss[1]);//this.use(ss[0], ss[1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (Number.isFinite(parseInt(v, 10))) {\r\n\t\t\t\tthis.use(v);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @type {string} col\r\n\t */\r\n\tget hairColor() {\r\n\t\tif (this.slots.hair) {\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getHairColor(this.slots.hair.id);\r\n\t\t}\r\n\t\treturn "0";\r\n\t}\r\n\tset hairColor(col) {\r\n\t\tif (this.slots.hair && col != this.hairColor) {\r\n\t\t\tlet id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getColorHairID(this.slots.hair.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} col\r\n\t */\r\n\tget faceColor() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getFaceColor(this.slots.face.id);\r\n\t\t}\r\n\t\treturn "0";\r\n\t}\r\n\tset faceColor(col) {\r\n\t\tif (this.slots.face && col != this.faceColor) {\r\n\t\t\tlet id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[/* CharacterRenderConfig */ "a"].getColorFaceID(this.slots.face.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterChangeLog} changeLog\r\n\t */\r\n\tcommitChange(changeLog) {\r\n\t\tif (changeLog.ear) {\r\n\t\t\tthis.ear = changeLog.ear;\r\n\t\t}\r\n\r\n\t\tif (this.useEquip) {\r\n\t\t\tfor (let id of this.useEquip) {\r\n\t\t\t\tthis.use(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.unuseEquip) {\r\n\t\t\tfor (let id of this.unuseEquip) {\r\n\t\t\t\tthis.unuse(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair2 && changeLog.hairMix2) {\r\n\t\t\tthis.slots.hairColor2 = changeLog.hair2;\r\n\t\t\tthis.slots.hairMix2 = changeLog.hairMix2;\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair3 && changeLog.hairMix3) {\r\n\t\t\t//this.slots.hairColor3 = changeLog.hair3;\r\n\t\t\t//this.slots.hairMix3 = changeLog.hairMix3;\r\n\t\t}\r\n\t\t\r\n\t\tif (changeLog.weapon && changeLog.weaponType) {\r\n\t\t\tthis.use(changeLog.weapon, changeLog.weaponType);\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify(genCode) {\r\n\t\tlet result = this.slots._stringify();\r\n\t\tif (genCode) {\r\n\t\t\treturn `chara._parse(\'${result}\')`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t_outlink_old() {\r\n\t\tif (this.slots.body && this.slots.body.id && this.slots.face && this.slots.face.id && this.action && this.emotion) {\r\n\t\t\tlet link = "https://labs.maplestory.io/api/GMS/latest/character/center/" + this.slots.body.id + "/";\r\n\t\t\tlet slots = [...this.slots.enumerate()].map(a => parseInt(a.id, 10));\r\n\r\n\t\t\tslots[0] = this.slots.face.id + ":" + this.emotion;\r\n\r\n\t\t\tlink += slots.join(",");\r\n\r\n\t\t\tlink += "/" + this.action + "?showears=" + (this.elfEar ? "true" : "false");\r\n\r\n\t\t\tlink += "&showLefEars=" + (this.lefEar ? "true" : "false");\r\n\r\n\t\t\treturn link;\r\n\t\t}\r\n\t\tconsole.log("character need body, face, action, emotion");\r\n\t}\r\n\t\r\n\t_outlink(name) {\r\n\t\tconst animationName = this.action;\r\n\t\tconst frame = this.action_frame;\r\n\t\tconst slots = this.slots;\r\n\t\tconst itemList = JSON.stringify(makeItemList.call());\r\n\t\treturn encodeURI(\r\n\t\t\t\t"https://maplestory.io/api/character/" +\r\n\t\t\t\titemList.slice(1, itemList.length - 1) +    // not array\r\n\t\t\t\t"/" + animationName + "/" + frame + "?" +\r\n\t\t\t\t"showears=" + this.elfEar +\r\n\t\t\t\t"&showLefEars=" + this.lefEar +\r\n\t\t\t\t"&resize=1" +\r\n\t\t\t\t(name ? ("&name=" + name) : "") +\r\n\t\t\t\t"&flipX=" + Boolean(this.front > 0) +\r\n\t\t\t\t"&bgColor=0,0,0,0"\r\n\t\t\t\t);\r\n\t\tfunction makeItemList() {\r\n\t\t\treturn Object.values(slots).filter(a => a).map(transformItemData);\r\n\t\t}\r\n\t\tfunction transformItemData(item) {\r\n\t\t\tlet region, version;\r\n\t\t\tif (item._raw.info.__v) {\r\n\t\t\t\tconst m = item._raw.info.__v.toUpperCase().match(/([A-Z]*)([0-9]*)/);\r\n\t\t\t\tregion = m[1] == "TWMS" ? "TMS" : m[1];\r\n\t\t\t\tversion = "latest";//m[2];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tregion ="TMS";\r\n\t\t\t\tversion = "latest";\r\n\t\t\t}\r\n\t\t\tconst filter = item.filter;\r\n\t\t\treturn {\r\n\t\t\t\titemId:        Number(item.id),\r\n\t\t\t\tregion:        region,\r\n\t\t\t\tversion:       version,\r\n\t\t\t\thue:           filter.hue,\r\n\t\t\t\tsaturation:    strNum(filter.sat),\r\n\t\t\t\tbrightness:    strNum(filter.bri),\r\n\t\t\t\tcontrast:      strNum(filter.contrast),\r\n\t\t\t\talpha:         Number(item.opacity.toFixed(1)),\r\n\t\t\t\tanimationName: animationName,\r\n\t\t\t};\r\n\t\t}\r\n\t\tfunction strNum(val) {\r\n\t\t\treturn (val / 100).toFixed(1);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_download() {\r\n\t\twindow.open(this._outlink());\r\n\t}\r\n\r\n\t_save_as_svg() {\r\n\t\tthis.__texture_to_base64().then(frag_list => {\r\n\t\t\tlet file_name = this.id + ".svg";\r\n\t\t\t//let frag_list = this.__frag_list;\r\n\t\r\n\t\t\tlet svg = \'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" >\';\r\n\r\n\t\t\tsvg += \'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">\\n\';// width="64" height="96"\r\n\r\n\t\t\tsvg += \'<g transform="translate(32, 96)">\';\r\n\t\t\tfrag_list.forEach(function (ft) {\r\n\t\t\t\tif (ft && ft.relative) {\r\n\t\t\t\t\tlet clz = ft.classList;\r\n\t\t\t\t\tsvg += `\\t<image class="${clz}" opacity="${ft.visible ? ft.opacity : 0}" x="${ft.relative.x}" y="${ft.relative.y}" width="${ft.width}" height="${ft.height}" xlink:href="${ft._url}"></image>\\n`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsvg += \'</g>\';\r\n\r\n\t\t\tsvg += \'<text x="0" y="122" fill="transparent">\' + this._stringify(false) + \'</text>\';\r\n\r\n\t\t\tsvg += \'</svg>\';\r\n\r\n\t\t\t//let url = "data:text/plain;utf8," + svg;\r\n\r\n\t\t\tdebugger;\r\n\r\n\t\t\t//window.open(url);\r\n\t\t\tDownloadData(svg, "image/svg+xml;utf8", file_name);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * "data:image/png;base64,[...]"\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} filename\r\n\t * @returns {string}\r\n\t */\r\n\t_save_as_png(renderer, filename) {\r\n\t\tlet bound = this._calcBoundBox();\r\n\t\tlet size = bound.size;\r\n\t\tlet x = -bound.left;\r\n\t\tlet y = bound.height;\r\n\t\tlet angle = 0;\r\n\t\tlet front = false;\r\n\r\n\t\t// use Canvas2, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//save Canvas2 size, current ctx is _ctx2\r\n\t\tconst c2w = renderer._ctx2.canvas.width;\r\n\t\tconst c2h = renderer._ctx2.canvas.height;\r\n\t\t//\r\n\t\trenderer.ctx.canvas.width = size.x;\r\n\t\trenderer.ctx.canvas.height = size.y;\r\n\r\n\t\ttry {\r\n\t\t\tthis._draw(renderer, x, y, angle, front);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\tlet base64 = renderer.ctx.canvas.toDataURL("image/png");\r\n\t\t{\r\n\t\t\tlet elem = document.createElement("a");\r\n\r\n\t\t\tlet name = `${filename ? (filename+"."):""}${this.action}[${this.action_frame}].${this.emotion}[${this.emotion_frame}].png`;\r\n\r\n\t\t\telem.id = name;\r\n\t\t\telem.download = name;\r\n\t\t\telem.href = base64;\r\n\r\n\t\t\tdocument.body.appendChild(elem);\r\n\t\t\telem.click();\r\n\t\t\tdocument.body.removeChild(elem);\r\n\t\t}\r\n\r\n\t\t//restore Canvas2 size, current ctx is _ctx2\r\n\t\trenderer.ctx.canvas.width = c2w;\r\n\t\trenderer.ctx.canvas.height = c2h;\r\n\r\n\t\t// restore Canvas, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\treturn base64;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {Promise<FragmentTexture[]>}\r\n\t */\r\n\tasync __texture_to_base64() {\r\n\t\tlet frag_list = this.__frag_list;\r\n\t\tlet tasks = [];\r\n\r\n\t\tfrag_list.forEach(function (ft) {\r\n\t\t\tif (!ft) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!ft._url.startsWith("data:")) {\r\n\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\tft._url = await toDataURL(ft._url);\r\n\t\t\t\t\treturn ft;\r\n\t\t\t\t})());\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttasks.push(ft);\r\n\t\t\t}\r\n\t\t\tif (ft.graph2) {\r\n\t\t\t\tlet src = ft.graph2._url;\r\n\t\t\t\tif (!src.startsWith("data:")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph2._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph2;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ft.graph3) {\r\n\t\t\t\tlet src = ft.graph3._url;\r\n\t\t\t\tif (!src.startsWith("data:")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph3._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph3;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph3);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n}\r\nObject(_init_js__WEBPACK_IMPORTED_MODULE_1__[/* AddInitTask */ "a"])(CharacterRenderer.Init);\r\n\r\nfunction* circularSequence(length, start=0) {\r\n\tlet i = start;\r\n\tfor (; i < length; ++i) {//a: 0, 1, 2, 3, ...b\r\n\t\tyield i;\r\n\t}\r\n\tfor (i -= 2; i > 0; --i) {//b: 2, 1, ...a\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction* linearSequence(length, start=0) {\r\n\tfor (let i = start; i < length; ++i) {\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction extract_number(input) {\r\n\treturn String(input).match(/(-?\\d+\\.?\\d*)|(\\.\\d*)/g);\r\n}\r\n\r\n/**\r\n * image href to data url\r\n */\r\nfunction toDataURL(url) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.onload = function () {\r\n\t\t\tlet reader = new FileReader();\r\n\t\t\treader.onloadend = function () {\r\n\t\t\t\tresolve(reader.result);\r\n\t\t\t}\r\n\t\t\treader.onerror = function (ev) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\treject(ev);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(xhr.response);\r\n\t\t};\r\n\t\txhr.open(\'GET\', url);\r\n\t\txhr.responseType = \'blob\';\r\n\t\txhr.send();\r\n\t});\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzM1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUmVuZGVyZXIvQ2hhcmFjdGVyUmVuZGVyZXIuanM/MjcyOSJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLCBJdGVtQ2F0ZWdvcnlJbmZvLCBSZXNvdXJjZU1hbmFnZXIgfSBmcm9tICcuLi8uLi8uLi9wdWJsaWMvamF2YXNjcmlwdHMvcmVzb3VyY2UuanMnO1xyXG5pbXBvcnQgeyBBZGRJbml0VGFzayB9IGZyb20gXCIuLi8uLi9pbml0LmpzXCI7XHJcbmltcG9ydCB7IEFuaW1hdGlvbiB9IGZyb20gXCIuLi9BbmltYXRpb25cIjtcclxuaW1wb3J0IHsgZW5naW5lIH0gZnJvbSAnLi4vRW5naW5lLmpzJztcclxuaW1wb3J0IHsgSVJlbmRlcmVyLCBJbWFnZUZpbHRlciB9IGZyb20gJy4uL0lSZW5kZXJlci5qcyc7XHJcbmltcG9ydCB7IFNwcml0ZSwgU3ByaXRlQmFzZSB9IGZyb20gJy4uL1Nwcml0ZS5qcyc7XHJcbmltcG9ydCB7IFJlY3RhbmdsZSwgVmVjMiB9IGZyb20gJy4uL21hdGguanMnO1xyXG5pbXBvcnQgeyBBY3Rpb25BbmltYXRpb24gfSBmcm9tICcuL0NoYXJhY3RlckFjdGlvbkFuaW1hdGlvbi5qcyc7XHJcblxyXG5cclxubGV0IHpNYXAgPSB7fTtcclxubGV0IHNNYXAgPSB7fTtcclxuXHJcblxyXG4vKipcclxuICogMDAwMjY2MjMuYmxpbmtbMV0uYnJvdyBoYXMgYnVnXHJcbiAqICdXZWFwb24vMDE3MDI2OTQnIGlzIExvbmdjb2F0KGlzbG90KVxyXG4gKiBob3cgdG8gdXNlIGNhc2gtd2VhcG9uIChleDogMDE3MDI1MDR8MDE1MilcclxuICovXHJcblxyXG4vKipcclxuICogbXVsdGktaW1hZ2Utc3ByaXRlXHJcbiAqL1xyXG5jbGFzcyBGcmFnbWVudFRleHR1cmUgZXh0ZW5kcyBTcHJpdGVCYXNlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3d6cHJvcGVydHl9IHJhd1xyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBmdWxsX3BhdGhcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihyYXcsIGZ1bGxfcGF0aCkge1xyXG5cdFx0c3VwZXIocmF3LCBmdWxsX3BhdGgpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9yYXcub3JpZ2luKSB7XHJcblx0XHRcdHRoaXMuX3Jhdy5vcmlnaW4uX19wcm90b19fID0gVmVjMi5wcm90b3R5cGU7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLl9yYXcubWFwKSB7XHJcblx0XHRcdHRoaXMuX3Jhdy5tYXBbaV0uX19wcm90b19fID0gVmVjMi5wcm90b3R5cGU7XHJcblx0XHR9XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBpZiB0aGlzLnJlbGF0aXZlID09IG51bGwgdGhlbiByZW1vdmUgdGhpc1xyXG5cdFx0ICogQHR5cGUge1ZlYzJ9XHJcblx0XHQgKi9cclxuXHRcdHRoaXMucmVsYXRpdmUgPSBuZXcgVmVjMigwLCAwKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jYWxjUmVsYXRpdmUgPSB0aGlzLl9jYWxjUmVsYXRpdmU7Ly90aGlzLl9nZXRSZWxhdGl2ZUZ1bmN0aW9uKCk7Ly90aGlzLl9fb2xkX2NhbGNSZWxhdGl2ZTsvL1xyXG5cclxuXHRcdHRoaXMuZmlsdGVyID0gbmV3IEltYWdlRmlsdGVyKCk7XHJcblx0XHR0aGlzLm9wYWNpdHkgPSAxO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMudmlzaWJsZSA9IHRydWU7XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIGV4dHJhIHByb3BlcnR5LiAqL1xyXG5cdFx0dGhpcy5fc2xvdCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9IC0gZXh0cmEgcHJvcGVydHkuIOWcqOWTquWAi+mDqOS9jSAqL1xyXG5cdFx0dGhpcy5fcGxhY2UgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIGV4dHJhIHByb3BlcnR5OiBfc2xvdCBpdGVtSWQsIF9wbGFjZSwgX3Jhdy56IHogKi9cclxuXHRcdHRoaXMuY2xhc3NMaXN0ID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0IHooKSB7XHJcblx0XHRyZXR1cm4gek1hcFt0aGlzLl9yYXcuel0gfHwgMTtcclxuXHR9XHJcblx0c2V0IHoobm90X3ZhbHVlKSB7XHJcblx0XHRjb25zb2xlLmVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0IG9yZGVyKCkge1xyXG5cdFx0ZGVidWdnZXI7XHJcblx0XHRyZXR1cm4gdGhpcy56O1xyXG5cdH1cclxuXHRzZXQgb3JkZXIobm90X3ZhbHVlKSB7XHJcblx0XHRkZWJ1Z2dlcjtcclxuXHRcdGNvbnNvbGUuZXJyb3IobmV3IFR5cGVFcnJvcihcIk5vdCBpbXBsZW1lbnRcIikpO1xyXG5cdH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtWZWMyfSAqL1xyXG5cdGdldCBvcmlnaW4oKSB7IHJldHVybiB0aGlzLl9yYXcub3JpZ2luIHx8IFZlYzIuZW1wdHk7IH1cclxuXHJcblx0aXNIYXNBbmNob3IoKSB7IHJldHVybiAhIXRoaXMuX3Jhdy5tYXA7IH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtWZWMyfSAqL1xyXG5cdGdldCBicm93KCkgeyByZXR1cm4gdGhpcy5fcmF3Lm1hcC5icm93OyB9XHJcblx0aXNBbmNob3JCcm93KCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwLmJyb3c7IH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtWZWMyfSAqL1xyXG5cdGdldCBuZWNrKCkgeyByZXR1cm4gdGhpcy5fcmF3Lm1hcC5uZWNrOyB9XHJcblx0aXNBbmNob3JOZWNrKCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwLm5lY2s7IH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtWZWMyfSAqL1xyXG5cdGdldCBuYXZlbCgpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAubmF2ZWw7IH1cclxuXHRpc0FuY2hvck5hdmVsKCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwLm5hdmVsOyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgaGFuZCgpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAuaGFuZDsgfVxyXG5cdGlzQW5jaG9ySGFuZCgpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5oYW5kOyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgaGFuZE1vdmUoKSB7IHJldHVybiB0aGlzLl9yYXcubWFwLmhhbmRNb3ZlOyB9XHJcblx0aXNBbmNob3JIYW5kTW92ZSgpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5oYW5kTW92ZTsgfVxyXG5cclxuXHJcblx0LyoqIEByZXR1cm5zIHtWZWMyfSAqL1xyXG5cdGdldCBfZWFyQmVsb3dIZWFkKCkgeyByZXR1cm4gdGhpcy5fcmF3Lm1hcC5lYXJCZWxvd0hlYWQ7IH1cclxuXHRpc0FuY2hvcl9FYXJCZWxvd0hlYWQoKSB7IHJldHVybiAhIXRoaXMuX3Jhdy5tYXAuZWFyQmVsb3dIZWFkOyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgX2Vhck92ZXJIZWFkKCkgeyByZXR1cm4gdGhpcy5fcmF3Lm1hcC5lYXJPdmVySGVhZDsgfVxyXG5cdGlzQW5jaG9yX0Vhck92ZXJIZWFkKCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwLmVhck92ZXJIZWFkOyB9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSB0aGF0IC0gdGhpc1xyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBiYXNlIC0gcGFyZW50XHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGFuY2hvciAtIGFuY2hvciBuYW1lXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2FuY2hvcih0aGF0LCBiYXNlLCBhbmNob3IpIHtcclxuXHRcdHJldHVybiBiYXNlW2FuY2hvcl0ubWludXModGhhdFthbmNob3JdKS5wbHVzKGJhc2Uub3JpZ2luLm1pbnVzKHRoYXQub3JpZ2luKSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGJvZHlcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gW2hlYWRdXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2NhbGNSZWxhdGl2ZShjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0dGhpcy5jYWxjUmVsYXRpdmUgPSB0aGlzLl9nZXRSZWxhdGl2ZUZ1bmN0aW9uKGNoYXJhKTtcclxuXHRcdHJldHVybiB0aGlzLmNhbGNSZWxhdGl2ZShjaGFyYSwgYm9keSwgaGVhZCk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfZ2V0UmVsYXRpdmVGdW5jdGlvbihjaGFyYSkge1xyXG5cdFx0aWYgKCF0aGlzLmlzSGFzQW5jaG9yKCkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NhbGNSZWxhdGl2ZUVtcHR5O1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNBbmNob3JOZWNrKCkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NhbGNSZWxhdGl2ZV9uZWNrO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNBbmNob3JCcm93KCkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NhbGNSZWxhdGl2ZV9icm93O1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNBbmNob3JOYXZlbCgpKSB7XHJcblx0XHRcdGlmICh0aGlzID09IGNoYXJhLnNsb3RzLmJvZHkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fZ2V0T3JpZ2luO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVfbmF2ZWw7XHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy5pc0FuY2hvckhhbmQoKSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY2FsY1JlbGF0aXZlX2hhbmQ7XHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy5pc0FuY2hvckhhbmRNb3ZlKCkpIHtcclxuXHRcdFx0aWYgKHRoaXMuX3VybC5sYXN0SW5kZXhPZihcImxIYW5kXCIpID4gMCkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVfaGFuZE1vdmVfbEhhbmQ7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NhbGNSZWxhdGl2ZV9oYW5kTW92ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmVFbXB0eShjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIFZlYzIuZW1wdHk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfZ2V0T3JpZ2luKGNoYXJhLCBib2R5LCBoZWFkKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5vcmlnaW47XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIG5lY2sgb24gdGhlIG5hdmVsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmVfbmVjayhjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2FuY2hvcih0aGlzLCBib2R5LCBcIm5lY2tcIikubWludXMoYm9keS5vcmlnaW4pO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBicm93IG9uIHRoZSBoZWFkICYgaGVhZCBvbiB0aGUgbmVjayAmIG5lY2sgb24gdGhlIG5hdmVsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmVfYnJvdyhjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2FuY2hvcih0aGlzLCBoZWFkLCBcImJyb3dcIikucGx1cyh0aGlzLl9hbmNob3IoaGVhZCwgYm9keSwgXCJuZWNrXCIpKS5taW51cyhib2R5Lm9yaWdpbik7Ly9hbmNob3JfYnJvdysoLTcsLTMzKVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiB0aGlzIGlzIG9yaWdpbiBwb2ludCwgbm8gYW5jaG9yXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmVfbmF2ZWwoY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdHJldHVybiBib2R5Lm5hdmVsLm1pbnVzKHRoaXMubmF2ZWwpLm1pbnVzKHRoaXMub3JpZ2luKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmVfaGFuZChjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0Y29uc3QgaGFuZCA9IGNoYXJhLnNsb3RzLmJvZHkuZnJhZ21lbnRzLmFybS5nZXRUZXh0dXJlKGNoYXJhKTtcclxuXHRcdGlmIChoYW5kID09IG51bGwpIHtcclxuXHRcdFx0cmV0dXJuIFZlYzIuZW1wdHkubWludXModGhpcy5oYW5kKS5taW51cyh0aGlzLm9yaWdpbikubWludXMoYm9keS5vcmlnaW4pO1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLl9hbmNob3IodGhpcywgaGFuZCwgXCJoYW5kXCIpLm1pbnVzKHRoaXMuX2FuY2hvcihib2R5LCBoYW5kLCBcIm5hdmVsXCIpKS5taW51cyhib2R5Lm9yaWdpbik7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX2hhbmRNb3ZlKGNoYXJhLCBib2R5LCBoZWFkKSB7XHJcblx0XHRyZXR1cm4gVmVjMi5lbXB0eS5taW51cyh0aGlzLm9yaWdpbikubWludXModGhpcy5oYW5kTW92ZSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX2hhbmRNb3ZlX2xIYW5kKGNoYXJhLCBib2R5LCBoZWFkKSB7XHJcblx0XHRyZXR1cm4gVmVjMi5lbXB0eS5taW51cyh0aGlzLm9yaWdpbik7XHJcblx0fVxyXG5cdFxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICovXHJcblx0dXBkYXRlKGNoYXJhKSB7XHJcblx0XHRpZiAoY2hhcmEuc2xvdHMuYm9keSAmJiBjaGFyYS5zbG90cy5oZWFkKSB7XHJcblx0XHRcdGNvbnN0IGJvZHkgPSBjaGFyYS5zbG90cy5ib2R5LmZyYWdtZW50cy5ib2R5LmdldFRleHR1cmUoY2hhcmEpO1xyXG5cdFx0XHRjb25zdCBoZWFkID0gY2hhcmEuc2xvdHMuaGVhZC5mcmFnbWVudHMuaGVhZC5nZXRUZXh0dXJlKGNoYXJhKTtcclxuXHRcdFx0aWYgKGJvZHkgJiYgaGVhZCkge1xyXG5cdFx0XHRcdHRoaXMucmVsYXRpdmUgPSB0aGlzLmNhbGNSZWxhdGl2ZShjaGFyYSwgYm9keSwgaGVhZCk7XHJcblxyXG5cdFx0XHRcdGNvbnN0IHRhbWluZ01vYiA9IGNoYXJhLnNsb3RzLnRhbWluZ01vYjtcclxuXHRcdFx0XHRpZiAodGFtaW5nTW9iKSB7XHJcblx0XHRcdFx0XHR0aGlzLnJlbGF0aXZlID0gdGFtaW5nTW9iLmFkal9wb3ModGhpcy5yZWxhdGl2ZSwgYm9keSwgY2hhcmEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqL1xyXG5cdHJlbmRlcihyZW5kZXJlciwgY2hhcmEpIHtcclxuXHRcdGlmICghKHRoaXMucmVsYXRpdmUgJiYgdGhpcy52aXNpYmxlKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCB4ID0gdGhpcy5yZWxhdGl2ZS54O1xyXG5cdFx0Y29uc3QgeSA9IHRoaXMucmVsYXRpdmUueTtcclxuXHJcblx0XHRyZW5kZXJlci5nbG9iYWxBbHBoYSA9IHRoaXMub3BhY2l0eTtcclxuXHRcdGlmICh0aGlzLmZpbHRlci5pc0VtcHR5KSB7XHJcblx0XHRcdHJlbmRlcmVyLmRyYXdHcmFwaDIodGhpcywgeCwgeSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmVuZGVyZXIuY3R4LmZpbHRlciA9IHRoaXMuZmlsdGVyLnRvU3RyaW5nKCk7XHJcblx0XHRcdHJlbmRlcmVyLmRyYXdHcmFwaDIodGhpcywgeCwgeSk7XHJcblx0XHRcdHJlbmRlcmVyLmN0eC5maWx0ZXIgPSBcIm5vbmVcIjtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIEJvZHlGcmFnbWVudFRleHR1cmUgZXh0ZW5kcyBGcmFnbWVudFRleHR1cmUge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKi9cclxuXHR1cGRhdGUoY2hhcmEpIHtcclxuXHRcdHN1cGVyLnVwZGF0ZShjaGFyYSk7XHJcblx0XHR0aGlzLnZpc2libGUgPSAhY2hhcmEuaGlkZUJvZHk7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBIYWlyRnJhZ21lbnRUZXh0dXJlIGV4dGVuZHMgRnJhZ21lbnRUZXh0dXJlIHtcclxuXHRjb25zdHJ1Y3RvciguLi5hcmdzKSB7XHJcblx0XHRzdXBlciguLi5hcmdzKTtcclxuXHJcblx0XHQvKiogQHR5cGUge0hhaXJGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHR0aGlzLmdyYXBoMiA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtIYWlyRnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0dGhpcy5ncmFwaDMgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqL1xyXG5cdHVwZGF0ZShjaGFyYSkge1xyXG5cdFx0aWYgKGNoYXJhLnNsb3RzLmJvZHkgJiYgY2hhcmEuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHRjb25zdCBib2R5ID0gY2hhcmEuc2xvdHMuYm9keS5mcmFnbWVudHMuYm9keS5nZXRUZXh0dXJlKGNoYXJhKTtcclxuXHRcdFx0Y29uc3QgaGVhZCA9IGNoYXJhLnNsb3RzLmhlYWQuZnJhZ21lbnRzLmhlYWQuZ2V0VGV4dHVyZShjaGFyYSk7XHJcblx0XHRcdGlmIChib2R5ICYmIGhlYWQpIHtcclxuXHRcdFx0XHR0aGlzLnJlbGF0aXZlID0gdGhpcy5jYWxjUmVsYXRpdmUoY2hhcmEsIGJvZHksIGhlYWQpO1xyXG5cclxuXHRcdFx0XHRjb25zdCB0YW1pbmdNb2IgPSBjaGFyYS5zbG90cy50YW1pbmdNb2I7XHJcblx0XHRcdFx0aWYgKHRhbWluZ01vYikge1xyXG5cdFx0XHRcdFx0dGhpcy5yZWxhdGl2ZSA9IHRhbWluZ01vYi5hZGpfcG9zKHRoaXMucmVsYXRpdmUsIGJvZHksIGNoYXJhKTtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLmdyYXBoMikge1xyXG5cdFx0XHRcdFx0dGhpcy5ncmFwaDIucmVsYXRpdmUgPSB0aGlzLnJlbGF0aXZlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGhpcy5ncmFwaDMpIHtcclxuXHRcdFx0XHRcdHRoaXMuZ3JhcGgzLnJlbGF0aXZlID0gdGhpcy5yZWxhdGl2ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIGNoYXJhKSB7XHJcblx0XHRpZiAoIXRoaXMucmVsYXRpdmUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gdGhpcy5vcGFjaXR5IHx8IDE7XHJcblx0XHRpZiAodGhpcy5maWx0ZXIuaXNFbXB0eSkge1xyXG5cdFx0XHR0aGlzLl9yZW5kZXIocmVuZGVyZXIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJlbmRlcmVyLmN0eC5maWx0ZXIgPSB0aGlzLmZpbHRlci50b1N0cmluZygpO1xyXG5cdFx0XHR0aGlzLl9yZW5kZXIocmVuZGVyZXIpO1xyXG5cdFx0XHRyZW5kZXJlci5jdHguZmlsdGVyID0gXCJub25lXCI7XHJcblx0XHR9XHJcblx0fVxyXG5cdF9yZW5kZXIocmVuZGVyZXIpIHtcclxuXHRcdGNvbnN0IHggPSB0aGlzLnJlbGF0aXZlLng7XHJcblx0XHRjb25zdCB5ID0gdGhpcy5yZWxhdGl2ZS55O1xyXG5cclxuXHRcdHJlbmRlcmVyLmRyYXdHcmFwaDIodGhpcywgeCwgeSk7XHJcblxyXG5cdFx0aWYgKHRoaXMuZ3JhcGgyICYmIHRoaXMuZ3JhcGgyLm9wYWNpdHkpIHsvL2NvbG9yMlxyXG5cdFx0XHRyZW5kZXJlci5nbG9iYWxBbHBoYSA9IHRoaXMuZ3JhcGgyLm9wYWNpdHk7XHJcblxyXG5cdFx0XHRyZW5kZXJlci5kcmF3R3JhcGgyKHRoaXMuZ3JhcGgyLCB4LCB5KTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmdyYXBoMyAmJiB0aGlzLmdyYXBoMy5vcGFjaXR5KSB7Ly9jb2xvcjNcclxuXHRcdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLmdyYXBoMy5vcGFjaXR5O1xyXG5cclxuXHRcdFx0cmVuZGVyZXIuZHJhd0dyYXBoMih0aGlzLmdyYXBoMywgeCwgeSk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5cclxuY2xhc3MgSXRlbUVmZmVjdEFuaW1hdGlvbiBleHRlbmRzIEFuaW1hdGlvbiB7XHJcblx0Y29uc3RydWN0b3IocmF3LCB1cmwpIHtcclxuXHRcdHN1cGVyKHJhdywgdXJsKTtcclxuXHRcdFxyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX3Jhd1wiLCB7XHJcblx0XHRcdHZhbHVlOiByYXcsXHJcblx0XHR9KTtcclxuXHJcblx0XHQvL3RoaXMuX3VybCA9IHRoaXMuX3VybDtcclxuXHJcblx0XHR0aGlzLl9fZ2V0QXR0cihcInpcIiwgLTEpO1xyXG5cdFx0dGhpcy5fX2dldEF0dHIoXCJwb3NcIiwgMSk7XHJcblxyXG5cdFx0c3VwZXIubG9hZCgpO1xyXG5cdH1cclxuXHRfX2dldEF0dHIoYXR0ciwgZGVmVmFsKSB7XHJcblx0XHRpZiAoYXR0ciBpbiB0aGlzLl9yYXcpIHtcclxuXHRcdFx0dGhpc1thdHRyXSA9IHRoaXMuX3Jhd1thdHRyXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzW2F0dHJdID0gZGVmVmFsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBhY3Rpb25FeGNlcHRSb3RhdGlvblxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZVxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxpcFxyXG5cdCAqL1xyXG5cdHJlbmRlcihyZW5kZXJlciwgYWN0aW9uRXhjZXB0Um90YXRpb24sIGFuZ2xlLCBmbGlwKSB7XHJcblx0XHRpZiAoYWN0aW9uRXhjZXB0Um90YXRpb24pIHtcclxuXHRcdFx0dGhpcy5kcmF3KHJlbmRlcmVyLCAwLCAwLCAtYW5nbGUsIGZsaXApO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGNvbnN0IG95ID0gLXRoaXMudGV4dHVyZS5oZWlnaHQgKiAwLjI1O1xyXG5cdFx0XHR0aGlzLmRyYXcocmVuZGVyZXIsIDAsIG95LCAwLCBmbGlwKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8vXHQvZGF0YS9FZmZlY3QvSXRlbUVmZi8xMTAyOTE4XHJcbmNsYXNzIEl0ZW1FZmZlY3Qge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5fdXJsID0gbnVsbDtcclxuXHRcdHRoaXMuX3JhdyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHt7W2FuaW1hdGlvbk5hbWU6c3RyaW5nXTpJdGVtRWZmZWN0QW5pbWF0aW9ufX0gKi9cclxuXHRcdHRoaXMuYW5pbWF0aW9uID0ge307XHJcblxyXG5cdFx0dGhpcy5hY3Rpb24gPSBudWxsO1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cclxuXHRcdHRoaXMuZml4ZWQgPSAwO1xyXG5cdFx0dGhpcy56ID0gLTI7XHJcblx0XHR0aGlzLmFjdGlvbiA9IDE7XHJcblx0XHR0aGlzLmFjdGlvbkV4Y2VwdFJvdGF0aW9uID0gMDtcclxuXHRcdFxyXG5cdFx0dGhpcy5lbmFibGUgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGFzeW5jIEluaXQoKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHQvKiogQHR5cGUge1NldDxzdHJpbmc+fSAqL1xyXG5cdFx0XHRsZXQgaXRlbUVmZmVjdExpc3QgPSBJdGVtRWZmZWN0Ll9saXN0O1xyXG5cclxuXHRcdFx0LyoqIEB0eXBlIHtzdHJpbmdbXX0gKi9cclxuXHRcdFx0bGV0IHJhdyA9IGF3YWl0ICRnZXQubGlzdChcIi9FZmZlY3QvSXRlbUVmZlwiKTtcclxuXHJcblx0XHRcdGl0ZW1FZmZlY3RMaXN0LmNsZWFyKCk7XHJcblxyXG5cdFx0XHRyYXcuZm9yRWFjaChpZCA9PiB7XHJcblx0XHRcdFx0aXRlbUVmZmVjdExpc3QuYWRkKHBhcnNlSW50KGlkLCAxMCkpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBpZiAoIWV4aXN0KSByZXR1cm4gbnVsbFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBlcXVpcElEXHJcblx0ICogQHJldHVybnMge1Byb21pc2U8SXRlbUVmZmVjdD59XHJcblx0ICovXHJcblx0c3RhdGljIGFzeW5jIGxvYWQoZXF1aXBJRCkge1xyXG5cdFx0Y29uc3QgaWQgPSBOdW1iZXIoZXF1aXBJRCk7XHJcblxyXG5cdFx0aWYgKEl0ZW1FZmZlY3QuX2xpc3QuaGFzKGlkKSkge1xyXG5cdFx0XHRsZXQgZWZmID0gbmV3IEl0ZW1FZmZlY3QoKTtcclxuXHRcdFx0YXdhaXQgZWZmLmxvYWQoZXF1aXBJRCk7XHJcblx0XHRcdHJldHVybiBlZmY7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBpZiAoIWV4aXN0KSByZXR1cm4gbnVsbFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBlcXVpcElEXHJcblx0ICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XHJcblx0ICovXHJcblx0YXN5bmMgbG9hZChlcXVpcElEKSB7XHJcblx0XHRjb25zdCBpZCA9IE51bWJlcihlcXVpcElEKTtcclxuXHRcdGNvbnN0IHVybCA9IGAvRWZmZWN0L0l0ZW1FZmYvJHtpZH0vZWZmZWN0YDtcclxuXHRcdGxldCByYXc7XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0cmF3ID0gYXdhaXQgJGdldC5kYXRhKHVybCk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0dGhyb3cgZXg7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHJhdykge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fbG9hZChlcXVpcElELCB1cmwsIHJhdyk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wLCBhY3Rpb24pIHtcclxuXHRcdGlmIChhY3Rpb24gaW4gdGhpcy5hbmltYXRpb24pIHtcclxuXHRcdFx0dGhpcy5hY3Rpb24gPSBhY3Rpb247XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5hY3Rpb24gPSBcImRlZmF1bHRcIjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy5hbmltYXRpb25bdGhpcy5hY3Rpb25dKSB7XHJcblx0XHRcdHRoaXMuYW5pbWF0aW9uW3RoaXMuYWN0aW9uXS51cGRhdGUoc3RhbXApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJSZW5kZXJlcn0gY2hhcmFcclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIGNoYXJhKSB7XHJcblx0XHRpZiAodGhpcy5hbmltYXRpb24gJiYgdGhpcy5hbmltYXRpb25bdGhpcy5hY3Rpb25dKSB7XHJcblx0XHRcdHRoaXMuYW5pbWF0aW9uW3RoaXMuYWN0aW9uXS5yZW5kZXIocmVuZGVyZXIsIHRoaXMuYWN0aW9uRXhjZXB0Um90YXRpb24sIGNoYXJhLmFuZ2xlLCBjaGFyYS5mcm9udCA+IDApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGVxdWlwSURcclxuXHQgKiBAcGFyYW0ge29iamVjdH0gcmF3X2RhdGFcclxuXHQgKi9cclxuXHRfbG9hZChlcXVpcElELCB1cmwsIHJhdykge1xyXG5cdFx0dGhpcy5pZCA9IGVxdWlwSUQ7XHJcblxyXG5cdFx0aWYgKCFyYXcpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHQvL3RoaXMuX3VybCA9IHVybDtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9yYXdcIiwge1xyXG5cdFx0XHR2YWx1ZTogcmF3LFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5fX2NvbnN0cnVjdCgpO1xyXG5cdH1cclxuXHRfX2NvbnN0cnVjdCgpIHtcclxuXHRcdHRoaXMuX19nZXRBdHRyKFwiZml4ZWRcIiwgMCk7XHJcblx0XHR0aGlzLl9fZ2V0QXR0cihcInpcIiwgLTEpO1xyXG5cdFx0dGhpcy5fX2dldEF0dHIoXCJhY3Rpb25cIiwgMSk7XHJcblx0XHR0aGlzLl9fZ2V0QXR0cihcImFjdGlvbkV4Y2VwdFJvdGF0aW9uXCIsIDApO1xyXG5cclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5fcmF3KSB7XHJcblx0XHRcdGlmICh0aGlzLl9yYXdbaV0gJiYgdHlwZW9mIHRoaXMuX3Jhd1tpXSA9PSBcIm9iamVjdFwiICYmICcwJyBpbiB0aGlzLl9yYXdbaV0pIHsvL2FuaW1hdGlvbiBoYXMgZnJhbWVzXHJcblx0XHRcdFx0dGhpcy5hbmltYXRpb25baV0gPSBuZXcgSXRlbUVmZmVjdEFuaW1hdGlvbih0aGlzLl9yYXdbaV0sIFt0aGlzLl91cmwsIGldLmpvaW4oXCIvXCIpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRfX2dldEF0dHIoYXR0ciwgZGVmVmFsKSB7XHJcblx0XHRpZiAoYXR0ciBpbiB0aGlzLl9yYXcpIHtcclxuXHRcdFx0dGhpc1thdHRyXSA9IHRoaXMuX3Jhd1thdHRyXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzW2F0dHJdID0gZGVmVmFsO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4vKiogQHR5cGUge1NldDxzdHJpbmc+fSAqL1xyXG5JdGVtRWZmZWN0Ll9saXN0ID0gbmV3IFNldCgpO1xyXG5cclxuY2xhc3MgQ2hhcmFjdGVyRnJhZ21lbnRCYXNlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3tbYWN0aW9uOnN0cmluZ106IEZyYWdtZW50VGV4dHVyZVtdfX0gdGV4dHVyZXNcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3Rvcih0ZXh0dXJlcykge1xyXG5cdFx0LyoqIEB0eXBlIHt7W2FjdGlvbjpzdHJpbmddOiBGcmFnbWVudFRleHR1cmVbXX19IC0gdGV4dHVyZXNbYWN0aW9uOnN0cmluZ11bZnJhbWU6bnVtYmVyXSAqL1xyXG5cdFx0dGhpcy50ZXh0dXJlcyA9IHRleHR1cmVzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge0ZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXRUZXh0dXJlKGNoYXJhKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGZyYW1lXHJcblx0ICogQHJldHVybnMge0ZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXRGcmFtZVRleHR1cmUoY2hhcmEsIGZyYW1lKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBmaW5hbCBcclxuICovXHJcbmNsYXNzIENoYXJhY3RlckJvZHlGcmFnbWVudCBleHRlbmRzIENoYXJhY3RlckZyYWdtZW50QmFzZSB7XHJcblx0Y29uc3RydWN0b3IodGV4dHVyZXMpIHtcclxuXHRcdHN1cGVyKHRleHR1cmVzKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldFRleHR1cmUoY2hhcmEpIHtcclxuXHRcdHJldHVybiB0aGlzLmdldEZyYW1lVGV4dHVyZShjaGFyYSwgY2hhcmEuYWN0aW9uX2ZyYW1lKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBmcmFtZVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBmcmFtZSkge1xyXG5cdFx0aWYgKCEoY2hhcmEuYWN0aW9uIGluIHRoaXMudGV4dHVyZXMpKSB7XHJcblx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGZ0ID0gdGhpcy50ZXh0dXJlc1tjaGFyYS5hY3Rpb25dW2ZyYW1lXTsvL2lmIGZyYW1lIG5vdCBleGlzdCB0aGVuIHJldHVybiB1bmRlZmluZWRcclxuXHRcdHJldHVybiBmdDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lQ291bnQoY2hhcmEpIHtcclxuXHRcdGlmICh0aGlzLnRleHR1cmVzW2NoYXJhLmFjdGlvbl0pIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudGV4dHVyZXNbY2hhcmEuYWN0aW9uXS5sZW5ndGg7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMDtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAZmluYWwgXHJcbiAqL1xyXG5jbGFzcyBDaGFyYWN0ZXJGYWNlRnJhZ21lbnQgZXh0ZW5kcyBDaGFyYWN0ZXJGcmFnbWVudEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKHRleHR1cmVzKSB7XHJcblx0XHRzdXBlcih0ZXh0dXJlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge0ZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXRUZXh0dXJlKGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5nZXRGcmFtZVRleHR1cmUoY2hhcmEsIGNoYXJhLmVtb3Rpb25fZnJhbWUpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBmcmFtZVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBmcmFtZSkge1xyXG5cdFx0aWYgKCEoY2hhcmEuZW1vdGlvbiBpbiB0aGlzLnRleHR1cmVzKSkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGxldCBmdCA9IHRoaXMudGV4dHVyZXNbY2hhcmEuZW1vdGlvbl1bZnJhbWVdO1xyXG5cdFx0cmV0dXJuIGZ0O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVDb3VudChjaGFyYSkge1xyXG5cdFx0aWYgKHRoaXMudGV4dHVyZXNbY2hhcmEuZW1vdGlvbl0pIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudGV4dHVyZXNbY2hhcmEuZW1vdGlvbl0ubGVuZ3RoO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIDA7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQGZpbmFsIFxyXG4gKi9cclxuY2xhc3MgQ2hhcmFjdGVyVGFtaW5nTW9iRnJhZ21lbnQgZXh0ZW5kcyBDaGFyYWN0ZXJGcmFnbWVudEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKHRleHR1cmVzKSB7XHJcblx0XHRzdXBlcih0ZXh0dXJlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge0ZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXRUZXh0dXJlKGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5nZXRGcmFtZVRleHR1cmUoY2hhcmEsIGNoYXJhLl9hY3Rpb25fZnJhbWUpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBmcmFtZVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBmcmFtZSkge1xyXG5cdFx0aWYgKCEoY2hhcmEuX3JpZGVfYWN0aW9uIGluIHRoaXMudGV4dHVyZXMpKSB7XHJcblx0XHRcdHJldHVybiBudWxsO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGZ0ID0gdGhpcy50ZXh0dXJlc1tjaGFyYS5fcmlkZV9hY3Rpb25dW2ZyYW1lXTsvL2lmIGZyYW1lIG5vdCBleGlzdCB0aGVuIHJldHVybiB1bmRlZmluZWRcclxuXHRcdHJldHVybiBmdDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lQ291bnQoY2hhcmEpIHtcclxuXHRcdGlmICh0aGlzLnRleHR1cmVzW2NoYXJhLl9yaWRlX2FjdGlvbl0pIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMudGV4dHVyZXNbY2hhcmEuX3JpZGVfYWN0aW9uXS5sZW5ndGg7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMDtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIEVxdWlwSW1hZ2VGaWx0ZXIge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9IGVxdWlwXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoZXF1aXApIHtcclxuXHRcdHRoaXMuZXF1aXAgPSBlcXVpcDtcclxuXHR9XHJcblxyXG5cdGdldCBodWUoKSB7XHJcblx0XHRjb25zdCBlcXVpcCA9IHRoaXMuZXF1aXA7XHJcblx0XHRmb3IgKGxldCBpIGluIGVxdWlwLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZnQuZmlsdGVyLmh1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGh1ZSh2YWx1ZSkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLmh1ZSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0IHNhdCgpIHtcclxuXHRcdGNvbnN0IGVxdWlwID0gdGhpcy5lcXVpcDtcclxuXHRcdGZvciAobGV0IGkgaW4gZXF1aXAuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmdC5maWx0ZXIuc2F0O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRzZXQgc2F0KHZhbHVlKSB7XHJcblx0XHRjb25zdCBlcXVpcCA9IHRoaXMuZXF1aXA7XHJcblx0XHRmb3IgKGxldCBpIGluIGVxdWlwLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRmdC5maWx0ZXIuc2F0ID0gdmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGdldCBicmkoKSB7XHJcblx0XHRjb25zdCBlcXVpcCA9IHRoaXMuZXF1aXA7XHJcblx0XHRmb3IgKGxldCBpIGluIGVxdWlwLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZnQuZmlsdGVyLmJyaTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGJyaSh2YWx1ZSkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLmJyaSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0IGNvbnRyYXN0KCkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0LmZpbHRlci5jb250cmFzdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGNvbnRyYXN0KHZhbHVlKSB7XHJcblx0XHRjb25zdCBlcXVpcCA9IHRoaXMuZXF1aXA7XHJcblx0XHRmb3IgKGxldCBpIGluIGVxdWlwLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRmdC5maWx0ZXIuY29udHJhc3QgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHRvSlNPTigpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGh1ZTogdGhpcy5odWUsXHJcblx0XHRcdHNhdDogdGhpcy5zYXQsXHJcblx0XHRcdGJyaTogdGhpcy5icmksXHJcblx0XHRcdGNvbnRyYXN0OiB0aGlzLmNvbnRyYXN0LFxyXG5cdFx0fTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaW50ZXJmYWNlXHJcbiAqL1xyXG5jbGFzcyBJQ2hhcmFjdGVyQXBwZWFyYW5jZUJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHRpc0xvYWRlZCgpIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICovXHJcblx0X3VubG9hZCgpIHtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVDb3VudChjaGFyYSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RGVsYXkoY2hhcmEpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqL1xyXG5cdHRvSlNPTigpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRpZDogLTEsLy9pbnZhbGlkIElEXHJcblx0XHR9O1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqID8/XHJcbiAqL1xyXG5jbGFzcyBfQ2hhcmFjdGVyQXBwZWFyYW5jZUJhc2VTbG90TGluayBleHRlbmRzIElDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSB7XHJcblx0Y29uc3RydWN0b3Ioc2xvdF9saW5rKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy5zbG90X2xpbmsgPSBzbG90X2xpbms7Ly8/P1xyXG5cdH1cclxuXHJcblx0dG9KU09OKCkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0aWQ6IHNsb3RfbGluaywvLz8/XHJcblx0XHR9O1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIGNoYXJhY3RlciBsb2FkZXJcclxuICovXHJcbmNsYXNzIENoYXJhY3RlckFwcGVhcmFuY2VCYXNlIGV4dGVuZHMgSUNoYXJhY3RlckFwcGVhcmFuY2VCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHRcdFxyXG5cdFx0dGhpcy5fcmF3ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdC8vdGhpcy5fdXJsID0gbnVsbDtcclxuXHRcdFx0XHJcblx0XHQvKiogQHR5cGUge0l0ZW1FZmZlY3R9ICovXHJcblx0XHR0aGlzLmVmZmVjdCA9IG51bGw7XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBAdHlwZSB7e1twbGFjZTpzdHJpbmddOkNoYXJhY3RlckZyYWdtZW50QmFzZX19XHJcblx0XHQgKi9cclxuXHRcdHRoaXMuZnJhZ21lbnRzID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLl9vbmxvYWQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5pZCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtJdGVtQ2F0ZWdvcnlJbmZvfSAqL1xyXG5cdFx0dGhpcy5jYXRlZ29yeUluZm8gPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5zbG90X29yZGVyID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge29iamVjdDxzdHJpbmcsIG51bWJlcj59ICovXHJcblx0XHR0aGlzLmlzbG90ID0ge307XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtvYmplY3Q8c3RyaW5nLCBudW1iZXI+fSAqL1xyXG5cdFx0dGhpcy52c2xvdCA9IHt9O1xyXG5cclxuXHRcdHRoaXMuZmlsdGVyID0gbmV3IEVxdWlwSW1hZ2VGaWx0ZXIodGhpcyk7XHJcblx0fVxyXG5cclxuXHR0b0pTT04oKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRpZDogdGhpcy5pZCxcclxuXHRcdFx0ZmlsdGVyOiB0aGlzLmZpbHRlci50b0pTT04oKSxcclxuXHRcdH07XHJcblx0fVxyXG5cclxuXHRpc0xvYWRlZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmZyYWdtZW50cyAhPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtmdW5jdGlvbihDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSk6dm9pZH0gKi9cclxuXHRnZXQgX29ubG9hZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9fb25sb2FkO1xyXG5cdH1cclxuXHRzZXQgX29ubG9hZChmdW5jKSB7XHJcblx0XHR0aGlzLl9fb25sb2FkID0gZnVuYztcclxuXHRcdGlmICh0aGlzLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0dGhpcy5fX29ubG9hZC5jYWxsKHRoaXMsIHRoaXMpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHVybFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqIEBwYXJhbSB7SXRlbUNhdGVnb3J5SW5mb30gY2F0ZUluZm9cclxuXHQgKiBAcGFyYW0ge3ZvaWR9IHVzZV9jYXRlZ29yeSAtIG5vIHVzZVxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIHRydWUgaWYgaXRlbSBleGlzdFxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQodXJsLCBpZCwgY2F0ZUluZm8sIHVzZV9jYXRlZ29yeSkge1xyXG5cdFx0bGV0IHJhdztcclxuXHJcblx0XHR0aGlzLmlkID0gaWQ7XHJcblx0XHR0aGlzLmNhdGVnb3J5SW5mbyA9IGNhdGVJbmZvO1xyXG5cdFx0XHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAoUmVzb3VyY2VNYW5hZ2VyLmlzRXF1aXBFeGlzdChpZCwgY2F0ZUluZm8pKSB7XHJcblx0XHRcdFx0cmF3ID0gYXdhaXQgSXRlbUNhdGVnb3J5SW5mby5nZXRJdGVtKGlkKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdHRocm93IGV4O1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAoIXJhdyAmJiBsb2FkX2V4dGVybl9pdGVtX2RhdGEpIHtcclxuXHRcdFx0XHRyYXcgPSBhd2FpdCBsb2FkX2V4dGVybl9pdGVtX2RhdGEoaWQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0dGhyb3cgZXg7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly90aGlzLl91cmwgPSB1cmw7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJfcmF3XCIsIHtcclxuXHRcdFx0dmFsdWU6IHJhdyxcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuX19sb2FkX3Nsb3QoKTtcclxuXHJcblx0XHR0aGlzLl9fbG9hZF9mcmFnbWVudHMoKTtcclxuXHJcblx0XHRpZiAodGhpcy5fb25sb2FkKSB7XHJcblx0XHRcdHRoaXMuX29ubG9hZC5jYWxsKHRoaXMsIHRoaXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vLy8gaWYgbm90IGJvZHksIGhlYWQsIGZhY2UsIGhhaXIgdGhlbiB0cnkgbG9hZCBlZmZlY3RcclxuXHRcdC8vaWYgKGlkID49IFwiMDAwNTAwMDBcIikge1xyXG5cdFx0XHQvLyBsb2FkIGlmIGV4aXN0XHJcblx0XHRcdEl0ZW1FZmZlY3QubG9hZCh0aGlzLmlkKS50aGVuKGEgPT4gdGhpcy5lZmZlY3QgPSBhKTsvLzAxMTAyOTE4XHQvLzAxMTAyOTE1XHJcblx0XHQvL31cclxuXHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblx0X19sb2FkX2ZyYWdtZW50cygpIHtcclxuXHRcdGNvbnN0IEZyYWdtZW50Q29uc3RydWN0b3IgPSB0aGlzLkZyYWdtZW50Q29uc3RydWN0b3I7XHJcblxyXG5cdFx0Ly9PYmplY3Qua2V5cyh0aGlzLl9yYXdfdGV4dHVyZXMpLm1hcChrID0+IHsgcmV0dXJuICcwJyBpbiB0aGlzLl9yYXdfdGV4dHVyZXNba107IH0pXHJcblxyXG5cdFx0bGV0IGFjdGlvbl9saXN0ID0gT2JqZWN0LmtleXModGhpcy5fcmF3X3RleHR1cmVzKTtcclxuXHJcblx0XHRsZXQgdGV4dHVyZXMgPSB7fTtcclxuXHRcdGZvciAobGV0IGFjdGlvbiBvZiBhY3Rpb25fbGlzdCkge1xyXG5cdFx0XHRpZiAodHlwZW9mIHRoaXMuX3Jhd190ZXh0dXJlc1thY3Rpb25dID09IFwib2JqZWN0XCIgJiYgXCIwXCIgaW4gdGhpcy5fcmF3X3RleHR1cmVzW2FjdGlvbl0pIHtcclxuXHRcdFx0XHRsZXQgX3VybCA9IHRoaXMuX2Jhc2VfcGF0aCArIGFjdGlvbjtcclxuXHJcblx0XHRcdFx0dGV4dHVyZXNbYWN0aW9uXSA9IHRoaXMuX19sb2FkX2ZyYW1lX3RleHR1cmVzKHRoaXMuX3Jhd190ZXh0dXJlc1thY3Rpb25dLCBfdXJsKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBmcmFnbWVudF90ZXh0dXJlcyA9IHt9O1xyXG5cdFx0Zm9yIChsZXQgYWN0aW9uIGluIHRleHR1cmVzKSB7XHJcblx0XHRcdGZvciAobGV0IGZyYW1lIGluIHRleHR1cmVzW2FjdGlvbl0pIHtcclxuXHRcdFx0XHRmb3IgKGxldCBwbGFjZSBpbiB0ZXh0dXJlc1thY3Rpb25dW2ZyYW1lXSkge1xyXG5cdFx0XHRcdFx0aWYgKCEocGxhY2UgaW4gZnJhZ21lbnRfdGV4dHVyZXMpKSB7XHJcblx0XHRcdFx0XHRcdGZyYWdtZW50X3RleHR1cmVzW3BsYWNlXSA9IHt9O1xyXG5cdFx0XHRcdFx0XHQvL2ZyYWdtZW50X3RleHR1cmVzW3BsYWNlXS52aXNpYmxlID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmICghKGFjdGlvbiBpbiBmcmFnbWVudF90ZXh0dXJlc1twbGFjZV0pKSB7XHJcblx0XHRcdFx0XHRcdGZyYWdtZW50X3RleHR1cmVzW3BsYWNlXVthY3Rpb25dID0gW107XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRmcmFnbWVudF90ZXh0dXJlc1twbGFjZV1bYWN0aW9uXVtmcmFtZV0gPSB0ZXh0dXJlc1thY3Rpb25dW2ZyYW1lXVtwbGFjZV07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0bGV0IGZyYWdtZW50cyA9IHt9O1xyXG5cdFx0Zm9yIChsZXQgZnJhZyBpbiBmcmFnbWVudF90ZXh0dXJlcykge1xyXG5cdFx0XHRmcmFnbWVudHNbZnJhZ10gPSBuZXcgRnJhZ21lbnRDb25zdHJ1Y3RvcihmcmFnbWVudF90ZXh0dXJlc1tmcmFnXSk7XHJcblx0XHR9XHJcblx0XHR0aGlzLmZyYWdtZW50cyA9IGZyYWdtZW50cztcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IF91cmxcclxuXHQgKiBAcmV0dXJucyB7e1twbGFjZTpzdHJpbmddOkZyYWdtZW50VGV4dHVyZX1bXX0gLSBhcnJheSAtIHRleHR1cmVzW2ZyYW1lXVtwbGFjZV1cclxuXHQgKi9cclxuXHRfX2xvYWRfZnJhbWVfdGV4dHVyZXMoX3JhdywgX3VybCkge1xyXG5cdFx0bGV0IHRleHR1cmVzID0gW107XHJcblx0XHRmb3IgKGxldCBmcmFtZSA9IDA7IGZyYW1lIGluIF9yYXc7ICsrZnJhbWUpIHtcclxuXHRcdFx0bGV0IHVybCA9IGAke191cmx9LyR7ZnJhbWV9YDtcclxuXHRcdFx0dGV4dHVyZXNbZnJhbWVdID0gdGhpcy5fX2xvYWRfcGxhY2VfdGV4dHVyZXMoX3Jhd1tmcmFtZV0sIHVybCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGV4dHVyZXM7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBfdXJsXHJcblx0ICogQHJldHVybnMge3tbcGxhY2U6c3RyaW5nXTpGcmFnbWVudFRleHR1cmV9fSAtIG9iamVjdCAtIHRleHR1cmVzW3BsYWNlXVxyXG5cdCAqL1xyXG5cdF9fbG9hZF9wbGFjZV90ZXh0dXJlcyhfcmF3LCBfdXJsKSB7XHJcblx0XHRsZXQgdGV4dHVyZXMgPSB7fTtcclxuXHRcdGZvciAobGV0IHBsYWNlIGluIF9yYXcpIHtcclxuXHRcdFx0bGV0IHBhdGggPSBgJHtfdXJsfS8ke3BsYWNlfWA7XHJcblx0XHRcdGxldCByYXcgPSBfcmF3W3BsYWNlXTtcclxuXHJcblx0XHRcdGlmIChyYXcpIHtcclxuXHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRjb25zdCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvciA9IHRoaXMuRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3I7XHJcblx0XHRcdFx0bGV0IGZ0O1xyXG5cdFx0XHRcdGlmIChyYXdbXCJcIl0gPT0gXCJcIikge1xyXG5cdFx0XHRcdFx0ZnQuX3VybCA9IHBhdGg7XHJcblx0XHRcdFx0XHQvL2Z0Ll91cmwgPSBwYXRoO1xyXG5cdFx0XHRcdFx0dGV4dHVyZXNbcGxhY2VdID0gZnRcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAodHlwZW9mIHJhd1tcIlwiXSA9PSAnc3RyaW5nJykge1xyXG5cdFx0XHRcdFx0ZnQgPSBuZXcgRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3IocmF3KTtcclxuXHRcdFx0XHRcdC8vZnQuX3VybCA9IHJhd1tcIlwiXTtcclxuXHRcdFx0XHRcdHRleHR1cmVzW3BsYWNlXSA9IGZ0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChwbGFjZSA9PSBcImhhaXJTaGFkZVwiKSB7XHJcblx0XHRcdFx0XHRmdCA9IG5ldyBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcihyYXdbMF0pO1xyXG5cdFx0XHRcdFx0Ly9mdC5fdXJsID0gcGF0aCArIFwiLzBcIjtcclxuXHRcdFx0XHRcdHRleHR1cmVzW3BsYWNlXSA9IGZ0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdGZ0Ll9zbG90ID0gdGhpcy5jYXRlZ29yeUluZm8uc2xvdDtcclxuXHRcdFx0XHRcdGZ0Ll9wbGFjZSA9IHBsYWNlO1xyXG5cclxuXHRcdFx0XHRcdGZ0LmNsYXNzTGlzdCA9IFtcclxuXHRcdFx0XHRcdFx0ZnQuX3Nsb3QsXHJcblx0XHRcdFx0XHRcdFwiaXRlbVwiICsgdGhpcy5pZCxcclxuXHRcdFx0XHRcdFx0ZnQuX3BsYWNlLFxyXG5cdFx0XHRcdFx0XHRmdC5fcmF3LnosXHJcblx0XHRcdFx0XHRcdCd6JyArIGZ0LnpcclxuXHRcdFx0XHRcdF0uam9pbignICcpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRleHR1cmVzO1xyXG5cdH1cclxuXHRfX2xvYWRfc2xvdCgpIHtcclxuXHRcdGlmICghdGhpcy5fcmF3LmluZm8uaXNsb3QpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGxldCBpc2xvdHMgPSB0aGlzLl9yYXcuaW5mby5pc2xvdC5tYXRjaCgvKFtBLVpdW2EtejAtOV0pL2cpO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBpc2xvdHMpIHtcclxuXHRcdFx0Y29uc3Qgc2xvdCA9IGlzbG90c1tpXTtcclxuXHRcdFx0Y29uc3Qgc2xvdF9vcmRlciA9IHpNYXBbc2xvdF07XHJcblx0XHRcdHRoaXMuaXNsb3Rbc2xvdF0gPSBzbG90X29yZGVyO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRpZiAoc2xvdF9vcmRlciA+IHRoaXMuc2xvdF9vcmRlcikgey8vdGhpcy5zbG90X29yZGVyID0gTWF0aC5tYXgodGhpcy5zbG90X29yZGVyLCBzbG90X29yZGVyKTtcclxuXHRcdFx0XHR0aGlzLnNsb3Rfb3JkZXIgPSBzbG90X29yZGVyO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0bGV0IHZzbG90cyA9IHRoaXMuX3Jhdy5pbmZvLnZzbG90Lm1hdGNoKC8oW0EtWl1bYS16MC05XSkvZyk7XHJcblx0XHRmb3IgKGxldCBpIGluIHZzbG90cykge1xyXG5cdFx0XHRjb25zdCBzbG90ID0gdnNsb3RzW2ldO1xyXG5cdFx0XHR0aGlzLnZzbG90W3Nsb3RdID0gc2xvdDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdF91bmxvYWQoKSB7XHJcblx0XHR0aGlzLmZyYWdtZW50cyA9IG51bGw7XHJcblx0XHR0aGlzLmVmZmVjdCA9PSBudWxsO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldCBvcGFjaXR5KCkge1xyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZnQub3BhY2l0eTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG9wYWNpdHlcclxuXHQgKi9cclxuXHRzZXQgb3BhY2l0eShvcGFjaXR5KSB7XHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdGZ0Lm9wYWNpdHkgPSBvcGFjaXR5O1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGh1ZSAwIH4gMzYwXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHNhdCAwIH4gMTAwXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGJyaSAwIH4gMTAwXHJcblx0ICovXHJcblx0c2V0RmlsdGVyKGh1ZSwgc2F0LCBicmkpIHtcclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLmh1ZSA9IGh1ZTtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLnNhdCA9IHNhdDtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLmJyaSA9IGJyaTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGdldCBpY29uIHVybFxyXG5cdCAqIEBzZWUge0BsaW5rIEl0ZW1DYXRlZ29yeUluZm8uZ2V0SWNvblVybH1cclxuXHQgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdGdldEljb25VcmwoKSB7XHJcblx0XHRjb25zdCBpY29uID0gdGhpcy5fcmF3LmluZm8uaWNvbjtcclxuXHRcdGlmIChpY29uKSB7XHJcblx0XHRcdHJldHVybiBpY29uW1wiXCJdO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRyZXR1cm4gSXRlbUNhdGVnb3J5SW5mby5nZXRJY29uVXJsKHRoaXMuaWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogZ2V0IGljb25SYXcgdXJsXHJcblx0ICogQHNlZSB7QGxpbmsgSXRlbUNhdGVnb3J5SW5mby5nZXRJY29uUmF3VXJsfVxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XHJcblx0ICovXHJcblx0Z2V0SWNvblJhd1VybCgpIHtcclxuXHRcdGNvbnN0IGljb25SYXcgPSB0aGlzLl9yYXcuaW5mby5pY29uUmF3O1xyXG5cdFx0aWYgKGljb25SYXcpIHtcclxuXHRcdFx0cmV0dXJuIGljb25SYXdbXCJcIl07XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybiBJdGVtQ2F0ZWdvcnlJbmZvLmdldEljb25SYXdVcmwodGhpcy5pZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEB0eXBlIHtzdHJpbmd9XHJcblx0ICovXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBJbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQ2hhcmFjdGVyRnJhZ21lbnRCYXNlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEByZXR1cm5zIHt7W2FjdGlvbnM6c3RyaW5nXTp7W1wiMFwiXTpTcHJpdGUsW2ZyYW1lczpzdHJpbmddOlNwcml0ZX19fSByYXdfdGV4dHVyZXNbLi4uYWN0aW9uc11bLi4uZnJhbWVzXVsuLi5mcmFnbWVudHNdXHJcblx0ICovXHJcblx0Z2V0IF9yYXdfdGV4dHVyZXMoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3O1xyXG5cdH1cclxuXHJcblx0Z2V0IF9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fdXJsO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBhYnN0cmFjdFxyXG4gKi9cclxuY2xhc3MgQ2hhcmFjdGVyQXBwZWFyYW5jZSBleHRlbmRzIENoYXJhY3RlckFwcGVhcmFuY2VCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cdC8vX19pc190ZXh0dXJlKGspIHtcclxuXHQvL1x0cmV0dXJuICghKGsgPT0gXCJmYWNlXCIgfHwgayA9PSBcImRlbGF5XCIgfHwgayA9PSBcImRlZmF1bHRcIikpO1xyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gY2hhcmEuc2xvdHMuYm9keS5mcmFnbWVudHMuYm9keS50ZXh0dXJlc1tjaGFyYS5hY3Rpb25dLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldERlbGF5KGNoYXJhKSB7XHJcblx0XHRjb25zdCBkID0gdGhpcy5fcmF3W2NoYXJhLmFjdGlvbl1bY2hhcmEuYWN0aW9uX2ZyYW1lXS5kZWxheTtcclxuXHRcdGlmIChOdW1iZXIuaXNTYWZlSW50ZWdlcihkKSkge1xyXG5cdFx0XHRyZXR1cm4gZDtcclxuXHRcdH1cclxuXHRcdHJldHVybiAxMjA7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJCb2R5IGV4dGVuZHMgQ2hhcmFjdGVyQXBwZWFyYW5jZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImFjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyQm9keUZyYWdtZW50O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBCb2R5RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBCb2R5RnJhZ21lbnRUZXh0dXJlO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyRXF1aXAgZXh0ZW5kcyBDaGFyYWN0ZXJBcHBlYXJhbmNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiYWN0aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckJvZHlGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIEJvZHlGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIEJvZHlGcmFnbWVudFRleHR1cmU7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJFcXVpcENhc2hXZWFwb24gZXh0ZW5kcyBDaGFyYWN0ZXJFcXVpcCB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy51c2VfY2F0ZWdvcnkgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHVybFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqIEBwYXJhbSB7SXRlbUNhdGVnb3J5SW5mb30gY2F0ZUluZm9cclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdXNlX2NhdGVnb3J5IC0gY2FzaC13ZWFwb24gYXMgW2NhdGVnb3J5XVxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIHRydWUgaWYgaXRlbSBleGlzdFxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQodXJsLCBpZCwgY2F0ZUluZm8sIHVzZV9jYXRlZ29yeSkge1xyXG5cdFx0aWYgKCF1c2VfY2F0ZWdvcnkgJiYgdXNlX2NhdGVnb3J5ICE9IFwiXCIpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcInVzZV9jYXRlZ29yeVwiKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLnVzZV9jYXRlZ29yeSA9IHVzZV9jYXRlZ29yeS5zbGljZSgyLCA0KTtcclxuXHJcblx0XHRyZXR1cm4gc3VwZXIubG9hZCh1cmwsIGlkLCBjYXRlSW5mbyk7XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiYWN0aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckJvZHlGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7b2JqZWN0fSByYXdfdGV4dHVyZXNbLi4uYWN0aW9uc11bLi4uZnJhbWVzXVsuLi5mcmFnbWVudHNdXHJcblx0ICovXHJcblx0Z2V0IF9yYXdfdGV4dHVyZXMoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3W3RoaXMudXNlX2NhdGVnb3J5XTtcclxuXHR9XHJcblxyXG5cdGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3VybCArIHRoaXMudXNlX2NhdGVnb3J5O1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmNsYXNzIENoYXJhY3RlckhlYWRCYXNlIGV4dGVuZHMgQ2hhcmFjdGVyQXBwZWFyYW5jZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImFjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyQm9keUZyYWdtZW50O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIEZyYWdtZW50VGV4dHVyZTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIENoYXJhY3RlckhlYWQgZXh0ZW5kcyBDaGFyYWN0ZXJIZWFkQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy5lbGZFYXJGcmFnbWVudCA9IG51bGw7XHJcblx0XHR0aGlzLmxlZkVhckZyYWdtZW50ID0gbnVsbDtcclxuXHRcdHRoaXMuaGlnaGxlZkVhckZyYWdtZW50ID0gbnVsbDtcclxuXHR9XHJcblx0X19sb2FkX2ZyYWdtZW50cygpIHtcclxuXHRcdHN1cGVyLl9fbG9hZF9mcmFnbWVudHMoKVxyXG5cdFx0XHJcblx0XHRpZiAodGhpcy5mcmFnbWVudHMpIHtcclxuXHRcdFx0aWYgKHRoaXMuZnJhZ21lbnRzLmVhcikge1xyXG5cdFx0XHRcdHRoaXMuZWxmRWFyRnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50cy5lYXI7XHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuZnJhZ21lbnRzLmVhcjtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5mcmFnbWVudHMubGVmRWFyKSB7XHJcblx0XHRcdFx0dGhpcy5sZWZFYXJGcmFnbWVudCA9IHRoaXMuZnJhZ21lbnRzLmxlZkVhcjtcclxuXHRcdFx0XHRkZWxldGUgdGhpcy5mcmFnbWVudHMubGVmRWFyO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyKSB7XHJcblx0XHRcdFx0dGhpcy5oaWdobGVmRWFyRnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGdldCBlbGZFYXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFnbWVudHMuZWFyICE9IG51bGw7XHJcblx0fVxyXG5cdHNldCBlbGZFYXIodmFsdWUpIHtcclxuXHRcdGlmICghdGhpcy5lbGZFYXJGcmFnbWVudCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5mcmFnbWVudHMuZWFyID0gdGhpcy5lbGZFYXJGcmFnbWVudDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRkZWxldGUgdGhpcy5mcmFnbWVudHMuZWFyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0IGxlZkVhcigpIHtcclxuXHRcdHJldHVybiB0aGlzLmZyYWdtZW50cy5sZWZFYXIgIT0gbnVsbDtcclxuXHR9XHJcblx0c2V0IGxlZkVhcih2YWx1ZSkge1xyXG5cdFx0aWYgKCF0aGlzLmxlZkVhckZyYWdtZW50KSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmICh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLmZyYWdtZW50cy5sZWZFYXIgPSB0aGlzLmxlZkVhckZyYWdtZW50O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLmZyYWdtZW50cy5sZWZFYXI7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRnZXQgaGlnaGxlZkVhcigpIHtcclxuXHRcdHJldHVybiB0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyICE9IG51bGw7XHJcblx0fVxyXG5cdHNldCBoaWdobGVmRWFyKHZhbHVlKSB7XHJcblx0XHRpZiAoIXRoaXMuaGlnaGxlZkVhckZyYWdtZW50KSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmICh2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyID0gdGhpcy5oaWdobGVmRWFyRnJhZ21lbnQ7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVsZXRlIHRoaXMuZnJhZ21lbnRzLmhpZ2hsZWZFYXI7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiYWN0aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckJvZHlGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnQ7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJIYWlyIGV4dGVuZHMgQ2hhcmFjdGVySGVhZEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHRyZXR1cm4gXCJhY3Rpb25cIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQ2hhcmFjdGVyQm9keUZyYWdtZW50fVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlckJvZHlGcmFnbWVudDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGhhaXIgY29sb3IgbWl4XHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBIYWlyRnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBIYWlyRnJhZ21lbnRUZXh0dXJlO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyRmFjZUJhc2UgZXh0ZW5kcyBDaGFyYWN0ZXJIZWFkQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHQvL19faXNfdGV4dHVyZShrKSB7XHJcblx0Ly9cdHJldHVybiAoIShrID09IFwiZGVsYXlcIiB8fCBrID09IFwiZGVmYXVsdFwiKSk7XHJcblx0Ly99XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lQ291bnQoY2hhcmEpIHtcclxuXHRcdHJldHVybiBjaGFyYS5zbG90cy5mYWNlLmZyYWdtZW50cy5mYWNlLnRleHR1cmVzW2NoYXJhLmVtb3Rpb25dLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldERlbGF5KGNoYXJhKSB7XHJcblx0XHRjb25zdCBkID0gdGhpcy5fcmF3W2NoYXJhLmVtb3Rpb25dW2NoYXJhLmVtb3Rpb25fZnJhbWVdLmRlbGF5O1xyXG5cdFx0aWYgKGQgIT0gbnVsbCkgey8vIWlzTmFOKGQpICYmIGlzRmluaXRlKGQpXHJcblx0XHRcdHJldHVybiBkO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIDYwO1xyXG5cdH1cclxufVxyXG5jbGFzcyBDaGFyYWN0ZXJGYWNlIGV4dGVuZHMgQ2hhcmFjdGVyRmFjZUJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHRyZXR1cm4gXCJlbW90aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckZhY2VGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJGYWNlRnJhZ21lbnQ7XHJcblx0fVxyXG59XHJcbmNsYXNzIENoYXJhY3RlckZhY2VBY2MgZXh0ZW5kcyBDaGFyYWN0ZXJGYWNlQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImVtb3Rpb25cIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQ2hhcmFjdGVyRmFjZUZyYWdtZW50fVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlckZhY2VGcmFnbWVudDtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIENoYXJhY3RlclRhbWluZ01vYiBleHRlbmRzIENoYXJhY3RlckFwcGVhcmFuY2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0IHR5cGUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3LmluZm8udGFtaW5nTW9iO1xyXG5cdH1cclxuXHJcblx0Z2V0IGFjdGlvbk1hcCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9yYXcuY2hhcmFjdGVyQWN0aW9uO1xyXG5cdH1cclxuXHJcblx0Z2V0IGVtb3Rpb25NYXAoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3LmNoYXJhY3RlckVtb3Rpb247XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1ZlYzJ9IHJlbGF0aXZlXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGJvZHlcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0YWRqX3BvcyhyZWxhdGl2ZSwgYm9keSwgY2hhcmEpIHtcclxuXHRcdGNvbnN0IGZyYWcgPSB0aGlzLmZyYWdtZW50c1swXTsvL2RlZmF1bHRcclxuXHRcdGlmIChmcmFnKSB7XHJcblx0XHRcdGNvbnN0IHRtID0gZnJhZy5nZXRUZXh0dXJlKGNoYXJhKTtcclxuXHRcdFx0aWYgKHRtKSB7XHJcblx0XHRcdFx0cmV0dXJuIHJlbGF0aXZlLnBsdXModG0ubmF2ZWwubWludXMoYm9keS5uYXZlbCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gcmVsYXRpdmU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gY2hhcmEuc2xvdHMuYm9keS5mcmFnbWVudHMuYm9keS50ZXh0dXJlc1tjaGFyYS5fcmlkZV9hY3Rpb25dLmxlbmd0aDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldERlbGF5KGNoYXJhKSB7XHJcblx0XHRjb25zdCBkID0gTWF0aC50cnVuYyh0aGlzLl9yYXdbY2hhcmEuX3JpZGVfYWN0aW9uXVtjaGFyYS5hY3Rpb25fZnJhbWVdLmRlbGF5KTsvLz8/IF9yaWRlX2FjdGlvbl9mcmFtZSA9PiBhY3Rpb25fZnJhbWVcclxuXHRcdGlmIChOdW1iZXIuaXNTYWZlSW50ZWdlcihkKSkge1xyXG5cdFx0XHRyZXR1cm4gZDtcclxuXHRcdH1cclxuXHRcdHJldHVybiAxMjA7XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiX3JpZGVfYWN0aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlclRhbWluZ01vYkZyYWdtZW50fVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlclRhbWluZ01vYkZyYWdtZW50O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIEZyYWdtZW50VGV4dHVyZTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMDAwJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyQm9keTtcdFx0Ly9cdGJvZHlcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAwMDEnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJIZWFkO1x0XHQvL1x0ZWxmRWFyXHRcdFx0LT4gQ2hhcmFjdGVySGVhZEJhc2UgLT4gQ2hhcmFjdGVySGVhZFxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMDAyJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRmFjZTtcdFx0Ly9cdEZhY2VcdFx0XHQtPiBDaGFyYWN0ZXJIZWFkQmFzZSAtPiBDaGFyYWN0ZXJGYWNlQmFzZSAtPiBDaGFyYWN0ZXJGYWNlXHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAwMDMnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJIYWlyO1x0XHQvL1x0SGFpclx0XHRcdC0+IENoYXJhY3RlckhlYWRCYXNlIC0+IENoYXJhY3RlckhhaXJcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDAwNCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckhhaXI7XHRcdC8vXHRIYWlyXHRcdFx0LT4gQ2hhcmFjdGVySGVhZEJhc2UgLT4gQ2hhcmFjdGVySGFpclxyXG5cclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwMCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0Q2FwXHRcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMDEnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJGYWNlQWNjO1x0XHQvL1x0YWNjZXNzb3J5RmFjZVx0LT4gQ2hhcmFjdGVySGVhZEJhc2UgLT4gQ2hhcmFjdGVyRmFjZUJhc2UgLT4gQ2hhcmFjdGVyRmFjZUFjY1xyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTAyJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRhY2Nlc3NvcnlFeWVzXHQtPiBDaGFyYWN0ZXJFcXVpcFxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTAzJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRhY2Nlc3NvcnlFYXJzXHQtPiBDaGFyYWN0ZXJFcXVpcFxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTA0J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRDb2F0XHRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTA1J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRMb25nY29hdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMDYnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcDtcdFx0Ly9cdFBhbnRzXHRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTA3J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRTaG9lc1x0XHRcdC0+IENoYXJhY3RlckJvZHlcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwOCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0R2xvdmVcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMDknXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcDtcdFx0Ly9cdFNoaWVsZFx0XHRcdC0+IENoYXJhY3RlckJvZHlcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDExMCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0Q2FwZVx0XHRcdC0+IENoYXJhY3RlckJvZHlcclxuXHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxNzAnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcENhc2hXZWFwb247XHQvL1x0Y2FzaC13ZWFwb25cdC0+IENoYXJhY3RlckVxdWlwXHJcblxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTknXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJUYW1pbmdNb2I7XHQvL1x0VGFtaW5nTW9iXHRcdC0+IENoYXJhY3RlclRhbWluZ01vYlxyXG5cclxuXHJcbmNsYXNzIENoYXJhY3RlclNsb3RzIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdFx0XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlW119ICovXHJcblx0XHR0aGlzLl9vcmRlcmVkX3Nsb3QgPSBbXTtcclxuXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJIYWlyfSAqL1xyXG5cdFx0dGhpcy5oYWlyID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVySGFpcn0gKi9cclxuXHRcdHRoaXMuX2hhaXIyID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVySGFpcn0gMH4xLjAgKi9cclxuXHRcdHRoaXMuX2hhaXJNaXgyID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVySGFpcn0gKi9cclxuXHRcdHRoaXMuX2hhaXIzID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVySGFpcn0gMH4xLjAgKi9cclxuXHRcdHRoaXMuX2hhaXJNaXgzID0gbnVsbDtcclxuXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcEJvZHl9ICovXHJcblx0XHR0aGlzLmJvZHkgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9ICovXHJcblx0XHR0aGlzLmhlYWQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRmFjZX0gKi9cclxuXHRcdHRoaXMuZmFjZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gKi9cclxuXHRcdHRoaXMuaGFpciA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSAxICovXHJcblx0XHR0aGlzLmNhcCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJGYWNlfSAtIDIgKi9cclxuXHRcdHRoaXMuYWNjZXNzb3J5RmFjZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSAzKi9cclxuXHRcdHRoaXMuYWNjZXNzb3J5RXllcyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSA0ICovXHJcblx0XHR0aGlzLmFjY2Vzc29yeUVhcnMgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gNSAqL1xyXG5cdFx0dGhpcy5jb2F0ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDUgKi9cclxuXHRcdHRoaXMubG9uZ2NvYXQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gNiAqL1xyXG5cdFx0dGhpcy5wYW50cyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSA3ICovXHJcblx0XHR0aGlzLnNob2VzID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDggKi9cclxuXHRcdHRoaXMuZ2xvdmUgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gOSAqL1xyXG5cdFx0dGhpcy5jYXBlID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDEwICovXHJcblx0XHR0aGlzLnNoaWVsZCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSAxMSAqL1xyXG5cdFx0dGhpcy53ZWFwb24gPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlclRhbWluZ01vYn0gKi9cclxuXHRcdHRoaXMudGFtaW5nTW9iID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0e1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJfb3JkZXJlZF9zbG90XCIsIHtcclxuXHRcdFx0XHRjb25maWd1cmFibGU6IHRydWUsXHJcblx0XHRcdFx0d3JpdGFibGU6IHRydWUsXHJcblx0XHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXHJcblx0XHRcdFx0dmFsdWU6IFtdXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX2hhaXJcIiwge1xyXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHZhbHVlOiBudWxsLFxyXG5cdFx0XHR9KTtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaGFpclwiLCB7XHJcblx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdHJldHVybiB0aGlzLl9oYWlyO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0c2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2hhaXIgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdGlmICh2YWx1ZSkge1xyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5faGFpcjIgJiYgdGhpcy5faGFpck1peDIpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmhhaXJDb2xvcjIgPSB0aGlzLmhhaXJDb2xvcjI7Ly9mb3JjZSByZWxvYWRcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmhhaXJNaXgyID0gdGhpcy5oYWlyTWl4MjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5faGFpcjMgJiYgdGhpcy5faGFpck1peDMpIHtcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmhhaXJDb2xvcjMgPSB0aGlzLmhhaXJDb2xvcjM7Ly9mb3JjZSByZWxvYWRcclxuXHRcdFx0XHRcdFx0XHR0aGlzLmhhaXJNaXgzID0gdGhpcy5oYWlyTWl4MztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0sXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX2hhaXJcIiwge1xyXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHZhbHVlOiBudWxsLFxyXG5cdFx0XHR9KTtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX2hhaXIyXCIsIHtcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyTWl4MlwiLCB7XHQvLyAwfjEuMFxyXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHZhbHVlOiBudWxsLFxyXG5cdFx0XHR9KTtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX2hhaXIzXCIsIHtcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyTWl4M1wiLCB7XHQvLyAwfjEuMFxyXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHZhbHVlOiBudWxsLFxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGFzeW5jIF9fbG9hZENvbG9yZWRIYWlyKGNvbG9yKSB7XHJcblx0XHRjb25zdCBpZCA9IENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRDb2xvckhhaXJJRCh0aGlzLmhhaXIuaWQsIGNvbG9yKTtcclxuXHRcdGNvbnN0IGNhdGVJbmZvID0gSXRlbUNhdGVnb3J5SW5mby5nZXQoaWQpO1xyXG5cclxuXHRcdGlmIChjYXRlSW5mbykge1xyXG5cdFx0XHRjb25zdCB1cmwgPSBgL0NoYXJhY3Rlci8ke2NhdGVJbmZvLnBhdGggKyAoY2F0ZUluZm8ucGF0aCA/IFwiL1wiIDogXCJcIikgKyBpZH1gO1xyXG5cdFx0XHRjb25zdCB1c2VfY2F0ZWdvcnkgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0XHRsZXQgaGFpciA9IG5ldyBDaGFyYWN0ZXJIYWlyKCk7XHJcblxyXG5cdFx0XHRhd2FpdCBoYWlyLmxvYWQodXJsLCBpZCwgY2F0ZUluZm8sIHVzZV9jYXRlZ29yeSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gaGFpcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7bnVtYmVyfSAqL1xyXG5cdGdldCBoYWlyQ29sb3IyKCkge1xyXG5cdFx0aWYgKHRoaXMuX2hhaXIyKSB7XHJcblx0XHRcdHJldHVybiBOdW1iZXIoQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldEhhaXJDb2xvcih0aGlzLl9oYWlyMi5pZCkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRzZXQgaGFpckNvbG9yMihjb2xvcikge1xyXG5cdFx0aWYgKCFjb2xvcikge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKG5ldyBUeXBlRXJyb3IoKSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGxldCBoYzJJZCA9IENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRDb2xvckhhaXJJRCh0aGlzLmhhaXIuaWQsIGNvbG9yKTtcclxuXHJcblx0XHRpZiAoIXRoaXMuX2hhaXIyIHx8IGhjMklkICE9IHRoaXMuX2hhaXIyLmlkKSB7XHJcblx0XHRcdGlmIChoYzJJZCA9PSB0aGlzLl9oYWlyLmlkKSB7XHJcblx0XHRcdFx0dGhpcy5faGFpcjIgPSBudWxsO1xyXG5cdFx0XHRcdHRoaXMuaGFpck1peDIgPSAwO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMiA9IHRoaXMuX19sb2FkQ29sb3JlZEhhaXIoY29sb3IpO1xyXG5cclxuXHRcdFx0XHR0aGlzLmhhaXIuJHByb21pc2VfaGFpcjIudGhlbihoYWlyMiA9PiB7XHJcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5oYWlyLiRwcm9taXNlX2hhaXIyO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX2hhaXIyID0gaGFpcjI7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5faGFpcjIgJiYgdGhpcy5oYWlyTWl4MiAhPSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuaGFpck1peDIgPSB0aGlzLmhhaXJNaXgyOy8vZm9yY2UgdXBkYXRlXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRcdFx0Ly9cdHRoaXMuaGFpck1peDIgPSAwOy8vZGlzYWJsZVxyXG5cdFx0XHRcdFx0Ly99XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0LyoqIEByZXR1cm5zIHtudW1iZXJ9IDB+MS4wICovXHJcblx0Z2V0IGhhaXJNaXgyKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2hhaXJNaXgyO1xyXG5cdH1cclxuXHRzZXQgaGFpck1peDIodmFsdWUpIHtcclxuXHRcdHZhbHVlID0gTnVtYmVyKHZhbHVlKTtcclxuXHJcblx0XHRQcm9taXNlLnJlc29sdmUodGhpcy5oYWlyLiRwcm9taXNlX2hhaXIyKS50aGVuKCgpID0+IHtcclxuXHRcdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gKi9cclxuXHRcdFx0bGV0IGl0ZW0gPSB0aGlzLl9oYWlyMjtcclxuXHRcdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gKi9cclxuXHRcdFx0bGV0IGJhc2UgPSB0aGlzLmhhaXI7XHJcblxyXG5cdFx0XHRpZiAoIWl0ZW0gfHwgIWJhc2UpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGZvciAobGV0IGogaW4gaXRlbS5mcmFnbWVudHMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrIGluIGl0ZW0uZnJhZ21lbnRzW2pdLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW0uZnJhZ21lbnRzW2pdLnRleHR1cmVzW2tdLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0XHRsZXQgZnQgPSBpdGVtLmZyYWdtZW50c1tqXS50ZXh0dXJlc1trXVtpXTtcclxuXHRcdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRcdGxldCBvcmkgPSBiYXNlLmZyYWdtZW50c1tqXS50ZXh0dXJlc1trXVtpXTtcclxuXHRcdFx0XHRcdFx0aWYgKG9yaSkge1xyXG5cdFx0XHRcdFx0XHRcdG9yaS5ncmFwaDIgPSBmdDtcclxuXHRcdFx0XHRcdFx0XHRvcmkuZ3JhcGgyLm9wYWNpdHkgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLl9oYWlyTWl4MiA9IHZhbHVlO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gMH4xLjAgKi9cclxuXHRnZXQgaGFpckNvbG9yMygpIHtcclxuXHRcdGlmICh0aGlzLl9oYWlyMykge1xyXG5cdFx0XHRyZXR1cm4gTnVtYmVyKENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRIYWlyQ29sb3IodGhpcy5faGFpcjMuaWQpKTtcclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGhhaXJDb2xvcjMoY29sb3IpIHtcclxuXHRcdGlmICghY29sb3IpIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihuZXcgVHlwZUVycm9yKCkpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRsZXQgaGMzSWQgPSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JIYWlySUQodGhpcy5oYWlyLmlkLCBjb2xvcik7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9oYWlyMyB8fCB0aGlzLl9oYWlyMy5pZCAhPSBoYzNJZCkge1xyXG5cdFx0XHRpZiAodGhpcy5faGFpci5pZCA9PSBoYzNJZCB8fCB0aGlzLl9oYWlyMi5pZCA9PSBoYzNJZCkge1xyXG5cdFx0XHRcdHRoaXMuX2hhaXIzID0gbnVsbDtcclxuXHRcdFx0XHR0aGlzLmhhaXJNaXgzID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmhhaXIuJHByb21pc2VfaGFpcjMgPSB0aGlzLl9fbG9hZENvbG9yZWRIYWlyKGNvbG9yKTtcclxuXHJcblx0XHRcdFx0dGhpcy5oYWlyLiRwcm9taXNlX2hhaXIzLnRoZW4oaGFpcjMgPT4ge1xyXG5cdFx0XHRcdFx0ZGVsZXRlIHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMztcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9oYWlyMyA9IGhhaXIzO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2hhaXIzICYmIHRoaXMuaGFpck1peDMgIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmhhaXJNaXgzID0gdGhpcy5oYWlyTWl4MzsvL2ZvcmNlIHVwZGF0ZVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly9lbHNlIHtcclxuXHRcdFx0XHRcdC8vXHR0aGlzLmhhaXJNaXgzID0gMDsvL2Rpc2FibGVcclxuXHRcdFx0XHRcdC8vfVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKiBAcmV0dXJucyB7bnVtYmVyfSAqL1xyXG5cdGdldCBoYWlyTWl4MygpIHtcclxuXHRcdHJldHVybiB0aGlzLl9oYWlyTWl4MztcclxuXHR9XHJcblx0c2V0IGhhaXJNaXgzKHZhbHVlKSB7XHJcblx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XHJcblxyXG5cdFx0UHJvbWlzZS5yZXNvbHZlKHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMykudGhlbigoKSA9PiB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBpdGVtID0gdGhpcy5faGFpcjM7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBiYXNlID0gdGhpcy5oYWlyO1xyXG5cclxuXHRcdFx0aWYgKCFpdGVtIHx8ICFiYXNlKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKGxldCBqIGluIGl0ZW0uZnJhZ21lbnRzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayBpbiBpdGVtLmZyYWdtZW50c1tqXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtLmZyYWdtZW50c1tqXS50ZXh0dXJlc1trXS5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdFx0bGV0IGZ0ID0gaXRlbS5mcmFnbWVudHNbal0udGV4dHVyZXNba11baV07XHJcblx0XHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0XHRsZXQgb3JpID0gYmFzZS5mcmFnbWVudHNbal0udGV4dHVyZXNba11baV07XHJcblx0XHRcdFx0XHRcdGlmIChvcmkpIHtcclxuXHRcdFx0XHRcdFx0XHRvcmkuZ3JhcGgzID0gZnQ7XHJcblx0XHRcdFx0XHRcdFx0b3JpLmdyYXBoMy5vcGFjaXR5ID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5faGFpck1peDMgPSB2YWx1ZTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0Ly9fX29yZGVyX3Nsb3QoKSB7XHJcblx0Ly9cdGxldCBzbG90X21hcCA9IG5ldyBNYXAoKTtcclxuXHQvL1xyXG5cdC8vXHRmb3IgKGxldCBpIGluIHRoaXMpIHtcclxuXHQvL1x0XHRsZXQgZXF1aXAgPSB0aGlzW2ldO1xyXG5cdC8vXHJcblx0Ly9cdFx0ZXF1aXAuY3NcclxuXHQvL1x0fVxyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSBsb2FkZWRFcXVpcFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1c2VfY2F0ZWdvcnkgLSBjYXRlZ29yeSB3aGljaCB1c2VkIG9mIGNhc2gtd2VhcG9uXHJcblx0ICovXHJcblx0YXN5bmMgX3VzZShpZCwgbG9hZGVkRXF1aXAsIHVzZV9jYXRlZ29yeSkge1xyXG5cdFx0aWYgKCFpZCkge1xyXG5cdFx0XHRkZWJ1Z2dlclxyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCBjYXRlSW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uZ2V0KGlkKTtcclxuXHJcblx0XHRpZiAoY2F0ZUluZm8pIHtcclxuXHRcdFx0bGV0IHVybCA9IGAvQ2hhcmFjdGVyLyR7Y2F0ZUluZm8ucGF0aCArIChjYXRlSW5mby5wYXRoID8gXCIvXCI6XCJcIikgKyBpZH1gO1xyXG5cdFx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSAqL1xyXG5cdFx0XHRsZXQgaXRlbTtcclxuXHJcblx0XHRcdGlmIChsb2FkZWRFcXVpcCBpbnN0YW5jZW9mIENoYXJhY3RlckFwcGVhcmFuY2VCYXNlKSB7XHJcblx0XHRcdFx0YWxlcnQoXCJDaGFyYWN0ZXJTbG90cyAjIF91c2U6IHBhcmFtIGxvYWRlZEVxdWlwID8/XCIpO1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdGl0ZW0gPSBsb2FkZWRFcXVpcDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRpZiAobG9hZGVkRXF1aXApIHtcclxuXHRcdFx0XHRcdGFsZXJ0KFwiQ2hhcmFjdGVyU2xvdHMgIyBfdXNlOiBwYXJhbSBsb2FkZWRFcXVpcCA/P1wiKTtcclxuXHRcdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRjb25zdCBmcmFnbWVudFR5cGUgPSBjYXRlSW5mby5GcmFnbWVudFR5cGUgfHwgQ2hhcmFjdGVyRXF1aXA7XHJcblxyXG5cdFx0XHRcdGl0ZW0gPSBuZXcgZnJhZ21lbnRUeXBlKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0LyoqIF91c2VfbG9hZGVkX2VxdWlwICovXHJcblx0XHRcdGlmICgwKSB7XHJcblx0XHRcdFx0aWYgKHRoaXNbY2F0ZUluZm8uc2xvdF0pIHtcclxuXHRcdFx0XHRcdHRoaXNbY2F0ZUluZm8uc2xvdF0uX3VubG9hZCgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzW2NhdGVJbmZvLnNsb3RdID0gaXRlbTtcclxuXHJcblx0XHRcdFx0dGhpcy5fb3JkZXJlZF9zbG90W2l0ZW0uc2xvdF9vcmRlcl0gPSBpdGVtO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRsZXQgaXNfZXhpc3QgPSBsb2FkZWRFcXVpcCB8fCBhd2FpdCBpdGVtLmxvYWQodXJsLCBpZCwgY2F0ZUluZm8sIHVzZV9jYXRlZ29yeSk7XHJcblx0XHRcdGlmIChpc19leGlzdCkge1xyXG5cdFx0XHRcdC8qKiBfdXNlX2xvYWRlZF9lcXVpcCAqL1xyXG5cdFx0XHRcdGlmICgxKSB7XHJcblx0XHRcdFx0XHRpZiAodGhpc1tjYXRlSW5mby5zbG90XSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzW2NhdGVJbmZvLnNsb3RdLl91bmxvYWQoKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXNbY2F0ZUluZm8uc2xvdF0gPSBpdGVtO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX29yZGVyZWRfc2xvdFtpdGVtLnNsb3Rfb3JkZXJdID0gaXRlbTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiaXRlbShcIiArIGlkICsgXCIpIGlzIG5vdCBleGlzdFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRfdW51c2UoaWQpIHtcclxuXHRcdGlmICghaWQpIHtcclxuXHRcdFx0ZGVidWdnZXJcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGNhdGVJbmZvLCBlcXVpcDtcclxuXHJcblx0XHRpZiAoaWQgaW5zdGFuY2VvZiBDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSkge1xyXG5cdFx0XHRlcXVpcCA9IGlkO1xyXG5cdFx0XHRpZCA9IGVxdWlwLmlkO1xyXG5cdFx0XHRjYXRlSW5mbyA9IGVxdWlwLmNhdGVnb3J5SW5mbztcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjYXRlSW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uZ2V0KGlkKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Y29uc3Qgc2xvdE5hbWUgPSBjYXRlSW5mby5zbG90O1xyXG5cclxuXHRcdGlmIChzbG90TmFtZSAhPSBcImhlYWRcIiAmJiBzbG90TmFtZSAhPSBcImJvZHlcIikge1xyXG5cdFx0XHRpZiAodGhpc1tzbG90TmFtZV0gJiYgdGhpc1tzbG90TmFtZV0uaWQgPT0gaWQpIHtcclxuXHRcdFx0XHRlcXVpcCA9IHRoaXNbc2xvdE5hbWVdO1xyXG5cdFx0XHRcdGZvciAobGV0IHNsb3QgaW4gZXF1aXAuaXNsb3QpIHtcclxuXHRcdFx0XHRcdGxldCBvcmRlciA9IGVxdWlwLmlzbG90W3Nsb3RdO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX29yZGVyZWRfc2xvdFtvcmRlcl0pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fb3JkZXJlZF9zbG90W29yZGVyXS5fdW5sb2FkKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fb3JkZXJlZF9zbG90W29yZGVyXTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpc1tzbG90TmFtZV0gPSBudWxsO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cdF9jbGVhcigpIHtcclxuXHRcdC8vdGhpcy5ib2R5ID0gbnVsbDtcclxuXHRcdC8vdGhpcy5oZWFkID0gbnVsbDtcclxuXHRcdHRoaXMuZmFjZSA9IG51bGw7XHJcblx0XHR0aGlzLmhhaXIgPSBudWxsO1xyXG5cdFx0dGhpcy5jYXAgPSBudWxsO1xyXG5cdFx0dGhpcy5hY2Nlc3NvcnlGYWNlID0gbnVsbDtcclxuXHRcdHRoaXMuYWNjZXNzb3J5RXllcyA9IG51bGw7XHJcblx0XHR0aGlzLmFjY2Vzc29yeUVhcnMgPSBudWxsO1xyXG5cdFx0dGhpcy5jb2F0ID0gbnVsbDtcclxuXHRcdHRoaXMubG9uZ2NvYXQgPSBudWxsO1xyXG5cdFx0dGhpcy5wYW50cyA9IG51bGw7XHJcblx0XHR0aGlzLnNob2VzID0gbnVsbDtcclxuXHRcdHRoaXMuZ2xvdmUgPSBudWxsO1xyXG5cdFx0dGhpcy5jYXBlID0gbnVsbDtcclxuXHRcdHRoaXMuc2hpZWxkID0gbnVsbDtcclxuXHJcblx0XHQvL3RlbXBcclxuXHRcdGxldCBoZWFkID0gdGhpcy5oZWFkO1xyXG5cdFx0bGV0IGJvZHkgPSB0aGlzLmJvZHk7XHJcblxyXG5cdFx0Ly9jbGVhclxyXG5cdFx0dGhpcy5fb3JkZXJlZF9zbG90ID0gW107XHJcblxyXG5cdFx0Ly9yZXN0b3JlXHJcblx0XHRpZiAoaGVhZCkge1xyXG5cdFx0XHR0aGlzLl9vcmRlcmVkX3Nsb3RbaGVhZC5zbG90X29yZGVyXSA9IGhlYWQ7XHJcblx0XHR9XHJcblx0XHRpZiAoYm9keSkge1xyXG5cdFx0XHR0aGlzLl9vcmRlcmVkX3Nsb3RbYm9keS5zbG90X29yZGVyXSA9IGJvZHk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRfc3RyaW5naWZ5KCkge1xyXG5cdFx0bGV0IHNsb3RzID0gW1wiY1wiXTtcclxuXHRcdFx0XHJcblx0XHRpZiAodGhpcy5ib2R5KSBzbG90cy5wdXNoKHRoaXMuYm9keS5pZCk7XHJcblx0XHRpZiAodGhpcy5oZWFkKSBzbG90cy5wdXNoKHRoaXMuaGVhZC5pZCk7XHJcblx0XHRpZiAodGhpcy5mYWNlKSBzbG90cy5wdXNoKHRoaXMuZmFjZS5pZCArIFwifFwiICsgdGhpcy5mYWNlLmlkKTtcclxuXHRcdGlmICh0aGlzLmhhaXIpIHtcclxuXHRcdFx0bGV0IGhhID0gW107XHJcblx0XHRcdGhhLnB1c2godGhpcy5oYWlyLmlkKTtcclxuXHRcdFx0aWYgKHRoaXMuaGFpckNvbG9yMiAmJiB0aGlzLmhhaXJNaXgyID4gMCkgaGEucHVzaCh0aGlzLmhhaXJDb2xvcjIgKyBcIiVcIiArIE1hdGgudHJ1bmModGhpcy5oYWlyTWl4MiAqIDEwMCkpO1xyXG5cdFx0XHRpZiAodGhpcy5oYWlyQ29sb3IzICYmIHRoaXMuaGFpck1peDMgPiAwKSBoYS5wdXNoKHRoaXMuaGFpckNvbG9yMyArIFwiJVwiICsgTWF0aC50cnVuYyh0aGlzLmhhaXJNaXgzICogMTAwKSk7XHJcblx0XHRcdHNsb3RzLnB1c2goaGEuam9pbihcInxcIikpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuY2FwKSBzbG90cy5wdXNoKHRoaXMuY2FwLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUZhY2UpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlGYWNlLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUV5ZXMpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlFeWVzLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUVhcnMpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlFYXJzLmlkKTtcclxuXHRcdGlmICh0aGlzLmNvYXQpIHNsb3RzLnB1c2godGhpcy5jb2F0LmlkKTtcclxuXHRcdGlmICh0aGlzLmxvbmdjb2F0KSBzbG90cy5wdXNoKHRoaXMubG9uZ2NvYXQuaWQpO1xyXG5cdFx0aWYgKHRoaXMucGFudHMpIHNsb3RzLnB1c2godGhpcy5wYW50cy5pZCk7XHJcblx0XHRpZiAodGhpcy5zaG9lcykgc2xvdHMucHVzaCh0aGlzLnNob2VzLmlkKTtcclxuXHRcdGlmICh0aGlzLmdsb3ZlKSBzbG90cy5wdXNoKHRoaXMuZ2xvdmUuaWQpO1xyXG5cdFx0aWYgKHRoaXMuc2hpZWxkKSBzbG90cy5wdXNoKHRoaXMuc2hpZWxkLmlkKTtcclxuXHRcdGlmICh0aGlzLmNhcGUpIHNsb3RzLnB1c2godGhpcy5jYXBlLmlkKTtcclxuXHRcdGlmICh0aGlzLndlYXBvbikgc2xvdHMucHVzaCh0aGlzLndlYXBvbi5pZCk7XHJcblxyXG5cdFx0cmV0dXJuIHNsb3RzLmpvaW4oXCIsXCIpO1xyXG5cdH1cclxuXHJcblx0dG9KU09OKCkge1xyXG5cdFx0bGV0IHNsb3RzID0gW107XHJcblxyXG5cdFx0aWYgKHRoaXMuYm9keSkgc2xvdHMucHVzaCh0aGlzLmJvZHkuaWQpO1xyXG5cdFx0aWYgKHRoaXMuaGVhZCkgc2xvdHMucHVzaCh0aGlzLmhlYWQuaWQpO1xyXG5cdFx0aWYgKHRoaXMuZmFjZSkgc2xvdHMucHVzaCh0aGlzLmZhY2UuaWQpO1xyXG5cdFx0aWYgKHRoaXMuaGFpcikgc2xvdHMucHVzaCh0aGlzLmhhaXIuaWQpO1xyXG5cdFx0aWYgKHRoaXMuY2FwKSBzbG90cy5wdXNoKHRoaXMuY2FwLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUZhY2UpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlGYWNlLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUV5ZXMpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlFeWVzLmlkKTtcclxuXHRcdGlmICh0aGlzLmFjY2Vzc29yeUVhcnMpIHNsb3RzLnB1c2godGhpcy5hY2Nlc3NvcnlFYXJzLmlkKTtcclxuXHRcdGlmICh0aGlzLmNvYXQpIHNsb3RzLnB1c2godGhpcy5jb2F0LmlkKTtcclxuXHRcdGlmICh0aGlzLmxvbmdjb2F0KSBzbG90cy5wdXNoKHRoaXMubG9uZ2NvYXQuaWQpO1xyXG5cdFx0aWYgKHRoaXMucGFudHMpIHNsb3RzLnB1c2godGhpcy5wYW50cy5pZCk7XHJcblx0XHRpZiAodGhpcy5zaG9lcykgc2xvdHMucHVzaCh0aGlzLnNob2VzLmlkKTtcclxuXHRcdGlmICh0aGlzLmdsb3ZlKSBzbG90cy5wdXNoKHRoaXMuZ2xvdmUuaWQpO1xyXG5cdFx0aWYgKHRoaXMuc2hpZWxkKSBzbG90cy5wdXNoKHRoaXMuc2hpZWxkLmlkKTtcclxuXHRcdGlmICh0aGlzLmNhcGUpIHNsb3RzLnB1c2godGhpcy5jYXBlLmlkKTtcclxuXHRcdGlmICh0aGlzLndlYXBvbikgc2xvdHMucHVzaCh0aGlzLndlYXBvbi5pZCk7XHJcblxyXG5cdFx0cmV0dXJuIHNsb3RzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogcmV0dXJuczogW2ZhY2UsIGhhaXIsIGNhcCwgLi4uLCB3ZWFwb25dXHJcblx0ICovXHJcblx0KmVudW1lcmF0ZSgpIHtcclxuXHRcdGlmICh0aGlzLmZhY2UpIHlpZWxkIHRoaXMuZmFjZTtcclxuXHRcdGlmICh0aGlzLmhhaXIpIHlpZWxkIHRoaXMuaGFpcjtcclxuXHJcblx0XHR5aWVsZCogdGhpcy5lbnVtZXJhdGVfZXF1aXAoKTtcclxuXHR9XHJcblx0KmVudW1lcmF0ZV9lcXVpcCgpIHtcclxuXHRcdGlmICh0aGlzLmNhcCkgeWllbGQgdGhpcy5jYXA7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlGYWNlKSB5aWVsZCB0aGlzLmFjY2Vzc29yeUZhY2U7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFeWVzKSB5aWVsZCB0aGlzLmFjY2Vzc29yeUV5ZXM7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFYXJzKSB5aWVsZCB0aGlzLmFjY2Vzc29yeUVhcnM7XHJcblx0XHRpZiAodGhpcy5jb2F0KSB5aWVsZCB0aGlzLmNvYXQ7XHJcblx0XHRpZiAodGhpcy5sb25nY29hdCkgeWllbGQgdGhpcy5sb25nY29hdDtcclxuXHRcdGlmICh0aGlzLnBhbnRzKSB5aWVsZCB0aGlzLnBhbnRzO1xyXG5cdFx0aWYgKHRoaXMuc2hvZXMpIHlpZWxkIHRoaXMuc2hvZXM7XHJcblx0XHRpZiAodGhpcy5nbG92ZSkgeWllbGQgdGhpcy5nbG92ZTtcclxuXHRcdGlmICh0aGlzLnNoaWVsZCkgeWllbGQgdGhpcy5zaGllbGQ7XHJcblx0XHRpZiAodGhpcy5jYXBlKSB5aWVsZCB0aGlzLmNhcGU7XHJcblx0XHRpZiAodGhpcy53ZWFwb24pIHlpZWxkIHRoaXMud2VhcG9uO1xyXG5cdH1cclxuXHQqZW51bWVyYXRlX2ZhY2UoKSB7XHJcblx0XHRpZiAodGhpcy5mYWNlKSB5aWVsZCB0aGlzLmZhY2U7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlGYWNlKSB5aWVsZCB0aGlzLmFjY2Vzc29yeUZhY2U7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJDaGFuZ2VMb2cge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtcImh1bWFuXCJ8XCJlbGZcInxcImxlZlwifFwiaGlnaGxlZlwifSAqL1xyXG5cdFx0dGhpcy5lYXIgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmdbXX0gKi9cclxuXHRcdHRoaXMudXNlRXF1aXAgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ1tdfSAqL1xyXG5cdFx0dGhpcy51bnVzZUVxdWlwID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIGhhaXIyIGlkICovXHJcblx0XHR0aGlzLmhhaXIyID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5oYWlyTWl4MiA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0Ly90aGlzLmhhaXIzID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHQvL3RoaXMuaGFpck1peDMgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9IHdlYXBvbiA9PiBlcXVpcCBpZCAqL1xyXG5cdFx0dGhpcy53ZWFwb24gPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLndlYXBvblR5cGUgPSB1bmRlZmluZWQ7XHJcblx0fVxyXG5cclxuXHRjbGVhcigpIHtcclxuXHRcdHRoaXMuZWFyID0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy51c2VFcXVpcCA9IFtdO1xyXG5cdFx0dGhpcy51bnVzZUVxdWlwID0gW107XHJcblx0XHR0aGlzLmhhaXIyID0gdW5kZWZpbmVkO1xyXG5cdFx0dGhpcy5oYWlyTWl4MiA9IHVuZGVmaW5lZDtcclxuXHRcdC8vdGhpcy5oYWlyMyA9IHVuZGVmaW5lZDtcclxuXHRcdC8vdGhpcy5oYWlyTWl4MyA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMud2VhcG9uVHlwZSA9IHVuZGVmaW5lZDtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDaGFyYWN0ZXJBbmltYXRpb25CYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuXyRkaXJ0eSA9IDA7Ly9mb3JjZSB1cGRhdGUgdnVlXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9IC0g5pyq5a6M5oiQICovXHJcblx0XHR0aGlzLmpvYiA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSDmnKrlrozmiJAgKi9cclxuXHRcdHRoaXMuc3ViSm9iID0gbnVsbDtcclxuXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtBY3Rpb25BbmltYXRpb259ICovXHJcblx0XHR0aGlzLmFjdGFuaSA9IG5ldyBBY3Rpb25BbmltYXRpb24oKTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBhbmltYXRpb24gc3BlZWQgcmF0ZSAqL1xyXG5cdFx0dGhpcy5zcGVlZCA9IDE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5maXhlZF9zcGVlZCA9IGZhbHNlO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gLSBwYXVzZSBhbmltYXRpb24gKi9cclxuXHRcdHRoaXMucGF1c2UgPSBmYWxzZTtcclxuXHJcblxyXG5cdFx0dGhpcy5oaWRlQm9keSA9IGZhbHNlO1xyXG5cclxuXHRcdHRoaXMuX3JpZGVfYWN0aW9uID0gXCJzdGFuZDFcIjtcclxuXHRcdFxyXG5cdFx0dGhpcy5fYWN0aW9uID0gXCJzdGFuZDFcIjtcclxuXHRcdHRoaXMuX2FjdGlvbl9mcmFtZSA9IDA7XHJcblxyXG5cdFx0dGhpcy5fZW1vdGlvbiA9IFwiYmxpbmtcIjtcclxuXHRcdHRoaXMuX2Vtb3Rpb25fZnJhbWUgPSAwO1xyXG5cdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHRcdC8vdGhpcy5fZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZSA9IFswLCAxLCAyLCAxXTtcclxuXHRcdHRoaXMuX2dlbmVyYXRvcl9lbW90aW9uX2ZyYW1lID0gdGhpcy5lbW90aW9uX2ZyYW1lX3NlcXVlbmNlX2dlbmVyYXRvcigzLCAwKTsvL1swLDEsMl0ubGVuZ3RoXHJcblx0XHRcclxuXHRcdHRoaXMuYmxpbmtSYXRlID0gMC4wMztcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlclNsb3RzfSAqL1xyXG5cdFx0dGhpcy5zbG90cyA9IG5ldyBDaGFyYWN0ZXJTbG90cygpO1xyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogaXMgcmVxdWlyZSB1cGRhdGUgcmVuZGVyIGRhdGFcclxuXHRcdCAqIEB0eXBlIHtib29sZWFufVxyXG5cdFx0ICovXHJcblx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgPSB0cnVlO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlW119ICovXHJcblx0XHR0aGlzLl9fZnJhZ19saXN0ID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJDaGFuZ2VMb2d9ICoqL1xyXG5cdFx0dGhpcy4kJGNoYW5nZUxvZyA9IG5ldyBDaGFyYWN0ZXJDaGFuZ2VMb2coKTtcclxuXHR9XHJcblxyXG5cdF9jbG9uZSgpIHtcclxuXHRcdGFsZXJ0KHRoaXMuY29uc3RydWN0b3IubmFtZSArIFwiOjpfY2xvbmVcIik7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSAqL1xyXG5cdFx0bGV0IG5jID0gbmV3IHRoaXMuY29uc3RydWN0b3IoKTsvL25vdCBtdXN0IENoYXJhY3RlclJlbmRlclxyXG5cdFx0aWYgKCFuYykge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdG5jLnNwZWVkID0gMDtcclxuXHJcblx0XHRuYy54ID0gdGhpcy54O1xyXG5cdFx0bmMueSA9IHRoaXMueTtcclxuXHRcdG5jLmFuZ2xlID0gdGhpcy5hbmdsZTtcclxuXHJcblx0XHRuYy5hY3Rpb24gPSB0aGlzLmFjdGlvbjtcclxuXHRcdG5jLmFjdGlvbl9mcmFtZSA9IHRoaXMuYWN0aW9uX2ZyYW1lO1xyXG5cclxuXHRcdG5jLmVtb3Rpb24gPSB0aGlzLl9lbW90aW9uO1xyXG5cdFx0bmMuZW1vdGlvbl9mcmFtZSA9IHRoaXMuZW1vdGlvbl9mcmFtZTtcclxuXHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuc2xvdHMpIHtcclxuXHRcdFx0bGV0IGl0ZW0gPSB0aGlzLnNsb3RzW2ldO1xyXG5cdFx0XHRpZiAoaXRlbSkge1xyXG5cdFx0XHRcdG5jLnNsb3RzW2ldID0gdGhpcy5zbG90c1tpXTsvL25vdCBuZWVkIGNvbG5lID9cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG5jO1xyXG5cdH1cclxuXHRcdFxyXG5cdF93YWl0RnJhbWVUZXh0dXJlc0xvYWRlZCgpIHtcclxuXHRcdGxldCB0YXNrcyA9IFtdO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLnNsb3RzKSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBpdGVtID0gdGhpcy5zbG90c1tpXTtcclxuXHRcdFx0aWYgKGl0ZW0pIHtcclxuXHRcdFx0XHRmb3IgKGxldCBqIGluIGl0ZW0uZnJhZ21lbnRzKSB7XHJcblx0XHRcdFx0XHRsZXQgZnJhZyA9IGl0ZW0uZnJhZ21lbnRzW2pdO1xyXG5cdFx0XHRcdFx0bGV0IGNvdW50ID0gZnJhZy5nZXRGcmFtZUNvdW50KHRoaXMpO1xyXG5cdFx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCBjb3VudDsgKytrKSB7XHJcblx0XHRcdFx0XHRcdGxldCBmdCA9IGZyYWcuZ2V0RnJhbWVUZXh0dXJlKHRoaXMsIGspO1xyXG5cdFx0XHRcdFx0XHRpZiAoZnQgJiYgIWZ0Ll9pc0xvYWRlZF9vcl9kb2xvYWQoKSkge1xyXG5cdFx0XHRcdFx0XHRcdHRhc2tzLnB1c2goZnQuJHByb21pc2UpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwodGFza3MpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogaW5pdCBhbmltYXRpb24gc3RhdHVzXHJcblx0ICovXHJcblx0aW5pdEFuaW1hdGlvbigpIHtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb24gPSBcInN0YW5kMVwiO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5fYWN0aW9uX2ZyYW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuZW1vdGlvbiA9IFwiYmxpbmtcIjtcclxuXHRcdFx0XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuX2Vtb3Rpb25fdGltZSA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLl9lbW90aW9uX2ZyYW1lID0gMDtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAtIDB+MSAqL1xyXG5cdGdldFNwZWVkKCkge1xyXG5cdFx0aWYgKHRoaXMucGF1c2UpIHtcclxuXHRcdFx0cmV0dXJuIDA7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5maXhlZF9zcGVlZCA/IDEgOiB0aGlzLnNwZWVkO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHR5cGUge2Jvb2xlYW59XHJcblx0ICovXHJcblx0Z2V0IGVsZkVhcigpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuc2xvdHMuaGVhZC5lbGZFYXI7XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBlbGZFYXIodmFsdWUpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0dGhpcy5zbG90cy5oZWFkLmVsZkVhciA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHR5cGUge2Jvb2xlYW59XHJcblx0ICovXHJcblx0Z2V0IGxlZkVhcigpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuc2xvdHMuaGVhZC5sZWZFYXI7XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBsZWZFYXIodmFsdWUpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0dGhpcy5zbG90cy5oZWFkLmxlZkVhciA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHR5cGUge2Jvb2xlYW59XHJcblx0ICovXHJcblx0Z2V0IGhpZ2hsZWZFYXIoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5oZWFkKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhcjtcclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGhpZ2hsZWZFYXIodmFsdWUpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0dGhpcy5zbG90cy5oZWFkLmhpZ2hsZWZFYXIgPSB2YWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7XCJodW1hblwifFwiZWxmXCJ8XCJsZWZcInxcImhpZ2hsZWZcIn0gKi9cclxuXHRnZXQgZWFyKCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zbG90cy5oZWFkLmxlZkVhciA/IFwibGVmXCIgOiAodGhpcy5zbG90cy5oZWFkLmVsZkVhciA/IFwiZWxmXCIgOiAodGhpcy5zbG90cy5oZWFkLmhpZ2hsZWZFYXIgPyBcImhpZ2hsZWZcIiA6IFwiaHVtYW5cIikpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRzZXQgZWFyKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5oZWFkKSB7XHJcblx0XHRcdGlmICh2YWx1ZSA9PSBcImVsZlwiKSB7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmVsZkVhciA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmxlZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5oaWdobGVmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5lYXIgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh2YWx1ZSA9PSBcImxlZlwiKSB7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmxlZkVhciA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmVsZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5oaWdobGVmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5lYXIgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh2YWx1ZSA9PSBcImhpZ2hsZWZcIikge1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5lbGZFYXIgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQubGVmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmhpZ2hsZWZFYXIgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cuZWFyID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmVsZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5sZWZFYXIgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cuZWFyID0gXCJodW1hblwiO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5lYXIgPSB1bmRlZmluZWQ7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRnZXQgYWN0aW9uKCkge1xyXG5cdFx0Ly9pZiAodGhpcy5zbG90cy50YW1pbmdNb2IpIHtcclxuXHRcdC8vXHRjb25zdCBhY3RtYXAgPSB0aGlzLnNsb3RzLnRhbWluZ01vYi5hY3Rpb25NYXA7XHJcblx0XHQvL1x0aWYgKGFjdG1hcCkge1xyXG5cdFx0Ly9cdFx0cmV0dXJuIGFjdG1hcFt0aGlzLl9hY3Rpb25dO1xyXG5cdFx0Ly9cdH1cclxuXHRcdC8vXHRyZXR1cm4gXCJzaXRcIjsvL2RlZmF1bHRcclxuXHRcdC8vfVxyXG5cdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcclxuXHR9XHJcblx0c2V0IGFjdGlvbihhY3QpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLnRhbWluZ01vYikge1xyXG5cdFx0XHRsZXQgX2FjdDtcclxuXHJcblx0XHRcdHRoaXMuX3JpZGVfYWN0aW9uID0gYWN0O1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuc2xvdHMudGFtaW5nTW9iLmFjdGlvbk1hcCkge1xyXG5cdFx0XHRcdF9hY3QgPSB0aGlzLnNsb3RzLnRhbWluZ01vYi5hY3Rpb25NYXBbYWN0XTtcclxuXHJcblx0XHRcdFx0aWYgKF9hY3QgPT0gXCJoaWRlQm9keVwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLmhpZGVCb2R5ID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0XHQvL1RPRE86IGhpZGVCb2R5IGFjdD0/XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5fYWN0aW9uID0gYWN0O1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuYWN0YW5pLl9hY3Rpb24gIT0gYWN0KSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0YW5pLnJlbG9hZChhY3QpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5oaWRlQm9keSA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRcdHRoaXMuX2FjdGlvbiA9IF9hY3Q7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5hY3RhbmkuX2FjdGlvbiAhPSBfYWN0KSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0YW5pLnJlbG9hZChfYWN0KTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRpZiAoYWN0ID09IFwicm9wZVwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9hY3Rpb24gPSBcInJvcGVcIjsvL2RlZmF1bHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoYWN0ID09IFwibGFkZGVyXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2FjdGlvbiA9IFwibGFkZGVyXCI7Ly9kZWZhdWx0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5fYWN0aW9uID0gXCJzaXRcIjsvL2RlZmF1bHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuYWN0YW5pLl9hY3Rpb24gIT0gYWN0KSB7XHJcblx0XHRcdFx0XHR0aGlzLmFjdGFuaS5yZWxvYWQoYWN0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLmhpZGVCb2R5ID0gZmFsc2U7XHJcblx0XHRcdHRoaXMuX3JpZGVfYWN0aW9uID0gbnVsbDtcclxuXHJcblx0XHRcdGlmICh0aGlzLmFjdGFuaS5fYWN0aW9uICE9IGFjdCAmJiB0aGlzLnNsb3RzLmJvZHkpIHtcclxuXHRcdFx0XHR0aGlzLl9hY3Rpb24gPSBhY3Q7XHJcblx0XHRcdFx0dGhpcy5hY3RhbmkucmVsb2FkKGFjdCk7XHJcblxyXG5cdFx0XHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRnZXQgYWN0aW9uX2ZyYW1lKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2FjdGlvbl9mcmFtZTtcclxuXHR9XHJcblx0c2V0IGFjdGlvbl9mcmFtZSh2YWx1ZSkge1xyXG5cdFx0aWYgKHZhbHVlID09PSBcIlwiKSB7Ly9mcm9tICQoXCJpbnB1dFwiKVxyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG5cdFx0XHRpZiAoISh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpKSB7XHJcblx0XHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdFx0dGhpcy5fYWN0aW9uX2ZyYW1lID0gTnVtYmVyKHZhbHVlKSB8IDA7XHJcblx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fYWN0aW9uX2ZyYW1lID0gdmFsdWU7XHJcblx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgfD0gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdGdldCBhY3Rpb25fZnJhbWVfY291bnQoKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAodGhpcy5zbG90cy5ib2R5KSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuc2xvdHMuYm9keS5nZXRGcmFtZUNvdW50KHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMDtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdGdldCBlbW90aW9uKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Vtb3Rpb247XHJcblx0fVxyXG5cdHNldCBlbW90aW9uKGVtbykge1xyXG5cdFx0aWYgKHRoaXMuX2Vtb3Rpb24gIT0gZW1vICYmIHRoaXMuc2xvdHMuZmFjZSAmJiB0aGlzLnNsb3RzLmZhY2UuZnJhZ21lbnRzLmZhY2UudGV4dHVyZXNbZW1vXSkge1xyXG5cdFx0XHR0aGlzLl9lbW90aW9uID0gZW1vO1xyXG5cdFx0XHR0aGlzLl9lbW90aW9uX2ZyYW1lID0gMDtcclxuXHRcdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHJcblx0XHRcdGlmIChlbW8gPT0gXCJibGlua1wiKSB7XHJcblx0XHRcdFx0dGhpcy5ibGlua1JhdGUgPSAwLjAzO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuYmxpbmtSYXRlID0gMTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly90aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlID0gWy4uLmNpcmN1bGFyU2VxdWVuY2UodGhpcy5lbW90aW9uX2ZyYW1lX2NvdW50KV07XHJcblx0XHRcdHRoaXMuX2dlbmVyYXRvcl9lbW90aW9uX2ZyYW1lID0gdGhpcy5lbW90aW9uX2ZyYW1lX3NlcXVlbmNlX2dlbmVyYXRvcih0aGlzLmVtb3Rpb25fZnJhbWVfY291bnQsIDApO1xyXG5cclxuXHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY291bnQgb2YgZnJhbWVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgZnJhbWVcclxuXHQgKi9cclxuXHQqZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZV9nZW5lcmF0b3IobGVuZ3RoLCBzdGFydCkge1xyXG5cdFx0d2hpbGUgKHRydWUpIHtcclxuXHRcdFx0aWYgKE1hdGgucmFuZG9tKCkgPCB0aGlzLmJsaW5rUmF0ZSkge1xyXG5cdFx0XHRcdHlpZWxkKiBsaW5lYXJTZXF1ZW5jZShsZW5ndGgsIHN0YXJ0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR5aWVsZCAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdGdldCBlbW90aW9uX2ZyYW1lKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2Vtb3Rpb25fZnJhbWU7XHJcblx0XHQvL2xldCBmID0gdGhpcy5fZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZVt0aGlzLl9lbW90aW9uX2ZyYW1lICUgdGhpcy5fZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZS5sZW5ndGhdO1xyXG5cdFx0Ly9yZXR1cm4gZjtcclxuXHR9XHJcblx0c2V0IGVtb3Rpb25fZnJhbWUodmFsdWUpIHtcclxuXHRcdGlmICh2YWx1ZSA9PT0gXCJcIikgey8vZnJvbSAkKFwiaW5wdXRcIilcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuXHRcdFx0aWYgKCEodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdHRoaXMuX2Vtb3Rpb25fZnJhbWUgPSBOdW1iZXIodmFsdWUpIHwgMDtcclxuXHRcdFx0XHR0aGlzLl9lbW90aW9uX3RpbWUgPSAwO1xyXG5cdFx0XHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fZW1vdGlvbl9mcmFtZSA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG5leHRcclxuXHQgKi9cclxuXHRfZ2V0X2Vtb3Rpb25fbmV4dF9mcmFtZShuZXh0KSB7XHJcblx0XHRsZXQgciA9IHRoaXMuX2dlbmVyYXRvcl9lbW90aW9uX2ZyYW1lLm5leHQoKS52YWx1ZTtcclxuXHRcdFxyXG5cdFx0dGhpcy5fZ2VuZXJhdG9yX2Vtb3Rpb25fZnJhbWUgPSB0aGlzLmVtb3Rpb25fZnJhbWVfc2VxdWVuY2VfZ2VuZXJhdG9yKHRoaXMuZW1vdGlvbl9mcmFtZV9jb3VudCwgdGhpcy5fZW1vdGlvbl9mcmFtZSk7XHJcblx0XHRcclxuXHRcdHJldHVybiByO1xyXG5cdFx0XHJcblx0XHQvL2xldCBmID0gdGhpcy5fZW1vdGlvbl9mcmFtZSArIG5leHQ7XHJcblx0XHQvL2YgPSBmIDwgMCA/ICh0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlLmxlbmd0aCAtIDEpIDogKGYgJSB0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlLmxlbmd0aCk7XHJcblx0XHQvL3JldHVybiB0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlW2ZdO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IGVtb3Rpb25fdGltZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9lbW90aW9uX3RpbWU7XHJcblx0fVxyXG5cdHNldCBlbW90aW9uX3RpbWUodGltZSkge1xyXG5cdFx0aWYgKHRoaXMuZW1vdGlvbl9mcmFtZV9jb3VudCkge1xyXG5cdFx0XHRpZiAodGltZSA8IHRoaXMuZW1vdGlvbl9kZWxheSkge1xyXG5cdFx0XHRcdHRoaXMuX2Vtb3Rpb25fdGltZSA9IHRpbWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHJcblx0XHRcdFx0dGhpcy5fZW1vdGlvbl9mcmFtZSA9IHRoaXMuX2dlbmVyYXRvcl9lbW90aW9uX2ZyYW1lLm5leHQoKS52YWx1ZTtcclxuXHJcblx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0IGVtb3Rpb25fZGVsYXkoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5mYWNlKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnNsb3RzLmZhY2UuZ2V0RGVsYXkodGhpcyk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gNjA7XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRnZXQgZW1vdGlvbl9mcmFtZV9jb3VudCgpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmICh0aGlzLnNsb3RzLmZhY2UpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5zbG90cy5mYWNlLmdldEZyYW1lQ291bnQodGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdHJldHVybiAwO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wIC0gMCA8PSBzdGFtcCA8IEluZmluaXR5XHJcblx0ICovXHJcblx0X3VwZGF0ZShfc3RhbXApIHtcclxuXHRcdGlmICh0aGlzLnBhdXNlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgc3RhbXAgPSBfc3RhbXAgKiB0aGlzLmdldFNwZWVkKCk7XHJcblx0XHRcclxuXHRcdGlmICh0aGlzLmFjdGFuaSkge1xyXG5cdFx0XHRpZiAodGhpcy5hY3RhbmkuaXNFbmQoKSAmJiB0aGlzLmFjdGFuaS5sb29wKSB7XHJcblx0XHRcdFx0dGhpcy5hY3RhbmkucmVzZXQoKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5hY3RhbmkudXBkYXRlKHN0YW1wLCB0aGlzKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmVtb3Rpb25fdGltZSArPSBfc3RhbXA7XHJcblxyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLnNsb3RzKSB7XHJcblx0XHRcdGxldCBlcXVpcCA9IHRoaXMuc2xvdHNbaV07XHJcblx0XHRcdGlmIChlcXVpcCAmJiBlcXVpcC5lZmZlY3QgJiYgZXF1aXAuZWZmZWN0LmVuYWJsZSkge1xyXG5cdFx0XHRcdGVxdWlwLmVmZmVjdC51cGRhdGUoc3RhbXApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YW55fSBudW1iZXIgIDAgPCBzdGFtcCAqIHNwZWVkIDwgSW5maW5pdHlcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMuX3VwZGF0ZShzdGFtcCk7XHJcblx0fVxyXG5cclxuXHRfX2ZvcmNlVXBkYXRlKHN0YW1wKSB7XHJcblx0XHR0aGlzLl8kZGlydHkgPSBNYXRoLnJhbmRvbSgpO1xyXG5cdFx0dGhpcy5fdXBkYXRlKHN0YW1wIHwgMCk7XHJcblx0XHR0aGlzLl9fdXBkYXRlX2ZyYWdfbGlzdCgpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5LCBcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW5nbGVcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGZsaXBcclxuXHQgKi9cclxuXHRfZHJhdyhyZW5kZXJlciwgeCwgeSwgYW5nbGUsIGZsaXApIHtcclxuXHRcdHJlbmRlcmVyLnB1c2hHbG9iYWxBbHBoYSgpO1xyXG5cclxuXHRcdGlmICh0aGlzLl9fcmVxdWlyZV91cGRhdGUpIHtcclxuXHRcdFx0dGhpcy5fX3VwZGF0ZV9mcmFnX2xpc3QoKTtcclxuXHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlID0gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly9saXN0LmZpbHRlcihhPT5hJiZhLl9yYXcubWFwKS5mb3JFYWNoKGE9PnsgZm9yIChsZXQgaSBpbiBhLl9yYXcubWFwKSB7IGlmIChxW2ldKSB7IHFbaV0ucHVzaChhKTsgfSBlbHNlIHsgcVtpXSA9IFthXTsgfSB9IH0pXHJcblx0XHR0aGlzLl9fZHJhd19saXN0KHJlbmRlcmVyLCB0aGlzLl9fZnJhZ19saXN0LCB4LCB5LCBhbmdsZSwgZmxpcCk7XHJcblxyXG5cdFx0cmVuZGVyZXIucG9wR2xvYmFsQWxwaGEoKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmVbXX0gbGlzdFxyXG5cdCAqL1xyXG5cdF9fZHJhd19saXN0KHJlbmRlcmVyLCBsaXN0LCB4LCB5LCBhbmdsZSwgZmxpcCkge1xyXG5cdFx0cmVuZGVyZXIucHVzaE1hdHJpeCgpO1xyXG5cclxuXHRcdHJlbmRlcmVyLnRyYW5zbGF0ZSh4LCB5KTtcclxuXHRcdFxyXG5cdFx0aWYgKDApIHtcclxuXHRcdFx0bGV0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHRcdFx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0XHRjdHgubW92ZVRvKDAsIDApO1xyXG5cdFx0XHRjdHgubGluZVRvKDEwMCwgMCk7XHJcblx0XHRcdGN0eC5zdHJva2VTdHlsZSA9IFwiI0YwMFwiO1xyXG5cdFx0XHRjdHguc3Ryb2tlKCk7XHJcblx0XHRcdGN0eC5iZWdpblBhdGgoKTtcclxuXHRcdFx0Y3R4Lm1vdmVUbygwLCAwKTtcclxuXHRcdFx0Y3R4LmxpbmVUbygwLCAxMDApO1xyXG5cdFx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiMwRjBcIjtcclxuXHRcdFx0Y3R4LnN0cm9rZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJlbmRlcmVyLnJvdGF0ZSh3aW5kb3cubV9hIHx8IGFuZ2xlKTtcclxuXHJcblx0XHRpZiAoZmxpcCkge1xyXG5cdFx0XHRyZW5kZXJlci5zY2FsZSgtMSwgMSk7XHJcblx0XHR9XHJcblx0XHQvL3tcclxuXHRcdC8vXHRsZXQgY3R4ID0gcmVuZGVyZXIuY3R4O1xyXG5cdFx0Ly9cdGN0eC5iZWdpblBhdGgoKTtcclxuXHRcdC8vXHRjdHgubW92ZVRvKDAsIDApO1xyXG5cdFx0Ly9cdGN0eC5saW5lVG8oMTAwLCAwKTtcclxuXHRcdC8vXHRjdHguc3Ryb2tlU3R5bGUgPSBcIiNGMDBcIjtcclxuXHRcdC8vXHRjdHguc3Ryb2tlKCk7XHJcblx0XHQvL1x0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0Ly9cdGN0eC5tb3ZlVG8oMCwgMCk7XHJcblx0XHQvL1x0Y3R4LmxpbmVUbygwLCAxMDApO1xyXG5cdFx0Ly9cdGN0eC5zdHJva2VTdHlsZSA9IFwiIzBGMFwiO1xyXG5cdFx0Ly9cdGN0eC5zdHJva2UoKTtcclxuXHRcdC8vfVxyXG5cclxuXHRcdHtcclxuXHRcdFx0Zm9yIChsZXQgaSBpbiB0aGlzLnNsb3RzKSB7XHJcblx0XHRcdFx0bGV0IGVxdWlwID0gdGhpcy5zbG90c1tpXTtcclxuXHRcdFx0XHRpZiAoZXF1aXAgJiYgZXF1aXAuZWZmZWN0KSB7XHJcblx0XHRcdFx0XHRlcXVpcC5lZmZlY3QucmVuZGVyKHJlbmRlcmVyLCB0aGlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Zm9yIChsZXQgaSBpbiBsaXN0KSB7XHJcblx0XHRcdFx0bGV0IGZ0ID0gbGlzdFtpXTtcclxuXHRcdFx0XHRmdC5yZW5kZXIocmVuZGVyZXIsIHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZW5kZXJlci5wb3BNYXRyaXgoKTtcclxuXHR9XHJcblx0X191cGRhdGVfZnJhZ19saXN0KCkge1xyXG5cdFx0dGhpcy5fX2ZyYWdfbGlzdCA9IFtdO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge0FycmF5PENoYXJhY3RlckFwcGVhcmFuY2VCYXNlPltdfSAqL1xyXG5cdFx0bGV0IHNsb3RzID0ge307XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGkgPSAyOyBpIDw9IDM7ICsraSkge1xyXG5cdFx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSAqL1xyXG5cdFx0XHRsZXQgaXRlbSA9IHRoaXMuc2xvdHNbXCJfaGFpclwiICsgaV07XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLl9fYWRkX2VxdWlwX3RvX2ZyYWdfbGlzdChzbG90cywgaXRlbSk7XHJcblx0XHR9XHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuc2xvdHMuX29yZGVyZWRfc2xvdCkge1xyXG5cdFx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSAqL1xyXG5cdFx0XHRsZXQgaXRlbSA9IHRoaXMuc2xvdHMuX29yZGVyZWRfc2xvdFtpXTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuX19hZGRfZXF1aXBfdG9fZnJhZ19saXN0KHNsb3RzLCBpdGVtKTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0ey8vYmFja1xyXG5cdFx0XHRsZXQgaXNfYmFjayA9IGZhbHNlO1xyXG5cdFx0XHRcclxuXHRcdFx0Zm9yIChsZXQgaSBpbiBzbG90cykge1xyXG5cdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlW119ICovXHJcblx0XHRcdFx0bGV0IGZ0cyA9IHNsb3RzW2ldO1xyXG5cdFx0XHRcdGZvciAobGV0IGogaW4gZnRzKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGZ0c1tqXTtcclxuXHRcdFx0XHRcdGlmIChpc19iYWNrKSB7XHJcblx0XHRcdFx0XHRcdGlmIChmdC5fcGxhY2Uuc3RhcnRzV2l0aChcImZhY2VcIikpIHtcclxuXHRcdFx0XHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAoZnQuX3BsYWNlLnN0YXJ0c1dpdGgoXCJiYWNrSGFpclwiKSkge1xyXG5cdFx0XHRcdFx0XHRpc19iYWNrID0gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuX19hZGRfZnJhZ190b19saXN0KGZ0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0e1xyXG5cdFx0XHRsZXQgYWUgPSB0aGlzLl9fZnJhZ19saXN0WzExNF07Ly9IQUNLOiBBZVxyXG5cdFx0XHRpZiAoYWUpIHtcclxuXHRcdFx0XHR0aGlzLl9fZnJhZ19saXN0LnB1c2goYWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fY2FsY0JvdW5kQm94KCk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7QXJyYXk8Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2U+W119IHNsb3RzXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gaXRlbVxyXG5cdCAqL1xyXG5cdF9fYWRkX2VxdWlwX3RvX2ZyYWdfbGlzdChzbG90cywgaXRlbSkge1xyXG5cdFx0Ly8gaWYgZXF1aXAgbm90IHVzZSB0aGVuIHZhbHVlIGlzIG11bWJlcihzbG90X29yZGVyKSB3aGVyZSB0aGlzLnNsb3RzLl9vcmRlcmVkX3Nsb3RcclxuXHRcdGlmIChpdGVtID09IG51bGwpIHtcclxuXHRcdFx0cmV0dXJuOy8vZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChpdGVtID4gMCkgey8vIHR5cGVvZiBpdGVtID09ICdudW1iZXInOyBpdGVtICE9IG51bGwgJiYgKGl0ZW0gaW5zdGFuY2VvZiBDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSB8fCBpdGVtID49IDApXHJcblx0XHRcdHJldHVybjsvL2NvbnRpbnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGluaXQgc2xvdHNcclxuXHRcdGZvciAobGV0IGogaW4gaXRlbS52c2xvdCkge1xyXG5cdFx0XHRsZXQgc2xvdCA9IGl0ZW0udnNsb3Rbal07XHJcblx0XHRcdHNsb3RzW3Nsb3RdID0gW107XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChsZXQgaiBpbiBpdGVtLmZyYWdtZW50cykgey8vZm9yZWFjaCBlcXVpcCBwbGFjZVxyXG5cdFx0XHRsZXQgc2xvdCA9IHNNYXBbal07XHJcblx0XHRcdGlmIChzbG90ICE9IG51bGwpIHtcclxuXHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRsZXQgZnQgPSBpdGVtLmZyYWdtZW50c1tqXS5nZXRUZXh0dXJlKHRoaXMpO1xyXG5cdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0aWYgKCFzbG90c1tzbG90XSkge1xyXG5cdFx0XHRcdFx0XHRzbG90c1tzbG90XSA9IFtmdF07Ly9jb3ZlciA/P1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHNsb3RzW3Nsb3RdLnB1c2goZnQpOy8vY292ZXIgPz9cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoaiA9PSBcImRlZmF1bHRcIikge1xyXG5cdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdGxldCBmdCA9IGl0ZW0uZnJhZ21lbnRzW2pdLmdldFRleHR1cmUodGhpcyk7XHJcblx0XHRcdFx0c2xvdCA9IGl0ZW0uX3Jhdy5pbmZvLmlzbG90O1xyXG5cdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0aWYgKCFzbG90c1tzbG90XSkge1xyXG5cdFx0XHRcdFx0XHRzbG90c1tzbG90XSA9IFtmdF07Ly9jb3ZlciA/P1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHNsb3RzW3Nsb3RdLnB1c2goZnQpOy8vY292ZXIgPz9cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0bGV0IGZ0ID0gaXRlbS5mcmFnbWVudHNbal0uZ2V0VGV4dHVyZSh0aGlzKTtcclxuXHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdHRoaXMuX19hZGRfZnJhZ190b19saXN0KGZ0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0Ly9pdGVtLmZyYWdtZW50c1tqXS52aXNpYmxlID0gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0LyoqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBmdCAqL1xyXG5cdF9fYWRkX2ZyYWdfdG9fbGlzdChmdCkge1xyXG5cdFx0ZnQudXBkYXRlKHRoaXMpO1xyXG5cdFx0dGhpcy5fX2ZyYWdfbGlzdFtmdC56XSA9IGZ0O1xyXG5cdH1cclxuXHJcblxyXG5cdC8qKlxyXG5cdCAqIGNhbGMgY3VycmVudCBmcmFtZSBib3VuZCBib3ggYW5kIHJlc3RvcmUgcmVzdWx0XHJcblx0ICogQHJldHVybnMge1JlY3RhbmdsZX1cclxuXHQgKi9cclxuXHRfY2FsY0JvdW5kQm94KCkge1xyXG5cdFx0bGV0IGxlZnQgPSAwLCB0b3AgPSAwLCByaWdodCA9IDAsIGJvdHRvbSA9IDA7XHJcblxyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLl9fZnJhZ19saXN0KSB7XHJcblx0XHRcdGxldCBmdCA9IHRoaXMuX19mcmFnX2xpc3RbaV07XHJcblx0XHRcdGlmIChmdC50ZXh0dXJlICYmIGZ0LnJlbGF0aXZlKSB7XHJcblx0XHRcdFx0bGV0IHgwID0gZnQucmVsYXRpdmUueDtcclxuXHRcdFx0XHRsZXQgeTAgPSBmdC5yZWxhdGl2ZS55O1xyXG5cdFx0XHRcdGxldCB4MSA9IHgwICsgZnQud2lkdGg7XHJcblx0XHRcdFx0bGV0IHkxID0geTAgKyBmdC5oZWlnaHQ7XHJcblxyXG5cdFx0XHRcdGxlZnQgPSBNYXRoLm1pbihsZWZ0LCB4MCk7XHJcblx0XHRcdFx0dG9wID0gTWF0aC5taW4odG9wLCB5MCk7XHJcblx0XHRcdFx0cmlnaHQgPSBNYXRoLm1heChyaWdodCwgeDEpO1xyXG5cdFx0XHRcdGJvdHRvbSA9IE1hdGgubWF4KGJvdHRvbSwgeTEpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLl9ib3VuZEJveCA9IG5ldyBSZWN0YW5nbGUoXHJcblx0XHRcdE1hdGgudHJ1bmMobGVmdCksXHJcblx0XHRcdE1hdGgudHJ1bmModG9wKSxcclxuXHRcdFx0TWF0aC50cnVuYyhyaWdodCAtIGxlZnQpLFxyXG5cdFx0XHRNYXRoLnRydW5jKGJvdHRvbSAtIHRvcClcclxuXHRcdCk7XHJcblx0XHRyZXR1cm4gdGhpcy5fYm91bmRCb3g7XHJcblx0fVxyXG5cdFxyXG5cdHRvSlNPTigpIHtcclxuXHRcdGxldCBvYmogPSB7XHJcblx0XHRcdGhhaXIyOiB0aGlzLnNsb3RzLl9oYWlyMi5pZCxcclxuXHRcdFx0aGFpck1peDI6IHRoaXMuc2xvdHMuaGFpck1peDIsXHJcblx0XHRcdHNsb3RzOiB0aGlzLnNsb3RzLnRvSlNPTigpLFxyXG5cdFx0fTtcclxuXHJcblx0XHRpZiAodGhpcy5zbG90cy5oZWFkLmVsZkVhcikge1xyXG5cdFx0XHRvYmouZWFyID0gXCJlbGZcIjtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHRoaXMuc2xvdHMuaGVhZC5sZWZFYXIpIHtcclxuXHRcdFx0b2JqLmVhciA9IFwibGVmXCI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhcikge1xyXG5cdFx0XHRvYmouZWFyID0gXCJoaWdobGVmXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIG9iajtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDaGFyYWN0ZXJSZW5kZXJlciBleHRlbmRzIENoYXJhY3RlckFuaW1hdGlvbkJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBwb3NpdGlvbiB4ICovXHJcblx0XHR0aGlzLnggPSAwO1xyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gcG9zaXRpb24geSAqL1xyXG5cdFx0dGhpcy55ID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSB3aGVyZSBsYXllciAqL1xyXG5cdFx0dGhpcy56ID0gNTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSB0cmFuc2xhdGUgeCBvbmNlIGZyYW1lICovXHJcblx0XHR0aGlzLnR4ID0gMDtcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHRyYW5zbGF0ZSB5IG9uY2UgZnJhbWUgKi9cclxuXHRcdHRoaXMudHkgPSAwO1xyXG5cdFx0XHJcblx0XHR0aGlzLmFuZ2xlID0gMDtcclxuXHRcdHRoaXMuZnJvbnQgPSAtMTtcclxuXHJcblx0XHQvKiogQHR5cGUge1Byb21pc2U8dm9pZD5bXX0gKi9cclxuXHRcdHRoaXMuX19sb2FkX3Rhc2sgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge2Z1bmN0aW9uKElSZW5kZXJlcil9ICovXHJcblx0XHR0aGlzLnJlbmRlciA9IGZ1bmN0aW9uIChyZW5kZXJlcikge1xyXG5cdFx0XHQvL25vdCByZWFkeSB0byByZW5kZXJcclxuXHRcdFx0Ly9pZiBsb2FkIHRoZW4gc2V0IGxvYWQgcmVuZGVyID0gX3JlbmRlclxyXG5cdFx0fVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7UmVjdGFuZ2xlfSAqL1xyXG5cdFx0dGhpcy5fYm91bmRCb3ggPSBudWxsO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGFzeW5jIEluaXQoKSB7XHJcblx0XHRsZXQgcmVzdWx0ID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG5cdFx0XHQkZ2V0LmRhdGEoXCIvem1hcFwiKSxcclxuXHRcdFx0JGdldC5kYXRhKFwiL3NtYXBcIiksXHJcblx0XHRcdEl0ZW1FZmZlY3QuSW5pdCgpLFxyXG5cdFx0XHRBY3Rpb25BbmltYXRpb24uSW5pdCgpLC8vYWN0aW9uIGRlZmluaXRpb25cclxuXHRcdF0pO1xyXG5cdFx0XHJcblx0XHR6TWFwID0ge307XHJcblx0XHRPYmplY3Qua2V5cyhyZXN1bHRbMF0pLnJldmVyc2UoKS5mb3JFYWNoKChrLCBpKSA9PiB6TWFwW2tdID0gaSArIDEpO1xyXG5cclxuXHRcdHNNYXAgPSByZXN1bHRbMV07XHJcblx0fVxyXG5cclxuXHRsb2FkKCkge1xyXG5cdFx0Ly9sb2FkIGJvZHkgYW5kIGhlYWQgZm9yIGNhbGMgcmVsYXRpdmUgcG9zaXRpb25cclxuXHRcdHRoaXMudXNlKFwiMDAwMDIwMTJcIik7XHJcblx0XHR0aGlzLnVzZShcIjAwMDEyMDEyXCIpO1xyXG5cclxuXHRcdGxldCAkcHJvbWlzZSA9IFByb21pc2UuYWxsKFsuLi50aGlzLl9fbG9hZF90YXNrXSk7XHJcblx0XHQoZnVuY3Rpb24gKHRoYXQsICRwcm9taXNlKSB7XHJcblx0XHRcdCRwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xyXG5cdFx0XHRcdHRoYXQuaW5pdEFuaW1hdGlvbigpO1xyXG5cdFx0XHRcdHRoYXQucmVuZGVyID0gdGhhdC5fcmVuZGVyO1xyXG5cdFx0XHR9KTtcclxuXHRcdH0pKHRoaXMsICRwcm9taXNlKTtcclxuXHJcblx0XHRyZXR1cm4gJHByb21pc2U7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YW55fSBudW1iZXIgIDAgPCBzdGFtcCAqIHNwZWVkIDwgSW5maW5pdHlcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMud2FpdExvYWRlZCgpO1xyXG5cdFx0c3VwZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdF9yZW5kZXIocmVuZGVyZXIpIHtcclxuXHRcdGNvbnN0IHggPSBNYXRoLnRydW5jKHRoaXMueCArIHRoaXMudHgpO1xyXG5cdFx0Y29uc3QgeSA9IE1hdGgudHJ1bmModGhpcy55ICsgdGhpcy50eSk7XHJcblx0XHRcclxuXHRcdHRoaXMuX2RyYXcocmVuZGVyZXIsIHgsIHksIHRoaXMuYW5nbGUsIHRoaXMuZnJvbnQgPiAwKTtcclxuXHRcdFxyXG5cdFx0Ly90aGlzLnR4ID0gMDsvL2F1dG8gY2xlYXJcclxuXHRcdC8vdGhpcy50eSA9IDA7Ly9hdXRvIGNsZWFyXHJcblx0fVxyXG5cdFxyXG5cdF9zZXR1cF90ZXN0KCkge1xyXG5cdFx0dGhpcy51c2UoXCIwMDAyNjUwOVwiKTtcclxuXHJcblx0XHR0aGlzLnVzZShcIjAwMDQ0MDQxXCIpO1xyXG5cclxuXHRcdC8vdGhpcy51c2UoXCIwMTAyMjI3NFwiKTtcclxuXHJcblx0XHR0aGlzLnVzZShcIjAxMDUzMTY5XCIpO1xyXG5cclxuXHRcdHRoaXMudXNlKFwiMDEwNzEwNzdcIik7XHJcblxyXG5cdFx0Ly90aGlzLnVzZShcIjAxMTAyOTYwXCIpO1xyXG5cdH1cclxuXHJcblx0XHJcblx0YXN5bmMgX19zeW5jaHJvbml6ZShzdGFtcCkge1xyXG5cdFx0dGhpcy5fX2ZvcmNlVXBkYXRlKHN0YW1wKTtcclxuXHRcclxuXHRcdGF3YWl0IHRoaXMud2FpdExvYWRlZCgpO1xyXG5cdFx0YXdhaXQgdGhpcy5fd2FpdEZyYW1lVGV4dHVyZXNMb2FkZWQoKTtcclxuXHR9XHJcblx0YXN5bmMgd2FpdExvYWRlZCgpIHtcclxuXHRcdGxldCB0YXNrcyA9IHRoaXMuX19sb2FkX3Rhc2s7XHJcblx0XHRpZiAodGFza3MgJiYgdGFza3MubGVuZ3RoKSB7XHJcblx0XHRcdGF3YWl0IFByb21pc2UuYWxsKHRhc2tzKS50aGVuKCgpID0+IHtcclxuXHRcdFx0XHR0aGlzLl9fbG9hZF90YXNrID0gW107XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvL2lzTG9hZGluZygpIHtcclxuXHQvL31cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGNhdGVnb3J5IC0gY2F0ZWdvcnkgb2YgY2FzaC13ZWFwb25cclxuXHQgKi9cclxuXHRhc3luYyB1c2UoaWQsIGNhdGVnb3J5KSB7XHJcblx0XHRpZiAoIWNhdGVnb3J5KSB7XHJcblx0XHRcdGNhdGVnb3J5ID0gSXRlbUNhdGVnb3J5SW5mby5nZXRKb2JXZWFwb25DYXRlZ29yeSh0aGlzLmpvYik7XHJcblx0XHR9XHJcblx0XHRjb25zdCBpdGVtX3R5cGUgPSBpZFswXTtcclxuXHRcdHN3aXRjaCAoaXRlbV90eXBlKSB7XHJcblx0XHRcdGNhc2UgXCIwXCI6Ly9lcXVpcFxyXG5cdFx0XHRcdHtcclxuXHRcdFx0XHRcdGlmIChJdGVtQ2F0ZWdvcnlJbmZvLmlzQ2FzaFdlYXBvbihpZCkpIHtcclxuXHRcdFx0XHRcdFx0Ly90aGlzLiQkY2hhbmdlTG9nLndlYXBvblR5cGUgPSBzc1sxXTsvPz9cclxuXHRcdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy53ZWFwb24gPSBpZDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLnVzZUVxdWlwLnB1c2goaWQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdGxldCB0YXNrID0gdGhpcy5zbG90cy5fdXNlKGlkLCBudWxsLCBjYXRlZ29yeSk7XHJcblx0XHRcdFx0XHR0aGlzLl9fbG9hZF90YXNrLnB1c2godGFzayk7XHJcblx0XHRcdFx0XHRhd2FpdCB0YXNrO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRpZiAoaWQuc3RhcnRzV2l0aChcIjAxOVwiKSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmFjdGlvbiA9IHRoaXMuYWN0aW9uOy8vZm9yY2UgdXBkYXRlIGFjdGlvblxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHR0aGlzLl9fdXBkYXRlX2ZyYWdfbGlzdCgpO1xyXG5cdFx0XHRcdFx0dGhpcy5fY2FsY0JvdW5kQm94KCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICovXHJcblx0dW51c2UoaWQpIHtcclxuXHRcdGRlYnVnZ2VyO1xyXG5cdFx0aWYgKGlkWzBdID09IFwiMFwiKSB7Ly9lcXVpcFxyXG5cdFx0XHRsZXQgcmVzdWx0ID0gdGhpcy5zbG90cy5fdW51c2UoaWQpO1xyXG5cdFx0XHRpZiAocmVzdWx0KSB7XHJcblx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy51bnVzZUVxdWlwLnB1c2goaWQpO1xyXG5cdFx0XHRcdHRoaXMuX2NhbGNCb3VuZEJveCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRfcGFyc2UoY29kZSkge1xyXG5cdFx0aWYgKCFjb2RlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGxldCBlcyA9IGNvZGUuc3BsaXQoXCIsXCIpO1xyXG5cdFx0dGhpcy5zbG90cy5fY2xlYXIoKTtcclxuXHRcdGVzLmZvckVhY2goKHYsIGksIGEpID0+IHtcclxuXHRcdFx0aWYgKHYuaW5kZXhPZihcInxcIikgPj0gMCkge1xyXG5cdFx0XHRcdGNvbnN0IHNzID0gdi5zcGxpdChcInxcIik7XHJcblx0XHRcdFx0Y29uc3QgY2F0ZSA9IEl0ZW1DYXRlZ29yeUluZm8uZ2V0KHNzWzBdKTtcclxuXHRcdFx0XHRsZXQgaWQ7XHJcblx0XHRcdFx0aWYgKGNhdGUuc2xvdCA9PSBcImZhY2VcIikge1xyXG5cdFx0XHRcdFx0aWQgPSBzc1sxXTtcclxuXHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cudXNlRXF1aXAucHVzaChpZCk7XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0dGhpcy51c2UoaWQpO1xyXG5cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoY2F0ZS5zbG90ID09IFwiaGFpclwiKSB7XHJcblx0XHRcdFx0XHRjb25zdCBzbG90cyA9IHRoaXMuc2xvdHM7XHJcblx0XHRcdFx0XHRsZXQgaDIgPSBzc1sxXTtcclxuXHRcdFx0XHRcdGxldCBoMyA9IHNzWzJdO1xyXG5cdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdGlkID0gc3NbMF07XHJcblx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLnVzZUVxdWlwLnB1c2goaWQpO1xyXG5cdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdHRoaXMudXNlKGlkKS50aGVuKCgpID0+IHtcclxuXHRcdFx0XHRcdFx0aWYgKGgyICYmIGgyLmluZGV4T2YoXCIlXCIpID49IDApIHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgaGMgPSBoMi5zcGxpdChcIiVcIik7XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgYzIgPSBoY1swXTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBtMiA9IGhjWzFdIC8gMTAwO1xyXG5cdFx0XHRcdFx0XHRcdC8vXHJcblx0XHRcdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5oYWlyMiA9IGMyO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cuaGFpck1peDIgPSBtMjtcclxuXHRcdFx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0XHRcdHNsb3RzLmhhaXJDb2xvcjIgPSBjMjtcclxuXHRcdFx0XHRcdFx0XHRzbG90cy5oYWlyTWl4MiA9IG0yO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChoMyAmJiBoMy5pbmRleE9mKFwiJVwiKSA+PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0bGV0IGhjID0gaDMuc3BsaXQoXCIlXCIpO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IGMzID0gaGNbMF07XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgbTMgPSBoY1sxXSAvIDEwMDtcclxuXHRcdFx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cuaGFpcjMgPSBjMztcclxuXHRcdFx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLmhhaXJNaXgzID0gbTM7XHJcblx0XHRcdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdFx0XHRzbG90cy5oYWlyQ29sb3IzID0gaGNbMF07XHJcblx0XHRcdFx0XHRcdFx0c2xvdHMuaGFpck1peDQgPSBoY1sxXSAvIDEwMDtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKGNhdGUuc2xvdCA9PSBcIndlYXBvblwiKSB7XHJcblx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLndlYXBvblR5cGUgPSBzc1sxXTtcclxuXHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cud2VhcG9uID0gaWQ7XHJcblx0XHRcdFx0XHR0aGlzLnVzZS5hcHBseSh0aGlzLCBzcywgc3NbMV0pOy8vdGhpcy51c2Uoc3NbMF0sIHNzWzFdKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoTnVtYmVyLmlzRmluaXRlKHBhcnNlSW50KHYsIDEwKSkpIHtcclxuXHRcdFx0XHR0aGlzLnVzZSh2KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdHlwZSB7c3RyaW5nfSBjb2xcclxuXHQgKi9cclxuXHRnZXQgaGFpckNvbG9yKCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGFpcikge1xyXG5cdFx0XHRyZXR1cm4gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldEhhaXJDb2xvcih0aGlzLnNsb3RzLmhhaXIuaWQpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIFwiMFwiO1xyXG5cdH1cclxuXHRzZXQgaGFpckNvbG9yKGNvbCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGFpciAmJiBjb2wgIT0gdGhpcy5oYWlyQ29sb3IpIHtcclxuXHRcdFx0bGV0IGlkID0gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldENvbG9ySGFpcklEKHRoaXMuc2xvdHMuaGFpci5pZCwgY29sKTtcclxuXHRcdFx0dGhpcy51c2UoaWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGNvbFxyXG5cdCAqL1xyXG5cdGdldCBmYWNlQ29sb3IoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5mYWNlKSB7XHJcblx0XHRcdHJldHVybiBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0RmFjZUNvbG9yKHRoaXMuc2xvdHMuZmFjZS5pZCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gXCIwXCI7XHJcblx0fVxyXG5cdHNldCBmYWNlQ29sb3IoY29sKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5mYWNlICYmIGNvbCAhPSB0aGlzLmZhY2VDb2xvcikge1xyXG5cdFx0XHRsZXQgaWQgPSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JGYWNlSUQodGhpcy5zbG90cy5mYWNlLmlkLCBjb2wpO1xyXG5cdFx0XHR0aGlzLnVzZShpZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckNoYW5nZUxvZ30gY2hhbmdlTG9nXHJcblx0ICovXHJcblx0Y29tbWl0Q2hhbmdlKGNoYW5nZUxvZykge1xyXG5cdFx0aWYgKGNoYW5nZUxvZy5lYXIpIHtcclxuXHRcdFx0dGhpcy5lYXIgPSBjaGFuZ2VMb2cuZWFyO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLnVzZUVxdWlwKSB7XHJcblx0XHRcdGZvciAobGV0IGlkIG9mIHRoaXMudXNlRXF1aXApIHtcclxuXHRcdFx0XHR0aGlzLnVzZShpZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAodGhpcy51bnVzZUVxdWlwKSB7XHJcblx0XHRcdGZvciAobGV0IGlkIG9mIHRoaXMudW51c2VFcXVpcCkge1xyXG5cdFx0XHRcdHRoaXMudW51c2UoaWQpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGNoYW5nZUxvZy5oYWlyMiAmJiBjaGFuZ2VMb2cuaGFpck1peDIpIHtcclxuXHRcdFx0dGhpcy5zbG90cy5oYWlyQ29sb3IyID0gY2hhbmdlTG9nLmhhaXIyO1xyXG5cdFx0XHR0aGlzLnNsb3RzLmhhaXJNaXgyID0gY2hhbmdlTG9nLmhhaXJNaXgyO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChjaGFuZ2VMb2cuaGFpcjMgJiYgY2hhbmdlTG9nLmhhaXJNaXgzKSB7XHJcblx0XHRcdC8vdGhpcy5zbG90cy5oYWlyQ29sb3IzID0gY2hhbmdlTG9nLmhhaXIzO1xyXG5cdFx0XHQvL3RoaXMuc2xvdHMuaGFpck1peDMgPSBjaGFuZ2VMb2cuaGFpck1peDM7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmIChjaGFuZ2VMb2cud2VhcG9uICYmIGNoYW5nZUxvZy53ZWFwb25UeXBlKSB7XHJcblx0XHRcdHRoaXMudXNlKGNoYW5nZUxvZy53ZWFwb24sIGNoYW5nZUxvZy53ZWFwb25UeXBlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdF9zdHJpbmdpZnkoZ2VuQ29kZSkge1xyXG5cdFx0bGV0IHJlc3VsdCA9IHRoaXMuc2xvdHMuX3N0cmluZ2lmeSgpO1xyXG5cdFx0aWYgKGdlbkNvZGUpIHtcclxuXHRcdFx0cmV0dXJuIGBjaGFyYS5fcGFyc2UoJyR7cmVzdWx0fScpYDtcclxuXHRcdH1cclxuXHRcdHJldHVybiByZXN1bHQ7XHJcblx0fVxyXG5cclxuXHRfb3V0bGlua19vbGQoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5ib2R5ICYmIHRoaXMuc2xvdHMuYm9keS5pZCAmJiB0aGlzLnNsb3RzLmZhY2UgJiYgdGhpcy5zbG90cy5mYWNlLmlkICYmIHRoaXMuYWN0aW9uICYmIHRoaXMuZW1vdGlvbikge1xyXG5cdFx0XHRsZXQgbGluayA9IFwiaHR0cHM6Ly9sYWJzLm1hcGxlc3RvcnkuaW8vYXBpL0dNUy9sYXRlc3QvY2hhcmFjdGVyL2NlbnRlci9cIiArIHRoaXMuc2xvdHMuYm9keS5pZCArIFwiL1wiO1xyXG5cdFx0XHRsZXQgc2xvdHMgPSBbLi4udGhpcy5zbG90cy5lbnVtZXJhdGUoKV0ubWFwKGEgPT4gcGFyc2VJbnQoYS5pZCwgMTApKTtcclxuXHJcblx0XHRcdHNsb3RzWzBdID0gdGhpcy5zbG90cy5mYWNlLmlkICsgXCI6XCIgKyB0aGlzLmVtb3Rpb247XHJcblxyXG5cdFx0XHRsaW5rICs9IHNsb3RzLmpvaW4oXCIsXCIpO1xyXG5cclxuXHRcdFx0bGluayArPSBcIi9cIiArIHRoaXMuYWN0aW9uICsgXCI/c2hvd2VhcnM9XCIgKyAodGhpcy5lbGZFYXIgPyBcInRydWVcIiA6IFwiZmFsc2VcIik7XHJcblxyXG5cdFx0XHRsaW5rICs9IFwiJnNob3dMZWZFYXJzPVwiICsgKHRoaXMubGVmRWFyID8gXCJ0cnVlXCIgOiBcImZhbHNlXCIpO1xyXG5cclxuXHRcdFx0cmV0dXJuIGxpbms7XHJcblx0XHR9XHJcblx0XHRjb25zb2xlLmxvZyhcImNoYXJhY3RlciBuZWVkIGJvZHksIGZhY2UsIGFjdGlvbiwgZW1vdGlvblwiKTtcclxuXHR9XHJcblx0XHJcblx0X291dGxpbmsobmFtZSkge1xyXG5cdFx0Y29uc3QgYW5pbWF0aW9uTmFtZSA9IHRoaXMuYWN0aW9uO1xyXG5cdFx0Y29uc3QgZnJhbWUgPSB0aGlzLmFjdGlvbl9mcmFtZTtcclxuXHRcdGNvbnN0IHNsb3RzID0gdGhpcy5zbG90cztcclxuXHRcdGNvbnN0IGl0ZW1MaXN0ID0gSlNPTi5zdHJpbmdpZnkobWFrZUl0ZW1MaXN0LmNhbGwoKSk7XHJcblx0XHRyZXR1cm4gZW5jb2RlVVJJKFxyXG5cdFx0XHRcdFwiaHR0cHM6Ly9tYXBsZXN0b3J5LmlvL2FwaS9jaGFyYWN0ZXIvXCIgK1xyXG5cdFx0XHRcdGl0ZW1MaXN0LnNsaWNlKDEsIGl0ZW1MaXN0Lmxlbmd0aCAtIDEpICsgICAgLy8gbm90IGFycmF5XHJcblx0XHRcdFx0XCIvXCIgKyBhbmltYXRpb25OYW1lICsgXCIvXCIgKyBmcmFtZSArIFwiP1wiICtcclxuXHRcdFx0XHRcInNob3dlYXJzPVwiICsgdGhpcy5lbGZFYXIgK1xyXG5cdFx0XHRcdFwiJnNob3dMZWZFYXJzPVwiICsgdGhpcy5sZWZFYXIgK1xyXG5cdFx0XHRcdFwiJnJlc2l6ZT0xXCIgK1xyXG5cdFx0XHRcdChuYW1lID8gKFwiJm5hbWU9XCIgKyBuYW1lKSA6IFwiXCIpICtcclxuXHRcdFx0XHRcIiZmbGlwWD1cIiArIEJvb2xlYW4odGhpcy5mcm9udCA+IDApICtcclxuXHRcdFx0XHRcIiZiZ0NvbG9yPTAsMCwwLDBcIlxyXG5cdFx0XHRcdCk7XHJcblx0XHRmdW5jdGlvbiBtYWtlSXRlbUxpc3QoKSB7XHJcblx0XHRcdHJldHVybiBPYmplY3QudmFsdWVzKHNsb3RzKS5maWx0ZXIoYSA9PiBhKS5tYXAodHJhbnNmb3JtSXRlbURhdGEpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gdHJhbnNmb3JtSXRlbURhdGEoaXRlbSkge1xyXG5cdFx0XHRsZXQgcmVnaW9uLCB2ZXJzaW9uO1xyXG5cdFx0XHRpZiAoaXRlbS5fcmF3LmluZm8uX192KSB7XHJcblx0XHRcdFx0Y29uc3QgbSA9IGl0ZW0uX3Jhdy5pbmZvLl9fdi50b1VwcGVyQ2FzZSgpLm1hdGNoKC8oW0EtWl0qKShbMC05XSopLyk7XHJcblx0XHRcdFx0cmVnaW9uID0gbVsxXSA9PSBcIlRXTVNcIiA/IFwiVE1TXCIgOiBtWzFdO1xyXG5cdFx0XHRcdHZlcnNpb24gPSBcImxhdGVzdFwiOy8vbVsyXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZWdpb24gPVwiVE1TXCI7XHJcblx0XHRcdFx0dmVyc2lvbiA9IFwibGF0ZXN0XCI7XHJcblx0XHRcdH1cclxuXHRcdFx0Y29uc3QgZmlsdGVyID0gaXRlbS5maWx0ZXI7XHJcblx0XHRcdHJldHVybiB7XHJcblx0XHRcdFx0aXRlbUlkOiAgICAgICAgTnVtYmVyKGl0ZW0uaWQpLFxyXG5cdFx0XHRcdHJlZ2lvbjogICAgICAgIHJlZ2lvbixcclxuXHRcdFx0XHR2ZXJzaW9uOiAgICAgICB2ZXJzaW9uLFxyXG5cdFx0XHRcdGh1ZTogICAgICAgICAgIGZpbHRlci5odWUsXHJcblx0XHRcdFx0c2F0dXJhdGlvbjogICAgc3RyTnVtKGZpbHRlci5zYXQpLFxyXG5cdFx0XHRcdGJyaWdodG5lc3M6ICAgIHN0ck51bShmaWx0ZXIuYnJpKSxcclxuXHRcdFx0XHRjb250cmFzdDogICAgICBzdHJOdW0oZmlsdGVyLmNvbnRyYXN0KSxcclxuXHRcdFx0XHRhbHBoYTogICAgICAgICBOdW1iZXIoaXRlbS5vcGFjaXR5LnRvRml4ZWQoMSkpLFxyXG5cdFx0XHRcdGFuaW1hdGlvbk5hbWU6IGFuaW1hdGlvbk5hbWUsXHJcblx0XHRcdH07XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBzdHJOdW0odmFsKSB7XHJcblx0XHRcdHJldHVybiAodmFsIC8gMTAwKS50b0ZpeGVkKDEpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRfZG93bmxvYWQoKSB7XHJcblx0XHR3aW5kb3cub3Blbih0aGlzLl9vdXRsaW5rKCkpO1xyXG5cdH1cclxuXHJcblx0X3NhdmVfYXNfc3ZnKCkge1xyXG5cdFx0dGhpcy5fX3RleHR1cmVfdG9fYmFzZTY0KCkudGhlbihmcmFnX2xpc3QgPT4ge1xyXG5cdFx0XHRsZXQgZmlsZV9uYW1lID0gdGhpcy5pZCArIFwiLnN2Z1wiO1xyXG5cdFx0XHQvL2xldCBmcmFnX2xpc3QgPSB0aGlzLl9fZnJhZ19saXN0O1xyXG5cdFxyXG5cdFx0XHRsZXQgc3ZnID0gJzwhRE9DVFlQRSBzdmcgUFVCTElDIFwiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU5cIiBcImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZFwiID4nO1xyXG5cclxuXHRcdFx0c3ZnICs9ICc8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz0gXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rXCI+XFxuJzsvLyB3aWR0aD1cIjY0XCIgaGVpZ2h0PVwiOTZcIlxyXG5cclxuXHRcdFx0c3ZnICs9ICc8ZyB0cmFuc2Zvcm09XCJ0cmFuc2xhdGUoMzIsIDk2KVwiPic7XHJcblx0XHRcdGZyYWdfbGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChmdCkge1xyXG5cdFx0XHRcdGlmIChmdCAmJiBmdC5yZWxhdGl2ZSkge1xyXG5cdFx0XHRcdFx0bGV0IGNseiA9IGZ0LmNsYXNzTGlzdDtcclxuXHRcdFx0XHRcdHN2ZyArPSBgXFx0PGltYWdlIGNsYXNzPVwiJHtjbHp9XCIgb3BhY2l0eT1cIiR7ZnQudmlzaWJsZSA/IGZ0Lm9wYWNpdHkgOiAwfVwiIHg9XCIke2Z0LnJlbGF0aXZlLnh9XCIgeT1cIiR7ZnQucmVsYXRpdmUueX1cIiB3aWR0aD1cIiR7ZnQud2lkdGh9XCIgaGVpZ2h0PVwiJHtmdC5oZWlnaHR9XCIgeGxpbms6aHJlZj1cIiR7ZnQuX3VybH1cIj48L2ltYWdlPlxcbmA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0c3ZnICs9ICc8L2c+JztcclxuXHJcblx0XHRcdHN2ZyArPSAnPHRleHQgeD1cIjBcIiB5PVwiMTIyXCIgZmlsbD1cInRyYW5zcGFyZW50XCI+JyArIHRoaXMuX3N0cmluZ2lmeShmYWxzZSkgKyAnPC90ZXh0Pic7XHJcblxyXG5cdFx0XHRzdmcgKz0gJzwvc3ZnPic7XHJcblxyXG5cdFx0XHQvL2xldCB1cmwgPSBcImRhdGE6dGV4dC9wbGFpbjt1dGY4LFwiICsgc3ZnO1xyXG5cclxuXHRcdFx0ZGVidWdnZXI7XHJcblxyXG5cdFx0XHQvL3dpbmRvdy5vcGVuKHVybCk7XHJcblx0XHRcdERvd25sb2FkRGF0YShzdmcsIFwiaW1hZ2Uvc3ZnK3htbDt1dGY4XCIsIGZpbGVfbmFtZSk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIFwiZGF0YTppbWFnZS9wbmc7YmFzZTY0LFsuLi5dXCJcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZmlsZW5hbWVcclxuXHQgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdF9zYXZlX2FzX3BuZyhyZW5kZXJlciwgZmlsZW5hbWUpIHtcclxuXHRcdGxldCBib3VuZCA9IHRoaXMuX2NhbGNCb3VuZEJveCgpO1xyXG5cdFx0bGV0IHNpemUgPSBib3VuZC5zaXplO1xyXG5cdFx0bGV0IHggPSAtYm91bmQubGVmdDtcclxuXHRcdGxldCB5ID0gYm91bmQuaGVpZ2h0O1xyXG5cdFx0bGV0IGFuZ2xlID0gMDtcclxuXHRcdGxldCBmcm9udCA9IGZhbHNlO1xyXG5cclxuXHRcdC8vIHVzZSBDYW52YXMyLCBtdXN0IG5vdCBmYWlsXHJcblx0XHR0cnkge1xyXG5cdFx0XHRyZW5kZXJlci4kc3dhcENhbnZhcygpO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly9zYXZlIENhbnZhczIgc2l6ZSwgY3VycmVudCBjdHggaXMgX2N0eDJcclxuXHRcdGNvbnN0IGMydyA9IHJlbmRlcmVyLl9jdHgyLmNhbnZhcy53aWR0aDtcclxuXHRcdGNvbnN0IGMyaCA9IHJlbmRlcmVyLl9jdHgyLmNhbnZhcy5oZWlnaHQ7XHJcblx0XHQvL1xyXG5cdFx0cmVuZGVyZXIuY3R4LmNhbnZhcy53aWR0aCA9IHNpemUueDtcclxuXHRcdHJlbmRlcmVyLmN0eC5jYW52YXMuaGVpZ2h0ID0gc2l6ZS55O1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdHRoaXMuX2RyYXcocmVuZGVyZXIsIHgsIHksIGFuZ2xlLCBmcm9udCk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihleCk7XHJcblx0XHRcdC8vIG5vdGhpbmdcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgYmFzZTY0ID0gcmVuZGVyZXIuY3R4LmNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9wbmdcIik7XHJcblx0XHR7XHJcblx0XHRcdGxldCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblxyXG5cdFx0XHRsZXQgbmFtZSA9IGAke2ZpbGVuYW1lID8gKGZpbGVuYW1lK1wiLlwiKTpcIlwifSR7dGhpcy5hY3Rpb259WyR7dGhpcy5hY3Rpb25fZnJhbWV9XS4ke3RoaXMuZW1vdGlvbn1bJHt0aGlzLmVtb3Rpb25fZnJhbWV9XS5wbmdgO1xyXG5cclxuXHRcdFx0ZWxlbS5pZCA9IG5hbWU7XHJcblx0XHRcdGVsZW0uZG93bmxvYWQgPSBuYW1lO1xyXG5cdFx0XHRlbGVtLmhyZWYgPSBiYXNlNjQ7XHJcblxyXG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW0pO1xyXG5cdFx0XHRlbGVtLmNsaWNrKCk7XHJcblx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly9yZXN0b3JlIENhbnZhczIgc2l6ZSwgY3VycmVudCBjdHggaXMgX2N0eDJcclxuXHRcdHJlbmRlcmVyLmN0eC5jYW52YXMud2lkdGggPSBjMnc7XHJcblx0XHRyZW5kZXJlci5jdHguY2FudmFzLmhlaWdodCA9IGMyaDtcclxuXHJcblx0XHQvLyByZXN0b3JlIENhbnZhcywgbXVzdCBub3QgZmFpbFxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0cmVuZGVyZXIuJHN3YXBDYW52YXMoKTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKGV4KTtcclxuXHRcdFx0Ly8gbm90aGluZ1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBiYXNlNjQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7UHJvbWlzZTxGcmFnbWVudFRleHR1cmVbXT59XHJcblx0ICovXHJcblx0YXN5bmMgX190ZXh0dXJlX3RvX2Jhc2U2NCgpIHtcclxuXHRcdGxldCBmcmFnX2xpc3QgPSB0aGlzLl9fZnJhZ19saXN0O1xyXG5cdFx0bGV0IHRhc2tzID0gW107XHJcblxyXG5cdFx0ZnJhZ19saXN0LmZvckVhY2goZnVuY3Rpb24gKGZ0KSB7XHJcblx0XHRcdGlmICghZnQpIHtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCFmdC5fdXJsLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSkge1xyXG5cdFx0XHRcdHRhc2tzLnB1c2goKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdGZ0LnRleHR1cmUuJHNyYyA9IGZ0Ll91cmw7XHJcblx0XHRcdFx0XHRmdC5fdXJsID0gYXdhaXQgdG9EYXRhVVJMKGZ0Ll91cmwpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZ0O1xyXG5cdFx0XHRcdH0pKCkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRhc2tzLnB1c2goZnQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChmdC5ncmFwaDIpIHtcclxuXHRcdFx0XHRsZXQgc3JjID0gZnQuZ3JhcGgyLl91cmw7XHJcblx0XHRcdFx0aWYgKCFzcmMuc3RhcnRzV2l0aChcImRhdGE6XCIpKSB7XHJcblx0XHRcdFx0XHR0YXNrcy5wdXNoKChhc3luYyBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdGZ0LnRleHR1cmUuJHNyYyA9IGZ0Ll91cmw7XHJcblx0XHRcdFx0XHRcdGZ0LmdyYXBoMi5fdXJsID0gYXdhaXQgdG9EYXRhVVJMKHNyYyk7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmdC5ncmFwaDI7XHJcblx0XHRcdFx0XHR9KSgpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0YXNrcy5wdXNoKGZ0LmdyYXBoMik7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChmdC5ncmFwaDMpIHtcclxuXHRcdFx0XHRsZXQgc3JjID0gZnQuZ3JhcGgzLl91cmw7XHJcblx0XHRcdFx0aWYgKCFzcmMuc3RhcnRzV2l0aChcImRhdGE6XCIpKSB7XHJcblx0XHRcdFx0XHR0YXNrcy5wdXNoKChhc3luYyBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRcdGZ0LnRleHR1cmUuJHNyYyA9IGZ0Ll91cmw7XHJcblx0XHRcdFx0XHRcdGZ0LmdyYXBoMy5fdXJsID0gYXdhaXQgdG9EYXRhVVJMKHNyYyk7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmdC5ncmFwaDM7XHJcblx0XHRcdFx0XHR9KSgpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0YXNrcy5wdXNoKGZ0LmdyYXBoMyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHJcblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwodGFza3MpO1xyXG5cdH1cclxufVxyXG5BZGRJbml0VGFzayhDaGFyYWN0ZXJSZW5kZXJlci5Jbml0KTtcclxuXHJcbmZ1bmN0aW9uKiBjaXJjdWxhclNlcXVlbmNlKGxlbmd0aCwgc3RhcnQ9MCkge1xyXG5cdGxldCBpID0gc3RhcnQ7XHJcblx0Zm9yICg7IGkgPCBsZW5ndGg7ICsraSkgey8vYTogMCwgMSwgMiwgMywgLi4uYlxyXG5cdFx0eWllbGQgaTtcclxuXHR9XHJcblx0Zm9yIChpIC09IDI7IGkgPiAwOyAtLWkpIHsvL2I6IDIsIDEsIC4uLmFcclxuXHRcdHlpZWxkIGk7XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiogbGluZWFyU2VxdWVuY2UobGVuZ3RoLCBzdGFydD0wKSB7XHJcblx0Zm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgbGVuZ3RoOyArK2kpIHtcclxuXHRcdHlpZWxkIGk7XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiBleHRyYWN0X251bWJlcihpbnB1dCkge1xyXG5cdHJldHVybiBTdHJpbmcoaW5wdXQpLm1hdGNoKC8oLT9cXGQrXFwuP1xcZCopfChcXC5cXGQqKS9nKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGltYWdlIGhyZWYgdG8gZGF0YSB1cmxcclxuICovXHJcbmZ1bmN0aW9uIHRvRGF0YVVSTCh1cmwpIHtcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cdFx0bGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cdFx0eGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0bGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcblx0XHRcdHJlYWRlci5vbmxvYWRlbmQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0cmVzb2x2ZShyZWFkZXIucmVzdWx0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uIChldikge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdHJlamVjdChldik7XHJcblx0XHRcdH1cclxuXHRcdFx0cmVhZGVyLnJlYWRBc0RhdGFVUkwoeGhyLnJlc3BvbnNlKTtcclxuXHRcdH07XHJcblx0XHR4aHIub3BlbignR0VUJywgdXJsKTtcclxuXHRcdHhoci5yZXNwb25zZVR5cGUgPSAnYmxvYic7XHJcblx0XHR4aHIuc2VuZCgpO1xyXG5cdH0pO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///335\n')},341:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return SpriteBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Sprite; });\n/* unused harmony export _$PatternSprite_Loaded */\n/* unused harmony export $PatternSprite */\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(332);\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(331);\n/* harmony import */ var _Engine_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(334);\n\ufeff\r\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @extends {IGraph}\r\n */\r\nclass SpriteBase extends _Engine_js__WEBPACK_IMPORTED_MODULE_2__["Graph"] {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tif (raw) {\r\n\t\t\tsuper(url, {\r\n\t\t\t\twidth: raw.__w,\r\n\t\t\t\theight: raw.__h,\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsuper();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._raw = raw;\r\n\t\t\r\n\t\t//this.src is broken;\r\n\r\n\t\tif (url) {\r\n\t\t\tdebugger\r\n\t\t\tthis._url = url;\r\n\t\t\t//this._loadTexture(url);//_loadTexture: undefined\r\n\t\t}\r\n\t\telse if (SpriteBase.isTexture(raw) !== false) {\r\n\t\t\tthis._url = raw[""];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isTexture(raw) {\r\n\t\tif (raw) {\r\n\t\t\tif (raw.hasOwnProperty("")) {\r\n\t\t\t\tif (typeof raw[""] == \'string\') {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!raw.__isEmpty) {\r\n\t\t\t\t\tconsole.group("no texture");\r\n\t\t\t\t\tconsole.warn(raw);\r\n\t\t\t\t\tconsole.groupEnd();\r\n\t\t\t\t\tthrow new Error("no texture");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tstatic isTextureHasData(raw) {\r\n\t\treturn raw && typeof raw[""] == \'string\' && raw[""].startsWith("data:image/");\r\n\t}\r\n\r\n\tset z(value) {\r\n\t\tthis._order = value;\r\n\t}\r\n\tget z() {\r\n\t\treturn this._order;\r\n\t}\r\n\t\r\n\t/**\r\n\t * try construct value from raw data\r\n\t * @param {T} defaultValue\r\n\t * @param {string} propertyName\r\n\t * @param {function(any):T} constructor\r\n\t * @returns {T}\r\n\t * @template T\r\n\t */\r\n\t_get(defaultValue, propertyName, converter) {\r\n\t\tif (!this._raw) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\telse if (propertyName in this._raw) {\r\n\t\t\treturn converter(this._raw[propertyName]);\r\n\t\t}\r\n\t\treturn defaultValue;\r\n\t}\r\n\r\n\tdraw() {\r\n\t\tthis._engine.drawGraph(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw2(x, y) {\r\n\t\tthis._engine.drawGraph2(this, x - this.x, y - this.y);\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t */\r\n\tdraw2i(x, y) {\r\n\t\tthis._engine.drawGraph2(this, Math.trunc(x - this.x + 0.5), Math.trunc(y - this.y + 0.5));\r\n\t}\r\n}\r\n\r\n\r\nclass Sprite extends SpriteBase {\r\n\t/**\r\n\t * sprite = new Sprite(rawData);//不會載入image\r\n\t * sprite._url = img_url;//不會載入image\r\n\t *\r\n\t * 會觸發載入image的method\r\n\t * draw(), isLoaded(), get width(), get height()\r\n\t * \r\n\t * 手動載入image: __loadTexture()\r\n\t * \r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\tvar origin = this._get(new _math_js__WEBPACK_IMPORTED_MODULE_0__["Vec2"](0, 0), "origin", _math_js__WEBPACK_IMPORTED_MODULE_0__["Vec2"].get);\r\n\t\tthis.x = origin.x;\r\n\t\tthis.y = origin.y;\r\n\r\n\t\tthis.z = this._get(0, "z", Number);\r\n\r\n\t\tthis.delay = this._get(100, "delay", Number);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(x, y, w, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tctx.rect(x, y, w, h);\r\n\t\t\tctx.clip();\r\n\r\n\t\t\tlet left = x;\r\n\t\t\tlet top = y;\r\n\t\t\tlet right = x + w;\r\n\t\t\tlet bottom = y + h;\r\n\r\n\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t */\r\n\tdrawHorizontalPattern(x, y, w) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tconst left = x;\r\n\t\t\tconst right = x + w;\r\n\r\n\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\tthis.draw2(j, y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} h\r\n\t */\r\n\tdrawVerticalPattern(x, y, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tconst top = y;\r\n\t\t\tconst bottom = y + h;\r\n\r\n\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\tthis.draw2(x, i);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\t_drawPattern(x, y, w, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t\r\n\t\tconst sw = Math.trunc(w / this.width) * this.width;\r\n\t\tconst sh = Math.trunc(h / this.height) * this.height;\r\n\t\t\r\n\t\tconst left = x;\r\n\t\tconst top = y;\r\n\t\tconst right = x + sw;\r\n\t\tconst bottom = y + h;\r\n\r\n\t\tlet i, j;\r\n\r\n\t\tif (h >= this.height) {\r\n\t\t\tfor (i = top; i < bottom; i += this.height) {\r\n\t\t\t\tif (w >= this.width) {\r\n\t\t\t\t\tfor (j = left; j < right; j += this.width) {\r\n\t\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet sx = w - sw;\r\n\t\t\t\t\tif (sx > 0) {\r\n\t\t\t\t\t\tthis._engine._drawImage(this, 0, 0, sx, this.height, j - this.x, i - this.y, sx, this.height);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._engine._drawImage(this, 0, 0, w, this.height, left - this.x, i - this.y, w, this.height);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet sy = h - sh;\r\n\t\t\tif (sy > 0) {\r\n\t\t\t\tconsole.error(new Error("未完成"));\r\n\t\t\t\tthis._engine._drawImage(this, 0, 0, this.width, sy, left - this.x, i - this.y, this.width, sy);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(new Error("未完成"));\r\n\t\t\tthis._engine._drawImage(this, 0, 0, this.width, h, left - this.x, top - this.y, this.width, h);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t */\r\n\t_drawHorizontalPattern(x, y, w) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tconst left = x;\r\n\t\tconst right = x + w;\r\n\r\n\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\tthis.draw2(j, y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} h\r\n\t */\r\n\t_drawVerticalPattern(x, y, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tconst top = y;\r\n\t\tconst bottom = y + h;\r\n\r\n\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\tthis.draw2(x, i);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\tdrawPattern4i(x, y, w, h) {\r\n\t\tthis.drawPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t */\r\n\tdrawHorizontalPattern3i(x, y, w) {\r\n\t\tthis.drawHorizontalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5));\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\tdrawVerticalPattern3i(x, y, h) {\r\n\t\tthis.drawVerticalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\t_drawPattern4i(x, y, w, h) {\r\n\t\tthis._drawPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t */\r\n\t_drawHorizontalPattern3i(x, y, w) {\r\n\t\tthis._drawHorizontalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\t_drawVerticalPattern3i(x, y, h) {\r\n\t\tthis._drawVerticalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n}\r\n\r\nclass _$PatternSprite_Loaded extends Sprite {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._direction = null;\r\n\r\n\t\t/** @type {CanvasPattern} */\r\n\t\tthis._pattern = null;\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget direction() {\r\n\t\treturn this._direction;\r\n\t}\r\n\tset direction(value) {\r\n\t\tif (value && this._direction != value) {\r\n\t\t\tthis._direction = value;\r\n\t\r\n\t\t\t//reload;\r\n\t\t\tthis._pattern = null;\r\n\t\t\tthis.__proto__ = $PatternSprite.prototype;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(w, h) {\r\n\t\tif (this.direction && this._pattern) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tctx.rect(-this.x, -this.y, w, h);\r\n\t\t\tctx.fillStyle = this._pattern;\r\n\t\t\tctx.fill();\r\n\t\t\tctx.fillStyle = "no-repeat";\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.direction && this._pattern) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tctx.rect(x - this.x, y - this.y, w, h);\r\n\t\t\tctx.fillStyle = this._pattern;\r\n\t\t\tctx.fill();\r\n\t\t\tctx.fillStyle = "no-repeat";\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {"repeat"} */\r\n\tget e_repeat() {\r\n\t\treturn "repeat";\r\n\t}\r\n\t/** @returns {"repeat-x"} */\r\n\tget e_repeat_x() {\r\n\t\treturn "repeat-x";\r\n\t}\r\n\t/** @returns {"repeat-y"} */\r\n\tget e_repeat_y() {\r\n\t\treturn "repeat-y";\r\n\t}\r\n\t/** @returns {"no-repeat"} */\r\n\tget e_noRepeat() {\r\n\t\treturn "no-repeat";\r\n\t}\r\n}\r\n\r\nclass $PatternSprite extends _$PatternSprite_Loaded {\r\n\tdrawPattern(w, h) {\r\n\t\tthis.drawPattern2(0, 0, w, h);\r\n\t}\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.isLoaded()) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\t\tctx.save();\r\n\t\t\t{\r\n\t\t\t\tctx.rect(x, y, w, h);\r\n\t\t\t\tctx.clip();\r\n\t\t\t\t\r\n\t\t\t\tlet left = x;\r\n\t\t\t\tlet top = y;\r\n\t\t\t\tlet right = x + w;\r\n\t\t\t\tlet bottom = y + h;\r\n\r\n\t\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(w, h) {\r\n\t\tif (this.direction) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tif (!this._pattern) {\r\n\t\t\t\tif (this.isLoaded()) {\r\n\t\t\t\t\tthis._pattern = ctx.createPattern(this.texture, this.direction);\r\n\t\t\t\t\tthis.__proto__ = _$PatternSprite_Loaded.prototype;\r\n\t\t\t\t\tthis.drawPattern(w, h);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.direction) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tif (!this._pattern) {\r\n\t\t\t\tif (this.isLoaded()) {\r\n\t\t\t\t\tthis._pattern = ctx.createPattern(this.texture, this.direction);\r\n\t\t\t\t\tthis.__proto__ = _$PatternSprite_Loaded.prototype;\r\n\t\t\t\t\tthis.drawPattern2(x, y, w, h);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzQxLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvU3ByaXRlLmpzPzA3NzQiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IFZlYzIsIFJlY3RhbmdsZSB9IGZyb20gXCIuL21hdGguanNcIjtcclxuaW1wb3J0IHsgSUdycGFoLCBJUmVuZGVyZXIsIElHcmFwaCB9IGZyb20gXCIuL0lSZW5kZXJlci5qc1wiO1xyXG5cclxuaW1wb3J0IHsgZW5naW5lLCBHcmFwaCB9IGZyb20gXCIuL0VuZ2luZS5qc1wiO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBAZXh0ZW5kcyB7SUdyYXBofVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNwcml0ZUJhc2UgZXh0ZW5kcyBHcmFwaCB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHshYW55fSByYXdcclxuXHQgKiBAcGFyYW0ge3N0cmluZz19IHVybFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHRpZiAocmF3KSB7XHJcblx0XHRcdHN1cGVyKHVybCwge1xyXG5cdFx0XHRcdHdpZHRoOiByYXcuX193LFxyXG5cdFx0XHRcdGhlaWdodDogcmF3Ll9faCxcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0c3VwZXIoKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuX3JhdyA9IHJhdztcclxuXHRcdFxyXG5cdFx0Ly90aGlzLnNyYyBpcyBicm9rZW47XHJcblxyXG5cdFx0aWYgKHVybCkge1xyXG5cdFx0XHRkZWJ1Z2dlclxyXG5cdFx0XHR0aGlzLl91cmwgPSB1cmw7XHJcblx0XHRcdC8vdGhpcy5fbG9hZFRleHR1cmUodXJsKTsvL19sb2FkVGV4dHVyZTogdW5kZWZpbmVkXHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChTcHJpdGVCYXNlLmlzVGV4dHVyZShyYXcpICE9PSBmYWxzZSkge1xyXG5cdFx0XHR0aGlzLl91cmwgPSByYXdbXCJcIl07XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgaXNUZXh0dXJlKHJhdykge1xyXG5cdFx0aWYgKHJhdykge1xyXG5cdFx0XHRpZiAocmF3Lmhhc093blByb3BlcnR5KFwiXCIpKSB7XHJcblx0XHRcdFx0aWYgKHR5cGVvZiByYXdbXCJcIl0gPT0gJ3N0cmluZycpIHtcclxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRpZiAoIXJhdy5fX2lzRW1wdHkpIHtcclxuXHRcdFx0XHRcdGNvbnNvbGUuZ3JvdXAoXCJubyB0ZXh0dXJlXCIpO1xyXG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKHJhdyk7XHJcblx0XHRcdFx0XHRjb25zb2xlLmdyb3VwRW5kKCk7XHJcblx0XHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJubyB0ZXh0dXJlXCIpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHRzdGF0aWMgaXNUZXh0dXJlSGFzRGF0YShyYXcpIHtcclxuXHRcdHJldHVybiByYXcgJiYgdHlwZW9mIHJhd1tcIlwiXSA9PSAnc3RyaW5nJyAmJiByYXdbXCJcIl0uc3RhcnRzV2l0aChcImRhdGE6aW1hZ2UvXCIpO1xyXG5cdH1cclxuXHJcblx0c2V0IHoodmFsdWUpIHtcclxuXHRcdHRoaXMuX29yZGVyID0gdmFsdWU7XHJcblx0fVxyXG5cdGdldCB6KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX29yZGVyO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiB0cnkgY29uc3RydWN0IHZhbHVlIGZyb20gcmF3IGRhdGFcclxuXHQgKiBAcGFyYW0ge1R9IGRlZmF1bHRWYWx1ZVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eU5hbWVcclxuXHQgKiBAcGFyYW0ge2Z1bmN0aW9uKGFueSk6VH0gY29uc3RydWN0b3JcclxuXHQgKiBAcmV0dXJucyB7VH1cclxuXHQgKiBAdGVtcGxhdGUgVFxyXG5cdCAqL1xyXG5cdF9nZXQoZGVmYXVsdFZhbHVlLCBwcm9wZXJ0eU5hbWUsIGNvbnZlcnRlcikge1xyXG5cdFx0aWYgKCF0aGlzLl9yYXcpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChwcm9wZXJ0eU5hbWUgaW4gdGhpcy5fcmF3KSB7XHJcblx0XHRcdHJldHVybiBjb252ZXJ0ZXIodGhpcy5fcmF3W3Byb3BlcnR5TmFtZV0pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuXHR9XHJcblxyXG5cdGRyYXcoKSB7XHJcblx0XHR0aGlzLl9lbmdpbmUuZHJhd0dyYXBoKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqL1xyXG5cdGRyYXcyKHgsIHkpIHtcclxuXHRcdHRoaXMuX2VuZ2luZS5kcmF3R3JhcGgyKHRoaXMsIHggLSB0aGlzLngsIHkgLSB0aGlzLnkpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geCAtIHR5cGU6IGludFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gdHlwZTogaW50XHJcblx0ICovXHJcblx0ZHJhdzJpKHgsIHkpIHtcclxuXHRcdHRoaXMuX2VuZ2luZS5kcmF3R3JhcGgyKHRoaXMsIE1hdGgudHJ1bmMoeCAtIHRoaXMueCArIDAuNSksIE1hdGgudHJ1bmMoeSAtIHRoaXMueSArIDAuNSkpO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBTcHJpdGUgZXh0ZW5kcyBTcHJpdGVCYXNlIHtcclxuXHQvKipcclxuXHQgKiBzcHJpdGUgPSBuZXcgU3ByaXRlKHJhd0RhdGEpOy8v5LiN5pyD6LyJ5YWlaW1hZ2VcclxuXHQgKiBzcHJpdGUuX3VybCA9IGltZ191cmw7Ly/kuI3mnIPovInlhaVpbWFnZVxyXG5cdCAqXHJcblx0ICog5pyD6Ke455m86LyJ5YWlaW1hZ2XnmoRtZXRob2RcclxuXHQgKiBkcmF3KCksIGlzTG9hZGVkKCksIGdldCB3aWR0aCgpLCBnZXQgaGVpZ2h0KClcclxuXHQgKiBcclxuXHQgKiDmiYvli5XovInlhaVpbWFnZTogX19sb2FkVGV4dHVyZSgpXHJcblx0ICogXHJcblx0ICogQHBhcmFtIHshYW55fSByYXdcclxuXHQgKiBAcGFyYW0ge3N0cmluZz19IHVybFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHRzdXBlcihyYXcsIHVybCk7XHJcblxyXG5cdFx0dmFyIG9yaWdpbiA9IHRoaXMuX2dldChuZXcgVmVjMigwLCAwKSwgXCJvcmlnaW5cIiwgVmVjMi5nZXQpO1xyXG5cdFx0dGhpcy54ID0gb3JpZ2luLng7XHJcblx0XHR0aGlzLnkgPSBvcmlnaW4ueTtcclxuXHJcblx0XHR0aGlzLnogPSB0aGlzLl9nZXQoMCwgXCJ6XCIsIE51bWJlcik7XHJcblxyXG5cdFx0dGhpcy5kZWxheSA9IHRoaXMuX2dldCgxMDAsIFwiZGVsYXlcIiwgTnVtYmVyKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhcclxuXHQgKi9cclxuXHRkcmF3UGF0dGVybih4LCB5LCB3LCBoKSB7XHJcblx0XHRpZiAoIXRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRyZXR1cm47Ly9zcHJpdGUgcmVxdWlyZSBwcm9wZXJ0eTogd2lkdGgsIGhlaWdodFxyXG5cdFx0fVxyXG5cdFx0LyoqIEB0eXBlIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICovXHJcblx0XHRjb25zdCBjdHggPSB0aGlzLl9lbmdpbmUuY3R4O1xyXG5cclxuXHRcdGN0eC5zYXZlKCk7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRjdHgucmVjdCh4LCB5LCB3LCBoKTtcclxuXHRcdFx0Y3R4LmNsaXAoKTtcclxuXHJcblx0XHRcdGxldCBsZWZ0ID0geDtcclxuXHRcdFx0bGV0IHRvcCA9IHk7XHJcblx0XHRcdGxldCByaWdodCA9IHggKyB3O1xyXG5cdFx0XHRsZXQgYm90dG9tID0geSArIGg7XHJcblxyXG5cdFx0XHRmb3IgKGxldCBpID0gdG9wOyBpIDwgYm90dG9tOyBpICs9IHRoaXMuaGVpZ2h0KSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgaiA9IGxlZnQ7IGogPCByaWdodDsgaiArPSB0aGlzLndpZHRoKSB7XHJcblx0XHRcdFx0XHR0aGlzLmRyYXcyKGosIGkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdGN0eC5yZXN0b3JlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHdcclxuXHQgKi9cclxuXHRkcmF3SG9yaXpvbnRhbFBhdHRlcm4oeCwgeSwgdykge1xyXG5cdFx0aWYgKCF0aGlzLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0cmV0dXJuOy8vc3ByaXRlIHJlcXVpcmUgcHJvcGVydHk6IHdpZHRoLCBoZWlnaHRcclxuXHRcdH1cclxuXHRcdC8qKiBAdHlwZSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAqL1xyXG5cdFx0Y29uc3QgY3R4ID0gdGhpcy5fZW5naW5lLmN0eDtcclxuXHJcblx0XHRjdHguc2F2ZSgpO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Y29uc3QgbGVmdCA9IHg7XHJcblx0XHRcdGNvbnN0IHJpZ2h0ID0geCArIHc7XHJcblxyXG5cdFx0XHRmb3IgKGxldCBqID0gbGVmdDsgaiA8IHJpZ2h0OyBqICs9IHRoaXMud2lkdGgpIHtcclxuXHRcdFx0XHR0aGlzLmRyYXcyKGosIHkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihleCk7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdFx0Y3R4LnJlc3RvcmUoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHlcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaFxyXG5cdCAqL1xyXG5cdGRyYXdWZXJ0aWNhbFBhdHRlcm4oeCwgeSwgaCkge1xyXG5cdFx0aWYgKCF0aGlzLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0cmV0dXJuOy8vc3ByaXRlIHJlcXVpcmUgcHJvcGVydHk6IHdpZHRoLCBoZWlnaHRcclxuXHRcdH1cclxuXHRcdC8qKiBAdHlwZSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAqL1xyXG5cdFx0Y29uc3QgY3R4ID0gdGhpcy5fZW5naW5lLmN0eDtcclxuXHJcblx0XHRjdHguc2F2ZSgpO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0Y29uc3QgdG9wID0geTtcclxuXHRcdFx0Y29uc3QgYm90dG9tID0geSArIGg7XHJcblxyXG5cdFx0XHRmb3IgKGxldCBpID0gdG9wOyBpIDwgYm90dG9tOyBpICs9IHRoaXMuaGVpZ2h0KSB7XHJcblx0XHRcdFx0dGhpcy5kcmF3Mih4LCBpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdGN0eC5yZXN0b3JlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiB3aXRob3V0IGNsaXBcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHdcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaFxyXG5cdCAqL1xyXG5cdF9kcmF3UGF0dGVybih4LCB5LCB3LCBoKSB7XHJcblx0XHRpZiAoIXRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRyZXR1cm47Ly9zcHJpdGUgcmVxdWlyZSBwcm9wZXJ0eTogd2lkdGgsIGhlaWdodFxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRjb25zdCBzdyA9IE1hdGgudHJ1bmModyAvIHRoaXMud2lkdGgpICogdGhpcy53aWR0aDtcclxuXHRcdGNvbnN0IHNoID0gTWF0aC50cnVuYyhoIC8gdGhpcy5oZWlnaHQpICogdGhpcy5oZWlnaHQ7XHJcblx0XHRcclxuXHRcdGNvbnN0IGxlZnQgPSB4O1xyXG5cdFx0Y29uc3QgdG9wID0geTtcclxuXHRcdGNvbnN0IHJpZ2h0ID0geCArIHN3O1xyXG5cdFx0Y29uc3QgYm90dG9tID0geSArIGg7XHJcblxyXG5cdFx0bGV0IGksIGo7XHJcblxyXG5cdFx0aWYgKGggPj0gdGhpcy5oZWlnaHQpIHtcclxuXHRcdFx0Zm9yIChpID0gdG9wOyBpIDwgYm90dG9tOyBpICs9IHRoaXMuaGVpZ2h0KSB7XHJcblx0XHRcdFx0aWYgKHcgPj0gdGhpcy53aWR0aCkge1xyXG5cdFx0XHRcdFx0Zm9yIChqID0gbGVmdDsgaiA8IHJpZ2h0OyBqICs9IHRoaXMud2lkdGgpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5kcmF3MihqLCBpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGxldCBzeCA9IHcgLSBzdztcclxuXHRcdFx0XHRcdGlmIChzeCA+IDApIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fZW5naW5lLl9kcmF3SW1hZ2UodGhpcywgMCwgMCwgc3gsIHRoaXMuaGVpZ2h0LCBqIC0gdGhpcy54LCBpIC0gdGhpcy55LCBzeCwgdGhpcy5oZWlnaHQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuX2VuZ2luZS5fZHJhd0ltYWdlKHRoaXMsIDAsIDAsIHcsIHRoaXMuaGVpZ2h0LCBsZWZ0IC0gdGhpcy54LCBpIC0gdGhpcy55LCB3LCB0aGlzLmhlaWdodCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGxldCBzeSA9IGggLSBzaDtcclxuXHRcdFx0aWYgKHN5ID4gMCkge1xyXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IobmV3IEVycm9yKFwi5pyq5a6M5oiQXCIpKTtcclxuXHRcdFx0XHR0aGlzLl9lbmdpbmUuX2RyYXdJbWFnZSh0aGlzLCAwLCAwLCB0aGlzLndpZHRoLCBzeSwgbGVmdCAtIHRoaXMueCwgaSAtIHRoaXMueSwgdGhpcy53aWR0aCwgc3kpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihuZXcgRXJyb3IoXCLmnKrlrozmiJBcIikpO1xyXG5cdFx0XHR0aGlzLl9lbmdpbmUuX2RyYXdJbWFnZSh0aGlzLCAwLCAwLCB0aGlzLndpZHRoLCBoLCBsZWZ0IC0gdGhpcy54LCB0b3AgLSB0aGlzLnksIHRoaXMud2lkdGgsIGgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogd2l0aG91dCBjbGlwXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3XHJcblx0ICovXHJcblx0X2RyYXdIb3Jpem9udGFsUGF0dGVybih4LCB5LCB3KSB7XHJcblx0XHRpZiAoIXRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRyZXR1cm47Ly9zcHJpdGUgcmVxdWlyZSBwcm9wZXJ0eTogd2lkdGgsIGhlaWdodFxyXG5cdFx0fVxyXG5cdFx0LyoqIEB0eXBlIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICovXHJcblx0XHRjb25zdCBjdHggPSB0aGlzLl9lbmdpbmUuY3R4O1xyXG5cclxuXHRcdGNvbnN0IGxlZnQgPSB4O1xyXG5cdFx0Y29uc3QgcmlnaHQgPSB4ICsgdztcclxuXHJcblx0XHRmb3IgKGxldCBqID0gbGVmdDsgaiA8IHJpZ2h0OyBqICs9IHRoaXMud2lkdGgpIHtcclxuXHRcdFx0dGhpcy5kcmF3MihqLCB5KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHdpdGhvdXQgY2xpcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHlcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaFxyXG5cdCAqL1xyXG5cdF9kcmF3VmVydGljYWxQYXR0ZXJuKHgsIHksIGgpIHtcclxuXHRcdGlmICghdGhpcy5pc0xvYWRlZCgpKSB7XHJcblx0XHRcdHJldHVybjsvL3Nwcml0ZSByZXF1aXJlIHByb3BlcnR5OiB3aWR0aCwgaGVpZ2h0XHJcblx0XHR9XHJcblx0XHQvKiogQHR5cGUge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gKi9cclxuXHRcdGNvbnN0IGN0eCA9IHRoaXMuX2VuZ2luZS5jdHg7XHJcblxyXG5cdFx0Y29uc3QgdG9wID0geTtcclxuXHRcdGNvbnN0IGJvdHRvbSA9IHkgKyBoO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSB0b3A7IGkgPCBib3R0b207IGkgKz0gdGhpcy5oZWlnaHQpIHtcclxuXHRcdFx0dGhpcy5kcmF3Mih4LCBpKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geCAtIHR5cGU6IGludFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gdHlwZTogaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHcgLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaCAtIHR5cGU6IGludFxyXG5cdCAqL1xyXG5cdGRyYXdQYXR0ZXJuNGkoeCwgeSwgdywgaCkge1xyXG5cdFx0dGhpcy5kcmF3UGF0dGVybihNYXRoLnRydW5jKHggKyAwLjUpLCBNYXRoLnRydW5jKHkgKyAwLjUpLCBNYXRoLnRydW5jKHcgKyAwLjUpLCBNYXRoLnRydW5jKGggKyAwLjUpKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHggLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSAtIHR5cGU6IGludFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3IC0gdHlwZTogaW50XHJcblx0ICovXHJcblx0ZHJhd0hvcml6b250YWxQYXR0ZXJuM2koeCwgeSwgdykge1xyXG5cdFx0dGhpcy5kcmF3SG9yaXpvbnRhbFBhdHRlcm4oTWF0aC50cnVuYyh4ICsgMC41KSwgTWF0aC50cnVuYyh5ICsgMC41KSwgTWF0aC50cnVuYyh3ICsgMC41KSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gdHlwZTogaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHkgLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaCAtIHR5cGU6IGludFxyXG5cdCAqL1xyXG5cdGRyYXdWZXJ0aWNhbFBhdHRlcm4zaSh4LCB5LCBoKSB7XHJcblx0XHR0aGlzLmRyYXdWZXJ0aWNhbFBhdHRlcm4oTWF0aC50cnVuYyh4ICsgMC41KSwgTWF0aC50cnVuYyh5ICsgMC41KSwgTWF0aC50cnVuYyhoICsgMC41KSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIHdpdGhvdXQgY2xpcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gdHlwZTogaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHkgLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gdyAtIHR5cGU6IGludFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBoIC0gdHlwZTogaW50XHJcblx0ICovXHJcblx0X2RyYXdQYXR0ZXJuNGkoeCwgeSwgdywgaCkge1xyXG5cdFx0dGhpcy5fZHJhd1BhdHRlcm4oTWF0aC50cnVuYyh4ICsgMC41KSwgTWF0aC50cnVuYyh5ICsgMC41KSwgTWF0aC50cnVuYyh3ICsgMC41KSwgTWF0aC50cnVuYyhoICsgMC41KSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIHdpdGhvdXQgY2xpcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gdHlwZTogaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHkgLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gdyAtIHR5cGU6IGludFxyXG5cdCAqL1xyXG5cdF9kcmF3SG9yaXpvbnRhbFBhdHRlcm4zaSh4LCB5LCB3KSB7XHJcblx0XHR0aGlzLl9kcmF3SG9yaXpvbnRhbFBhdHRlcm4oTWF0aC50cnVuYyh4ICsgMC41KSwgTWF0aC50cnVuYyh5ICsgMC41KSwgTWF0aC50cnVuYyh3ICsgMC41KSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIHdpdGhvdXQgY2xpcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gdHlwZTogaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHkgLSB0eXBlOiBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaCAtIHR5cGU6IGludFxyXG5cdCAqL1xyXG5cdF9kcmF3VmVydGljYWxQYXR0ZXJuM2koeCwgeSwgaCkge1xyXG5cdFx0dGhpcy5fZHJhd1ZlcnRpY2FsUGF0dGVybihNYXRoLnRydW5jKHggKyAwLjUpLCBNYXRoLnRydW5jKHkgKyAwLjUpLCBNYXRoLnRydW5jKGggKyAwLjUpKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBfJFBhdHRlcm5TcHJpdGVfTG9hZGVkIGV4dGVuZHMgU3ByaXRlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0geyFhbnl9IHJhd1xyXG5cdCAqIEBwYXJhbSB7c3RyaW5nPX0gdXJsXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocmF3LCB1cmwpIHtcclxuXHRcdHN1cGVyKHJhdywgdXJsKTtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuX2RpcmVjdGlvbiA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDYW52YXNQYXR0ZXJufSAqL1xyXG5cdFx0dGhpcy5fcGF0dGVybiA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRnZXQgZGlyZWN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2RpcmVjdGlvbjtcclxuXHR9XHJcblx0c2V0IGRpcmVjdGlvbih2YWx1ZSkge1xyXG5cdFx0aWYgKHZhbHVlICYmIHRoaXMuX2RpcmVjdGlvbiAhPSB2YWx1ZSkge1xyXG5cdFx0XHR0aGlzLl9kaXJlY3Rpb24gPSB2YWx1ZTtcclxuXHRcclxuXHRcdFx0Ly9yZWxvYWQ7XHJcblx0XHRcdHRoaXMuX3BhdHRlcm4gPSBudWxsO1xyXG5cdFx0XHR0aGlzLl9fcHJvdG9fXyA9ICRQYXR0ZXJuU3ByaXRlLnByb3RvdHlwZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhcclxuXHQgKi9cclxuXHRkcmF3UGF0dGVybih3LCBoKSB7XHJcblx0XHRpZiAodGhpcy5kaXJlY3Rpb24gJiYgdGhpcy5fcGF0dGVybikge1xyXG5cdFx0XHQvKiogQHR5cGUge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gKi9cclxuXHRcdFx0Y29uc3QgY3R4ID0gdGhpcy5fZW5naW5lLmN0eDtcclxuXHRcclxuXHRcdFx0Y3R4LnJlY3QoLXRoaXMueCwgLXRoaXMueSwgdywgaCk7XHJcblx0XHRcdGN0eC5maWxsU3R5bGUgPSB0aGlzLl9wYXR0ZXJuO1xyXG5cdFx0XHRjdHguZmlsbCgpO1xyXG5cdFx0XHRjdHguZmlsbFN0eWxlID0gXCJuby1yZXBlYXRcIjtcclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhcclxuXHQgKi9cclxuXHRkcmF3UGF0dGVybjIoeCwgeSwgdywgaCkge1xyXG5cdFx0aWYgKHRoaXMuZGlyZWN0aW9uICYmIHRoaXMuX3BhdHRlcm4pIHtcclxuXHRcdFx0LyoqIEB0eXBlIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICovXHJcblx0XHRcdGNvbnN0IGN0eCA9IHRoaXMuX2VuZ2luZS5jdHg7XHJcblx0XHJcblx0XHRcdGN0eC5yZWN0KHggLSB0aGlzLngsIHkgLSB0aGlzLnksIHcsIGgpO1xyXG5cdFx0XHRjdHguZmlsbFN0eWxlID0gdGhpcy5fcGF0dGVybjtcclxuXHRcdFx0Y3R4LmZpbGwoKTtcclxuXHRcdFx0Y3R4LmZpbGxTdHlsZSA9IFwibm8tcmVwZWF0XCI7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKiogQHJldHVybnMge1wicmVwZWF0XCJ9ICovXHJcblx0Z2V0IGVfcmVwZWF0KCkge1xyXG5cdFx0cmV0dXJuIFwicmVwZWF0XCI7XHJcblx0fVxyXG5cdC8qKiBAcmV0dXJucyB7XCJyZXBlYXQteFwifSAqL1xyXG5cdGdldCBlX3JlcGVhdF94KCkge1xyXG5cdFx0cmV0dXJuIFwicmVwZWF0LXhcIjtcclxuXHR9XHJcblx0LyoqIEByZXR1cm5zIHtcInJlcGVhdC15XCJ9ICovXHJcblx0Z2V0IGVfcmVwZWF0X3koKSB7XHJcblx0XHRyZXR1cm4gXCJyZXBlYXQteVwiO1xyXG5cdH1cclxuXHQvKiogQHJldHVybnMge1wibm8tcmVwZWF0XCJ9ICovXHJcblx0Z2V0IGVfbm9SZXBlYXQoKSB7XHJcblx0XHRyZXR1cm4gXCJuby1yZXBlYXRcIjtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyAkUGF0dGVyblNwcml0ZSBleHRlbmRzIF8kUGF0dGVyblNwcml0ZV9Mb2FkZWQge1xyXG5cdGRyYXdQYXR0ZXJuKHcsIGgpIHtcclxuXHRcdHRoaXMuZHJhd1BhdHRlcm4yKDAsIDAsIHcsIGgpO1xyXG5cdH1cclxuXHRkcmF3UGF0dGVybjIoeCwgeSwgdywgaCkge1xyXG5cdFx0aWYgKHRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHQvKiogQHR5cGUge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gKi9cclxuXHRcdFx0Y29uc3QgY3R4ID0gdGhpcy5fZW5naW5lLmN0eDtcclxuXHJcblx0XHRcdGN0eC5zYXZlKCk7XHJcblx0XHRcdHtcclxuXHRcdFx0XHRjdHgucmVjdCh4LCB5LCB3LCBoKTtcclxuXHRcdFx0XHRjdHguY2xpcCgpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGxldCBsZWZ0ID0geDtcclxuXHRcdFx0XHRsZXQgdG9wID0geTtcclxuXHRcdFx0XHRsZXQgcmlnaHQgPSB4ICsgdztcclxuXHRcdFx0XHRsZXQgYm90dG9tID0geSArIGg7XHJcblxyXG5cdFx0XHRcdGZvciAobGV0IGkgPSB0b3A7IGkgPCBib3R0b207IGkgKz0gdGhpcy5oZWlnaHQpIHtcclxuXHRcdFx0XHRcdGZvciAobGV0IGogPSBsZWZ0OyBqIDwgcmlnaHQ7IGogKz0gdGhpcy53aWR0aCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmRyYXcyKGosIGkpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRjdHgucmVzdG9yZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gd1xyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBoXHJcblx0ICovXHJcblx0ZHJhd1BhdHRlcm4odywgaCkge1xyXG5cdFx0aWYgKHRoaXMuZGlyZWN0aW9uKSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSAqL1xyXG5cdFx0XHRjb25zdCBjdHggPSB0aGlzLl9lbmdpbmUuY3R4O1xyXG5cdFxyXG5cdFx0XHRpZiAoIXRoaXMuX3BhdHRlcm4pIHtcclxuXHRcdFx0XHRpZiAodGhpcy5pc0xvYWRlZCgpKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9wYXR0ZXJuID0gY3R4LmNyZWF0ZVBhdHRlcm4odGhpcy50ZXh0dXJlLCB0aGlzLmRpcmVjdGlvbik7XHJcblx0XHRcdFx0XHR0aGlzLl9fcHJvdG9fXyA9IF8kUGF0dGVyblNwcml0ZV9Mb2FkZWQucHJvdG90eXBlO1xyXG5cdFx0XHRcdFx0dGhpcy5kcmF3UGF0dGVybih3LCBoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHlcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gd1xyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBoXHJcblx0ICovXHJcblx0ZHJhd1BhdHRlcm4yKHgsIHksIHcsIGgpIHtcclxuXHRcdGlmICh0aGlzLmRpcmVjdGlvbikge1xyXG5cdFx0XHQvKiogQHR5cGUge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gKi9cclxuXHRcdFx0Y29uc3QgY3R4ID0gdGhpcy5fZW5naW5lLmN0eDtcclxuXHRcclxuXHRcdFx0aWYgKCF0aGlzLl9wYXR0ZXJuKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdFx0dGhpcy5fcGF0dGVybiA9IGN0eC5jcmVhdGVQYXR0ZXJuKHRoaXMudGV4dHVyZSwgdGhpcy5kaXJlY3Rpb24pO1xyXG5cdFx0XHRcdFx0dGhpcy5fX3Byb3RvX18gPSBfJFBhdHRlcm5TcHJpdGVfTG9hZGVkLnByb3RvdHlwZTtcclxuXHRcdFx0XHRcdHRoaXMuZHJhd1BhdHRlcm4yKHgsIHksIHcsIGgpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///341\n')},345:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return ItemCategoryInfo; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return ResourceManager; });\n/* unused harmony export $get */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return ItemAttrNormalize; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return CharacterRenderConfig; });\n\ufeff\r\nconst $failed_urls = [];\r\n\r\nconst $archive = {};\r\n\r\n\r\nwindow.character_emotion_list = ["blink", "hit", "smile", "troubled", "cry", "angry", "bewildered", "stunned",\r\n\t"vomit", "oops", "cheers", "chu", "wink", "pain", "glitter", "despair", "love", "shine", "blaze", "hum",\r\n\t"bowing", "hot", "dam", "qBlue"];\r\n\r\nwindow.character_action_list = ["walk1", "walk2", "stand1", "stand2", "alert", "swingO1", "swingO2", "swingO3", "swingOF", "swingT1",\r\n\t"swingT2", "swingT3", "swingTF", "swingP1", "swingP2", "swingPF", "stabO1", "stabO2", "stabOF", "stabT1",\r\n\t"stabT2", "stabTF", "shoot1", "shoot2", "shootF", "proneStab", "prone", "heal", "fly", "jump", "sit", "ladder",\r\n\t"rope"/*, "dead", "ghostwalk", "ghoststand", "ghostjump", "ghostproneStab", "ghostladder", "ghostrope", "ghostfly",\r\n\t\t"ghostsit"*/];\r\n\r\nclass ItemCategoryInfo {\r\n\t/**\r\n\t * @param {string} id_prefix\r\n\t * @param {string} path\r\n\t * @param {boolean} isOnFace\r\n\t * @param {string} slot - property name\r\n\t * @param {string} categoryName\r\n\t * @param {string} type\r\n\t * @param {string} [stringPath]\r\n\t */\r\n\tconstructor(id_prefix, imgDir, listPath, slot, categoryName, type, stringPath) {\r\n\t\tthis.id_prefix = id_prefix;\r\n\r\n\t\t/** data path */\r\n\t\tthis.path = imgDir;\r\n\r\n\t\t/** equip window */\r\n\t\tthis.slot = slot;\r\n\r\n\t\t/** item list file name */\r\n\t\tthis.listPath = listPath;\r\n\r\n\t\t/** display category name */\r\n\t\tthis.categoryName = categoryName;\r\n\r\n\t\t/** renderer */\r\n\t\tthis.FragmentType = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.dataDir = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.stringDir = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.iconPath = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.iconRawPath = null;\r\n\t\t{\r\n\t\t\tlet dataDir, stringDir, iconPath, iconRawPath;\r\n\r\n\t\t\tswitch (slot) {\r\n\t\t\t\tcase "head":\r\n\t\t\t\t\ticonPath = "stand1/0/head";\r\n\t\t\t\t\ticonRawPath = "stand1/0/head";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase "body":\r\n\t\t\t\t\ticonPath = "stand1/0/body";\r\n\t\t\t\t\ticonRawPath = "stand1/0/body";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase "hair":\r\n\t\t\t\t\ticonPath = "stand1/0/hair";\r\n\t\t\t\t\ticonRawPath = "stand1/0/hair";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase "face":\r\n\t\t\t\t\ticonPath = "blink/0/face";\r\n\t\t\t\t\ticonRawPath = "blink/0/face";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: // typeId: 0|1|2|3|4\r\n\t\t\t\t\ticonPath = "info/icon";\r\n\t\t\t\t\ticonRawPath = "info/iconRaw";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (id_prefix == "5") {\r\n\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\tstringDir = "/String/Pet/";\r\n\t\t\t\talert("Pet");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tswitch (id_prefix[1]) {\r\n\t\t\t\t\tcase "0":\r\n\t\t\t\t\t\tif (Math.trunc(id_prefix) <= 1) {\r\n\t\t\t\t\t\t\tdataDir = "/Character/";\r\n\t\t\t\t\t\t\tstringDir = null;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase "1":\r\n\t\t\t\t\t\tlet s = imgDir + (imgDir ? "/" : "");\r\n\t\t\t\t\t\tdataDir = "/Character/" + s;\r\n\t\t\t\t\t\tstringDir = "/String/Eqp/Eqp/" + (stringPath || s);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase "2":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = "/String/Consume/";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase "3":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = "/String/Ins/";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase "4":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = "/String/Etc/";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase "5":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = "/String/Cash/";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error("unknow item type, param: %o", [id_prefix, imgDir, listPath, slot, categoryName, type]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tObject.defineProperties(this, {\r\n\t\t\t\t"type": {\r\n\t\t\t\t\tvalue: type,\r\n\t\t\t\t},\r\n\t\t\t\t"dataDir": {\r\n\t\t\t\t\tvalue: dataDir,\r\n\t\t\t\t},\r\n\t\t\t\t"stringDir": {\r\n\t\t\t\t\tvalue: stringDir,\r\n\t\t\t\t},\r\n\t\t\t\t"iconPath": {\r\n\t\t\t\t\tvalue: iconPath,\r\n\t\t\t\t},\r\n\t\t\t\t"iconRawPath": {\r\n\t\t\t\t\tvalue: iconRawPath,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * load equip or item, name and desc\r\n\t * @param {string} itemId\r\n\t * @returns {{info:{icon:{[""]:string},iconRaw:{[""]:string}},name:string,desc:string,[prop:string]:any}}\r\n\t */\r\n\tstatic async getItem(itemId) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(itemId);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet id = itemId.padStart(8, "0");\r\n\t\tif (id[0] != "0") {\r\n\t\t\tthrow new Error("itemId: " + itemId);\r\n\t\t}\r\n\r\n\t\tlet results;\r\n\t\ttry {\r\n\t\t\tresults = await Promise.all([\r\n\t\t\t\t$get.data(info.dataDir + itemId),\r\n\t\t\t\tinfo.stringDir ? $get.data(info.stringDir + Number(itemId)).then(\r\n\t\t\t\t\ta => a, // have name or desc\r\n\t\t\t\t\t() => { return { name: "<" + itemId + ">" }; } // no name and desc\r\n\t\t\t\t) : { name: "<" + itemId + ">" } // no name and desc\r\n\t\t\t]);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow new ex;\r\n\t\t}\r\n\r\n\t\tlet data = Object.assign(results[0], results[1]);\r\n\t\t\r\n\t\tdata.id = itemId;\r\n\r\n\t\tif (data.info) {\r\n\t\t\t{//editor mode data\r\n\t\t\t\tdata.info.id = itemId;\r\n\t\t\t\tdata.info.name = data.name;\r\n\t\t\t\tif (data.desc) {\r\n\t\t\t\t\tdata.info.desc = data.desc;\r\n\t\t\t\t}\r\n\t\t\t\tdata.info.__v = window.DATA_TAG + window.DATA_VERSION;\r\n\t\t\t}\r\n\r\n\t\t\tif (!data.info.icon) {\r\n\t\t\t\tdata.info.icon = {};\r\n\t\t\t}\r\n\t\t\tif (!data.info.iconRaw) {\r\n\t\t\t\tdata.info.iconRaw = {};\r\n\t\t\t}\r\n\t\t\tif (!data.info.icon[""]) {\r\n\t\t\t\tdata.info.icon[""] = ItemCategoryInfo.getIconUrl(itemId);\r\n\t\t\t}\r\n\t\t\tif (data.info.iconRaw[""]) {\r\n\t\t\t\tdata.info.iconRaw[""] = ItemCategoryInfo.getIconRawUrl(itemId);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string|null}\r\n\t */\r\n\tstatic getIconRawUrl(id) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(id);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (id[0] == "0") {\r\n\t\t\t//TODO: return path, not url\r\n\t\t\treturn info.dataDir + id + "/" + info.iconRawPath;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string|null}\r\n\t */\r\n\tstatic getIconUrl(id) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(id);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (id[0] == "0") {\r\n\t\t\t//TODO: return path, not url\r\n\t\t\treturn info.dataDir + id + "/" + info.iconPath;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - 4+ digit string\r\n\t * @returns {ItemCategoryInfo}\r\n\t */\r\n\tstatic get(id) {\r\n\t\tlet info;\r\n\r\n\t\tif (id == null || id == "") {\r\n\t\t\tdebugger;\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\r\n\t\tif (id[0] == "0") {\r\n\t\t\tif (id.length == 4) {\r\n\t\t\t\tinfo = ItemCategoryInfo._info[id];\r\n\t\t\t\tif (info) {\r\n\t\t\t\t\treturn info;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (id.length == 6) {\r\n\t\t\t\treturn ItemCategoryInfo._info[id];\r\n\t\t\t}\r\n\t\t\telse if (id.length == 3) {\r\n\t\t\t\treturn ItemCategoryInfo._info[id];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 4)];\r\n\t\t\t\tif (info) {\r\n\t\t\t\t\treturn info;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 6)];\r\n\t\t\t\t\tif (info) {\r\n\t\t\t\t\t\treturn info;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 3)];//019\r\n\t\t\t\t\t\tif (info) {\r\n\t\t\t\t\t\t\treturn info;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.warn("unknow item type, itemId: " + id);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic getTypeId() {\r\n\t\treturn Math.trunc(_id / 1000000);\r\n\t}\r\n\r\n\tstatic getCategory() {\r\n\t\treturn Math.trunc(_id / 10000);// % 100;// 0105 // 01 + 05 // type + category\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - char[4]: type; char[4+]: itemId\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isItem(id) {\r\n\t\tlet type = Math.trunc(id / 1000000);//id.startsWith("00");\r\n\t\treturn type != 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - char[4]: type; char[4+]: itemId\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isEquip(id) {\r\n\t\tif (!id) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\t\tlet _id = Number(id);\r\n\r\n\t\tif (!Number.isSafeInteger(_id)) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\r\n\t\t//let cate = Number(id.length == 4 ? id : id.slice(0, 4));\r\n\t\t//return (cate >= "0100" && cate < "0180");\r\n\r\n\t\t//let cate = Math.trunc(_id / 10000);\r\n\t\t//if (cate >= 180 && cate < 2000) {\r\n\t\t//\tconsole.warn("?? equip: " + id);\r\n\t\t//\tdebugger;\r\n\t\t//}\r\n\r\n\t\tlet type = Math.trunc(_id / 1000000);\r\n\r\n\t\treturn type == 1;\r\n\t}\r\n\r\n\tstatic isChair(id) {\r\n\t\tif (!id) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\t\tlet _id = Number(id);\r\n\r\n\t\tif (!Number.isSafeInteger(_id)) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\r\n\t\tlet cate = Math.trunc(_id / 10000);\r\n\r\n\t\treturn cate == 301;//0301xxxx\r\n\t}\r\n\r\n\t/**\r\n\t * 1~4 digit number\r\n\t * @param {string} itemId\r\n\t */\r\n\tstatic getSubCategory(itemId) {\r\n\t\treturn Math.trunc(itemId / 10000);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} itemId\r\n\t */\r\n\tstatic isCashWeapon(itemId) {\r\n\t\treturn Math.trunc(itemId / 10000) == 170;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} job\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getJobWeaponCategory(job) {\r\n\t\t//TODO: getJobWeaponCategory\r\n\t\tconsole.warn("getJobWeaponCategory: 未完成");\r\n\t}\r\n}\r\nwindow.$ItemCategoryInfo = ItemCategoryInfo;\r\nItemCategoryInfo.type = {\r\n\tEquip: "Equip",\r\n\tConsume: "Consume",\r\n\tEtc: "Etc",\r\n\tInstall: "Install",\r\n\tCash: "Cash"\r\n};\r\nItemCategoryInfo.typeName = {\r\n\t0: "Equip",\r\n\t1: "Consume",\r\n\t2: "Etc",\r\n\t3: "Install",\r\n\t4: "Cash"\r\n};\r\nItemCategoryInfo.typeId = {\r\n\tEquip: 0,\r\n\tConsume: 1,\r\n\tEtc: 2,\r\n\tInstall: 3,\r\n\tCash: 4,\r\n};\r\nItemCategoryInfo._info = {\r\n\t"0000": new ItemCategoryInfo("0000", "",\t\t\t"body",\t\t\t\t"body",\t\t\t"<body>", "Equip"),\r\n\t"0001": new ItemCategoryInfo("0001", "",\t\t\t"head",\t\t\t\t"head",\t\t\t"<head>", "Equip"),\r\n\r\n\t"0002": new ItemCategoryInfo("0002", "Face",\t\t"Face",\t\t\t\t"face",\t\t\t"臉型", "Equip"),\r\n\t"0003": new ItemCategoryInfo("0003", "Hair",\t\t"Hair",\t\t\t\t"hair",\t\t\t"髮型", "Equip"),\r\n\t"0004": new ItemCategoryInfo("0004", "Hair",\t\t"Hair",\t\t\t\t"hair",\t\t\t"髮型", "Equip"),\r\n\r\n\t"0100": new ItemCategoryInfo("0100", "Cap",\t\t\t"Cap",\t\t\t\t"cap",\t\t\t"帽子", "Equip"),\r\n\t"0101": new ItemCategoryInfo("0101", "Accessory",\t"accessoryFace",\t"accessoryFace", "臉飾", "Equip"),\r\n\t"0102": new ItemCategoryInfo("0102", "Accessory",\t"accessoryEyes",\t"accessoryEyes", "眼飾", "Equip"),\r\n\t"0103": new ItemCategoryInfo("0103", "Accessory",\t"accessoryEars",\t"accessoryEars", "耳環", "Equip"),\r\n\t"0104": new ItemCategoryInfo("0104", "Coat",\t\t"Coat",\t\t\t\t"coat",\t\t\t"上衣", "Equip"),\r\n\t"0105": new ItemCategoryInfo("0105", "Longcoat",\t"Longcoat",\t\t\t"longcoat",\t\t"套服", "Equip"),\r\n\t"0106": new ItemCategoryInfo("0106", "Pants",\t\t"Pants",\t\t\t"pants",\t\t"褲子", "Equip"),\r\n\t"0107": new ItemCategoryInfo("0107", "Shoes",\t\t"Shoes",\t\t\t"shoes",\t\t"鞋子", "Equip"),\r\n\t"0108": new ItemCategoryInfo("0108", "Glove",\t\t"Glove",\t\t\t"glove",\t\t"手套", "Equip"),\r\n\t"0109": new ItemCategoryInfo("0109", "Shield",\t\t"Shield",\t\t\t"shield",\t\t"盾牌", "Equip"),\r\n\t"0110": new ItemCategoryInfo("0110", "Cape",\t\t"Cape",\t\t\t\t"cape",\t\t\t"披風", "Equip"),\r\n\r\n\t"0121": new ItemCategoryInfo("0121", "Weapon", "閃亮克魯", "weapon", "閃亮克魯", "Equip"),\r\n\t"0122": new ItemCategoryInfo("0122", "Weapon", "靈魂射手", "weapon", "靈魂射手", "Equip"),\r\n\t"0123": new ItemCategoryInfo("0123", "Weapon", "魔劍", "weapon", "魔劍", "Equip"),\r\n\t"0124": new ItemCategoryInfo("0124", "Weapon", "能量劍", "weapon", "能量劍", "Equip"),\r\n\t"0125": new ItemCategoryInfo("0125", "Weapon", "幻獸棒", "weapon", "幻獸棒", "Equip"),\r\n\t"0126": new ItemCategoryInfo("0126", "Weapon", "ESP限制器", "weapon", "ESP限制器", "Equip"),\r\n\t"0127": new ItemCategoryInfo("0127", "Weapon", "鎖鏈", "weapon", "鎖鏈", "Equip"),\r\n\t"0128": new ItemCategoryInfo("0128", "Weapon", "魔力護腕", "weapon", "魔力護腕", "Equip"),\r\n\r\n\t"0130": new ItemCategoryInfo("0130", "Weapon", "單手劍", "weapon", "單手劍", "Equip"),\r\n\t"0131": new ItemCategoryInfo("0131", "Weapon", "單手斧", "weapon", "單手斧", "Equip"),\r\n\t"0132": new ItemCategoryInfo("0132", "Weapon", "單手錘", "weapon", "單手錘", "Equip"),\r\n\t"0133": new ItemCategoryInfo("0133", "Weapon", "短劍", "weapon", "短劍", "Equip"),\r\n\t"0134": new ItemCategoryInfo("0134", "Weapon", "雙刀", "weapon", "雙刀", "Equip"),\r\n\t"013526": new ItemCategoryInfo("013526", "Weapon", "靈魂之環", "weapon", "靈魂之環", "Equip"),\r\n\t"013530": new ItemCategoryInfo("013530", "Weapon", "控制器", "weapon", "控制器", "Equip"),\r\n\t"0136": new ItemCategoryInfo("0136", "Weapon", "手杖", "weapon", "手杖", "Equip"),\r\n\t"0137": new ItemCategoryInfo("0137", "Weapon", "短杖", "weapon", "短杖", "Equip"),\r\n\t"0138": new ItemCategoryInfo("0138", "Weapon", "長杖", "weapon", "長杖", "Equip"),\r\n\t\r\n\t"0140": new ItemCategoryInfo("0140", "Weapon", "雙手劍", "weapon", "雙手劍", "Equip"),\r\n\t"0141": new ItemCategoryInfo("0141", "Weapon", "雙手斧", "weapon", "雙手斧", "Equip"),\r\n\t"0142": new ItemCategoryInfo("0142", "Weapon", "雙手棍", "weapon", "雙手棍", "Equip"),\r\n\t"0143": new ItemCategoryInfo("0143", "Weapon", "槍", "weapon", "槍", "Equip"),\r\n\t"0144": new ItemCategoryInfo("0144", "Weapon", "矛", "weapon", "矛", "Equip"),\r\n\t"0145": new ItemCategoryInfo("0145", "Weapon", "弓", "weapon", "弓", "Equip"),\r\n\t"0146": new ItemCategoryInfo("0146", "Weapon", "弩", "weapon", "弩", "Equip"),\r\n\t"0147": new ItemCategoryInfo("0147", "Weapon", "拳套", "weapon", "拳套", "Equip"),\r\n\t"0148": new ItemCategoryInfo("0148", "Weapon", "指虎", "weapon", "指虎", "Equip"),\r\n\t"0149": new ItemCategoryInfo("0149", "Weapon", "火槍", "weapon", "火槍", "Equip"),\r\n\t"0150": new ItemCategoryInfo("0150", "Weapon", "鏟", "weapon", "鏟", "Equip"),\r\n\t"0151": new ItemCategoryInfo("0151", "Weapon", "鎬", "weapon", "鎬", "Equip"),\r\n\t"0152": new ItemCategoryInfo("0152", "Weapon", "雙弩槍", "weapon", "雙弩槍", "Equip"),\r\n\t"0153": new ItemCategoryInfo("0153", "Weapon", "加農砲", "weapon", "加農砲", "Equip"),\r\n\t"0154": new ItemCategoryInfo("0154", "Weapon", "太刀", "weapon", "太刀", "Equip"),\r\n\t"0155": new ItemCategoryInfo("0155", "Weapon", "扇子", "weapon", "扇子", "Equip"),\r\n\t"0156": new ItemCategoryInfo("0156", "Weapon", "琉", "weapon", "琉", "Equip"),\r\n\t"0157": new ItemCategoryInfo("0157", "Weapon", "璃", "weapon", "璃", "Equip"),\r\n\t"0158": new ItemCategoryInfo("0158", "Weapon", "重拳槍", "weapon", "重拳槍", "Equip"),\r\n\t"0170": new ItemCategoryInfo("0170", "Weapon", "0170", "weapon", "點裝武器", "Equip"),\r\n\t"019": new ItemCategoryInfo("019", "TamingMob", "TamingMob", "tamingMob", "騎寵", "Equip", "Taming/"),\r\n\r\n\t"0301": new ItemCategoryInfo("0301", "Install", "Chair", "install", "椅子", "Item"),\r\n};\r\n\r\nItemCategoryInfo._categoryList = (function (info_map) {\r\n\tlet list = [];\r\n\tlet set = new Set();\r\n\tfor (let i in info_map) {\r\n\t\tlet cat = info_map[i];\r\n\t\tlet key = cat.categoryName || cat.listPath;\r\n\r\n\t\tif (!set.has(key)) {\r\n\t\t\tset.add(key);\r\n\r\n\t\t\tlist.push({\r\n\t\t\t\tkey: key,\r\n\t\t\t\tvalue: i,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n})(ItemCategoryInfo._info);\r\n\r\nclass ResourceManager {\r\n\tstatic isEquipExist(id, cateInfo) {\r\n\t\tconst dp = cateInfo.listPath;\r\n\t\tconst es = ResourceManager.equip_map[dp];\r\n\t\treturn !es || es.has(id);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} url\r\n\t */\r\n\tstatic async loadArchive(url) {\r\n\t\t$setValue($archive, "/", JSON.parse(await ResourceManager.get(url)));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} url\r\n\t */\r\n\tstatic get(url) {\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tlet xhr = new XMLHttpRequest();\r\n\t\t\txhr.open("GET", url, true);\r\n\r\n\t\t\txhr.timeout = 10 * 60 * 1000;//20000;\r\n\r\n\t\t\txhr.onload = function () {\r\n\t\t\t\tif (this.status == 404 || this.status == 500) {\r\n\t\t\t\t\t$failed_urls.push(url);\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\t//resolve(null);\r\n\t\t\t\t\treject(this.status + ": " + url);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.status == 200) {\r\n\t\t\t\t\tresolve(this.responseText);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.status == 304) {\r\n\t\t\t\t\tdebugger\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.ontimeout = function (e) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\t// XMLHttpRequest 超时。在此做某事。\r\n\t\t\t\t//resolve(null);\r\n\t\t\t\treject("timeout: " + url);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onabort = function (e) {\r\n\t\t\t\treject("abort: " + url);\r\n\t\t\t};\r\n\r\n\t\t\txhr.send();\r\n\t\t});\r\n\t}\r\n\r\n\tstatic get root_path() {\r\n\t\treturn window.$ROOT_PATH;\r\n\t}\r\n\r\n\tstatic get archive() {\r\n\t\treturn $archive;\r\n\t}\r\n\r\n\tstatic get failed_urls() {\r\n\t\treturn $failed_urls;\r\n\t}\r\n}\r\nwindow.$ResourceManager = ResourceManager;\r\n\r\n/**\r\n * @param {{}} obj\r\n * @param {string} path\r\n * @param {any} value\r\n */\r\nfunction $setValue(obj, path, value) {\r\n\tif (path.endsWith("/")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\tlet ps = path.split("/");\r\n\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\tlet key = ps[i];\r\n\t\tif (target[key] == null) {\r\n\t\t\ttarget[key] = {};\r\n\t\t}\r\n\t\ttarget = target[key];\r\n\t}\r\n\tlet origin_value = target[ps[lastIndex]];\r\n\tif (origin_value instanceof Promise) {\r\n\t\tdelete target[ps[lastIndex]];\r\n\t\ttarget[ps[lastIndex]] = value;\r\n\t}\r\n\telse if (origin_value && typeof origin_value == "object") {\r\n\t\t//if (value instanceof Promise) {\r\n\t\t//\tdebugger;\r\n\t\t//}\r\n\t\t//else {\r\n\t\t\tfor (let key in value) {\r\n\t\t\t\torigin_value[key] = value[key] || origin_value[key];\r\n\t\t\t}\r\n\t\t//}\r\n\t}\r\n\telse if (typeof value != "undefined") {\r\n\t\ttarget[ps[lastIndex]] = value;\r\n\t}\r\n}\r\nfunction $getValue(obj, path) {\r\n\tif (path.endsWith("/")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\tlet ps = path.split("/");\r\n\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\tlet key = ps[i];\r\n\t\tif (target[key]) {\r\n\t\t\t\ttarget = target[key];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\treturn target[ps[lastIndex]];\r\n}\r\n\r\nconst symbol_isPack = Symbol("$pack");\r\n\r\nconst url_startsWith_protocol = RegExp.prototype.test.bind(/^(([a-zA-Z^\\:]+)(\\:.*)$|\\/\\/)/);\r\nfunction _setValueByPath(path, value, is_pack) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn;\r\n\t}\r\n\telse if (window.$ROOT_PATH != "" && path.startsWith(window.$ROOT_PATH)) {\r\n\t\tif (is_pack) {\r\n\t\t\tvalue[symbol_isPack] = true;\r\n\t\t}\r\n\t\tpath = path.slice(window.$ROOT_PATH.length);\r\n\t\treturn $setValue($archive, path, value);\r\n\t}\r\n\telse {\r\n\t\treturn $setValue($archive, path, value);\r\n\t}\r\n}\r\nfunction _getValueFromArchiveByPath(path, value) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tif (_path) {\r\n\t\treturn $getValue($archive, _path);\r\n\t}\r\n\treturn undefined;\r\n}\r\nfunction _getDataPathByUrl(path) {\r\n\tif (!url_startsWith_protocol(path)) {\r\n\t\tif (window.$ROOT_PATH != "" && path.startsWith(window.$ROOT_PATH)) {\r\n\t\t\treturn path.slice(window.$ROOT_PATH.length);\r\n\t\t}\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\n/**\r\n * @returns {Promise<any>|any}\r\n */\r\nfunction $getValueAsync(obj, path) {\r\n\tif (path.endsWith("/")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\t\r\n\t// try get value sync\r\n\tlet value = $getValue(obj, path);\r\n\t\r\n\t// if value exist\r\n\tif (value) {\r\n\t\tif (value instanceof Promise) {\r\n\t\t\t// ??\r\n\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\tawait value;\r\n\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n\telse {// if value not exist, try await parent node\r\n\t\tlet ps = path.split("/");\r\n\t\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\t\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\t\tlet key = ps[i];\r\n\t\t\tif (target[key] instanceof Promise) {\r\n\t\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\t\tawait target[key];\r\n\t\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (target[key]) {\r\n\t\t\t\t\ttarget = target[key];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet result = target[ps[lastIndex]];\r\n\t\tif (result instanceof Promise) {\r\n\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\tawait result;\r\n\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {string} url\r\n * @returns {Promise<any>}\r\n */\r\nlet $get = function $get(url) {\r\n\treturn ResourceManager.get(url);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.pack = async function $get_pack(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj && obj[symbol_isPack]) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tif (false) {}\r\n\t\tconst url = $get.packUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, true);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, true);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.packSync = function get_packSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\treturn undefined;\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.data = async function $get_data(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tconst url = $get.dataUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, false);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, false);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {any}\r\n */\r\n$get.dataSync = function get_dataSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\treturn undefined;\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.list = async function $get_list(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tconst url = $get.listUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, false);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, false);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.listSync = function $get_listSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn Object.keys(obj);\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.dataUrl = function $get_dataUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("data")) {\r\n\t\treturn `${window.$ROOT_PATH}data${path}.json`;\r\n\t}\r\n\tthrow new Error("Not game data: " + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.packUrl = function $get_packUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("pack")) {\r\n\t\treturn `${window.$ROOT_PATH}pack${path}.json`;\r\n\t}\r\n\tthrow new Error("Not game pack: " + path);\r\n}\r\n$get.listUrl = function $get_listUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("ls")) {\r\n\t\treturn `${window.$ROOT_PATH}ls${path}.json`;\r\n\t}\r\n\tthrow new Error(path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.imageUrl = function $get_imagesUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("images")) {\r\n\t\treturn `${window.$ROOT_PATH}images${path}.png`;\r\n\t}\r\n\tthrow new Error("Not game images: " + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.soundMp3Url = function $get_soundMp3Url(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("sound")) {\r\n\t\treturn `${window.$ROOT_PATH}sound${path}.mp3`;\r\n\t}\r\n\tthrow new Error("Not game sound: " + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.soundWavUrl = function $get_soundWavUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith("sound")) {\r\n\t\treturn `${window.$ROOT_PATH}sound${path}.wav`;\r\n\t}\r\n\tthrow new Error("Not game sound: " + path);\r\n}\r\n\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.assetUrl = function $get_assetUrl(path) {\r\n\treturn `${window.$ROOT_PATH}${path}`;\r\n}\r\n$get.asset = function $get_asset(path) {\r\n\treturn $get($get.assetUrl(path));\r\n}\r\n\r\nwindow.$get = $get;\r\n\r\n\r\nclass ItemAttrNormalize {\r\n\tstatic head(item) {\r\n\t\titem.gender = 2;\r\n\t}\r\n\tstatic body(item) {\r\n\t\titem.gender = 2;\r\n\t}\r\n\tstatic Face(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 1 || g == 4 ? 1 : 0;\r\n\t}\r\n\tstatic Hair(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 1 || g == 2 || g == 4 || g == 7 ? 1 : 0;\r\n\t}\r\n\tstatic Cap(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryFace(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryEyes(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryEars(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Coat(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Longcoat(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Pants(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Shoes(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Glove(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Shield(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Cape(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic _equip(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 0 ? 0 : (g == 1 ? 1 : 2);\r\n\t}\r\n}\r\n\r\nconst regexp_getHairStyleID = /(\\d{4,7})\\d$/;\r\nconst regexp_getFaceStyleID = /(\\d{2,5})\\d(\\d{2})$/;\r\n\r\nconst regexp_getHairColor = /\\d{4,7}(\\d)$/;\r\nconst regexp_getFaceColor = /\\d{2,5}(\\d)\\d{2}$/;\r\n\r\nclass CharacterRenderConfig {\r\n\t/**\r\n\t * @param {string} style id\r\n\t * @returns {string[]}\r\n\t */\r\n\tstatic * enumHairColor(style) {\r\n\t\tlet m = style.match(regexp_getHairStyleID);\r\n\t\tfor (let i = 0; i < 10; ++i) {\r\n\t\t\tlet id = m[1] + i;\r\n\t\t\tyield id;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} style id\r\n\t * @returns {string[]}\r\n\t */\r\n\tstatic * enumFaceColor(style) {\r\n\t\tlet m = style.match(regexp_getFaceStyleID);\r\n\t\tfor (let i = 0; i < 10; ++i) {\r\n\t\t\tlet id = m[1] + i + m[2];\r\n\t\t\tyield id;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} style\r\n\t * @param {number} color\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getColorHairID(style, color) {\r\n\t\tlet m = style.match(regexp_getHairStyleID);\r\n\t\tlet id = m[1] + (color % 10);\r\n\t\treturn id;\r\n\t}\r\n\t/**\r\n\t * @param {string} style\r\n\t * @param {number} color\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getColorFaceID(style, color) {\r\n\t\tlet m = style.match(regexp_getFaceStyleID);\r\n\t\tlet id = m[1] + (color % 10) + m[2];\r\n\t\treturn id;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id_1\r\n\t * @param {string} id_2\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isHairStyleEqual(id_1, id_2) {\r\n\t\treturn CharacterRenderConfig.getColorHairID(id_1, 0) == CharacterRenderConfig.getColorHairID(id_2, 0);\r\n\t}\r\n\t/**\r\n\t * @param {string} id_1\r\n\t * @param {string} id_2\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isFaceStyleEqual(id_1, id_2) {\r\n\t\treturn CharacterRenderConfig.getColorFaceID(id_1, 0) == CharacterRenderConfig.getColorFaceID(id_2, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getHairColor(id) {\r\n\t\tif (id) {\r\n\t\t\tid = String(id);\r\n\t\t\tlet m = id.match(regexp_getHairColor);\r\n\t\t\tif (m) {\r\n\t\t\t\treturn m[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getFaceColor(id) {\r\n\t\tif (id) {\r\n\t\t\tid = String(id);\r\n\t\t\tlet m = id.match(regexp_getFaceColor);\r\n\t\t\tif (m) {\r\n\t\t\t\treturn m[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar _external_data = {\r\n\t"requiredJobs": [\r\n\t\t"Beginner"\r\n\t],\r\n\t"requiredLevel": 0,\r\n\t"isCash": true,\r\n\t"name": "Blue Beanie",\r\n\t"desc": null,\r\n\t"id": 1000000,\r\n\t"requiredGender": 0,\r\n\t"typeInfo": {\r\n\t\t"overallCategory": "Equip",\r\n\t\t"category": "Armor",\r\n\t\t"subCategory": "Hat"\r\n\t}\r\n};\r\n\r\nvar ItemTypeInfo = {\r\n\t"Equip": {\r\n\t\t"Hat": "Cap",\r\n\t\t"Cape": "Cape",\r\n\t\t"Top": "Coat",\r\n\t\t"Overall": "Longcoat",\r\n\t\t"Glove": "Glove",\r\n\t\t"Bottom": "Pants",\r\n\r\n\t\t"Shield": "Shield",\r\n\t\t"Shoes": "Shoes",\r\n\t\t"Eye Decoration": "accessoryEyes",\r\n\t\t"Earrings": "accessoryEars",\r\n\t\t//"Ring": "",\r\n\r\n\t\t//"Pendant": "",\r\n\t\t"Face Accessory": "accessoryFace",\r\n\t\t//"Belt": "",\r\n\t\t//"Medal": "",\r\n\t\t//"Shoulder Accessory": "",\r\n\t\t//"Badge": "",\r\n\r\n\t\t//"Dragon Equipment": "",\r\n\t\t//"Mechanic Equipment": "",\r\n\t\t//"Pet Equipment": "",\r\n\t\t//"Android": "",\r\n\t\t//"Mechanical Heart": "",\r\n\t\t//"Bits": "",\r\n\r\n\t\t"Face": "Face",\r\n\t\t"Hair": "Hair",\r\n\t},\r\n};\r\n\r\nResourceManager.external = {\r\n\tequip: {\r\n\t},\r\n};\r\n\r\nResourceManager.equip_map = {\r\n};\r\n\r\nfor (let i in ItemTypeInfo.Equip) {\r\n\tlet cate = ItemTypeInfo.Equip[i];\r\n\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\nfor (let i = 0; i < 9; ++i) {\r\n\tlet cate = "Face" + i;\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\nfor (let i = 0; i < 8; ++i) {\r\n\tlet cate = "Hair" + i;\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\n\r\nasync function load_external_resource(url) {\r\n\turl = url || "/items.json";\r\n\tlet raw;\r\n\r\n\ttry {\r\n\t\traw = ResourceManager._external_raw = JSON.parse(await $get.asset("equip.json"));\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error("\'/equip\' is empty");\r\n\t\t}\r\n\t}\r\n\tcatch (ex) {\r\n\t\traw = ResourceManager._external_raw = JSON.parse(await $get("//labs.maplestory.io/api/gms/latest/item/category/equip"));\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfor (let i = 0; i < raw.length; ++i) {\r\n\t\tconst item = raw[i];\r\n\t\tconst id = String(item.id).padStart(8, "0");\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (!(item.typeInfo && ItemTypeInfo[item.typeInfo.overallCategory])) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet clz = item.typeInfo.overallCategory.toLowerCase();\r\n\t\t\tlet cate = ItemTypeInfo[item.typeInfo.overallCategory][item.typeInfo.subCategory];\r\n\t\t\tif (!cate) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\telse if (cate == "Face") {\r\n\t\t\t\tcate += CharacterRenderConfig.getFaceColor(id);\r\n\t\t\t}\r\n\t\t\telse if (cate == "Hair") {\r\n\t\t\t\tcate += CharacterRenderConfig.getHairColor(id);\r\n\t\t\t}\r\n\r\n\t\t\tlet it = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: item.name,\r\n\t\t\t\tdesc: item.desc,\r\n\t\t\t\tcash: item.isCash ? 1 : 0,\r\n\t\t\t\ticon: {\r\n\t\t\t\t\t"": `//labs.maplestory.io/api/gms/latest/item/${item.id}/icon`,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tResourceManager.external[clz][cate].push(it);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error("external resource: id(" + id + ")");\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction update_external_equip_list() {\r\n\tconst url = "https://labs.maplestory.io/api/gms/latest/item/category/equip";\r\n\tload_external_resource(url).then(() => {\r\n\t\t_concat_external_resource(category, origin_data);\r\n\t\tconcat_external_resource = _concat_external_resource;\r\n\t\tconsole.log("done: update_external_equip_list");\r\n\t});\r\n}\r\n\r\nlet external_resource_promise = load_external_resource();\r\n\r\nwindow.concat_external_resource = _concat_external_resource_p;\r\n\r\nwindow.trigger_update_external_equip_list = function () {\r\n\texternal_resource_promise = load_external_resource();\r\n\twindow.concat_external_resource = _concat_external_resource_p;\r\n}\r\n\r\nasync function _concat_external_resource_p(category, origin_data) {\r\n\tawait external_resource_promise;\r\n\t_concat_external_resource(category, origin_data);\r\n\tconcat_external_resource = _concat_external_resource;\r\n}\r\n\r\nfunction _concat_external_resource(category, origin_data) {\r\n\ttry {\r\n\t\tconst list = ResourceManager.external.equip[category];\r\n\t\tif (!list) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet id_map = ResourceManager.equip_map[category];\r\n\r\n\t\tif (!id_map) {\r\n\t\t\tid_map = new Map();\r\n\t\t\t\r\n\t\t\torigin_data.forEach(item => {\r\n\t\t\t\tid_map.set(item.id, item);\r\n\t\t\t});\r\n\r\n\t\t\tResourceManager.equip_map[category] = id_map;\r\n\t\t}\r\n\r\n\t\tlist.forEach((item) => {\r\n\t\t\tlet id = item.id;\r\n\t\t\tif (!id_map.has(id)) {\r\n\t\t\t\titem.$foreign = true;\r\n\t\t\t\torigin_data.push(item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ori_item = id_map.get(id);\r\n\t\t\t\tori_item._name = item.name || "";\r\n\t\t\t\tori_item._desc = item.desc || "";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tcatch (ex) {\r\n\t\tconsole.error(ex);\r\n\t\tdebugger;\r\n\t}\r\n}\r\n\r\nwindow.load_extern_item_data = async function (id) {\r\n\tlet _raw = JSON.parse(await $get(`//labs.maplestory.io/api/gms/latest/item/${id}`));\r\n\tlet raw = {};\r\n\r\n\tlet default_ = _raw.frameBooks.default ? _raw.frameBooks.default.frames[0]:null;\r\n\r\n\tfor (let i in _raw.frameBooks) {\r\n\t\tlet _act = _raw.frameBooks[i];\r\n\t\tlet act = [];\r\n\r\n\t\tfor (let j = 0; j < _act.frames.length; ++j) {\r\n\t\t\tlet frame = _act.frames[j] || default_;\r\n\t\t\tif (!frame || !frame.effects) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet _frags = frame.effects;\r\n\t\t\tlet frags = {};\r\n\t\t\tfor (let k in _frags) {\r\n\t\t\t\tlet _frag = _frags[k];\r\n\t\t\t\tif (_frag.image) {\r\n\t\t\t\t\tfrags[k] = {\r\n\t\t\t\t\t\t"": "data:image/png;base64," + _frag.image,\r\n\t\t\t\t\t\t"origin": _frag.originOrZero || _frag.origin || _frag.center,\r\n\t\t\t\t\t\t"map": _frag.mapOffset,\r\n\t\t\t\t\t\t"z": _frag.position\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tact[j] = frags;\r\n\t\t}\r\n\r\n\t\traw[i] = act;\r\n\t}\r\n\r\n\traw.info = {\r\n\t\tislot: _raw.metaInfo.equip.islot,\r\n\t\tvslot: _raw.metaInfo.equip.vslot,\r\n\t\ticon: _raw.metaInfo.icon ? ("data:image/png;base64," + _raw.metaInfo.icon.iconRaw) : "",\r\n\t\tcash: (_raw.metaInfo.cash && _raw.metaInfo.cash.cash) ? 1 : 0,\r\n\t};\r\n\r\n\treturn raw;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzQ1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcHVibGljL2phdmFzY3JpcHRzL3Jlc291cmNlLmpzPzIzZmUiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmNvbnN0ICRmYWlsZWRfdXJscyA9IFtdO1xyXG5cclxuY29uc3QgJGFyY2hpdmUgPSB7fTtcclxuXHJcblxyXG53aW5kb3cuY2hhcmFjdGVyX2Vtb3Rpb25fbGlzdCA9IFtcImJsaW5rXCIsIFwiaGl0XCIsIFwic21pbGVcIiwgXCJ0cm91YmxlZFwiLCBcImNyeVwiLCBcImFuZ3J5XCIsIFwiYmV3aWxkZXJlZFwiLCBcInN0dW5uZWRcIixcclxuXHRcInZvbWl0XCIsIFwib29wc1wiLCBcImNoZWVyc1wiLCBcImNodVwiLCBcIndpbmtcIiwgXCJwYWluXCIsIFwiZ2xpdHRlclwiLCBcImRlc3BhaXJcIiwgXCJsb3ZlXCIsIFwic2hpbmVcIiwgXCJibGF6ZVwiLCBcImh1bVwiLFxyXG5cdFwiYm93aW5nXCIsIFwiaG90XCIsIFwiZGFtXCIsIFwicUJsdWVcIl07XHJcblxyXG53aW5kb3cuY2hhcmFjdGVyX2FjdGlvbl9saXN0ID0gW1wid2FsazFcIiwgXCJ3YWxrMlwiLCBcInN0YW5kMVwiLCBcInN0YW5kMlwiLCBcImFsZXJ0XCIsIFwic3dpbmdPMVwiLCBcInN3aW5nTzJcIiwgXCJzd2luZ08zXCIsIFwic3dpbmdPRlwiLCBcInN3aW5nVDFcIixcclxuXHRcInN3aW5nVDJcIiwgXCJzd2luZ1QzXCIsIFwic3dpbmdURlwiLCBcInN3aW5nUDFcIiwgXCJzd2luZ1AyXCIsIFwic3dpbmdQRlwiLCBcInN0YWJPMVwiLCBcInN0YWJPMlwiLCBcInN0YWJPRlwiLCBcInN0YWJUMVwiLFxyXG5cdFwic3RhYlQyXCIsIFwic3RhYlRGXCIsIFwic2hvb3QxXCIsIFwic2hvb3QyXCIsIFwic2hvb3RGXCIsIFwicHJvbmVTdGFiXCIsIFwicHJvbmVcIiwgXCJoZWFsXCIsIFwiZmx5XCIsIFwianVtcFwiLCBcInNpdFwiLCBcImxhZGRlclwiLFxyXG5cdFwicm9wZVwiLyosIFwiZGVhZFwiLCBcImdob3N0d2Fsa1wiLCBcImdob3N0c3RhbmRcIiwgXCJnaG9zdGp1bXBcIiwgXCJnaG9zdHByb25lU3RhYlwiLCBcImdob3N0bGFkZGVyXCIsIFwiZ2hvc3Ryb3BlXCIsIFwiZ2hvc3RmbHlcIixcclxuXHRcdFwiZ2hvc3RzaXRcIiovXTtcclxuXHJcbmV4cG9ydCBjbGFzcyBJdGVtQ2F0ZWdvcnlJbmZvIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRfcHJlZml4XHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHBhdGhcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGlzT25GYWNlXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHNsb3QgLSBwcm9wZXJ0eSBuYW1lXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGNhdGVnb3J5TmFtZVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IFtzdHJpbmdQYXRoXVxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGlkX3ByZWZpeCwgaW1nRGlyLCBsaXN0UGF0aCwgc2xvdCwgY2F0ZWdvcnlOYW1lLCB0eXBlLCBzdHJpbmdQYXRoKSB7XHJcblx0XHR0aGlzLmlkX3ByZWZpeCA9IGlkX3ByZWZpeDtcclxuXHJcblx0XHQvKiogZGF0YSBwYXRoICovXHJcblx0XHR0aGlzLnBhdGggPSBpbWdEaXI7XHJcblxyXG5cdFx0LyoqIGVxdWlwIHdpbmRvdyAqL1xyXG5cdFx0dGhpcy5zbG90ID0gc2xvdDtcclxuXHJcblx0XHQvKiogaXRlbSBsaXN0IGZpbGUgbmFtZSAqL1xyXG5cdFx0dGhpcy5saXN0UGF0aCA9IGxpc3RQYXRoO1xyXG5cclxuXHRcdC8qKiBkaXNwbGF5IGNhdGVnb3J5IG5hbWUgKi9cclxuXHRcdHRoaXMuY2F0ZWdvcnlOYW1lID0gY2F0ZWdvcnlOYW1lO1xyXG5cclxuXHRcdC8qKiByZW5kZXJlciAqL1xyXG5cdFx0dGhpcy5GcmFnbWVudFR5cGUgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5kYXRhRGlyID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5zdHJpbmdEaXIgPSBudWxsO1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmljb25QYXRoID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5pY29uUmF3UGF0aCA9IG51bGw7XHJcblx0XHR7XHJcblx0XHRcdGxldCBkYXRhRGlyLCBzdHJpbmdEaXIsIGljb25QYXRoLCBpY29uUmF3UGF0aDtcclxuXHJcblx0XHRcdHN3aXRjaCAoc2xvdCkge1xyXG5cdFx0XHRcdGNhc2UgXCJoZWFkXCI6XHJcblx0XHRcdFx0XHRpY29uUGF0aCA9IFwic3RhbmQxLzAvaGVhZFwiO1xyXG5cdFx0XHRcdFx0aWNvblJhd1BhdGggPSBcInN0YW5kMS8wL2hlYWRcIjtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgXCJib2R5XCI6XHJcblx0XHRcdFx0XHRpY29uUGF0aCA9IFwic3RhbmQxLzAvYm9keVwiO1xyXG5cdFx0XHRcdFx0aWNvblJhd1BhdGggPSBcInN0YW5kMS8wL2JvZHlcIjtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgXCJoYWlyXCI6XHJcblx0XHRcdFx0XHRpY29uUGF0aCA9IFwic3RhbmQxLzAvaGFpclwiO1xyXG5cdFx0XHRcdFx0aWNvblJhd1BhdGggPSBcInN0YW5kMS8wL2hhaXJcIjtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgXCJmYWNlXCI6XHJcblx0XHRcdFx0XHRpY29uUGF0aCA9IFwiYmxpbmsvMC9mYWNlXCI7XHJcblx0XHRcdFx0XHRpY29uUmF3UGF0aCA9IFwiYmxpbmsvMC9mYWNlXCI7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRkZWZhdWx0OiAvLyB0eXBlSWQ6IDB8MXwyfDN8NFxyXG5cdFx0XHRcdFx0aWNvblBhdGggPSBcImluZm8vaWNvblwiO1xyXG5cdFx0XHRcdFx0aWNvblJhd1BhdGggPSBcImluZm8vaWNvblJhd1wiO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoaWRfcHJlZml4ID09IFwiNVwiKSB7XHJcblx0XHRcdFx0ZGF0YURpciA9IGAvSXRlbS8ke2ltZ0Rpcn0vJHtpZF9wcmVmaXh9L2A7XHJcblx0XHRcdFx0c3RyaW5nRGlyID0gXCIvU3RyaW5nL1BldC9cIjtcclxuXHRcdFx0XHRhbGVydChcIlBldFwiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzd2l0Y2ggKGlkX3ByZWZpeFsxXSkge1xyXG5cdFx0XHRcdFx0Y2FzZSBcIjBcIjpcclxuXHRcdFx0XHRcdFx0aWYgKE1hdGgudHJ1bmMoaWRfcHJlZml4KSA8PSAxKSB7XHJcblx0XHRcdFx0XHRcdFx0ZGF0YURpciA9IFwiL0NoYXJhY3Rlci9cIjtcclxuXHRcdFx0XHRcdFx0XHRzdHJpbmdEaXIgPSBudWxsO1xyXG5cdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjYXNlIFwiMVwiOlxyXG5cdFx0XHRcdFx0XHRsZXQgcyA9IGltZ0RpciArIChpbWdEaXIgPyBcIi9cIiA6IFwiXCIpO1xyXG5cdFx0XHRcdFx0XHRkYXRhRGlyID0gXCIvQ2hhcmFjdGVyL1wiICsgcztcclxuXHRcdFx0XHRcdFx0c3RyaW5nRGlyID0gXCIvU3RyaW5nL0VxcC9FcXAvXCIgKyAoc3RyaW5nUGF0aCB8fCBzKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRjYXNlIFwiMlwiOlxyXG5cdFx0XHRcdFx0XHRkYXRhRGlyID0gYC9JdGVtLyR7aW1nRGlyfS8ke2lkX3ByZWZpeH0vYDtcclxuXHRcdFx0XHRcdFx0c3RyaW5nRGlyID0gXCIvU3RyaW5nL0NvbnN1bWUvXCI7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcIjNcIjpcclxuXHRcdFx0XHRcdFx0ZGF0YURpciA9IGAvSXRlbS8ke2ltZ0Rpcn0vJHtpZF9wcmVmaXh9L2A7XHJcblx0XHRcdFx0XHRcdHN0cmluZ0RpciA9IFwiL1N0cmluZy9JbnMvXCI7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcIjRcIjpcclxuXHRcdFx0XHRcdFx0ZGF0YURpciA9IGAvSXRlbS8ke2ltZ0Rpcn0vJHtpZF9wcmVmaXh9L2A7XHJcblx0XHRcdFx0XHRcdHN0cmluZ0RpciA9IFwiL1N0cmluZy9FdGMvXCI7XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcIjVcIjpcclxuXHRcdFx0XHRcdFx0ZGF0YURpciA9IGAvSXRlbS8ke2ltZ0Rpcn0vJHtpZF9wcmVmaXh9L2A7XHJcblx0XHRcdFx0XHRcdHN0cmluZ0RpciA9IFwiL1N0cmluZy9DYXNoL1wiO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0XHRcdHRocm93IG5ldyBFcnJvcihcInVua25vdyBpdGVtIHR5cGUsIHBhcmFtOiAlb1wiLCBbaWRfcHJlZml4LCBpbWdEaXIsIGxpc3RQYXRoLCBzbG90LCBjYXRlZ29yeU5hbWUsIHR5cGVdKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcclxuXHRcdFx0XHRcInR5cGVcIjoge1xyXG5cdFx0XHRcdFx0dmFsdWU6IHR5cGUsXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRcImRhdGFEaXJcIjoge1xyXG5cdFx0XHRcdFx0dmFsdWU6IGRhdGFEaXIsXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRcInN0cmluZ0RpclwiOiB7XHJcblx0XHRcdFx0XHR2YWx1ZTogc3RyaW5nRGlyLFxyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0XCJpY29uUGF0aFwiOiB7XHJcblx0XHRcdFx0XHR2YWx1ZTogaWNvblBhdGgsXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRcImljb25SYXdQYXRoXCI6IHtcclxuXHRcdFx0XHRcdHZhbHVlOiBpY29uUmF3UGF0aCxcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogbG9hZCBlcXVpcCBvciBpdGVtLCBuYW1lIGFuZCBkZXNjXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1JZFxyXG5cdCAqIEByZXR1cm5zIHt7aW5mbzp7aWNvbjp7W1wiXCJdOnN0cmluZ30saWNvblJhdzp7W1wiXCJdOnN0cmluZ319LG5hbWU6c3RyaW5nLGRlc2M6c3RyaW5nLFtwcm9wOnN0cmluZ106YW55fX1cclxuXHQgKi9cclxuXHRzdGF0aWMgYXN5bmMgZ2V0SXRlbShpdGVtSWQpIHtcclxuXHRcdC8qKiBAdHlwZSB7SXRlbUNhdGVnb3J5SW5mb30gKi9cclxuXHRcdGxldCBpbmZvID0gSXRlbUNhdGVnb3J5SW5mby5nZXQoaXRlbUlkKTtcclxuXHRcdGlmICghaW5mbykge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgaWQgPSBpdGVtSWQucGFkU3RhcnQoOCwgXCIwXCIpO1xyXG5cdFx0aWYgKGlkWzBdICE9IFwiMFwiKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIml0ZW1JZDogXCIgKyBpdGVtSWQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCByZXN1bHRzO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0cmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuXHRcdFx0XHQkZ2V0LmRhdGEoaW5mby5kYXRhRGlyICsgaXRlbUlkKSxcclxuXHRcdFx0XHRpbmZvLnN0cmluZ0RpciA/ICRnZXQuZGF0YShpbmZvLnN0cmluZ0RpciArIE51bWJlcihpdGVtSWQpKS50aGVuKFxyXG5cdFx0XHRcdFx0YSA9PiBhLCAvLyBoYXZlIG5hbWUgb3IgZGVzY1xyXG5cdFx0XHRcdFx0KCkgPT4geyByZXR1cm4geyBuYW1lOiBcIjxcIiArIGl0ZW1JZCArIFwiPlwiIH07IH0gLy8gbm8gbmFtZSBhbmQgZGVzY1xyXG5cdFx0XHRcdCkgOiB7IG5hbWU6IFwiPFwiICsgaXRlbUlkICsgXCI+XCIgfSAvLyBubyBuYW1lIGFuZCBkZXNjXHJcblx0XHRcdF0pO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdHRocm93IG5ldyBleDtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgZGF0YSA9IE9iamVjdC5hc3NpZ24ocmVzdWx0c1swXSwgcmVzdWx0c1sxXSk7XHJcblx0XHRcclxuXHRcdGRhdGEuaWQgPSBpdGVtSWQ7XHJcblxyXG5cdFx0aWYgKGRhdGEuaW5mbykge1xyXG5cdFx0XHR7Ly9lZGl0b3IgbW9kZSBkYXRhXHJcblx0XHRcdFx0ZGF0YS5pbmZvLmlkID0gaXRlbUlkO1xyXG5cdFx0XHRcdGRhdGEuaW5mby5uYW1lID0gZGF0YS5uYW1lO1xyXG5cdFx0XHRcdGlmIChkYXRhLmRlc2MpIHtcclxuXHRcdFx0XHRcdGRhdGEuaW5mby5kZXNjID0gZGF0YS5kZXNjO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRkYXRhLmluZm8uX192ID0gd2luZG93LkRBVEFfVEFHICsgd2luZG93LkRBVEFfVkVSU0lPTjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKCFkYXRhLmluZm8uaWNvbikge1xyXG5cdFx0XHRcdGRhdGEuaW5mby5pY29uID0ge307XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCFkYXRhLmluZm8uaWNvblJhdykge1xyXG5cdFx0XHRcdGRhdGEuaW5mby5pY29uUmF3ID0ge307XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKCFkYXRhLmluZm8uaWNvbltcIlwiXSkge1xyXG5cdFx0XHRcdGRhdGEuaW5mby5pY29uW1wiXCJdID0gSXRlbUNhdGVnb3J5SW5mby5nZXRJY29uVXJsKGl0ZW1JZCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGRhdGEuaW5mby5pY29uUmF3W1wiXCJdKSB7XHJcblx0XHRcdFx0ZGF0YS5pbmZvLmljb25SYXdbXCJcIl0gPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldEljb25SYXdVcmwoaXRlbUlkKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBkYXRhO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICogQHJldHVybnMge3N0cmluZ3xudWxsfVxyXG5cdCAqL1xyXG5cdHN0YXRpYyBnZXRJY29uUmF3VXJsKGlkKSB7XHJcblx0XHQvKiogQHR5cGUge0l0ZW1DYXRlZ29yeUluZm99ICovXHJcblx0XHRsZXQgaW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uZ2V0KGlkKTtcclxuXHRcdGlmICghaW5mbykge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGlmIChpZFswXSA9PSBcIjBcIikge1xyXG5cdFx0XHQvL1RPRE86IHJldHVybiBwYXRoLCBub3QgdXJsXHJcblx0XHRcdHJldHVybiBpbmZvLmRhdGFEaXIgKyBpZCArIFwiL1wiICsgaW5mby5pY29uUmF3UGF0aDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd8bnVsbH1cclxuXHQgKi9cclxuXHRzdGF0aWMgZ2V0SWNvblVybChpZCkge1xyXG5cdFx0LyoqIEB0eXBlIHtJdGVtQ2F0ZWdvcnlJbmZvfSAqL1xyXG5cdFx0bGV0IGluZm8gPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldChpZCk7XHJcblx0XHRpZiAoIWluZm8pIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRpZiAoaWRbMF0gPT0gXCIwXCIpIHtcclxuXHRcdFx0Ly9UT0RPOiByZXR1cm4gcGF0aCwgbm90IHVybFxyXG5cdFx0XHRyZXR1cm4gaW5mby5kYXRhRGlyICsgaWQgKyBcIi9cIiArIGluZm8uaWNvblBhdGg7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSA0KyBkaWdpdCBzdHJpbmdcclxuXHQgKiBAcmV0dXJucyB7SXRlbUNhdGVnb3J5SW5mb31cclxuXHQgKi9cclxuXHRzdGF0aWMgZ2V0KGlkKSB7XHJcblx0XHRsZXQgaW5mbztcclxuXHJcblx0XHRpZiAoaWQgPT0gbnVsbCB8fCBpZCA9PSBcIlwiKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGlkWzBdID09IFwiMFwiKSB7XHJcblx0XHRcdGlmIChpZC5sZW5ndGggPT0gNCkge1xyXG5cdFx0XHRcdGluZm8gPSBJdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvW2lkXTtcclxuXHRcdFx0XHRpZiAoaW5mbykge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGluZm87XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGlkLmxlbmd0aCA9PSA2KSB7XHJcblx0XHRcdFx0cmV0dXJuIEl0ZW1DYXRlZ29yeUluZm8uX2luZm9baWRdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGlkLmxlbmd0aCA9PSAzKSB7XHJcblx0XHRcdFx0cmV0dXJuIEl0ZW1DYXRlZ29yeUluZm8uX2luZm9baWRdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGluZm8gPSBJdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvW2lkLnNsaWNlKDAsIDQpXTtcclxuXHRcdFx0XHRpZiAoaW5mbykge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGluZm87XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0aW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uX2luZm9baWQuc2xpY2UoMCwgNildO1xyXG5cdFx0XHRcdFx0aWYgKGluZm8pIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGluZm87XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0aW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uX2luZm9baWQuc2xpY2UoMCwgMyldOy8vMDE5XHJcblx0XHRcdFx0XHRcdGlmIChpbmZvKSB7XHJcblx0XHRcdFx0XHRcdFx0cmV0dXJuIGluZm87XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNvbnNvbGUud2FybihcInVua25vdyBpdGVtIHR5cGUsIGl0ZW1JZDogXCIgKyBpZCk7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRUeXBlSWQoKSB7XHJcblx0XHRyZXR1cm4gTWF0aC50cnVuYyhfaWQgLyAxMDAwMDAwKTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXRDYXRlZ29yeSgpIHtcclxuXHRcdHJldHVybiBNYXRoLnRydW5jKF9pZCAvIDEwMDAwKTsvLyAlIDEwMDsvLyAwMTA1IC8vIDAxICsgMDUgLy8gdHlwZSArIGNhdGVnb3J5XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBjaGFyWzRdOiB0eXBlOyBjaGFyWzQrXTogaXRlbUlkXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0c3RhdGljIGlzSXRlbShpZCkge1xyXG5cdFx0bGV0IHR5cGUgPSBNYXRoLnRydW5jKGlkIC8gMTAwMDAwMCk7Ly9pZC5zdGFydHNXaXRoKFwiMDBcIik7XHJcblx0XHRyZXR1cm4gdHlwZSAhPSAwO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gY2hhcls0XTogdHlwZTsgY2hhcls0K106IGl0ZW1JZFxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdHN0YXRpYyBpc0VxdWlwKGlkKSB7XHJcblx0XHRpZiAoIWlkKSB7XHJcblx0XHRcdHRocm93IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cdFx0bGV0IF9pZCA9IE51bWJlcihpZCk7XHJcblxyXG5cdFx0aWYgKCFOdW1iZXIuaXNTYWZlSW50ZWdlcihfaWQpKSB7XHJcblx0XHRcdHRocm93IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vbGV0IGNhdGUgPSBOdW1iZXIoaWQubGVuZ3RoID09IDQgPyBpZCA6IGlkLnNsaWNlKDAsIDQpKTtcclxuXHRcdC8vcmV0dXJuIChjYXRlID49IFwiMDEwMFwiICYmIGNhdGUgPCBcIjAxODBcIik7XHJcblxyXG5cdFx0Ly9sZXQgY2F0ZSA9IE1hdGgudHJ1bmMoX2lkIC8gMTAwMDApO1xyXG5cdFx0Ly9pZiAoY2F0ZSA+PSAxODAgJiYgY2F0ZSA8IDIwMDApIHtcclxuXHRcdC8vXHRjb25zb2xlLndhcm4oXCI/PyBlcXVpcDogXCIgKyBpZCk7XHJcblx0XHQvL1x0ZGVidWdnZXI7XHJcblx0XHQvL31cclxuXHJcblx0XHRsZXQgdHlwZSA9IE1hdGgudHJ1bmMoX2lkIC8gMTAwMDAwMCk7XHJcblxyXG5cdFx0cmV0dXJuIHR5cGUgPT0gMTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBpc0NoYWlyKGlkKSB7XHJcblx0XHRpZiAoIWlkKSB7XHJcblx0XHRcdHRocm93IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cdFx0bGV0IF9pZCA9IE51bWJlcihpZCk7XHJcblxyXG5cdFx0aWYgKCFOdW1iZXIuaXNTYWZlSW50ZWdlcihfaWQpKSB7XHJcblx0XHRcdHRocm93IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBjYXRlID0gTWF0aC50cnVuYyhfaWQgLyAxMDAwMCk7XHJcblxyXG5cdFx0cmV0dXJuIGNhdGUgPT0gMzAxOy8vMDMwMXh4eHhcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIDF+NCBkaWdpdCBudW1iZXJcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXHJcblx0ICovXHJcblx0c3RhdGljIGdldFN1YkNhdGVnb3J5KGl0ZW1JZCkge1xyXG5cdFx0cmV0dXJuIE1hdGgudHJ1bmMoaXRlbUlkIC8gMTAwMDApO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1JZFxyXG5cdCAqL1xyXG5cdHN0YXRpYyBpc0Nhc2hXZWFwb24oaXRlbUlkKSB7XHJcblx0XHRyZXR1cm4gTWF0aC50cnVuYyhpdGVtSWQgLyAxMDAwMCkgPT0gMTcwO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGpvYlxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XHJcblx0ICovXHJcblx0c3RhdGljIGdldEpvYldlYXBvbkNhdGVnb3J5KGpvYikge1xyXG5cdFx0Ly9UT0RPOiBnZXRKb2JXZWFwb25DYXRlZ29yeVxyXG5cdFx0Y29uc29sZS53YXJuKFwiZ2V0Sm9iV2VhcG9uQ2F0ZWdvcnk6IOacquWujOaIkFwiKTtcclxuXHR9XHJcbn1cclxud2luZG93LiRJdGVtQ2F0ZWdvcnlJbmZvID0gSXRlbUNhdGVnb3J5SW5mbztcclxuSXRlbUNhdGVnb3J5SW5mby50eXBlID0ge1xyXG5cdEVxdWlwOiBcIkVxdWlwXCIsXHJcblx0Q29uc3VtZTogXCJDb25zdW1lXCIsXHJcblx0RXRjOiBcIkV0Y1wiLFxyXG5cdEluc3RhbGw6IFwiSW5zdGFsbFwiLFxyXG5cdENhc2g6IFwiQ2FzaFwiXHJcbn07XHJcbkl0ZW1DYXRlZ29yeUluZm8udHlwZU5hbWUgPSB7XHJcblx0MDogXCJFcXVpcFwiLFxyXG5cdDE6IFwiQ29uc3VtZVwiLFxyXG5cdDI6IFwiRXRjXCIsXHJcblx0MzogXCJJbnN0YWxsXCIsXHJcblx0NDogXCJDYXNoXCJcclxufTtcclxuSXRlbUNhdGVnb3J5SW5mby50eXBlSWQgPSB7XHJcblx0RXF1aXA6IDAsXHJcblx0Q29uc3VtZTogMSxcclxuXHRFdGM6IDIsXHJcblx0SW5zdGFsbDogMyxcclxuXHRDYXNoOiA0LFxyXG59O1xyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvID0ge1xyXG5cdFwiMDAwMFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAwMDBcIiwgXCJcIixcdFx0XHRcImJvZHlcIixcdFx0XHRcdFwiYm9keVwiLFx0XHRcdFwiPGJvZHk+XCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMDAxXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDAwMVwiLCBcIlwiLFx0XHRcdFwiaGVhZFwiLFx0XHRcdFx0XCJoZWFkXCIsXHRcdFx0XCI8aGVhZD5cIiwgXCJFcXVpcFwiKSxcclxuXHJcblx0XCIwMDAyXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDAwMlwiLCBcIkZhY2VcIixcdFx0XCJGYWNlXCIsXHRcdFx0XHRcImZhY2VcIixcdFx0XHRcIuiHieWei1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDAwM1wiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAwMDNcIiwgXCJIYWlyXCIsXHRcdFwiSGFpclwiLFx0XHRcdFx0XCJoYWlyXCIsXHRcdFx0XCLpq67lnotcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAwMDRcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMDA0XCIsIFwiSGFpclwiLFx0XHRcIkhhaXJcIixcdFx0XHRcdFwiaGFpclwiLFx0XHRcdFwi6auu5Z6LXCIsIFwiRXF1aXBcIiksXHJcblxyXG5cdFwiMDEwMFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMDBcIiwgXCJDYXBcIixcdFx0XHRcIkNhcFwiLFx0XHRcdFx0XCJjYXBcIixcdFx0XHRcIuW4veWtkFwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEwMVwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMDFcIiwgXCJBY2Nlc3NvcnlcIixcdFwiYWNjZXNzb3J5RmFjZVwiLFx0XCJhY2Nlc3NvcnlGYWNlXCIsIFwi6IeJ6aO+XCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTAyXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEwMlwiLCBcIkFjY2Vzc29yeVwiLFx0XCJhY2Nlc3NvcnlFeWVzXCIsXHRcImFjY2Vzc29yeUV5ZXNcIiwgXCLnnLzpo75cIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMDNcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTAzXCIsIFwiQWNjZXNzb3J5XCIsXHRcImFjY2Vzc29yeUVhcnNcIixcdFwiYWNjZXNzb3J5RWFyc1wiLCBcIuiAs+eSsFwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEwNFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMDRcIiwgXCJDb2F0XCIsXHRcdFwiQ29hdFwiLFx0XHRcdFx0XCJjb2F0XCIsXHRcdFx0XCLkuIrooaNcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMDVcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTA1XCIsIFwiTG9uZ2NvYXRcIixcdFwiTG9uZ2NvYXRcIixcdFx0XHRcImxvbmdjb2F0XCIsXHRcdFwi5aWX5pyNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTA2XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEwNlwiLCBcIlBhbnRzXCIsXHRcdFwiUGFudHNcIixcdFx0XHRcInBhbnRzXCIsXHRcdFwi6KSy5a2QXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTA3XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEwN1wiLCBcIlNob2VzXCIsXHRcdFwiU2hvZXNcIixcdFx0XHRcInNob2VzXCIsXHRcdFwi6Z6L5a2QXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTA4XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEwOFwiLCBcIkdsb3ZlXCIsXHRcdFwiR2xvdmVcIixcdFx0XHRcImdsb3ZlXCIsXHRcdFwi5omL5aWXXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTA5XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEwOVwiLCBcIlNoaWVsZFwiLFx0XHRcIlNoaWVsZFwiLFx0XHRcdFwic2hpZWxkXCIsXHRcdFwi55u+54mMXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTEwXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDExMFwiLCBcIkNhcGVcIixcdFx0XCJDYXBlXCIsXHRcdFx0XHRcImNhcGVcIixcdFx0XHRcIuaKq+miqFwiLCBcIkVxdWlwXCIpLFxyXG5cclxuXHRcIjAxMjFcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTIxXCIsIFwiV2VhcG9uXCIsIFwi6ZaD5Lqu5YWL6a2vXCIsIFwid2VhcG9uXCIsIFwi6ZaD5Lqu5YWL6a2vXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTIyXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEyMlwiLCBcIldlYXBvblwiLCBcIumdiOmtguWwhOaJi1wiLCBcIndlYXBvblwiLCBcIumdiOmtguWwhOaJi1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEyM1wiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMjNcIiwgXCJXZWFwb25cIiwgXCLprZTlio1cIiwgXCJ3ZWFwb25cIiwgXCLprZTlio1cIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMjRcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTI0XCIsIFwiV2VhcG9uXCIsIFwi6IO96YeP5YqNXCIsIFwid2VhcG9uXCIsIFwi6IO96YeP5YqNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTI1XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEyNVwiLCBcIldlYXBvblwiLCBcIuW5u+eNuOajklwiLCBcIndlYXBvblwiLCBcIuW5u+eNuOajklwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEyNlwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMjZcIiwgXCJXZWFwb25cIiwgXCJFU1DpmZDliLblmahcIiwgXCJ3ZWFwb25cIiwgXCJFU1DpmZDliLblmahcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMjdcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTI3XCIsIFwiV2VhcG9uXCIsIFwi6Y6W6Y+IXCIsIFwid2VhcG9uXCIsIFwi6Y6W6Y+IXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTI4XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEyOFwiLCBcIldlYXBvblwiLCBcIumtlOWKm+itt+iFlVwiLCBcIndlYXBvblwiLCBcIumtlOWKm+itt+iFlVwiLCBcIkVxdWlwXCIpLFxyXG5cclxuXHRcIjAxMzBcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTMwXCIsIFwiV2VhcG9uXCIsIFwi5Zau5omL5YqNXCIsIFwid2VhcG9uXCIsIFwi5Zau5omL5YqNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTMxXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEzMVwiLCBcIldlYXBvblwiLCBcIuWWruaJi+aWp1wiLCBcIndlYXBvblwiLCBcIuWWruaJi+aWp1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEzMlwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMzJcIiwgXCJXZWFwb25cIiwgXCLllq7miYvpjJhcIiwgXCJ3ZWFwb25cIiwgXCLllq7miYvpjJhcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMzNcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTMzXCIsIFwiV2VhcG9uXCIsIFwi55+t5YqNXCIsIFwid2VhcG9uXCIsIFwi55+t5YqNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTM0XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEzNFwiLCBcIldlYXBvblwiLCBcIumbmeWIgFwiLCBcIndlYXBvblwiLCBcIumbmeWIgFwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEzNTI2XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEzNTI2XCIsIFwiV2VhcG9uXCIsIFwi6Z2I6a2C5LmL55KwXCIsIFwid2VhcG9uXCIsIFwi6Z2I6a2C5LmL55KwXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTM1MzBcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTM1MzBcIiwgXCJXZWFwb25cIiwgXCLmjqfliLblmahcIiwgXCJ3ZWFwb25cIiwgXCLmjqfliLblmahcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxMzZcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTM2XCIsIFwiV2VhcG9uXCIsIFwi5omL5p2WXCIsIFwid2VhcG9uXCIsIFwi5omL5p2WXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTM3XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDEzN1wiLCBcIldlYXBvblwiLCBcIuefreadllwiLCBcIndlYXBvblwiLCBcIuefreadllwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDEzOFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxMzhcIiwgXCJXZWFwb25cIiwgXCLplbfmnZZcIiwgXCJ3ZWFwb25cIiwgXCLplbfmnZZcIiwgXCJFcXVpcFwiKSxcclxuXHRcclxuXHRcIjAxNDBcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTQwXCIsIFwiV2VhcG9uXCIsIFwi6ZuZ5omL5YqNXCIsIFwid2VhcG9uXCIsIFwi6ZuZ5omL5YqNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTQxXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE0MVwiLCBcIldlYXBvblwiLCBcIumbmeaJi+aWp1wiLCBcIndlYXBvblwiLCBcIumbmeaJi+aWp1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE0MlwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNDJcIiwgXCJXZWFwb25cIiwgXCLpm5nmiYvmo41cIiwgXCJ3ZWFwb25cIiwgXCLpm5nmiYvmo41cIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNDNcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTQzXCIsIFwiV2VhcG9uXCIsIFwi5qeNXCIsIFwid2VhcG9uXCIsIFwi5qeNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTQ0XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE0NFwiLCBcIldlYXBvblwiLCBcIuefm1wiLCBcIndlYXBvblwiLCBcIuefm1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE0NVwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNDVcIiwgXCJXZWFwb25cIiwgXCLlvJNcIiwgXCJ3ZWFwb25cIiwgXCLlvJNcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNDZcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTQ2XCIsIFwiV2VhcG9uXCIsIFwi5bypXCIsIFwid2VhcG9uXCIsIFwi5bypXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTQ3XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE0N1wiLCBcIldlYXBvblwiLCBcIuaLs+Wll1wiLCBcIndlYXBvblwiLCBcIuaLs+Wll1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE0OFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNDhcIiwgXCJXZWFwb25cIiwgXCLmjIfomY5cIiwgXCJ3ZWFwb25cIiwgXCLmjIfomY5cIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNDlcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTQ5XCIsIFwiV2VhcG9uXCIsIFwi54Gr5qeNXCIsIFwid2VhcG9uXCIsIFwi54Gr5qeNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTUwXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE1MFwiLCBcIldlYXBvblwiLCBcIumPn1wiLCBcIndlYXBvblwiLCBcIumPn1wiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE1MVwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNTFcIiwgXCJXZWFwb25cIiwgXCLpjqxcIiwgXCJ3ZWFwb25cIiwgXCLpjqxcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNTJcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTUyXCIsIFwiV2VhcG9uXCIsIFwi6ZuZ5byp5qeNXCIsIFwid2VhcG9uXCIsIFwi6ZuZ5byp5qeNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTUzXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE1M1wiLCBcIldlYXBvblwiLCBcIuWKoOi+suegslwiLCBcIndlYXBvblwiLCBcIuWKoOi+suegslwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE1NFwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNTRcIiwgXCJXZWFwb25cIiwgXCLlpKrliIBcIiwgXCJ3ZWFwb25cIiwgXCLlpKrliIBcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNTVcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTU1XCIsIFwiV2VhcG9uXCIsIFwi5omH5a2QXCIsIFwid2VhcG9uXCIsIFwi5omH5a2QXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTU2XCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE1NlwiLCBcIldlYXBvblwiLCBcIueQiVwiLCBcIndlYXBvblwiLCBcIueQiVwiLCBcIkVxdWlwXCIpLFxyXG5cdFwiMDE1N1wiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxNTdcIiwgXCJXZWFwb25cIiwgXCLnkoNcIiwgXCJ3ZWFwb25cIiwgXCLnkoNcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxNThcIjogbmV3IEl0ZW1DYXRlZ29yeUluZm8oXCIwMTU4XCIsIFwiV2VhcG9uXCIsIFwi6YeN5ouz5qeNXCIsIFwid2VhcG9uXCIsIFwi6YeN5ouz5qeNXCIsIFwiRXF1aXBcIiksXHJcblx0XCIwMTcwXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDE3MFwiLCBcIldlYXBvblwiLCBcIjAxNzBcIiwgXCJ3ZWFwb25cIiwgXCLpu57oo53mrablmahcIiwgXCJFcXVpcFwiKSxcclxuXHRcIjAxOVwiOiBuZXcgSXRlbUNhdGVnb3J5SW5mbyhcIjAxOVwiLCBcIlRhbWluZ01vYlwiLCBcIlRhbWluZ01vYlwiLCBcInRhbWluZ01vYlwiLCBcIumojuWvtVwiLCBcIkVxdWlwXCIsIFwiVGFtaW5nL1wiKSxcclxuXHJcblx0XCIwMzAxXCI6IG5ldyBJdGVtQ2F0ZWdvcnlJbmZvKFwiMDMwMVwiLCBcIkluc3RhbGxcIiwgXCJDaGFpclwiLCBcImluc3RhbGxcIiwgXCLmpIXlrZBcIiwgXCJJdGVtXCIpLFxyXG59O1xyXG5cclxuSXRlbUNhdGVnb3J5SW5mby5fY2F0ZWdvcnlMaXN0ID0gKGZ1bmN0aW9uIChpbmZvX21hcCkge1xyXG5cdGxldCBsaXN0ID0gW107XHJcblx0bGV0IHNldCA9IG5ldyBTZXQoKTtcclxuXHRmb3IgKGxldCBpIGluIGluZm9fbWFwKSB7XHJcblx0XHRsZXQgY2F0ID0gaW5mb19tYXBbaV07XHJcblx0XHRsZXQga2V5ID0gY2F0LmNhdGVnb3J5TmFtZSB8fCBjYXQubGlzdFBhdGg7XHJcblxyXG5cdFx0aWYgKCFzZXQuaGFzKGtleSkpIHtcclxuXHRcdFx0c2V0LmFkZChrZXkpO1xyXG5cclxuXHRcdFx0bGlzdC5wdXNoKHtcclxuXHRcdFx0XHRrZXk6IGtleSxcclxuXHRcdFx0XHR2YWx1ZTogaSxcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJldHVybiBsaXN0O1xyXG59KShJdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvKTtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZXNvdXJjZU1hbmFnZXIge1xyXG5cdHN0YXRpYyBpc0VxdWlwRXhpc3QoaWQsIGNhdGVJbmZvKSB7XHJcblx0XHRjb25zdCBkcCA9IGNhdGVJbmZvLmxpc3RQYXRoO1xyXG5cdFx0Y29uc3QgZXMgPSBSZXNvdXJjZU1hbmFnZXIuZXF1aXBfbWFwW2RwXTtcclxuXHRcdHJldHVybiAhZXMgfHwgZXMuaGFzKGlkKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHVybFxyXG5cdCAqL1xyXG5cdHN0YXRpYyBhc3luYyBsb2FkQXJjaGl2ZSh1cmwpIHtcclxuXHRcdCRzZXRWYWx1ZSgkYXJjaGl2ZSwgXCIvXCIsIEpTT04ucGFyc2UoYXdhaXQgUmVzb3VyY2VNYW5hZ2VyLmdldCh1cmwpKSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcclxuXHQgKi9cclxuXHRzdGF0aWMgZ2V0KHVybCkge1xyXG5cdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdFx0bGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG5cdFx0XHR4aHIub3BlbihcIkdFVFwiLCB1cmwsIHRydWUpO1xyXG5cclxuXHRcdFx0eGhyLnRpbWVvdXQgPSAxMCAqIDYwICogMTAwMDsvLzIwMDAwO1xyXG5cclxuXHRcdFx0eGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5zdGF0dXMgPT0gNDA0IHx8IHRoaXMuc3RhdHVzID09IDUwMCkge1xyXG5cdFx0XHRcdFx0JGZhaWxlZF91cmxzLnB1c2godXJsKTtcclxuXHRcdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdFx0Ly9yZXNvbHZlKG51bGwpO1xyXG5cdFx0XHRcdFx0cmVqZWN0KHRoaXMuc3RhdHVzICsgXCI6IFwiICsgdXJsKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAodGhpcy5zdGF0dXMgPT0gMjAwKSB7XHJcblx0XHRcdFx0XHRyZXNvbHZlKHRoaXMucmVzcG9uc2VUZXh0KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAodGhpcy5zdGF0dXMgPT0gMzA0KSB7XHJcblx0XHRcdFx0XHRkZWJ1Z2dlclxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHhoci5vbnRpbWVvdXQgPSBmdW5jdGlvbiAoZSkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdC8vIFhNTEh0dHBSZXF1ZXN0IOi2heaXtuOAguWcqOatpOWBmuafkOS6i+OAglxyXG5cdFx0XHRcdC8vcmVzb2x2ZShudWxsKTtcclxuXHRcdFx0XHRyZWplY3QoXCJ0aW1lb3V0OiBcIiArIHVybCk7XHJcblx0XHRcdH07XHJcblxyXG5cdFx0XHR4aHIub25hYm9ydCA9IGZ1bmN0aW9uIChlKSB7XHJcblx0XHRcdFx0cmVqZWN0KFwiYWJvcnQ6IFwiICsgdXJsKTtcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdHhoci5zZW5kKCk7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXQgcm9vdF9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIHdpbmRvdy4kUk9PVF9QQVRIO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBhcmNoaXZlKCkge1xyXG5cdFx0cmV0dXJuICRhcmNoaXZlO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBmYWlsZWRfdXJscygpIHtcclxuXHRcdHJldHVybiAkZmFpbGVkX3VybHM7XHJcblx0fVxyXG59XHJcbndpbmRvdy4kUmVzb3VyY2VNYW5hZ2VyID0gUmVzb3VyY2VNYW5hZ2VyO1xyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7e319IG9ialxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcGFyYW0ge2FueX0gdmFsdWVcclxuICovXHJcbmZ1bmN0aW9uICRzZXRWYWx1ZShvYmosIHBhdGgsIHZhbHVlKSB7XHJcblx0aWYgKHBhdGguZW5kc1dpdGgoXCIvXCIpKSB7XHJcblx0XHRwYXRoID0gcGF0aC5zbGljZSgwLCBwYXRoLmxlbmd0aCAtIDEpO1xyXG5cdH1cclxuXHRsZXQgcHMgPSBwYXRoLnNwbGl0KFwiL1wiKTtcclxuXHRsZXQgaSwgdGFyZ2V0ID0gb2JqLCBsYXN0SW5kZXggPSBwcy5sZW5ndGggLSAxO1xyXG5cdGZvciAoaSA9IDA7IGkgPCBsYXN0SW5kZXg7ICsraSkge1xyXG5cdFx0bGV0IGtleSA9IHBzW2ldO1xyXG5cdFx0aWYgKHRhcmdldFtrZXldID09IG51bGwpIHtcclxuXHRcdFx0dGFyZ2V0W2tleV0gPSB7fTtcclxuXHRcdH1cclxuXHRcdHRhcmdldCA9IHRhcmdldFtrZXldO1xyXG5cdH1cclxuXHRsZXQgb3JpZ2luX3ZhbHVlID0gdGFyZ2V0W3BzW2xhc3RJbmRleF1dO1xyXG5cdGlmIChvcmlnaW5fdmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcblx0XHRkZWxldGUgdGFyZ2V0W3BzW2xhc3RJbmRleF1dO1xyXG5cdFx0dGFyZ2V0W3BzW2xhc3RJbmRleF1dID0gdmFsdWU7XHJcblx0fVxyXG5cdGVsc2UgaWYgKG9yaWdpbl92YWx1ZSAmJiB0eXBlb2Ygb3JpZ2luX3ZhbHVlID09IFwib2JqZWN0XCIpIHtcclxuXHRcdC8vaWYgKHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG5cdFx0Ly9cdGRlYnVnZ2VyO1xyXG5cdFx0Ly99XHJcblx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRmb3IgKGxldCBrZXkgaW4gdmFsdWUpIHtcclxuXHRcdFx0XHRvcmlnaW5fdmFsdWVba2V5XSA9IHZhbHVlW2tleV0gfHwgb3JpZ2luX3ZhbHVlW2tleV07XHJcblx0XHRcdH1cclxuXHRcdC8vfVxyXG5cdH1cclxuXHRlbHNlIGlmICh0eXBlb2YgdmFsdWUgIT0gXCJ1bmRlZmluZWRcIikge1xyXG5cdFx0dGFyZ2V0W3BzW2xhc3RJbmRleF1dID0gdmFsdWU7XHJcblx0fVxyXG59XHJcbmZ1bmN0aW9uICRnZXRWYWx1ZShvYmosIHBhdGgpIHtcclxuXHRpZiAocGF0aC5lbmRzV2l0aChcIi9cIikpIHtcclxuXHRcdHBhdGggPSBwYXRoLnNsaWNlKDAsIHBhdGgubGVuZ3RoIC0gMSk7XHJcblx0fVxyXG5cdGxldCBwcyA9IHBhdGguc3BsaXQoXCIvXCIpO1xyXG5cdGxldCBpLCB0YXJnZXQgPSBvYmosIGxhc3RJbmRleCA9IHBzLmxlbmd0aCAtIDE7XHJcblx0Zm9yIChpID0gMDsgaSA8IGxhc3RJbmRleDsgKytpKSB7XHJcblx0XHRsZXQga2V5ID0gcHNbaV07XHJcblx0XHRpZiAodGFyZ2V0W2tleV0pIHtcclxuXHRcdFx0XHR0YXJnZXQgPSB0YXJnZXRba2V5XTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdW5kZWZpbmVkO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRyZXR1cm4gdGFyZ2V0W3BzW2xhc3RJbmRleF1dO1xyXG59XHJcblxyXG5jb25zdCBzeW1ib2xfaXNQYWNrID0gU3ltYm9sKFwiJHBhY2tcIik7XHJcblxyXG5jb25zdCB1cmxfc3RhcnRzV2l0aF9wcm90b2NvbCA9IFJlZ0V4cC5wcm90b3R5cGUudGVzdC5iaW5kKC9eKChbYS16QS1aXlxcOl0rKShcXDouKikkfFxcL1xcLykvKTtcclxuZnVuY3Rpb24gX3NldFZhbHVlQnlQYXRoKHBhdGgsIHZhbHVlLCBpc19wYWNrKSB7XHJcblx0aWYgKHVybF9zdGFydHNXaXRoX3Byb3RvY29sKHBhdGgpKSB7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cdGVsc2UgaWYgKHdpbmRvdy4kUk9PVF9QQVRIICE9IFwiXCIgJiYgcGF0aC5zdGFydHNXaXRoKHdpbmRvdy4kUk9PVF9QQVRIKSkge1xyXG5cdFx0aWYgKGlzX3BhY2spIHtcclxuXHRcdFx0dmFsdWVbc3ltYm9sX2lzUGFja10gPSB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0cGF0aCA9IHBhdGguc2xpY2Uod2luZG93LiRST09UX1BBVEgubGVuZ3RoKTtcclxuXHRcdHJldHVybiAkc2V0VmFsdWUoJGFyY2hpdmUsIHBhdGgsIHZhbHVlKTtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRyZXR1cm4gJHNldFZhbHVlKCRhcmNoaXZlLCBwYXRoLCB2YWx1ZSk7XHJcblx0fVxyXG59XHJcbmZ1bmN0aW9uIF9nZXRWYWx1ZUZyb21BcmNoaXZlQnlQYXRoKHBhdGgsIHZhbHVlKSB7XHJcblx0bGV0IF9wYXRoID0gX2dldERhdGFQYXRoQnlVcmwocGF0aCk7XHJcblx0aWYgKF9wYXRoKSB7XHJcblx0XHRyZXR1cm4gJGdldFZhbHVlKCRhcmNoaXZlLCBfcGF0aCk7XHJcblx0fVxyXG5cdHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuZnVuY3Rpb24gX2dldERhdGFQYXRoQnlVcmwocGF0aCkge1xyXG5cdGlmICghdXJsX3N0YXJ0c1dpdGhfcHJvdG9jb2wocGF0aCkpIHtcclxuXHRcdGlmICh3aW5kb3cuJFJPT1RfUEFUSCAhPSBcIlwiICYmIHBhdGguc3RhcnRzV2l0aCh3aW5kb3cuJFJPT1RfUEFUSCkpIHtcclxuXHRcdFx0cmV0dXJuIHBhdGguc2xpY2Uod2luZG93LiRST09UX1BBVEgubGVuZ3RoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cmV0dXJuIHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT58YW55fVxyXG4gKi9cclxuZnVuY3Rpb24gJGdldFZhbHVlQXN5bmMob2JqLCBwYXRoKSB7XHJcblx0aWYgKHBhdGguZW5kc1dpdGgoXCIvXCIpKSB7XHJcblx0XHRwYXRoID0gcGF0aC5zbGljZSgwLCBwYXRoLmxlbmd0aCAtIDEpO1xyXG5cdH1cclxuXHRcclxuXHQvLyB0cnkgZ2V0IHZhbHVlIHN5bmNcclxuXHRsZXQgdmFsdWUgPSAkZ2V0VmFsdWUob2JqLCBwYXRoKTtcclxuXHRcclxuXHQvLyBpZiB2YWx1ZSBleGlzdFxyXG5cdGlmICh2YWx1ZSkge1xyXG5cdFx0aWYgKHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG5cdFx0XHQvLyA/P1xyXG5cdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cdFx0XHRcdGF3YWl0IHZhbHVlO1xyXG5cdFx0XHRcdHJlc29sdmUoYXdhaXQgJGdldFZhbHVlQXN5bmMob2JqLCBwYXRoKSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiB2YWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7Ly8gaWYgdmFsdWUgbm90IGV4aXN0LCB0cnkgYXdhaXQgcGFyZW50IG5vZGVcclxuXHRcdGxldCBwcyA9IHBhdGguc3BsaXQoXCIvXCIpO1xyXG5cdFx0bGV0IGksIHRhcmdldCA9IG9iaiwgbGFzdEluZGV4ID0gcHMubGVuZ3RoIC0gMTtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBsYXN0SW5kZXg7ICsraSkge1xyXG5cdFx0XHRsZXQga2V5ID0gcHNbaV07XHJcblx0XHRcdGlmICh0YXJnZXRba2V5XSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuXHRcdFx0XHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xyXG5cdFx0XHRcdFx0YXdhaXQgdGFyZ2V0W2tleV07XHJcblx0XHRcdFx0XHRyZXNvbHZlKGF3YWl0ICRnZXRWYWx1ZUFzeW5jKG9iaiwgcGF0aCkpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0YXJnZXRba2V5XSkge1xyXG5cdFx0XHRcdFx0dGFyZ2V0ID0gdGFyZ2V0W2tleV07XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0bGV0IHJlc3VsdCA9IHRhcmdldFtwc1tsYXN0SW5kZXhdXTtcclxuXHRcdGlmIChyZXN1bHQgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcblx0XHRcdHJldHVybiBuZXcgUHJvbWlzZShhc3luYyBmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHRcdFx0YXdhaXQgcmVzdWx0O1xyXG5cdFx0XHRcdHJlc29sdmUoYXdhaXQgJGdldFZhbHVlQXN5bmMob2JqLCBwYXRoKSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiByZXN1bHQ7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHVybFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fVxyXG4gKi9cclxuZXhwb3J0IGxldCAkZ2V0ID0gZnVuY3Rpb24gJGdldCh1cmwpIHtcclxuXHRyZXR1cm4gUmVzb3VyY2VNYW5hZ2VyLmdldCh1cmwpO1xyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fVxyXG4gKi9cclxuJGdldC5wYWNrID0gYXN5bmMgZnVuY3Rpb24gJGdldF9wYWNrKHBhdGgpIHtcclxuXHRsZXQgX3BhdGggPSBfZ2V0RGF0YVBhdGhCeVVybChwYXRoKTtcclxuXHRsZXQgb2JqO1xyXG5cclxuXHRpZiAoX3BhdGgpIHtcclxuXHRcdG9iaiA9ICRnZXRWYWx1ZUFzeW5jKCRhcmNoaXZlLCBfcGF0aCk7XHJcblx0fVxyXG5cclxuXHRpZiAob2JqIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG5cdFx0cmV0dXJuIGF3YWl0IG9iajtcclxuXHR9XHJcblx0ZWxzZSBpZiAob2JqICYmIG9ialtzeW1ib2xfaXNQYWNrXSkge1xyXG5cdFx0cmV0dXJuIG9iajtcclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XHJcblx0XHRcdGlmIChvYmogJiYgIW9ialtzeW1ib2xfaXNQYWNrXSkge1xyXG5cdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJkYXRhOiBcIiArIHBhdGgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRjb25zdCB1cmwgPSAkZ2V0LnBhY2tVcmwocGF0aCk7XHJcblxyXG5cdFx0bGV0IHRhc2sgPSAoYXN5bmMgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRsZXQganNvblRleHQgPSBhd2FpdCBSZXNvdXJjZU1hbmFnZXIuZ2V0KHVybCk7XHJcblxyXG5cdFx0XHRvYmogPSBKU09OLnBhcnNlKGpzb25UZXh0KTtcclxuXHJcblx0XHRcdF9zZXRWYWx1ZUJ5UGF0aChwYXRoLCBvYmosIHRydWUpO1xyXG5cclxuXHRcdFx0cmV0dXJuIG9iajtcclxuXHRcdH0pKCk7XHJcblx0XHRfc2V0VmFsdWVCeVBhdGgocGF0aCwgdGFzaywgdHJ1ZSk7XHJcblxyXG5cdFx0cmV0dXJuIGF3YWl0IHRhc2s7XHJcblx0fVxyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fVxyXG4gKi9cclxuJGdldC5wYWNrU3luYyA9IGZ1bmN0aW9uIGdldF9wYWNrU3luYyhwYXRoKSB7XHJcblx0bGV0IG9iaiA9IF9nZXRWYWx1ZUZyb21BcmNoaXZlQnlQYXRoKHBhdGgpO1xyXG5cdGlmIChvYmopIHtcclxuXHRcdHJldHVybiBvYmo7XHJcblx0fVxyXG5cdHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59XHJcbiAqL1xyXG4kZ2V0LmRhdGEgPSBhc3luYyBmdW5jdGlvbiAkZ2V0X2RhdGEocGF0aCkge1xyXG5cdGxldCBfcGF0aCA9IF9nZXREYXRhUGF0aEJ5VXJsKHBhdGgpO1xyXG5cdGxldCBvYmo7XHJcblxyXG5cdGlmIChfcGF0aCkge1xyXG5cdFx0b2JqID0gJGdldFZhbHVlQXN5bmMoJGFyY2hpdmUsIF9wYXRoKTtcclxuXHR9XHJcblxyXG5cdGlmIChvYmogaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcblx0XHRyZXR1cm4gYXdhaXQgb2JqO1xyXG5cdH1cclxuXHRlbHNlIGlmIChvYmopIHtcclxuXHRcdHJldHVybiBvYmo7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0Y29uc3QgdXJsID0gJGdldC5kYXRhVXJsKHBhdGgpO1xyXG5cclxuXHRcdGxldCB0YXNrID0gKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0bGV0IGpzb25UZXh0ID0gYXdhaXQgUmVzb3VyY2VNYW5hZ2VyLmdldCh1cmwpO1xyXG5cclxuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShqc29uVGV4dCk7XHJcblxyXG5cdFx0XHRfc2V0VmFsdWVCeVBhdGgocGF0aCwgb2JqLCBmYWxzZSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0fSkoKTtcclxuXHRcdF9zZXRWYWx1ZUJ5UGF0aChwYXRoLCB0YXNrLCBmYWxzZSk7XHJcblxyXG5cdFx0cmV0dXJuIGF3YWl0IHRhc2s7XHJcblx0fVxyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7YW55fVxyXG4gKi9cclxuJGdldC5kYXRhU3luYyA9IGZ1bmN0aW9uIGdldF9kYXRhU3luYyhwYXRoKSB7XHJcblx0bGV0IG9iaiA9IF9nZXRWYWx1ZUZyb21BcmNoaXZlQnlQYXRoKHBhdGgpO1xyXG5cdGlmIChvYmopIHtcclxuXHRcdHJldHVybiBvYmo7XHJcblx0fVxyXG5cdHJldHVybiB1bmRlZmluZWQ7XHJcbn1cclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPGFueT59XHJcbiAqL1xyXG4kZ2V0Lmxpc3QgPSBhc3luYyBmdW5jdGlvbiAkZ2V0X2xpc3QocGF0aCkge1xyXG5cdGxldCBfcGF0aCA9IF9nZXREYXRhUGF0aEJ5VXJsKHBhdGgpO1xyXG5cdGxldCBvYmo7XHJcblxyXG5cdGlmIChfcGF0aCkge1xyXG5cdFx0b2JqID0gJGdldFZhbHVlQXN5bmMoJGFyY2hpdmUsIF9wYXRoKTtcclxuXHR9XHJcblxyXG5cdGlmIChvYmogaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcblx0XHRyZXR1cm4gYXdhaXQgb2JqO1xyXG5cdH1cclxuXHRlbHNlIGlmIChvYmopIHtcclxuXHRcdHJldHVybiBvYmo7XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0Y29uc3QgdXJsID0gJGdldC5saXN0VXJsKHBhdGgpO1xyXG5cclxuXHRcdGxldCB0YXNrID0gKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0bGV0IGpzb25UZXh0ID0gYXdhaXQgUmVzb3VyY2VNYW5hZ2VyLmdldCh1cmwpO1xyXG5cclxuXHRcdFx0b2JqID0gSlNPTi5wYXJzZShqc29uVGV4dCk7XHJcblxyXG5cdFx0XHRfc2V0VmFsdWVCeVBhdGgocGF0aCwgb2JqLCBmYWxzZSk7XHJcblxyXG5cdFx0XHRyZXR1cm4gb2JqO1xyXG5cdFx0fSkoKTtcclxuXHRcdF9zZXRWYWx1ZUJ5UGF0aChwYXRoLCB0YXNrLCBmYWxzZSk7XHJcblxyXG5cdFx0cmV0dXJuIGF3YWl0IHRhc2s7XHJcblx0fVxyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxhbnk+fVxyXG4gKi9cclxuJGdldC5saXN0U3luYyA9IGZ1bmN0aW9uICRnZXRfbGlzdFN5bmMocGF0aCkge1xyXG5cdGxldCBvYmogPSBfZ2V0VmFsdWVGcm9tQXJjaGl2ZUJ5UGF0aChwYXRoKTtcclxuXHRpZiAob2JqKSB7XHJcblx0XHRyZXR1cm4gT2JqZWN0LmtleXMob2JqKTtcclxuXHR9XHJcblx0cmV0dXJuIHVuZGVmaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG4kZ2V0LmRhdGFVcmwgPSBmdW5jdGlvbiAkZ2V0X2RhdGFVcmwocGF0aCkge1xyXG5cdGlmICh1cmxfc3RhcnRzV2l0aF9wcm90b2NvbChwYXRoKSkge1xyXG5cdFx0cmV0dXJuIHBhdGg7XHJcblx0fVxyXG5cdGVsc2UgaWYgKCFwYXRoLnN0YXJ0c1dpdGgoXCJkYXRhXCIpKSB7XHJcblx0XHRyZXR1cm4gYCR7d2luZG93LiRST09UX1BBVEh9ZGF0YSR7cGF0aH0uanNvbmA7XHJcblx0fVxyXG5cdHRocm93IG5ldyBFcnJvcihcIk5vdCBnYW1lIGRhdGE6IFwiICsgcGF0aCk7XHJcbn1cclxuLyoqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcbiAqIEByZXR1cm5zIHtzdHJpbmd9XHJcbiAqL1xyXG4kZ2V0LnBhY2tVcmwgPSBmdW5jdGlvbiAkZ2V0X3BhY2tVcmwocGF0aCkge1xyXG5cdGlmICh1cmxfc3RhcnRzV2l0aF9wcm90b2NvbChwYXRoKSkge1xyXG5cdFx0cmV0dXJuIHBhdGg7XHJcblx0fVxyXG5cdGVsc2UgaWYgKCFwYXRoLnN0YXJ0c1dpdGgoXCJwYWNrXCIpKSB7XHJcblx0XHRyZXR1cm4gYCR7d2luZG93LiRST09UX1BBVEh9cGFjayR7cGF0aH0uanNvbmA7XHJcblx0fVxyXG5cdHRocm93IG5ldyBFcnJvcihcIk5vdCBnYW1lIHBhY2s6IFwiICsgcGF0aCk7XHJcbn1cclxuJGdldC5saXN0VXJsID0gZnVuY3Rpb24gJGdldF9saXN0VXJsKHBhdGgpIHtcclxuXHRpZiAodXJsX3N0YXJ0c1dpdGhfcHJvdG9jb2wocGF0aCkpIHtcclxuXHRcdHJldHVybiBwYXRoO1xyXG5cdH1cclxuXHRlbHNlIGlmICghcGF0aC5zdGFydHNXaXRoKFwibHNcIikpIHtcclxuXHRcdHJldHVybiBgJHt3aW5kb3cuJFJPT1RfUEFUSH1scyR7cGF0aH0uanNvbmA7XHJcblx0fVxyXG5cdHRocm93IG5ldyBFcnJvcihwYXRoKTtcclxufVxyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGhcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbiRnZXQuaW1hZ2VVcmwgPSBmdW5jdGlvbiAkZ2V0X2ltYWdlc1VybChwYXRoKSB7XHJcblx0aWYgKHVybF9zdGFydHNXaXRoX3Byb3RvY29sKHBhdGgpKSB7XHJcblx0XHRyZXR1cm4gcGF0aDtcclxuXHR9XHJcblx0ZWxzZSBpZiAoIXBhdGguc3RhcnRzV2l0aChcImltYWdlc1wiKSkge1xyXG5cdFx0cmV0dXJuIGAke3dpbmRvdy4kUk9PVF9QQVRIfWltYWdlcyR7cGF0aH0ucG5nYDtcclxuXHR9XHJcblx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGdhbWUgaW1hZ2VzOiBcIiArIHBhdGgpO1xyXG59XHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuJGdldC5zb3VuZE1wM1VybCA9IGZ1bmN0aW9uICRnZXRfc291bmRNcDNVcmwocGF0aCkge1xyXG5cdGlmICh1cmxfc3RhcnRzV2l0aF9wcm90b2NvbChwYXRoKSkge1xyXG5cdFx0cmV0dXJuIHBhdGg7XHJcblx0fVxyXG5cdGVsc2UgaWYgKCFwYXRoLnN0YXJ0c1dpdGgoXCJzb3VuZFwiKSkge1xyXG5cdFx0cmV0dXJuIGAke3dpbmRvdy4kUk9PVF9QQVRIfXNvdW5kJHtwYXRofS5tcDNgO1xyXG5cdH1cclxuXHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgZ2FtZSBzb3VuZDogXCIgKyBwYXRoKTtcclxufVxyXG4vKipcclxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGhcclxuICogQHJldHVybnMge3N0cmluZ31cclxuICovXHJcbiRnZXQuc291bmRXYXZVcmwgPSBmdW5jdGlvbiAkZ2V0X3NvdW5kV2F2VXJsKHBhdGgpIHtcclxuXHRpZiAodXJsX3N0YXJ0c1dpdGhfcHJvdG9jb2wocGF0aCkpIHtcclxuXHRcdHJldHVybiBwYXRoO1xyXG5cdH1cclxuXHRlbHNlIGlmICghcGF0aC5zdGFydHNXaXRoKFwic291bmRcIikpIHtcclxuXHRcdHJldHVybiBgJHt3aW5kb3cuJFJPT1RfUEFUSH1zb3VuZCR7cGF0aH0ud2F2YDtcclxuXHR9XHJcblx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGdhbWUgc291bmQ6IFwiICsgcGF0aCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gcGF0aFxyXG4gKiBAcmV0dXJucyB7c3RyaW5nfVxyXG4gKi9cclxuJGdldC5hc3NldFVybCA9IGZ1bmN0aW9uICRnZXRfYXNzZXRVcmwocGF0aCkge1xyXG5cdHJldHVybiBgJHt3aW5kb3cuJFJPT1RfUEFUSH0ke3BhdGh9YDtcclxufVxyXG4kZ2V0LmFzc2V0ID0gZnVuY3Rpb24gJGdldF9hc3NldChwYXRoKSB7XHJcblx0cmV0dXJuICRnZXQoJGdldC5hc3NldFVybChwYXRoKSk7XHJcbn1cclxuXHJcbndpbmRvdy4kZ2V0ID0gJGdldDtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgSXRlbUF0dHJOb3JtYWxpemUge1xyXG5cdHN0YXRpYyBoZWFkKGl0ZW0pIHtcclxuXHRcdGl0ZW0uZ2VuZGVyID0gMjtcclxuXHR9XHJcblx0c3RhdGljIGJvZHkoaXRlbSkge1xyXG5cdFx0aXRlbS5nZW5kZXIgPSAyO1xyXG5cdH1cclxuXHRzdGF0aWMgRmFjZShpdGVtKSB7XHJcblx0XHRjb25zdCBnID0gTWF0aC50cnVuYygoaXRlbS5pZCAlIDEwMDAwKSAvIDEwMDApO1xyXG5cdFx0aXRlbS5nZW5kZXIgPSBnID09IDEgfHwgZyA9PSA0ID8gMSA6IDA7XHJcblx0fVxyXG5cdHN0YXRpYyBIYWlyKGl0ZW0pIHtcclxuXHRcdGNvbnN0IGcgPSBNYXRoLnRydW5jKChpdGVtLmlkICUgMTAwMDApIC8gMTAwMCk7XHJcblx0XHRpdGVtLmdlbmRlciA9IGcgPT0gMSB8fCBnID09IDIgfHwgZyA9PSA0IHx8IGcgPT0gNyA/IDEgOiAwO1xyXG5cdH1cclxuXHRzdGF0aWMgQ2FwKGl0ZW0pIHtcclxuXHRcdEl0ZW1BdHRyTm9ybWFsaXplLl9lcXVpcChpdGVtKTtcclxuXHR9XHJcblx0c3RhdGljIGFjY2Vzc29yeUZhY2UoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgYWNjZXNzb3J5RXllcyhpdGVtKSB7XHJcblx0XHRJdGVtQXR0ck5vcm1hbGl6ZS5fZXF1aXAoaXRlbSk7XHJcblx0fVxyXG5cdHN0YXRpYyBhY2Nlc3NvcnlFYXJzKGl0ZW0pIHtcclxuXHRcdEl0ZW1BdHRyTm9ybWFsaXplLl9lcXVpcChpdGVtKTtcclxuXHR9XHJcblx0c3RhdGljIENvYXQoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgTG9uZ2NvYXQoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgUGFudHMoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgU2hvZXMoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgR2xvdmUoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgU2hpZWxkKGl0ZW0pIHtcclxuXHRcdEl0ZW1BdHRyTm9ybWFsaXplLl9lcXVpcChpdGVtKTtcclxuXHR9XHJcblx0c3RhdGljIENhcGUoaXRlbSkge1xyXG5cdFx0SXRlbUF0dHJOb3JtYWxpemUuX2VxdWlwKGl0ZW0pO1xyXG5cdH1cclxuXHRzdGF0aWMgX2VxdWlwKGl0ZW0pIHtcclxuXHRcdGNvbnN0IGcgPSBNYXRoLnRydW5jKChpdGVtLmlkICUgMTAwMDApIC8gMTAwMCk7XHJcblx0XHRpdGVtLmdlbmRlciA9IGcgPT0gMCA/IDAgOiAoZyA9PSAxID8gMSA6IDIpO1xyXG5cdH1cclxufVxyXG5cclxuY29uc3QgcmVnZXhwX2dldEhhaXJTdHlsZUlEID0gLyhcXGR7NCw3fSlcXGQkLztcclxuY29uc3QgcmVnZXhwX2dldEZhY2VTdHlsZUlEID0gLyhcXGR7Miw1fSlcXGQoXFxkezJ9KSQvO1xyXG5cclxuY29uc3QgcmVnZXhwX2dldEhhaXJDb2xvciA9IC9cXGR7NCw3fShcXGQpJC87XHJcbmNvbnN0IHJlZ2V4cF9nZXRGYWNlQ29sb3IgPSAvXFxkezIsNX0oXFxkKVxcZHsyfSQvO1xyXG5cclxuZXhwb3J0IGNsYXNzIENoYXJhY3RlclJlbmRlckNvbmZpZyB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlIGlkXHJcblx0ICogQHJldHVybnMge3N0cmluZ1tdfVxyXG5cdCAqL1xyXG5cdHN0YXRpYyAqIGVudW1IYWlyQ29sb3Ioc3R5bGUpIHtcclxuXHRcdGxldCBtID0gc3R5bGUubWF0Y2gocmVnZXhwX2dldEhhaXJTdHlsZUlEKTtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgMTA7ICsraSkge1xyXG5cdFx0XHRsZXQgaWQgPSBtWzFdICsgaTtcclxuXHRcdFx0eWllbGQgaWQ7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGUgaWRcclxuXHQgKiBAcmV0dXJucyB7c3RyaW5nW119XHJcblx0ICovXHJcblx0c3RhdGljICogZW51bUZhY2VDb2xvcihzdHlsZSkge1xyXG5cdFx0bGV0IG0gPSBzdHlsZS5tYXRjaChyZWdleHBfZ2V0RmFjZVN0eWxlSUQpO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgKytpKSB7XHJcblx0XHRcdGxldCBpZCA9IG1bMV0gKyBpICsgbVsyXTtcclxuXHRcdFx0eWllbGQgaWQ7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY29sb3JcclxuXHQgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdHN0YXRpYyBnZXRDb2xvckhhaXJJRChzdHlsZSwgY29sb3IpIHtcclxuXHRcdGxldCBtID0gc3R5bGUubWF0Y2gocmVnZXhwX2dldEhhaXJTdHlsZUlEKTtcclxuXHRcdGxldCBpZCA9IG1bMV0gKyAoY29sb3IgJSAxMCk7XHJcblx0XHRyZXR1cm4gaWQ7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjb2xvclxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XHJcblx0ICovXHJcblx0c3RhdGljIGdldENvbG9yRmFjZUlEKHN0eWxlLCBjb2xvcikge1xyXG5cdFx0bGV0IG0gPSBzdHlsZS5tYXRjaChyZWdleHBfZ2V0RmFjZVN0eWxlSUQpO1xyXG5cdFx0bGV0IGlkID0gbVsxXSArIChjb2xvciAlIDEwKSArIG1bMl07XHJcblx0XHRyZXR1cm4gaWQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRfMVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZF8yXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0c3RhdGljIGlzSGFpclN0eWxlRXF1YWwoaWRfMSwgaWRfMikge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRDb2xvckhhaXJJRChpZF8xLCAwKSA9PSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JIYWlySUQoaWRfMiwgMCk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZF8xXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXzJcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRzdGF0aWMgaXNGYWNlU3R5bGVFcXVhbChpZF8xLCBpZF8yKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldENvbG9yRmFjZUlEKGlkXzEsIDApID09IENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRDb2xvckZhY2VJRChpZF8yLCAwKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XHJcblx0ICovXHJcblx0c3RhdGljIGdldEhhaXJDb2xvcihpZCkge1xyXG5cdFx0aWYgKGlkKSB7XHJcblx0XHRcdGlkID0gU3RyaW5nKGlkKTtcclxuXHRcdFx0bGV0IG0gPSBpZC5tYXRjaChyZWdleHBfZ2V0SGFpckNvbG9yKTtcclxuXHRcdFx0aWYgKG0pIHtcclxuXHRcdFx0XHRyZXR1cm4gbVsxXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICogQHJldHVybnMge3N0cmluZ31cclxuXHQgKi9cclxuXHRzdGF0aWMgZ2V0RmFjZUNvbG9yKGlkKSB7XHJcblx0XHRpZiAoaWQpIHtcclxuXHRcdFx0aWQgPSBTdHJpbmcoaWQpO1xyXG5cdFx0XHRsZXQgbSA9IGlkLm1hdGNoKHJlZ2V4cF9nZXRGYWNlQ29sb3IpO1xyXG5cdFx0XHRpZiAobSkge1xyXG5cdFx0XHRcdHJldHVybiBtWzFdO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG52YXIgX2V4dGVybmFsX2RhdGEgPSB7XHJcblx0XCJyZXF1aXJlZEpvYnNcIjogW1xyXG5cdFx0XCJCZWdpbm5lclwiXHJcblx0XSxcclxuXHRcInJlcXVpcmVkTGV2ZWxcIjogMCxcclxuXHRcImlzQ2FzaFwiOiB0cnVlLFxyXG5cdFwibmFtZVwiOiBcIkJsdWUgQmVhbmllXCIsXHJcblx0XCJkZXNjXCI6IG51bGwsXHJcblx0XCJpZFwiOiAxMDAwMDAwLFxyXG5cdFwicmVxdWlyZWRHZW5kZXJcIjogMCxcclxuXHRcInR5cGVJbmZvXCI6IHtcclxuXHRcdFwib3ZlcmFsbENhdGVnb3J5XCI6IFwiRXF1aXBcIixcclxuXHRcdFwiY2F0ZWdvcnlcIjogXCJBcm1vclwiLFxyXG5cdFx0XCJzdWJDYXRlZ29yeVwiOiBcIkhhdFwiXHJcblx0fVxyXG59O1xyXG5cclxudmFyIEl0ZW1UeXBlSW5mbyA9IHtcclxuXHRcIkVxdWlwXCI6IHtcclxuXHRcdFwiSGF0XCI6IFwiQ2FwXCIsXHJcblx0XHRcIkNhcGVcIjogXCJDYXBlXCIsXHJcblx0XHRcIlRvcFwiOiBcIkNvYXRcIixcclxuXHRcdFwiT3ZlcmFsbFwiOiBcIkxvbmdjb2F0XCIsXHJcblx0XHRcIkdsb3ZlXCI6IFwiR2xvdmVcIixcclxuXHRcdFwiQm90dG9tXCI6IFwiUGFudHNcIixcclxuXHJcblx0XHRcIlNoaWVsZFwiOiBcIlNoaWVsZFwiLFxyXG5cdFx0XCJTaG9lc1wiOiBcIlNob2VzXCIsXHJcblx0XHRcIkV5ZSBEZWNvcmF0aW9uXCI6IFwiYWNjZXNzb3J5RXllc1wiLFxyXG5cdFx0XCJFYXJyaW5nc1wiOiBcImFjY2Vzc29yeUVhcnNcIixcclxuXHRcdC8vXCJSaW5nXCI6IFwiXCIsXHJcblxyXG5cdFx0Ly9cIlBlbmRhbnRcIjogXCJcIixcclxuXHRcdFwiRmFjZSBBY2Nlc3NvcnlcIjogXCJhY2Nlc3NvcnlGYWNlXCIsXHJcblx0XHQvL1wiQmVsdFwiOiBcIlwiLFxyXG5cdFx0Ly9cIk1lZGFsXCI6IFwiXCIsXHJcblx0XHQvL1wiU2hvdWxkZXIgQWNjZXNzb3J5XCI6IFwiXCIsXHJcblx0XHQvL1wiQmFkZ2VcIjogXCJcIixcclxuXHJcblx0XHQvL1wiRHJhZ29uIEVxdWlwbWVudFwiOiBcIlwiLFxyXG5cdFx0Ly9cIk1lY2hhbmljIEVxdWlwbWVudFwiOiBcIlwiLFxyXG5cdFx0Ly9cIlBldCBFcXVpcG1lbnRcIjogXCJcIixcclxuXHRcdC8vXCJBbmRyb2lkXCI6IFwiXCIsXHJcblx0XHQvL1wiTWVjaGFuaWNhbCBIZWFydFwiOiBcIlwiLFxyXG5cdFx0Ly9cIkJpdHNcIjogXCJcIixcclxuXHJcblx0XHRcIkZhY2VcIjogXCJGYWNlXCIsXHJcblx0XHRcIkhhaXJcIjogXCJIYWlyXCIsXHJcblx0fSxcclxufTtcclxuXHJcblJlc291cmNlTWFuYWdlci5leHRlcm5hbCA9IHtcclxuXHRlcXVpcDoge1xyXG5cdH0sXHJcbn07XHJcblxyXG5SZXNvdXJjZU1hbmFnZXIuZXF1aXBfbWFwID0ge1xyXG59O1xyXG5cclxuZm9yIChsZXQgaSBpbiBJdGVtVHlwZUluZm8uRXF1aXApIHtcclxuXHRsZXQgY2F0ZSA9IEl0ZW1UeXBlSW5mby5FcXVpcFtpXTtcclxuXHJcblx0UmVzb3VyY2VNYW5hZ2VyLmV4dGVybmFsLmVxdWlwW2NhdGVdID0gW107XHJcblx0UmVzb3VyY2VNYW5hZ2VyLmVxdWlwX21hcFtjYXRlXSA9IG51bGw7XHJcbn1cclxuZm9yIChsZXQgaSA9IDA7IGkgPCA5OyArK2kpIHtcclxuXHRsZXQgY2F0ZSA9IFwiRmFjZVwiICsgaTtcclxuXHRSZXNvdXJjZU1hbmFnZXIuZXh0ZXJuYWwuZXF1aXBbY2F0ZV0gPSBbXTtcclxuXHRSZXNvdXJjZU1hbmFnZXIuZXF1aXBfbWFwW2NhdGVdID0gbnVsbDtcclxufVxyXG5mb3IgKGxldCBpID0gMDsgaSA8IDg7ICsraSkge1xyXG5cdGxldCBjYXRlID0gXCJIYWlyXCIgKyBpO1xyXG5cdFJlc291cmNlTWFuYWdlci5leHRlcm5hbC5lcXVpcFtjYXRlXSA9IFtdO1xyXG5cdFJlc291cmNlTWFuYWdlci5lcXVpcF9tYXBbY2F0ZV0gPSBudWxsO1xyXG59XHJcblxyXG5hc3luYyBmdW5jdGlvbiBsb2FkX2V4dGVybmFsX3Jlc291cmNlKHVybCkge1xyXG5cdHVybCA9IHVybCB8fCBcIi9pdGVtcy5qc29uXCI7XHJcblx0bGV0IHJhdztcclxuXHJcblx0dHJ5IHtcclxuXHRcdHJhdyA9IFJlc291cmNlTWFuYWdlci5fZXh0ZXJuYWxfcmF3ID0gSlNPTi5wYXJzZShhd2FpdCAkZ2V0LmFzc2V0KFwiZXF1aXAuanNvblwiKSk7XHJcblx0XHRpZiAoIXJhdykge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0dGhyb3cgRXJyb3IoXCInL2VxdWlwJyBpcyBlbXB0eVwiKTtcclxuXHRcdH1cclxuXHR9XHJcblx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRyYXcgPSBSZXNvdXJjZU1hbmFnZXIuX2V4dGVybmFsX3JhdyA9IEpTT04ucGFyc2UoYXdhaXQgJGdldChcIi8vbGFicy5tYXBsZXN0b3J5LmlvL2FwaS9nbXMvbGF0ZXN0L2l0ZW0vY2F0ZWdvcnkvZXF1aXBcIikpO1xyXG5cdFx0aWYgKCFyYXcpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCByYXcubGVuZ3RoOyArK2kpIHtcclxuXHRcdGNvbnN0IGl0ZW0gPSByYXdbaV07XHJcblx0XHRjb25zdCBpZCA9IFN0cmluZyhpdGVtLmlkKS5wYWRTdGFydCg4LCBcIjBcIik7XHJcblx0XHRcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmICghKGl0ZW0udHlwZUluZm8gJiYgSXRlbVR5cGVJbmZvW2l0ZW0udHlwZUluZm8ub3ZlcmFsbENhdGVnb3J5XSkpIHtcclxuXHRcdFx0XHRjb250aW51ZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bGV0IGNseiA9IGl0ZW0udHlwZUluZm8ub3ZlcmFsbENhdGVnb3J5LnRvTG93ZXJDYXNlKCk7XHJcblx0XHRcdGxldCBjYXRlID0gSXRlbVR5cGVJbmZvW2l0ZW0udHlwZUluZm8ub3ZlcmFsbENhdGVnb3J5XVtpdGVtLnR5cGVJbmZvLnN1YkNhdGVnb3J5XTtcclxuXHRcdFx0aWYgKCFjYXRlKSB7XHJcblx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY2F0ZSA9PSBcIkZhY2VcIikge1xyXG5cdFx0XHRcdGNhdGUgKz0gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldEZhY2VDb2xvcihpZCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY2F0ZSA9PSBcIkhhaXJcIikge1xyXG5cdFx0XHRcdGNhdGUgKz0gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldEhhaXJDb2xvcihpZCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGxldCBpdCA9IHtcclxuXHRcdFx0XHRpZDogaWQsXHJcblx0XHRcdFx0bmFtZTogaXRlbS5uYW1lLFxyXG5cdFx0XHRcdGRlc2M6IGl0ZW0uZGVzYyxcclxuXHRcdFx0XHRjYXNoOiBpdGVtLmlzQ2FzaCA/IDEgOiAwLFxyXG5cdFx0XHRcdGljb246IHtcclxuXHRcdFx0XHRcdFwiXCI6IGAvL2xhYnMubWFwbGVzdG9yeS5pby9hcGkvZ21zL2xhdGVzdC9pdGVtLyR7aXRlbS5pZH0vaWNvbmAsXHJcblx0XHRcdFx0fSxcclxuXHRcdFx0fTtcclxuXHJcblx0XHRcdFJlc291cmNlTWFuYWdlci5leHRlcm5hbFtjbHpdW2NhdGVdLnB1c2goaXQpO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJleHRlcm5hbCByZXNvdXJjZTogaWQoXCIgKyBpZCArIFwiKVwiKTtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihleCk7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlX2V4dGVybmFsX2VxdWlwX2xpc3QoKSB7XHJcblx0Y29uc3QgdXJsID0gXCJodHRwczovL2xhYnMubWFwbGVzdG9yeS5pby9hcGkvZ21zL2xhdGVzdC9pdGVtL2NhdGVnb3J5L2VxdWlwXCI7XHJcblx0bG9hZF9leHRlcm5hbF9yZXNvdXJjZSh1cmwpLnRoZW4oKCkgPT4ge1xyXG5cdFx0X2NvbmNhdF9leHRlcm5hbF9yZXNvdXJjZShjYXRlZ29yeSwgb3JpZ2luX2RhdGEpO1xyXG5cdFx0Y29uY2F0X2V4dGVybmFsX3Jlc291cmNlID0gX2NvbmNhdF9leHRlcm5hbF9yZXNvdXJjZTtcclxuXHRcdGNvbnNvbGUubG9nKFwiZG9uZTogdXBkYXRlX2V4dGVybmFsX2VxdWlwX2xpc3RcIik7XHJcblx0fSk7XHJcbn1cclxuXHJcbmxldCBleHRlcm5hbF9yZXNvdXJjZV9wcm9taXNlID0gbG9hZF9leHRlcm5hbF9yZXNvdXJjZSgpO1xyXG5cclxud2luZG93LmNvbmNhdF9leHRlcm5hbF9yZXNvdXJjZSA9IF9jb25jYXRfZXh0ZXJuYWxfcmVzb3VyY2VfcDtcclxuXHJcbndpbmRvdy50cmlnZ2VyX3VwZGF0ZV9leHRlcm5hbF9lcXVpcF9saXN0ID0gZnVuY3Rpb24gKCkge1xyXG5cdGV4dGVybmFsX3Jlc291cmNlX3Byb21pc2UgPSBsb2FkX2V4dGVybmFsX3Jlc291cmNlKCk7XHJcblx0d2luZG93LmNvbmNhdF9leHRlcm5hbF9yZXNvdXJjZSA9IF9jb25jYXRfZXh0ZXJuYWxfcmVzb3VyY2VfcDtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gX2NvbmNhdF9leHRlcm5hbF9yZXNvdXJjZV9wKGNhdGVnb3J5LCBvcmlnaW5fZGF0YSkge1xyXG5cdGF3YWl0IGV4dGVybmFsX3Jlc291cmNlX3Byb21pc2U7XHJcblx0X2NvbmNhdF9leHRlcm5hbF9yZXNvdXJjZShjYXRlZ29yeSwgb3JpZ2luX2RhdGEpO1xyXG5cdGNvbmNhdF9leHRlcm5hbF9yZXNvdXJjZSA9IF9jb25jYXRfZXh0ZXJuYWxfcmVzb3VyY2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9jb25jYXRfZXh0ZXJuYWxfcmVzb3VyY2UoY2F0ZWdvcnksIG9yaWdpbl9kYXRhKSB7XHJcblx0dHJ5IHtcclxuXHRcdGNvbnN0IGxpc3QgPSBSZXNvdXJjZU1hbmFnZXIuZXh0ZXJuYWwuZXF1aXBbY2F0ZWdvcnldO1xyXG5cdFx0aWYgKCFsaXN0KSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGxldCBpZF9tYXAgPSBSZXNvdXJjZU1hbmFnZXIuZXF1aXBfbWFwW2NhdGVnb3J5XTtcclxuXHJcblx0XHRpZiAoIWlkX21hcCkge1xyXG5cdFx0XHRpZF9tYXAgPSBuZXcgTWFwKCk7XHJcblx0XHRcdFxyXG5cdFx0XHRvcmlnaW5fZGF0YS5mb3JFYWNoKGl0ZW0gPT4ge1xyXG5cdFx0XHRcdGlkX21hcC5zZXQoaXRlbS5pZCwgaXRlbSk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdFx0UmVzb3VyY2VNYW5hZ2VyLmVxdWlwX21hcFtjYXRlZ29yeV0gPSBpZF9tYXA7XHJcblx0XHR9XHJcblxyXG5cdFx0bGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7XHJcblx0XHRcdGxldCBpZCA9IGl0ZW0uaWQ7XHJcblx0XHRcdGlmICghaWRfbWFwLmhhcyhpZCkpIHtcclxuXHRcdFx0XHRpdGVtLiRmb3JlaWduID0gdHJ1ZTtcclxuXHRcdFx0XHRvcmlnaW5fZGF0YS5wdXNoKGl0ZW0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGxldCBvcmlfaXRlbSA9IGlkX21hcC5nZXQoaWQpO1xyXG5cdFx0XHRcdG9yaV9pdGVtLl9uYW1lID0gaXRlbS5uYW1lIHx8IFwiXCI7XHJcblx0XHRcdFx0b3JpX2l0ZW0uX2Rlc2MgPSBpdGVtLmRlc2MgfHwgXCJcIjtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cdGNhdGNoIChleCkge1xyXG5cdFx0Y29uc29sZS5lcnJvcihleCk7XHJcblx0XHRkZWJ1Z2dlcjtcclxuXHR9XHJcbn1cclxuXHJcbndpbmRvdy5sb2FkX2V4dGVybl9pdGVtX2RhdGEgPSBhc3luYyBmdW5jdGlvbiAoaWQpIHtcclxuXHRsZXQgX3JhdyA9IEpTT04ucGFyc2UoYXdhaXQgJGdldChgLy9sYWJzLm1hcGxlc3RvcnkuaW8vYXBpL2dtcy9sYXRlc3QvaXRlbS8ke2lkfWApKTtcclxuXHRsZXQgcmF3ID0ge307XHJcblxyXG5cdGxldCBkZWZhdWx0XyA9IF9yYXcuZnJhbWVCb29rcy5kZWZhdWx0ID8gX3Jhdy5mcmFtZUJvb2tzLmRlZmF1bHQuZnJhbWVzWzBdOm51bGw7XHJcblxyXG5cdGZvciAobGV0IGkgaW4gX3Jhdy5mcmFtZUJvb2tzKSB7XHJcblx0XHRsZXQgX2FjdCA9IF9yYXcuZnJhbWVCb29rc1tpXTtcclxuXHRcdGxldCBhY3QgPSBbXTtcclxuXHJcblx0XHRmb3IgKGxldCBqID0gMDsgaiA8IF9hY3QuZnJhbWVzLmxlbmd0aDsgKytqKSB7XHJcblx0XHRcdGxldCBmcmFtZSA9IF9hY3QuZnJhbWVzW2pdIHx8IGRlZmF1bHRfO1xyXG5cdFx0XHRpZiAoIWZyYW1lIHx8ICFmcmFtZS5lZmZlY3RzKSB7XHJcblx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdH1cclxuXHRcdFx0bGV0IF9mcmFncyA9IGZyYW1lLmVmZmVjdHM7XHJcblx0XHRcdGxldCBmcmFncyA9IHt9O1xyXG5cdFx0XHRmb3IgKGxldCBrIGluIF9mcmFncykge1xyXG5cdFx0XHRcdGxldCBfZnJhZyA9IF9mcmFnc1trXTtcclxuXHRcdFx0XHRpZiAoX2ZyYWcuaW1hZ2UpIHtcclxuXHRcdFx0XHRcdGZyYWdzW2tdID0ge1xyXG5cdFx0XHRcdFx0XHRcIlwiOiBcImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxcIiArIF9mcmFnLmltYWdlLFxyXG5cdFx0XHRcdFx0XHRcIm9yaWdpblwiOiBfZnJhZy5vcmlnaW5Pclplcm8gfHwgX2ZyYWcub3JpZ2luIHx8IF9mcmFnLmNlbnRlcixcclxuXHRcdFx0XHRcdFx0XCJtYXBcIjogX2ZyYWcubWFwT2Zmc2V0LFxyXG5cdFx0XHRcdFx0XHRcInpcIjogX2ZyYWcucG9zaXRpb25cclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRhY3Rbal0gPSBmcmFncztcclxuXHRcdH1cclxuXHJcblx0XHRyYXdbaV0gPSBhY3Q7XHJcblx0fVxyXG5cclxuXHRyYXcuaW5mbyA9IHtcclxuXHRcdGlzbG90OiBfcmF3Lm1ldGFJbmZvLmVxdWlwLmlzbG90LFxyXG5cdFx0dnNsb3Q6IF9yYXcubWV0YUluZm8uZXF1aXAudnNsb3QsXHJcblx0XHRpY29uOiBfcmF3Lm1ldGFJbmZvLmljb24gPyAoXCJkYXRhOmltYWdlL3BuZztiYXNlNjQsXCIgKyBfcmF3Lm1ldGFJbmZvLmljb24uaWNvblJhdykgOiBcIlwiLFxyXG5cdFx0Y2FzaDogKF9yYXcubWV0YUluZm8uY2FzaCAmJiBfcmF3Lm1ldGFJbmZvLmNhc2guY2FzaCkgPyAxIDogMCxcclxuXHR9O1xyXG5cclxuXHRyZXR1cm4gcmF3O1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///345\n')},358:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AddInitTask; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return InitAll; });\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(351);\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(402);\n/* harmony import */ var jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(403);\n/* harmony import */ var jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(404);\n/* harmony import */ var jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(405);\n/* harmony import */ var jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(406);\n/* harmony import */ var jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(407);\n/* harmony import */ var jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(408);\n/* harmony import */ var jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(410);\n/* harmony import */ var jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(411);\n/* harmony import */ var jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(412);\n/* harmony import */ var jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(413);\n/* harmony import */ var jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(414);\n/* harmony import */ var jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12__);\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(375);\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(_util_js__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(336);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(vue__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var vuex__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(359);\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvue__WEBPACK_IMPORTED_MODULE_14___default.a.config.productionTip = false;\r\nvue__WEBPACK_IMPORTED_MODULE_14___default.a.use(vuex__WEBPACK_IMPORTED_MODULE_15__[/* default */ "a"]);\r\n\r\nwindow.jQuery = jquery__WEBPACK_IMPORTED_MODULE_0___default.a;\r\nwindow.$ = jquery__WEBPACK_IMPORTED_MODULE_0___default.a;\r\n\r\nif (!window.onwheel) {\r\n\twindow.onwheel = function () {\r\n\t}\r\n}\r\n\r\nlet init_tasks = [];\r\n\r\nfunction AddInitTask(task) {\r\n\tinit_tasks.push(task);\r\n}\r\n\r\nfunction InitAll() {\r\n\tlet promise_list = init_tasks.map(f => f());\r\n\tinit_tasks = [];\r\n\tlet a = Promise.all(promise_list);\r\n\treturn a;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzU4LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2luaXQuanM/ZDk5ZSJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IGpRdWVyeSBmcm9tIFwianF1ZXJ5XCI7XHJcblxyXG5pbXBvcnQgXCJqcXVlcnktdWkvdGhlbWVzL2Jhc2UvY29yZS5jc3NcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3RoZW1lcy9iYXNlL3RoZW1lLmNzc1wiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdGhlbWVzL2Jhc2Uvc2VsZWN0YWJsZS5jc3NcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3RoZW1lcy9iYXNlL3NvcnRhYmxlLmNzc1wiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdGhlbWVzL2Jhc2UvZHJhZ2dhYmxlLmNzc1wiO1xyXG5cclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL2NvcmVcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL3dpZGdldHMvc2VsZWN0YWJsZVwiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdWkvd2lkZ2V0cy9zb3J0YWJsZVwiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdWkvd2lkZ2V0cy9kcmFnZ2FibGVcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL2Rpc2FibGUtc2VsZWN0aW9uXCI7XHJcbmltcG9ydCBcImpxdWVyeS11aS91aS9wb3NpdGlvblwiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdWkvZWZmZWN0XCI7XHJcblxyXG5pbXBvcnQgeyB9IGZyb20gXCIuL3V0aWwuanNcIjtcclxuXHJcbmltcG9ydCBWdWUgZnJvbSBcInZ1ZVwiO1xyXG5pbXBvcnQgVnVleCBmcm9tIFwidnVleFwiO1xyXG5cclxuVnVlLmNvbmZpZy5wcm9kdWN0aW9uVGlwID0gZmFsc2U7XHJcblZ1ZS51c2UoVnVleCk7XHJcblxyXG53aW5kb3cualF1ZXJ5ID0galF1ZXJ5O1xyXG53aW5kb3cuJCA9IGpRdWVyeTtcclxuXHJcbmlmICghd2luZG93Lm9ud2hlZWwpIHtcclxuXHR3aW5kb3cub253aGVlbCA9IGZ1bmN0aW9uICgpIHtcclxuXHR9XHJcbn1cclxuXHJcbmxldCBpbml0X3Rhc2tzID0gW107XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gQWRkSW5pdFRhc2sodGFzaykge1xyXG5cdGluaXRfdGFza3MucHVzaCh0YXNrKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEluaXRBbGwoKSB7XHJcblx0bGV0IHByb21pc2VfbGlzdCA9IGluaXRfdGFza3MubWFwKGYgPT4gZigpKTtcclxuXHRpbml0X3Rhc2tzID0gW107XHJcblx0bGV0IGEgPSBQcm9taXNlLmFsbChwcm9taXNlX2xpc3QpO1xyXG5cdHJldHVybiBhO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///358\n')},364:function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* unused harmony export ActionAnimationFrameData */\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ActionAnimation; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(332);\n\ufeff\r\n\r\n\r\n\r\nclass ActionAnimationFrameData {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.move = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded raw data\r\n\t * @param {ActionAnimationFrameData} raw\r\n\t * @param {string} action\r\n\t * @param {number} frame\r\n\t */\r\n\t_load(raw, action, frame) {\r\n\t\tthis._raw = raw;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = raw.delay;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tif (raw.move) {\r\n\t\t\tthis.move = new _math_js__WEBPACK_IMPORTED_MODULE_0__["Vec2"](raw.move.x, raw.move.y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.move = new _math_js__WEBPACK_IMPORTED_MODULE_0__["Vec2"](0, 0);\r\n\t\t}\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = raw.action || action;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = raw.frame || frame;\r\n\t}\r\n}\r\n\r\nclass ActionAnimation {\r\n\tconstructor(raw) {\r\n\t\t/** @returns {ActionAnimationFrameData[]} */\r\n\t\tthis.frames = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._action = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\r\n\t\t/** @type {number} this.delay = delay < 0 ? -delay:0; if (this.delay == 0) launch attack */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.loop = false;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\t_load(action) {\r\n\t\tthis._action = action;\r\n\t\tthis.frames = ActionAnimation.Adef[action];\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\treload(action) {\r\n\t\tthis.reset();\r\n\t\tthis._load(action);\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * update action delay, target.action, target.action_frame, target.tx, target.ty\r\n\t * @param {number} stamp\r\n\t * @param {CharacterRenderer} target\r\n\t */\r\n\tupdate(stamp, target) {\r\n\t\tif (!this.frames || !stamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst fdat = this.fdat;\r\n\t\tlet delay = 0;\r\n\r\n\t\tif (!fdat) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.time = this.time + stamp;\r\n\r\n\t\tif (fdat.delay < 0) {\r\n\t\t\tfdat.delay = -fdat.delay;\r\n\t\t}\r\n\r\n\t\tif (fdat.delay > 0) {\r\n\t\t\tdelay = fdat.delay;\r\n\t\t\tthis.delay = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelay = -fdat.delay;\r\n\t\t\tthis.delay = delay;\r\n\t\t}\r\n\r\n\t\tif (this.time > delay) {\r\n\t\t\tthis.frame = ++this.frame;\r\n\t\t\tthis.time = 0;\r\n\t\t}\r\n\r\n\t\t//translate target position\r\n\t\tif (fdat.move) {\r\n\t\t\ttarget.tx = -fdat.move.x * target.front;\r\n\t\t\ttarget.ty = fdat.move.y;//Y 軸相反\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\tif (this.isEnd()) {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// 改變 action & action_frame 會造成迴圈: this.reload(this._action)\r\n\t\tif (!target._ride_action) {\r\n\t\t\ttarget._action = fdat.action;\r\n\t\t}\r\n\t\ttarget._action_frame = fdat.frame;\r\n\r\n\t\tif (!this.frames || this.fdat == null) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t\telse if (!this.loop) {\r\n\t\t\tthis._is_end = false;\r\n\t\t}\r\n\t\tif (this.frames.length <= 1) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t}\r\n\r\n\tisEnd() {\r\n\t\treturn this._is_end;\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.frames.reduce((total, frame) => total + frame.delay, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * frame data\r\n\t * @returns {ActionAnimationFrameData}\r\n\t */\r\n\tget fdat() {\r\n\t\treturn this.frames[this.frame];\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\t/** @type {{[action:string]:ActionAnimationFrameData[]}} */\r\n\t\tlet raw = await $get.data(ActionAnimation._base_path);\r\n\r\n\t\tlet aadef = Object.assign({}, raw);\r\n\t\t\r\n\t\tdelete aadef[\'info\'];\r\n\r\n\t\tfor (let actName in aadef) {\r\n\t\t\tlet aa = aadef[actName];\r\n\t\t\taadef[actName] = Object.values(aa).map((_fdef, frame) => {\r\n\t\t\t\tlet fdef = new ActionAnimationFrameData();\r\n\t\t\t\tfdef._load(_fdef, actName, frame);\r\n\t\t\t\treturn fdef;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//action definition\r\n\t\tActionAnimation.Adef = aadef;\r\n\r\n\t\twindow.CharacterActionAnimationDefinition = aadef;\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\treturn "/Character/00002000";\r\n\t}\r\n}\r\n/**\r\n * action definition\r\n * @type {{[action:string]:ActionAnimationFrameData[]}}\r\n */\r\nActionAnimation.Adef = null;\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzY0LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUmVuZGVyZXIvQ2hhcmFjdGVyQWN0aW9uQW5pbWF0aW9uLmpzP2I2NjUiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IFZlYzIgfSBmcm9tIFwiLi4vbWF0aC5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBBY3Rpb25BbmltYXRpb25GcmFtZURhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmRlbGF5ID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge1ZlYzJ9ICovXHJcblx0XHR0aGlzLm1vdmUgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb24gPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5mcmFtZSA9IDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBmcm9tIGxvYWRlZCByYXcgZGF0YVxyXG5cdCAqIEBwYXJhbSB7QWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhfSByYXdcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGZyYW1lXHJcblx0ICovXHJcblx0X2xvYWQocmF3LCBhY3Rpb24sIGZyYW1lKSB7XHJcblx0XHR0aGlzLl9yYXcgPSByYXc7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmRlbGF5ID0gcmF3LmRlbGF5O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7VmVjMn0gKi9cclxuXHRcdGlmIChyYXcubW92ZSkge1xyXG5cdFx0XHR0aGlzLm1vdmUgPSBuZXcgVmVjMihyYXcubW92ZS54LCByYXcubW92ZS55KTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLm1vdmUgPSBuZXcgVmVjMigwLCAwKTtcclxuXHRcdH1cclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuYWN0aW9uID0gcmF3LmFjdGlvbiB8fCBhY3Rpb247XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmZyYW1lID0gcmF3LmZyYW1lIHx8IGZyYW1lO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEFjdGlvbkFuaW1hdGlvbiB7XHJcblx0Y29uc3RydWN0b3IocmF3KSB7XHJcblx0XHQvKiogQHJldHVybnMge0FjdGlvbkFuaW1hdGlvbkZyYW1lRGF0YVtdfSAqL1xyXG5cdFx0dGhpcy5mcmFtZXMgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5fYWN0aW9uID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMudGltZSA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gdGhpcy5kZWxheSA9IGRlbGF5IDwgMCA/IC1kZWxheTowOyBpZiAodGhpcy5kZWxheSA9PSAwKSBsYXVuY2ggYXR0YWNrICovXHJcblx0XHR0aGlzLmRlbGF5ID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLmxvb3AgPSBmYWxzZTtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLl9pc19lbmQgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGZyb20gbG9hZGVkIGRhdGFcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICovXHJcblx0X2xvYWQoYWN0aW9uKSB7XHJcblx0XHR0aGlzLl9hY3Rpb24gPSBhY3Rpb247XHJcblx0XHR0aGlzLmZyYW1lcyA9IEFjdGlvbkFuaW1hdGlvbi5BZGVmW2FjdGlvbl07XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBmcm9tIGxvYWRlZCBkYXRhXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvblxyXG5cdCAqL1xyXG5cdHJlbG9hZChhY3Rpb24pIHtcclxuXHRcdHRoaXMucmVzZXQoKTtcclxuXHRcdHRoaXMuX2xvYWQoYWN0aW9uKTtcclxuXHR9XHJcblxyXG5cdHJlc2V0KCkge1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cdFx0dGhpcy5faXNfZW5kID0gZmFsc2U7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiB1cGRhdGUgYWN0aW9uIGRlbGF5LCB0YXJnZXQuYWN0aW9uLCB0YXJnZXQuYWN0aW9uX2ZyYW1lLCB0YXJnZXQudHgsIHRhcmdldC50eVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyUmVuZGVyZXJ9IHRhcmdldFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCwgdGFyZ2V0KSB7XHJcblx0XHRpZiAoIXRoaXMuZnJhbWVzIHx8ICFzdGFtcCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCBmZGF0ID0gdGhpcy5mZGF0O1xyXG5cdFx0bGV0IGRlbGF5ID0gMDtcclxuXHJcblx0XHRpZiAoIWZkYXQpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMudGltZSA9IHRoaXMudGltZSArIHN0YW1wO1xyXG5cclxuXHRcdGlmIChmZGF0LmRlbGF5IDwgMCkge1xyXG5cdFx0XHRmZGF0LmRlbGF5ID0gLWZkYXQuZGVsYXk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGZkYXQuZGVsYXkgPiAwKSB7XHJcblx0XHRcdGRlbGF5ID0gZmRhdC5kZWxheTtcclxuXHRcdFx0dGhpcy5kZWxheSA9IDA7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVsYXkgPSAtZmRhdC5kZWxheTtcclxuXHRcdFx0dGhpcy5kZWxheSA9IGRlbGF5O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLnRpbWUgPiBkZWxheSkge1xyXG5cdFx0XHR0aGlzLmZyYW1lID0gKyt0aGlzLmZyYW1lO1xyXG5cdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vdHJhbnNsYXRlIHRhcmdldCBwb3NpdGlvblxyXG5cdFx0aWYgKGZkYXQubW92ZSkge1xyXG5cdFx0XHR0YXJnZXQudHggPSAtZmRhdC5tb3ZlLnggKiB0YXJnZXQuZnJvbnQ7XHJcblx0XHRcdHRhcmdldC50eSA9IGZkYXQubW92ZS55Oy8vWSDou7jnm7jlj41cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0YXJnZXQudHggPSAwO1xyXG5cdFx0XHR0YXJnZXQudHkgPSAwO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNFbmQoKSkge1xyXG5cdFx0XHR0YXJnZXQudHggPSAwO1xyXG5cdFx0XHR0YXJnZXQudHkgPSAwO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvLyDmlLnoroogYWN0aW9uICYgYWN0aW9uX2ZyYW1lIOacg+mAoOaIkOi/tOWciDogdGhpcy5yZWxvYWQodGhpcy5fYWN0aW9uKVxyXG5cdFx0aWYgKCF0YXJnZXQuX3JpZGVfYWN0aW9uKSB7XHJcblx0XHRcdHRhcmdldC5fYWN0aW9uID0gZmRhdC5hY3Rpb247XHJcblx0XHR9XHJcblx0XHR0YXJnZXQuX2FjdGlvbl9mcmFtZSA9IGZkYXQuZnJhbWU7XHJcblxyXG5cdFx0aWYgKCF0aGlzLmZyYW1lcyB8fCB0aGlzLmZkYXQgPT0gbnVsbCkge1xyXG5cdFx0XHR0aGlzLl9pc19lbmQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoIXRoaXMubG9vcCkge1xyXG5cdFx0XHR0aGlzLl9pc19lbmQgPSBmYWxzZTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmZyYW1lcy5sZW5ndGggPD0gMSkge1xyXG5cdFx0XHR0aGlzLl9pc19lbmQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0aXNFbmQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faXNfZW5kO1xyXG5cdH1cclxuXHJcblx0Z2V0VG90YWxUaW1lKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZnJhbWVzLnJlZHVjZSgodG90YWwsIGZyYW1lKSA9PiB0b3RhbCArIGZyYW1lLmRlbGF5LCAwKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGZyYW1lIGRhdGFcclxuXHQgKiBAcmV0dXJucyB7QWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhfVxyXG5cdCAqL1xyXG5cdGdldCBmZGF0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZnJhbWVzW3RoaXMuZnJhbWVdO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGFzeW5jIEluaXQoKSB7XHJcblx0XHQvKiogQHR5cGUge3tbYWN0aW9uOnN0cmluZ106QWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhW119fSAqL1xyXG5cdFx0bGV0IHJhdyA9IGF3YWl0ICRnZXQuZGF0YShBY3Rpb25BbmltYXRpb24uX2Jhc2VfcGF0aCk7XHJcblxyXG5cdFx0bGV0IGFhZGVmID0gT2JqZWN0LmFzc2lnbih7fSwgcmF3KTtcclxuXHRcdFxyXG5cdFx0ZGVsZXRlIGFhZGVmWydpbmZvJ107XHJcblxyXG5cdFx0Zm9yIChsZXQgYWN0TmFtZSBpbiBhYWRlZikge1xyXG5cdFx0XHRsZXQgYWEgPSBhYWRlZlthY3ROYW1lXTtcclxuXHRcdFx0YWFkZWZbYWN0TmFtZV0gPSBPYmplY3QudmFsdWVzKGFhKS5tYXAoKF9mZGVmLCBmcmFtZSkgPT4ge1xyXG5cdFx0XHRcdGxldCBmZGVmID0gbmV3IEFjdGlvbkFuaW1hdGlvbkZyYW1lRGF0YSgpO1xyXG5cdFx0XHRcdGZkZWYuX2xvYWQoX2ZkZWYsIGFjdE5hbWUsIGZyYW1lKTtcclxuXHRcdFx0XHRyZXR1cm4gZmRlZjtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly9hY3Rpb24gZGVmaW5pdGlvblxyXG5cdFx0QWN0aW9uQW5pbWF0aW9uLkFkZWYgPSBhYWRlZjtcclxuXHJcblx0XHR3aW5kb3cuQ2hhcmFjdGVyQWN0aW9uQW5pbWF0aW9uRGVmaW5pdGlvbiA9IGFhZGVmO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL0NoYXJhY3Rlci8wMDAwMjAwMFwiO1xyXG5cdH1cclxufVxyXG4vKipcclxuICogYWN0aW9uIGRlZmluaXRpb25cclxuICogQHR5cGUge3tbYWN0aW9uOnN0cmluZ106QWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhW119fVxyXG4gKi9cclxuQWN0aW9uQW5pbWF0aW9uLkFkZWYgPSBudWxsO1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///364\n')},375:function(module,exports){eval('\r\nwindow.DownloadData = (function () {\r\n\tlet a = document.createElement("a");\r\n\tdocument.body.appendChild(a);\r\n\ta.style = "display: none";\r\n\ta.target = "_blank";\r\n\treturn function (text, type, fileName) {\r\n\t\tlet blob = new Blob([text], { type: type || "octet/stream" });\r\n\t\tlet url = window.URL.createObjectURL(blob);\r\n\t\tif (fileName && fileName != "") {\r\n\t\t\ta.href = url;\r\n\t\t\ta.download = fileName;\r\n\t\t\ta.click();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//a.href = url;\r\n\t\t\t//a.click();\r\n\t\t\twindow.open(url, \'_blank\');\r\n\t\t}\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n}());\r\n\r\nwindow.SelectText = function (elem) {\r\n\tvar range, selection;\r\n\r\n\tif (document.body.createTextRange) {\r\n\t\trange = document.body.createTextRange();\r\n\t\trange.moveToElementText(elem);\r\n\t\trange.select();\r\n\t}\r\n\telse if (window.getSelection) {\r\n\t\tselection = window.getSelection();\r\n\t\trange = document.createRange();\r\n\t\trange.selectNodeContents(elem);\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\t}\r\n}\r\nwindow.copyToClipboard = function (text) {\r\n\tvar $temp = $("<input>");\r\n\t$("body").append($temp);\r\n\t$temp.val(text).select();\r\n\tdocument.execCommand("copy");\r\n\t$temp.remove();\r\n}\r\n\r\n/**\r\n * disable textNode "#text"\r\n * @param {string} xml - xml\r\n * @param {string[]=} arrayTags - optional\r\n * @returns {object}\r\n */\r\nfunction parseXml(xml, arrayTags) {\r\n\tvar dom = null;\r\n\tif (window.DOMParser) {\r\n\t\tdom = (new DOMParser()).parseFromString(xml, "text/xml");\r\n\t}\r\n\telse if (window.ActiveXObject) {\r\n\t\tdom = new ActiveXObject(\'Microsoft.XMLDOM\');\r\n\t\tdom.async = false;\r\n\t\tif (!dom.loadXML(xml)) {\r\n\t\t\tthrow dom.parseError.reason + " " + dom.parseError.srcText;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthrow "cannot parse xml string!";\r\n\t}\r\n\r\n\tfunction isArray(o) {\r\n\t\treturn Object.prototype.toString.apply(o) === \'[object Array]\';\r\n\t}\r\n\r\n\tfunction parseNode(xmlNode, result) {\r\n\t\tif (xmlNode.nodeName == "#text" && xmlNode.nodeValue.trim() == "") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar jsonNode = {};\r\n\t\tvar existing = result[xmlNode.nodeName];\r\n\t\tif (existing) {\r\n\t\t\tif (!isArray(existing)) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [existing, jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName].push(jsonNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (arrayTags && arrayTags.indexOf(xmlNode.nodeName) != -1) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName] = jsonNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (xmlNode.attributes) {\r\n\t\t\tvar length = xmlNode.attributes.length;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tvar attribute = xmlNode.attributes[i];\r\n\t\t\t\tjsonNode[attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar length = xmlNode.childNodes.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tparseNode(xmlNode.childNodes[i], jsonNode);\r\n\t\t}\r\n\t}\r\n\r\n\tvar result = {};\r\n\tif (dom.childNodes.length) {\r\n\t\tparseNode(dom.childNodes[0], result);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzc1LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWwuanM/ZTBlYiJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxud2luZG93LkRvd25sb2FkRGF0YSA9IChmdW5jdGlvbiAoKSB7XHJcblx0bGV0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpO1xyXG5cdGEuc3R5bGUgPSBcImRpc3BsYXk6IG5vbmVcIjtcclxuXHRhLnRhcmdldCA9IFwiX2JsYW5rXCI7XHJcblx0cmV0dXJuIGZ1bmN0aW9uICh0ZXh0LCB0eXBlLCBmaWxlTmFtZSkge1xyXG5cdFx0bGV0IGJsb2IgPSBuZXcgQmxvYihbdGV4dF0sIHsgdHlwZTogdHlwZSB8fCBcIm9jdGV0L3N0cmVhbVwiIH0pO1xyXG5cdFx0bGV0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xyXG5cdFx0aWYgKGZpbGVOYW1lICYmIGZpbGVOYW1lICE9IFwiXCIpIHtcclxuXHRcdFx0YS5ocmVmID0gdXJsO1xyXG5cdFx0XHRhLmRvd25sb2FkID0gZmlsZU5hbWU7XHJcblx0XHRcdGEuY2xpY2soKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQvL2EuaHJlZiA9IHVybDtcclxuXHRcdFx0Ly9hLmNsaWNrKCk7XHJcblx0XHRcdHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycpO1xyXG5cdFx0fVxyXG5cdFx0d2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuXHR9O1xyXG59KCkpO1xyXG5cclxud2luZG93LlNlbGVjdFRleHQgPSBmdW5jdGlvbiAoZWxlbSkge1xyXG5cdHZhciByYW5nZSwgc2VsZWN0aW9uO1xyXG5cclxuXHRpZiAoZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UpIHtcclxuXHRcdHJhbmdlID0gZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UoKTtcclxuXHRcdHJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KGVsZW0pO1xyXG5cdFx0cmFuZ2Uuc2VsZWN0KCk7XHJcblx0fVxyXG5cdGVsc2UgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHtcclxuXHRcdHNlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcclxuXHRcdHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTtcclxuXHRcdHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhlbGVtKTtcclxuXHRcdHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcclxuXHRcdHNlbGVjdGlvbi5hZGRSYW5nZShyYW5nZSk7XHJcblx0fVxyXG59XHJcbndpbmRvdy5jb3B5VG9DbGlwYm9hcmQgPSBmdW5jdGlvbiAodGV4dCkge1xyXG5cdHZhciAkdGVtcCA9ICQoXCI8aW5wdXQ+XCIpO1xyXG5cdCQoXCJib2R5XCIpLmFwcGVuZCgkdGVtcCk7XHJcblx0JHRlbXAudmFsKHRleHQpLnNlbGVjdCgpO1xyXG5cdGRvY3VtZW50LmV4ZWNDb21tYW5kKFwiY29weVwiKTtcclxuXHQkdGVtcC5yZW1vdmUoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGRpc2FibGUgdGV4dE5vZGUgXCIjdGV4dFwiXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSB4bWwgLSB4bWxcclxuICogQHBhcmFtIHtzdHJpbmdbXT19IGFycmF5VGFncyAtIG9wdGlvbmFsXHJcbiAqIEByZXR1cm5zIHtvYmplY3R9XHJcbiAqL1xyXG5mdW5jdGlvbiBwYXJzZVhtbCh4bWwsIGFycmF5VGFncykge1xyXG5cdHZhciBkb20gPSBudWxsO1xyXG5cdGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7XHJcblx0XHRkb20gPSAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoeG1sLCBcInRleHQveG1sXCIpO1xyXG5cdH1cclxuXHRlbHNlIGlmICh3aW5kb3cuQWN0aXZlWE9iamVjdCkge1xyXG5cdFx0ZG9tID0gbmV3IEFjdGl2ZVhPYmplY3QoJ01pY3Jvc29mdC5YTUxET00nKTtcclxuXHRcdGRvbS5hc3luYyA9IGZhbHNlO1xyXG5cdFx0aWYgKCFkb20ubG9hZFhNTCh4bWwpKSB7XHJcblx0XHRcdHRocm93IGRvbS5wYXJzZUVycm9yLnJlYXNvbiArIFwiIFwiICsgZG9tLnBhcnNlRXJyb3Iuc3JjVGV4dDtcclxuXHRcdH1cclxuXHR9XHJcblx0ZWxzZSB7XHJcblx0XHR0aHJvdyBcImNhbm5vdCBwYXJzZSB4bWwgc3RyaW5nIVwiO1xyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaXNBcnJheShvKSB7XHJcblx0XHRyZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5hcHBseShvKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHBhcnNlTm9kZSh4bWxOb2RlLCByZXN1bHQpIHtcclxuXHRcdGlmICh4bWxOb2RlLm5vZGVOYW1lID09IFwiI3RleHRcIiAmJiB4bWxOb2RlLm5vZGVWYWx1ZS50cmltKCkgPT0gXCJcIikge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGpzb25Ob2RlID0ge307XHJcblx0XHR2YXIgZXhpc3RpbmcgPSByZXN1bHRbeG1sTm9kZS5ub2RlTmFtZV07XHJcblx0XHRpZiAoZXhpc3RpbmcpIHtcclxuXHRcdFx0aWYgKCFpc0FycmF5KGV4aXN0aW5nKSkge1xyXG5cdFx0XHRcdHJlc3VsdFt4bWxOb2RlLm5vZGVOYW1lXSA9IFtleGlzdGluZywganNvbk5vZGVdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJlc3VsdFt4bWxOb2RlLm5vZGVOYW1lXS5wdXNoKGpzb25Ob2RlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmIChhcnJheVRhZ3MgJiYgYXJyYXlUYWdzLmluZGV4T2YoeG1sTm9kZS5ub2RlTmFtZSkgIT0gLTEpIHtcclxuXHRcdFx0XHRyZXN1bHRbeG1sTm9kZS5ub2RlTmFtZV0gPSBbanNvbk5vZGVdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJlc3VsdFt4bWxOb2RlLm5vZGVOYW1lXSA9IGpzb25Ob2RlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHhtbE5vZGUuYXR0cmlidXRlcykge1xyXG5cdFx0XHR2YXIgbGVuZ3RoID0geG1sTm9kZS5hdHRyaWJ1dGVzLmxlbmd0aDtcclxuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG5cdFx0XHRcdHZhciBhdHRyaWJ1dGUgPSB4bWxOb2RlLmF0dHJpYnV0ZXNbaV07XHJcblx0XHRcdFx0anNvbk5vZGVbYXR0cmlidXRlLm5vZGVOYW1lXSA9IGF0dHJpYnV0ZS5ub2RlVmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgbGVuZ3RoID0geG1sTm9kZS5jaGlsZE5vZGVzLmxlbmd0aDtcclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0cGFyc2VOb2RlKHhtbE5vZGUuY2hpbGROb2Rlc1tpXSwganNvbk5vZGUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0dmFyIHJlc3VsdCA9IHt9O1xyXG5cdGlmIChkb20uY2hpbGROb2Rlcy5sZW5ndGgpIHtcclxuXHRcdHBhcnNlTm9kZShkb20uY2hpbGROb2Rlc1swXSwgcmVzdWx0KTtcclxuXHR9XHJcblxyXG5cdHJldHVybiByZXN1bHQ7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///375\n')}}]);