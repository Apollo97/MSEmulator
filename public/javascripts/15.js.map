{"version":3,"sources":["webpack:///./src/game/Animation.js","webpack:///./src/game/Renderer/CharacterRenderer.js","webpack:///./src/init.js","webpack:///./src/game/Sprite.js","webpack:///./public/javascripts/resource.js","webpack:///./src/game/Renderer/CharacterActionAnimation.js","webpack:///./src/util.js"],"names":["window","m_draw_animation_texture_info","IAnimation","[object Object]","raw","url","this","_raw","_url","Object","defineProperties","value","frame","time","delta","textures","is_loop","is_end","reduce","pv","cv","delay","newAnim","constructor","Error","stamp","texture","AnimationBase","super","i","_Sprite_js__WEBPACK_IMPORTED_MODULE_2__","isLoaded","__loadTexture","fc","length","reset","renderer","x","y","angle","flip","drawRotaGraph","Animation","draw","_draw_and_preload","zMap","sMap","FragmentTexture","_Sprite_js__WEBPACK_IMPORTED_MODULE_5__","full_path","origin","__proto__","_math_js__WEBPACK_IMPORTED_MODULE_6__","prototype","map","relative","calcRelative","_calcRelative","filter","_IRenderer_js__WEBPACK_IMPORTED_MODULE_4__","opacity","visible","_slot","_place","classList","z","not_value","console","error","order","TypeError","empty","brow","neck","navel","hand","handMove","_earBelowHead","earBelowHead","_earOverHead","earOverHead","that","base","anchor","minus","plus","chara","body","head","_getRelativeFunction","isHasAnchor","isAnchorNeck","_calcRelative_neck","isAnchorBrow","_calcRelative_brow","isAnchorNavel","slots","_getOrigin","_calcRelative_navel","isAnchorHand","_calcRelative_hand","isAnchorHandMove","lastIndexOf","_calcRelative_handMove_lHand","_calcRelative_handMove","_calcRelativeEmpty","_anchor","fragments","arm","getTexture","tamingMob","adj_pos","globalAlpha","isEmpty","drawGraph2","ctx","toString","BodyFragmentTexture","update","hideBody","HairFragmentTexture","args","graph2","graph3","_render","ItemEffectAnimation","_Animation__WEBPACK_IMPORTED_MODULE_2__","defineProperty","__getAttr","load","attr","defVal","actionExceptRotation","oy","height","ItemEffect","animation","action","fixed","enable","itemEffectList","_list","$get","list","clear","forEach","id","add","parseInt","ex","equipID","Number","has","eff","data","_load","render","front","__construct","join","Set","CharacterFragmentBase","CharacterBodyFragment","getFrameTexture","action_frame","CharacterFaceFragment","emotion_frame","emotion","CharacterTamingMobFragment","_action_frame","_ride_action","EquipImageFilter","equip","hue","j","k","ft","sat","bri","contrast","ICharacterAppearanceBase","CharacterAppearanceBase","effect","_onload","categoryInfo","slot_order","islot","vslot","toJSON","__onload","func","call","cateInfo","use_category","_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__","isEquipExist","getItem","load_extern_item_data","__load_slot","__load_fragments","then","a","FragmentConstructor","action_list","keys","_raw_textures","_base_path","__load_frame_textures","fragment_textures","place","frag","__load_place_textures","path","FragmentTextureConstructor","slot","info","islots","match","vslots","icon","getIconUrl","iconRaw","getIconRawUrl","_animation_type","CharacterAppearance","d","isSafeInteger","CharacterEquip","CharacterHeadBase","CharacterHair","CharacterFaceBase","face","_info","FragmentType","elfEarFragment","lefEarFragment","highlefEarFragment","ear","lefEar","highlefEar","elfEar","slice","type","actionMap","characterAction","emotionMap","characterEmotion","tm","Math","trunc","CharacterSlots","_ordered_slot","hair","_hair2","_hairMix2","_hair3","_hairMix3","cap","accessoryFace","accessoryEyes","accessoryEars","coat","longcoat","pants","shoes","glove","cape","shield","weapon","configurable","writable","enumerable","get","_hair","set","hairColor2","hairMix2","hairColor3","hairMix3","color","getColorHairID","undefined","getHairColor","hc2Id","$promise_hair2","__loadColoredHair","hair2","Promise","resolve","item","ori","hc3Id","$promise_hair3","hair3","loadedEquip","alert","_unload","warn","slotName","push","ha","enumerate_equip","CharacterChangeLog","useEquip","unuseEquip","weaponType","CharacterAnimationBase","_$dirty","job","subJob","actani","_CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__","speed","fixed_speed","pause","_action","_emotion","_emotion_frame","_emotion_time","_emotion_frame_sequence","__require_update","__frag_list","$$changeLog","name","nc","tasks","count","getFrameCount","_isLoaded_or_doload","$promise","all","act","_act","reload","action_frame_count","emo","circularSequence","emotion_frame_count","random","next","f","emotion_time","emotion_delay","getDelay","_stamp","getSpeed","isEnd","loop","_update","__update_frag_list","pushGlobalAlpha","__draw_list","popGlobalAlpha","pushMatrix","translate","rotate","m_a","scale","popMatrix","__add_equip_to_frag_list","is_back","fts","startsWith","__add_frag_to_list","ae","_calcBoundBox","left","top","right","bottom","x0","y0","x1","width","y1","min","max","_boundBox","obj","CharacterRenderer","tx","ty","__load_task","result","Init","reverse","use","initAnimation","waitLoaded","_draw","__forceUpdate","_waitFrameTexturesLoaded","category","getJobWeaponCategory","isCashWeapon","task","_use","_unuse","code","es","split","_clear","v","indexOf","ss","cate","h2","h3","hc","c2","m2","c3","m3","hairMix4","apply","isFinite","hairColor","col","faceColor","getFaceColor","getColorFaceID","changeLog","unuse","genCode","_stringify","link","enumerate","log","animationName","itemList","JSON","stringify","values","transformItemData","encodeURI","Boolean","region","version","__v","m","toUpperCase","itemId","saturation","strNum","brightness","alpha","toFixed","val","open","_outlink","__texture_to_base64","frag_list","file_name","svg","clz","DownloadData","filename","bound","size","$swapCanvas","c2w","_ctx2","canvas","c2h","base64","toDataURL","elem","document","createElement","download","href","appendChild","click","removeChild","$src","src","reject","xhr","XMLHttpRequest","onload","reader","FileReader","onloadend","onerror","ev","readAsDataURL","response","responseType","send","_init_js__WEBPACK_IMPORTED_MODULE_1__","vue__WEBPACK_IMPORTED_MODULE_14___default","config","productionTip","vuex__WEBPACK_IMPORTED_MODULE_15__","jQuery","jquery__WEBPACK_IMPORTED_MODULE_0___default","$","onwheel","init_tasks","AddInitTask","InitAll","SpriteBase","_Engine_js__WEBPACK_IMPORTED_MODULE_2__","__w","__h","isTexture","hasOwnProperty","__isEmpty","group","groupEnd","_order","defaultValue","propertyName","converter","_engine","drawGraph","Sprite","_get","_math_js__WEBPACK_IMPORTED_MODULE_0__","w","h","save","rect","clip","draw2","restore","sw","sh","sx","_drawImage","sy","drawPattern","drawHorizontalPattern","drawVerticalPattern","_drawPattern","_drawHorizontalPattern","_drawVerticalPattern","$failed_urls","$archive","character_emotion_list","character_action_list","ItemCategoryInfo","id_prefix","imgDir","listPath","categoryName","stringPath","dataDir","stringDir","iconPath","iconRawPath","s","results","padStart","assign","desc","DATA_TAG","DATA_VERSION","_id","$ItemCategoryInfo","Equip","Consume","Etc","Install","Cash","typeName","0","1","2","3","4","typeId","0000","0001","0002","0003","0004","0100","0101","0102","0103","0104","0105","0106","0107","0108","0109","0110","0121","0122","0123","0124","0125","0126","0127","0128","0130","0131","0132","0133","0134","013526","013530","0136","0137","0138","0140","0141","0142","0143","0144","0145","0146","0147","0148","0149","0150","0151","0152","0153","0154","0155","0156","0157","0158","0170","019","0301","_categoryList","info_map","cat","key","ResourceManager","dp","equip_map","$setValue","parse","timeout","status","responseText","ontimeout","e","onabort","root_path","$ROOT_PATH","archive","failed_urls","endsWith","ps","target","lastIndex","origin_value","$getValue","$ResourceManager","symbol_isPack","Symbol","url_startsWith_protocol","RegExp","test","bind","_setValueByPath","is_pack","_getValueFromArchiveByPath","_path","_getDataPathByUrl","$getValueAsync","async","pack","packUrl","jsonText","packSync","dataUrl","dataSync","listUrl","listSync","imageUrl","soundMp3Url","soundWavUrl","assetUrl","asset","ItemAttrNormalize","gender","g","_equip","regexp_getHairStyleID","regexp_getFaceStyleID","regexp_getHairColor","regexp_getFaceColor","CharacterRenderConfig","style","id_1","id_2","String","ItemTypeInfo","Hat","Cape","Top","Overall","Glove","Bottom","Shield","Shoes","Eye Decoration","Earrings","Face Accessory","Face","Hair","external","load_external_resource","_external_raw","typeInfo","overallCategory","toLowerCase","subCategory","it","cash","isCash","","external_resource_promise","_concat_external_resource_p","origin_data","_concat_external_resource","concat_external_resource","id_map","Map","ori_item","_name","_desc","$foreign","trigger_update_external_equip_list","default_","frameBooks","default","frames","effects","_frags","frags","_frag","image","originOrZero","center","mapOffset","position","metaInfo","ActionAnimationFrameData","move","ActionAnimation","_is_end","Adef","fdat","total","aadef","actName","aa","_fdef","fdef","CharacterActionAnimationDefinition","text","fileName","blob","Blob","URL","createObjectURL","revokeObjectURL","SelectText","range","selection","createTextRange","moveToElementText","select","getSelection","createRange","selectNodeContents","removeAllRanges","addRange","copyToClipboard","$temp","append","execCommand","remove"],"mappings":"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","file":"15.js","sourcesContent":["﻿\r\nimport { Vec2 } from \"./math.js\";\r\nimport { IGraph, IRenderer } from \"./IRenderer.js\";\r\n\r\nimport { Sprite } from \"./Sprite.js\";\r\n\r\n\r\nwindow.m_draw_animation_texture_info = false;\r\n\r\nclass IAnimation {\r\n\tconstructor(raw, url) {\r\n\t\tthis._raw = null;\r\n\t\tthis._url = null;\r\n\t\t\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t_raw: {\r\n\t\t\t\tvalue: raw\r\n\t\t\t},\r\n\t\t\t_url: {\r\n\t\t\t\tvalue: url\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** elapsed time */\r\n\t\tthis.delta = 0;\r\n\r\n\t\t/** @type {Sprite[]} */\r\n\t\tthis.textures = [];\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_loop = true;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_end = false;\r\n\r\n\t\tif (!raw && !this._url) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.textures.reduce((pv, cv) => pv + cv.delay, 0);\r\n\t}\r\n\t\r\n\tclone() {\r\n\t\tlet newAnim = new this.constructor(this._raw, this._url);\r\n\t\tnewAnim.textures = this.textures;\r\n\t\treturn newAnim;\r\n\t}\r\n\t\r\n\tload() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/** reset frame */\r\n\t_resetFrame() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t}\r\n\r\n\t/** restart */\r\n\treset() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t\tthis.is_end = false;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * remove at nextStep\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.is_loop = false;//防止重複\r\n\t\tthis.is_end = true;\r\n\t}\r\n}\r\n\r\n/**\r\n * process animation\r\n */\r\nexport class AnimationBase extends IAnimation {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {!string} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t}\r\n\r\n\tload() {\r\n\t\tif (!this._raw) {\r\n\t\t\t//this._raw = await $get.data(this._url);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i in this._raw; ++i) {\r\n\t\t\t//let url = this._url + \"/\" + i;\r\n\r\n\t\t\tlet texture = new Sprite(this._raw[i]);\r\n\r\n\t\t\t//texture._url = url;\r\n\r\n\t\t\tthis.textures[i] = texture;\r\n\t\t}\r\n\t\t\r\n\t\tif (this.textures[0]) {\r\n\t\t\tif (!this.textures[0].isLoaded()) {\r\n\t\t\t\tthis.textures[0].__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tisEnd() {\r\n\t\treturn this.is_end;\r\n\t}\r\n\r\n\t/**\r\n\t * aways loop\r\n\t * @param {number} stamp\r\n\t */\r\n\t_update(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = ++this.frame % fc;\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t\t//this.frame = Math.trunc(this.time / 1000) % fc;\r\n\t\t}\r\n\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = this.frame + 1;\r\n\t\t\t\tif (this.frame >= fc) {\r\n\t\t\t\t\tif (this.is_loop) {\r\n\t\t\t\t\t\tthis.reset();//make loop\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t//防止錯誤\r\n\t\t\t\t\t\tthis.frame = fc - 1;//this._resetFrame();\r\n\r\n\t\t\t\t\t\tthis.is_end = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw(renderer, x, y, angle, flip) {\r\n\t\tlet texture = this.texture;\r\n\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this.textures[this.frame];\r\n\t}\r\n}\r\n\r\n/**\r\n * animation rendering\r\n */\r\nexport class Animation extends AnimationBase {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\tthis.draw = this._draw_and_preload;\r\n\t}\r\n\r\n\t/**\r\n\t * draw and load next frame\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\t_draw_and_preload(renderer, x, y, angle, flip) {\r\n\t\tlet frame;\r\n\r\n\t\t// if current frame is not loaded then render prev frame\r\n\t\tfor (frame = this.frame; frame >= 0; --frame) {\r\n\t\t\tlet texture = this.textures[frame];\r\n\r\n\t\t\tif (texture.isLoaded()) {\r\n\t\t\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//preload next frame\r\n\t\tlet texture = this.textures[++frame];\r\n\t\tif (texture) {//if frame < this.textures.length\r\n\t\t\tif (!texture.isLoaded()) {\r\n\t\t\t\ttexture.__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {//if all testure are loaded\r\n\t\t\tdelete this.draw;\r\n\t\t}\r\n\t}\r\n}\r\n","﻿\r\nimport { CharacterRenderConfig, ItemCategoryInfo, ResourceManager } from '../../../public/javascripts/resource.js';\r\nimport { AddInitTask } from \"../../init.js\";\r\nimport { Animation } from \"../Animation\";\r\nimport { engine } from '../Engine.js';\r\nimport { IRenderer, ImageFilter } from '../IRenderer.js';\r\nimport { Sprite, SpriteBase } from '../Sprite.js';\r\nimport { Rectangle, Vec2 } from '../math.js';\r\nimport { ActionAnimation } from './CharacterActionAnimation.js';\r\n\r\n\r\nlet zMap = {};\r\nlet sMap = {};\r\n\r\n\r\n/**\r\n * 00026623.blink[1].brow has bug\r\n * 'Weapon/01702694' is Longcoat(islot)\r\n * how to use cash-weapon (ex: 01702504|0152)\r\n */\r\n\r\n/**\r\n * multi-image-sprite\r\n */\r\nclass FragmentTexture extends SpriteBase {\r\n\t/**\r\n\t * @param {wzproperty} raw\r\n\t * @param {string} full_path\r\n\t */\r\n\tconstructor(raw, full_path) {\r\n\t\tsuper(raw, full_path);\r\n\r\n\t\tif (this._raw.origin) {\r\n\t\t\tthis._raw.origin.__proto__ = Vec2.prototype;\r\n\t\t}\r\n\r\n\t\tfor (let i in this._raw.map) {\r\n\t\t\tthis._raw.map[i].__proto__ = Vec2.prototype;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * if this.relative == null then remove this\r\n\t\t * @type {Vec2}\r\n\t\t */\r\n\t\tthis.relative = new Vec2(0, 0);\r\n\t\t\r\n\t\tthis.calcRelative = this._calcRelative;//this._getRelativeFunction();//this.__old_calcRelative;//\r\n\r\n\t\tthis.filter = new ImageFilter();\r\n\t\tthis.opacity = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.visible = true;\r\n\r\n\r\n\t\t/** @type {string} - extra property. */\r\n\t\tthis._slot = null;\r\n\r\n\t\t/** @type {string} - extra property. 在哪個部位 */\r\n\t\tthis._place = null;\r\n\r\n\t\t/** @type {string} - extra property: _slot itemId, _place, _raw.z z */\r\n\t\tthis.classList = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget z() {\r\n\t\treturn zMap[this._raw.z] || 1;\r\n\t}\r\n\tset z(not_value) {\r\n\t\tconsole.error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget order() {\r\n\t\tdebugger;\r\n\t\treturn this.z;\r\n\t}\r\n\tset order(not_value) {\r\n\t\tdebugger;\r\n\t\tconsole.error(new TypeError(\"Not implement\"));\r\n\t}\r\n\r\n\t/** @returns {Vec2} */\r\n\tget origin() { return this._raw.origin || Vec2.empty; }\r\n\r\n\tisHasAnchor() { return !!this._raw.map; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget brow() { return this._raw.map.brow; }\r\n\tisAnchorBrow() { return !!this._raw.map.brow; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget neck() { return this._raw.map.neck; }\r\n\tisAnchorNeck() { return !!this._raw.map.neck; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget navel() { return this._raw.map.navel; }\r\n\tisAnchorNavel() { return !!this._raw.map.navel; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget hand() { return this._raw.map.hand; }\r\n\tisAnchorHand() { return !!this._raw.map.hand; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget handMove() { return this._raw.map.handMove; }\r\n\tisAnchorHandMove() { return !!this._raw.map.handMove; }\r\n\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earBelowHead() { return this._raw.map.earBelowHead; }\r\n\tisAnchor_EarBelowHead() { return !!this._raw.map.earBelowHead; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earOverHead() { return this._raw.map.earOverHead; }\r\n\tisAnchor_EarOverHead() { return !!this._raw.map.earOverHead; }\r\n\r\n\t/**\r\n\t * @param {FragmentTexture} that - this\r\n\t * @param {FragmentTexture} base - parent\r\n\t * @param {string} anchor - anchor name\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_anchor(that, base, anchor) {\r\n\t\treturn base[anchor].minus(that[anchor]).plus(base.origin.minus(that.origin));\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative(chara, body, head) {\r\n\t\tthis.calcRelative = this._getRelativeFunction(chara);\r\n\t\treturn this.calcRelative(chara, body, head);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getRelativeFunction(chara) {\r\n\t\tif (!this.isHasAnchor()) {\r\n\t\t\treturn this._calcRelativeEmpty;\r\n\t\t}\r\n\t\tif (this.isAnchorNeck()) {\r\n\t\t\treturn this._calcRelative_neck;\r\n\t\t}\r\n\t\tif (this.isAnchorBrow()) {\r\n\t\t\treturn this._calcRelative_brow;\r\n\t\t}\r\n\t\tif (this.isAnchorNavel()) {\r\n\t\t\tif (this == chara.slots.body) {\r\n\t\t\t\treturn this._getOrigin;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_navel;\r\n\t\t}\r\n\t\tif (this.isAnchorHand()) {\r\n\t\t\treturn this._calcRelative_hand;\r\n\t\t}\r\n\t\tif (this.isAnchorHandMove()) {\r\n\t\t\tif (this._url.lastIndexOf(\"lHand\") > 0) {\r\n\t\t\t\treturn this._calcRelative_handMove_lHand;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_handMove;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelativeEmpty(chara, body, head) {\r\n\t\treturn Vec2.empty;\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getOrigin(chara, body, head) {\r\n\t\treturn this.origin;\r\n\t}\r\n\t/**\r\n\t * neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_neck(chara, body, head) {\r\n\t\treturn this._anchor(this, body, \"neck\").minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * brow on the head & head on the neck & neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_brow(chara, body, head) {\r\n\t\treturn this._anchor(this, head, \"brow\").plus(this._anchor(head, body, \"neck\")).minus(body.origin);//anchor_brow+(-7,-33)\r\n\t}\r\n\t/**\r\n\t * this is origin point, no anchor\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_navel(chara, body, head) {\r\n\t\treturn body.navel.minus(this.navel).minus(this.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_hand(chara, body, head) {\r\n\t\tconst hand = chara.slots.body.fragments.arm.getTexture(chara);\r\n\t\tif (hand == null) {\r\n\t\t\treturn Vec2.empty.minus(this.hand).minus(this.origin).minus(body.origin);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this._anchor(this, hand, \"hand\").minus(this._anchor(body, hand, \"navel\")).minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove(chara, body, head) {\r\n\t\treturn Vec2.empty.minus(this.origin).minus(this.handMove);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove_lHand(chara, body, head) {\r\n\t\treturn Vec2.empty.minus(this.origin);\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!(this.relative && this.visible)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t\trenderer.ctx.filter = \"none\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass BodyFragmentTexture extends FragmentTexture {\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tsuper.update(chara);\r\n\t\tthis.visible = !chara.hideBody;\r\n\t}\r\n}\r\n\r\nclass HairFragmentTexture extends FragmentTexture {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph2 = null;\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph3 = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.graph2) {\r\n\t\t\t\t\tthis.graph2.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.graph3) {\r\n\t\t\t\t\tthis.graph3.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!this.relative) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trenderer.globalAlpha = this.opacity || 1;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\tthis._render(renderer);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\tthis._render(renderer);\r\n\t\t\trenderer.ctx.filter = \"none\";\r\n\t\t}\r\n\t}\r\n\t_render(renderer) {\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.drawGraph2(this, x, y);\r\n\r\n\t\tif (this.graph2 && this.graph2.opacity) {//color2\r\n\t\t\trenderer.globalAlpha = this.graph2.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph2, x, y);\r\n\t\t}\r\n\t\tif (this.graph3 && this.graph3.opacity) {//color3\r\n\t\t\trenderer.globalAlpha = this.graph3.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph3, x, y);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass ItemEffectAnimation extends Animation {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t\t\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\t//this._url = this._url;\r\n\r\n\t\tthis.__getAttr(\"z\", -1);\r\n\t\tthis.__getAttr(\"pos\", 1);\r\n\r\n\t\tsuper.load();\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {boolean} actionExceptRotation\r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\trender(renderer, actionExceptRotation, angle, flip) {\r\n\t\tif (actionExceptRotation) {\r\n\t\t\tthis.draw(renderer, 0, 0, -angle, flip);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst oy = -this.texture.height * 0.25;\r\n\t\t\tthis.draw(renderer, 0, oy, 0, flip);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//\t/data/Effect/ItemEff/1102918\r\nclass ItemEffect {\r\n\tconstructor() {\r\n\t\tthis._url = null;\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {{[animationName:string]:ItemEffectAnimation}} */\r\n\t\tthis.animation = {};\r\n\r\n\t\tthis.action = null;\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\r\n\t\tthis.fixed = 0;\r\n\t\tthis.z = -2;\r\n\t\tthis.action = 1;\r\n\t\tthis.actionExceptRotation = 0;\r\n\t\t\r\n\t\tthis.enable = true;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\ttry {\r\n\t\t\t/** @type {Set<string>} */\r\n\t\t\tlet itemEffectList = ItemEffect._list;\r\n\r\n\t\t\t/** @type {string[]} */\r\n\t\t\tlet raw = await $get.list(\"/Effect/ItemEff\");\r\n\r\n\t\t\titemEffectList.clear();\r\n\r\n\t\t\traw.forEach(id => {\r\n\t\t\t\titemEffectList.add(parseInt(id, 10));\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<ItemEffect>}\r\n\t */\r\n\tstatic async load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\r\n\t\tif (ItemEffect._list.has(id)) {\r\n\t\t\tlet eff = new ItemEffect();\r\n\t\t\tawait eff.load(equipID);\r\n\t\t\treturn eff;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tasync load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\t\tconst url = `/Effect/ItemEff/${id}/effect`;\r\n\t\tlet raw;\r\n\r\n\t\ttry {\r\n\t\t\traw = await $get.data(url);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\tif (raw) {\r\n\t\t\treturn this._load(equipID, url, raw);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t * @param {string} action\r\n\t */\r\n\tupdate(stamp, action) {\r\n\t\tif (action in this.animation) {\r\n\t\t\tthis.action = action;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.action = \"default\";\r\n\t\t}\r\n\r\n\t\tif (this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterRenderer} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (this.animation && this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].render(renderer, this.actionExceptRotation, chara.angle, chara.front > 0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} equipID\r\n\t * @param {object} raw_data\r\n\t */\r\n\t_load(equipID, url, raw) {\r\n\t\tthis.id = equipID;\r\n\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__construct();\r\n\t}\r\n\t__construct() {\r\n\t\tthis.__getAttr(\"fixed\", 0);\r\n\t\tthis.__getAttr(\"z\", -1);\r\n\t\tthis.__getAttr(\"action\", 1);\r\n\t\tthis.__getAttr(\"actionExceptRotation\", 0);\r\n\r\n\t\tfor (let i in this._raw) {\r\n\t\t\tif (this._raw[i] && typeof this._raw[i] == \"object\" && '0' in this._raw[i]) {//animation has frames\r\n\t\t\t\tthis.animation[i] = new ItemEffectAnimation(this._raw[i], [this._url, i].join(\"/\"));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n}\r\n/** @type {Set<string>} */\r\nItemEffect._list = new Set();\r\n\r\nclass CharacterFragmentBase {\r\n\t/**\r\n\t * @param {{[action:string]: FragmentTexture[]}} textures\r\n\t */\r\n\tconstructor(textures) {\r\n\t\t/** @type {{[action:string]: FragmentTexture[]}} - textures[action:string][frame:number] */\r\n\t\tthis.textures = textures;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterBodyFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.action_frame);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.action]) {\r\n\t\t\treturn this.textures[chara.action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterFaceFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.emotion_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.emotion in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.emotion][frame];\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.emotion]) {\r\n\t\t\treturn this.textures[chara.emotion].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterTamingMobFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara._action_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara._ride_action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara._ride_action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara._ride_action]) {\r\n\t\t\treturn this.textures[chara._ride_action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\nclass EquipImageFilter {\r\n\t/**\r\n\t * @param {CharacterAppearanceBase} equip\r\n\t */\r\n\tconstructor(equip) {\r\n\t\tthis.equip = equip;\r\n\t}\r\n\r\n\tget hue() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.hue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset hue(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget sat() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.sat;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset sat(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.sat = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget bri() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset bri(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.bri = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget contrast() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.contrast;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset contrast(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.contrast = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\thue: this.hue,\r\n\t\t\tsat: this.sat,\r\n\t\t\tbri: this.bri,\r\n\t\t\tcontrast: this.contrast,\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * @interface\r\n */\r\nclass ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tisLoaded() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\t_unload() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\ttoJSON() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t\treturn {\r\n\t\t\tid: -1,//invalid ID\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * ??\r\n */\r\nclass _CharacterAppearanceBaseSlotLink extends ICharacterAppearanceBase {\r\n\tconstructor(slot_link) {\r\n\t\tsuper();\r\n\t\tthis.slot_link = slot_link;//??\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: slot_link,//??\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * character loader\r\n */\r\nclass CharacterAppearanceBase extends ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\t\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\t//this._url = null;\r\n\t\t\t\r\n\t\t/** @type {ItemEffect} */\r\n\t\tthis.effect = null;\r\n\r\n\t\t/**\r\n\t\t * @type {{[place:string]:CharacterFragmentBase}}\r\n\t\t */\r\n\t\tthis.fragments = null;\r\n\r\n\t\tthis._onload = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tthis.categoryInfo = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.slot_order = 0;\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.islot = {};\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.vslot = {};\r\n\r\n\t\tthis.filter = new EquipImageFilter(this);\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: this.id,\r\n\t\t\tfilter: this.filter.toJSON(),\r\n\t\t};\r\n\t}\r\n\r\n\tisLoaded() {\r\n\t\treturn this.fragments != null;\r\n\t}\r\n\r\n\t/** @type {function(CharacterAppearanceBase):void} */\r\n\tget _onload() {\r\n\t\treturn this.__onload;\r\n\t}\r\n\tset _onload(func) {\r\n\t\tthis.__onload = func;\r\n\t\tif (this.isLoaded()) {\r\n\t\t\tthis.__onload.call(this, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {void} use_category - no use\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tlet raw;\r\n\r\n\t\tthis.id = id;\r\n\t\tthis.categoryInfo = cateInfo;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (ResourceManager.isEquipExist(id, cateInfo)) {\r\n\t\t\t\traw = await ItemCategoryInfo.getItem(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (!raw && load_extern_item_data) {\r\n\t\t\t\traw = await load_extern_item_data(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__load_slot();\r\n\r\n\t\tthis.__load_fragments();\r\n\r\n\t\tif (this._onload) {\r\n\t\t\tthis._onload.call(this, this);\r\n\t\t}\r\n\r\n\t\t//// if not body, head, face, hair then try load effect\r\n\t\t//if (id >= \"00050000\") {\r\n\t\t\t// load if exist\r\n\t\t\tItemEffect.load(this.id).then(a => this.effect = a);//01102918\t//01102915\r\n\t\t//}\r\n\r\n\t\treturn true;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tconst FragmentConstructor = this.FragmentConstructor;\r\n\r\n\t\t//Object.keys(this._raw_textures).map(k => { return '0' in this._raw_textures[k]; })\r\n\r\n\t\tlet action_list = Object.keys(this._raw_textures);\r\n\r\n\t\tlet textures = {};\r\n\t\tfor (let action of action_list) {\r\n\t\t\tif (typeof this._raw_textures[action] == \"object\" && \"0\" in this._raw_textures[action]) {\r\n\t\t\t\tlet _url = this._base_path + action;\r\n\r\n\t\t\t\ttextures[action] = this.__load_frame_textures(this._raw_textures[action], _url);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragment_textures = {};\r\n\t\tfor (let action in textures) {\r\n\t\t\tfor (let frame in textures[action]) {\r\n\t\t\t\tfor (let place in textures[action][frame]) {\r\n\t\t\t\t\tif (!(place in fragment_textures)) {\r\n\t\t\t\t\t\tfragment_textures[place] = {};\r\n\t\t\t\t\t\t//fragment_textures[place].visible = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!(action in fragment_textures[place])) {\r\n\t\t\t\t\t\tfragment_textures[place][action] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfragment_textures[place][action][frame] = textures[action][frame][place];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragments = {};\r\n\t\tfor (let frag in fragment_textures) {\r\n\t\t\tfragments[frag] = new FragmentConstructor(fragment_textures[frag]);\r\n\t\t}\r\n\t\tthis.fragments = fragments;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}[]} - array - textures[frame][place]\r\n\t */\r\n\t__load_frame_textures(_raw, _url) {\r\n\t\tlet textures = [];\r\n\t\tfor (let frame = 0; frame in _raw; ++frame) {\r\n\t\t\tlet url = `${_url}/${frame}`;\r\n\t\t\ttextures[frame] = this.__load_place_textures(_raw[frame], url);\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}} - object - textures[place]\r\n\t */\r\n\t__load_place_textures(_raw, _url) {\r\n\t\tlet textures = {};\r\n\t\tfor (let place in _raw) {\r\n\t\t\tlet path = `${_url}/${place}`;\r\n\t\t\tlet raw = _raw[place];\r\n\r\n\t\t\tif (raw) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tconst FragmentTextureConstructor = this.FragmentTextureConstructor;\r\n\t\t\t\tlet ft;\r\n\t\t\t\tif (raw[\"\"] == \"\") {\r\n\t\t\t\t\tft._url = path;\r\n\t\t\t\t\t//ft._url = path;\r\n\t\t\t\t\ttextures[place] = ft\r\n\t\t\t\t}\r\n\t\t\t\telse if (typeof raw[\"\"] == 'string') {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw);\r\n\t\t\t\t\t//ft._url = raw[\"\"];\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\telse if (place == \"hairShade\") {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw[0]);\r\n\t\t\t\t\t//ft._url = path + \"/0\";\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tft._slot = this.categoryInfo.slot;\r\n\t\t\t\t\tft._place = place;\r\n\r\n\t\t\t\t\tft.classList = [\r\n\t\t\t\t\t\tft._slot,\r\n\t\t\t\t\t\t\"item\" + this.id,\r\n\t\t\t\t\t\tft._place,\r\n\t\t\t\t\t\tft._raw.z,\r\n\t\t\t\t\t\t'z' + ft.z\r\n\t\t\t\t\t].join(' ');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t__load_slot() {\r\n\t\tif (!this._raw.info.islot) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet islots = this._raw.info.islot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in islots) {\r\n\t\t\tconst slot = islots[i];\r\n\t\t\tconst slot_order = zMap[slot];\r\n\t\t\tthis.islot[slot] = slot_order;\r\n\t\t\t\t\r\n\t\t\tif (slot_order > this.slot_order) {//this.slot_order = Math.max(this.slot_order, slot_order);\r\n\t\t\t\tthis.slot_order = slot_order;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet vslots = this._raw.info.vslot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in vslots) {\r\n\t\t\tconst slot = vslots[i];\r\n\t\t\tthis.vslot[slot] = slot;\r\n\t\t}\r\n\t}\r\n\r\n\t_unload() {\r\n\t\tthis.fragments = null;\r\n\t\tthis.effect == null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget opacity() {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} opacity\r\n\t */\r\n\tset opacity(opacity) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.opacity = opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} hue 0 ~ 360\r\n\t * @param {number} sat 0 ~ 100\r\n\t * @param {number} bri 0 ~ 100\r\n\t */\r\n\tsetFilter(hue, sat, bri) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = hue;\r\n\t\t\t\t\t\tft.filter.sat = sat;\r\n\t\t\t\t\t\tft.filter.bri = bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get icon url\r\n\t * @see {@link ItemCategoryInfo.getIconUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconUrl() {\r\n\t\tconst icon = this._raw.info.icon;\r\n\t\tif (icon) {\r\n\t\t\treturn icon[\"\"];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn ItemCategoryInfo.getIconUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get iconRaw url\r\n\t * @see {@link ItemCategoryInfo.getIconRawUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconRawUrl() {\r\n\t\tconst iconRaw = this._raw.info.iconRaw;\r\n\t\tif (iconRaw) {\r\n\t\t\treturn iconRaw[\"\"];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn ItemCategoryInfo.getIconRawUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @type {string}\r\n\t */\r\n\tget _animation_type() {\r\n\t\tthrow new Error(\"Not Implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof CharacterFragmentBase}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {{[actions:string]:{[\"0\"]:Sprite,[frames:string]:Sprite}}} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw;\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url;\r\n\t}\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nclass CharacterAppearance extends CharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == \"face\" || k == \"delay\" || k == \"default\"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara.action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.action][chara.action_frame].delay;\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n}\r\n\r\nclass CharacterBody extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquip extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquipCashWeapon extends CharacterEquip {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.use_category = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {string} use_category - cash-weapon as [category]\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tif (!use_category && use_category != \"\") {\r\n\t\t\tthrow new TypeError(\"use_category\");\r\n\t\t}\r\n\r\n\t\tthis.use_category = use_category.slice(2, 4);\r\n\r\n\t\treturn super.load(url, id, cateInfo);\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {object} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw[this.use_category];\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url + this.use_category;\r\n\t}\r\n}\r\n\r\n\r\nclass CharacterHeadBase extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterHead extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.elfEarFragment = null;\r\n\t\tthis.lefEarFragment = null;\r\n\t\tthis.highlefEarFragment = null;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tsuper.__load_fragments()\r\n\t\t\r\n\t\tif (this.fragments) {\r\n\t\t\tif (this.fragments.ear) {\r\n\t\t\t\tthis.elfEarFragment = this.fragments.ear;\r\n\t\t\t\tdelete this.fragments.ear;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.lefEar) {\r\n\t\t\t\tthis.lefEarFragment = this.fragments.lefEar;\r\n\t\t\t\tdelete this.fragments.lefEar;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.highlefEar) {\r\n\t\t\t\tthis.highlefEarFragment = this.fragments.highlefEar;\r\n\t\t\t\tdelete this.fragments.highlefEar;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget elfEar() {\r\n\t\treturn this.fragments.ear != null;\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (!this.elfEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.ear = this.elfEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.ear;\r\n\t\t}\r\n\t}\r\n\r\n\tget lefEar() {\r\n\t\treturn this.fragments.lefEar != null;\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (!this.lefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.lefEar = this.lefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.lefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget highlefEar() {\r\n\t\treturn this.fragments.highlefEar != null;\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (!this.highlefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.highlefEar = this.highlefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.highlefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterHair extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * hair color mix\r\n\t * @override\r\n\t * @returns {typeof HairFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn HairFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterFaceBase extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == \"delay\" || k == \"default\"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.face.fragments.face.textures[chara.emotion].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.emotion][chara.emotion_frame].delay;\r\n\t\tif (d != null) {//!isNaN(d) && isFinite(d)\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n}\r\nclass CharacterFace extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"emotion\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\nclass CharacterFaceAcc extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"emotion\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterTamingMob extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget type() {\r\n\t\treturn this._raw.info.tamingMob;\r\n\t}\r\n\r\n\tget actionMap() {\r\n\t\treturn this._raw.characterAction;\r\n\t}\r\n\r\n\tget emotionMap() {\r\n\t\treturn this._raw.characterEmotion;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Vec2} relative\r\n\t * @param {FragmentTexture} body\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\tadj_pos(relative, body, chara) {\r\n\t\tconst frag = this.fragments[0];//default\r\n\t\tif (frag) {\r\n\t\t\tconst tm = frag.getTexture(chara);\r\n\t\t\tif (tm) {\r\n\t\t\t\treturn relative.plus(tm.navel.minus(body.navel));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn relative;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara._ride_action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = Math.trunc(this._raw[chara._ride_action][chara.action_frame].delay);//?? _ride_action_frame => action_frame\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"_ride_action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterTamingMobFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterTamingMobFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\n\r\nItemCategoryInfo._info['0000'].FragmentType = CharacterBody;\t\t//\tbody\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0001'].FragmentType = CharacterHead;\t\t//\telfEar\t\t\t-> CharacterHeadBase -> CharacterHead\r\nItemCategoryInfo._info['0002'].FragmentType = CharacterFace;\t\t//\tFace\t\t\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFace\r\nItemCategoryInfo._info['0003'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\nItemCategoryInfo._info['0004'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\n\r\nItemCategoryInfo._info['0100'].FragmentType = CharacterEquip;\t\t//\tCap\t\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0101'].FragmentType = CharacterFaceAcc;\t\t//\taccessoryFace\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFaceAcc\r\nItemCategoryInfo._info['0102'].FragmentType = CharacterEquip;\t\t//\taccessoryEyes\t-> CharacterEquip\r\nItemCategoryInfo._info['0103'].FragmentType = CharacterEquip;\t\t//\taccessoryEars\t-> CharacterEquip\r\nItemCategoryInfo._info['0104'].FragmentType = CharacterEquip;\t\t//\tCoat\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0105'].FragmentType = CharacterEquip;\t\t//\tLongcoat\t\t-> CharacterBody\r\nItemCategoryInfo._info['0106'].FragmentType = CharacterEquip;\t\t//\tPants\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0107'].FragmentType = CharacterEquip;\t\t//\tShoes\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0108'].FragmentType = CharacterEquip;\t\t//\tGlove\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0109'].FragmentType = CharacterEquip;\t\t//\tShield\t\t\t-> CharacterBody\r\nItemCategoryInfo._info['0110'].FragmentType = CharacterEquip;\t\t//\tCape\t\t\t-> CharacterBody\r\n\r\nItemCategoryInfo._info['0170'].FragmentType = CharacterEquipCashWeapon;\t//\tcash-weapon\t-> CharacterEquip\r\n\r\nItemCategoryInfo._info['019'].FragmentType = CharacterTamingMob;\t//\tTamingMob\t\t-> CharacterTamingMob\r\n\r\n\r\nclass CharacterSlots {\r\n\tconstructor() {\r\n\t\t\t\r\n\t\t/** @type {CharacterAppearanceBase[]} */\r\n\t\tthis._ordered_slot = [];\r\n\r\n\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis.hair = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair2 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix2 = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair3 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix3 = null;\r\n\r\n\r\n\t\t/** @type {CharacterEquipBody} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.head = null;\r\n\r\n\t\t/** @type {CharacterFace} */\r\n\t\tthis.face = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.hair = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 1 */\r\n\t\tthis.cap = null;\r\n\r\n\t\t/** @type {CharacterFace} - 2 */\r\n\t\tthis.accessoryFace = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 3*/\r\n\t\tthis.accessoryEyes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 4 */\r\n\t\tthis.accessoryEars = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.coat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.longcoat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 6 */\r\n\t\tthis.pants = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 7 */\r\n\t\tthis.shoes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 8 */\r\n\t\tthis.glove = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 9 */\r\n\t\tthis.cape = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 10 */\r\n\t\tthis.shield = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 11 */\r\n\t\tthis.weapon = null;\r\n\t\t\r\n\t\t/** @type {CharacterTamingMob} */\r\n\t\tthis.tamingMob = null;\r\n\t\t\r\n\t\t{\r\n\t\t\tObject.defineProperty(this, \"_ordered_slot\", {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: []\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, \"_hair\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"hair\", {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn this._hair;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (value) {\r\n\t\t\t\t\tthis._hair = value;\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tif (this._hair2 && this._hairMix2) {\r\n\t\t\t\t\t\t\tthis.hairColor2 = this.hairColor2;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this._hair3 && this._hairMix3) {\r\n\t\t\t\t\t\t\tthis.hairColor3 = this.hairColor3;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, \"_hair\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hair2\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hairMix2\", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hair3\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hairMix3\", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync __loadColoredHair(color) {\r\n\t\tconst id = CharacterRenderConfig.getColorHairID(this.hair.id, color);\r\n\t\tconst cateInfo = ItemCategoryInfo.get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tconst url = `/Character/${cateInfo.path + (cateInfo.path ? \"/\" : \"\") + id}`;\r\n\t\t\tconst use_category = undefined;\r\n\r\n\t\t\tlet hair = new CharacterHair();\r\n\r\n\t\t\tawait hair.load(url, id, cateInfo, use_category);\r\n\r\n\t\t\treturn hair;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {number} */\r\n\tget hairColor2() {\r\n\t\tif (this._hair2) {\r\n\t\t\treturn Number(CharacterRenderConfig.getHairColor(this._hair2.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor2(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc2Id = CharacterRenderConfig.getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair2 || hc2Id != this._hair2.id) {\r\n\t\t\tif (hc2Id == this._hair.id) {\r\n\t\t\t\tthis._hair2 = null;\r\n\t\t\t\tthis.hairMix2 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair2 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair2.then(hair2 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair2;\r\n\r\n\t\t\t\t\tthis._hair2 = hair2;\r\n\t\t\t\t\tif (this._hair2 && this.hairMix2 != null) {\r\n\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix2 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairMix2() {\r\n\t\treturn this._hairMix2;\r\n\t}\r\n\tset hairMix2(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair2).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair2;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph2 = ft;\r\n\t\t\t\t\t\t\tori.graph2.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix2 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairColor3() {\r\n\t\tif (this._hair3) {\r\n\t\t\treturn Number(CharacterRenderConfig.getHairColor(this._hair3.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor3(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc3Id = CharacterRenderConfig.getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair3 || this._hair3.id != hc3Id) {\r\n\t\t\tif (this._hair.id == hc3Id || this._hair2.id == hc3Id) {\r\n\t\t\t\tthis._hair3 = null;\r\n\t\t\t\tthis.hairMix3 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair3 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair3.then(hair3 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair3;\r\n\r\n\t\t\t\t\tthis._hair3 = hair3;\r\n\t\t\t\t\tif (this._hair3 && this.hairMix3 != null) {\r\n\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix3 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} */\r\n\tget hairMix3() {\r\n\t\treturn this._hairMix3;\r\n\t}\r\n\tset hairMix3(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair3).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair3;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph3 = ft;\r\n\t\t\t\t\t\t\tori.graph3.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix3 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t//__order_slot() {\r\n\t//\tlet slot_map = new Map();\r\n\t//\r\n\t//\tfor (let i in this) {\r\n\t//\t\tlet equip = this[i];\r\n\t//\r\n\t//\t\tequip.cs\r\n\t//\t}\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {CharacterAppearanceBase} loadedEquip\r\n\t * @param {string} use_category - category which used of cash-weapon\r\n\t */\r\n\tasync _use(id, loadedEquip, use_category) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst cateInfo = ItemCategoryInfo.get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tlet url = `/Character/${cateInfo.path + (cateInfo.path ? \"/\":\"\") + id}`;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item;\r\n\r\n\t\t\tif (loadedEquip instanceof CharacterAppearanceBase) {\r\n\t\t\t\talert(\"CharacterSlots # _use: param loadedEquip ??\");\r\n\t\t\t\tdebugger;\r\n\t\t\t\titem = loadedEquip;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (loadedEquip) {\r\n\t\t\t\t\talert(\"CharacterSlots # _use: param loadedEquip ??\");\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t}\r\n\t\t\t\tconst fragmentType = cateInfo.FragmentType || CharacterEquip;\r\n\r\n\t\t\t\titem = new fragmentType();\r\n\t\t\t}\r\n\t\t\t/** _use_loaded_equip */\r\n\t\t\tif (0) {\r\n\t\t\t\tif (this[cateInfo.slot]) {\r\n\t\t\t\t\tthis[cateInfo.slot]._unload();\r\n\t\t\t\t}\r\n\t\t\t\tthis[cateInfo.slot] = item;\r\n\r\n\t\t\t\tthis._ordered_slot[item.slot_order] = item;\r\n\t\t\t}\r\n\r\n\t\t\tlet is_exist = loadedEquip || await item.load(url, id, cateInfo, use_category);\r\n\t\t\tif (is_exist) {\r\n\t\t\t\t/** _use_loaded_equip */\r\n\t\t\t\tif (1) {\r\n\t\t\t\t\tif (this[cateInfo.slot]) {\r\n\t\t\t\t\t\tthis[cateInfo.slot]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis[cateInfo.slot] = item;\r\n\r\n\t\t\t\t\tthis._ordered_slot[item.slot_order] = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn(\"item(\" + id + \") is not exist\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {boolean}\r\n\t */\r\n\t_unuse(id) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cateInfo, equip;\r\n\r\n\t\tif (id instanceof CharacterAppearanceBase) {\r\n\t\t\tequip = id;\r\n\t\t\tid = equip.id;\r\n\t\t\tcateInfo = equip.categoryInfo;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcateInfo = ItemCategoryInfo.get(id);\r\n\t\t}\r\n\t\t\r\n\t\tconst slotName = cateInfo.slot;\r\n\r\n\t\tif (slotName != \"head\" && slotName != \"body\") {\r\n\t\t\tif (this[slotName] && this[slotName].id == id) {\r\n\t\t\t\tequip = this[slotName];\r\n\t\t\t\tfor (let slot in equip.islot) {\r\n\t\t\t\t\tlet order = equip.islot[slot];\r\n\t\t\t\t\tif (this._ordered_slot[order]) {\r\n\t\t\t\t\t\tthis._ordered_slot[order]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdelete this._ordered_slot[order];\r\n\t\t\t\t}\r\n\t\t\t\tthis[slotName] = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t_clear() {\r\n\t\t//this.body = null;\r\n\t\t//this.head = null;\r\n\t\tthis.face = null;\r\n\t\tthis.hair = null;\r\n\t\tthis.cap = null;\r\n\t\tthis.accessoryFace = null;\r\n\t\tthis.accessoryEyes = null;\r\n\t\tthis.accessoryEars = null;\r\n\t\tthis.coat = null;\r\n\t\tthis.longcoat = null;\r\n\t\tthis.pants = null;\r\n\t\tthis.shoes = null;\r\n\t\tthis.glove = null;\r\n\t\tthis.cape = null;\r\n\t\tthis.shield = null;\r\n\r\n\t\t//temp\r\n\t\tlet head = this.head;\r\n\t\tlet body = this.body;\r\n\r\n\t\t//clear\r\n\t\tthis._ordered_slot = [];\r\n\r\n\t\t//restore\r\n\t\tif (head) {\r\n\t\t\tthis._ordered_slot[head.slot_order] = head;\r\n\t\t}\r\n\t\tif (body) {\r\n\t\t\tthis._ordered_slot[body.slot_order] = body;\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify() {\r\n\t\tlet slots = [\"c\"];\r\n\t\t\t\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id + \"|\" + this.face.id);\r\n\t\tif (this.hair) {\r\n\t\t\tlet ha = [];\r\n\t\t\tha.push(this.hair.id);\r\n\t\t\tif (this.hairColor2 && this.hairMix2 > 0) ha.push(this.hairColor2 + \"%\" + Math.trunc(this.hairMix2 * 100));\r\n\t\t\tif (this.hairColor3 && this.hairMix3 > 0) ha.push(this.hairColor3 + \"%\" + Math.trunc(this.hairMix3 * 100));\r\n\t\t\tslots.push(ha.join(\"|\"));\r\n\t\t}\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots.join(\",\");\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\tlet slots = [];\r\n\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id);\r\n\t\tif (this.hair) slots.push(this.hair.id);\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots;\r\n\t}\r\n\r\n\t/**\r\n\t * returns: [face, hair, cap, ..., weapon]\r\n\t */\r\n\t*enumerate() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.hair) yield this.hair;\r\n\r\n\t\tyield* this.enumerate_equip();\r\n\t}\r\n\t*enumerate_equip() {\r\n\t\tif (this.cap) yield this.cap;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t\tif (this.accessoryEyes) yield this.accessoryEyes;\r\n\t\tif (this.accessoryEars) yield this.accessoryEars;\r\n\t\tif (this.coat) yield this.coat;\r\n\t\tif (this.longcoat) yield this.longcoat;\r\n\t\tif (this.pants) yield this.pants;\r\n\t\tif (this.shoes) yield this.shoes;\r\n\t\tif (this.glove) yield this.glove;\r\n\t\tif (this.shield) yield this.shield;\r\n\t\tif (this.cape) yield this.cape;\r\n\t\tif (this.weapon) yield this.weapon;\r\n\t}\r\n\t*enumerate_face() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t}\r\n}\r\n\r\nclass CharacterChangeLog {\r\n\tconstructor() {\r\n\t\t/** @type {\"human\"|\"elf\"|\"lef\"|\"highlef\"} */\r\n\t\tthis.ear = undefined;\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.useEquip = [];\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.unuseEquip = [];\r\n\t\t\r\n\t\t/** @type {string} - hair2 id */\r\n\t\tthis.hair2 = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.hairMix2 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hair3 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hairMix3 = undefined;\r\n\r\n\t\t/** @type {string} weapon => equip id */\r\n\t\tthis.weapon = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.ear = undefined;\r\n\t\tthis.useEquip = [];\r\n\t\tthis.unuseEquip = [];\r\n\t\tthis.hair2 = undefined;\r\n\t\tthis.hairMix2 = undefined;\r\n\t\t//this.hair3 = undefined;\r\n\t\t//this.hairMix3 = undefined;\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n}\r\n\r\nexport class CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tthis._$dirty = 0;//force update vue\r\n\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.job = null;\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.subJob = null;\r\n\r\n\r\n\t\t/** @type {ActionAnimation} */\r\n\t\tthis.actani = new ActionAnimation();\r\n\r\n\t\t/** @type {number} - animation speed rate */\r\n\t\tthis.speed = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.fixed_speed = false;\r\n\r\n\t\t/** @type {boolean} - pause animation */\r\n\t\tthis.pause = false;\r\n\r\n\r\n\t\tthis.hideBody = false;\r\n\r\n\t\tthis._ride_action = \"stand1\";\r\n\t\t\r\n\t\tthis._action = \"stand1\";\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\tthis._emotion = \"blink\";\r\n\t\tthis._emotion_frame = 0;\r\n\t\tthis._emotion_time = 0;\r\n\t\tthis._emotion_frame_sequence = [0, 1, 2, 1];\r\n\r\n\t\t/** @type {CharacterSlots} */\r\n\t\tthis.slots = new CharacterSlots();\r\n\r\n\t\t/**\r\n\t\t * is require update render data\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.__require_update = true;\r\n\r\n\t\t/** @type {FragmentTexture[]} */\r\n\t\tthis.__frag_list = [];\r\n\r\n\t\t/** @type {CharacterChangeLog} **/\r\n\t\tthis.$$changeLog = new CharacterChangeLog();\r\n\t}\r\n\r\n\t_clone() {\r\n\t\talert(this.constructor.name + \"::_clone\");\r\n\r\n\t\t/** @type {CharacterAnimationBase} */\r\n\t\tlet nc = new this.constructor();//not must CharacterRender\r\n\t\tif (!nc) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnc.speed = 0;\r\n\r\n\t\tnc.x = this.x;\r\n\t\tnc.y = this.y;\r\n\t\tnc.angle = this.angle;\r\n\r\n\t\tnc.action = this.action;\r\n\t\tnc.action_frame = this.action_frame;\r\n\r\n\t\tnc.emotion = this._emotion;\r\n\t\tnc.emotion_frame = this.emotion_frame;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tnc.slots[i] = this.slots[i];//not need colne ?\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nc;\r\n\t}\r\n\t\t\r\n\t_waitFrameTexturesLoaded() {\r\n\t\tlet tasks = [];\r\n\t\tfor (let i in this.slots) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\t\tlet frag = item.fragments[j];\r\n\t\t\t\t\tlet count = frag.getFrameCount(this);\r\n\t\t\t\t\tfor (let k = 0; k < count; ++k) {\r\n\t\t\t\t\t\tlet ft = frag.getFrameTexture(this, k);\r\n\t\t\t\t\t\tif (ft && !ft._isLoaded_or_doload()) {\r\n\t\t\t\t\t\t\ttasks.push(ft.$promise);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\r\n\t/**\r\n\t * init animation status\r\n\t */\r\n\tinitAnimation() {\r\n\t\t/** @type {string} */\r\n\t\tthis.action = \"stand1\";\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.emotion = \"blink\";\r\n\t\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_frame = 0;\r\n\t}\r\n\r\n\t/** @type {number} - 0~1 */\r\n\tgetSpeed() {\r\n\t\tif (this.pause) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this.fixed_speed ? 1 : this.speed;\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget elfEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.elfEar;\r\n\t\t}\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.elfEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget lefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar;\r\n\t\t}\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.lefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget highlefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.highlefEar;\r\n\t\t}\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.highlefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {\"human\"|\"elf\"|\"lef\"|\"highlef\"} */\r\n\tget ear() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar ? \"lef\" : (this.slots.head.elfEar ? \"elf\" : (this.slots.head.highlefEar ? \"highlef\" : \"human\"));\r\n\t\t}\r\n\t}\r\n\tset ear(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tif (value == \"elf\") {\r\n\t\t\t\tthis.slots.head.elfEar = true;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == \"lef\") {\r\n\t\t\t\tthis.slots.head.lefEar = true;\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == \"highlef\") {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = true;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = \"human\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$$changeLog.ear = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget action() {\r\n\t\t//if (this.slots.tamingMob) {\r\n\t\t//\tconst actmap = this.slots.tamingMob.actionMap;\r\n\t\t//\tif (actmap) {\r\n\t\t//\t\treturn actmap[this._action];\r\n\t\t//\t}\r\n\t\t//\treturn \"sit\";//default\r\n\t\t//}\r\n\t\treturn this._action;\r\n\t}\r\n\tset action(act) {\r\n\t\tif (this.slots.tamingMob) {\r\n\t\t\tlet _act;\r\n\r\n\t\t\tthis._ride_action = act;\r\n\r\n\t\t\tif (this.slots.tamingMob.actionMap) {\r\n\t\t\t\t_act = this.slots.tamingMob.actionMap[act];\r\n\r\n\t\t\t\tif (_act == \"hideBody\") {\r\n\t\t\t\t\tthis.hideBody = true;\r\n\r\n\t\t\t\t\t//TODO: hideBody act=?\r\n\r\n\t\t\t\t\tthis._action = act;\r\n\t\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.hideBody = false;\r\n\r\n\t\t\t\t\tthis._action = _act;\r\n\t\t\t\t\tif (this.actani._action != _act) {\r\n\t\t\t\t\t\tthis.actani.reload(_act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (act == \"rope\") {\r\n\t\t\t\t\tthis._action = \"rope\";//default\r\n\t\t\t\t}\r\n\t\t\t\telse if (act == \"ladder\") {\r\n\t\t\t\t\tthis._action = \"ladder\";//default\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._action = \"sit\";//default\r\n\t\t\t\t}\r\n\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t}\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.hideBody = false;\r\n\t\t\tthis._ride_action = null;\r\n\r\n\t\t\tif (this.actani._action != act && this.slots.body) {\r\n\t\t\t\tthis._action = act;\r\n\t\t\t\tthis.actani.reload(act);\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame() {\r\n\t\treturn this._action_frame;\r\n\t}\r\n\tset action_frame(value) {\r\n\t\tif (value === \"\") {//from $(\"input\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tif (!(typeof value == 'number')) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthis._action_frame = Number(value) | 0;\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._action_frame = value;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.body) {\r\n\t\t\t\treturn this.slots.body.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget emotion() {\r\n\t\treturn this._emotion;\r\n\t}\r\n\tset emotion(emo) {\r\n\t\tif (this._emotion != emo && this.slots.face && this.slots.face.fragments.face.textures[emo]) {\r\n\t\t\tthis._emotion = emo;\r\n\t\t\tthis._emotion_frame = 0;\r\n\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\tthis._emotion_frame_sequence = [...circularSequence(this.emotion_frame_count)];\r\n\r\n\t\t\tthis.__require_update |= true;\r\n\t\t}\r\n\t}\r\n\r\n\t*emotion_frame_sequence_generator(length) {\r\n\t\tfor (; ;) {\r\n\t\t\t//TODO: random blink\r\n\t\t\tyield* circularSequence(length);\r\n\r\n\t\t\tfor (; Math.random() < 0.5;) {\r\n\t\t\t\tyield 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\t\r\n\t/** @type {number} */\r\n\tget emotion_frame() {\r\n\t\tlet f = this._emotion_frame_sequence[this._emotion_frame % this._emotion_frame_sequence.length];\r\n\t\treturn f;\r\n\t}\r\n\tset emotion_frame(value) {\r\n\t\tif (value === \"\") {//from $(\"input\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (process.env.NODE_ENV !== 'production') {\r\n\t\t\tif (!(typeof value == 'number')) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthis._emotion_frame = Number(value) | 0;\r\n\t\t\t\tthis._emotion_time = 0;\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._emotion_frame = value;\r\n\t\tthis._emotion_time = 0;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} next\r\n\t */\r\n\t_get_emotion_next_frame(next) {\r\n\t\tlet f = this._emotion_frame + next;\r\n\t\tf = f < 0 ? (this._emotion_frame_sequence.length - 1) : (f % this._emotion_frame_sequence.length);\r\n\t\treturn this._emotion_frame_sequence[f];\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_time() {\r\n\t\treturn this._emotion_time;\r\n\t}\r\n\tset emotion_time(time) {\r\n\t\tif (this.emotion_frame_count) {\r\n\t\t\tif (time < this.emotion_delay) {\r\n\t\t\t\tthis._emotion_time = time;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\t\t++this._emotion_frame;\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget emotion_delay() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn this.slots.face.getDelay(this);\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.face) {\r\n\t\t\t\treturn this.slots.face.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp - 0 <= stamp < Infinity\r\n\t */\r\n\t_update(_stamp) {\r\n\t\tif (this.pause) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet stamp = _stamp * this.getSpeed();\r\n\t\t\r\n\t\tif (this.actani) {\r\n\t\t\tif (this.actani.isEnd() && this.actani.loop) {\r\n\t\t\t\tthis.actani.reset();\r\n\t\t\t}\r\n\r\n\t\t\tthis.actani.update(stamp, this);\r\n\t\t}\r\n\r\n\t\tthis.emotion_time += _stamp;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet equip = this.slots[i];\r\n\t\t\tif (equip && equip.effect && equip.effect.enable) {\r\n\t\t\t\tequip.effect.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis._update(stamp);\r\n\t}\r\n\r\n\t__forceUpdate(stamp) {\r\n\t\tthis._$dirty = Math.random();\r\n\t\tthis._update(stamp | 0);\r\n\t\tthis.__update_frag_list();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} x\r\n\t * @param {number} y, \r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\t_draw(renderer, x, y, angle, flip) {\r\n\t\trenderer.pushGlobalAlpha();\r\n\r\n\t\tif (this.__require_update) {\r\n\t\t\tthis.__update_frag_list();\r\n\t\t\tthis.__require_update = false;\r\n\t\t}\r\n\r\n\t\t//list.filter(a=>a&&a._raw.map).forEach(a=>{ for (let i in a._raw.map) { if (q[i]) { q[i].push(a); } else { q[i] = [a]; } } })\r\n\t\tthis.__draw_list(renderer, this.__frag_list, x, y, angle, flip);\r\n\r\n\t\trenderer.popGlobalAlpha();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {FragmentTexture[]} list\r\n\t */\r\n\t__draw_list(renderer, list, x, y, angle, flip) {\r\n\t\trenderer.pushMatrix();\r\n\r\n\t\trenderer.translate(x, y);\r\n\t\t\r\n\t\tif (0) {\r\n\t\t\tlet ctx = renderer.ctx;\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(0, 0);\r\n\t\t\tctx.lineTo(100, 0);\r\n\t\t\tctx.strokeStyle = \"#F00\";\r\n\t\t\tctx.stroke();\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(0, 0);\r\n\t\t\tctx.lineTo(0, 100);\r\n\t\t\tctx.strokeStyle = \"#0F0\";\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\trenderer.rotate(window.m_a || angle);\r\n\r\n\t\tif (flip) {\r\n\t\t\trenderer.scale(-1, 1);\r\n\t\t}\r\n\t\t//{\r\n\t\t//\tlet ctx = renderer.ctx;\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(100, 0);\r\n\t\t//\tctx.strokeStyle = \"#F00\";\r\n\t\t//\tctx.stroke();\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(0, 100);\r\n\t\t//\tctx.strokeStyle = \"#0F0\";\r\n\t\t//\tctx.stroke();\r\n\t\t//}\r\n\r\n\t\t{\r\n\t\t\tfor (let i in this.slots) {\r\n\t\t\t\tlet equip = this.slots[i];\r\n\t\t\t\tif (equip && equip.effect) {\r\n\t\t\t\t\tequip.effect.render(renderer, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i in list) {\r\n\t\t\t\tlet ft = list[i];\r\n\t\t\t\tft.render(renderer, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderer.popMatrix();\r\n\t}\r\n\t__update_frag_list() {\r\n\t\tthis.__frag_list = [];\r\n\t\t\r\n\t\t/** @type {Array<CharacterAppearanceBase>[]} */\r\n\t\tlet slots = {};\r\n\t\t\r\n\t\tfor (let i = 2; i <= 3; ++i) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots[\"_hair\" + i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\tfor (let i in this.slots._ordered_slot) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots._ordered_slot[i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\t\r\n\t\t{//back\r\n\t\t\tlet is_back = false;\r\n\t\t\t\r\n\t\t\tfor (let i in slots) {\r\n\t\t\t\t/** @type {FragmentTexture[]} */\r\n\t\t\t\tlet fts = slots[i];\r\n\t\t\t\tfor (let j in fts) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = fts[j];\r\n\t\t\t\t\tif (is_back) {\r\n\t\t\t\t\t\tif (ft._place.startsWith(\"face\")) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (ft._place.startsWith(\"backHair\")) {\r\n\t\t\t\t\t\tis_back = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t{\r\n\t\t\tlet ae = this.__frag_list[114];//HACK: Ae\r\n\t\t\tif (ae) {\r\n\t\t\t\tthis.__frag_list.push(ae);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._calcBoundBox();\r\n\t}\r\n\t/**\r\n\t * @param {Array<CharacterAppearanceBase>[]} slots\r\n\t * @param {CharacterAppearanceBase} item\r\n\t */\r\n\t__add_equip_to_frag_list(slots, item) {\r\n\t\t// if equip not use then value is mumber(slot_order) where this.slots._ordered_slot\r\n\t\tif (item == null) {\r\n\t\t\treturn;//debugger;\r\n\t\t}\r\n\t\telse if (item > 0) {// typeof item == 'number'; item != null && (item instanceof CharacterAppearanceBase || item >= 0)\r\n\t\t\treturn;//continue;\r\n\t\t}\r\n\r\n\t\t// init slots\r\n\t\tfor (let j in item.vslot) {\r\n\t\t\tlet slot = item.vslot[j];\r\n\t\t\tslots[slot] = [];\r\n\t\t}\r\n\r\n\t\tfor (let j in item.fragments) {//foreach equip place\r\n\t\t\tlet slot = sMap[j];\r\n\t\t\tif (slot != null) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (j == \"default\") {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tslot = item._raw.info.islot;\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//item.fragments[j].visible = true;\r\n\t\t}\r\n\t}\r\n\t/** @param {FragmentTexture} ft */\r\n\t__add_frag_to_list(ft) {\r\n\t\tft.update(this);\r\n\t\tthis.__frag_list[ft.z] = ft;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * calc current frame bound box and restore result\r\n\t * @returns {Rectangle}\r\n\t */\r\n\t_calcBoundBox() {\r\n\t\tlet left = 0, top = 0, right = 0, bottom = 0;\r\n\r\n\t\tfor (let i in this.__frag_list) {\r\n\t\t\tlet ft = this.__frag_list[i];\r\n\t\t\tif (ft.texture && ft.relative) {\r\n\t\t\t\tlet x0 = ft.relative.x;\r\n\t\t\t\tlet y0 = ft.relative.y;\r\n\t\t\t\tlet x1 = x0 + ft.width;\r\n\t\t\t\tlet y1 = y0 + ft.height;\r\n\r\n\t\t\t\tleft = Math.min(left, x0);\r\n\t\t\t\ttop = Math.min(top, y0);\r\n\t\t\t\tright = Math.max(right, x1);\r\n\t\t\t\tbottom = Math.max(bottom, y1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._boundBox = new Rectangle(\r\n\t\t\tMath.trunc(left),\r\n\t\t\tMath.trunc(top),\r\n\t\t\tMath.trunc(right - left),\r\n\t\t\tMath.trunc(bottom - top)\r\n\t\t);\r\n\t\treturn this._boundBox;\r\n\t}\r\n\t\r\n\ttoJSON() {\r\n\t\tlet obj = {\r\n\t\t\thair2: this.slots._hair2.id,\r\n\t\t\thairMix2: this.slots.hairMix2,\r\n\t\t\tslots: this.slots.toJSON(),\r\n\t\t};\r\n\r\n\t\tif (this.slots.head.elfEar) {\r\n\t\t\tobj.ear = \"elf\";\r\n\t\t}\r\n\t\telse if (this.slots.head.lefEar) {\r\n\t\t\tobj.ear = \"lef\";\r\n\t\t}\r\n\t\telse if (this.slots.head.highlefEar) {\r\n\t\t\tobj.ear = \"highlef\";\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nexport class CharacterRenderer extends CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {number} - position x */\r\n\t\tthis.x = 0;\r\n\t\t/** @type {number} - position y */\r\n\t\tthis.y = 0;\r\n\r\n\t\t/** @type {number} - where layer */\r\n\t\tthis.z = 5;\r\n\r\n\t\t/** @type {number} - translate x once frame */\r\n\t\tthis.tx = 0;\r\n\t\t/** @type {number} - translate y once frame */\r\n\t\tthis.ty = 0;\r\n\t\t\r\n\t\tthis.angle = 0;\r\n\t\tthis.front = -1;\r\n\r\n\t\t/** @type {Promise<void>[]} */\r\n\t\tthis.__load_task = [];\r\n\r\n\t\t/** @type {function(IRenderer)} */\r\n\t\tthis.render = function (renderer) {\r\n\t\t\t//not ready to render\r\n\t\t\t//if load then set load render = _render\r\n\t\t}\r\n\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis._boundBox = null;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\tlet result = await Promise.all([\r\n\t\t\t$get.data(\"/zmap\"),\r\n\t\t\t$get.data(\"/smap\"),\r\n\t\t\tItemEffect.Init(),\r\n\t\t\tActionAnimation.Init(),//action definition\r\n\t\t]);\r\n\t\t\r\n\t\tzMap = {};\r\n\t\tObject.keys(result[0]).reverse().forEach((k, i) => zMap[k] = i + 1);\r\n\r\n\t\tsMap = result[1];\r\n\t}\r\n\r\n\tload() {\r\n\t\t//load body and head for calc relative position\r\n\t\tthis.use(\"00002012\");\r\n\t\tthis.use(\"00012012\");\r\n\r\n\t\tlet $promise = Promise.all([...this.__load_task]);\r\n\t\t(function (that, $promise) {\r\n\t\t\t$promise.then(function (result) {\r\n\t\t\t\tthat.initAnimation();\r\n\t\t\t\tthat.render = that._render;\r\n\t\t\t});\r\n\t\t})(this, $promise);\r\n\r\n\t\treturn $promise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.waitLoaded();\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_render(renderer) {\r\n\t\tconst x = Math.trunc(this.x + this.tx);\r\n\t\tconst y = Math.trunc(this.y + this.ty);\r\n\t\t\r\n\t\tthis._draw(renderer, x, y, this.angle, this.front > 0);\r\n\t\t\r\n\t\t//this.tx = 0;//auto clear\r\n\t\t//this.ty = 0;//auto clear\r\n\t}\r\n\t\r\n\t_setup_test() {\r\n\t\tthis.use(\"00026509\");\r\n\r\n\t\tthis.use(\"00044041\");\r\n\r\n\t\t//this.use(\"01022274\");\r\n\r\n\t\tthis.use(\"01053169\");\r\n\r\n\t\tthis.use(\"01071077\");\r\n\r\n\t\t//this.use(\"01102960\");\r\n\t}\r\n\r\n\t\r\n\tasync __synchronize(stamp) {\r\n\t\tthis.__forceUpdate(stamp);\r\n\t\r\n\t\tawait this.waitLoaded();\r\n\t\tawait this._waitFrameTexturesLoaded();\r\n\t}\r\n\tasync waitLoaded() {\r\n\t\tlet tasks = this.__load_task;\r\n\t\tif (tasks && tasks.length) {\r\n\t\t\tawait Promise.all(tasks).then(() => {\r\n\t\t\t\tthis.__load_task = [];\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t//isLoading() {\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {string} category - category of cash-weapon\r\n\t */\r\n\tasync use(id, category) {\r\n\t\tif (!category) {\r\n\t\t\tcategory = ItemCategoryInfo.getJobWeaponCategory(this.job);\r\n\t\t}\r\n\t\tconst item_type = id[0];\r\n\t\tswitch (item_type) {\r\n\t\t\tcase \"0\"://equip\r\n\t\t\t\t{\r\n\t\t\t\t\tif (ItemCategoryInfo.isCashWeapon(id)) {\r\n\t\t\t\t\t\t//this.$$changeLog.weaponType = ss[1];/??\r\n\t\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\r\n\t\t\t\t\tlet task = this.slots._use(id, null, category);\r\n\t\t\t\t\tthis.__load_task.push(task);\r\n\t\t\t\t\tawait task;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (id.startsWith(\"019\")) {\r\n\t\t\t\t\t\tthis.action = this.action;//force update action\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.__update_frag_list();\r\n\t\t\t\t\tthis._calcBoundBox();\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tunuse(id) {\r\n\t\tdebugger;\r\n\t\tif (id[0] == \"0\") {//equip\r\n\t\t\tlet result = this.slots._unuse(id);\r\n\t\t\tif (result) {\r\n\t\t\t\tthis.$$changeLog.unuseEquip.push(id);\r\n\t\t\t\tthis._calcBoundBox();\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\t_parse(code) {\r\n\t\tif (!code) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet es = code.split(\",\");\r\n\t\tthis.slots._clear();\r\n\t\tes.forEach((v, i, a) => {\r\n\t\t\tif (v.indexOf(\"|\") >= 0) {\r\n\t\t\t\tconst ss = v.split(\"|\");\r\n\t\t\t\tconst cate = ItemCategoryInfo.get(ss[0]);\r\n\t\t\t\tlet id;\r\n\t\t\t\tif (cate.slot == \"face\") {\r\n\t\t\t\t\tid = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == \"hair\") {\r\n\t\t\t\t\tconst slots = this.slots;\r\n\t\t\t\t\tlet h2 = ss[1];\r\n\t\t\t\t\tlet h3 = ss[2];\r\n\t\t\t\t\t//\r\n\t\t\t\t\tid = ss[0];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id).then(() => {\r\n\t\t\t\t\t\tif (h2 && h2.indexOf(\"%\") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h2.split(\"%\");\r\n\t\t\t\t\t\t\tconst c2 = hc[0];\r\n\t\t\t\t\t\t\tconst m2 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair2 = c2;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix2 = m2;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor2 = c2;\r\n\t\t\t\t\t\t\tslots.hairMix2 = m2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (h3 && h3.indexOf(\"%\") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h3.split(\"%\");\r\n\t\t\t\t\t\t\tconst c3 = hc[0];\r\n\t\t\t\t\t\t\tconst m3 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair3 = c3;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix3 = m3;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor3 = hc[0];\r\n\t\t\t\t\t\t\tslots.hairMix4 = hc[1] / 100;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == \"weapon\") {\r\n\t\t\t\t\tthis.$$changeLog.weaponType = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\tthis.use.apply(this, ss, ss[1]);//this.use(ss[0], ss[1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (Number.isFinite(parseInt(v, 10))) {\r\n\t\t\t\tthis.use(v);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @type {string} col\r\n\t */\r\n\tget hairColor() {\r\n\t\tif (this.slots.hair) {\r\n\t\t\treturn CharacterRenderConfig.getHairColor(this.slots.hair.id);\r\n\t\t}\r\n\t\treturn \"0\";\r\n\t}\r\n\tset hairColor(col) {\r\n\t\tif (this.slots.hair && col != this.hairColor) {\r\n\t\t\tlet id = CharacterRenderConfig.getColorHairID(this.slots.hair.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} col\r\n\t */\r\n\tget faceColor() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn CharacterRenderConfig.getFaceColor(this.slots.face.id);\r\n\t\t}\r\n\t\treturn \"0\";\r\n\t}\r\n\tset faceColor(col) {\r\n\t\tif (this.slots.face && col != this.faceColor) {\r\n\t\t\tlet id = CharacterRenderConfig.getColorFaceID(this.slots.face.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterChangeLog} changeLog\r\n\t */\r\n\tcommitChange(changeLog) {\r\n\t\tif (changeLog.ear) {\r\n\t\t\tthis.ear = changeLog.ear;\r\n\t\t}\r\n\r\n\t\tif (this.useEquip) {\r\n\t\t\tfor (let id of this.useEquip) {\r\n\t\t\t\tthis.use(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.unuseEquip) {\r\n\t\t\tfor (let id of this.unuseEquip) {\r\n\t\t\t\tthis.unuse(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair2 && changeLog.hairMix2) {\r\n\t\t\tthis.slots.hairColor2 = changeLog.hair2;\r\n\t\t\tthis.slots.hairMix2 = changeLog.hairMix2;\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair3 && changeLog.hairMix3) {\r\n\t\t\t//this.slots.hairColor3 = changeLog.hair3;\r\n\t\t\t//this.slots.hairMix3 = changeLog.hairMix3;\r\n\t\t}\r\n\t\t\r\n\t\tif (changeLog.weapon && changeLog.weaponType) {\r\n\t\t\tthis.use(changeLog.weapon, changeLog.weaponType);\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify(genCode) {\r\n\t\tlet result = this.slots._stringify();\r\n\t\tif (genCode) {\r\n\t\t\treturn `chara._parse('${result}')`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t_outlink_old() {\r\n\t\tif (this.slots.body && this.slots.body.id && this.slots.face && this.slots.face.id && this.action && this.emotion) {\r\n\t\t\tlet link = \"https://labs.maplestory.io/api/GMS/latest/character/center/\" + this.slots.body.id + \"/\";\r\n\t\t\tlet slots = [...this.slots.enumerate()].map(a => parseInt(a.id, 10));\r\n\r\n\t\t\tslots[0] = this.slots.face.id + \":\" + this.emotion;\r\n\r\n\t\t\tlink += slots.join(\",\");\r\n\r\n\t\t\tlink += \"/\" + this.action + \"?showears=\" + (this.elfEar ? \"true\" : \"false\");\r\n\r\n\t\t\tlink += \"&showLefEars=\" + (this.lefEar ? \"true\" : \"false\");\r\n\r\n\t\t\treturn link;\r\n\t\t}\r\n\t\tconsole.log(\"character need body, face, action, emotion\");\r\n\t}\r\n\t\r\n\t_outlink(name) {\r\n\t\tconst animationName = this.action;\r\n\t\tconst frame = this.action_frame;\r\n\t\tconst slots = this.slots;\r\n\t\tconst itemList = JSON.stringify(makeItemList.call());\r\n\t\treturn encodeURI(\r\n\t\t\t\t\"https://maplestory.io/api/character/\" +\r\n\t\t\t\titemList.slice(1, itemList.length - 1) +    // not array\r\n\t\t\t\t\"/\" + animationName + \"/\" + frame + \"?\" +\r\n\t\t\t\t\"showears=\" + this.elfEar +\r\n\t\t\t\t\"&showLefEars=\" + this.lefEar +\r\n\t\t\t\t\"&resize=1\" +\r\n\t\t\t\t(name ? (\"&name=\" + name) : \"\") +\r\n\t\t\t\t\"&flipX=\" + Boolean(this.front > 0) +\r\n\t\t\t\t\"&bgColor=0,0,0,0\"\r\n\t\t\t\t);\r\n\t\tfunction makeItemList() {\r\n\t\t\treturn Object.values(slots).filter(a => a).map(transformItemData);\r\n\t\t}\r\n\t\tfunction transformItemData(item) {\r\n\t\t\tlet region, version;\r\n\t\t\tif (item._raw.info.__v) {\r\n\t\t\t\tconst m = item._raw.info.__v.toUpperCase().match(/([A-Z]*)([0-9]*)/);\r\n\t\t\t\tregion = m[1] == \"TWMS\" ? \"TMS\" : m[1];\r\n\t\t\t\tversion = \"latest\";//m[2];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tregion =\"TMS\";\r\n\t\t\t\tversion = \"latest\";\r\n\t\t\t}\r\n\t\t\tconst filter = item.filter;\r\n\t\t\treturn {\r\n\t\t\t\titemId:        Number(item.id),\r\n\t\t\t\tregion:        region,\r\n\t\t\t\tversion:       version,\r\n\t\t\t\thue:           filter.hue,\r\n\t\t\t\tsaturation:    strNum(filter.sat),\r\n\t\t\t\tbrightness:    strNum(filter.bri),\r\n\t\t\t\tcontrast:      strNum(filter.contrast),\r\n\t\t\t\talpha:         Number(item.opacity.toFixed(1)),\r\n\t\t\t\tanimationName: animationName,\r\n\t\t\t};\r\n\t\t}\r\n\t\tfunction strNum(val) {\r\n\t\t\treturn (val / 100).toFixed(1);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_download() {\r\n\t\twindow.open(this._outlink());\r\n\t}\r\n\r\n\t_save_as_svg() {\r\n\t\tthis.__texture_to_base64().then(frag_list => {\r\n\t\t\tlet file_name = this.id + \".svg\";\r\n\t\t\t//let frag_list = this.__frag_list;\r\n\t\r\n\t\t\tlet svg = '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" >';\r\n\r\n\t\t\tsvg += '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink= \"http://www.w3.org/1999/xlink\">\\n';// width=\"64\" height=\"96\"\r\n\r\n\t\t\tsvg += '<g transform=\"translate(32, 96)\">';\r\n\t\t\tfrag_list.forEach(function (ft) {\r\n\t\t\t\tif (ft && ft.relative) {\r\n\t\t\t\t\tlet clz = ft.classList;\r\n\t\t\t\t\tsvg += `\\t<image class=\"${clz}\" opacity=\"${ft.visible ? ft.opacity : 0}\" x=\"${ft.relative.x}\" y=\"${ft.relative.y}\" width=\"${ft.width}\" height=\"${ft.height}\" xlink:href=\"${ft._url}\"></image>\\n`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsvg += '</g>';\r\n\r\n\t\t\tsvg += '<text x=\"0\" y=\"122\" fill=\"transparent\">' + this._stringify(false) + '</text>';\r\n\r\n\t\t\tsvg += '</svg>';\r\n\r\n\t\t\t//let url = \"data:text/plain;utf8,\" + svg;\r\n\r\n\t\t\tdebugger;\r\n\r\n\t\t\t//window.open(url);\r\n\t\t\tDownloadData(svg, \"image/svg+xml;utf8\", file_name);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \"data:image/png;base64,[...]\"\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} filename\r\n\t * @returns {string}\r\n\t */\r\n\t_save_as_png(renderer, filename) {\r\n\t\tlet bound = this._calcBoundBox();\r\n\t\tlet size = bound.size;\r\n\t\tlet x = -bound.left;\r\n\t\tlet y = bound.height;\r\n\t\tlet angle = 0;\r\n\t\tlet front = false;\r\n\r\n\t\t// use Canvas2, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//save Canvas2 size, current ctx is _ctx2\r\n\t\tconst c2w = renderer._ctx2.canvas.width;\r\n\t\tconst c2h = renderer._ctx2.canvas.height;\r\n\t\t//\r\n\t\trenderer.ctx.canvas.width = size.x;\r\n\t\trenderer.ctx.canvas.height = size.y;\r\n\r\n\t\ttry {\r\n\t\t\tthis._draw(renderer, x, y, angle, front);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\tlet base64 = renderer.ctx.canvas.toDataURL(\"image/png\");\r\n\t\t{\r\n\t\t\tlet elem = document.createElement(\"a\");\r\n\r\n\t\t\tlet name = `${filename ? (filename+\".\"):\"\"}${this.action}[${this.action_frame}].${this.emotion}[${this.emotion_frame}].png`;\r\n\r\n\t\t\telem.id = name;\r\n\t\t\telem.download = name;\r\n\t\t\telem.href = base64;\r\n\r\n\t\t\tdocument.body.appendChild(elem);\r\n\t\t\telem.click();\r\n\t\t\tdocument.body.removeChild(elem);\r\n\t\t}\r\n\r\n\t\t//restore Canvas2 size, current ctx is _ctx2\r\n\t\trenderer.ctx.canvas.width = c2w;\r\n\t\trenderer.ctx.canvas.height = c2h;\r\n\r\n\t\t// restore Canvas, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\treturn base64;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {Promise<FragmentTexture[]>}\r\n\t */\r\n\tasync __texture_to_base64() {\r\n\t\tlet frag_list = this.__frag_list;\r\n\t\tlet tasks = [];\r\n\r\n\t\tfrag_list.forEach(function (ft) {\r\n\t\t\tif (!ft) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!ft._url.startsWith(\"data:\")) {\r\n\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\tft._url = await toDataURL(ft._url);\r\n\t\t\t\t\treturn ft;\r\n\t\t\t\t})());\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttasks.push(ft);\r\n\t\t\t}\r\n\t\t\tif (ft.graph2) {\r\n\t\t\t\tlet src = ft.graph2._url;\r\n\t\t\t\tif (!src.startsWith(\"data:\")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph2._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph2;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ft.graph3) {\r\n\t\t\t\tlet src = ft.graph3._url;\r\n\t\t\t\tif (!src.startsWith(\"data:\")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph3._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph3;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph3);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n}\r\nAddInitTask(CharacterRenderer.Init());\r\n\r\nfunction* circularSequence(length) {\r\n\tlet i = 0;\r\n\tfor (; i < length; ++i) {//a: 0, 1, 2, 3, ...b\r\n\t\tyield i;\r\n\t}\r\n\tfor (i -= 2; i > 0; --i) {//b: 2, 1, ...a\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction* linearSequence(length) {\r\n\tfor (let i = 0; i < length; ++i) {\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction extract_number(input) {\r\n\treturn String(input).match(/(-?\\d+\\.?\\d*)|(\\.\\d*)/g);\r\n}\r\n\r\n/**\r\n * image href to data url\r\n */\r\nfunction toDataURL(url) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.onload = function () {\r\n\t\t\tlet reader = new FileReader();\r\n\t\t\treader.onloadend = function () {\r\n\t\t\t\tresolve(reader.result);\r\n\t\t\t}\r\n\t\t\treader.onerror = function (ev) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\treject(ev);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(xhr.response);\r\n\t\t};\r\n\t\txhr.open('GET', url);\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.send();\r\n\t});\r\n}\r\n","\r\nimport jQuery from \"jquery\";\r\n\r\nimport \"jquery-ui/themes/base/core.css\";\r\nimport \"jquery-ui/themes/base/theme.css\";\r\nimport \"jquery-ui/themes/base/selectable.css\";\r\nimport \"jquery-ui/themes/base/sortable.css\";\r\nimport \"jquery-ui/themes/base/draggable.css\";\r\n\r\nimport \"jquery-ui/ui/core\";\r\nimport \"jquery-ui/ui/widgets/selectable\";\r\nimport \"jquery-ui/ui/widgets/sortable\";\r\nimport \"jquery-ui/ui/widgets/draggable\";\r\nimport \"jquery-ui/ui/disable-selection\";\r\nimport \"jquery-ui/ui/position\";\r\nimport \"jquery-ui/ui/effect\";\r\n\r\nimport { } from \"./util.js\";\r\n\r\nimport Vue from \"vue\";\r\nimport Vuex from \"vuex\";\r\n\r\nVue.config.productionTip = false;\r\nVue.use(Vuex);\r\n\r\nwindow.jQuery = jQuery;\r\nwindow.$ = jQuery;\r\n\r\nif (!window.onwheel) {\r\n\twindow.onwheel = function () {\r\n\t}\r\n}\r\n\r\nlet init_tasks = [];\r\n\r\nexport function AddInitTask(task) {\r\n\tinit_tasks.push(task);\r\n}\r\n\r\nexport function InitAll() {\r\n\tlet a = Promise.all(init_tasks);\r\n\tinit_tasks = [];\r\n\treturn a;\r\n}\r\n","﻿\r\nimport { Vec2, Rectangle } from \"./math.js\";\r\nimport { IGrpah, IRenderer, IGraph } from \"./IRenderer.js\";\r\n\r\nimport { engine, Graph } from \"./Engine.js\";\r\n\r\n\r\n/**\r\n * @extends {IGraph}\r\n */\r\nexport class SpriteBase extends Graph {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tif (raw) {\r\n\t\t\tsuper(url, {\r\n\t\t\t\twidth: raw.__w,\r\n\t\t\t\theight: raw.__h,\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsuper();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._raw = raw;\r\n\t\t\r\n\t\t//this.src is broken;\r\n\r\n\t\tif (url) {\r\n\t\t\tdebugger\r\n\t\t\tthis._url = url;\r\n\t\t\t//this._loadTexture(url);//_loadTexture: undefined\r\n\t\t}\r\n\t\telse if (SpriteBase.isTexture(raw) !== false) {\r\n\t\t\tthis._url = raw[\"\"];\r\n\t\t}\r\n\t}\r\n\r\n\tstatic isTexture(raw) {\r\n\t\tif (raw) {\r\n\t\t\tif (raw.hasOwnProperty(\"\")) {\r\n\t\t\t\tif (typeof raw[\"\"] == 'string') {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (!raw.__isEmpty) {\r\n\t\t\t\t\tconsole.group(\"no texture\");\r\n\t\t\t\t\tconsole.warn(raw);\r\n\t\t\t\t\tconsole.groupEnd();\r\n\t\t\t\t\tthrow new Error(\"no texture\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tstatic isTextureHasData(raw) {\r\n\t\treturn raw && typeof raw[\"\"] == 'string' && raw[\"\"].startsWith(\"data:image/\");\r\n\t}\r\n\r\n\tset z(value) {\r\n\t\tthis._order = value;\r\n\t}\r\n\tget z() {\r\n\t\treturn this._order;\r\n\t}\r\n\t\r\n\t/**\r\n\t * try construct value from raw data\r\n\t * @param {T} defaultValue\r\n\t * @param {string} propertyName\r\n\t * @param {function(any):T} constructor\r\n\t * @returns {T}\r\n\t * @template T\r\n\t */\r\n\t_get(defaultValue, propertyName, converter) {\r\n\t\tif (!this._raw) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\telse if (propertyName in this._raw) {\r\n\t\t\treturn converter(this._raw[propertyName]);\r\n\t\t}\r\n\t\treturn defaultValue;\r\n\t}\r\n\r\n\tdraw() {\r\n\t\tthis._engine.drawGraph(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw2(x, y) {\r\n\t\tthis._engine.drawGraph2(this, x - this.x, y - this.y);\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t */\r\n\tdraw2i(x, y) {\r\n\t\tthis._engine.drawGraph2(this, Math.trunc(x - this.x + 0.5), Math.trunc(y - this.y + 0.5));\r\n\t}\r\n}\r\n\r\n\r\nexport class Sprite extends SpriteBase {\r\n\t/**\r\n\t * sprite = new Sprite(rawData);//不會載入image\r\n\t * sprite._url = img_url;//不會載入image\r\n\t *\r\n\t * 會觸發載入image的method\r\n\t * draw(), isLoaded(), get width(), get height()\r\n\t * \r\n\t * 手動載入image: __loadTexture()\r\n\t * \r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\tvar origin = this._get(new Vec2(0, 0), \"origin\", Vec2.get);\r\n\t\tthis.x = origin.x;\r\n\t\tthis.y = origin.y;\r\n\r\n\t\tthis.z = this._get(0, \"z\", Number);\r\n\r\n\t\tthis.delay = this._get(100, \"delay\", Number);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(x, y, w, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tctx.rect(x, y, w, h);\r\n\t\t\tctx.clip();\r\n\r\n\t\t\tlet left = x;\r\n\t\t\tlet top = y;\r\n\t\t\tlet right = x + w;\r\n\t\t\tlet bottom = y + h;\r\n\r\n\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t */\r\n\tdrawHorizontalPattern(x, y, w) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tconst left = x;\r\n\t\t\tconst right = x + w;\r\n\r\n\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\tthis.draw2(j, y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} h\r\n\t */\r\n\tdrawVerticalPattern(x, y, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tctx.save();\r\n\t\ttry {\r\n\t\t\tconst top = y;\r\n\t\t\tconst bottom = y + h;\r\n\r\n\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\tthis.draw2(x, i);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tctx.restore();\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\t_drawPattern(x, y, w, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t\r\n\t\tconst sw = Math.trunc(w / this.width) * this.width;\r\n\t\tconst sh = Math.trunc(h / this.height) * this.height;\r\n\t\t\r\n\t\tconst left = x;\r\n\t\tconst top = y;\r\n\t\tconst right = x + sw;\r\n\t\tconst bottom = y + h;\r\n\r\n\t\tlet i, j;\r\n\r\n\t\tif (h >= this.height) {\r\n\t\t\tfor (i = top; i < bottom; i += this.height) {\r\n\t\t\t\tif (w >= this.width) {\r\n\t\t\t\t\tfor (j = left; j < right; j += this.width) {\r\n\t\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet sx = w - sw;\r\n\t\t\t\t\tif (sx > 0) {\r\n\t\t\t\t\t\tthis._engine._drawImage(this, 0, 0, sx, this.height, j - this.x, i - this.y, sx, this.height);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._engine._drawImage(this, 0, 0, w, this.height, left - this.x, i - this.y, w, this.height);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet sy = h - sh;\r\n\t\t\tif (sy > 0) {\r\n\t\t\t\tconsole.error(new Error(\"未完成\"));\r\n\t\t\t\tthis._engine._drawImage(this, 0, 0, this.width, sy, left - this.x, i - this.y, this.width, sy);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(new Error(\"未完成\"));\r\n\t\t\tthis._engine._drawImage(this, 0, 0, this.width, h, left - this.x, top - this.y, this.width, h);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t */\r\n\t_drawHorizontalPattern(x, y, w) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tconst left = x;\r\n\t\tconst right = x + w;\r\n\r\n\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\tthis.draw2(j, y);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} h\r\n\t */\r\n\t_drawVerticalPattern(x, y, h) {\r\n\t\tif (!this.isLoaded()) {\r\n\t\t\treturn;//sprite require property: width, height\r\n\t\t}\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\tconst top = y;\r\n\t\tconst bottom = y + h;\r\n\r\n\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\tthis.draw2(x, i);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\tdrawPattern4i(x, y, w, h) {\r\n\t\tthis.drawPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t */\r\n\tdrawHorizontalPattern3i(x, y, w) {\r\n\t\tthis.drawHorizontalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5));\r\n\t}\r\n\t/**\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\tdrawVerticalPattern3i(x, y, h) {\r\n\t\tthis.drawVerticalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\t_drawPattern4i(x, y, w, h) {\r\n\t\tthis._drawPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} w - type: int\r\n\t */\r\n\t_drawHorizontalPattern3i(x, y, w) {\r\n\t\tthis._drawHorizontalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(w + 0.5));\r\n\t}\r\n\t/**\r\n\t * without clip\r\n\t * @param {number} x - type: int\r\n\t * @param {number} y - type: int\r\n\t * @param {number} h - type: int\r\n\t */\r\n\t_drawVerticalPattern3i(x, y, h) {\r\n\t\tthis._drawVerticalPattern(Math.trunc(x + 0.5), Math.trunc(y + 0.5), Math.trunc(h + 0.5));\r\n\t}\r\n}\r\n\r\nexport class _$PatternSprite_Loaded extends Sprite {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {string=} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._direction = null;\r\n\r\n\t\t/** @type {CanvasPattern} */\r\n\t\tthis._pattern = null;\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget direction() {\r\n\t\treturn this._direction;\r\n\t}\r\n\tset direction(value) {\r\n\t\tif (value && this._direction != value) {\r\n\t\t\tthis._direction = value;\r\n\t\r\n\t\t\t//reload;\r\n\t\t\tthis._pattern = null;\r\n\t\t\tthis.__proto__ = $PatternSprite.prototype;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(w, h) {\r\n\t\tif (this.direction && this._pattern) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tctx.rect(-this.x, -this.y, w, h);\r\n\t\t\tctx.fillStyle = this._pattern;\r\n\t\t\tctx.fill();\r\n\t\t\tctx.fillStyle = \"no-repeat\";\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.direction && this._pattern) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tctx.rect(x - this.x, y - this.y, w, h);\r\n\t\t\tctx.fillStyle = this._pattern;\r\n\t\t\tctx.fill();\r\n\t\t\tctx.fillStyle = \"no-repeat\";\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {\"repeat\"} */\r\n\tget e_repeat() {\r\n\t\treturn \"repeat\";\r\n\t}\r\n\t/** @returns {\"repeat-x\"} */\r\n\tget e_repeat_x() {\r\n\t\treturn \"repeat-x\";\r\n\t}\r\n\t/** @returns {\"repeat-y\"} */\r\n\tget e_repeat_y() {\r\n\t\treturn \"repeat-y\";\r\n\t}\r\n\t/** @returns {\"no-repeat\"} */\r\n\tget e_noRepeat() {\r\n\t\treturn \"no-repeat\";\r\n\t}\r\n}\r\n\r\nexport class $PatternSprite extends _$PatternSprite_Loaded {\r\n\tdrawPattern(w, h) {\r\n\t\tthis.drawPattern2(0, 0, w, h);\r\n\t}\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.isLoaded()) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\r\n\t\t\tctx.save();\r\n\t\t\t{\r\n\t\t\t\tctx.rect(x, y, w, h);\r\n\t\t\t\tctx.clip();\r\n\t\t\t\t\r\n\t\t\t\tlet left = x;\r\n\t\t\t\tlet top = y;\r\n\t\t\t\tlet right = x + w;\r\n\t\t\t\tlet bottom = y + h;\r\n\r\n\t\t\t\tfor (let i = top; i < bottom; i += this.height) {\r\n\t\t\t\t\tfor (let j = left; j < right; j += this.width) {\r\n\t\t\t\t\t\tthis.draw2(j, i);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern(w, h) {\r\n\t\tif (this.direction) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tif (!this._pattern) {\r\n\t\t\t\tif (this.isLoaded()) {\r\n\t\t\t\t\tthis._pattern = ctx.createPattern(this.texture, this.direction);\r\n\t\t\t\t\tthis.__proto__ = _$PatternSprite_Loaded.prototype;\r\n\t\t\t\t\tthis.drawPattern(w, h);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} w\r\n\t * @param {number} h\r\n\t */\r\n\tdrawPattern2(x, y, w, h) {\r\n\t\tif (this.direction) {\r\n\t\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\t\tconst ctx = this._engine.ctx;\r\n\t\r\n\t\t\tif (!this._pattern) {\r\n\t\t\t\tif (this.isLoaded()) {\r\n\t\t\t\t\tthis._pattern = ctx.createPattern(this.texture, this.direction);\r\n\t\t\t\t\tthis.__proto__ = _$PatternSprite_Loaded.prototype;\r\n\t\t\t\t\tthis.drawPattern2(x, y, w, h);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","﻿\r\nconst $failed_urls = [];\r\n\r\nconst $archive = {};\r\n\r\n\r\nwindow.character_emotion_list = [\"blink\", \"hit\", \"smile\", \"troubled\", \"cry\", \"angry\", \"bewildered\", \"stunned\",\r\n\t\"vomit\", \"oops\", \"cheers\", \"chu\", \"wink\", \"pain\", \"glitter\", \"despair\", \"love\", \"shine\", \"blaze\", \"hum\",\r\n\t\"bowing\", \"hot\", \"dam\", \"qBlue\"];\r\n\r\nwindow.character_action_list = [\"walk1\", \"walk2\", \"stand1\", \"stand2\", \"alert\", \"swingO1\", \"swingO2\", \"swingO3\", \"swingOF\", \"swingT1\",\r\n\t\"swingT2\", \"swingT3\", \"swingTF\", \"swingP1\", \"swingP2\", \"swingPF\", \"stabO1\", \"stabO2\", \"stabOF\", \"stabT1\",\r\n\t\"stabT2\", \"stabTF\", \"shoot1\", \"shoot2\", \"shootF\", \"proneStab\", \"prone\", \"heal\", \"fly\", \"jump\", \"sit\", \"ladder\",\r\n\t\"rope\"/*, \"dead\", \"ghostwalk\", \"ghoststand\", \"ghostjump\", \"ghostproneStab\", \"ghostladder\", \"ghostrope\", \"ghostfly\",\r\n\t\t\"ghostsit\"*/];\r\n\r\nexport class ItemCategoryInfo {\r\n\t/**\r\n\t * @param {string} id_prefix\r\n\t * @param {string} path\r\n\t * @param {boolean} isOnFace\r\n\t * @param {string} slot - property name\r\n\t * @param {string} categoryName\r\n\t * @param {string} type\r\n\t * @param {string} [stringPath]\r\n\t */\r\n\tconstructor(id_prefix, imgDir, listPath, slot, categoryName, type, stringPath) {\r\n\t\tthis.id_prefix = id_prefix;\r\n\r\n\t\t/** data path */\r\n\t\tthis.path = imgDir;\r\n\r\n\t\t/** equip window */\r\n\t\tthis.slot = slot;\r\n\r\n\t\t/** item list file name */\r\n\t\tthis.listPath = listPath;\r\n\r\n\t\t/** display category name */\r\n\t\tthis.categoryName = categoryName;\r\n\r\n\t\t/** renderer */\r\n\t\tthis.FragmentType = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.dataDir = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.stringDir = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.iconPath = null;\r\n\t\t/** @type {string} */\r\n\t\tthis.iconRawPath = null;\r\n\t\t{\r\n\t\t\tlet dataDir, stringDir, iconPath, iconRawPath;\r\n\r\n\t\t\tswitch (slot) {\r\n\t\t\t\tcase \"head\":\r\n\t\t\t\t\ticonPath = \"stand1/0/head\";\r\n\t\t\t\t\ticonRawPath = \"stand1/0/head\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"body\":\r\n\t\t\t\t\ticonPath = \"stand1/0/body\";\r\n\t\t\t\t\ticonRawPath = \"stand1/0/body\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hair\":\r\n\t\t\t\t\ticonPath = \"stand1/0/hair\";\r\n\t\t\t\t\ticonRawPath = \"stand1/0/hair\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"face\":\r\n\t\t\t\t\ticonPath = \"blink/0/face\";\r\n\t\t\t\t\ticonRawPath = \"blink/0/face\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault: // typeId: 0|1|2|3|4\r\n\t\t\t\t\ticonPath = \"info/icon\";\r\n\t\t\t\t\ticonRawPath = \"info/iconRaw\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (id_prefix == \"5\") {\r\n\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\tstringDir = \"/String/Pet/\";\r\n\t\t\t\talert(\"Pet\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tswitch (id_prefix[1]) {\r\n\t\t\t\t\tcase \"0\":\r\n\t\t\t\t\t\tif (Math.trunc(id_prefix) <= 1) {\r\n\t\t\t\t\t\t\tdataDir = \"/Character/\";\r\n\t\t\t\t\t\t\tstringDir = null;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tcase \"1\":\r\n\t\t\t\t\t\tlet s = imgDir + (imgDir ? \"/\" : \"\");\r\n\t\t\t\t\t\tdataDir = \"/Character/\" + s;\r\n\t\t\t\t\t\tstringDir = \"/String/Eqp/Eqp/\" + (stringPath || s);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"2\":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = \"/String/Consume/\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"3\":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = \"/String/Ins/\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"4\":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = \"/String/Etc/\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"5\":\r\n\t\t\t\t\t\tdataDir = `/Item/${imgDir}/${id_prefix}/`;\r\n\t\t\t\t\t\tstringDir = \"/String/Cash/\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"unknow item type, param: %o\", [id_prefix, imgDir, listPath, slot, categoryName, type]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tObject.defineProperties(this, {\r\n\t\t\t\t\"type\": {\r\n\t\t\t\t\tvalue: type,\r\n\t\t\t\t},\r\n\t\t\t\t\"dataDir\": {\r\n\t\t\t\t\tvalue: dataDir,\r\n\t\t\t\t},\r\n\t\t\t\t\"stringDir\": {\r\n\t\t\t\t\tvalue: stringDir,\r\n\t\t\t\t},\r\n\t\t\t\t\"iconPath\": {\r\n\t\t\t\t\tvalue: iconPath,\r\n\t\t\t\t},\r\n\t\t\t\t\"iconRawPath\": {\r\n\t\t\t\t\tvalue: iconRawPath,\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * load equip or item, name and desc\r\n\t * @param {string} itemId\r\n\t * @returns {{info:{icon:{[\"\"]:string},iconRaw:{[\"\"]:string}},name:string,desc:string,[prop:string]:any}}\r\n\t */\r\n\tstatic async getItem(itemId) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(itemId);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet id = itemId.padStart(8, \"0\");\r\n\t\tif (id[0] != \"0\") {\r\n\t\t\tthrow new Error(\"itemId: \" + itemId);\r\n\t\t}\r\n\r\n\t\tlet results;\r\n\t\ttry {\r\n\t\t\tresults = await Promise.all([\r\n\t\t\t\t$get.data(info.dataDir + itemId),\r\n\t\t\t\tinfo.stringDir ? $get.data(info.stringDir + Number(itemId)).then(\r\n\t\t\t\t\ta => a, // have name or desc\r\n\t\t\t\t\t() => { return { name: \"<\" + itemId + \">\" }; } // no name and desc\r\n\t\t\t\t) : { name: \"<\" + itemId + \">\" } // no name and desc\r\n\t\t\t]);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow new ex;\r\n\t\t}\r\n\r\n\t\tlet data = Object.assign(results[0], results[1]);\r\n\t\t\r\n\t\tdata.id = itemId;\r\n\r\n\t\tif (data.info) {\r\n\t\t\t{//editor mode data\r\n\t\t\t\tdata.info.id = itemId;\r\n\t\t\t\tdata.info.name = data.name;\r\n\t\t\t\tif (data.desc) {\r\n\t\t\t\t\tdata.info.desc = data.desc;\r\n\t\t\t\t}\r\n\t\t\t\tdata.info.__v = window.DATA_TAG + window.DATA_VERSION;\r\n\t\t\t}\r\n\r\n\t\t\tif (!data.info.icon) {\r\n\t\t\t\tdata.info.icon = {};\r\n\t\t\t}\r\n\t\t\tif (!data.info.iconRaw) {\r\n\t\t\t\tdata.info.iconRaw = {};\r\n\t\t\t}\r\n\t\t\tif (!data.info.icon[\"\"]) {\r\n\t\t\t\tdata.info.icon[\"\"] = ItemCategoryInfo.getIconUrl(itemId);\r\n\t\t\t}\r\n\t\t\tif (data.info.iconRaw[\"\"]) {\r\n\t\t\t\tdata.info.iconRaw[\"\"] = ItemCategoryInfo.getIconRawUrl(itemId);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string|null}\r\n\t */\r\n\tstatic getIconRawUrl(id) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(id);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (id[0] == \"0\") {\r\n\t\t\t//TODO: return path, not url\r\n\t\t\treturn info.dataDir + id + \"/\" + info.iconRawPath;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string|null}\r\n\t */\r\n\tstatic getIconUrl(id) {\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tlet info = ItemCategoryInfo.get(id);\r\n\t\tif (!info) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (id[0] == \"0\") {\r\n\t\t\t//TODO: return path, not url\r\n\t\t\treturn info.dataDir + id + \"/\" + info.iconPath;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - 4+ digit string\r\n\t * @returns {ItemCategoryInfo}\r\n\t */\r\n\tstatic get(id) {\r\n\t\tlet info;\r\n\r\n\t\tif (id == null || id == \"\") {\r\n\t\t\tdebugger;\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\r\n\t\tif (id[0] == \"0\") {\r\n\t\t\tif (id.length == 4) {\r\n\t\t\t\tinfo = ItemCategoryInfo._info[id];\r\n\t\t\t\tif (info) {\r\n\t\t\t\t\treturn info;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (id.length == 6) {\r\n\t\t\t\treturn ItemCategoryInfo._info[id];\r\n\t\t\t}\r\n\t\t\telse if (id.length == 3) {\r\n\t\t\t\treturn ItemCategoryInfo._info[id];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 4)];\r\n\t\t\t\tif (info) {\r\n\t\t\t\t\treturn info;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 6)];\r\n\t\t\t\t\tif (info) {\r\n\t\t\t\t\t\treturn info;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tinfo = ItemCategoryInfo._info[id.slice(0, 3)];//019\r\n\t\t\t\t\t\tif (info) {\r\n\t\t\t\t\t\t\treturn info;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tconsole.warn(\"unknow item type, itemId: \" + id);\r\n\t\treturn null;\r\n\t}\r\n\r\n\tstatic getTypeId() {\r\n\t\treturn Math.trunc(_id / 1000000);\r\n\t}\r\n\r\n\tstatic getCategory() {\r\n\t\treturn Math.trunc(_id / 10000);// % 100;// 0105 // 01 + 05 // type + category\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - char[4]: type; char[4+]: itemId\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isItem(id) {\r\n\t\tlet type = Math.trunc(id / 1000000);//id.startsWith(\"00\");\r\n\t\treturn type != 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id - char[4]: type; char[4+]: itemId\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isEquip(id) {\r\n\t\tif (!id) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\t\tlet _id = Number(id);\r\n\r\n\t\tif (!Number.isSafeInteger(_id)) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\r\n\t\t//let cate = Number(id.length == 4 ? id : id.slice(0, 4));\r\n\t\t//return (cate >= \"0100\" && cate < \"0180\");\r\n\r\n\t\t//let cate = Math.trunc(_id / 10000);\r\n\t\t//if (cate >= 180 && cate < 2000) {\r\n\t\t//\tconsole.warn(\"?? equip: \" + id);\r\n\t\t//\tdebugger;\r\n\t\t//}\r\n\r\n\t\tlet type = Math.trunc(_id / 1000000);\r\n\r\n\t\treturn type == 1;\r\n\t}\r\n\r\n\tstatic isChair(id) {\r\n\t\tif (!id) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\t\tlet _id = Number(id);\r\n\r\n\t\tif (!Number.isSafeInteger(_id)) {\r\n\t\t\tthrow TypeError();\r\n\t\t}\r\n\r\n\t\tlet cate = Math.trunc(_id / 10000);\r\n\r\n\t\treturn cate == 301;//0301xxxx\r\n\t}\r\n\r\n\t/**\r\n\t * 1~4 digit number\r\n\t * @param {string} itemId\r\n\t */\r\n\tstatic getSubCategory(itemId) {\r\n\t\treturn Math.trunc(itemId / 10000);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} itemId\r\n\t */\r\n\tstatic isCashWeapon(itemId) {\r\n\t\treturn Math.trunc(itemId / 10000) == 170;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} job\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getJobWeaponCategory(job) {\r\n\t\t//TODO: getJobWeaponCategory\r\n\t\tconsole.warn(\"getJobWeaponCategory: 未完成\");\r\n\t}\r\n}\r\nwindow.$ItemCategoryInfo = ItemCategoryInfo;\r\nItemCategoryInfo.type = {\r\n\tEquip: \"Equip\",\r\n\tConsume: \"Consume\",\r\n\tEtc: \"Etc\",\r\n\tInstall: \"Install\",\r\n\tCash: \"Cash\"\r\n};\r\nItemCategoryInfo.typeName = {\r\n\t0: \"Equip\",\r\n\t1: \"Consume\",\r\n\t2: \"Etc\",\r\n\t3: \"Install\",\r\n\t4: \"Cash\"\r\n};\r\nItemCategoryInfo.typeId = {\r\n\tEquip: 0,\r\n\tConsume: 1,\r\n\tEtc: 2,\r\n\tInstall: 3,\r\n\tCash: 4,\r\n};\r\nItemCategoryInfo._info = {\r\n\t\"0000\": new ItemCategoryInfo(\"0000\", \"\",\t\t\t\"body\",\t\t\t\t\"body\",\t\t\t\"<body>\", \"Equip\"),\r\n\t\"0001\": new ItemCategoryInfo(\"0001\", \"\",\t\t\t\"head\",\t\t\t\t\"head\",\t\t\t\"<head>\", \"Equip\"),\r\n\r\n\t\"0002\": new ItemCategoryInfo(\"0002\", \"Face\",\t\t\"Face\",\t\t\t\t\"face\",\t\t\t\"臉型\", \"Equip\"),\r\n\t\"0003\": new ItemCategoryInfo(\"0003\", \"Hair\",\t\t\"Hair\",\t\t\t\t\"hair\",\t\t\t\"髮型\", \"Equip\"),\r\n\t\"0004\": new ItemCategoryInfo(\"0004\", \"Hair\",\t\t\"Hair\",\t\t\t\t\"hair\",\t\t\t\"髮型\", \"Equip\"),\r\n\r\n\t\"0100\": new ItemCategoryInfo(\"0100\", \"Cap\",\t\t\t\"Cap\",\t\t\t\t\"cap\",\t\t\t\"帽子\", \"Equip\"),\r\n\t\"0101\": new ItemCategoryInfo(\"0101\", \"Accessory\",\t\"accessoryFace\",\t\"accessoryFace\", \"臉飾\", \"Equip\"),\r\n\t\"0102\": new ItemCategoryInfo(\"0102\", \"Accessory\",\t\"accessoryEyes\",\t\"accessoryEyes\", \"眼飾\", \"Equip\"),\r\n\t\"0103\": new ItemCategoryInfo(\"0103\", \"Accessory\",\t\"accessoryEars\",\t\"accessoryEars\", \"耳環\", \"Equip\"),\r\n\t\"0104\": new ItemCategoryInfo(\"0104\", \"Coat\",\t\t\"Coat\",\t\t\t\t\"coat\",\t\t\t\"上衣\", \"Equip\"),\r\n\t\"0105\": new ItemCategoryInfo(\"0105\", \"Longcoat\",\t\"Longcoat\",\t\t\t\"longcoat\",\t\t\"套服\", \"Equip\"),\r\n\t\"0106\": new ItemCategoryInfo(\"0106\", \"Pants\",\t\t\"Pants\",\t\t\t\"pants\",\t\t\"褲子\", \"Equip\"),\r\n\t\"0107\": new ItemCategoryInfo(\"0107\", \"Shoes\",\t\t\"Shoes\",\t\t\t\"shoes\",\t\t\"鞋子\", \"Equip\"),\r\n\t\"0108\": new ItemCategoryInfo(\"0108\", \"Glove\",\t\t\"Glove\",\t\t\t\"glove\",\t\t\"手套\", \"Equip\"),\r\n\t\"0109\": new ItemCategoryInfo(\"0109\", \"Shield\",\t\t\"Shield\",\t\t\t\"shield\",\t\t\"盾牌\", \"Equip\"),\r\n\t\"0110\": new ItemCategoryInfo(\"0110\", \"Cape\",\t\t\"Cape\",\t\t\t\t\"cape\",\t\t\t\"披風\", \"Equip\"),\r\n\r\n\t\"0121\": new ItemCategoryInfo(\"0121\", \"Weapon\", \"閃亮克魯\", \"weapon\", \"閃亮克魯\", \"Equip\"),\r\n\t\"0122\": new ItemCategoryInfo(\"0122\", \"Weapon\", \"靈魂射手\", \"weapon\", \"靈魂射手\", \"Equip\"),\r\n\t\"0123\": new ItemCategoryInfo(\"0123\", \"Weapon\", \"魔劍\", \"weapon\", \"魔劍\", \"Equip\"),\r\n\t\"0124\": new ItemCategoryInfo(\"0124\", \"Weapon\", \"能量劍\", \"weapon\", \"能量劍\", \"Equip\"),\r\n\t\"0125\": new ItemCategoryInfo(\"0125\", \"Weapon\", \"幻獸棒\", \"weapon\", \"幻獸棒\", \"Equip\"),\r\n\t\"0126\": new ItemCategoryInfo(\"0126\", \"Weapon\", \"ESP限制器\", \"weapon\", \"ESP限制器\", \"Equip\"),\r\n\t\"0127\": new ItemCategoryInfo(\"0127\", \"Weapon\", \"鎖鏈\", \"weapon\", \"鎖鏈\", \"Equip\"),\r\n\t\"0128\": new ItemCategoryInfo(\"0128\", \"Weapon\", \"魔力護腕\", \"weapon\", \"魔力護腕\", \"Equip\"),\r\n\r\n\t\"0130\": new ItemCategoryInfo(\"0130\", \"Weapon\", \"單手劍\", \"weapon\", \"單手劍\", \"Equip\"),\r\n\t\"0131\": new ItemCategoryInfo(\"0131\", \"Weapon\", \"單手斧\", \"weapon\", \"單手斧\", \"Equip\"),\r\n\t\"0132\": new ItemCategoryInfo(\"0132\", \"Weapon\", \"單手錘\", \"weapon\", \"單手錘\", \"Equip\"),\r\n\t\"0133\": new ItemCategoryInfo(\"0133\", \"Weapon\", \"短劍\", \"weapon\", \"短劍\", \"Equip\"),\r\n\t\"0134\": new ItemCategoryInfo(\"0134\", \"Weapon\", \"雙刀\", \"weapon\", \"雙刀\", \"Equip\"),\r\n\t\"013526\": new ItemCategoryInfo(\"013526\", \"Weapon\", \"靈魂之環\", \"weapon\", \"靈魂之環\", \"Equip\"),\r\n\t\"013530\": new ItemCategoryInfo(\"013530\", \"Weapon\", \"控制器\", \"weapon\", \"控制器\", \"Equip\"),\r\n\t\"0136\": new ItemCategoryInfo(\"0136\", \"Weapon\", \"手杖\", \"weapon\", \"手杖\", \"Equip\"),\r\n\t\"0137\": new ItemCategoryInfo(\"0137\", \"Weapon\", \"短杖\", \"weapon\", \"短杖\", \"Equip\"),\r\n\t\"0138\": new ItemCategoryInfo(\"0138\", \"Weapon\", \"長杖\", \"weapon\", \"長杖\", \"Equip\"),\r\n\t\r\n\t\"0140\": new ItemCategoryInfo(\"0140\", \"Weapon\", \"雙手劍\", \"weapon\", \"雙手劍\", \"Equip\"),\r\n\t\"0141\": new ItemCategoryInfo(\"0141\", \"Weapon\", \"雙手斧\", \"weapon\", \"雙手斧\", \"Equip\"),\r\n\t\"0142\": new ItemCategoryInfo(\"0142\", \"Weapon\", \"雙手棍\", \"weapon\", \"雙手棍\", \"Equip\"),\r\n\t\"0143\": new ItemCategoryInfo(\"0143\", \"Weapon\", \"槍\", \"weapon\", \"槍\", \"Equip\"),\r\n\t\"0144\": new ItemCategoryInfo(\"0144\", \"Weapon\", \"矛\", \"weapon\", \"矛\", \"Equip\"),\r\n\t\"0145\": new ItemCategoryInfo(\"0145\", \"Weapon\", \"弓\", \"weapon\", \"弓\", \"Equip\"),\r\n\t\"0146\": new ItemCategoryInfo(\"0146\", \"Weapon\", \"弩\", \"weapon\", \"弩\", \"Equip\"),\r\n\t\"0147\": new ItemCategoryInfo(\"0147\", \"Weapon\", \"拳套\", \"weapon\", \"拳套\", \"Equip\"),\r\n\t\"0148\": new ItemCategoryInfo(\"0148\", \"Weapon\", \"指虎\", \"weapon\", \"指虎\", \"Equip\"),\r\n\t\"0149\": new ItemCategoryInfo(\"0149\", \"Weapon\", \"火槍\", \"weapon\", \"火槍\", \"Equip\"),\r\n\t\"0150\": new ItemCategoryInfo(\"0150\", \"Weapon\", \"鏟\", \"weapon\", \"鏟\", \"Equip\"),\r\n\t\"0151\": new ItemCategoryInfo(\"0151\", \"Weapon\", \"鎬\", \"weapon\", \"鎬\", \"Equip\"),\r\n\t\"0152\": new ItemCategoryInfo(\"0152\", \"Weapon\", \"雙弩槍\", \"weapon\", \"雙弩槍\", \"Equip\"),\r\n\t\"0153\": new ItemCategoryInfo(\"0153\", \"Weapon\", \"加農砲\", \"weapon\", \"加農砲\", \"Equip\"),\r\n\t\"0154\": new ItemCategoryInfo(\"0154\", \"Weapon\", \"太刀\", \"weapon\", \"太刀\", \"Equip\"),\r\n\t\"0155\": new ItemCategoryInfo(\"0155\", \"Weapon\", \"扇子\", \"weapon\", \"扇子\", \"Equip\"),\r\n\t\"0156\": new ItemCategoryInfo(\"0156\", \"Weapon\", \"琉\", \"weapon\", \"琉\", \"Equip\"),\r\n\t\"0157\": new ItemCategoryInfo(\"0157\", \"Weapon\", \"璃\", \"weapon\", \"璃\", \"Equip\"),\r\n\t\"0158\": new ItemCategoryInfo(\"0158\", \"Weapon\", \"重拳槍\", \"weapon\", \"重拳槍\", \"Equip\"),\r\n\t\"0170\": new ItemCategoryInfo(\"0170\", \"Weapon\", \"0170\", \"weapon\", \"點裝武器\", \"Equip\"),\r\n\t\"019\": new ItemCategoryInfo(\"019\", \"TamingMob\", \"TamingMob\", \"tamingMob\", \"騎寵\", \"Equip\", \"Taming/\"),\r\n\r\n\t\"0301\": new ItemCategoryInfo(\"0301\", \"Install\", \"Chair\", \"install\", \"椅子\", \"Item\"),\r\n};\r\n\r\nItemCategoryInfo._categoryList = (function (info_map) {\r\n\tlet list = [];\r\n\tlet set = new Set();\r\n\tfor (let i in info_map) {\r\n\t\tlet cat = info_map[i];\r\n\t\tlet key = cat.categoryName || cat.listPath;\r\n\r\n\t\tif (!set.has(key)) {\r\n\t\t\tset.add(key);\r\n\r\n\t\t\tlist.push({\r\n\t\t\t\tkey: key,\r\n\t\t\t\tvalue: i,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n})(ItemCategoryInfo._info);\r\n\r\nexport class ResourceManager {\r\n\tstatic isEquipExist(id, cateInfo) {\r\n\t\tconst dp = cateInfo.listPath;\r\n\t\tconst es = ResourceManager.equip_map[dp];\r\n\t\treturn !es || es.has(id);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} url\r\n\t */\r\n\tstatic async loadArchive(url) {\r\n\t\t$setValue($archive, \"/\", JSON.parse(await ResourceManager.get(url)));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} url\r\n\t */\r\n\tstatic get(url) {\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tlet xhr = new XMLHttpRequest();\r\n\t\t\txhr.open(\"GET\", url, true);\r\n\r\n\t\t\txhr.timeout = 10 * 60 * 1000;//20000;\r\n\r\n\t\t\txhr.onload = function () {\r\n\t\t\t\tif (this.status == 404 || this.status == 500) {\r\n\t\t\t\t\t$failed_urls.push(url);\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\t//resolve(null);\r\n\t\t\t\t\treject(this.status + \": \" + url);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.status == 200) {\r\n\t\t\t\t\tresolve(this.responseText);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.status == 304) {\r\n\t\t\t\t\tdebugger\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\txhr.ontimeout = function (e) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\t// XMLHttpRequest 超时。在此做某事。\r\n\t\t\t\t//resolve(null);\r\n\t\t\t\treject(\"timeout: \" + url);\r\n\t\t\t};\r\n\r\n\t\t\txhr.onabort = function (e) {\r\n\t\t\t\treject(\"abort: \" + url);\r\n\t\t\t};\r\n\r\n\t\t\txhr.send();\r\n\t\t});\r\n\t}\r\n\r\n\tstatic get root_path() {\r\n\t\treturn window.$ROOT_PATH;\r\n\t}\r\n\r\n\tstatic get archive() {\r\n\t\treturn $archive;\r\n\t}\r\n\r\n\tstatic get failed_urls() {\r\n\t\treturn $failed_urls;\r\n\t}\r\n}\r\nwindow.$ResourceManager = ResourceManager;\r\n\r\n/**\r\n * @param {{}} obj\r\n * @param {string} path\r\n * @param {any} value\r\n */\r\nfunction $setValue(obj, path, value) {\r\n\tif (path.endsWith(\"/\")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\tlet ps = path.split(\"/\");\r\n\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\tlet key = ps[i];\r\n\t\tif (target[key] == null) {\r\n\t\t\ttarget[key] = {};\r\n\t\t}\r\n\t\ttarget = target[key];\r\n\t}\r\n\tlet origin_value = target[ps[lastIndex]];\r\n\tif (origin_value instanceof Promise) {\r\n\t\tdelete target[ps[lastIndex]];\r\n\t\ttarget[ps[lastIndex]] = value;\r\n\t}\r\n\telse if (origin_value && typeof origin_value == \"object\") {\r\n\t\t//if (value instanceof Promise) {\r\n\t\t//\tdebugger;\r\n\t\t//}\r\n\t\t//else {\r\n\t\t\tfor (let key in value) {\r\n\t\t\t\torigin_value[key] = value[key] || origin_value[key];\r\n\t\t\t}\r\n\t\t//}\r\n\t}\r\n\telse if (typeof value != \"undefined\") {\r\n\t\ttarget[ps[lastIndex]] = value;\r\n\t}\r\n}\r\nfunction $getValue(obj, path) {\r\n\tif (path.endsWith(\"/\")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\tlet ps = path.split(\"/\");\r\n\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\tlet key = ps[i];\r\n\t\tif (target[key]) {\r\n\t\t\t\ttarget = target[key];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\treturn target[ps[lastIndex]];\r\n}\r\n\r\nconst symbol_isPack = Symbol(\"$pack\");\r\n\r\nconst url_startsWith_protocol = RegExp.prototype.test.bind(/^(([a-zA-Z^\\:]+)(\\:.*)$|\\/\\/)/);\r\nfunction _setValueByPath(path, value, is_pack) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn;\r\n\t}\r\n\telse if (window.$ROOT_PATH != \"\" && path.startsWith(window.$ROOT_PATH)) {\r\n\t\tif (is_pack) {\r\n\t\t\tvalue[symbol_isPack] = true;\r\n\t\t}\r\n\t\tpath = path.slice(window.$ROOT_PATH.length);\r\n\t\treturn $setValue($archive, path, value);\r\n\t}\r\n\telse {\r\n\t\treturn $setValue($archive, path, value);\r\n\t}\r\n}\r\nfunction _getValueFromArchiveByPath(path, value) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tif (_path) {\r\n\t\treturn $getValue($archive, _path);\r\n\t}\r\n\treturn undefined;\r\n}\r\nfunction _getDataPathByUrl(path) {\r\n\tif (!url_startsWith_protocol(path)) {\r\n\t\tif (window.$ROOT_PATH != \"\" && path.startsWith(window.$ROOT_PATH)) {\r\n\t\t\treturn path.slice(window.$ROOT_PATH.length);\r\n\t\t}\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\n/**\r\n * @returns {Promise<any>|any}\r\n */\r\nfunction $getValueAsync(obj, path) {\r\n\tif (path.endsWith(\"/\")) {\r\n\t\tpath = path.slice(0, path.length - 1);\r\n\t}\r\n\t\r\n\t// try get value sync\r\n\tlet value = $getValue(obj, path);\r\n\t\r\n\t// if value exist\r\n\tif (value) {\r\n\t\tif (value instanceof Promise) {\r\n\t\t\t// ??\r\n\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\tawait value;\r\n\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn value;\r\n\t\t}\r\n\t}\r\n\telse {// if value not exist, try await parent node\r\n\t\tlet ps = path.split(\"/\");\r\n\t\tlet i, target = obj, lastIndex = ps.length - 1;\r\n\t\tfor (i = 0; i < lastIndex; ++i) {\r\n\t\t\tlet key = ps[i];\r\n\t\t\tif (target[key] instanceof Promise) {\r\n\t\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\t\tawait target[key];\r\n\t\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif (target[key]) {\r\n\t\t\t\t\ttarget = target[key];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet result = target[ps[lastIndex]];\r\n\t\tif (result instanceof Promise) {\r\n\t\t\treturn new Promise(async function (resolve, reject) {\r\n\t\t\t\tawait result;\r\n\t\t\t\tresolve(await $getValueAsync(obj, path));\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {string} url\r\n * @returns {Promise<any>}\r\n */\r\nexport let $get = function $get(url) {\r\n\treturn ResourceManager.get(url);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.pack = async function $get_pack(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj && obj[symbol_isPack]) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tif (process.env.NODE_ENV !== \"production\") {\r\n\t\t\tif (obj && !obj[symbol_isPack]) {\r\n\t\t\t\tthrow new TypeError(\"data: \" + path);\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst url = $get.packUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, true);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, true);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.packSync = function get_packSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\treturn undefined;\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.data = async function $get_data(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tconst url = $get.dataUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, false);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, false);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {any}\r\n */\r\n$get.dataSync = function get_dataSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\treturn undefined;\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.list = async function $get_list(path) {\r\n\tlet _path = _getDataPathByUrl(path);\r\n\tlet obj;\r\n\r\n\tif (_path) {\r\n\t\tobj = $getValueAsync($archive, _path);\r\n\t}\r\n\r\n\tif (obj instanceof Promise) {\r\n\t\treturn await obj;\r\n\t}\r\n\telse if (obj) {\r\n\t\treturn obj;\r\n\t}\r\n\telse {\r\n\t\tconst url = $get.listUrl(path);\r\n\r\n\t\tlet task = (async function () {\r\n\t\t\tlet jsonText = await ResourceManager.get(url);\r\n\r\n\t\t\tobj = JSON.parse(jsonText);\r\n\r\n\t\t\t_setValueByPath(path, obj, false);\r\n\r\n\t\t\treturn obj;\r\n\t\t})();\r\n\t\t_setValueByPath(path, task, false);\r\n\r\n\t\treturn await task;\r\n\t}\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {Promise<any>}\r\n */\r\n$get.listSync = function $get_listSync(path) {\r\n\tlet obj = _getValueFromArchiveByPath(path);\r\n\tif (obj) {\r\n\t\treturn Object.keys(obj);\r\n\t}\r\n\treturn undefined;\r\n}\r\n\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.dataUrl = function $get_dataUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"data\")) {\r\n\t\treturn `${window.$ROOT_PATH}data${path}.json`;\r\n\t}\r\n\tthrow new Error(\"Not game data: \" + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.packUrl = function $get_packUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"pack\")) {\r\n\t\treturn `${window.$ROOT_PATH}pack${path}.json`;\r\n\t}\r\n\tthrow new Error(\"Not game pack: \" + path);\r\n}\r\n$get.listUrl = function $get_listUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"ls\")) {\r\n\t\treturn `${window.$ROOT_PATH}ls${path}.json`;\r\n\t}\r\n\tthrow new Error(path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.imageUrl = function $get_imagesUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"images\")) {\r\n\t\treturn `${window.$ROOT_PATH}images${path}.png`;\r\n\t}\r\n\tthrow new Error(\"Not game images: \" + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.soundMp3Url = function $get_soundMp3Url(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"sound\")) {\r\n\t\treturn `${window.$ROOT_PATH}sound${path}.mp3`;\r\n\t}\r\n\tthrow new Error(\"Not game sound: \" + path);\r\n}\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.soundWavUrl = function $get_soundWavUrl(path) {\r\n\tif (url_startsWith_protocol(path)) {\r\n\t\treturn path;\r\n\t}\r\n\telse if (!path.startsWith(\"sound\")) {\r\n\t\treturn `${window.$ROOT_PATH}sound${path}.wav`;\r\n\t}\r\n\tthrow new Error(\"Not game sound: \" + path);\r\n}\r\n\r\n/**\r\n * @param {string} path\r\n * @returns {string}\r\n */\r\n$get.assetUrl = function $get_assetUrl(path) {\r\n\treturn `${window.$ROOT_PATH}${path}`;\r\n}\r\n$get.asset = function $get_asset(path) {\r\n\treturn $get($get.assetUrl(path));\r\n}\r\n\r\nwindow.$get = $get;\r\n\r\n\r\nexport class ItemAttrNormalize {\r\n\tstatic head(item) {\r\n\t\titem.gender = 2;\r\n\t}\r\n\tstatic body(item) {\r\n\t\titem.gender = 2;\r\n\t}\r\n\tstatic Face(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 1 || g == 4 ? 1 : 0;\r\n\t}\r\n\tstatic Hair(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 1 || g == 2 || g == 4 || g == 7 ? 1 : 0;\r\n\t}\r\n\tstatic Cap(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryFace(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryEyes(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic accessoryEars(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Coat(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Longcoat(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Pants(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Shoes(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Glove(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Shield(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic Cape(item) {\r\n\t\tItemAttrNormalize._equip(item);\r\n\t}\r\n\tstatic _equip(item) {\r\n\t\tconst g = Math.trunc((item.id % 10000) / 1000);\r\n\t\titem.gender = g == 0 ? 0 : (g == 1 ? 1 : 2);\r\n\t}\r\n}\r\n\r\nconst regexp_getHairStyleID = /(\\d{4,7})\\d$/;\r\nconst regexp_getFaceStyleID = /(\\d{2,5})\\d(\\d{2})$/;\r\n\r\nconst regexp_getHairColor = /\\d{4,7}(\\d)$/;\r\nconst regexp_getFaceColor = /\\d{2,5}(\\d)\\d{2}$/;\r\n\r\nexport class CharacterRenderConfig {\r\n\t/**\r\n\t * @param {string} style id\r\n\t * @returns {string[]}\r\n\t */\r\n\tstatic * enumHairColor(style) {\r\n\t\tlet m = style.match(regexp_getHairStyleID);\r\n\t\tfor (let i = 0; i < 10; ++i) {\r\n\t\t\tlet id = m[1] + i;\r\n\t\t\tyield id;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} style id\r\n\t * @returns {string[]}\r\n\t */\r\n\tstatic * enumFaceColor(style) {\r\n\t\tlet m = style.match(regexp_getFaceStyleID);\r\n\t\tfor (let i = 0; i < 10; ++i) {\r\n\t\t\tlet id = m[1] + i + m[2];\r\n\t\t\tyield id;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} style\r\n\t * @param {number} color\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getColorHairID(style, color) {\r\n\t\tlet m = style.match(regexp_getHairStyleID);\r\n\t\tlet id = m[1] + (color % 10);\r\n\t\treturn id;\r\n\t}\r\n\t/**\r\n\t * @param {string} style\r\n\t * @param {number} color\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getColorFaceID(style, color) {\r\n\t\tlet m = style.match(regexp_getFaceStyleID);\r\n\t\tlet id = m[1] + (color % 10) + m[2];\r\n\t\treturn id;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id_1\r\n\t * @param {string} id_2\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isHairStyleEqual(id_1, id_2) {\r\n\t\treturn CharacterRenderConfig.getColorHairID(id_1, 0) == CharacterRenderConfig.getColorHairID(id_2, 0);\r\n\t}\r\n\t/**\r\n\t * @param {string} id_1\r\n\t * @param {string} id_2\r\n\t * @returns {boolean}\r\n\t */\r\n\tstatic isFaceStyleEqual(id_1, id_2) {\r\n\t\treturn CharacterRenderConfig.getColorFaceID(id_1, 0) == CharacterRenderConfig.getColorFaceID(id_2, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getHairColor(id) {\r\n\t\tif (id) {\r\n\t\t\tid = String(id);\r\n\t\t\tlet m = id.match(regexp_getHairColor);\r\n\t\t\tif (m) {\r\n\t\t\t\treturn m[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {string}\r\n\t */\r\n\tstatic getFaceColor(id) {\r\n\t\tif (id) {\r\n\t\t\tid = String(id);\r\n\t\t\tlet m = id.match(regexp_getFaceColor);\r\n\t\t\tif (m) {\r\n\t\t\t\treturn m[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar _external_data = {\r\n\t\"requiredJobs\": [\r\n\t\t\"Beginner\"\r\n\t],\r\n\t\"requiredLevel\": 0,\r\n\t\"isCash\": true,\r\n\t\"name\": \"Blue Beanie\",\r\n\t\"desc\": null,\r\n\t\"id\": 1000000,\r\n\t\"requiredGender\": 0,\r\n\t\"typeInfo\": {\r\n\t\t\"overallCategory\": \"Equip\",\r\n\t\t\"category\": \"Armor\",\r\n\t\t\"subCategory\": \"Hat\"\r\n\t}\r\n};\r\n\r\nvar ItemTypeInfo = {\r\n\t\"Equip\": {\r\n\t\t\"Hat\": \"Cap\",\r\n\t\t\"Cape\": \"Cape\",\r\n\t\t\"Top\": \"Coat\",\r\n\t\t\"Overall\": \"Longcoat\",\r\n\t\t\"Glove\": \"Glove\",\r\n\t\t\"Bottom\": \"Pants\",\r\n\r\n\t\t\"Shield\": \"Shield\",\r\n\t\t\"Shoes\": \"Shoes\",\r\n\t\t\"Eye Decoration\": \"accessoryEyes\",\r\n\t\t\"Earrings\": \"accessoryEars\",\r\n\t\t//\"Ring\": \"\",\r\n\r\n\t\t//\"Pendant\": \"\",\r\n\t\t\"Face Accessory\": \"accessoryFace\",\r\n\t\t//\"Belt\": \"\",\r\n\t\t//\"Medal\": \"\",\r\n\t\t//\"Shoulder Accessory\": \"\",\r\n\t\t//\"Badge\": \"\",\r\n\r\n\t\t//\"Dragon Equipment\": \"\",\r\n\t\t//\"Mechanic Equipment\": \"\",\r\n\t\t//\"Pet Equipment\": \"\",\r\n\t\t//\"Android\": \"\",\r\n\t\t//\"Mechanical Heart\": \"\",\r\n\t\t//\"Bits\": \"\",\r\n\r\n\t\t\"Face\": \"Face\",\r\n\t\t\"Hair\": \"Hair\",\r\n\t},\r\n};\r\n\r\nResourceManager.external = {\r\n\tequip: {\r\n\t},\r\n};\r\n\r\nResourceManager.equip_map = {\r\n};\r\n\r\nfor (let i in ItemTypeInfo.Equip) {\r\n\tlet cate = ItemTypeInfo.Equip[i];\r\n\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\nfor (let i = 0; i < 9; ++i) {\r\n\tlet cate = \"Face\" + i;\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\nfor (let i = 0; i < 8; ++i) {\r\n\tlet cate = \"Hair\" + i;\r\n\tResourceManager.external.equip[cate] = [];\r\n\tResourceManager.equip_map[cate] = null;\r\n}\r\n\r\nasync function load_external_resource(url) {\r\n\turl = url || \"/items.json\";\r\n\tlet raw;\r\n\r\n\ttry {\r\n\t\traw = ResourceManager._external_raw = JSON.parse(await $get.asset(\"equip.json\"));\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error(\"'/equip' is empty\");\r\n\t\t}\r\n\t}\r\n\tcatch (ex) {\r\n\t\traw = ResourceManager._external_raw = JSON.parse(await $get(\"//labs.maplestory.io/api/gms/latest/item/category/equip\"));\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfor (let i = 0; i < raw.length; ++i) {\r\n\t\tconst item = raw[i];\r\n\t\tconst id = String(item.id).padStart(8, \"0\");\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (!(item.typeInfo && ItemTypeInfo[item.typeInfo.overallCategory])) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet clz = item.typeInfo.overallCategory.toLowerCase();\r\n\t\t\tlet cate = ItemTypeInfo[item.typeInfo.overallCategory][item.typeInfo.subCategory];\r\n\t\t\tif (!cate) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\telse if (cate == \"Face\") {\r\n\t\t\t\tcate += CharacterRenderConfig.getFaceColor(id);\r\n\t\t\t}\r\n\t\t\telse if (cate == \"Hair\") {\r\n\t\t\t\tcate += CharacterRenderConfig.getHairColor(id);\r\n\t\t\t}\r\n\r\n\t\t\tlet it = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: item.name,\r\n\t\t\t\tdesc: item.desc,\r\n\t\t\t\tcash: item.isCash ? 1 : 0,\r\n\t\t\t\ticon: {\r\n\t\t\t\t\t\"\": `//labs.maplestory.io/api/gms/latest/item/${item.id}/icon`,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tResourceManager.external[clz][cate].push(it);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(\"external resource: id(\" + id + \")\");\r\n\t\t\tconsole.error(ex);\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction update_external_equip_list() {\r\n\tconst url = \"https://labs.maplestory.io/api/gms/latest/item/category/equip\";\r\n\tload_external_resource(url).then(() => {\r\n\t\t_concat_external_resource(category, origin_data);\r\n\t\tconcat_external_resource = _concat_external_resource;\r\n\t\tconsole.log(\"done: update_external_equip_list\");\r\n\t});\r\n}\r\n\r\nlet external_resource_promise = load_external_resource();\r\n\r\nwindow.concat_external_resource = _concat_external_resource_p;\r\n\r\nwindow.trigger_update_external_equip_list = function () {\r\n\texternal_resource_promise = load_external_resource();\r\n\twindow.concat_external_resource = _concat_external_resource_p;\r\n}\r\n\r\nasync function _concat_external_resource_p(category, origin_data) {\r\n\tawait external_resource_promise;\r\n\t_concat_external_resource(category, origin_data);\r\n\tconcat_external_resource = _concat_external_resource;\r\n}\r\n\r\nfunction _concat_external_resource(category, origin_data) {\r\n\ttry {\r\n\t\tconst list = ResourceManager.external.equip[category];\r\n\t\tif (!list) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet id_map = ResourceManager.equip_map[category];\r\n\r\n\t\tif (!id_map) {\r\n\t\t\tid_map = new Map();\r\n\t\t\t\r\n\t\t\torigin_data.forEach(item => {\r\n\t\t\t\tid_map.set(item.id, item);\r\n\t\t\t});\r\n\r\n\t\t\tResourceManager.equip_map[category] = id_map;\r\n\t\t}\r\n\r\n\t\tlist.forEach((item) => {\r\n\t\t\tlet id = item.id;\r\n\t\t\tif (!id_map.has(id)) {\r\n\t\t\t\titem.$foreign = true;\r\n\t\t\t\torigin_data.push(item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ori_item = id_map.get(id);\r\n\t\t\t\tori_item._name = item.name || \"\";\r\n\t\t\t\tori_item._desc = item.desc || \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tcatch (ex) {\r\n\t\tconsole.error(ex);\r\n\t\tdebugger;\r\n\t}\r\n}\r\n\r\nwindow.load_extern_item_data = async function (id) {\r\n\tlet _raw = JSON.parse(await $get(`//labs.maplestory.io/api/gms/latest/item/${id}`));\r\n\tlet raw = {};\r\n\r\n\tlet default_ = _raw.frameBooks.default ? _raw.frameBooks.default.frames[0]:null;\r\n\r\n\tfor (let i in _raw.frameBooks) {\r\n\t\tlet _act = _raw.frameBooks[i];\r\n\t\tlet act = [];\r\n\r\n\t\tfor (let j = 0; j < _act.frames.length; ++j) {\r\n\t\t\tlet frame = _act.frames[j] || default_;\r\n\t\t\tif (!frame || !frame.effects) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tlet _frags = frame.effects;\r\n\t\t\tlet frags = {};\r\n\t\t\tfor (let k in _frags) {\r\n\t\t\t\tlet _frag = _frags[k];\r\n\t\t\t\tif (_frag.image) {\r\n\t\t\t\t\tfrags[k] = {\r\n\t\t\t\t\t\t\"\": \"data:image/png;base64,\" + _frag.image,\r\n\t\t\t\t\t\t\"origin\": _frag.originOrZero || _frag.origin || _frag.center,\r\n\t\t\t\t\t\t\"map\": _frag.mapOffset,\r\n\t\t\t\t\t\t\"z\": _frag.position\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tact[j] = frags;\r\n\t\t}\r\n\r\n\t\traw[i] = act;\r\n\t}\r\n\r\n\traw.info = {\r\n\t\tislot: _raw.metaInfo.equip.islot,\r\n\t\tvslot: _raw.metaInfo.equip.vslot,\r\n\t\ticon: _raw.metaInfo.icon ? (\"data:image/png;base64,\" + _raw.metaInfo.icon.iconRaw) : \"\",\r\n\t\tcash: (_raw.metaInfo.cash && _raw.metaInfo.cash.cash) ? 1 : 0,\r\n\t};\r\n\r\n\treturn raw;\r\n}\r\n","﻿\r\nimport { Vec2 } from \"../math.js\";\r\n\r\n\r\nexport class ActionAnimationFrameData {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.move = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded raw data\r\n\t * @param {ActionAnimationFrameData} raw\r\n\t * @param {string} action\r\n\t * @param {number} frame\r\n\t */\r\n\t_load(raw, action, frame) {\r\n\t\tthis._raw = raw;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = raw.delay;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tif (raw.move) {\r\n\t\t\tthis.move = new Vec2(raw.move.x, raw.move.y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.move = new Vec2(0, 0);\r\n\t\t}\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = raw.action || action;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = raw.frame || frame;\r\n\t}\r\n}\r\n\r\nexport class ActionAnimation {\r\n\tconstructor(raw) {\r\n\t\t/** @returns {ActionAnimationFrameData[]} */\r\n\t\tthis.frames = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._action = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\r\n\t\t/** @type {number} this.delay = delay < 0 ? -delay:0; if (this.delay == 0) launch attack */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.loop = false;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\t_load(action) {\r\n\t\tthis._action = action;\r\n\t\tthis.frames = ActionAnimation.Adef[action];\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\treload(action) {\r\n\t\tthis.reset();\r\n\t\tthis._load(action);\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * update action delay, target.action, target.action_frame, target.tx, target.ty\r\n\t * @param {number} stamp\r\n\t * @param {CharacterRenderer} target\r\n\t */\r\n\tupdate(stamp, target) {\r\n\t\tif (!this.frames || !stamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst fdat = this.fdat;\r\n\t\tlet delay = 0;\r\n\r\n\t\tif (!fdat) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.time = this.time + stamp;\r\n\r\n\t\tif (fdat.delay < 0) {\r\n\t\t\tfdat.delay = -fdat.delay;\r\n\t\t}\r\n\r\n\t\tif (fdat.delay > 0) {\r\n\t\t\tdelay = fdat.delay;\r\n\t\t\tthis.delay = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelay = -fdat.delay;\r\n\t\t\tthis.delay = delay;\r\n\t\t}\r\n\r\n\t\tif (this.time > delay) {\r\n\t\t\tthis.frame = ++this.frame;\r\n\t\t\tthis.time = 0;\r\n\t\t}\r\n\r\n\t\t//translate target position\r\n\t\tif (fdat.move) {\r\n\t\t\ttarget.tx = -fdat.move.x * target.front;\r\n\t\t\ttarget.ty = fdat.move.y;//Y 軸相反\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\tif (this.isEnd()) {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// 改變 action & action_frame 會造成迴圈: this.reload(this._action)\r\n\t\tif (!target._ride_action) {\r\n\t\t\ttarget._action = fdat.action;\r\n\t\t}\r\n\t\ttarget._action_frame = fdat.frame;\r\n\r\n\t\tif (!this.frames || this.fdat == null) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t\telse if (!this.loop) {\r\n\t\t\tthis._is_end = false;\r\n\t\t}\r\n\t\tif (this.frames.length <= 1) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t}\r\n\r\n\tisEnd() {\r\n\t\treturn this._is_end;\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.frames.reduce((total, frame) => total + frame.delay, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * frame data\r\n\t * @returns {ActionAnimationFrameData}\r\n\t */\r\n\tget fdat() {\r\n\t\treturn this.frames[this.frame];\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\t/** @type {{[action:string]:ActionAnimationFrameData[]}} */\r\n\t\tlet raw = await $get.data(ActionAnimation._base_path);\r\n\r\n\t\tlet aadef = Object.assign({}, raw);\r\n\t\t\r\n\t\tdelete aadef['info'];\r\n\r\n\t\tfor (let actName in aadef) {\r\n\t\t\tlet aa = aadef[actName];\r\n\t\t\taadef[actName] = Object.values(aa).map((_fdef, frame) => {\r\n\t\t\t\tlet fdef = new ActionAnimationFrameData();\r\n\t\t\t\tfdef._load(_fdef, actName, frame);\r\n\t\t\t\treturn fdef;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//action definition\r\n\t\tActionAnimation.Adef = aadef;\r\n\r\n\t\twindow.CharacterActionAnimationDefinition = aadef;\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\treturn \"/Character/00002000\";\r\n\t}\r\n}\r\n/**\r\n * action definition\r\n * @type {{[action:string]:ActionAnimationFrameData[]}}\r\n */\r\nActionAnimation.Adef = null;\r\n\r\n","\r\nwindow.DownloadData = (function () {\r\n\tlet a = document.createElement(\"a\");\r\n\tdocument.body.appendChild(a);\r\n\ta.style = \"display: none\";\r\n\ta.target = \"_blank\";\r\n\treturn function (text, type, fileName) {\r\n\t\tlet blob = new Blob([text], { type: type || \"octet/stream\" });\r\n\t\tlet url = window.URL.createObjectURL(blob);\r\n\t\tif (fileName && fileName != \"\") {\r\n\t\t\ta.href = url;\r\n\t\t\ta.download = fileName;\r\n\t\t\ta.click();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//a.href = url;\r\n\t\t\t//a.click();\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n}());\r\n\r\nwindow.SelectText = function (elem) {\r\n\tvar range, selection;\r\n\r\n\tif (document.body.createTextRange) {\r\n\t\trange = document.body.createTextRange();\r\n\t\trange.moveToElementText(elem);\r\n\t\trange.select();\r\n\t}\r\n\telse if (window.getSelection) {\r\n\t\tselection = window.getSelection();\r\n\t\trange = document.createRange();\r\n\t\trange.selectNodeContents(elem);\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\t}\r\n}\r\nwindow.copyToClipboard = function (text) {\r\n\tvar $temp = $(\"<input>\");\r\n\t$(\"body\").append($temp);\r\n\t$temp.val(text).select();\r\n\tdocument.execCommand(\"copy\");\r\n\t$temp.remove();\r\n}\r\n\r\n/**\r\n * disable textNode \"#text\"\r\n * @param {string} xml - xml\r\n * @param {string[]=} arrayTags - optional\r\n * @returns {object}\r\n */\r\nfunction parseXml(xml, arrayTags) {\r\n\tvar dom = null;\r\n\tif (window.DOMParser) {\r\n\t\tdom = (new DOMParser()).parseFromString(xml, \"text/xml\");\r\n\t}\r\n\telse if (window.ActiveXObject) {\r\n\t\tdom = new ActiveXObject('Microsoft.XMLDOM');\r\n\t\tdom.async = false;\r\n\t\tif (!dom.loadXML(xml)) {\r\n\t\t\tthrow dom.parseError.reason + \" \" + dom.parseError.srcText;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthrow \"cannot parse xml string!\";\r\n\t}\r\n\r\n\tfunction isArray(o) {\r\n\t\treturn Object.prototype.toString.apply(o) === '[object Array]';\r\n\t}\r\n\r\n\tfunction parseNode(xmlNode, result) {\r\n\t\tif (xmlNode.nodeName == \"#text\" && xmlNode.nodeValue.trim() == \"\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar jsonNode = {};\r\n\t\tvar existing = result[xmlNode.nodeName];\r\n\t\tif (existing) {\r\n\t\t\tif (!isArray(existing)) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [existing, jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName].push(jsonNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (arrayTags && arrayTags.indexOf(xmlNode.nodeName) != -1) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName] = jsonNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (xmlNode.attributes) {\r\n\t\t\tvar length = xmlNode.attributes.length;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tvar attribute = xmlNode.attributes[i];\r\n\t\t\t\tjsonNode[attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar length = xmlNode.childNodes.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tparseNode(xmlNode.childNodes[i], jsonNode);\r\n\t\t}\r\n\t}\r\n\r\n\tvar result = {};\r\n\tif (dom.childNodes.length) {\r\n\t\tparseNode(dom.childNodes[0], result);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n"],"sourceRoot":""}