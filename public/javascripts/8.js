(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[8],{

/***/ "./src/game/Animation.js":
/*!*******************************!*\
  !*** ./src/game/Animation.js ***!
  \*******************************/
/*! exports provided: AnimationBase, Animation */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AnimationBase\", function() { return AnimationBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Animation\", function() { return Animation; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./math.js */ \"./src/game/math.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Sprite.js */ \"./src/game/Sprite.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\nwindow.m_draw_animation_texture_info = false;\r\n\r\nclass IAnimation {\r\n\tconstructor(raw, url) {\r\n\t\tthis._raw = null;\r\n\t\tthis._url = null;\r\n\t\t\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t_raw: {\r\n\t\t\t\tvalue: raw\r\n\t\t\t},\r\n\t\t\t_url: {\r\n\t\t\t\tvalue: url\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** elapsed time */\r\n\t\tthis.delta = 0;\r\n\r\n\t\t/** @type {Sprite[]} */\r\n\t\tthis.textures = [];\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_loop = true;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_end = false;\r\n\r\n\t\tif (!raw && !this._url) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.textures.reduce((pv, cv) => pv + cv.delay, 0);\r\n\t}\r\n\t\r\n\tclone() {\r\n\t\tlet newAnim = new this.constructor(this._raw, this._url);\r\n\t\tnewAnim.textures = this.textures;\r\n\t\treturn newAnim;\r\n\t}\r\n\t\r\n\tload() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/** reset frame */\r\n\t_resetFrame() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t}\r\n\r\n\t/** restart */\r\n\treset() {\r\n\t\tthis.frame = 0;\r\n\t\tthis.time = 0;\r\n\t\tthis.is_end = false;\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * remove at nextStep\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.is_loop = false;//防止重複\r\n\t\tthis.is_end = true;\r\n\t}\r\n}\r\n\r\n/**\r\n * process animation\r\n */\r\nclass AnimationBase extends IAnimation {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {!string} url\r\n\t */\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t}\r\n\r\n\tload() {\r\n\t\tif (!this._raw) {\r\n\t\t\t//this._raw = await $get.data(this._url);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i in this._raw; ++i) {\r\n\t\t\t//let url = this._url + \"/\" + i;\r\n\r\n\t\t\tlet texture = new _Sprite_js__WEBPACK_IMPORTED_MODULE_2__[\"Sprite\"](this._raw[i]);\r\n\r\n\t\t\t//texture._url = url;\r\n\r\n\t\t\tthis.textures[i] = texture;\r\n\t\t}\r\n\t\t\r\n\t\tif (this.textures[0]) {\r\n\t\t\tif (!this.textures[0].isLoaded()) {\r\n\t\t\t\tthis.textures[0].__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tisEnd() {\r\n\t\treturn this.is_end;\r\n\t}\r\n\r\n\t/**\r\n\t * aways loop\r\n\t * @param {number} stamp\r\n\t */\r\n\t_update(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = ++this.frame % fc;\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t\t//this.frame = Math.trunc(this.time / 1000) % fc;\r\n\t\t}\r\n\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 0) {//??\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.texture.delay) {\r\n\t\t\t\tthis.frame = this.frame + 1;\r\n\t\t\t\tif (this.frame >= fc) {\r\n\t\t\t\t\tif (this.is_loop) {\r\n\t\t\t\t\t\tthis.reset();//make loop\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t//防止錯誤\r\n\t\t\t\t\t\tthis.frame = fc - 1;//this._resetFrame();\r\n\r\n\t\t\t\t\t\tthis.is_end = true;\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw(renderer, x, y, angle, flip) {\r\n\t\tlet texture = this.texture;\r\n\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t}\r\n\t\r\n\tget texture() {\r\n\t\treturn this.textures[this.frame];\r\n\t}\r\n}\r\n\r\n/**\r\n * animation rendering\r\n */\r\nclass Animation extends AnimationBase {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\r\n\t\tthis.draw = this._draw_and_preload;\r\n\t}\r\n\r\n\t/**\r\n\t * draw and load next frame\r\n\t * @param {IRenderer} renderer - GraphLayerRenderer\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\t_draw_and_preload(renderer, x, y, angle, flip) {\r\n\t\tlet frame;\r\n\r\n\t\t// if current frame is not loaded then render prev frame\r\n\t\tfor (frame = this.frame; frame >= 0; --frame) {\r\n\t\t\tlet texture = this.textures[frame];\r\n\r\n\t\t\tif (texture.isLoaded()) {\r\n\t\t\t\trenderer.drawRotaGraph(texture, x, y, angle, flip);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//preload next frame\r\n\t\tlet texture = this.textures[++frame];\r\n\t\tif (texture) {//if frame < this.textures.length\r\n\t\t\tif (!texture.isLoaded()) {\r\n\t\t\t\ttexture.__loadTexture();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {//if all testure are loaded\r\n\t\t\tdelete this.draw;\r\n\t\t}\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9BbmltYXRpb24uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9BbmltYXRpb24uanM/YTRkNSJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgVmVjMiB9IGZyb20gXCIuL21hdGguanNcIjtcclxuaW1wb3J0IHsgSUdyYXBoLCBJUmVuZGVyZXIgfSBmcm9tIFwiLi9JUmVuZGVyZXIuanNcIjtcclxuXHJcbmltcG9ydCB7IFNwcml0ZSB9IGZyb20gXCIuL1Nwcml0ZS5qc1wiO1xyXG5cclxuXHJcbndpbmRvdy5tX2RyYXdfYW5pbWF0aW9uX3RleHR1cmVfaW5mbyA9IGZhbHNlO1xyXG5cclxuY2xhc3MgSUFuaW1hdGlvbiB7XHJcblx0Y29uc3RydWN0b3IocmF3LCB1cmwpIHtcclxuXHRcdHRoaXMuX3JhdyA9IG51bGw7XHJcblx0XHR0aGlzLl91cmwgPSBudWxsO1xyXG5cdFx0XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XHJcblx0XHRcdF9yYXc6IHtcclxuXHRcdFx0XHR2YWx1ZTogcmF3XHJcblx0XHRcdH0sXHJcblx0XHRcdF91cmw6IHtcclxuXHRcdFx0XHR2YWx1ZTogdXJsXHJcblx0XHRcdH0sXHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHRcdHRoaXMudGltZSA9IDA7XHJcblxyXG5cdFx0LyoqIGVsYXBzZWQgdGltZSAqL1xyXG5cdFx0dGhpcy5kZWx0YSA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTcHJpdGVbXX0gKi9cclxuXHRcdHRoaXMudGV4dHVyZXMgPSBbXTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5pc19sb29wID0gdHJ1ZTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5pc19lbmQgPSBmYWxzZTtcclxuXHJcblx0XHRpZiAoIXJhdyAmJiAhdGhpcy5fdXJsKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0VG90YWxUaW1lKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMudGV4dHVyZXMucmVkdWNlKChwdiwgY3YpID0+IHB2ICsgY3YuZGVsYXksIDApO1xyXG5cdH1cclxuXHRcclxuXHRjbG9uZSgpIHtcclxuXHRcdGxldCBuZXdBbmltID0gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcy5fcmF3LCB0aGlzLl91cmwpO1xyXG5cdFx0bmV3QW5pbS50ZXh0dXJlcyA9IHRoaXMudGV4dHVyZXM7XHJcblx0XHRyZXR1cm4gbmV3QW5pbTtcclxuXHR9XHJcblx0XHJcblx0bG9hZCgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKiByZXNldCBmcmFtZSAqL1xyXG5cdF9yZXNldEZyYW1lKCkge1xyXG5cdFx0dGhpcy5mcmFtZSA9IDA7XHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdH1cclxuXHJcblx0LyoqIHJlc3RhcnQgKi9cclxuXHRyZXNldCgpIHtcclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdHRoaXMuaXNfZW5kID0gZmFsc2U7XHJcblx0fVxyXG5cdFxyXG5cdGdldCB0ZXh0dXJlKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHJlbW92ZSBhdCBuZXh0U3RlcFxyXG5cdCAqL1xyXG5cdGRlc3Ryb3koKSB7XHJcblx0XHR0aGlzLmlzX2xvb3AgPSBmYWxzZTsvL+mYsuatoumHjeikh1xyXG5cdFx0dGhpcy5pc19lbmQgPSB0cnVlO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHByb2Nlc3MgYW5pbWF0aW9uXHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQW5pbWF0aW9uQmFzZSBleHRlbmRzIElBbmltYXRpb24ge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7IWFueX0gcmF3XHJcblx0ICogQHBhcmFtIHshc3RyaW5nfSB1cmxcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihyYXcsIHVybCkge1xyXG5cdFx0c3VwZXIocmF3LCB1cmwpO1xyXG5cdH1cclxuXHJcblx0bG9hZCgpIHtcclxuXHRcdGlmICghdGhpcy5fcmF3KSB7XHJcblx0XHRcdC8vdGhpcy5fcmF3ID0gYXdhaXQgJGdldC5kYXRhKHRoaXMuX3VybCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgaW4gdGhpcy5fcmF3OyArK2kpIHtcclxuXHRcdFx0Ly9sZXQgdXJsID0gdGhpcy5fdXJsICsgXCIvXCIgKyBpO1xyXG5cclxuXHRcdFx0bGV0IHRleHR1cmUgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhd1tpXSk7XHJcblxyXG5cdFx0XHQvL3RleHR1cmUuX3VybCA9IHVybDtcclxuXHJcblx0XHRcdHRoaXMudGV4dHVyZXNbaV0gPSB0ZXh0dXJlO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZiAodGhpcy50ZXh0dXJlc1swXSkge1xyXG5cdFx0XHRpZiAoIXRoaXMudGV4dHVyZXNbMF0uaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdHRoaXMudGV4dHVyZXNbMF0uX19sb2FkVGV4dHVyZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGlzRW5kKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuaXNfZW5kO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogYXdheXMgbG9vcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdF91cGRhdGUoc3RhbXApIHtcclxuXHRcdGNvbnN0IGZjID0gdGhpcy50ZXh0dXJlcy5sZW5ndGg7XHJcblxyXG5cdFx0aWYgKGZjID4gMCkgey8vPz9cclxuXHRcdFx0dGhpcy50aW1lID0gdGhpcy50aW1lICsgc3RhbXA7XHJcblxyXG5cdFx0XHRpZiAodGhpcy50aW1lID4gdGhpcy50ZXh0dXJlLmRlbGF5KSB7XHJcblx0XHRcdFx0dGhpcy5mcmFtZSA9ICsrdGhpcy5mcmFtZSAlIGZjO1xyXG5cdFx0XHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly90aGlzLmZyYW1lID0gTWF0aC50cnVuYyh0aGlzLnRpbWUgLyAxMDAwKSAlIGZjO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZGVsdGEgKz0gc3RhbXA7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0Y29uc3QgZmMgPSB0aGlzLnRleHR1cmVzLmxlbmd0aDtcclxuXHJcblx0XHRpZiAoZmMgPiAwKSB7Ly8/P1xyXG5cdFx0XHR0aGlzLnRpbWUgPSB0aGlzLnRpbWUgKyBzdGFtcDtcclxuXHJcblx0XHRcdGlmICh0aGlzLnRpbWUgPiB0aGlzLnRleHR1cmUuZGVsYXkpIHtcclxuXHRcdFx0XHR0aGlzLmZyYW1lID0gdGhpcy5mcmFtZSArIDE7XHJcblx0XHRcdFx0aWYgKHRoaXMuZnJhbWUgPj0gZmMpIHtcclxuXHRcdFx0XHRcdGlmICh0aGlzLmlzX2xvb3ApIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZXNldCgpOy8vbWFrZSBsb29wXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0Ly/pmLLmraLpjK/oqqRcclxuXHRcdFx0XHRcdFx0dGhpcy5mcmFtZSA9IGZjIC0gMTsvL3RoaXMuX3Jlc2V0RnJhbWUoKTtcclxuXHJcblx0XHRcdFx0XHRcdHRoaXMuaXNfZW5kID0gdHJ1ZTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRoaXMuZGVsdGEgKz0gc3RhbXA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXIgLSBHcmFwaExheWVyUmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICovXHJcblx0ZHJhdyhyZW5kZXJlciwgeCwgeSwgYW5nbGUsIGZsaXApIHtcclxuXHRcdGxldCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlO1xyXG5cdFx0cmVuZGVyZXIuZHJhd1JvdGFHcmFwaCh0ZXh0dXJlLCB4LCB5LCBhbmdsZSwgZmxpcCk7XHJcblx0fVxyXG5cdFxyXG5cdGdldCB0ZXh0dXJlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMudGV4dHVyZXNbdGhpcy5mcmFtZV07XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogYW5pbWF0aW9uIHJlbmRlcmluZ1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEFuaW1hdGlvbiBleHRlbmRzIEFuaW1hdGlvbkJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHRzdXBlcihyYXcsIHVybCk7XHJcblxyXG5cdFx0dGhpcy5kcmF3ID0gdGhpcy5fZHJhd19hbmRfcHJlbG9hZDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGRyYXcgYW5kIGxvYWQgbmV4dCBmcmFtZVxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlciAtIEdyYXBoTGF5ZXJSZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHlcclxuXHQgKi9cclxuXHRfZHJhd19hbmRfcHJlbG9hZChyZW5kZXJlciwgeCwgeSwgYW5nbGUsIGZsaXApIHtcclxuXHRcdGxldCBmcmFtZTtcclxuXHJcblx0XHQvLyBpZiBjdXJyZW50IGZyYW1lIGlzIG5vdCBsb2FkZWQgdGhlbiByZW5kZXIgcHJldiBmcmFtZVxyXG5cdFx0Zm9yIChmcmFtZSA9IHRoaXMuZnJhbWU7IGZyYW1lID49IDA7IC0tZnJhbWUpIHtcclxuXHRcdFx0bGV0IHRleHR1cmUgPSB0aGlzLnRleHR1cmVzW2ZyYW1lXTtcclxuXHJcblx0XHRcdGlmICh0ZXh0dXJlLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0XHRyZW5kZXJlci5kcmF3Um90YUdyYXBoKHRleHR1cmUsIHgsIHksIGFuZ2xlLCBmbGlwKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vcHJlbG9hZCBuZXh0IGZyYW1lXHJcblx0XHRsZXQgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbKytmcmFtZV07XHJcblx0XHRpZiAodGV4dHVyZSkgey8vaWYgZnJhbWUgPCB0aGlzLnRleHR1cmVzLmxlbmd0aFxyXG5cdFx0XHRpZiAoIXRleHR1cmUuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdHRleHR1cmUuX19sb2FkVGV4dHVyZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHsvL2lmIGFsbCB0ZXN0dXJlIGFyZSBsb2FkZWRcclxuXHRcdFx0ZGVsZXRlIHRoaXMuZHJhdztcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Animation.js\n");

/***/ }),

/***/ "./src/game/Renderer/CharacterActionAnimation.js":
/*!*******************************************************!*\
  !*** ./src/game/Renderer/CharacterActionAnimation.js ***!
  \*******************************************************/
/*! exports provided: ActionAnimationFrameData, ActionAnimation */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ActionAnimationFrameData\", function() { return ActionAnimationFrameData; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ActionAnimation\", function() { return ActionAnimation; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n﻿\r\n\r\n\r\n\r\nclass ActionAnimationFrameData {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.move = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded raw data\r\n\t * @param {ActionAnimationFrameData} raw\r\n\t * @param {string} action\r\n\t * @param {number} frame\r\n\t */\r\n\t_load(raw, action, frame) {\r\n\t\tthis._raw = raw;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = raw.delay;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tif (raw.move) {\r\n\t\t\tthis.move = new _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Vec2\"](raw.move.x, raw.move.y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.move = new _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Vec2\"](0, 0);\r\n\t\t}\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = raw.action || action;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = raw.frame || frame;\r\n\t}\r\n}\r\n\r\nclass ActionAnimation {\r\n\tconstructor(raw) {\r\n\t\t/** @returns {ActionAnimationFrameData[]} */\r\n\t\tthis.frames = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._action = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.frame = 0;\r\n\r\n\t\t/** @type {number} this.delay = delay < 0 ? -delay:0; if (this.delay == 0) launch attack */\r\n\t\tthis.delay = 0;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.loop = false;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\t_load(action) {\r\n\t\tthis._action = action;\r\n\t\tthis.frames = ActionAnimation.Adef[action];\r\n\t}\r\n\r\n\t/**\r\n\t * from loaded data\r\n\t * @param {string} action\r\n\t */\r\n\treload(action) {\r\n\t\tthis.reset();\r\n\t\tthis._load(action);\r\n\t}\r\n\r\n\treset() {\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\t\tthis._is_end = false;\r\n\t}\r\n\r\n\t/**\r\n\t * update action delay, target.action, target.action_frame, target.tx, target.ty\r\n\t * @param {number} stamp\r\n\t * @param {CharacterRenderer} target\r\n\t */\r\n\tupdate(stamp, target) {\r\n\t\tif (!this.frames || !stamp) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst fdat = this.fdat;\r\n\t\tlet delay = 0;\r\n\r\n\t\tif (!fdat) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.time = this.time + stamp;\r\n\r\n\t\tif (fdat.delay < 0) {\r\n\t\t\tfdat.delay = -fdat.delay;\r\n\t\t}\r\n\r\n\t\tif (fdat.delay > 0) {\r\n\t\t\tdelay = fdat.delay;\r\n\t\t\tthis.delay = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelay = -fdat.delay;\r\n\t\t\tthis.delay = delay;\r\n\t\t}\r\n\r\n\t\tif (this.time > delay) {\r\n\t\t\tthis.frame = ++this.frame;\r\n\t\t\tthis.time = 0;\r\n\t\t}\r\n\r\n\t\t//translate target position\r\n\t\tif (fdat.move) {\r\n\t\t\ttarget.tx = -fdat.move.x * target.front;\r\n\t\t\ttarget.ty = fdat.move.y;//Y 軸相反\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\tif (this.isEnd()) {\r\n\t\t\ttarget.tx = 0;\r\n\t\t\ttarget.ty = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// 改變 action & action_frame 會造成迴圈: this.reload(this._action)\r\n\t\tif (!target._ride_action) {\r\n\t\t\ttarget._action = fdat.action;\r\n\t\t}\r\n\t\ttarget._action_frame = fdat.frame;\r\n\r\n\t\tif (!this.frames || this.fdat == null) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t\telse if (!this.loop) {\r\n\t\t\tthis._is_end = false;\r\n\t\t}\r\n\t\tif (this.frames.length <= 1) {\r\n\t\t\tthis._is_end = true;\r\n\t\t}\r\n\t}\r\n\r\n\tisEnd() {\r\n\t\treturn this._is_end;\r\n\t}\r\n\r\n\tgetTotalTime() {\r\n\t\treturn this.frames.reduce((total, frame) => total + frame.delay, 0);\r\n\t}\r\n\r\n\t/**\r\n\t * frame data\r\n\t * @returns {ActionAnimationFrameData}\r\n\t */\r\n\tget fdat() {\r\n\t\treturn this.frames[this.frame];\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\t/** @type {{[action:string]:ActionAnimationFrameData[]}} */\r\n\t\tlet raw = await $get.data(ActionAnimation._base_path);\r\n\r\n\t\tlet aadef = Object.assign({}, raw);\r\n\t\t\r\n\t\tdelete aadef['info'];\r\n\r\n\t\tfor (let actName in aadef) {\r\n\t\t\tlet aa = aadef[actName];\r\n\t\t\taadef[actName] = Object.values(aa).map((_fdef, frame) => {\r\n\t\t\t\tlet fdef = new ActionAnimationFrameData();\r\n\t\t\t\tfdef._load(_fdef, actName, frame);\r\n\t\t\t\treturn fdef;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t//action definition\r\n\t\tActionAnimation.Adef = aadef;\r\n\r\n\t\twindow.CharacterActionAnimationDefinition = aadef;\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\treturn \"/Character/00002000\";\r\n\t}\r\n}\r\n/**\r\n * action definition\r\n * @type {{[action:string]:ActionAnimationFrameData[]}}\r\n */\r\nActionAnimation.Adef = null;\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9DaGFyYWN0ZXJBY3Rpb25BbmltYXRpb24uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9SZW5kZXJlci9DaGFyYWN0ZXJBY3Rpb25BbmltYXRpb24uanM/YjY2NSJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgVmVjMiB9IGZyb20gXCIuLi9tYXRoLmpzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEFjdGlvbkFuaW1hdGlvbkZyYW1lRGF0YSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZGVsYXkgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7VmVjMn0gKi9cclxuXHRcdHRoaXMubW92ZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmFjdGlvbiA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGZyb20gbG9hZGVkIHJhdyBkYXRhXHJcblx0ICogQHBhcmFtIHtBY3Rpb25BbmltYXRpb25GcmFtZURhdGF9IHJhd1xyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb25cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZnJhbWVcclxuXHQgKi9cclxuXHRfbG9hZChyYXcsIGFjdGlvbiwgZnJhbWUpIHtcclxuXHRcdHRoaXMuX3JhdyA9IHJhdztcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZGVsYXkgPSByYXcuZGVsYXk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtWZWMyfSAqL1xyXG5cdFx0aWYgKHJhdy5tb3ZlKSB7XHJcblx0XHRcdHRoaXMubW92ZSA9IG5ldyBWZWMyKHJhdy5tb3ZlLngsIHJhdy5tb3ZlLnkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMubW92ZSA9IG5ldyBWZWMyKDAsIDApO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb24gPSByYXcuYWN0aW9uIHx8IGFjdGlvbjtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZnJhbWUgPSByYXcuZnJhbWUgfHwgZnJhbWU7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQWN0aW9uQW5pbWF0aW9uIHtcclxuXHRjb25zdHJ1Y3RvcihyYXcpIHtcclxuXHRcdC8qKiBAcmV0dXJucyB7QWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhW119ICovXHJcblx0XHR0aGlzLmZyYW1lcyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl9hY3Rpb24gPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSB0aGlzLmRlbGF5ID0gZGVsYXkgPCAwID8gLWRlbGF5OjA7IGlmICh0aGlzLmRlbGF5ID09IDApIGxhdW5jaCBhdHRhY2sgKi9cclxuXHRcdHRoaXMuZGVsYXkgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMubG9vcCA9IGZhbHNlO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuX2lzX2VuZCA9IGZhbHNlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogZnJvbSBsb2FkZWQgZGF0YVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb25cclxuXHQgKi9cclxuXHRfbG9hZChhY3Rpb24pIHtcclxuXHRcdHRoaXMuX2FjdGlvbiA9IGFjdGlvbjtcclxuXHRcdHRoaXMuZnJhbWVzID0gQWN0aW9uQW5pbWF0aW9uLkFkZWZbYWN0aW9uXTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGZyb20gbG9hZGVkIGRhdGFcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICovXHJcblx0cmVsb2FkKGFjdGlvbikge1xyXG5cdFx0dGhpcy5yZXNldCgpO1xyXG5cdFx0dGhpcy5fbG9hZChhY3Rpb24pO1xyXG5cdH1cclxuXHJcblx0cmVzZXQoKSB7XHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0dGhpcy5mcmFtZSA9IDA7XHJcblx0XHR0aGlzLl9pc19lbmQgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHVwZGF0ZSBhY3Rpb24gZGVsYXksIHRhcmdldC5hY3Rpb24sIHRhcmdldC5hY3Rpb25fZnJhbWUsIHRhcmdldC50eCwgdGFyZ2V0LnR5XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJSZW5kZXJlcn0gdGFyZ2V0XHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wLCB0YXJnZXQpIHtcclxuXHRcdGlmICghdGhpcy5mcmFtZXMgfHwgIXN0YW1wKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGNvbnN0IGZkYXQgPSB0aGlzLmZkYXQ7XHJcblx0XHRsZXQgZGVsYXkgPSAwO1xyXG5cclxuXHRcdGlmICghZmRhdCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy50aW1lID0gdGhpcy50aW1lICsgc3RhbXA7XHJcblxyXG5cdFx0aWYgKGZkYXQuZGVsYXkgPCAwKSB7XHJcblx0XHRcdGZkYXQuZGVsYXkgPSAtZmRhdC5kZWxheTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZmRhdC5kZWxheSA+IDApIHtcclxuXHRcdFx0ZGVsYXkgPSBmZGF0LmRlbGF5O1xyXG5cdFx0XHR0aGlzLmRlbGF5ID0gMDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRkZWxheSA9IC1mZGF0LmRlbGF5O1xyXG5cdFx0XHR0aGlzLmRlbGF5ID0gZGVsYXk7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMudGltZSA+IGRlbGF5KSB7XHJcblx0XHRcdHRoaXMuZnJhbWUgPSArK3RoaXMuZnJhbWU7XHJcblx0XHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly90cmFuc2xhdGUgdGFyZ2V0IHBvc2l0aW9uXHJcblx0XHRpZiAoZmRhdC5tb3ZlKSB7XHJcblx0XHRcdHRhcmdldC50eCA9IC1mZGF0Lm1vdmUueCAqIHRhcmdldC5mcm9udDtcclxuXHRcdFx0dGFyZ2V0LnR5ID0gZmRhdC5tb3ZlLnk7Ly9ZIOi7uOebuOWPjVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRhcmdldC50eCA9IDA7XHJcblx0XHRcdHRhcmdldC50eSA9IDA7XHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy5pc0VuZCgpKSB7XHJcblx0XHRcdHRhcmdldC50eCA9IDA7XHJcblx0XHRcdHRhcmdldC50eSA9IDA7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdC8vIOaUueiuiiBhY3Rpb24gJiBhY3Rpb25fZnJhbWUg5pyD6YCg5oiQ6L+05ZyIOiB0aGlzLnJlbG9hZCh0aGlzLl9hY3Rpb24pXHJcblx0XHRpZiAoIXRhcmdldC5fcmlkZV9hY3Rpb24pIHtcclxuXHRcdFx0dGFyZ2V0Ll9hY3Rpb24gPSBmZGF0LmFjdGlvbjtcclxuXHRcdH1cclxuXHRcdHRhcmdldC5fYWN0aW9uX2ZyYW1lID0gZmRhdC5mcmFtZTtcclxuXHJcblx0XHRpZiAoIXRoaXMuZnJhbWVzIHx8IHRoaXMuZmRhdCA9PSBudWxsKSB7XHJcblx0XHRcdHRoaXMuX2lzX2VuZCA9IHRydWU7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICghdGhpcy5sb29wKSB7XHJcblx0XHRcdHRoaXMuX2lzX2VuZCA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuZnJhbWVzLmxlbmd0aCA8PSAxKSB7XHJcblx0XHRcdHRoaXMuX2lzX2VuZCA9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRpc0VuZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9pc19lbmQ7XHJcblx0fVxyXG5cclxuXHRnZXRUb3RhbFRpbWUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFtZXMucmVkdWNlKCh0b3RhbCwgZnJhbWUpID0+IHRvdGFsICsgZnJhbWUuZGVsYXksIDApO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogZnJhbWUgZGF0YVxyXG5cdCAqIEByZXR1cm5zIHtBY3Rpb25BbmltYXRpb25GcmFtZURhdGF9XHJcblx0ICovXHJcblx0Z2V0IGZkYXQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFtZXNbdGhpcy5mcmFtZV07XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgYXN5bmMgSW5pdCgpIHtcclxuXHRcdC8qKiBAdHlwZSB7e1thY3Rpb246c3RyaW5nXTpBY3Rpb25BbmltYXRpb25GcmFtZURhdGFbXX19ICovXHJcblx0XHRsZXQgcmF3ID0gYXdhaXQgJGdldC5kYXRhKEFjdGlvbkFuaW1hdGlvbi5fYmFzZV9wYXRoKTtcclxuXHJcblx0XHRsZXQgYWFkZWYgPSBPYmplY3QuYXNzaWduKHt9LCByYXcpO1xyXG5cdFx0XHJcblx0XHRkZWxldGUgYWFkZWZbJ2luZm8nXTtcclxuXHJcblx0XHRmb3IgKGxldCBhY3ROYW1lIGluIGFhZGVmKSB7XHJcblx0XHRcdGxldCBhYSA9IGFhZGVmW2FjdE5hbWVdO1xyXG5cdFx0XHRhYWRlZlthY3ROYW1lXSA9IE9iamVjdC52YWx1ZXMoYWEpLm1hcCgoX2ZkZWYsIGZyYW1lKSA9PiB7XHJcblx0XHRcdFx0bGV0IGZkZWYgPSBuZXcgQWN0aW9uQW5pbWF0aW9uRnJhbWVEYXRhKCk7XHJcblx0XHRcdFx0ZmRlZi5fbG9hZChfZmRlZiwgYWN0TmFtZSwgZnJhbWUpO1xyXG5cdFx0XHRcdHJldHVybiBmZGVmO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvL2FjdGlvbiBkZWZpbml0aW9uXHJcblx0XHRBY3Rpb25BbmltYXRpb24uQWRlZiA9IGFhZGVmO1xyXG5cclxuXHRcdHdpbmRvdy5DaGFyYWN0ZXJBY3Rpb25BbmltYXRpb25EZWZpbml0aW9uID0gYWFkZWY7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IF9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gXCIvQ2hhcmFjdGVyLzAwMDAyMDAwXCI7XHJcblx0fVxyXG59XHJcbi8qKlxyXG4gKiBhY3Rpb24gZGVmaW5pdGlvblxyXG4gKiBAdHlwZSB7e1thY3Rpb246c3RyaW5nXTpBY3Rpb25BbmltYXRpb25GcmFtZURhdGFbXX19XHJcbiAqL1xyXG5BY3Rpb25BbmltYXRpb24uQWRlZiA9IG51bGw7XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Renderer/CharacterActionAnimation.js\n");

/***/ }),

/***/ "./src/game/Renderer/CharacterRenderer.js":
/*!************************************************!*\
  !*** ./src/game/Renderer/CharacterRenderer.js ***!
  \************************************************/
/*! exports provided: CharacterAnimationBase, CharacterRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterAnimationBase\", function() { return CharacterAnimationBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterRenderer\", function() { return CharacterRenderer; });\n/* harmony import */ var _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../public/javascripts/resource.js */ \"./public/javascripts/resource.js\");\n/* harmony import */ var _init_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../init.js */ \"./src/init.js\");\n/* harmony import */ var _Animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Animation */ \"./src/game/Animation.js\");\n/* harmony import */ var _Engine_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../Engine.js */ \"./src/game/Engine.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./CharacterActionAnimation.js */ \"./src/game/Renderer/CharacterActionAnimation.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nlet zMap = {};\r\nlet sMap = {};\r\n\r\n\r\n/**\r\n * 00026623.blink[1].brow has bug\r\n * 'Weapon/01702694' is Longcoat(islot)\r\n * how to use cash-weapon (ex: 01702504|0152)\r\n */\r\n\r\n/**\r\n * multi-image-sprite\r\n */\r\nclass FragmentTexture extends _Sprite_js__WEBPACK_IMPORTED_MODULE_5__[\"SpriteBase\"] {\r\n\t/**\r\n\t * @param {wzproperty} raw\r\n\t * @param {string} full_path\r\n\t */\r\n\tconstructor(raw, full_path) {\r\n\t\tsuper(raw, full_path);\r\n\r\n\t\tif (this._raw.origin) {\r\n\t\t\tthis._raw.origin.__proto__ = _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].prototype;\r\n\t\t}\r\n\r\n\t\tfor (let i in this._raw.map) {\r\n\t\t\tthis._raw.map[i].__proto__ = _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].prototype;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * if this.relative == null then remove this\r\n\t\t * @type {Vec2}\r\n\t\t */\r\n\t\tthis.relative = new _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"](0, 0);\r\n\t\t\r\n\t\tthis.calcRelative = this._calcRelative;//this._getRelativeFunction();//this.__old_calcRelative;//\r\n\r\n\t\tthis.filter = new _IRenderer_js__WEBPACK_IMPORTED_MODULE_4__[\"ImageFilter\"]();\r\n\t\tthis.opacity = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.visible = true;\r\n\r\n\r\n\t\t/** @type {string} - extra property. */\r\n\t\tthis._slot = null;\r\n\r\n\t\t/** @type {string} - extra property. 在哪個部位 */\r\n\t\tthis._place = null;\r\n\r\n\t\t/** @type {string} - extra property: _slot itemId, _place, _raw.z z */\r\n\t\tthis.classList = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget z() {\r\n\t\treturn zMap[this._raw.z] || 1;\r\n\t}\r\n\tset z(not_value) {\r\n\t\tconsole.error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {number}\r\n\t */\r\n\tget order() {\r\n\t\tdebugger;\r\n\t\treturn this.z;\r\n\t}\r\n\tset order(not_value) {\r\n\t\tdebugger;\r\n\t\tconsole.error(new TypeError(\"Not implement\"));\r\n\t}\r\n\r\n\t/** @returns {Vec2} */\r\n\tget origin() { return this._raw.origin || _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].empty; }\r\n\r\n\tisHasAnchor() { return !!this._raw.map; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget brow() { return this._raw.map.brow; }\r\n\tisAnchorBrow() { return !!this._raw.map.brow; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget neck() { return this._raw.map.neck; }\r\n\tisAnchorNeck() { return !!this._raw.map.neck; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget navel() { return this._raw.map.navel; }\r\n\tisAnchorNavel() { return !!this._raw.map.navel; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget hand() { return this._raw.map.hand; }\r\n\tisAnchorHand() { return !!this._raw.map.hand; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget handMove() { return this._raw.map.handMove; }\r\n\tisAnchorHandMove() { return !!this._raw.map.handMove; }\r\n\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earBelowHead() { return this._raw.map.earBelowHead; }\r\n\tisAnchor_EarBelowHead() { return !!this._raw.map.earBelowHead; }\r\n\r\n\t/** @returns {Vec2} */\r\n\tget _earOverHead() { return this._raw.map.earOverHead; }\r\n\tisAnchor_EarOverHead() { return !!this._raw.map.earOverHead; }\r\n\r\n\t/**\r\n\t * @param {FragmentTexture} that - this\r\n\t * @param {FragmentTexture} base - parent\r\n\t * @param {string} anchor - anchor name\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_anchor(that, base, anchor) {\r\n\t\treturn base[anchor].minus(that[anchor]).plus(base.origin.minus(that.origin));\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative(chara, body, head) {\r\n\t\tthis.calcRelative = this._getRelativeFunction(chara);\r\n\t\treturn this.calcRelative(chara, body, head);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getRelativeFunction(chara) {\r\n\t\tif (!this.isHasAnchor()) {\r\n\t\t\treturn this._calcRelativeEmpty;\r\n\t\t}\r\n\t\tif (this.isAnchorNeck()) {\r\n\t\t\treturn this._calcRelative_neck;\r\n\t\t}\r\n\t\tif (this.isAnchorBrow()) {\r\n\t\t\treturn this._calcRelative_brow;\r\n\t\t}\r\n\t\tif (this.isAnchorNavel()) {\r\n\t\t\tif (this == chara.slots.body) {\r\n\t\t\t\treturn this._getOrigin;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_navel;\r\n\t\t}\r\n\t\tif (this.isAnchorHand()) {\r\n\t\t\treturn this._calcRelative_hand;\r\n\t\t}\r\n\t\tif (this.isAnchorHandMove()) {\r\n\t\t\tif (this._url.lastIndexOf(\"lHand\") > 0) {\r\n\t\t\t\treturn this._calcRelative_handMove_lHand;\r\n\t\t\t}\r\n\t\t\treturn this._calcRelative_handMove;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelativeEmpty(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].empty;\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_getOrigin(chara, body, head) {\r\n\t\treturn this.origin;\r\n\t}\r\n\t/**\r\n\t * neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_neck(chara, body, head) {\r\n\t\treturn this._anchor(this, body, \"neck\").minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * brow on the head & head on the neck & neck on the navel\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_brow(chara, body, head) {\r\n\t\treturn this._anchor(this, head, \"brow\").plus(this._anchor(head, body, \"neck\")).minus(body.origin);//anchor_brow+(-7,-33)\r\n\t}\r\n\t/**\r\n\t * this is origin point, no anchor\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_navel(chara, body, head) {\r\n\t\treturn body.navel.minus(this.navel).minus(this.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_hand(chara, body, head) {\r\n\t\tconst hand = chara.slots.body.fragments.arm.getTexture(chara);\r\n\t\tif (hand == null) {\r\n\t\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].empty.minus(this.hand).minus(this.origin).minus(body.origin);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn this._anchor(this, hand, \"hand\").minus(this._anchor(body, hand, \"navel\")).minus(body.origin);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].empty.minus(this.origin).minus(this.handMove);\r\n\t}\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {FragmentTexture} body\r\n\t * @param {FragmentTexture} [head]\r\n\t * @returns {Vec2}\r\n\t */\r\n\t_calcRelative_handMove_lHand(chara, body, head) {\r\n\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Vec2\"].empty.minus(this.origin);\r\n\t}\r\n\t\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!(this.relative && this.visible)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\trenderer.drawGraph2(this, x, y);\r\n\t\t\trenderer.ctx.filter = \"none\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass BodyFragmentTexture extends FragmentTexture {\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tsuper.update(chara);\r\n\t\tthis.visible = !chara.hideBody;\r\n\t}\r\n}\r\n\r\nclass HairFragmentTexture extends FragmentTexture {\r\n\tconstructor(...args) {\r\n\t\tsuper(...args);\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph2 = null;\r\n\r\n\t\t/** @type {HairFragmentTexture} */\r\n\t\tthis.graph3 = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\tupdate(chara) {\r\n\t\tif (chara.slots.body && chara.slots.head) {\r\n\t\t\tconst body = chara.slots.body.fragments.body.getTexture(chara);\r\n\t\t\tconst head = chara.slots.head.fragments.head.getTexture(chara);\r\n\t\t\tif (body && head) {\r\n\t\t\t\tthis.relative = this.calcRelative(chara, body, head);\r\n\r\n\t\t\t\tconst tamingMob = chara.slots.tamingMob;\r\n\t\t\t\tif (tamingMob) {\r\n\t\t\t\t\tthis.relative = tamingMob.adj_pos(this.relative, body, chara);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.graph2) {\r\n\t\t\t\t\tthis.graph2.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.graph3) {\r\n\t\t\t\t\tthis.graph3.relative = this.relative;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterAnimationBase} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (!this.relative) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\trenderer.globalAlpha = this.opacity || 1;\r\n\t\tif (this.filter.isEmpty) {\r\n\t\t\tthis._render(renderer);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderer.ctx.filter = this.filter.toString();\r\n\t\t\tthis._render(renderer);\r\n\t\t\trenderer.ctx.filter = \"none\";\r\n\t\t}\r\n\t}\r\n\t_render(renderer) {\r\n\t\tconst x = this.relative.x;\r\n\t\tconst y = this.relative.y;\r\n\r\n\t\trenderer.drawGraph2(this, x, y);\r\n\r\n\t\tif (this.graph2 && this.graph2.opacity) {//color2\r\n\t\t\trenderer.globalAlpha = this.graph2.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph2, x, y);\r\n\t\t}\r\n\t\tif (this.graph3 && this.graph3.opacity) {//color3\r\n\t\t\trenderer.globalAlpha = this.graph3.opacity;\r\n\r\n\t\t\trenderer.drawGraph2(this.graph3, x, y);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass ItemEffectAnimation extends _Animation__WEBPACK_IMPORTED_MODULE_2__[\"Animation\"] {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t\t\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\t//this._url = this._url;\r\n\r\n\t\tthis.__getAttr(\"z\", -1);\r\n\t\tthis.__getAttr(\"pos\", 1);\r\n\r\n\t\tsuper.load();\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {boolean} actionExceptRotation\r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\trender(renderer, actionExceptRotation, angle, flip) {\r\n\t\tif (actionExceptRotation) {\r\n\t\t\tthis.draw(renderer, 0, 0, -angle, flip);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst oy = -this.texture.height * 0.25;\r\n\t\t\tthis.draw(renderer, 0, oy, 0, flip);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//\t/data/Effect/ItemEff/1102918\r\nclass ItemEffect {\r\n\tconstructor() {\r\n\t\tthis._url = null;\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {{[animationName:string]:ItemEffectAnimation}} */\r\n\t\tthis.animation = {};\r\n\r\n\t\tthis.action = null;\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\r\n\t\tthis.fixed = 0;\r\n\t\tthis.z = -2;\r\n\t\tthis.action = 1;\r\n\t\tthis.actionExceptRotation = 0;\r\n\t\t\r\n\t\tthis.enable = true;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\ttry {\r\n\t\t\t/** @type {Set<string>} */\r\n\t\t\tlet itemEffectList = ItemEffect._list;\r\n\r\n\t\t\t/** @type {string[]} */\r\n\t\t\tlet raw = await $get.list(\"/Effect/ItemEff\");\r\n\r\n\t\t\titemEffectList.clear();\r\n\r\n\t\t\traw.forEach(id => {\r\n\t\t\t\titemEffectList.add(parseInt(id, 10));\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<ItemEffect>}\r\n\t */\r\n\tstatic async load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\r\n\t\tif (ItemEffect._list.has(id)) {\r\n\t\t\tlet eff = new ItemEffect();\r\n\t\t\tawait eff.load(equipID);\r\n\t\t\treturn eff;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * if (!exist) return null\r\n\t * @param {string} equipID\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tasync load(equipID) {\r\n\t\tconst id = Number(equipID);\r\n\t\tconst url = `/Effect/ItemEff/${id}/effect`;\r\n\t\tlet raw;\r\n\r\n\t\ttry {\r\n\t\t\traw = await $get.data(url);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\tif (raw) {\r\n\t\t\treturn this._load(equipID, url, raw);\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t * @param {string} action\r\n\t */\r\n\tupdate(stamp, action) {\r\n\t\tif (action in this.animation) {\r\n\t\t\tthis.action = action;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.action = \"default\";\r\n\t\t}\r\n\r\n\t\tif (this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {CharacterRenderer} chara\r\n\t */\r\n\trender(renderer, chara) {\r\n\t\tif (this.animation && this.animation[this.action]) {\r\n\t\t\tthis.animation[this.action].render(renderer, this.actionExceptRotation, chara.angle, chara.front > 0);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} equipID\r\n\t * @param {object} raw_data\r\n\t */\r\n\t_load(equipID, url, raw) {\r\n\t\tthis.id = equipID;\r\n\r\n\t\tif (!raw) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__construct();\r\n\t}\r\n\t__construct() {\r\n\t\tthis.__getAttr(\"fixed\", 0);\r\n\t\tthis.__getAttr(\"z\", -1);\r\n\t\tthis.__getAttr(\"action\", 1);\r\n\t\tthis.__getAttr(\"actionExceptRotation\", 0);\r\n\r\n\t\tfor (let i in this._raw) {\r\n\t\t\tif (this._raw[i] && typeof this._raw[i] == \"object\" && '0' in this._raw[i]) {//animation has frames\r\n\t\t\t\tthis.animation[i] = new ItemEffectAnimation(this._raw[i], [this._url, i].join(\"/\"));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__getAttr(attr, defVal) {\r\n\t\tif (attr in this._raw) {\r\n\t\t\tthis[attr] = this._raw[attr];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis[attr] = defVal;\r\n\t\t}\r\n\t}\r\n}\r\n/** @type {Set<string>} */\r\nItemEffect._list = new Set();\r\n\r\nclass CharacterFragmentBase {\r\n\t/**\r\n\t * @param {{[action:string]: FragmentTexture[]}} textures\r\n\t */\r\n\tconstructor(textures) {\r\n\t\t/** @type {{[action:string]: FragmentTexture[]}} - textures[action:string][frame:number] */\r\n\t\tthis.textures = textures;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterBodyFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.action_frame);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.action]) {\r\n\t\t\treturn this.textures[chara.action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterFaceFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara.emotion_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara.emotion in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara.emotion][frame];\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara.emotion]) {\r\n\t\t\treturn this.textures[chara.emotion].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * @final \r\n */\r\nclass CharacterTamingMobFragment extends CharacterFragmentBase {\r\n\tconstructor(textures) {\r\n\t\tsuper(textures);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetTexture(chara) {\r\n\t\treturn this.getFrameTexture(chara, chara._action_frame);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @param {number} frame\r\n\t * @returns {FragmentTexture}\r\n\t */\r\n\tgetFrameTexture(chara, frame) {\r\n\t\tif (!(chara._ride_action in this.textures)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tlet ft = this.textures[chara._ride_action][frame];//if frame not exist then return undefined\r\n\t\treturn ft;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tif (this.textures[chara._ride_action]) {\r\n\t\t\treturn this.textures[chara._ride_action].length;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n}\r\n\r\nclass EquipImageFilter {\r\n\t/**\r\n\t * @param {CharacterAppearanceBase} equip\r\n\t */\r\n\tconstructor(equip) {\r\n\t\tthis.equip = equip;\r\n\t}\r\n\r\n\tget hue() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.hue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset hue(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget sat() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.sat;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset sat(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.sat = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget bri() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset bri(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.bri = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget contrast() {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.filter.contrast;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tset contrast(value) {\r\n\t\tconst equip = this.equip;\r\n\t\tfor (let i in equip.fragments) {\r\n\t\t\tfor (let j in equip.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < equip.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = equip.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.contrast = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\thue: this.hue,\r\n\t\t\tsat: this.sat,\r\n\t\t\tbri: this.bri,\r\n\t\t\tcontrast: this.contrast,\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * @interface\r\n */\r\nclass ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tisLoaded() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\t_unload() {\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\ttoJSON() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t\treturn {\r\n\t\t\tid: -1,//invalid ID\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * ??\r\n */\r\nclass _CharacterAppearanceBaseSlotLink extends ICharacterAppearanceBase {\r\n\tconstructor(slot_link) {\r\n\t\tsuper();\r\n\t\tthis.slot_link = slot_link;//??\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: slot_link,//??\r\n\t\t};\r\n\t}\r\n}\r\n\r\n/**\r\n * character loader\r\n */\r\nclass CharacterAppearanceBase extends ICharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\t\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\t//this._url = null;\r\n\t\t\t\r\n\t\t/** @type {ItemEffect} */\r\n\t\tthis.effect = null;\r\n\r\n\t\t/**\r\n\t\t * @type {{[place:string]:CharacterFragmentBase}}\r\n\t\t */\r\n\t\tthis.fragments = null;\r\n\r\n\t\tthis._onload = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\r\n\t\t/** @type {ItemCategoryInfo} */\r\n\t\tthis.categoryInfo = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.slot_order = 0;\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.islot = {};\r\n\r\n\t\t/** @type {object<string, number>} */\r\n\t\tthis.vslot = {};\r\n\r\n\t\tthis.filter = new EquipImageFilter(this);\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\treturn {\r\n\t\t\tid: this.id,\r\n\t\t\tfilter: this.filter.toJSON(),\r\n\t\t};\r\n\t}\r\n\r\n\tisLoaded() {\r\n\t\treturn this.fragments != null;\r\n\t}\r\n\r\n\t/** @type {function(CharacterAppearanceBase):void} */\r\n\tget _onload() {\r\n\t\treturn this.__onload;\r\n\t}\r\n\tset _onload(func) {\r\n\t\tthis.__onload = func;\r\n\t\tif (this.isLoaded()) {\r\n\t\t\tthis.__onload.call(this, this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {void} use_category - no use\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tlet raw;\r\n\r\n\t\tthis.id = id;\r\n\t\tthis.categoryInfo = cateInfo;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ResourceManager\"].isEquipExist(id, cateInfo)) {\r\n\t\t\t\traw = await _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].getItem(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (!raw && load_extern_item_data) {\r\n\t\t\t\traw = await load_extern_item_data(id);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\r\n\t\t//this._url = url;\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: raw,\r\n\t\t});\r\n\r\n\t\tthis.__load_slot();\r\n\r\n\t\tthis.__load_fragments();\r\n\r\n\t\tif (this._onload) {\r\n\t\t\tthis._onload.call(this, this);\r\n\t\t}\r\n\r\n\t\t//// if not body, head, face, hair then try load effect\r\n\t\t//if (id >= \"00050000\") {\r\n\t\t\t// load if exist\r\n\t\t\tItemEffect.load(this.id).then(a => this.effect = a);//01102918\t//01102915\r\n\t\t//}\r\n\r\n\t\treturn true;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tconst FragmentConstructor = this.FragmentConstructor;\r\n\r\n\t\t//Object.keys(this._raw_textures).map(k => { return '0' in this._raw_textures[k]; })\r\n\r\n\t\tlet action_list = Object.keys(this._raw_textures);\r\n\r\n\t\tlet textures = {};\r\n\t\tfor (let action of action_list) {\r\n\t\t\tif (typeof this._raw_textures[action] == \"object\" && \"0\" in this._raw_textures[action]) {\r\n\t\t\t\tlet _url = this._base_path + action;\r\n\r\n\t\t\t\ttextures[action] = this.__load_frame_textures(this._raw_textures[action], _url);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragment_textures = {};\r\n\t\tfor (let action in textures) {\r\n\t\t\tfor (let frame in textures[action]) {\r\n\t\t\t\tfor (let place in textures[action][frame]) {\r\n\t\t\t\t\tif (!(place in fragment_textures)) {\r\n\t\t\t\t\t\tfragment_textures[place] = {};\r\n\t\t\t\t\t\t//fragment_textures[place].visible = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!(action in fragment_textures[place])) {\r\n\t\t\t\t\t\tfragment_textures[place][action] = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfragment_textures[place][action][frame] = textures[action][frame][place];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet fragments = {};\r\n\t\tfor (let frag in fragment_textures) {\r\n\t\t\tfragments[frag] = new FragmentConstructor(fragment_textures[frag]);\r\n\t\t}\r\n\t\tthis.fragments = fragments;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}[]} - array - textures[frame][place]\r\n\t */\r\n\t__load_frame_textures(_raw, _url) {\r\n\t\tlet textures = [];\r\n\t\tfor (let frame = 0; frame in _raw; ++frame) {\r\n\t\t\tlet url = `${_url}/${frame}`;\r\n\t\t\ttextures[frame] = this.__load_place_textures(_raw[frame], url);\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t/**\r\n\t * @param {string} _url\r\n\t * @returns {{[place:string]:FragmentTexture}} - object - textures[place]\r\n\t */\r\n\t__load_place_textures(_raw, _url) {\r\n\t\tlet textures = {};\r\n\t\tfor (let place in _raw) {\r\n\t\t\tlet path = `${_url}/${place}`;\r\n\t\t\tlet raw = _raw[place];\r\n\r\n\t\t\tif (raw) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tconst FragmentTextureConstructor = this.FragmentTextureConstructor;\r\n\t\t\t\tlet ft;\r\n\t\t\t\tif (raw[\"\"] == \"\") {\r\n\t\t\t\t\tft._url = path;\r\n\t\t\t\t\t//ft._url = path;\r\n\t\t\t\t\ttextures[place] = ft\r\n\t\t\t\t}\r\n\t\t\t\telse if (typeof raw[\"\"] == 'string') {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw);\r\n\t\t\t\t\t//ft._url = raw[\"\"];\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\telse if (place == \"hairShade\") {\r\n\t\t\t\t\tft = new FragmentTextureConstructor(raw[0]);\r\n\t\t\t\t\t//ft._url = path + \"/0\";\r\n\t\t\t\t\ttextures[place] = ft;\r\n\t\t\t\t}\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tft._slot = this.categoryInfo.slot;\r\n\t\t\t\t\tft._place = place;\r\n\r\n\t\t\t\t\tft.classList = [\r\n\t\t\t\t\t\tft._slot,\r\n\t\t\t\t\t\t\"item\" + this.id,\r\n\t\t\t\t\t\tft._place,\r\n\t\t\t\t\t\tft._raw.z,\r\n\t\t\t\t\t\t'z' + ft.z\r\n\t\t\t\t\t].join(' ');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn textures;\r\n\t}\r\n\t__load_slot() {\r\n\t\tif (!this._raw.info.islot) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet islots = this._raw.info.islot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in islots) {\r\n\t\t\tconst slot = islots[i];\r\n\t\t\tconst slot_order = zMap[slot];\r\n\t\t\tthis.islot[slot] = slot_order;\r\n\t\t\t\t\r\n\t\t\tif (slot_order > this.slot_order) {//this.slot_order = Math.max(this.slot_order, slot_order);\r\n\t\t\t\tthis.slot_order = slot_order;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet vslots = this._raw.info.vslot.match(/([A-Z][a-z0-9])/g);\r\n\t\tfor (let i in vslots) {\r\n\t\t\tconst slot = vslots[i];\r\n\t\t\tthis.vslot[slot] = slot;\r\n\t\t}\r\n\t}\r\n\r\n\t_unload() {\r\n\t\tthis.fragments = null;\r\n\t\tthis.effect == null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget opacity() {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\treturn ft.opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} opacity\r\n\t */\r\n\tset opacity(opacity) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.opacity = opacity;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} hue 0 ~ 360\r\n\t * @param {number} sat 0 ~ 100\r\n\t * @param {number} bri 0 ~ 100\r\n\t */\r\n\tsetFilter(hue, sat, bri) {\r\n\t\tfor (let i in this.fragments) {\r\n\t\t\tfor (let j in this.fragments[i].textures) {\r\n\t\t\t\tfor (let k = 0; k < this.fragments[i].textures[j].length; ++k) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = this.fragments[i].textures[j][k];\r\n\t\t\t\t\tif (ft) {\r\n\t\t\t\t\t\tft.filter.hue = hue;\r\n\t\t\t\t\t\tft.filter.sat = sat;\r\n\t\t\t\t\t\tft.filter.bri = bri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get icon url\r\n\t * @see {@link ItemCategoryInfo.getIconUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconUrl() {\r\n\t\tconst icon = this._raw.info.icon;\r\n\t\tif (icon) {\r\n\t\t\treturn icon[\"\"];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].getIconUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * get iconRaw url\r\n\t * @see {@link ItemCategoryInfo.getIconRawUrl}\r\n\t * @returns {string}\r\n\t */\r\n\tgetIconRawUrl() {\r\n\t\tconst iconRaw = this._raw.info.iconRaw;\r\n\t\tif (iconRaw) {\r\n\t\t\treturn iconRaw[\"\"];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].getIconRawUrl(this.id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @type {string}\r\n\t */\r\n\tget _animation_type() {\r\n\t\tthrow new Error(\"Not Implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof CharacterFragmentBase}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {{[actions:string]:{[\"0\"]:Sprite,[frames:string]:Sprite}}} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw;\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url;\r\n\t}\r\n}\r\n\r\n/**\r\n * @abstract\r\n */\r\nclass CharacterAppearance extends CharacterAppearanceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == \"face\" || k == \"delay\" || k == \"default\"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara.action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.action][chara.action_frame].delay;\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n}\r\n\r\nclass CharacterBody extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquip extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof BodyFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn BodyFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterEquipCashWeapon extends CharacterEquip {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.use_category = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {string} id\r\n\t * @param {ItemCategoryInfo} cateInfo\r\n\t * @param {string} use_category - cash-weapon as [category]\r\n\t * @returns {Promise<boolean>} - true if item exist\r\n\t */\r\n\tasync load(url, id, cateInfo, use_category) {\r\n\t\tif (!use_category && use_category != \"\") {\r\n\t\t\tthrow new TypeError(\"use_category\");\r\n\t\t}\r\n\r\n\t\tthis.use_category = use_category.slice(2, 4);\r\n\r\n\t\treturn super.load(url, id, cateInfo);\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {object} raw_textures[...actions][...frames][...fragments]\r\n\t */\r\n\tget _raw_textures() {\r\n\t\treturn this._raw[this.use_category];\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn this._url + this.use_category;\r\n\t}\r\n}\r\n\r\n\r\nclass CharacterHeadBase extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterHead extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.elfEarFragment = null;\r\n\t\tthis.lefEarFragment = null;\r\n\t\tthis.highlefEarFragment = null;\r\n\t}\r\n\t__load_fragments() {\r\n\t\tsuper.__load_fragments()\r\n\t\t\r\n\t\tif (this.fragments) {\r\n\t\t\tif (this.fragments.ear) {\r\n\t\t\t\tthis.elfEarFragment = this.fragments.ear;\r\n\t\t\t\tdelete this.fragments.ear;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.lefEar) {\r\n\t\t\t\tthis.lefEarFragment = this.fragments.lefEar;\r\n\t\t\t\tdelete this.fragments.lefEar;\r\n\t\t\t}\r\n\t\t\tif (this.fragments.highlefEar) {\r\n\t\t\t\tthis.highlefEarFragment = this.fragments.highlefEar;\r\n\t\t\t\tdelete this.fragments.highlefEar;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tget elfEar() {\r\n\t\treturn this.fragments.ear != null;\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (!this.elfEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.ear = this.elfEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.ear;\r\n\t\t}\r\n\t}\r\n\r\n\tget lefEar() {\r\n\t\treturn this.fragments.lefEar != null;\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (!this.lefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.lefEar = this.lefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.lefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget highlefEar() {\r\n\t\treturn this.fragments.highlefEar != null;\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (!this.highlefEarFragment) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (value) {\r\n\t\t\tthis.fragments.highlefEar = this.highlefEarFragment;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelete this.fragments.highlefEar;\r\n\t\t}\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterHair extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterBodyFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterBodyFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * hair color mix\r\n\t * @override\r\n\t * @returns {typeof HairFragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn HairFragmentTexture;\r\n\t}\r\n}\r\n\r\nclass CharacterFaceBase extends CharacterHeadBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t//__is_texture(k) {\r\n\t//\treturn (!(k == \"delay\" || k == \"default\"));\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.face.fragments.face.textures[chara.emotion].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = this._raw[chara.emotion][chara.emotion_frame].delay;\r\n\t\tif (d != null) {//!isNaN(d) && isFinite(d)\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n}\r\nclass CharacterFace extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"emotion\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\nclass CharacterFaceAcc extends CharacterFaceBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"emotion\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterFaceFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterFaceFragment;\r\n\t}\r\n}\r\n\r\nclass CharacterTamingMob extends CharacterAppearance {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget type() {\r\n\t\treturn this._raw.info.tamingMob;\r\n\t}\r\n\r\n\tget actionMap() {\r\n\t\treturn this._raw.characterAction;\r\n\t}\r\n\r\n\tget emotionMap() {\r\n\t\treturn this._raw.characterEmotion;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Vec2} relative\r\n\t * @param {FragmentTexture} body\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {Vec2}\r\n\t */\r\n\tadj_pos(relative, body, chara) {\r\n\t\tconst frag = this.fragments[0];//default\r\n\t\tif (frag) {\r\n\t\t\tconst tm = frag.getTexture(chara);\r\n\t\t\tif (tm) {\r\n\t\t\t\treturn relative.plus(tm.navel.minus(body.navel));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn relative;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetFrameCount(chara) {\r\n\t\treturn chara.slots.body.fragments.body.textures[chara._ride_action].length;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {CharacterAnimationBase} chara\r\n\t * @returns {number}\r\n\t */\r\n\tgetDelay(chara) {\r\n\t\tconst d = Math.trunc(this._raw[chara._ride_action][chara.action_frame].delay);//?? _ride_action_frame => action_frame\r\n\t\tif (Number.isSafeInteger(d)) {\r\n\t\t\treturn d;\r\n\t\t}\r\n\t\treturn 120;\r\n\t}\r\n\r\n\tget _animation_type() {\r\n\t\treturn \"_ride_action\";\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof CharacterTamingMobFragment}\r\n\t */\r\n\tget FragmentConstructor() {\r\n\t\treturn CharacterTamingMobFragment;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {typeof FragmentTexture}\r\n\t */\r\n\tget FragmentTextureConstructor() {\r\n\t\treturn FragmentTexture;\r\n\t}\r\n}\r\n\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0000'].FragmentType = CharacterBody;\t\t//\tbody\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0001'].FragmentType = CharacterHead;\t\t//\telfEar\t\t\t-> CharacterHeadBase -> CharacterHead\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0002'].FragmentType = CharacterFace;\t\t//\tFace\t\t\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFace\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0003'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0004'].FragmentType = CharacterHair;\t\t//\tHair\t\t\t-> CharacterHeadBase -> CharacterHair\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0100'].FragmentType = CharacterEquip;\t\t//\tCap\t\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0101'].FragmentType = CharacterFaceAcc;\t\t//\taccessoryFace\t-> CharacterHeadBase -> CharacterFaceBase -> CharacterFaceAcc\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0102'].FragmentType = CharacterEquip;\t\t//\taccessoryEyes\t-> CharacterEquip\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0103'].FragmentType = CharacterEquip;\t\t//\taccessoryEars\t-> CharacterEquip\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0104'].FragmentType = CharacterEquip;\t\t//\tCoat\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0105'].FragmentType = CharacterEquip;\t\t//\tLongcoat\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0106'].FragmentType = CharacterEquip;\t\t//\tPants\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0107'].FragmentType = CharacterEquip;\t\t//\tShoes\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0108'].FragmentType = CharacterEquip;\t\t//\tGlove\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0109'].FragmentType = CharacterEquip;\t\t//\tShield\t\t\t-> CharacterBody\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0110'].FragmentType = CharacterEquip;\t\t//\tCape\t\t\t-> CharacterBody\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['0170'].FragmentType = CharacterEquipCashWeapon;\t//\tcash-weapon\t-> CharacterEquip\r\n\r\n_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"]._info['019'].FragmentType = CharacterTamingMob;\t//\tTamingMob\t\t-> CharacterTamingMob\r\n\r\n\r\nclass CharacterSlots {\r\n\tconstructor() {\r\n\t\t\t\r\n\t\t/** @type {CharacterAppearanceBase[]} */\r\n\t\tthis._ordered_slot = [];\r\n\r\n\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis.hair = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair2 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix2 = null;\r\n\t\t/** @type {CharacterHair} */\r\n\t\tthis._hair3 = null;\r\n\t\t/** @type {CharacterHair} 0~1.0 */\r\n\t\tthis._hairMix3 = null;\r\n\r\n\r\n\t\t/** @type {CharacterEquipBody} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.head = null;\r\n\r\n\t\t/** @type {CharacterFace} */\r\n\t\tthis.face = null;\r\n\r\n\t\t/** @type {CharacterEquip} */\r\n\t\tthis.hair = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 1 */\r\n\t\tthis.cap = null;\r\n\r\n\t\t/** @type {CharacterFace} - 2 */\r\n\t\tthis.accessoryFace = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 3*/\r\n\t\tthis.accessoryEyes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 4 */\r\n\t\tthis.accessoryEars = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.coat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 5 */\r\n\t\tthis.longcoat = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 6 */\r\n\t\tthis.pants = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 7 */\r\n\t\tthis.shoes = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 8 */\r\n\t\tthis.glove = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 9 */\r\n\t\tthis.cape = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 10 */\r\n\t\tthis.shield = null;\r\n\r\n\t\t/** @type {CharacterEquip} - 11 */\r\n\t\tthis.weapon = null;\r\n\t\t\r\n\t\t/** @type {CharacterTamingMob} */\r\n\t\tthis.tamingMob = null;\r\n\t\t\r\n\t\t{\r\n\t\t\tObject.defineProperty(this, \"_ordered_slot\", {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: []\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, \"_hair\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"hair\", {\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn this._hair;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (value) {\r\n\t\t\t\t\tthis._hair = value;\r\n\t\t\t\t\tif (value) {\r\n\t\t\t\t\t\tif (this._hair2 && this._hairMix2) {\r\n\t\t\t\t\t\t\tthis.hairColor2 = this.hairColor2;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (this._hair3 && this._hairMix3) {\r\n\t\t\t\t\t\t\tthis.hairColor3 = this.hairColor3;//force reload\r\n\t\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, \"_hair\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hair2\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hairMix2\", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hair3\", {\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t\tObject.defineProperty(this, \"_hairMix3\", {\t// 0~1.0\r\n\t\t\t\twritable: true,\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tvalue: null,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync __loadColoredHair(color) {\r\n\t\tconst id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getColorHairID(this.hair.id, color);\r\n\t\tconst cateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tconst url = `/Character/${cateInfo.path + (cateInfo.path ? \"/\" : \"\") + id}`;\r\n\t\t\tconst use_category = undefined;\r\n\r\n\t\t\tlet hair = new CharacterHair();\r\n\r\n\t\t\tawait hair.load(url, id, cateInfo, use_category);\r\n\r\n\t\t\treturn hair;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {number} */\r\n\tget hairColor2() {\r\n\t\tif (this._hair2) {\r\n\t\t\treturn Number(_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getHairColor(this._hair2.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor2(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc2Id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair2 || hc2Id != this._hair2.id) {\r\n\t\t\tif (hc2Id == this._hair.id) {\r\n\t\t\t\tthis._hair2 = null;\r\n\t\t\t\tthis.hairMix2 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair2 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair2.then(hair2 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair2;\r\n\r\n\t\t\t\t\tthis._hair2 = hair2;\r\n\t\t\t\t\tif (this._hair2 && this.hairMix2 != null) {\r\n\t\t\t\t\t\tthis.hairMix2 = this.hairMix2;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix2 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairMix2() {\r\n\t\treturn this._hairMix2;\r\n\t}\r\n\tset hairMix2(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair2).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair2;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph2 = ft;\r\n\t\t\t\t\t\t\tori.graph2.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix2 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/** @returns {number} 0~1.0 */\r\n\tget hairColor3() {\r\n\t\tif (this._hair3) {\r\n\t\t\treturn Number(_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getHairColor(this._hair3.id));\r\n\t\t}\r\n\t}\r\n\tset hairColor3(color) {\r\n\t\tif (!color) {\r\n\t\t\tconsole.error(new TypeError());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet hc3Id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getColorHairID(this.hair.id, color);\r\n\r\n\t\tif (!this._hair3 || this._hair3.id != hc3Id) {\r\n\t\t\tif (this._hair.id == hc3Id || this._hair2.id == hc3Id) {\r\n\t\t\t\tthis._hair3 = null;\r\n\t\t\t\tthis.hairMix3 = 0;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.hair.$promise_hair3 = this.__loadColoredHair(color);\r\n\r\n\t\t\t\tthis.hair.$promise_hair3.then(hair3 => {\r\n\t\t\t\t\tdelete this.hair.$promise_hair3;\r\n\r\n\t\t\t\t\tthis._hair3 = hair3;\r\n\t\t\t\t\tif (this._hair3 && this.hairMix3 != null) {\r\n\t\t\t\t\t\tthis.hairMix3 = this.hairMix3;//force update\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tthis.hairMix3 = 0;//disable\r\n\t\t\t\t\t//}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/** @returns {number} */\r\n\tget hairMix3() {\r\n\t\treturn this._hairMix3;\r\n\t}\r\n\tset hairMix3(value) {\r\n\t\tvalue = Number(value);\r\n\r\n\t\tPromise.resolve(this.hair.$promise_hair3).then(() => {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this._hair3;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet base = this.hair;\r\n\r\n\t\t\tif (!item || !base) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\tfor (let k in item.fragments[j].textures) {\r\n\t\t\t\t\tfor (let i = 0; i < item.fragments[j].textures[k].length; ++i) {\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ft = item.fragments[j].textures[k][i];\r\n\t\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\t\tlet ori = base.fragments[j].textures[k][i];\r\n\t\t\t\t\t\tif (ori) {\r\n\t\t\t\t\t\t\tori.graph3 = ft;\r\n\t\t\t\t\t\t\tori.graph3.opacity = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._hairMix3 = value;\r\n\t\t});\r\n\t}\r\n\r\n\t//__order_slot() {\r\n\t//\tlet slot_map = new Map();\r\n\t//\r\n\t//\tfor (let i in this) {\r\n\t//\t\tlet equip = this[i];\r\n\t//\r\n\t//\t\tequip.cs\r\n\t//\t}\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {CharacterAppearanceBase} loadedEquip\r\n\t * @param {string} use_category - category which used of cash-weapon\r\n\t */\r\n\tasync _use(id, loadedEquip, use_category) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst cateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].get(id);\r\n\r\n\t\tif (cateInfo) {\r\n\t\t\tlet url = `/Character/${cateInfo.path + (cateInfo.path ? \"/\":\"\") + id}`;\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item;\r\n\r\n\t\t\tif (loadedEquip instanceof CharacterAppearanceBase) {\r\n\t\t\t\talert(\"CharacterSlots # _use: param loadedEquip ??\");\r\n\t\t\t\tdebugger;\r\n\t\t\t\titem = loadedEquip;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (loadedEquip) {\r\n\t\t\t\t\talert(\"CharacterSlots # _use: param loadedEquip ??\");\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t}\r\n\t\t\t\tconst fragmentType = cateInfo.FragmentType || CharacterEquip;\r\n\r\n\t\t\t\titem = new fragmentType();\r\n\t\t\t}\r\n\t\t\t/** _use_loaded_equip */\r\n\t\t\tif (0) {}\r\n\r\n\t\t\tlet is_exist = loadedEquip || await item.load(url, id, cateInfo, use_category);\r\n\t\t\tif (is_exist) {\r\n\t\t\t\t/** _use_loaded_equip */\r\n\t\t\t\tif (1) {\r\n\t\t\t\t\tif (this[cateInfo.slot]) {\r\n\t\t\t\t\t\tthis[cateInfo.slot]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis[cateInfo.slot] = item;\r\n\r\n\t\t\t\t\tthis._ordered_slot[item.slot_order] = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn(\"item(\" + id + \") is not exist\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {string} id\r\n\t * @returns {boolean}\r\n\t */\r\n\t_unuse(id) {\r\n\t\tif (!id) {\r\n\t\t\tdebugger\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet cateInfo, equip;\r\n\r\n\t\tif (id instanceof CharacterAppearanceBase) {\r\n\t\t\tequip = id;\r\n\t\t\tid = equip.id;\r\n\t\t\tcateInfo = equip.categoryInfo;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcateInfo = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].get(id);\r\n\t\t}\r\n\t\t\r\n\t\tconst slotName = cateInfo.slot;\r\n\r\n\t\tif (slotName != \"head\" && slotName != \"body\") {\r\n\t\t\tif (this[slotName] && this[slotName].id == id) {\r\n\t\t\t\tequip = this[slotName];\r\n\t\t\t\tfor (let slot in equip.islot) {\r\n\t\t\t\t\tlet order = equip.islot[slot];\r\n\t\t\t\t\tif (this._ordered_slot[order]) {\r\n\t\t\t\t\t\tthis._ordered_slot[order]._unload();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdelete this._ordered_slot[order];\r\n\t\t\t\t}\r\n\t\t\t\tthis[slotName] = null;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t_clear() {\r\n\t\t//this.body = null;\r\n\t\t//this.head = null;\r\n\t\tthis.face = null;\r\n\t\tthis.hair = null;\r\n\t\tthis.cap = null;\r\n\t\tthis.accessoryFace = null;\r\n\t\tthis.accessoryEyes = null;\r\n\t\tthis.accessoryEars = null;\r\n\t\tthis.coat = null;\r\n\t\tthis.longcoat = null;\r\n\t\tthis.pants = null;\r\n\t\tthis.shoes = null;\r\n\t\tthis.glove = null;\r\n\t\tthis.cape = null;\r\n\t\tthis.shield = null;\r\n\r\n\t\t//temp\r\n\t\tlet head = this.head;\r\n\t\tlet body = this.body;\r\n\r\n\t\t//clear\r\n\t\tthis._ordered_slot = [];\r\n\r\n\t\t//restore\r\n\t\tif (head) {\r\n\t\t\tthis._ordered_slot[head.slot_order] = head;\r\n\t\t}\r\n\t\tif (body) {\r\n\t\t\tthis._ordered_slot[body.slot_order] = body;\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify() {\r\n\t\tlet slots = [\"c\"];\r\n\t\t\t\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id + \"|\" + this.face.id);\r\n\t\tif (this.hair) {\r\n\t\t\tlet ha = [];\r\n\t\t\tha.push(this.hair.id);\r\n\t\t\tif (this.hairColor2 && this.hairMix2 > 0) ha.push(this.hairColor2 + \"%\" + Math.trunc(this.hairMix2 * 100));\r\n\t\t\tif (this.hairColor3 && this.hairMix3 > 0) ha.push(this.hairColor3 + \"%\" + Math.trunc(this.hairMix3 * 100));\r\n\t\t\tslots.push(ha.join(\"|\"));\r\n\t\t}\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots.join(\",\");\r\n\t}\r\n\r\n\ttoJSON() {\r\n\t\tlet slots = [];\r\n\r\n\t\tif (this.body) slots.push(this.body.id);\r\n\t\tif (this.head) slots.push(this.head.id);\r\n\t\tif (this.face) slots.push(this.face.id);\r\n\t\tif (this.hair) slots.push(this.hair.id);\r\n\t\tif (this.cap) slots.push(this.cap.id);\r\n\t\tif (this.accessoryFace) slots.push(this.accessoryFace.id);\r\n\t\tif (this.accessoryEyes) slots.push(this.accessoryEyes.id);\r\n\t\tif (this.accessoryEars) slots.push(this.accessoryEars.id);\r\n\t\tif (this.coat) slots.push(this.coat.id);\r\n\t\tif (this.longcoat) slots.push(this.longcoat.id);\r\n\t\tif (this.pants) slots.push(this.pants.id);\r\n\t\tif (this.shoes) slots.push(this.shoes.id);\r\n\t\tif (this.glove) slots.push(this.glove.id);\r\n\t\tif (this.shield) slots.push(this.shield.id);\r\n\t\tif (this.cape) slots.push(this.cape.id);\r\n\t\tif (this.weapon) slots.push(this.weapon.id);\r\n\r\n\t\treturn slots;\r\n\t}\r\n\r\n\t/**\r\n\t * returns: [face, hair, cap, ..., weapon]\r\n\t */\r\n\t*enumerate() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.hair) yield this.hair;\r\n\r\n\t\tyield* this.enumerate_equip();\r\n\t}\r\n\t*enumerate_equip() {\r\n\t\tif (this.cap) yield this.cap;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t\tif (this.accessoryEyes) yield this.accessoryEyes;\r\n\t\tif (this.accessoryEars) yield this.accessoryEars;\r\n\t\tif (this.coat) yield this.coat;\r\n\t\tif (this.longcoat) yield this.longcoat;\r\n\t\tif (this.pants) yield this.pants;\r\n\t\tif (this.shoes) yield this.shoes;\r\n\t\tif (this.glove) yield this.glove;\r\n\t\tif (this.shield) yield this.shield;\r\n\t\tif (this.cape) yield this.cape;\r\n\t\tif (this.weapon) yield this.weapon;\r\n\t}\r\n\t*enumerate_face() {\r\n\t\tif (this.face) yield this.face;\r\n\t\tif (this.accessoryFace) yield this.accessoryFace;\r\n\t}\r\n}\r\n\r\nclass CharacterChangeLog {\r\n\tconstructor() {\r\n\t\t/** @type {\"human\"|\"elf\"|\"lef\"|\"highlef\"} */\r\n\t\tthis.ear = undefined;\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.useEquip = [];\r\n\r\n\t\t/** @type {string[]} */\r\n\t\tthis.unuseEquip = [];\r\n\t\t\r\n\t\t/** @type {string} - hair2 id */\r\n\t\tthis.hair2 = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.hairMix2 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hair3 = undefined;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.hairMix3 = undefined;\r\n\r\n\t\t/** @type {string} weapon => equip id */\r\n\t\tthis.weapon = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.ear = undefined;\r\n\t\tthis.useEquip = [];\r\n\t\tthis.unuseEquip = [];\r\n\t\tthis.hair2 = undefined;\r\n\t\tthis.hairMix2 = undefined;\r\n\t\t//this.hair3 = undefined;\r\n\t\t//this.hairMix3 = undefined;\r\n\t\tthis.weaponType = undefined;\r\n\t}\r\n}\r\n\r\nclass CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tthis._$dirty = 0;//force update vue\r\n\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.job = null;\r\n\t\t/** @type {string} - 未完成 */\r\n\t\tthis.subJob = null;\r\n\r\n\r\n\t\t/** @type {ActionAnimation} */\r\n\t\tthis.actani = new _CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__[\"ActionAnimation\"]();\r\n\r\n\t\t/** @type {number} - animation speed rate */\r\n\t\tthis.speed = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.fixed_speed = false;\r\n\r\n\t\t/** @type {boolean} - pause animation */\r\n\t\tthis.pause = false;\r\n\r\n\r\n\t\tthis.hideBody = false;\r\n\r\n\t\tthis._ride_action = \"stand1\";\r\n\t\t\r\n\t\tthis._action = \"stand1\";\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\tthis._emotion = \"blink\";\r\n\t\tthis._emotion_frame = 0;\r\n\t\tthis._emotion_time = 0;\r\n\t\tthis._emotion_frame_sequence = [0, 1, 2, 1];\r\n\r\n\t\t/** @type {CharacterSlots} */\r\n\t\tthis.slots = new CharacterSlots();\r\n\r\n\t\t/**\r\n\t\t * is require update render data\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.__require_update = true;\r\n\r\n\t\t/** @type {FragmentTexture[]} */\r\n\t\tthis.__frag_list = [];\r\n\r\n\t\t/** @type {CharacterChangeLog} **/\r\n\t\tthis.$$changeLog = new CharacterChangeLog();\r\n\t}\r\n\r\n\t_clone() {\r\n\t\talert(this.constructor.name + \"::_clone\");\r\n\r\n\t\t/** @type {CharacterAnimationBase} */\r\n\t\tlet nc = new this.constructor();//not must CharacterRender\r\n\t\tif (!nc) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tnc.speed = 0;\r\n\r\n\t\tnc.x = this.x;\r\n\t\tnc.y = this.y;\r\n\t\tnc.angle = this.angle;\r\n\r\n\t\tnc.action = this.action;\r\n\t\tnc.action_frame = this.action_frame;\r\n\r\n\t\tnc.emotion = this._emotion;\r\n\t\tnc.emotion_frame = this.emotion_frame;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tnc.slots[i] = this.slots[i];//not need colne ?\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn nc;\r\n\t}\r\n\t\t\r\n\t_waitFrameTexturesLoaded() {\r\n\t\tlet tasks = [];\r\n\t\tfor (let i in this.slots) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots[i];\r\n\t\t\tif (item) {\r\n\t\t\t\tfor (let j in item.fragments) {\r\n\t\t\t\t\tlet frag = item.fragments[j];\r\n\t\t\t\t\tlet count = frag.getFrameCount(this);\r\n\t\t\t\t\tfor (let k = 0; k < count; ++k) {\r\n\t\t\t\t\t\tlet ft = frag.getFrameTexture(this, k);\r\n\t\t\t\t\t\tif (ft && !ft._isLoaded_or_doload()) {\r\n\t\t\t\t\t\t\ttasks.push(ft.$promise);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\r\n\t/**\r\n\t * init animation status\r\n\t */\r\n\tinitAnimation() {\r\n\t\t/** @type {string} */\r\n\t\tthis.action = \"stand1\";\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._action_frame = 0;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.emotion = \"blink\";\r\n\t\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_time = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._emotion_frame = 0;\r\n\t}\r\n\r\n\t/** @type {number} - 0~1 */\r\n\tgetSpeed() {\r\n\t\tif (this.pause) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\treturn this.fixed_speed ? 1 : this.speed;\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget elfEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.elfEar;\r\n\t\t}\r\n\t}\r\n\tset elfEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.elfEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget lefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar;\r\n\t\t}\r\n\t}\r\n\tset lefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.lefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @type {boolean}\r\n\t */\r\n\tget highlefEar() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.highlefEar;\r\n\t\t}\r\n\t}\r\n\tset highlefEar(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tthis.slots.head.highlefEar = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @returns {\"human\"|\"elf\"|\"lef\"|\"highlef\"} */\r\n\tget ear() {\r\n\t\tif (this.slots.head) {\r\n\t\t\treturn this.slots.head.lefEar ? \"lef\" : (this.slots.head.elfEar ? \"elf\" : (this.slots.head.highlefEar ? \"highlef\" : \"human\"));\r\n\t\t}\r\n\t}\r\n\tset ear(value) {\r\n\t\tif (this.slots.head) {\r\n\t\t\tif (value == \"elf\") {\r\n\t\t\t\tthis.slots.head.elfEar = true;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == \"lef\") {\r\n\t\t\t\tthis.slots.head.lefEar = true;\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse if (value == \"highlef\") {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = true;\r\n\t\t\t\tthis.$$changeLog.ear = value;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.slots.head.elfEar = false;\r\n\t\t\t\tthis.slots.head.lefEar = false;\r\n\t\t\t\tthis.slots.head.highlefEar = false;\r\n\t\t\t\tthis.$$changeLog.ear = \"human\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$$changeLog.ear = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget action() {\r\n\t\t//if (this.slots.tamingMob) {\r\n\t\t//\tconst actmap = this.slots.tamingMob.actionMap;\r\n\t\t//\tif (actmap) {\r\n\t\t//\t\treturn actmap[this._action];\r\n\t\t//\t}\r\n\t\t//\treturn \"sit\";//default\r\n\t\t//}\r\n\t\treturn this._action;\r\n\t}\r\n\tset action(act) {\r\n\t\tif (this.slots.tamingMob) {\r\n\t\t\tlet _act;\r\n\r\n\t\t\tthis._ride_action = act;\r\n\r\n\t\t\tif (this.slots.tamingMob.actionMap) {\r\n\t\t\t\t_act = this.slots.tamingMob.actionMap[act];\r\n\r\n\t\t\t\tif (_act == \"hideBody\") {\r\n\t\t\t\t\tthis.hideBody = true;\r\n\r\n\t\t\t\t\t//TODO: hideBody act=?\r\n\r\n\t\t\t\t\tthis._action = act;\r\n\t\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.hideBody = false;\r\n\r\n\t\t\t\t\tthis._action = _act;\r\n\t\t\t\t\tif (this.actani._action != _act) {\r\n\t\t\t\t\t\tthis.actani.reload(_act);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (act == \"rope\") {\r\n\t\t\t\t\tthis._action = \"rope\";//default\r\n\t\t\t\t}\r\n\t\t\t\telse if (act == \"ladder\") {\r\n\t\t\t\t\tthis._action = \"ladder\";//default\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._action = \"sit\";//default\r\n\t\t\t\t}\r\n\t\t\t\tif (this.actani._action != act) {\r\n\t\t\t\t\tthis.actani.reload(act);\r\n\t\t\t\t}\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.hideBody = false;\r\n\t\t\tthis._ride_action = null;\r\n\r\n\t\t\tif (this.actani._action != act && this.slots.body) {\r\n\t\t\t\tthis._action = act;\r\n\t\t\t\tthis.actani.reload(act);\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame() {\r\n\t\treturn this._action_frame;\r\n\t}\r\n\tset action_frame(value) {\r\n\t\tif (value === \"\") {//from $(\"input\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (true) {\r\n\t\t\tif (!(typeof value == 'number')) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthis._action_frame = Number(value) | 0;\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._action_frame = value;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget action_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.body) {\r\n\t\t\t\treturn this.slots.body.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/** @type {string} */\r\n\tget emotion() {\r\n\t\treturn this._emotion;\r\n\t}\r\n\tset emotion(emo) {\r\n\t\tif (this._emotion != emo && this.slots.face && this.slots.face.fragments.face.textures[emo]) {\r\n\t\t\tthis._emotion = emo;\r\n\t\t\tthis._emotion_frame = 0;\r\n\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\tthis._emotion_frame_sequence = [...circularSequence(this.emotion_frame_count)];\r\n\r\n\t\t\tthis.__require_update |= true;\r\n\t\t}\r\n\t}\r\n\r\n\t*emotion_frame_sequence_generator(length) {\r\n\t\tfor (; ;) {\r\n\t\t\t//TODO: random blink\r\n\t\t\tyield* circularSequence(length);\r\n\r\n\t\t\tfor (; Math.random() < 0.5;) {\r\n\t\t\t\tyield 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\t\r\n\t/** @type {number} */\r\n\tget emotion_frame() {\r\n\t\tlet f = this._emotion_frame_sequence[this._emotion_frame % this._emotion_frame_sequence.length];\r\n\t\treturn f;\r\n\t}\r\n\tset emotion_frame(value) {\r\n\t\tif (value === \"\") {//from $(\"input\")\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (true) {\r\n\t\t\tif (!(typeof value == 'number')) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthis._emotion_frame = Number(value) | 0;\r\n\t\t\t\tthis._emotion_time = 0;\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._emotion_frame = value;\r\n\t\tthis._emotion_time = 0;\r\n\t\tthis.__require_update |= true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} next\r\n\t */\r\n\t_get_emotion_next_frame(next) {\r\n\t\tlet f = this._emotion_frame + next;\r\n\t\tf = f < 0 ? (this._emotion_frame_sequence.length - 1) : (f % this._emotion_frame_sequence.length);\r\n\t\treturn this._emotion_frame_sequence[f];\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_time() {\r\n\t\treturn this._emotion_time;\r\n\t}\r\n\tset emotion_time(time) {\r\n\t\tif (this.emotion_frame_count) {\r\n\t\t\tif (time < this.emotion_delay) {\r\n\t\t\t\tthis._emotion_time = time;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._emotion_time = 0;\r\n\r\n\t\t\t\t++this._emotion_frame;\r\n\r\n\t\t\t\tthis.__require_update |= true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tget emotion_delay() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn this.slots.face.getDelay(this);\r\n\t\t}\r\n\t\treturn 60;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget emotion_frame_count() {\r\n\t\ttry {\r\n\t\t\tif (this.slots.face) {\r\n\t\t\t\treturn this.slots.face.getFrameCount(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp - 0 <= stamp < Infinity\r\n\t */\r\n\t_update(_stamp) {\r\n\t\tif (this.pause) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet stamp = _stamp * this.getSpeed();\r\n\t\t\r\n\t\tif (this.actani) {\r\n\t\t\tif (this.actani.isEnd() && this.actani.loop) {\r\n\t\t\t\tthis.actani.reset();\r\n\t\t\t}\r\n\r\n\t\t\tthis.actani.update(stamp, this);\r\n\t\t}\r\n\r\n\t\tthis.emotion_time += _stamp;\r\n\r\n\t\tfor (let i in this.slots) {\r\n\t\t\tlet equip = this.slots[i];\r\n\t\t\tif (equip && equip.effect && equip.effect.enable) {\r\n\t\t\t\tequip.effect.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis._update(stamp);\r\n\t}\r\n\r\n\t__forceUpdate(stamp) {\r\n\t\tthis._$dirty = Math.random();\r\n\t\tthis._update(stamp | 0);\r\n\t\tthis.__update_frag_list();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} x\r\n\t * @param {number} y, \r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\t_draw(renderer, x, y, angle, flip) {\r\n\t\trenderer.pushGlobalAlpha();\r\n\r\n\t\tif (this.__require_update) {\r\n\t\t\tthis.__update_frag_list();\r\n\t\t\tthis.__require_update = false;\r\n\t\t}\r\n\r\n\t\t//list.filter(a=>a&&a._raw.map).forEach(a=>{ for (let i in a._raw.map) { if (q[i]) { q[i].push(a); } else { q[i] = [a]; } } })\r\n\t\tthis.__draw_list(renderer, this.__frag_list, x, y, angle, flip);\r\n\r\n\t\trenderer.popGlobalAlpha();\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {FragmentTexture[]} list\r\n\t */\r\n\t__draw_list(renderer, list, x, y, angle, flip) {\r\n\t\trenderer.pushMatrix();\r\n\r\n\t\trenderer.translate(x, y);\r\n\t\t\r\n\t\tif (0) {}\r\n\r\n\t\trenderer.rotate(window.m_a || angle);\r\n\r\n\t\tif (flip) {\r\n\t\t\trenderer.scale(-1, 1);\r\n\t\t}\r\n\t\t//{\r\n\t\t//\tlet ctx = renderer.ctx;\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(100, 0);\r\n\t\t//\tctx.strokeStyle = \"#F00\";\r\n\t\t//\tctx.stroke();\r\n\t\t//\tctx.beginPath();\r\n\t\t//\tctx.moveTo(0, 0);\r\n\t\t//\tctx.lineTo(0, 100);\r\n\t\t//\tctx.strokeStyle = \"#0F0\";\r\n\t\t//\tctx.stroke();\r\n\t\t//}\r\n\r\n\t\t{\r\n\t\t\tfor (let i in this.slots) {\r\n\t\t\t\tlet equip = this.slots[i];\r\n\t\t\t\tif (equip && equip.effect) {\r\n\t\t\t\t\tequip.effect.render(renderer, this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (let i in list) {\r\n\t\t\t\tlet ft = list[i];\r\n\t\t\t\tft.render(renderer, this);\r\n\t\t\t}\r\n\t\t}\r\n\t\trenderer.popMatrix();\r\n\t}\r\n\t__update_frag_list() {\r\n\t\tthis.__frag_list = [];\r\n\t\t\r\n\t\t/** @type {Array<CharacterAppearanceBase>[]} */\r\n\t\tlet slots = {};\r\n\t\t\r\n\t\tfor (let i = 2; i <= 3; ++i) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots[\"_hair\" + i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\tfor (let i in this.slots._ordered_slot) {\r\n\t\t\t/** @type {CharacterAppearanceBase} */\r\n\t\t\tlet item = this.slots._ordered_slot[i];\r\n\t\t\t\r\n\t\t\tthis.__add_equip_to_frag_list(slots, item);\r\n\t\t}\r\n\t\t\r\n\t\t{//back\r\n\t\t\tlet is_back = false;\r\n\t\t\t\r\n\t\t\tfor (let i in slots) {\r\n\t\t\t\t/** @type {FragmentTexture[]} */\r\n\t\t\t\tlet fts = slots[i];\r\n\t\t\t\tfor (let j in fts) {\r\n\t\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\t\tlet ft = fts[j];\r\n\t\t\t\t\tif (is_back) {\r\n\t\t\t\t\t\tif (ft._place.startsWith(\"face\")) {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (ft._place.startsWith(\"backHair\")) {\r\n\t\t\t\t\t\tis_back = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t{\r\n\t\t\tlet ae = this.__frag_list[114];//HACK: Ae\r\n\t\t\tif (ae) {\r\n\t\t\t\tthis.__frag_list.push(ae);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._calcBoundBox();\r\n\t}\r\n\t/**\r\n\t * @param {Array<CharacterAppearanceBase>[]} slots\r\n\t * @param {CharacterAppearanceBase} item\r\n\t */\r\n\t__add_equip_to_frag_list(slots, item) {\r\n\t\t// if equip not use then value is mumber(slot_order) where this.slots._ordered_slot\r\n\t\tif (item == null) {\r\n\t\t\treturn;//debugger;\r\n\t\t}\r\n\t\telse if (item > 0) {// typeof item == 'number'; item != null && (item instanceof CharacterAppearanceBase || item >= 0)\r\n\t\t\treturn;//continue;\r\n\t\t}\r\n\r\n\t\t// init slots\r\n\t\tfor (let j in item.vslot) {\r\n\t\t\tlet slot = item.vslot[j];\r\n\t\t\tslots[slot] = [];\r\n\t\t}\r\n\r\n\t\tfor (let j in item.fragments) {//foreach equip place\r\n\t\t\tlet slot = sMap[j];\r\n\t\t\tif (slot != null) {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (j == \"default\") {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tslot = item._raw.info.islot;\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tif (!slots[slot]) {\r\n\t\t\t\t\t\tslots[slot] = [ft];//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tslots[slot].push(ft);//cover ??\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t/** @type {FragmentTexture} */\r\n\t\t\t\tlet ft = item.fragments[j].getTexture(this);\r\n\t\t\t\tif (ft) {\r\n\t\t\t\t\tthis.__add_frag_to_list(ft);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//item.fragments[j].visible = true;\r\n\t\t}\r\n\t}\r\n\t/** @param {FragmentTexture} ft */\r\n\t__add_frag_to_list(ft) {\r\n\t\tft.update(this);\r\n\t\tthis.__frag_list[ft.z] = ft;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * calc current frame bound box and restore result\r\n\t * @returns {Rectangle}\r\n\t */\r\n\t_calcBoundBox() {\r\n\t\tlet left = 0, top = 0, right = 0, bottom = 0;\r\n\r\n\t\tfor (let i in this.__frag_list) {\r\n\t\t\tlet ft = this.__frag_list[i];\r\n\t\t\tif (ft.texture && ft.relative) {\r\n\t\t\t\tlet x0 = ft.relative.x;\r\n\t\t\t\tlet y0 = ft.relative.y;\r\n\t\t\t\tlet x1 = x0 + ft.width;\r\n\t\t\t\tlet y1 = y0 + ft.height;\r\n\r\n\t\t\t\tleft = Math.min(left, x0);\r\n\t\t\t\ttop = Math.min(top, y0);\r\n\t\t\t\tright = Math.max(right, x1);\r\n\t\t\t\tbottom = Math.max(bottom, y1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._boundBox = new _math_js__WEBPACK_IMPORTED_MODULE_6__[\"Rectangle\"](\r\n\t\t\tMath.trunc(left),\r\n\t\t\tMath.trunc(top),\r\n\t\t\tMath.trunc(right - left),\r\n\t\t\tMath.trunc(bottom - top)\r\n\t\t);\r\n\t\treturn this._boundBox;\r\n\t}\r\n\t\r\n\ttoJSON() {\r\n\t\tlet obj = {\r\n\t\t\thair2: this.slots._hair2.id,\r\n\t\t\thairMix2: this.slots.hairMix2,\r\n\t\t\tslots: this.slots.toJSON(),\r\n\t\t};\r\n\r\n\t\tif (this.slots.head.elfEar) {\r\n\t\t\tobj.ear = \"elf\";\r\n\t\t}\r\n\t\telse if (this.slots.head.lefEar) {\r\n\t\t\tobj.ear = \"lef\";\r\n\t\t}\r\n\t\telse if (this.slots.head.highlefEar) {\r\n\t\t\tobj.ear = \"highlef\";\r\n\t\t}\r\n\r\n\t\treturn obj;\r\n\t}\r\n}\r\n\r\nclass CharacterRenderer extends CharacterAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {number} - position x */\r\n\t\tthis.x = 0;\r\n\t\t/** @type {number} - position y */\r\n\t\tthis.y = 0;\r\n\r\n\t\t/** @type {number} - where layer */\r\n\t\tthis.z = 5;\r\n\r\n\t\t/** @type {number} - translate x once frame */\r\n\t\tthis.tx = 0;\r\n\t\t/** @type {number} - translate y once frame */\r\n\t\tthis.ty = 0;\r\n\t\t\r\n\t\tthis.angle = 0;\r\n\t\tthis.front = -1;\r\n\r\n\t\t/** @type {Promise<void>[]} */\r\n\t\tthis.__load_task = [];\r\n\r\n\t\t/** @type {function(IRenderer)} */\r\n\t\tthis.render = function (renderer) {\r\n\t\t\t//not ready to render\r\n\t\t\t//if load then set load render = _render\r\n\t\t}\r\n\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis._boundBox = null;\r\n\t}\r\n\r\n\tstatic async Init() {\r\n\t\tlet result = await Promise.all([\r\n\t\t\t$get.data(\"/zmap\"),\r\n\t\t\t$get.data(\"/smap\"),\r\n\t\t\tItemEffect.Init(),\r\n\t\t\t_CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_7__[\"ActionAnimation\"].Init(),//action definition\r\n\t\t]);\r\n\t\t\r\n\t\tzMap = {};\r\n\t\tObject.keys(result[0]).reverse().forEach((k, i) => zMap[k] = i + 1);\r\n\r\n\t\tsMap = result[1];\r\n\t}\r\n\r\n\tload() {\r\n\t\t//load body and head for calc relative position\r\n\t\tthis.use(\"00002012\");\r\n\t\tthis.use(\"00012012\");\r\n\r\n\t\tlet $promise = Promise.all([...this.__load_task]);\r\n\t\t(function (that, $promise) {\r\n\t\t\t$promise.then(function (result) {\r\n\t\t\t\tthat.initAnimation();\r\n\t\t\t\tthat.render = that._render;\r\n\t\t\t});\r\n\t\t})(this, $promise);\r\n\r\n\t\treturn $promise;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {any} number  0 < stamp * speed < Infinity\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.waitLoaded();\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_render(renderer) {\r\n\t\tconst x = Math.trunc(this.x + this.tx);\r\n\t\tconst y = Math.trunc(this.y + this.ty);\r\n\t\t\r\n\t\tthis._draw(renderer, x, y, this.angle, this.front > 0);\r\n\t\t\r\n\t\t//this.tx = 0;//auto clear\r\n\t\t//this.ty = 0;//auto clear\r\n\t}\r\n\t\r\n\t_setup_test() {\r\n\t\tthis.use(\"00026509\");\r\n\r\n\t\tthis.use(\"00044041\");\r\n\r\n\t\t//this.use(\"01022274\");\r\n\r\n\t\tthis.use(\"01053169\");\r\n\r\n\t\tthis.use(\"01071077\");\r\n\r\n\t\t//this.use(\"01102960\");\r\n\t}\r\n\r\n\t\r\n\tasync __synchronize(stamp) {\r\n\t\tthis.__forceUpdate(stamp);\r\n\t\r\n\t\tawait this.waitLoaded();\r\n\t\tawait this._waitFrameTexturesLoaded();\r\n\t}\r\n\tasync waitLoaded() {\r\n\t\tlet tasks = this.__load_task;\r\n\t\tif (tasks && tasks.length) {\r\n\t\t\tawait Promise.all(tasks).then(() => {\r\n\t\t\t\tthis.__load_task = [];\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t//isLoading() {\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t * @param {string} category - category of cash-weapon\r\n\t */\r\n\tasync use(id, category) {\r\n\t\tif (!category) {\r\n\t\t\tcategory = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].getJobWeaponCategory(this.job);\r\n\t\t}\r\n\t\tconst item_type = id[0];\r\n\t\tswitch (item_type) {\r\n\t\t\tcase \"0\"://equip\r\n\t\t\t\t{\r\n\t\t\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].isCashWeapon(id)) {\r\n\t\t\t\t\t\t//this.$$changeLog.weaponType = ss[1];/??\r\n\t\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//\r\n\t\t\t\t\tlet task = this.slots._use(id, null, category);\r\n\t\t\t\t\tthis.__load_task.push(task);\r\n\t\t\t\t\tawait task;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (id.startsWith(\"019\")) {\r\n\t\t\t\t\t\tthis.action = this.action;//force update action\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis.__update_frag_list();\r\n\t\t\t\t\tthis._calcBoundBox();\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tunuse(id) {\r\n\t\tdebugger;\r\n\t\tif (id[0] == \"0\") {//equip\r\n\t\t\tlet result = this.slots._unuse(id);\r\n\t\t\tif (result) {\r\n\t\t\t\tthis.$$changeLog.unuseEquip.push(id);\r\n\t\t\t\tthis._calcBoundBox();\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\t_parse(code) {\r\n\t\tif (!code) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet es = code.split(\",\");\r\n\t\tthis.slots._clear();\r\n\t\tes.forEach((v, i, a) => {\r\n\t\t\tif (v.indexOf(\"|\") >= 0) {\r\n\t\t\t\tconst ss = v.split(\"|\");\r\n\t\t\t\tconst cate = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].get(ss[0]);\r\n\t\t\t\tlet id;\r\n\t\t\t\tif (cate.slot == \"face\") {\r\n\t\t\t\t\tid = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id);\r\n\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == \"hair\") {\r\n\t\t\t\t\tconst slots = this.slots;\r\n\t\t\t\t\tlet h2 = ss[1];\r\n\t\t\t\t\tlet h3 = ss[2];\r\n\t\t\t\t\t//\r\n\t\t\t\t\tid = ss[0];\r\n\t\t\t\t\tthis.$$changeLog.useEquip.push(id);\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.use(id).then(() => {\r\n\t\t\t\t\t\tif (h2 && h2.indexOf(\"%\") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h2.split(\"%\");\r\n\t\t\t\t\t\t\tconst c2 = hc[0];\r\n\t\t\t\t\t\t\tconst m2 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair2 = c2;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix2 = m2;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor2 = c2;\r\n\t\t\t\t\t\t\tslots.hairMix2 = m2;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (h3 && h3.indexOf(\"%\") >= 0) {\r\n\t\t\t\t\t\t\tlet hc = h3.split(\"%\");\r\n\t\t\t\t\t\t\tconst c3 = hc[0];\r\n\t\t\t\t\t\t\tconst m3 = hc[1] / 100;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tthis.$$changeLog.hair3 = c3;\r\n\t\t\t\t\t\t\tthis.$$changeLog.hairMix3 = m3;\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\tslots.hairColor3 = hc[0];\r\n\t\t\t\t\t\t\tslots.hairMix4 = hc[1] / 100;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse if (cate.slot == \"weapon\") {\r\n\t\t\t\t\tthis.$$changeLog.weaponType = ss[1];\r\n\t\t\t\t\tthis.$$changeLog.weapon = id;\r\n\t\t\t\t\tthis.use.apply(this, ss, ss[1]);//this.use(ss[0], ss[1]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (Number.isFinite(parseInt(v, 10))) {\r\n\t\t\t\tthis.use(v);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @type {string} col\r\n\t */\r\n\tget hairColor() {\r\n\t\tif (this.slots.hair) {\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getHairColor(this.slots.hair.id);\r\n\t\t}\r\n\t\treturn \"0\";\r\n\t}\r\n\tset hairColor(col) {\r\n\t\tif (this.slots.hair && col != this.hairColor) {\r\n\t\t\tlet id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getColorHairID(this.slots.hair.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} col\r\n\t */\r\n\tget faceColor() {\r\n\t\tif (this.slots.face) {\r\n\t\t\treturn _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getFaceColor(this.slots.face.id);\r\n\t\t}\r\n\t\treturn \"0\";\r\n\t}\r\n\tset faceColor(col) {\r\n\t\tif (this.slots.face && col != this.faceColor) {\r\n\t\t\tlet id = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"CharacterRenderConfig\"].getColorFaceID(this.slots.face.id, col);\r\n\t\t\tthis.use(id);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterChangeLog} changeLog\r\n\t */\r\n\tcommitChange(changeLog) {\r\n\t\tif (changeLog.ear) {\r\n\t\t\tthis.ear = changeLog.ear;\r\n\t\t}\r\n\r\n\t\tif (this.useEquip) {\r\n\t\t\tfor (let id of this.useEquip) {\r\n\t\t\t\tthis.use(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.unuseEquip) {\r\n\t\t\tfor (let id of this.unuseEquip) {\r\n\t\t\t\tthis.unuse(id);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair2 && changeLog.hairMix2) {\r\n\t\t\tthis.slots.hairColor2 = changeLog.hair2;\r\n\t\t\tthis.slots.hairMix2 = changeLog.hairMix2;\r\n\t\t}\r\n\r\n\t\tif (changeLog.hair3 && changeLog.hairMix3) {\r\n\t\t\t//this.slots.hairColor3 = changeLog.hair3;\r\n\t\t\t//this.slots.hairMix3 = changeLog.hairMix3;\r\n\t\t}\r\n\t\t\r\n\t\tif (changeLog.weapon && changeLog.weaponType) {\r\n\t\t\tthis.use(changeLog.weapon, changeLog.weaponType);\r\n\t\t}\r\n\t}\r\n\r\n\t_stringify(genCode) {\r\n\t\tlet result = this.slots._stringify();\r\n\t\tif (genCode) {\r\n\t\t\treturn `chara._parse('${result}')`;\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t_outlink_old() {\r\n\t\tif (this.slots.body && this.slots.body.id && this.slots.face && this.slots.face.id && this.action && this.emotion) {\r\n\t\t\tlet link = \"https://labs.maplestory.io/api/GMS/latest/character/center/\" + this.slots.body.id + \"/\";\r\n\t\t\tlet slots = [...this.slots.enumerate()].map(a => parseInt(a.id, 10));\r\n\r\n\t\t\tslots[0] = this.slots.face.id + \":\" + this.emotion;\r\n\r\n\t\t\tlink += slots.join(\",\");\r\n\r\n\t\t\tlink += \"/\" + this.action + \"?showears=\" + (this.elfEar ? \"true\" : \"false\");\r\n\r\n\t\t\tlink += \"&showLefEars=\" + (this.lefEar ? \"true\" : \"false\");\r\n\r\n\t\t\treturn link;\r\n\t\t}\r\n\t\tconsole.log(\"character need body, face, action, emotion\");\r\n\t}\r\n\t\r\n\t_outlink(name) {\r\n\t\tconst animationName = this.action;\r\n\t\tconst frame = this.action_frame;\r\n\t\tconst slots = this.slots;\r\n\t\tconst itemList = JSON.stringify(makeItemList.call());\r\n\t\treturn encodeURI(\r\n\t\t\t\t\"https://maplestory.io/api/character/\" +\r\n\t\t\t\titemList.slice(1, itemList.length - 1) +    // not array\r\n\t\t\t\t\"/\" + animationName + \"/\" + frame + \"?\" +\r\n\t\t\t\t\"showears=\" + this.elfEar +\r\n\t\t\t\t\"&showLefEars=\" + this.lefEar +\r\n\t\t\t\t\"&resize=1\" +\r\n\t\t\t\t(name ? (\"&name=\" + name) : \"\") +\r\n\t\t\t\t\"&flipX=\" + Boolean(this.front > 0) +\r\n\t\t\t\t\"&bgColor=0,0,0,0\"\r\n\t\t\t\t);\r\n\t\tfunction makeItemList() {\r\n\t\t\treturn Object.values(slots).filter(a => a).map(transformItemData);\r\n\t\t}\r\n\t\tfunction transformItemData(item) {\r\n\t\t\tlet region, version;\r\n\t\t\tif (item._raw.info.__v) {\r\n\t\t\t\tconst m = item._raw.info.__v.toUpperCase().match(/([A-Z]*)([0-9]*)/);\r\n\t\t\t\tregion = m[1] == \"TWMS\" ? \"TMS\" : m[1];\r\n\t\t\t\tversion = \"latest\";//m[2];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tregion =\"TMS\";\r\n\t\t\t\tversion = \"latest\";\r\n\t\t\t}\r\n\t\t\tconst filter = item.filter;\r\n\t\t\treturn {\r\n\t\t\t\titemId:        Number(item.id),\r\n\t\t\t\tregion:        region,\r\n\t\t\t\tversion:       version,\r\n\t\t\t\thue:           filter.hue,\r\n\t\t\t\tsaturation:    strNum(filter.sat),\r\n\t\t\t\tbrightness:    strNum(filter.bri),\r\n\t\t\t\tcontrast:      strNum(filter.contrast),\r\n\t\t\t\talpha:         Number(item.opacity.toFixed(1)),\r\n\t\t\t\tanimationName: animationName,\r\n\t\t\t};\r\n\t\t}\r\n\t\tfunction strNum(val) {\r\n\t\t\treturn (val / 100).toFixed(1);\r\n\t\t}\r\n\t}\r\n\t\r\n\t_download() {\r\n\t\twindow.open(this._outlink());\r\n\t}\r\n\r\n\t_save_as_svg() {\r\n\t\tthis.__texture_to_base64().then(frag_list => {\r\n\t\t\tlet file_name = this.id + \".svg\";\r\n\t\t\t//let frag_list = this.__frag_list;\r\n\t\r\n\t\t\tlet svg = '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\" >';\r\n\r\n\t\t\tsvg += '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink= \"http://www.w3.org/1999/xlink\">\\n';// width=\"64\" height=\"96\"\r\n\r\n\t\t\tsvg += '<g transform=\"translate(32, 96)\">';\r\n\t\t\tfrag_list.forEach(function (ft) {\r\n\t\t\t\tif (ft && ft.relative) {\r\n\t\t\t\t\tlet clz = ft.classList;\r\n\t\t\t\t\tsvg += `\\t<image class=\"${clz}\" opacity=\"${ft.visible ? ft.opacity : 0}\" x=\"${ft.relative.x}\" y=\"${ft.relative.y}\" width=\"${ft.width}\" height=\"${ft.height}\" xlink:href=\"${ft._url}\"></image>\\n`;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tsvg += '</g>';\r\n\r\n\t\t\tsvg += '<text x=\"0\" y=\"122\" fill=\"transparent\">' + this._stringify(false) + '</text>';\r\n\r\n\t\t\tsvg += '</svg>';\r\n\r\n\t\t\t//let url = \"data:text/plain;utf8,\" + svg;\r\n\r\n\t\t\tdebugger;\r\n\r\n\t\t\t//window.open(url);\r\n\t\t\tDownloadData(svg, \"image/svg+xml;utf8\", file_name);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * \"data:image/png;base64,[...]\"\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} filename\r\n\t * @returns {string}\r\n\t */\r\n\t_save_as_png(renderer, filename) {\r\n\t\tlet bound = this._calcBoundBox();\r\n\t\tlet size = bound.size;\r\n\t\tlet x = -bound.left;\r\n\t\tlet y = bound.height;\r\n\t\tlet angle = 0;\r\n\t\tlet front = false;\r\n\r\n\t\t// use Canvas2, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//save Canvas2 size, current ctx is _ctx2\r\n\t\tconst c2w = renderer._ctx2.canvas.width;\r\n\t\tconst c2h = renderer._ctx2.canvas.height;\r\n\t\t//\r\n\t\trenderer.ctx.canvas.width = size.x;\r\n\t\trenderer.ctx.canvas.height = size.y;\r\n\r\n\t\ttry {\r\n\t\t\tthis._draw(renderer, x, y, angle, front);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\tlet base64 = renderer.ctx.canvas.toDataURL(\"image/png\");\r\n\t\t{\r\n\t\t\tlet elem = document.createElement(\"a\");\r\n\r\n\t\t\tlet name = `${filename ? (filename+\".\"):\"\"}${this.action}[${this.action_frame}].${this.emotion}[${this.emotion_frame}].png`;\r\n\r\n\t\t\telem.id = name;\r\n\t\t\telem.download = name;\r\n\t\t\telem.href = base64;\r\n\r\n\t\t\tdocument.body.appendChild(elem);\r\n\t\t\telem.click();\r\n\t\t\tdocument.body.removeChild(elem);\r\n\t\t}\r\n\r\n\t\t//restore Canvas2 size, current ctx is _ctx2\r\n\t\trenderer.ctx.canvas.width = c2w;\r\n\t\trenderer.ctx.canvas.height = c2h;\r\n\r\n\t\t// restore Canvas, must not fail\r\n\t\ttry {\r\n\t\t\trenderer.$swapCanvas();\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t\t// nothing\r\n\t\t}\r\n\r\n\t\treturn base64;\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {Promise<FragmentTexture[]>}\r\n\t */\r\n\tasync __texture_to_base64() {\r\n\t\tlet frag_list = this.__frag_list;\r\n\t\tlet tasks = [];\r\n\r\n\t\tfrag_list.forEach(function (ft) {\r\n\t\t\tif (!ft) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!ft._url.startsWith(\"data:\")) {\r\n\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\tft._url = await toDataURL(ft._url);\r\n\t\t\t\t\treturn ft;\r\n\t\t\t\t})());\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttasks.push(ft);\r\n\t\t\t}\r\n\t\t\tif (ft.graph2) {\r\n\t\t\t\tlet src = ft.graph2._url;\r\n\t\t\t\tif (!src.startsWith(\"data:\")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph2._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph2;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph2);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ft.graph3) {\r\n\t\t\t\tlet src = ft.graph3._url;\r\n\t\t\t\tif (!src.startsWith(\"data:\")) {\r\n\t\t\t\t\ttasks.push((async function () {\r\n\t\t\t\t\t\tft.texture.$src = ft._url;\r\n\t\t\t\t\t\tft.graph3._url = await toDataURL(src);\r\n\t\t\t\t\t\treturn ft.graph3;\r\n\t\t\t\t\t})());\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttasks.push(ft.graph3);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n}\r\nObject(_init_js__WEBPACK_IMPORTED_MODULE_1__[\"AddInitTask\"])(CharacterRenderer.Init());\r\n\r\nfunction* circularSequence(length) {\r\n\tlet i = 0;\r\n\tfor (; i < length; ++i) {//a: 0, 1, 2, 3, ...b\r\n\t\tyield i;\r\n\t}\r\n\tfor (i -= 2; i > 0; --i) {//b: 2, 1, ...a\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction* linearSequence(length) {\r\n\tfor (let i = 0; i < length; ++i) {\r\n\t\tyield i;\r\n\t}\r\n}\r\n\r\nfunction extract_number(input) {\r\n\treturn String(input).match(/(-?\\d+\\.?\\d*)|(\\.\\d*)/g);\r\n}\r\n\r\n/**\r\n * image href to data url\r\n */\r\nfunction toDataURL(url) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.onload = function () {\r\n\t\t\tlet reader = new FileReader();\r\n\t\t\treader.onloadend = function () {\r\n\t\t\t\tresolve(reader.result);\r\n\t\t\t}\r\n\t\t\treader.onerror = function (ev) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\treject(ev);\r\n\t\t\t}\r\n\t\t\treader.readAsDataURL(xhr.response);\r\n\t\t};\r\n\t\txhr.open('GET', url);\r\n\t\txhr.responseType = 'blob';\r\n\t\txhr.send();\r\n\t});\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9DaGFyYWN0ZXJSZW5kZXJlci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL0NoYXJhY3RlclJlbmRlcmVyLmpzPzI3MjkiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IENoYXJhY3RlclJlbmRlckNvbmZpZywgSXRlbUNhdGVnb3J5SW5mbywgUmVzb3VyY2VNYW5hZ2VyIH0gZnJvbSAnLi4vLi4vLi4vcHVibGljL2phdmFzY3JpcHRzL3Jlc291cmNlLmpzJztcclxuaW1wb3J0IHsgQWRkSW5pdFRhc2sgfSBmcm9tIFwiLi4vLi4vaW5pdC5qc1wiO1xyXG5pbXBvcnQgeyBBbmltYXRpb24gfSBmcm9tIFwiLi4vQW5pbWF0aW9uXCI7XHJcbmltcG9ydCB7IGVuZ2luZSB9IGZyb20gJy4uL0VuZ2luZS5qcyc7XHJcbmltcG9ydCB7IElSZW5kZXJlciwgSW1hZ2VGaWx0ZXIgfSBmcm9tICcuLi9JUmVuZGVyZXIuanMnO1xyXG5pbXBvcnQgeyBTcHJpdGUsIFNwcml0ZUJhc2UgfSBmcm9tICcuLi9TcHJpdGUuanMnO1xyXG5pbXBvcnQgeyBSZWN0YW5nbGUsIFZlYzIgfSBmcm9tICcuLi9tYXRoLmpzJztcclxuaW1wb3J0IHsgQWN0aW9uQW5pbWF0aW9uIH0gZnJvbSAnLi9DaGFyYWN0ZXJBY3Rpb25BbmltYXRpb24uanMnO1xyXG5cclxuXHJcbmxldCB6TWFwID0ge307XHJcbmxldCBzTWFwID0ge307XHJcblxyXG5cclxuLyoqXHJcbiAqIDAwMDI2NjIzLmJsaW5rWzFdLmJyb3cgaGFzIGJ1Z1xyXG4gKiAnV2VhcG9uLzAxNzAyNjk0JyBpcyBMb25nY29hdChpc2xvdClcclxuICogaG93IHRvIHVzZSBjYXNoLXdlYXBvbiAoZXg6IDAxNzAyNTA0fDAxNTIpXHJcbiAqL1xyXG5cclxuLyoqXHJcbiAqIG11bHRpLWltYWdlLXNwcml0ZVxyXG4gKi9cclxuY2xhc3MgRnJhZ21lbnRUZXh0dXJlIGV4dGVuZHMgU3ByaXRlQmFzZSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHt3enByb3BlcnR5fSByYXdcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZnVsbF9wYXRoXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IocmF3LCBmdWxsX3BhdGgpIHtcclxuXHRcdHN1cGVyKHJhdywgZnVsbF9wYXRoKTtcclxuXHJcblx0XHRpZiAodGhpcy5fcmF3Lm9yaWdpbikge1xyXG5cdFx0XHR0aGlzLl9yYXcub3JpZ2luLl9fcHJvdG9fXyA9IFZlYzIucHJvdG90eXBlO1xyXG5cdFx0fVxyXG5cclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5fcmF3Lm1hcCkge1xyXG5cdFx0XHR0aGlzLl9yYXcubWFwW2ldLl9fcHJvdG9fXyA9IFZlYzIucHJvdG90eXBlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogaWYgdGhpcy5yZWxhdGl2ZSA9PSBudWxsIHRoZW4gcmVtb3ZlIHRoaXNcclxuXHRcdCAqIEB0eXBlIHtWZWMyfVxyXG5cdFx0ICovXHJcblx0XHR0aGlzLnJlbGF0aXZlID0gbmV3IFZlYzIoMCwgMCk7XHJcblx0XHRcclxuXHRcdHRoaXMuY2FsY1JlbGF0aXZlID0gdGhpcy5fY2FsY1JlbGF0aXZlOy8vdGhpcy5fZ2V0UmVsYXRpdmVGdW5jdGlvbigpOy8vdGhpcy5fX29sZF9jYWxjUmVsYXRpdmU7Ly9cclxuXHJcblx0XHR0aGlzLmZpbHRlciA9IG5ldyBJbWFnZUZpbHRlcigpO1xyXG5cdFx0dGhpcy5vcGFjaXR5ID0gMTtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLnZpc2libGUgPSB0cnVlO1xyXG5cclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBleHRyYSBwcm9wZXJ0eS4gKi9cclxuXHRcdHRoaXMuX3Nsb3QgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIGV4dHJhIHByb3BlcnR5LiDlnKjlk6rlgIvpg6jkvY0gKi9cclxuXHRcdHRoaXMuX3BsYWNlID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBleHRyYSBwcm9wZXJ0eTogX3Nsb3QgaXRlbUlkLCBfcGxhY2UsIF9yYXcueiB6ICovXHJcblx0XHR0aGlzLmNsYXNzTGlzdCA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldCB6KCkge1xyXG5cdFx0cmV0dXJuIHpNYXBbdGhpcy5fcmF3LnpdIHx8IDE7XHJcblx0fVxyXG5cdHNldCB6KG5vdF92YWx1ZSkge1xyXG5cdFx0Y29uc29sZS5lcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldCBvcmRlcigpIHtcclxuXHRcdGRlYnVnZ2VyO1xyXG5cdFx0cmV0dXJuIHRoaXMuejtcclxuXHR9XHJcblx0c2V0IG9yZGVyKG5vdF92YWx1ZSkge1xyXG5cdFx0ZGVidWdnZXI7XHJcblx0XHRjb25zb2xlLmVycm9yKG5ldyBUeXBlRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpKTtcclxuXHR9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgb3JpZ2luKCkgeyByZXR1cm4gdGhpcy5fcmF3Lm9yaWdpbiB8fCBWZWMyLmVtcHR5OyB9XHJcblxyXG5cdGlzSGFzQW5jaG9yKCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwOyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgYnJvdygpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAuYnJvdzsgfVxyXG5cdGlzQW5jaG9yQnJvdygpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5icm93OyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgbmVjaygpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAubmVjazsgfVxyXG5cdGlzQW5jaG9yTmVjaygpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5uZWNrOyB9XHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgbmF2ZWwoKSB7IHJldHVybiB0aGlzLl9yYXcubWFwLm5hdmVsOyB9XHJcblx0aXNBbmNob3JOYXZlbCgpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5uYXZlbDsgfVxyXG5cclxuXHQvKiogQHJldHVybnMge1ZlYzJ9ICovXHJcblx0Z2V0IGhhbmQoKSB7IHJldHVybiB0aGlzLl9yYXcubWFwLmhhbmQ7IH1cclxuXHRpc0FuY2hvckhhbmQoKSB7IHJldHVybiAhIXRoaXMuX3Jhdy5tYXAuaGFuZDsgfVxyXG5cclxuXHQvKiogQHJldHVybnMge1ZlYzJ9ICovXHJcblx0Z2V0IGhhbmRNb3ZlKCkgeyByZXR1cm4gdGhpcy5fcmF3Lm1hcC5oYW5kTW92ZTsgfVxyXG5cdGlzQW5jaG9ySGFuZE1vdmUoKSB7IHJldHVybiAhIXRoaXMuX3Jhdy5tYXAuaGFuZE1vdmU7IH1cclxuXHJcblxyXG5cdC8qKiBAcmV0dXJucyB7VmVjMn0gKi9cclxuXHRnZXQgX2VhckJlbG93SGVhZCgpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAuZWFyQmVsb3dIZWFkOyB9XHJcblx0aXNBbmNob3JfRWFyQmVsb3dIZWFkKCkgeyByZXR1cm4gISF0aGlzLl9yYXcubWFwLmVhckJlbG93SGVhZDsgfVxyXG5cclxuXHQvKiogQHJldHVybnMge1ZlYzJ9ICovXHJcblx0Z2V0IF9lYXJPdmVySGVhZCgpIHsgcmV0dXJuIHRoaXMuX3Jhdy5tYXAuZWFyT3ZlckhlYWQ7IH1cclxuXHRpc0FuY2hvcl9FYXJPdmVySGVhZCgpIHsgcmV0dXJuICEhdGhpcy5fcmF3Lm1hcC5lYXJPdmVySGVhZDsgfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gdGhhdCAtIHRoaXNcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYmFzZSAtIHBhcmVudFxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBhbmNob3IgLSBhbmNob3IgbmFtZVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9hbmNob3IodGhhdCwgYmFzZSwgYW5jaG9yKSB7XHJcblx0XHRyZXR1cm4gYmFzZVthbmNob3JdLm1pbnVzKHRoYXRbYW5jaG9yXSkucGx1cyhiYXNlLm9yaWdpbi5taW51cyh0aGF0Lm9yaWdpbikpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IFtoZWFkXVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdF9jYWxjUmVsYXRpdmUoY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdHRoaXMuY2FsY1JlbGF0aXZlID0gdGhpcy5fZ2V0UmVsYXRpdmVGdW5jdGlvbihjaGFyYSk7XHJcblx0XHRyZXR1cm4gdGhpcy5jYWxjUmVsYXRpdmUoY2hhcmEsIGJvZHksIGhlYWQpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2dldFJlbGF0aXZlRnVuY3Rpb24oY2hhcmEpIHtcclxuXHRcdGlmICghdGhpcy5pc0hhc0FuY2hvcigpKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVFbXB0eTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmlzQW5jaG9yTmVjaygpKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVfbmVjaztcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmlzQW5jaG9yQnJvdygpKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVfYnJvdztcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmlzQW5jaG9yTmF2ZWwoKSkge1xyXG5cdFx0XHRpZiAodGhpcyA9PSBjaGFyYS5zbG90cy5ib2R5KSB7XHJcblx0XHRcdFx0cmV0dXJuIHRoaXMuX2dldE9yaWdpbjtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdGhpcy5fY2FsY1JlbGF0aXZlX25hdmVsO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNBbmNob3JIYW5kKCkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2NhbGNSZWxhdGl2ZV9oYW5kO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuaXNBbmNob3JIYW5kTW92ZSgpKSB7XHJcblx0XHRcdGlmICh0aGlzLl91cmwubGFzdEluZGV4T2YoXCJsSGFuZFwiKSA+IDApIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5fY2FsY1JlbGF0aXZlX2hhbmRNb3ZlX2xIYW5kO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0aGlzLl9jYWxjUmVsYXRpdmVfaGFuZE1vdmU7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlRW1wdHkoY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdHJldHVybiBWZWMyLmVtcHR5O1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGJvZHlcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gW2hlYWRdXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2dldE9yaWdpbihjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIHRoaXMub3JpZ2luO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBuZWNrIG9uIHRoZSBuYXZlbFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX25lY2soY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdHJldHVybiB0aGlzLl9hbmNob3IodGhpcywgYm9keSwgXCJuZWNrXCIpLm1pbnVzKGJvZHkub3JpZ2luKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogYnJvdyBvbiB0aGUgaGVhZCAmIGhlYWQgb24gdGhlIG5lY2sgJiBuZWNrIG9uIHRoZSBuYXZlbFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX2Jyb3coY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdHJldHVybiB0aGlzLl9hbmNob3IodGhpcywgaGVhZCwgXCJicm93XCIpLnBsdXModGhpcy5fYW5jaG9yKGhlYWQsIGJvZHksIFwibmVja1wiKSkubWludXMoYm9keS5vcmlnaW4pOy8vYW5jaG9yX2Jyb3crKC03LC0zMylcclxuXHR9XHJcblx0LyoqXHJcblx0ICogdGhpcyBpcyBvcmlnaW4gcG9pbnQsIG5vIGFuY2hvclxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX25hdmVsKGNoYXJhLCBib2R5LCBoZWFkKSB7XHJcblx0XHRyZXR1cm4gYm9keS5uYXZlbC5taW51cyh0aGlzLm5hdmVsKS5taW51cyh0aGlzLm9yaWdpbik7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gYm9keVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBbaGVhZF1cclxuXHQgKiBAcmV0dXJucyB7VmVjMn1cclxuXHQgKi9cclxuXHRfY2FsY1JlbGF0aXZlX2hhbmQoY2hhcmEsIGJvZHksIGhlYWQpIHtcclxuXHRcdGNvbnN0IGhhbmQgPSBjaGFyYS5zbG90cy5ib2R5LmZyYWdtZW50cy5hcm0uZ2V0VGV4dHVyZShjaGFyYSk7XHJcblx0XHRpZiAoaGFuZCA9PSBudWxsKSB7XHJcblx0XHRcdHJldHVybiBWZWMyLmVtcHR5Lm1pbnVzKHRoaXMuaGFuZCkubWludXModGhpcy5vcmlnaW4pLm1pbnVzKGJvZHkub3JpZ2luKTtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5fYW5jaG9yKHRoaXMsIGhhbmQsIFwiaGFuZFwiKS5taW51cyh0aGlzLl9hbmNob3IoYm9keSwgaGFuZCwgXCJuYXZlbFwiKSkubWludXMoYm9keS5vcmlnaW4pO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGJvZHlcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gW2hlYWRdXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2NhbGNSZWxhdGl2ZV9oYW5kTW92ZShjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIFZlYzIuZW1wdHkubWludXModGhpcy5vcmlnaW4pLm1pbnVzKHRoaXMuaGFuZE1vdmUpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGJvZHlcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZX0gW2hlYWRdXHJcblx0ICogQHJldHVybnMge1ZlYzJ9XHJcblx0ICovXHJcblx0X2NhbGNSZWxhdGl2ZV9oYW5kTW92ZV9sSGFuZChjaGFyYSwgYm9keSwgaGVhZCkge1xyXG5cdFx0cmV0dXJuIFZlYzIuZW1wdHkubWludXModGhpcy5vcmlnaW4pO1xyXG5cdH1cclxuXHRcclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqL1xyXG5cdHVwZGF0ZShjaGFyYSkge1xyXG5cdFx0aWYgKGNoYXJhLnNsb3RzLmJvZHkgJiYgY2hhcmEuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHRjb25zdCBib2R5ID0gY2hhcmEuc2xvdHMuYm9keS5mcmFnbWVudHMuYm9keS5nZXRUZXh0dXJlKGNoYXJhKTtcclxuXHRcdFx0Y29uc3QgaGVhZCA9IGNoYXJhLnNsb3RzLmhlYWQuZnJhZ21lbnRzLmhlYWQuZ2V0VGV4dHVyZShjaGFyYSk7XHJcblx0XHRcdGlmIChib2R5ICYmIGhlYWQpIHtcclxuXHRcdFx0XHR0aGlzLnJlbGF0aXZlID0gdGhpcy5jYWxjUmVsYXRpdmUoY2hhcmEsIGJvZHksIGhlYWQpO1xyXG5cclxuXHRcdFx0XHRjb25zdCB0YW1pbmdNb2IgPSBjaGFyYS5zbG90cy50YW1pbmdNb2I7XHJcblx0XHRcdFx0aWYgKHRhbWluZ01vYikge1xyXG5cdFx0XHRcdFx0dGhpcy5yZWxhdGl2ZSA9IHRhbWluZ01vYi5hZGpfcG9zKHRoaXMucmVsYXRpdmUsIGJvZHksIGNoYXJhKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIGNoYXJhKSB7XHJcblx0XHRpZiAoISh0aGlzLnJlbGF0aXZlICYmIHRoaXMudmlzaWJsZSkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgeCA9IHRoaXMucmVsYXRpdmUueDtcclxuXHRcdGNvbnN0IHkgPSB0aGlzLnJlbGF0aXZlLnk7XHJcblxyXG5cdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLm9wYWNpdHk7XHJcblx0XHRpZiAodGhpcy5maWx0ZXIuaXNFbXB0eSkge1xyXG5cdFx0XHRyZW5kZXJlci5kcmF3R3JhcGgyKHRoaXMsIHgsIHkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJlbmRlcmVyLmN0eC5maWx0ZXIgPSB0aGlzLmZpbHRlci50b1N0cmluZygpO1xyXG5cdFx0XHRyZW5kZXJlci5kcmF3R3JhcGgyKHRoaXMsIHgsIHkpO1xyXG5cdFx0XHRyZW5kZXJlci5jdHguZmlsdGVyID0gXCJub25lXCI7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBCb2R5RnJhZ21lbnRUZXh0dXJlIGV4dGVuZHMgRnJhZ21lbnRUZXh0dXJlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICovXHJcblx0dXBkYXRlKGNoYXJhKSB7XHJcblx0XHRzdXBlci51cGRhdGUoY2hhcmEpO1xyXG5cdFx0dGhpcy52aXNpYmxlID0gIWNoYXJhLmhpZGVCb2R5O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgSGFpckZyYWdtZW50VGV4dHVyZSBleHRlbmRzIEZyYWdtZW50VGV4dHVyZSB7XHJcblx0Y29uc3RydWN0b3IoLi4uYXJncykge1xyXG5cdFx0c3VwZXIoLi4uYXJncyk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtIYWlyRnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0dGhpcy5ncmFwaDIgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7SGFpckZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdHRoaXMuZ3JhcGgzID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKi9cclxuXHR1cGRhdGUoY2hhcmEpIHtcclxuXHRcdGlmIChjaGFyYS5zbG90cy5ib2R5ICYmIGNoYXJhLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0Y29uc3QgYm9keSA9IGNoYXJhLnNsb3RzLmJvZHkuZnJhZ21lbnRzLmJvZHkuZ2V0VGV4dHVyZShjaGFyYSk7XHJcblx0XHRcdGNvbnN0IGhlYWQgPSBjaGFyYS5zbG90cy5oZWFkLmZyYWdtZW50cy5oZWFkLmdldFRleHR1cmUoY2hhcmEpO1xyXG5cdFx0XHRpZiAoYm9keSAmJiBoZWFkKSB7XHJcblx0XHRcdFx0dGhpcy5yZWxhdGl2ZSA9IHRoaXMuY2FsY1JlbGF0aXZlKGNoYXJhLCBib2R5LCBoZWFkKTtcclxuXHJcblx0XHRcdFx0Y29uc3QgdGFtaW5nTW9iID0gY2hhcmEuc2xvdHMudGFtaW5nTW9iO1xyXG5cdFx0XHRcdGlmICh0YW1pbmdNb2IpIHtcclxuXHRcdFx0XHRcdHRoaXMucmVsYXRpdmUgPSB0YW1pbmdNb2IuYWRqX3Bvcyh0aGlzLnJlbGF0aXZlLCBib2R5LCBjaGFyYSk7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5ncmFwaDIpIHtcclxuXHRcdFx0XHRcdHRoaXMuZ3JhcGgyLnJlbGF0aXZlID0gdGhpcy5yZWxhdGl2ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKHRoaXMuZ3JhcGgzKSB7XHJcblx0XHRcdFx0XHR0aGlzLmdyYXBoMy5yZWxhdGl2ZSA9IHRoaXMucmVsYXRpdmU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyLCBjaGFyYSkge1xyXG5cdFx0aWYgKCF0aGlzLnJlbGF0aXZlKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRyZW5kZXJlci5nbG9iYWxBbHBoYSA9IHRoaXMub3BhY2l0eSB8fCAxO1xyXG5cdFx0aWYgKHRoaXMuZmlsdGVyLmlzRW1wdHkpIHtcclxuXHRcdFx0dGhpcy5fcmVuZGVyKHJlbmRlcmVyKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZW5kZXJlci5jdHguZmlsdGVyID0gdGhpcy5maWx0ZXIudG9TdHJpbmcoKTtcclxuXHRcdFx0dGhpcy5fcmVuZGVyKHJlbmRlcmVyKTtcclxuXHRcdFx0cmVuZGVyZXIuY3R4LmZpbHRlciA9IFwibm9uZVwiO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRfcmVuZGVyKHJlbmRlcmVyKSB7XHJcblx0XHRjb25zdCB4ID0gdGhpcy5yZWxhdGl2ZS54O1xyXG5cdFx0Y29uc3QgeSA9IHRoaXMucmVsYXRpdmUueTtcclxuXHJcblx0XHRyZW5kZXJlci5kcmF3R3JhcGgyKHRoaXMsIHgsIHkpO1xyXG5cclxuXHRcdGlmICh0aGlzLmdyYXBoMiAmJiB0aGlzLmdyYXBoMi5vcGFjaXR5KSB7Ly9jb2xvcjJcclxuXHRcdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLmdyYXBoMi5vcGFjaXR5O1xyXG5cclxuXHRcdFx0cmVuZGVyZXIuZHJhd0dyYXBoMih0aGlzLmdyYXBoMiwgeCwgeSk7XHJcblx0XHR9XHJcblx0XHRpZiAodGhpcy5ncmFwaDMgJiYgdGhpcy5ncmFwaDMub3BhY2l0eSkgey8vY29sb3IzXHJcblx0XHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gdGhpcy5ncmFwaDMub3BhY2l0eTtcclxuXHJcblx0XHRcdHJlbmRlcmVyLmRyYXdHcmFwaDIodGhpcy5ncmFwaDMsIHgsIHkpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuXHJcbmNsYXNzIEl0ZW1FZmZlY3RBbmltYXRpb24gZXh0ZW5kcyBBbmltYXRpb24ge1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHRzdXBlcihyYXcsIHVybCk7XHJcblx0XHRcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9yYXdcIiwge1xyXG5cdFx0XHR2YWx1ZTogcmF3LFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0Ly90aGlzLl91cmwgPSB0aGlzLl91cmw7XHJcblxyXG5cdFx0dGhpcy5fX2dldEF0dHIoXCJ6XCIsIC0xKTtcclxuXHRcdHRoaXMuX19nZXRBdHRyKFwicG9zXCIsIDEpO1xyXG5cclxuXHRcdHN1cGVyLmxvYWQoKTtcclxuXHR9XHJcblx0X19nZXRBdHRyKGF0dHIsIGRlZlZhbCkge1xyXG5cdFx0aWYgKGF0dHIgaW4gdGhpcy5fcmF3KSB7XHJcblx0XHRcdHRoaXNbYXR0cl0gPSB0aGlzLl9yYXdbYXR0cl07XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpc1thdHRyXSA9IGRlZlZhbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gYWN0aW9uRXhjZXB0Um90YXRpb25cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW5nbGVcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGZsaXBcclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIGFjdGlvbkV4Y2VwdFJvdGF0aW9uLCBhbmdsZSwgZmxpcCkge1xyXG5cdFx0aWYgKGFjdGlvbkV4Y2VwdFJvdGF0aW9uKSB7XHJcblx0XHRcdHRoaXMuZHJhdyhyZW5kZXJlciwgMCwgMCwgLWFuZ2xlLCBmbGlwKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjb25zdCBveSA9IC10aGlzLnRleHR1cmUuaGVpZ2h0ICogMC4yNTtcclxuXHRcdFx0dGhpcy5kcmF3KHJlbmRlcmVyLCAwLCBveSwgMCwgZmxpcCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4vL1x0L2RhdGEvRWZmZWN0L0l0ZW1FZmYvMTEwMjkxOFxyXG5jbGFzcyBJdGVtRWZmZWN0IHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuX3VybCA9IG51bGw7XHJcblx0XHR0aGlzLl9yYXcgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e1thbmltYXRpb25OYW1lOnN0cmluZ106SXRlbUVmZmVjdEFuaW1hdGlvbn19ICovXHJcblx0XHR0aGlzLmFuaW1hdGlvbiA9IHt9O1xyXG5cclxuXHRcdHRoaXMuYWN0aW9uID0gbnVsbDtcclxuXHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHJcblx0XHR0aGlzLmZpeGVkID0gMDtcclxuXHRcdHRoaXMueiA9IC0yO1xyXG5cdFx0dGhpcy5hY3Rpb24gPSAxO1xyXG5cdFx0dGhpcy5hY3Rpb25FeGNlcHRSb3RhdGlvbiA9IDA7XHJcblx0XHRcclxuXHRcdHRoaXMuZW5hYmxlID0gdHJ1ZTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBhc3luYyBJbml0KCkge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0LyoqIEB0eXBlIHtTZXQ8c3RyaW5nPn0gKi9cclxuXHRcdFx0bGV0IGl0ZW1FZmZlY3RMaXN0ID0gSXRlbUVmZmVjdC5fbGlzdDtcclxuXHJcblx0XHRcdC8qKiBAdHlwZSB7c3RyaW5nW119ICovXHJcblx0XHRcdGxldCByYXcgPSBhd2FpdCAkZ2V0Lmxpc3QoXCIvRWZmZWN0L0l0ZW1FZmZcIik7XHJcblxyXG5cdFx0XHRpdGVtRWZmZWN0TGlzdC5jbGVhcigpO1xyXG5cclxuXHRcdFx0cmF3LmZvckVhY2goaWQgPT4ge1xyXG5cdFx0XHRcdGl0ZW1FZmZlY3RMaXN0LmFkZChwYXJzZUludChpZCwgMTApKTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogaWYgKCFleGlzdCkgcmV0dXJuIG51bGxcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZXF1aXBJRFxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPEl0ZW1FZmZlY3Q+fVxyXG5cdCAqL1xyXG5cdHN0YXRpYyBhc3luYyBsb2FkKGVxdWlwSUQpIHtcclxuXHRcdGNvbnN0IGlkID0gTnVtYmVyKGVxdWlwSUQpO1xyXG5cclxuXHRcdGlmIChJdGVtRWZmZWN0Ll9saXN0LmhhcyhpZCkpIHtcclxuXHRcdFx0bGV0IGVmZiA9IG5ldyBJdGVtRWZmZWN0KCk7XHJcblx0XHRcdGF3YWl0IGVmZi5sb2FkKGVxdWlwSUQpO1xyXG5cdFx0XHRyZXR1cm4gZWZmO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogaWYgKCFleGlzdCkgcmV0dXJuIG51bGxcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gZXF1aXBJRFxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQoZXF1aXBJRCkge1xyXG5cdFx0Y29uc3QgaWQgPSBOdW1iZXIoZXF1aXBJRCk7XHJcblx0XHRjb25zdCB1cmwgPSBgL0VmZmVjdC9JdGVtRWZmLyR7aWR9L2VmZmVjdGA7XHJcblx0XHRsZXQgcmF3O1xyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdHJhdyA9IGF3YWl0ICRnZXQuZGF0YSh1cmwpO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdHRocm93IGV4O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChyYXcpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2xvYWQoZXF1aXBJRCwgdXJsLCByYXcpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGFjdGlvblxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCwgYWN0aW9uKSB7XHJcblx0XHRpZiAoYWN0aW9uIGluIHRoaXMuYW5pbWF0aW9uKSB7XHJcblx0XHRcdHRoaXMuYWN0aW9uID0gYWN0aW9uO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuYWN0aW9uID0gXCJkZWZhdWx0XCI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuYW5pbWF0aW9uW3RoaXMuYWN0aW9uXSkge1xyXG5cdFx0XHR0aGlzLmFuaW1hdGlvblt0aGlzLmFjdGlvbl0udXBkYXRlKHN0YW1wKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyUmVuZGVyZXJ9IGNoYXJhXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyLCBjaGFyYSkge1xyXG5cdFx0aWYgKHRoaXMuYW5pbWF0aW9uICYmIHRoaXMuYW5pbWF0aW9uW3RoaXMuYWN0aW9uXSkge1xyXG5cdFx0XHR0aGlzLmFuaW1hdGlvblt0aGlzLmFjdGlvbl0ucmVuZGVyKHJlbmRlcmVyLCB0aGlzLmFjdGlvbkV4Y2VwdFJvdGF0aW9uLCBjaGFyYS5hbmdsZSwgY2hhcmEuZnJvbnQgPiAwKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBlcXVpcElEXHJcblx0ICogQHBhcmFtIHtvYmplY3R9IHJhd19kYXRhXHJcblx0ICovXHJcblx0X2xvYWQoZXF1aXBJRCwgdXJsLCByYXcpIHtcclxuXHRcdHRoaXMuaWQgPSBlcXVpcElEO1xyXG5cclxuXHRcdGlmICghcmF3KSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdFx0Ly90aGlzLl91cmwgPSB1cmw7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJfcmF3XCIsIHtcclxuXHRcdFx0dmFsdWU6IHJhdyxcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuX19jb25zdHJ1Y3QoKTtcclxuXHR9XHJcblx0X19jb25zdHJ1Y3QoKSB7XHJcblx0XHR0aGlzLl9fZ2V0QXR0cihcImZpeGVkXCIsIDApO1xyXG5cdFx0dGhpcy5fX2dldEF0dHIoXCJ6XCIsIC0xKTtcclxuXHRcdHRoaXMuX19nZXRBdHRyKFwiYWN0aW9uXCIsIDEpO1xyXG5cdFx0dGhpcy5fX2dldEF0dHIoXCJhY3Rpb25FeGNlcHRSb3RhdGlvblwiLCAwKTtcclxuXHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuX3Jhdykge1xyXG5cdFx0XHRpZiAodGhpcy5fcmF3W2ldICYmIHR5cGVvZiB0aGlzLl9yYXdbaV0gPT0gXCJvYmplY3RcIiAmJiAnMCcgaW4gdGhpcy5fcmF3W2ldKSB7Ly9hbmltYXRpb24gaGFzIGZyYW1lc1xyXG5cdFx0XHRcdHRoaXMuYW5pbWF0aW9uW2ldID0gbmV3IEl0ZW1FZmZlY3RBbmltYXRpb24odGhpcy5fcmF3W2ldLCBbdGhpcy5fdXJsLCBpXS5qb2luKFwiL1wiKSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0X19nZXRBdHRyKGF0dHIsIGRlZlZhbCkge1xyXG5cdFx0aWYgKGF0dHIgaW4gdGhpcy5fcmF3KSB7XHJcblx0XHRcdHRoaXNbYXR0cl0gPSB0aGlzLl9yYXdbYXR0cl07XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpc1thdHRyXSA9IGRlZlZhbDtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuLyoqIEB0eXBlIHtTZXQ8c3RyaW5nPn0gKi9cclxuSXRlbUVmZmVjdC5fbGlzdCA9IG5ldyBTZXQoKTtcclxuXHJcbmNsYXNzIENoYXJhY3RlckZyYWdtZW50QmFzZSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHt7W2FjdGlvbjpzdHJpbmddOiBGcmFnbWVudFRleHR1cmVbXX19IHRleHR1cmVzXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IodGV4dHVyZXMpIHtcclxuXHRcdC8qKiBAdHlwZSB7e1thY3Rpb246c3RyaW5nXTogRnJhZ21lbnRUZXh0dXJlW119fSAtIHRleHR1cmVzW2FjdGlvbjpzdHJpbmddW2ZyYW1lOm51bWJlcl0gKi9cclxuXHRcdHRoaXMudGV4dHVyZXMgPSB0ZXh0dXJlcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0VGV4dHVyZShjaGFyYSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBmcmFtZVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBmcmFtZSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVDb3VudChjaGFyYSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAZmluYWwgXHJcbiAqL1xyXG5jbGFzcyBDaGFyYWN0ZXJCb2R5RnJhZ21lbnQgZXh0ZW5kcyBDaGFyYWN0ZXJGcmFnbWVudEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKHRleHR1cmVzKSB7XHJcblx0XHRzdXBlcih0ZXh0dXJlcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge0ZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXRUZXh0dXJlKGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5nZXRGcmFtZVRleHR1cmUoY2hhcmEsIGNoYXJhLmFjdGlvbl9mcmFtZSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZnJhbWVcclxuXHQgKiBAcmV0dXJucyB7RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lVGV4dHVyZShjaGFyYSwgZnJhbWUpIHtcclxuXHRcdGlmICghKGNoYXJhLmFjdGlvbiBpbiB0aGlzLnRleHR1cmVzKSkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGxldCBmdCA9IHRoaXMudGV4dHVyZXNbY2hhcmEuYWN0aW9uXVtmcmFtZV07Ly9pZiBmcmFtZSBub3QgZXhpc3QgdGhlbiByZXR1cm4gdW5kZWZpbmVkXHJcblx0XHRyZXR1cm4gZnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHRpZiAodGhpcy50ZXh0dXJlc1tjaGFyYS5hY3Rpb25dKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnRleHR1cmVzW2NoYXJhLmFjdGlvbl0ubGVuZ3RoO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIDA7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQGZpbmFsIFxyXG4gKi9cclxuY2xhc3MgQ2hhcmFjdGVyRmFjZUZyYWdtZW50IGV4dGVuZHMgQ2hhcmFjdGVyRnJhZ21lbnRCYXNlIHtcclxuXHRjb25zdHJ1Y3Rvcih0ZXh0dXJlcykge1xyXG5cdFx0c3VwZXIodGV4dHVyZXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0VGV4dHVyZShjaGFyYSkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZ2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBjaGFyYS5lbW90aW9uX2ZyYW1lKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZnJhbWVcclxuXHQgKiBAcmV0dXJucyB7RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lVGV4dHVyZShjaGFyYSwgZnJhbWUpIHtcclxuXHRcdGlmICghKGNoYXJhLmVtb3Rpb24gaW4gdGhpcy50ZXh0dXJlcykpIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0XHRsZXQgZnQgPSB0aGlzLnRleHR1cmVzW2NoYXJhLmVtb3Rpb25dW2ZyYW1lXTtcclxuXHRcdHJldHVybiBmdDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lQ291bnQoY2hhcmEpIHtcclxuXHRcdGlmICh0aGlzLnRleHR1cmVzW2NoYXJhLmVtb3Rpb25dKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnRleHR1cmVzW2NoYXJhLmVtb3Rpb25dLmxlbmd0aDtcclxuXHRcdH1cclxuXHRcdHJldHVybiAwO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBmaW5hbCBcclxuICovXHJcbmNsYXNzIENoYXJhY3RlclRhbWluZ01vYkZyYWdtZW50IGV4dGVuZHMgQ2hhcmFjdGVyRnJhZ21lbnRCYXNlIHtcclxuXHRjb25zdHJ1Y3Rvcih0ZXh0dXJlcykge1xyXG5cdFx0c3VwZXIodGV4dHVyZXMpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtGcmFnbWVudFRleHR1cmV9XHJcblx0ICovXHJcblx0Z2V0VGV4dHVyZShjaGFyYSkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZ2V0RnJhbWVUZXh0dXJlKGNoYXJhLCBjaGFyYS5fYWN0aW9uX2ZyYW1lKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZnJhbWVcclxuXHQgKiBAcmV0dXJucyB7RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lVGV4dHVyZShjaGFyYSwgZnJhbWUpIHtcclxuXHRcdGlmICghKGNoYXJhLl9yaWRlX2FjdGlvbiBpbiB0aGlzLnRleHR1cmVzKSkge1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdH1cclxuXHRcdGxldCBmdCA9IHRoaXMudGV4dHVyZXNbY2hhcmEuX3JpZGVfYWN0aW9uXVtmcmFtZV07Ly9pZiBmcmFtZSBub3QgZXhpc3QgdGhlbiByZXR1cm4gdW5kZWZpbmVkXHJcblx0XHRyZXR1cm4gZnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHRpZiAodGhpcy50ZXh0dXJlc1tjaGFyYS5fcmlkZV9hY3Rpb25dKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnRleHR1cmVzW2NoYXJhLl9yaWRlX2FjdGlvbl0ubGVuZ3RoO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIDA7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBFcXVpcEltYWdlRmlsdGVyIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSBlcXVpcFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGVxdWlwKSB7XHJcblx0XHR0aGlzLmVxdWlwID0gZXF1aXA7XHJcblx0fVxyXG5cclxuXHRnZXQgaHVlKCkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0LmZpbHRlci5odWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBodWUodmFsdWUpIHtcclxuXHRcdGNvbnN0IGVxdWlwID0gdGhpcy5lcXVpcDtcclxuXHRcdGZvciAobGV0IGkgaW4gZXF1aXAuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdGZ0LmZpbHRlci5odWUgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBzYXQoKSB7XHJcblx0XHRjb25zdCBlcXVpcCA9IHRoaXMuZXF1aXA7XHJcblx0XHRmb3IgKGxldCBpIGluIGVxdWlwLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZnQuZmlsdGVyLnNhdDtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IHNhdCh2YWx1ZSkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLnNhdCA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRnZXQgYnJpKCkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0LmZpbHRlci5icmk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBicmkodmFsdWUpIHtcclxuXHRcdGNvbnN0IGVxdWlwID0gdGhpcy5lcXVpcDtcclxuXHRcdGZvciAobGV0IGkgaW4gZXF1aXAuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdGZ0LmZpbHRlci5icmkgPSB2YWx1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBjb250cmFzdCgpIHtcclxuXHRcdGNvbnN0IGVxdWlwID0gdGhpcy5lcXVpcDtcclxuXHRcdGZvciAobGV0IGkgaW4gZXF1aXAuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gZXF1aXAuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiBmdC5maWx0ZXIuY29udHJhc3Q7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBjb250cmFzdCh2YWx1ZSkge1xyXG5cdFx0Y29uc3QgZXF1aXAgPSB0aGlzLmVxdWlwO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiBlcXVpcC5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGVxdWlwLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSBlcXVpcC5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0ZnQuZmlsdGVyLmNvbnRyYXN0ID0gdmFsdWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHR0b0pTT04oKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRodWU6IHRoaXMuaHVlLFxyXG5cdFx0XHRzYXQ6IHRoaXMuc2F0LFxyXG5cdFx0XHRicmk6IHRoaXMuYnJpLFxyXG5cdFx0XHRjb250cmFzdDogdGhpcy5jb250cmFzdCxcclxuXHRcdH07XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQGludGVyZmFjZVxyXG4gKi9cclxuY2xhc3MgSUNoYXJhY3RlckFwcGVhcmFuY2VCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICovXHJcblx0aXNMb2FkZWQoKSB7XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqL1xyXG5cdF91bmxvYWQoKSB7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldEZyYW1lQ291bnQoY2hhcmEpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQW5pbWF0aW9uQmFzZX0gY2hhcmFcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldERlbGF5KGNoYXJhKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHR0b0pTT04oKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0aWQ6IC0xLC8vaW52YWxpZCBJRFxyXG5cdFx0fTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiA/P1xyXG4gKi9cclxuY2xhc3MgX0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlU2xvdExpbmsgZXh0ZW5kcyBJQ2hhcmFjdGVyQXBwZWFyYW5jZUJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKHNsb3RfbGluaykge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMuc2xvdF9saW5rID0gc2xvdF9saW5rOy8vPz9cclxuXHR9XHJcblxyXG5cdHRvSlNPTigpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdGlkOiBzbG90X2xpbmssLy8/P1xyXG5cdFx0fTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBjaGFyYWN0ZXIgbG9hZGVyXHJcbiAqL1xyXG5jbGFzcyBDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSBleHRlbmRzIElDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0XHRcclxuXHRcdHRoaXMuX3JhdyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHQvL3RoaXMuX3VybCA9IG51bGw7XHJcblx0XHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtJdGVtRWZmZWN0fSAqL1xyXG5cdFx0dGhpcy5lZmZlY3QgPSBudWxsO1xyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogQHR5cGUge3tbcGxhY2U6c3RyaW5nXTpDaGFyYWN0ZXJGcmFnbWVudEJhc2V9fVxyXG5cdFx0ICovXHJcblx0XHR0aGlzLmZyYWdtZW50cyA9IG51bGw7XHJcblxyXG5cdFx0dGhpcy5fb25sb2FkID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuaWQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7SXRlbUNhdGVnb3J5SW5mb30gKi9cclxuXHRcdHRoaXMuY2F0ZWdvcnlJbmZvID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuc2xvdF9vcmRlciA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtvYmplY3Q8c3RyaW5nLCBudW1iZXI+fSAqL1xyXG5cdFx0dGhpcy5pc2xvdCA9IHt9O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7b2JqZWN0PHN0cmluZywgbnVtYmVyPn0gKi9cclxuXHRcdHRoaXMudnNsb3QgPSB7fTtcclxuXHJcblx0XHR0aGlzLmZpbHRlciA9IG5ldyBFcXVpcEltYWdlRmlsdGVyKHRoaXMpO1xyXG5cdH1cclxuXHJcblx0dG9KU09OKCkge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0aWQ6IHRoaXMuaWQsXHJcblx0XHRcdGZpbHRlcjogdGhpcy5maWx0ZXIudG9KU09OKCksXHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0aXNMb2FkZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFnbWVudHMgIT0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7ZnVuY3Rpb24oQ2hhcmFjdGVyQXBwZWFyYW5jZUJhc2UpOnZvaWR9ICovXHJcblx0Z2V0IF9vbmxvYWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fX29ubG9hZDtcclxuXHR9XHJcblx0c2V0IF9vbmxvYWQoZnVuYykge1xyXG5cdFx0dGhpcy5fX29ubG9hZCA9IGZ1bmM7XHJcblx0XHRpZiAodGhpcy5pc0xvYWRlZCgpKSB7XHJcblx0XHRcdHRoaXMuX19vbmxvYWQuY2FsbCh0aGlzLCB0aGlzKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKiBAcGFyYW0ge0l0ZW1DYXRlZ29yeUluZm99IGNhdGVJbmZvXHJcblx0ICogQHBhcmFtIHt2b2lkfSB1c2VfY2F0ZWdvcnkgLSBubyB1c2VcclxuXHQgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSB0cnVlIGlmIGl0ZW0gZXhpc3RcclxuXHQgKi9cclxuXHRhc3luYyBsb2FkKHVybCwgaWQsIGNhdGVJbmZvLCB1c2VfY2F0ZWdvcnkpIHtcclxuXHRcdGxldCByYXc7XHJcblxyXG5cdFx0dGhpcy5pZCA9IGlkO1xyXG5cdFx0dGhpcy5jYXRlZ29yeUluZm8gPSBjYXRlSW5mbztcclxuXHRcdFxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aWYgKFJlc291cmNlTWFuYWdlci5pc0VxdWlwRXhpc3QoaWQsIGNhdGVJbmZvKSkge1xyXG5cdFx0XHRcdHJhdyA9IGF3YWl0IEl0ZW1DYXRlZ29yeUluZm8uZ2V0SXRlbShpZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHR0aHJvdyBleDtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aWYgKCFyYXcgJiYgbG9hZF9leHRlcm5faXRlbV9kYXRhKSB7XHJcblx0XHRcdFx0cmF3ID0gYXdhaXQgbG9hZF9leHRlcm5faXRlbV9kYXRhKGlkKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdHRocm93IGV4O1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vdGhpcy5fdXJsID0gdXJsO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX3Jhd1wiLCB7XHJcblx0XHRcdHZhbHVlOiByYXcsXHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLl9fbG9hZF9zbG90KCk7XHJcblxyXG5cdFx0dGhpcy5fX2xvYWRfZnJhZ21lbnRzKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX29ubG9hZCkge1xyXG5cdFx0XHR0aGlzLl9vbmxvYWQuY2FsbCh0aGlzLCB0aGlzKTtcclxuXHRcdH1cclxuXHJcblx0XHQvLy8vIGlmIG5vdCBib2R5LCBoZWFkLCBmYWNlLCBoYWlyIHRoZW4gdHJ5IGxvYWQgZWZmZWN0XHJcblx0XHQvL2lmIChpZCA+PSBcIjAwMDUwMDAwXCIpIHtcclxuXHRcdFx0Ly8gbG9hZCBpZiBleGlzdFxyXG5cdFx0XHRJdGVtRWZmZWN0LmxvYWQodGhpcy5pZCkudGhlbihhID0+IHRoaXMuZWZmZWN0ID0gYSk7Ly8wMTEwMjkxOFx0Ly8wMTEwMjkxNVxyXG5cdFx0Ly99XHJcblxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cdF9fbG9hZF9mcmFnbWVudHMoKSB7XHJcblx0XHRjb25zdCBGcmFnbWVudENvbnN0cnVjdG9yID0gdGhpcy5GcmFnbWVudENvbnN0cnVjdG9yO1xyXG5cclxuXHRcdC8vT2JqZWN0LmtleXModGhpcy5fcmF3X3RleHR1cmVzKS5tYXAoayA9PiB7IHJldHVybiAnMCcgaW4gdGhpcy5fcmF3X3RleHR1cmVzW2tdOyB9KVxyXG5cclxuXHRcdGxldCBhY3Rpb25fbGlzdCA9IE9iamVjdC5rZXlzKHRoaXMuX3Jhd190ZXh0dXJlcyk7XHJcblxyXG5cdFx0bGV0IHRleHR1cmVzID0ge307XHJcblx0XHRmb3IgKGxldCBhY3Rpb24gb2YgYWN0aW9uX2xpc3QpIHtcclxuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLl9yYXdfdGV4dHVyZXNbYWN0aW9uXSA9PSBcIm9iamVjdFwiICYmIFwiMFwiIGluIHRoaXMuX3Jhd190ZXh0dXJlc1thY3Rpb25dKSB7XHJcblx0XHRcdFx0bGV0IF91cmwgPSB0aGlzLl9iYXNlX3BhdGggKyBhY3Rpb247XHJcblxyXG5cdFx0XHRcdHRleHR1cmVzW2FjdGlvbl0gPSB0aGlzLl9fbG9hZF9mcmFtZV90ZXh0dXJlcyh0aGlzLl9yYXdfdGV4dHVyZXNbYWN0aW9uXSwgX3VybCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRsZXQgZnJhZ21lbnRfdGV4dHVyZXMgPSB7fTtcclxuXHRcdGZvciAobGV0IGFjdGlvbiBpbiB0ZXh0dXJlcykge1xyXG5cdFx0XHRmb3IgKGxldCBmcmFtZSBpbiB0ZXh0dXJlc1thY3Rpb25dKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgcGxhY2UgaW4gdGV4dHVyZXNbYWN0aW9uXVtmcmFtZV0pIHtcclxuXHRcdFx0XHRcdGlmICghKHBsYWNlIGluIGZyYWdtZW50X3RleHR1cmVzKSkge1xyXG5cdFx0XHRcdFx0XHRmcmFnbWVudF90ZXh0dXJlc1twbGFjZV0gPSB7fTtcclxuXHRcdFx0XHRcdFx0Ly9mcmFnbWVudF90ZXh0dXJlc1twbGFjZV0udmlzaWJsZSA9IHRydWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRpZiAoIShhY3Rpb24gaW4gZnJhZ21lbnRfdGV4dHVyZXNbcGxhY2VdKSkge1xyXG5cdFx0XHRcdFx0XHRmcmFnbWVudF90ZXh0dXJlc1twbGFjZV1bYWN0aW9uXSA9IFtdO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZnJhZ21lbnRfdGV4dHVyZXNbcGxhY2VdW2FjdGlvbl1bZnJhbWVdID0gdGV4dHVyZXNbYWN0aW9uXVtmcmFtZV1bcGxhY2VdO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBmcmFnbWVudHMgPSB7fTtcclxuXHRcdGZvciAobGV0IGZyYWcgaW4gZnJhZ21lbnRfdGV4dHVyZXMpIHtcclxuXHRcdFx0ZnJhZ21lbnRzW2ZyYWddID0gbmV3IEZyYWdtZW50Q29uc3RydWN0b3IoZnJhZ21lbnRfdGV4dHVyZXNbZnJhZ10pO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5mcmFnbWVudHMgPSBmcmFnbWVudHM7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBfdXJsXHJcblx0ICogQHJldHVybnMge3tbcGxhY2U6c3RyaW5nXTpGcmFnbWVudFRleHR1cmV9W119IC0gYXJyYXkgLSB0ZXh0dXJlc1tmcmFtZV1bcGxhY2VdXHJcblx0ICovXHJcblx0X19sb2FkX2ZyYW1lX3RleHR1cmVzKF9yYXcsIF91cmwpIHtcclxuXHRcdGxldCB0ZXh0dXJlcyA9IFtdO1xyXG5cdFx0Zm9yIChsZXQgZnJhbWUgPSAwOyBmcmFtZSBpbiBfcmF3OyArK2ZyYW1lKSB7XHJcblx0XHRcdGxldCB1cmwgPSBgJHtfdXJsfS8ke2ZyYW1lfWA7XHJcblx0XHRcdHRleHR1cmVzW2ZyYW1lXSA9IHRoaXMuX19sb2FkX3BsYWNlX3RleHR1cmVzKF9yYXdbZnJhbWVdLCB1cmwpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHRleHR1cmVzO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gX3VybFxyXG5cdCAqIEByZXR1cm5zIHt7W3BsYWNlOnN0cmluZ106RnJhZ21lbnRUZXh0dXJlfX0gLSBvYmplY3QgLSB0ZXh0dXJlc1twbGFjZV1cclxuXHQgKi9cclxuXHRfX2xvYWRfcGxhY2VfdGV4dHVyZXMoX3JhdywgX3VybCkge1xyXG5cdFx0bGV0IHRleHR1cmVzID0ge307XHJcblx0XHRmb3IgKGxldCBwbGFjZSBpbiBfcmF3KSB7XHJcblx0XHRcdGxldCBwYXRoID0gYCR7X3VybH0vJHtwbGFjZX1gO1xyXG5cdFx0XHRsZXQgcmF3ID0gX3Jhd1twbGFjZV07XHJcblxyXG5cdFx0XHRpZiAocmF3KSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0Y29uc3QgRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3IgPSB0aGlzLkZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yO1xyXG5cdFx0XHRcdGxldCBmdDtcclxuXHRcdFx0XHRpZiAocmF3W1wiXCJdID09IFwiXCIpIHtcclxuXHRcdFx0XHRcdGZ0Ll91cmwgPSBwYXRoO1xyXG5cdFx0XHRcdFx0Ly9mdC5fdXJsID0gcGF0aDtcclxuXHRcdFx0XHRcdHRleHR1cmVzW3BsYWNlXSA9IGZ0XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHR5cGVvZiByYXdbXCJcIl0gPT0gJ3N0cmluZycpIHtcclxuXHRcdFx0XHRcdGZ0ID0gbmV3IEZyYWdtZW50VGV4dHVyZUNvbnN0cnVjdG9yKHJhdyk7XHJcblx0XHRcdFx0XHQvL2Z0Ll91cmwgPSByYXdbXCJcIl07XHJcblx0XHRcdFx0XHR0ZXh0dXJlc1twbGFjZV0gPSBmdDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAocGxhY2UgPT0gXCJoYWlyU2hhZGVcIikge1xyXG5cdFx0XHRcdFx0ZnQgPSBuZXcgRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3IocmF3WzBdKTtcclxuXHRcdFx0XHRcdC8vZnQuX3VybCA9IHBhdGggKyBcIi8wXCI7XHJcblx0XHRcdFx0XHR0ZXh0dXJlc1twbGFjZV0gPSBmdDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRmdC5fc2xvdCA9IHRoaXMuY2F0ZWdvcnlJbmZvLnNsb3Q7XHJcblx0XHRcdFx0XHRmdC5fcGxhY2UgPSBwbGFjZTtcclxuXHJcblx0XHRcdFx0XHRmdC5jbGFzc0xpc3QgPSBbXHJcblx0XHRcdFx0XHRcdGZ0Ll9zbG90LFxyXG5cdFx0XHRcdFx0XHRcIml0ZW1cIiArIHRoaXMuaWQsXHJcblx0XHRcdFx0XHRcdGZ0Ll9wbGFjZSxcclxuXHRcdFx0XHRcdFx0ZnQuX3Jhdy56LFxyXG5cdFx0XHRcdFx0XHQneicgKyBmdC56XHJcblx0XHRcdFx0XHRdLmpvaW4oJyAnKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiB0ZXh0dXJlcztcclxuXHR9XHJcblx0X19sb2FkX3Nsb3QoKSB7XHJcblx0XHRpZiAoIXRoaXMuX3Jhdy5pbmZvLmlzbG90KSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRsZXQgaXNsb3RzID0gdGhpcy5fcmF3LmluZm8uaXNsb3QubWF0Y2goLyhbQS1aXVthLXowLTldKS9nKTtcclxuXHRcdGZvciAobGV0IGkgaW4gaXNsb3RzKSB7XHJcblx0XHRcdGNvbnN0IHNsb3QgPSBpc2xvdHNbaV07XHJcblx0XHRcdGNvbnN0IHNsb3Rfb3JkZXIgPSB6TWFwW3Nsb3RdO1xyXG5cdFx0XHR0aGlzLmlzbG90W3Nsb3RdID0gc2xvdF9vcmRlcjtcclxuXHRcdFx0XHRcclxuXHRcdFx0aWYgKHNsb3Rfb3JkZXIgPiB0aGlzLnNsb3Rfb3JkZXIpIHsvL3RoaXMuc2xvdF9vcmRlciA9IE1hdGgubWF4KHRoaXMuc2xvdF9vcmRlciwgc2xvdF9vcmRlcik7XHJcblx0XHRcdFx0dGhpcy5zbG90X29yZGVyID0gc2xvdF9vcmRlcjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGxldCB2c2xvdHMgPSB0aGlzLl9yYXcuaW5mby52c2xvdC5tYXRjaCgvKFtBLVpdW2EtejAtOV0pL2cpO1xyXG5cdFx0Zm9yIChsZXQgaSBpbiB2c2xvdHMpIHtcclxuXHRcdFx0Y29uc3Qgc2xvdCA9IHZzbG90c1tpXTtcclxuXHRcdFx0dGhpcy52c2xvdFtzbG90XSA9IHNsb3Q7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRfdW5sb2FkKCkge1xyXG5cdFx0dGhpcy5mcmFnbWVudHMgPSBudWxsO1xyXG5cdFx0dGhpcy5lZmZlY3QgPT0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXQgb3BhY2l0eSgpIHtcclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5mcmFnbWVudHMpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiBpbiB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgPSAwOyBrIDwgdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXNbal0ubGVuZ3RoOyArK2spIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXNbal1ba107XHJcblx0XHRcdFx0XHRpZiAoZnQpIHtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0Lm9wYWNpdHk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBvcGFjaXR5XHJcblx0ICovXHJcblx0c2V0IG9wYWNpdHkob3BhY2l0eSkge1xyXG5cdFx0Zm9yIChsZXQgaSBpbiB0aGlzLmZyYWdtZW50cykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluIHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayA9IDA7IGsgPCB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXS5sZW5ndGg7ICsraykge1xyXG5cdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRsZXQgZnQgPSB0aGlzLmZyYWdtZW50c1tpXS50ZXh0dXJlc1tqXVtrXTtcclxuXHRcdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0XHRmdC5vcGFjaXR5ID0gb3BhY2l0eTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBodWUgMCB+IDM2MFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzYXQgMCB+IDEwMFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBicmkgMCB+IDEwMFxyXG5cdCAqL1xyXG5cdHNldEZpbHRlcihodWUsIHNhdCwgYnJpKSB7XHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGZvciAobGV0IGogaW4gdGhpcy5mcmFnbWVudHNbaV0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdLmxlbmd0aDsgKytrKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdGxldCBmdCA9IHRoaXMuZnJhZ21lbnRzW2ldLnRleHR1cmVzW2pdW2tdO1xyXG5cdFx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRcdGZ0LmZpbHRlci5odWUgPSBodWU7XHJcblx0XHRcdFx0XHRcdGZ0LmZpbHRlci5zYXQgPSBzYXQ7XHJcblx0XHRcdFx0XHRcdGZ0LmZpbHRlci5icmkgPSBicmk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBnZXQgaWNvbiB1cmxcclxuXHQgKiBAc2VlIHtAbGluayBJdGVtQ2F0ZWdvcnlJbmZvLmdldEljb25Vcmx9XHJcblx0ICogQHJldHVybnMge3N0cmluZ31cclxuXHQgKi9cclxuXHRnZXRJY29uVXJsKCkge1xyXG5cdFx0Y29uc3QgaWNvbiA9IHRoaXMuX3Jhdy5pbmZvLmljb247XHJcblx0XHRpZiAoaWNvbikge1xyXG5cdFx0XHRyZXR1cm4gaWNvbltcIlwiXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0cmV0dXJuIEl0ZW1DYXRlZ29yeUluZm8uZ2V0SWNvblVybCh0aGlzLmlkKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGdldCBpY29uUmF3IHVybFxyXG5cdCAqIEBzZWUge0BsaW5rIEl0ZW1DYXRlZ29yeUluZm8uZ2V0SWNvblJhd1VybH1cclxuXHQgKiBAcmV0dXJucyB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdGdldEljb25SYXdVcmwoKSB7XHJcblx0XHRjb25zdCBpY29uUmF3ID0gdGhpcy5fcmF3LmluZm8uaWNvblJhdztcclxuXHRcdGlmIChpY29uUmF3KSB7XHJcblx0XHRcdHJldHVybiBpY29uUmF3W1wiXCJdO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRyZXR1cm4gSXRlbUNhdGVnb3J5SW5mby5nZXRJY29uUmF3VXJsKHRoaXMuaWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAdHlwZSB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgSW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckZyYWdtZW50QmFzZX1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgRnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7e1thY3Rpb25zOnN0cmluZ106e1tcIjBcIl06U3ByaXRlLFtmcmFtZXM6c3RyaW5nXTpTcHJpdGV9fX0gcmF3X3RleHR1cmVzWy4uLmFjdGlvbnNdWy4uLmZyYW1lc11bLi4uZnJhZ21lbnRzXVxyXG5cdCAqL1xyXG5cdGdldCBfcmF3X3RleHR1cmVzKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3JhdztcclxuXHR9XHJcblxyXG5cdGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3VybDtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAYWJzdHJhY3RcclxuICovXHJcbmNsYXNzIENoYXJhY3RlckFwcGVhcmFuY2UgZXh0ZW5kcyBDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHQvL19faXNfdGV4dHVyZShrKSB7XHJcblx0Ly9cdHJldHVybiAoIShrID09IFwiZmFjZVwiIHx8IGsgPT0gXCJkZWxheVwiIHx8IGsgPT0gXCJkZWZhdWx0XCIpKTtcclxuXHQvL31cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVDb3VudChjaGFyYSkge1xyXG5cdFx0cmV0dXJuIGNoYXJhLnNsb3RzLmJvZHkuZnJhZ21lbnRzLmJvZHkudGV4dHVyZXNbY2hhcmEuYWN0aW9uXS5sZW5ndGg7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXREZWxheShjaGFyYSkge1xyXG5cdFx0Y29uc3QgZCA9IHRoaXMuX3Jhd1tjaGFyYS5hY3Rpb25dW2NoYXJhLmFjdGlvbl9mcmFtZV0uZGVsYXk7XHJcblx0XHRpZiAoTnVtYmVyLmlzU2FmZUludGVnZXIoZCkpIHtcclxuXHRcdFx0cmV0dXJuIGQ7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMTIwO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyQm9keSBleHRlbmRzIENoYXJhY3RlckFwcGVhcmFuY2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHRyZXR1cm4gXCJhY3Rpb25cIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQ2hhcmFjdGVyQm9keUZyYWdtZW50fVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlckJvZHlGcmFnbWVudDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQm9keUZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQm9keUZyYWdtZW50VGV4dHVyZTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIENoYXJhY3RlckVxdWlwIGV4dGVuZHMgQ2hhcmFjdGVyQXBwZWFyYW5jZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImFjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyQm9keUZyYWdtZW50O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBCb2R5RnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBCb2R5RnJhZ21lbnRUZXh0dXJlO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyRXF1aXBDYXNoV2VhcG9uIGV4dGVuZHMgQ2hhcmFjdGVyRXF1aXAge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMudXNlX2NhdGVnb3J5ID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKiBAcGFyYW0ge0l0ZW1DYXRlZ29yeUluZm99IGNhdGVJbmZvXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHVzZV9jYXRlZ29yeSAtIGNhc2gtd2VhcG9uIGFzIFtjYXRlZ29yeV1cclxuXHQgKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gLSB0cnVlIGlmIGl0ZW0gZXhpc3RcclxuXHQgKi9cclxuXHRhc3luYyBsb2FkKHVybCwgaWQsIGNhdGVJbmZvLCB1c2VfY2F0ZWdvcnkpIHtcclxuXHRcdGlmICghdXNlX2NhdGVnb3J5ICYmIHVzZV9jYXRlZ29yeSAhPSBcIlwiKSB7XHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJ1c2VfY2F0ZWdvcnlcIik7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy51c2VfY2F0ZWdvcnkgPSB1c2VfY2F0ZWdvcnkuc2xpY2UoMiwgNCk7XHJcblxyXG5cdFx0cmV0dXJuIHN1cGVyLmxvYWQodXJsLCBpZCwgY2F0ZUluZm8pO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImFjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyQm9keUZyYWdtZW50O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge29iamVjdH0gcmF3X3RleHR1cmVzWy4uLmFjdGlvbnNdWy4uLmZyYW1lc11bLi4uZnJhZ21lbnRzXVxyXG5cdCAqL1xyXG5cdGdldCBfcmF3X3RleHR1cmVzKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jhd1t0aGlzLnVzZV9jYXRlZ29yeV07XHJcblx0fVxyXG5cclxuXHRnZXQgX2Jhc2VfcGF0aCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl91cmwgKyB0aGlzLnVzZV9jYXRlZ29yeTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJIZWFkQmFzZSBleHRlbmRzIENoYXJhY3RlckFwcGVhcmFuY2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHRyZXR1cm4gXCJhY3Rpb25cIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgQ2hhcmFjdGVyQm9keUZyYWdtZW50fVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudENvbnN0cnVjdG9yKCkge1xyXG5cdFx0cmV0dXJuIENoYXJhY3RlckJvZHlGcmFnbWVudDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgRnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBGcmFnbWVudFRleHR1cmU7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJIZWFkIGV4dGVuZHMgQ2hhcmFjdGVySGVhZEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMuZWxmRWFyRnJhZ21lbnQgPSBudWxsO1xyXG5cdFx0dGhpcy5sZWZFYXJGcmFnbWVudCA9IG51bGw7XHJcblx0XHR0aGlzLmhpZ2hsZWZFYXJGcmFnbWVudCA9IG51bGw7XHJcblx0fVxyXG5cdF9fbG9hZF9mcmFnbWVudHMoKSB7XHJcblx0XHRzdXBlci5fX2xvYWRfZnJhZ21lbnRzKClcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuZnJhZ21lbnRzKSB7XHJcblx0XHRcdGlmICh0aGlzLmZyYWdtZW50cy5lYXIpIHtcclxuXHRcdFx0XHR0aGlzLmVsZkVhckZyYWdtZW50ID0gdGhpcy5mcmFnbWVudHMuZWFyO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLmZyYWdtZW50cy5lYXI7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuZnJhZ21lbnRzLmxlZkVhcikge1xyXG5cdFx0XHRcdHRoaXMubGVmRWFyRnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50cy5sZWZFYXI7XHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuZnJhZ21lbnRzLmxlZkVhcjtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5mcmFnbWVudHMuaGlnaGxlZkVhcikge1xyXG5cdFx0XHRcdHRoaXMuaGlnaGxlZkVhckZyYWdtZW50ID0gdGhpcy5mcmFnbWVudHMuaGlnaGxlZkVhcjtcclxuXHRcdFx0XHRkZWxldGUgdGhpcy5mcmFnbWVudHMuaGlnaGxlZkVhcjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRnZXQgZWxmRWFyKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZnJhZ21lbnRzLmVhciAhPSBudWxsO1xyXG5cdH1cclxuXHRzZXQgZWxmRWFyKHZhbHVlKSB7XHJcblx0XHRpZiAoIXRoaXMuZWxmRWFyRnJhZ21lbnQpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHZhbHVlKSB7XHJcblx0XHRcdHRoaXMuZnJhZ21lbnRzLmVhciA9IHRoaXMuZWxmRWFyRnJhZ21lbnQ7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVsZXRlIHRoaXMuZnJhZ21lbnRzLmVhcjtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBsZWZFYXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFnbWVudHMubGVmRWFyICE9IG51bGw7XHJcblx0fVxyXG5cdHNldCBsZWZFYXIodmFsdWUpIHtcclxuXHRcdGlmICghdGhpcy5sZWZFYXJGcmFnbWVudCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5mcmFnbWVudHMubGVmRWFyID0gdGhpcy5sZWZFYXJGcmFnbWVudDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRkZWxldGUgdGhpcy5mcmFnbWVudHMubGVmRWFyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0IGhpZ2hsZWZFYXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mcmFnbWVudHMuaGlnaGxlZkVhciAhPSBudWxsO1xyXG5cdH1cclxuXHRzZXQgaGlnaGxlZkVhcih2YWx1ZSkge1xyXG5cdFx0aWYgKCF0aGlzLmhpZ2hsZWZFYXJGcmFnbWVudCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5mcmFnbWVudHMuaGlnaGxlZkVhciA9IHRoaXMuaGlnaGxlZkVhckZyYWdtZW50O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGRlbGV0ZSB0aGlzLmZyYWdtZW50cy5oaWdobGVmRWFyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcImFjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyQm9keUZyYWdtZW50O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVySGFpciBleHRlbmRzIENoYXJhY3RlckhlYWRCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiYWN0aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckJvZHlGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJCb2R5RnJhZ21lbnQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBoYWlyIGNvbG9yIG1peFxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgSGFpckZyYWdtZW50VGV4dHVyZX1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRUZXh0dXJlQ29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gSGFpckZyYWdtZW50VGV4dHVyZTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIENoYXJhY3RlckZhY2VCYXNlIGV4dGVuZHMgQ2hhcmFjdGVySGVhZEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblx0Ly9fX2lzX3RleHR1cmUoaykge1xyXG5cdC8vXHRyZXR1cm4gKCEoayA9PSBcImRlbGF5XCIgfHwgayA9PSBcImRlZmF1bHRcIikpO1xyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXRGcmFtZUNvdW50KGNoYXJhKSB7XHJcblx0XHRyZXR1cm4gY2hhcmEuc2xvdHMuZmFjZS5mcmFnbWVudHMuZmFjZS50ZXh0dXJlc1tjaGFyYS5lbW90aW9uXS5sZW5ndGg7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXREZWxheShjaGFyYSkge1xyXG5cdFx0Y29uc3QgZCA9IHRoaXMuX3Jhd1tjaGFyYS5lbW90aW9uXVtjaGFyYS5lbW90aW9uX2ZyYW1lXS5kZWxheTtcclxuXHRcdGlmIChkICE9IG51bGwpIHsvLyFpc05hTihkKSAmJiBpc0Zpbml0ZShkKVxyXG5cdFx0XHRyZXR1cm4gZDtcclxuXHRcdH1cclxuXHRcdHJldHVybiA2MDtcclxuXHR9XHJcbn1cclxuY2xhc3MgQ2hhcmFjdGVyRmFjZSBleHRlbmRzIENoYXJhY3RlckZhY2VCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cclxuXHRnZXQgX2FuaW1hdGlvbl90eXBlKCkge1xyXG5cdFx0cmV0dXJuIFwiZW1vdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJGYWNlRnJhZ21lbnR9XHJcblx0ICovXHJcblx0Z2V0IEZyYWdtZW50Q29uc3RydWN0b3IoKSB7XHJcblx0XHRyZXR1cm4gQ2hhcmFjdGVyRmFjZUZyYWdtZW50O1xyXG5cdH1cclxufVxyXG5jbGFzcyBDaGFyYWN0ZXJGYWNlQWNjIGV4dGVuZHMgQ2hhcmFjdGVyRmFjZUJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHR9XHJcblxyXG5cdGdldCBfYW5pbWF0aW9uX3R5cGUoKSB7XHJcblx0XHRyZXR1cm4gXCJlbW90aW9uXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcmV0dXJucyB7dHlwZW9mIENoYXJhY3RlckZhY2VGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJGYWNlRnJhZ21lbnQ7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJUYW1pbmdNb2IgZXh0ZW5kcyBDaGFyYWN0ZXJBcHBlYXJhbmNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldCB0eXBlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jhdy5pbmZvLnRhbWluZ01vYjtcclxuXHR9XHJcblxyXG5cdGdldCBhY3Rpb25NYXAoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3LmNoYXJhY3RlckFjdGlvbjtcclxuXHR9XHJcblxyXG5cdGdldCBlbW90aW9uTWFwKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jhdy5jaGFyYWN0ZXJFbW90aW9uO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtWZWMyfSByZWxhdGl2ZVxyXG5cdCAqIEBwYXJhbSB7RnJhZ21lbnRUZXh0dXJlfSBib2R5XHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtWZWMyfVxyXG5cdCAqL1xyXG5cdGFkal9wb3MocmVsYXRpdmUsIGJvZHksIGNoYXJhKSB7XHJcblx0XHRjb25zdCBmcmFnID0gdGhpcy5mcmFnbWVudHNbMF07Ly9kZWZhdWx0XHJcblx0XHRpZiAoZnJhZykge1xyXG5cdFx0XHRjb25zdCB0bSA9IGZyYWcuZ2V0VGV4dHVyZShjaGFyYSk7XHJcblx0XHRcdGlmICh0bSkge1xyXG5cdFx0XHRcdHJldHVybiByZWxhdGl2ZS5wbHVzKHRtLm5hdmVsLm1pbnVzKGJvZHkubmF2ZWwpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlbGF0aXZlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSBjaGFyYVxyXG5cdCAqIEByZXR1cm5zIHtudW1iZXJ9XHJcblx0ICovXHJcblx0Z2V0RnJhbWVDb3VudChjaGFyYSkge1xyXG5cdFx0cmV0dXJuIGNoYXJhLnNsb3RzLmJvZHkuZnJhZ21lbnRzLmJvZHkudGV4dHVyZXNbY2hhcmEuX3JpZGVfYWN0aW9uXS5sZW5ndGg7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IGNoYXJhXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXREZWxheShjaGFyYSkge1xyXG5cdFx0Y29uc3QgZCA9IE1hdGgudHJ1bmModGhpcy5fcmF3W2NoYXJhLl9yaWRlX2FjdGlvbl1bY2hhcmEuYWN0aW9uX2ZyYW1lXS5kZWxheSk7Ly8/PyBfcmlkZV9hY3Rpb25fZnJhbWUgPT4gYWN0aW9uX2ZyYW1lXHJcblx0XHRpZiAoTnVtYmVyLmlzU2FmZUludGVnZXIoZCkpIHtcclxuXHRcdFx0cmV0dXJuIGQ7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gMTIwO1xyXG5cdH1cclxuXHJcblx0Z2V0IF9hbmltYXRpb25fdHlwZSgpIHtcclxuXHRcdHJldHVybiBcIl9yaWRlX2FjdGlvblwiO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3R5cGVvZiBDaGFyYWN0ZXJUYW1pbmdNb2JGcmFnbWVudH1cclxuXHQgKi9cclxuXHRnZXQgRnJhZ21lbnRDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBDaGFyYWN0ZXJUYW1pbmdNb2JGcmFnbWVudDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEByZXR1cm5zIHt0eXBlb2YgRnJhZ21lbnRUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdGdldCBGcmFnbWVudFRleHR1cmVDb25zdHJ1Y3RvcigpIHtcclxuXHRcdHJldHVybiBGcmFnbWVudFRleHR1cmU7XHJcblx0fVxyXG59XHJcblxyXG5cclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDAwMCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckJvZHk7XHRcdC8vXHRib2R5XHRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMDAxJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVySGVhZDtcdFx0Ly9cdGVsZkVhclx0XHRcdC0+IENoYXJhY3RlckhlYWRCYXNlIC0+IENoYXJhY3RlckhlYWRcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDAwMiddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckZhY2U7XHRcdC8vXHRGYWNlXHRcdFx0LT4gQ2hhcmFjdGVySGVhZEJhc2UgLT4gQ2hhcmFjdGVyRmFjZUJhc2UgLT4gQ2hhcmFjdGVyRmFjZVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMDAzJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVySGFpcjtcdFx0Ly9cdEhhaXJcdFx0XHQtPiBDaGFyYWN0ZXJIZWFkQmFzZSAtPiBDaGFyYWN0ZXJIYWlyXHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAwMDQnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJIYWlyO1x0XHQvL1x0SGFpclx0XHRcdC0+IENoYXJhY3RlckhlYWRCYXNlIC0+IENoYXJhY3RlckhhaXJcclxuXHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMDAnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcDtcdFx0Ly9cdENhcFx0XHRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTAxJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRmFjZUFjYztcdFx0Ly9cdGFjY2Vzc29yeUZhY2VcdC0+IENoYXJhY3RlckhlYWRCYXNlIC0+IENoYXJhY3RlckZhY2VCYXNlIC0+IENoYXJhY3RlckZhY2VBY2NcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwMiddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0YWNjZXNzb3J5RXllc1x0LT4gQ2hhcmFjdGVyRXF1aXBcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwMyddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0YWNjZXNzb3J5RWFyc1x0LT4gQ2hhcmFjdGVyRXF1aXBcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwNCddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0Q29hdFx0XHRcdC0+IENoYXJhY3RlckJvZHlcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwNSddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0TG9uZ2NvYXRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTA2J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRQYW50c1x0XHRcdC0+IENoYXJhY3RlckJvZHlcclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDEwNyddLkZyYWdtZW50VHlwZSA9IENoYXJhY3RlckVxdWlwO1x0XHQvL1x0U2hvZXNcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMDgnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcDtcdFx0Ly9cdEdsb3ZlXHRcdFx0LT4gQ2hhcmFjdGVyQm9keVxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTA5J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXA7XHRcdC8vXHRTaGllbGRcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcbkl0ZW1DYXRlZ29yeUluZm8uX2luZm9bJzAxMTAnXS5GcmFnbWVudFR5cGUgPSBDaGFyYWN0ZXJFcXVpcDtcdFx0Ly9cdENhcGVcdFx0XHQtPiBDaGFyYWN0ZXJCb2R5XHJcblxyXG5JdGVtQ2F0ZWdvcnlJbmZvLl9pbmZvWycwMTcwJ10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyRXF1aXBDYXNoV2VhcG9uO1x0Ly9cdGNhc2gtd2VhcG9uXHQtPiBDaGFyYWN0ZXJFcXVpcFxyXG5cclxuSXRlbUNhdGVnb3J5SW5mby5faW5mb1snMDE5J10uRnJhZ21lbnRUeXBlID0gQ2hhcmFjdGVyVGFtaW5nTW9iO1x0Ly9cdFRhbWluZ01vYlx0XHQtPiBDaGFyYWN0ZXJUYW1pbmdNb2JcclxuXHJcblxyXG5jbGFzcyBDaGFyYWN0ZXJTbG90cyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZVtdfSAqL1xyXG5cdFx0dGhpcy5fb3JkZXJlZF9zbG90ID0gW107XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVySGFpcn0gKi9cclxuXHRcdHRoaXMuaGFpciA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckhhaXJ9ICovXHJcblx0XHR0aGlzLl9oYWlyMiA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckhhaXJ9IDB+MS4wICovXHJcblx0XHR0aGlzLl9oYWlyTWl4MiA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckhhaXJ9ICovXHJcblx0XHR0aGlzLl9oYWlyMyA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckhhaXJ9IDB+MS4wICovXHJcblx0XHR0aGlzLl9oYWlyTWl4MyA9IG51bGw7XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXBCb2R5fSAqL1xyXG5cdFx0dGhpcy5ib2R5ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAqL1xyXG5cdFx0dGhpcy5oZWFkID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckZhY2V9ICovXHJcblx0XHR0aGlzLmZhY2UgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9ICovXHJcblx0XHR0aGlzLmhhaXIgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gMSAqL1xyXG5cdFx0dGhpcy5jYXAgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRmFjZX0gLSAyICovXHJcblx0XHR0aGlzLmFjY2Vzc29yeUZhY2UgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gMyovXHJcblx0XHR0aGlzLmFjY2Vzc29yeUV5ZXMgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gNCAqL1xyXG5cdFx0dGhpcy5hY2Nlc3NvcnlFYXJzID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDUgKi9cclxuXHRcdHRoaXMuY29hdCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSA1ICovXHJcblx0XHR0aGlzLmxvbmdjb2F0ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDYgKi9cclxuXHRcdHRoaXMucGFudHMgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gNyAqL1xyXG5cdFx0dGhpcy5zaG9lcyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSA4ICovXHJcblx0XHR0aGlzLmdsb3ZlID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckVxdWlwfSAtIDkgKi9cclxuXHRcdHRoaXMuY2FwZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJFcXVpcH0gLSAxMCAqL1xyXG5cdFx0dGhpcy5zaGllbGQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyRXF1aXB9IC0gMTEgKi9cclxuXHRcdHRoaXMud2VhcG9uID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJUYW1pbmdNb2J9ICovXHJcblx0XHR0aGlzLnRhbWluZ01vYiA9IG51bGw7XHJcblx0XHRcclxuXHRcdHtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX29yZGVyZWRfc2xvdFwiLCB7XHJcblx0XHRcdFx0Y29uZmlndXJhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdHdyaXRhYmxlOiB0cnVlLFxyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHZhbHVlOiBbXVxyXG5cdFx0XHR9KTtcclxuXHRcdFx0XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyXCIsIHtcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImhhaXJcIiwge1xyXG5cdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXHJcblx0XHRcdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy5faGFpcjtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHRcdHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcblx0XHRcdFx0XHR0aGlzLl9oYWlyID0gdmFsdWU7XHJcblx0XHRcdFx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX2hhaXIyICYmIHRoaXMuX2hhaXJNaXgyKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5oYWlyQ29sb3IyID0gdGhpcy5oYWlyQ29sb3IyOy8vZm9yY2UgcmVsb2FkXHJcblx0XHRcdFx0XHRcdFx0dGhpcy5oYWlyTWl4MiA9IHRoaXMuaGFpck1peDI7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0aWYgKHRoaXMuX2hhaXIzICYmIHRoaXMuX2hhaXJNaXgzKSB7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy5oYWlyQ29sb3IzID0gdGhpcy5oYWlyQ29sb3IzOy8vZm9yY2UgcmVsb2FkXHJcblx0XHRcdFx0XHRcdFx0dGhpcy5oYWlyTWl4MyA9IHRoaXMuaGFpck1peDM7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9LFxyXG5cdFx0XHR9KTtcclxuXHRcdFx0XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyXCIsIHtcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyMlwiLCB7XHJcblx0XHRcdFx0d3JpdGFibGU6IHRydWUsXHJcblx0XHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXHJcblx0XHRcdFx0dmFsdWU6IG51bGwsXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJfaGFpck1peDJcIiwge1x0Ly8gMH4xLjBcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9oYWlyM1wiLCB7XHJcblx0XHRcdFx0d3JpdGFibGU6IHRydWUsXHJcblx0XHRcdFx0ZW51bWVyYWJsZTogZmFsc2UsXHJcblx0XHRcdFx0dmFsdWU6IG51bGwsXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJfaGFpck1peDNcIiwge1x0Ly8gMH4xLjBcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0XHRlbnVtZXJhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogbnVsbCxcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRhc3luYyBfX2xvYWRDb2xvcmVkSGFpcihjb2xvcikge1xyXG5cdFx0Y29uc3QgaWQgPSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JIYWlySUQodGhpcy5oYWlyLmlkLCBjb2xvcik7XHJcblx0XHRjb25zdCBjYXRlSW5mbyA9IEl0ZW1DYXRlZ29yeUluZm8uZ2V0KGlkKTtcclxuXHJcblx0XHRpZiAoY2F0ZUluZm8pIHtcclxuXHRcdFx0Y29uc3QgdXJsID0gYC9DaGFyYWN0ZXIvJHtjYXRlSW5mby5wYXRoICsgKGNhdGVJbmZvLnBhdGggPyBcIi9cIiA6IFwiXCIpICsgaWR9YDtcclxuXHRcdFx0Y29uc3QgdXNlX2NhdGVnb3J5ID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdFx0bGV0IGhhaXIgPSBuZXcgQ2hhcmFjdGVySGFpcigpO1xyXG5cclxuXHRcdFx0YXdhaXQgaGFpci5sb2FkKHVybCwgaWQsIGNhdGVJbmZvLCB1c2VfY2F0ZWdvcnkpO1xyXG5cclxuXHRcdFx0cmV0dXJuIGhhaXI7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gKi9cclxuXHRnZXQgaGFpckNvbG9yMigpIHtcclxuXHRcdGlmICh0aGlzLl9oYWlyMikge1xyXG5cdFx0XHRyZXR1cm4gTnVtYmVyKENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRIYWlyQ29sb3IodGhpcy5faGFpcjIuaWQpKTtcclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGhhaXJDb2xvcjIoY29sb3IpIHtcclxuXHRcdGlmICghY29sb3IpIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihuZXcgVHlwZUVycm9yKCkpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRsZXQgaGMySWQgPSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JIYWlySUQodGhpcy5oYWlyLmlkLCBjb2xvcik7XHJcblxyXG5cdFx0aWYgKCF0aGlzLl9oYWlyMiB8fCBoYzJJZCAhPSB0aGlzLl9oYWlyMi5pZCkge1xyXG5cdFx0XHRpZiAoaGMySWQgPT0gdGhpcy5faGFpci5pZCkge1xyXG5cdFx0XHRcdHRoaXMuX2hhaXIyID0gbnVsbDtcclxuXHRcdFx0XHR0aGlzLmhhaXJNaXgyID0gMDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmhhaXIuJHByb21pc2VfaGFpcjIgPSB0aGlzLl9fbG9hZENvbG9yZWRIYWlyKGNvbG9yKTtcclxuXHJcblx0XHRcdFx0dGhpcy5oYWlyLiRwcm9taXNlX2hhaXIyLnRoZW4oaGFpcjIgPT4ge1xyXG5cdFx0XHRcdFx0ZGVsZXRlIHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMjtcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9oYWlyMiA9IGhhaXIyO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuX2hhaXIyICYmIHRoaXMuaGFpck1peDIgIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmhhaXJNaXgyID0gdGhpcy5oYWlyTWl4MjsvL2ZvcmNlIHVwZGF0ZVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly9lbHNlIHtcclxuXHRcdFx0XHRcdC8vXHR0aGlzLmhhaXJNaXgyID0gMDsvL2Rpc2FibGVcclxuXHRcdFx0XHRcdC8vfVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKiBAcmV0dXJucyB7bnVtYmVyfSAwfjEuMCAqL1xyXG5cdGdldCBoYWlyTWl4MigpIHtcclxuXHRcdHJldHVybiB0aGlzLl9oYWlyTWl4MjtcclxuXHR9XHJcblx0c2V0IGhhaXJNaXgyKHZhbHVlKSB7XHJcblx0XHR2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XHJcblxyXG5cdFx0UHJvbWlzZS5yZXNvbHZlKHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMikudGhlbigoKSA9PiB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBpdGVtID0gdGhpcy5faGFpcjI7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBiYXNlID0gdGhpcy5oYWlyO1xyXG5cclxuXHRcdFx0aWYgKCFpdGVtIHx8ICFiYXNlKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmb3IgKGxldCBqIGluIGl0ZW0uZnJhZ21lbnRzKSB7XHJcblx0XHRcdFx0Zm9yIChsZXQgayBpbiBpdGVtLmZyYWdtZW50c1tqXS50ZXh0dXJlcykge1xyXG5cdFx0XHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtLmZyYWdtZW50c1tqXS50ZXh0dXJlc1trXS5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdFx0bGV0IGZ0ID0gaXRlbS5mcmFnbWVudHNbal0udGV4dHVyZXNba11baV07XHJcblx0XHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0XHRsZXQgb3JpID0gYmFzZS5mcmFnbWVudHNbal0udGV4dHVyZXNba11baV07XHJcblx0XHRcdFx0XHRcdGlmIChvcmkpIHtcclxuXHRcdFx0XHRcdFx0XHRvcmkuZ3JhcGgyID0gZnQ7XHJcblx0XHRcdFx0XHRcdFx0b3JpLmdyYXBoMi5vcGFjaXR5ID0gdmFsdWU7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5faGFpck1peDIgPSB2YWx1ZTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtudW1iZXJ9IDB+MS4wICovXHJcblx0Z2V0IGhhaXJDb2xvcjMoKSB7XHJcblx0XHRpZiAodGhpcy5faGFpcjMpIHtcclxuXHRcdFx0cmV0dXJuIE51bWJlcihDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0SGFpckNvbG9yKHRoaXMuX2hhaXIzLmlkKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBoYWlyQ29sb3IzKGNvbG9yKSB7XHJcblx0XHRpZiAoIWNvbG9yKSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IobmV3IFR5cGVFcnJvcigpKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGhjM0lkID0gQ2hhcmFjdGVyUmVuZGVyQ29uZmlnLmdldENvbG9ySGFpcklEKHRoaXMuaGFpci5pZCwgY29sb3IpO1xyXG5cclxuXHRcdGlmICghdGhpcy5faGFpcjMgfHwgdGhpcy5faGFpcjMuaWQgIT0gaGMzSWQpIHtcclxuXHRcdFx0aWYgKHRoaXMuX2hhaXIuaWQgPT0gaGMzSWQgfHwgdGhpcy5faGFpcjIuaWQgPT0gaGMzSWQpIHtcclxuXHRcdFx0XHR0aGlzLl9oYWlyMyA9IG51bGw7XHJcblx0XHRcdFx0dGhpcy5oYWlyTWl4MyA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5oYWlyLiRwcm9taXNlX2hhaXIzID0gdGhpcy5fX2xvYWRDb2xvcmVkSGFpcihjb2xvcik7XHJcblxyXG5cdFx0XHRcdHRoaXMuaGFpci4kcHJvbWlzZV9oYWlyMy50aGVuKGhhaXIzID0+IHtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLmhhaXIuJHByb21pc2VfaGFpcjM7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5faGFpcjMgPSBoYWlyMztcclxuXHRcdFx0XHRcdGlmICh0aGlzLl9oYWlyMyAmJiB0aGlzLmhhaXJNaXgzICE9IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5oYWlyTWl4MyA9IHRoaXMuaGFpck1peDM7Ly9mb3JjZSB1cGRhdGVcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdC8vZWxzZSB7XHJcblx0XHRcdFx0XHQvL1x0dGhpcy5oYWlyTWl4MyA9IDA7Ly9kaXNhYmxlXHJcblx0XHRcdFx0XHQvL31cclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gKi9cclxuXHRnZXQgaGFpck1peDMoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faGFpck1peDM7XHJcblx0fVxyXG5cdHNldCBoYWlyTWl4Myh2YWx1ZSkge1xyXG5cdFx0dmFsdWUgPSBOdW1iZXIodmFsdWUpO1xyXG5cclxuXHRcdFByb21pc2UucmVzb2x2ZSh0aGlzLmhhaXIuJHByb21pc2VfaGFpcjMpLnRoZW4oKCkgPT4ge1xyXG5cdFx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSAqL1xyXG5cdFx0XHRsZXQgaXRlbSA9IHRoaXMuX2hhaXIzO1xyXG5cdFx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSAqL1xyXG5cdFx0XHRsZXQgYmFzZSA9IHRoaXMuaGFpcjtcclxuXHJcblx0XHRcdGlmICghaXRlbSB8fCAhYmFzZSkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Zm9yIChsZXQgaiBpbiBpdGVtLmZyYWdtZW50cykge1xyXG5cdFx0XHRcdGZvciAobGV0IGsgaW4gaXRlbS5mcmFnbWVudHNbal0udGV4dHVyZXMpIHtcclxuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5mcmFnbWVudHNbal0udGV4dHVyZXNba10ubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0XHRcdGxldCBmdCA9IGl0ZW0uZnJhZ21lbnRzW2pdLnRleHR1cmVzW2tdW2ldO1xyXG5cdFx0XHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRcdFx0bGV0IG9yaSA9IGJhc2UuZnJhZ21lbnRzW2pdLnRleHR1cmVzW2tdW2ldO1xyXG5cdFx0XHRcdFx0XHRpZiAob3JpKSB7XHJcblx0XHRcdFx0XHRcdFx0b3JpLmdyYXBoMyA9IGZ0O1xyXG5cdFx0XHRcdFx0XHRcdG9yaS5ncmFwaDMub3BhY2l0eSA9IHZhbHVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMuX2hhaXJNaXgzID0gdmFsdWU7XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8vX19vcmRlcl9zbG90KCkge1xyXG5cdC8vXHRsZXQgc2xvdF9tYXAgPSBuZXcgTWFwKCk7XHJcblx0Ly9cclxuXHQvL1x0Zm9yIChsZXQgaSBpbiB0aGlzKSB7XHJcblx0Ly9cdFx0bGV0IGVxdWlwID0gdGhpc1tpXTtcclxuXHQvL1xyXG5cdC8vXHRcdGVxdWlwLmNzXHJcblx0Ly9cdH1cclxuXHQvL31cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gbG9hZGVkRXF1aXBcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdXNlX2NhdGVnb3J5IC0gY2F0ZWdvcnkgd2hpY2ggdXNlZCBvZiBjYXNoLXdlYXBvblxyXG5cdCAqL1xyXG5cdGFzeW5jIF91c2UoaWQsIGxvYWRlZEVxdWlwLCB1c2VfY2F0ZWdvcnkpIHtcclxuXHRcdGlmICghaWQpIHtcclxuXHRcdFx0ZGVidWdnZXJcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgY2F0ZUluZm8gPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldChpZCk7XHJcblxyXG5cdFx0aWYgKGNhdGVJbmZvKSB7XHJcblx0XHRcdGxldCB1cmwgPSBgL0NoYXJhY3Rlci8ke2NhdGVJbmZvLnBhdGggKyAoY2F0ZUluZm8ucGF0aCA/IFwiL1wiOlwiXCIpICsgaWR9YDtcclxuXHRcdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gKi9cclxuXHRcdFx0bGV0IGl0ZW07XHJcblxyXG5cdFx0XHRpZiAobG9hZGVkRXF1aXAgaW5zdGFuY2VvZiBDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZSkge1xyXG5cdFx0XHRcdGFsZXJ0KFwiQ2hhcmFjdGVyU2xvdHMgIyBfdXNlOiBwYXJhbSBsb2FkZWRFcXVpcCA/P1wiKTtcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHRpdGVtID0gbG9hZGVkRXF1aXA7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0aWYgKGxvYWRlZEVxdWlwKSB7XHJcblx0XHRcdFx0XHRhbGVydChcIkNoYXJhY3RlclNsb3RzICMgX3VzZTogcGFyYW0gbG9hZGVkRXF1aXAgPz9cIik7XHJcblx0XHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y29uc3QgZnJhZ21lbnRUeXBlID0gY2F0ZUluZm8uRnJhZ21lbnRUeXBlIHx8IENoYXJhY3RlckVxdWlwO1xyXG5cclxuXHRcdFx0XHRpdGVtID0gbmV3IGZyYWdtZW50VHlwZSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdC8qKiBfdXNlX2xvYWRlZF9lcXVpcCAqL1xyXG5cdFx0XHRpZiAoMCkge1xyXG5cdFx0XHRcdGlmICh0aGlzW2NhdGVJbmZvLnNsb3RdKSB7XHJcblx0XHRcdFx0XHR0aGlzW2NhdGVJbmZvLnNsb3RdLl91bmxvYWQoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0dGhpc1tjYXRlSW5mby5zbG90XSA9IGl0ZW07XHJcblxyXG5cdFx0XHRcdHRoaXMuX29yZGVyZWRfc2xvdFtpdGVtLnNsb3Rfb3JkZXJdID0gaXRlbTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0bGV0IGlzX2V4aXN0ID0gbG9hZGVkRXF1aXAgfHwgYXdhaXQgaXRlbS5sb2FkKHVybCwgaWQsIGNhdGVJbmZvLCB1c2VfY2F0ZWdvcnkpO1xyXG5cdFx0XHRpZiAoaXNfZXhpc3QpIHtcclxuXHRcdFx0XHQvKiogX3VzZV9sb2FkZWRfZXF1aXAgKi9cclxuXHRcdFx0XHRpZiAoMSkge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXNbY2F0ZUluZm8uc2xvdF0pIHtcclxuXHRcdFx0XHRcdFx0dGhpc1tjYXRlSW5mby5zbG90XS5fdW5sb2FkKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzW2NhdGVJbmZvLnNsb3RdID0gaXRlbTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLl9vcmRlcmVkX3Nsb3RbaXRlbS5zbG90X29yZGVyXSA9IGl0ZW07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIml0ZW0oXCIgKyBpZCArIFwiKSBpcyBub3QgZXhpc3RcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0X3VudXNlKGlkKSB7XHJcblx0XHRpZiAoIWlkKSB7XHJcblx0XHRcdGRlYnVnZ2VyXHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGxldCBjYXRlSW5mbywgZXF1aXA7XHJcblxyXG5cdFx0aWYgKGlkIGluc3RhbmNlb2YgQ2hhcmFjdGVyQXBwZWFyYW5jZUJhc2UpIHtcclxuXHRcdFx0ZXF1aXAgPSBpZDtcclxuXHRcdFx0aWQgPSBlcXVpcC5pZDtcclxuXHRcdFx0Y2F0ZUluZm8gPSBlcXVpcC5jYXRlZ29yeUluZm87XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y2F0ZUluZm8gPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldChpZCk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGNvbnN0IHNsb3ROYW1lID0gY2F0ZUluZm8uc2xvdDtcclxuXHJcblx0XHRpZiAoc2xvdE5hbWUgIT0gXCJoZWFkXCIgJiYgc2xvdE5hbWUgIT0gXCJib2R5XCIpIHtcclxuXHRcdFx0aWYgKHRoaXNbc2xvdE5hbWVdICYmIHRoaXNbc2xvdE5hbWVdLmlkID09IGlkKSB7XHJcblx0XHRcdFx0ZXF1aXAgPSB0aGlzW3Nsb3ROYW1lXTtcclxuXHRcdFx0XHRmb3IgKGxldCBzbG90IGluIGVxdWlwLmlzbG90KSB7XHJcblx0XHRcdFx0XHRsZXQgb3JkZXIgPSBlcXVpcC5pc2xvdFtzbG90XTtcclxuXHRcdFx0XHRcdGlmICh0aGlzLl9vcmRlcmVkX3Nsb3Rbb3JkZXJdKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuX29yZGVyZWRfc2xvdFtvcmRlcl0uX3VubG9hZCgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZGVsZXRlIHRoaXMuX29yZGVyZWRfc2xvdFtvcmRlcl07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXNbc2xvdE5hbWVdID0gbnVsbDtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHRfY2xlYXIoKSB7XHJcblx0XHQvL3RoaXMuYm9keSA9IG51bGw7XHJcblx0XHQvL3RoaXMuaGVhZCA9IG51bGw7XHJcblx0XHR0aGlzLmZhY2UgPSBudWxsO1xyXG5cdFx0dGhpcy5oYWlyID0gbnVsbDtcclxuXHRcdHRoaXMuY2FwID0gbnVsbDtcclxuXHRcdHRoaXMuYWNjZXNzb3J5RmFjZSA9IG51bGw7XHJcblx0XHR0aGlzLmFjY2Vzc29yeUV5ZXMgPSBudWxsO1xyXG5cdFx0dGhpcy5hY2Nlc3NvcnlFYXJzID0gbnVsbDtcclxuXHRcdHRoaXMuY29hdCA9IG51bGw7XHJcblx0XHR0aGlzLmxvbmdjb2F0ID0gbnVsbDtcclxuXHRcdHRoaXMucGFudHMgPSBudWxsO1xyXG5cdFx0dGhpcy5zaG9lcyA9IG51bGw7XHJcblx0XHR0aGlzLmdsb3ZlID0gbnVsbDtcclxuXHRcdHRoaXMuY2FwZSA9IG51bGw7XHJcblx0XHR0aGlzLnNoaWVsZCA9IG51bGw7XHJcblxyXG5cdFx0Ly90ZW1wXHJcblx0XHRsZXQgaGVhZCA9IHRoaXMuaGVhZDtcclxuXHRcdGxldCBib2R5ID0gdGhpcy5ib2R5O1xyXG5cclxuXHRcdC8vY2xlYXJcclxuXHRcdHRoaXMuX29yZGVyZWRfc2xvdCA9IFtdO1xyXG5cclxuXHRcdC8vcmVzdG9yZVxyXG5cdFx0aWYgKGhlYWQpIHtcclxuXHRcdFx0dGhpcy5fb3JkZXJlZF9zbG90W2hlYWQuc2xvdF9vcmRlcl0gPSBoZWFkO1xyXG5cdFx0fVxyXG5cdFx0aWYgKGJvZHkpIHtcclxuXHRcdFx0dGhpcy5fb3JkZXJlZF9zbG90W2JvZHkuc2xvdF9vcmRlcl0gPSBib2R5O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0X3N0cmluZ2lmeSgpIHtcclxuXHRcdGxldCBzbG90cyA9IFtcImNcIl07XHJcblx0XHRcdFxyXG5cdFx0aWYgKHRoaXMuYm9keSkgc2xvdHMucHVzaCh0aGlzLmJvZHkuaWQpO1xyXG5cdFx0aWYgKHRoaXMuaGVhZCkgc2xvdHMucHVzaCh0aGlzLmhlYWQuaWQpO1xyXG5cdFx0aWYgKHRoaXMuZmFjZSkgc2xvdHMucHVzaCh0aGlzLmZhY2UuaWQgKyBcInxcIiArIHRoaXMuZmFjZS5pZCk7XHJcblx0XHRpZiAodGhpcy5oYWlyKSB7XHJcblx0XHRcdGxldCBoYSA9IFtdO1xyXG5cdFx0XHRoYS5wdXNoKHRoaXMuaGFpci5pZCk7XHJcblx0XHRcdGlmICh0aGlzLmhhaXJDb2xvcjIgJiYgdGhpcy5oYWlyTWl4MiA+IDApIGhhLnB1c2godGhpcy5oYWlyQ29sb3IyICsgXCIlXCIgKyBNYXRoLnRydW5jKHRoaXMuaGFpck1peDIgKiAxMDApKTtcclxuXHRcdFx0aWYgKHRoaXMuaGFpckNvbG9yMyAmJiB0aGlzLmhhaXJNaXgzID4gMCkgaGEucHVzaCh0aGlzLmhhaXJDb2xvcjMgKyBcIiVcIiArIE1hdGgudHJ1bmModGhpcy5oYWlyTWl4MyAqIDEwMCkpO1xyXG5cdFx0XHRzbG90cy5wdXNoKGhhLmpvaW4oXCJ8XCIpKTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmNhcCkgc2xvdHMucHVzaCh0aGlzLmNhcC5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlGYWNlKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RmFjZS5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFeWVzKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RXllcy5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFYXJzKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RWFycy5pZCk7XHJcblx0XHRpZiAodGhpcy5jb2F0KSBzbG90cy5wdXNoKHRoaXMuY29hdC5pZCk7XHJcblx0XHRpZiAodGhpcy5sb25nY29hdCkgc2xvdHMucHVzaCh0aGlzLmxvbmdjb2F0LmlkKTtcclxuXHRcdGlmICh0aGlzLnBhbnRzKSBzbG90cy5wdXNoKHRoaXMucGFudHMuaWQpO1xyXG5cdFx0aWYgKHRoaXMuc2hvZXMpIHNsb3RzLnB1c2godGhpcy5zaG9lcy5pZCk7XHJcblx0XHRpZiAodGhpcy5nbG92ZSkgc2xvdHMucHVzaCh0aGlzLmdsb3ZlLmlkKTtcclxuXHRcdGlmICh0aGlzLnNoaWVsZCkgc2xvdHMucHVzaCh0aGlzLnNoaWVsZC5pZCk7XHJcblx0XHRpZiAodGhpcy5jYXBlKSBzbG90cy5wdXNoKHRoaXMuY2FwZS5pZCk7XHJcblx0XHRpZiAodGhpcy53ZWFwb24pIHNsb3RzLnB1c2godGhpcy53ZWFwb24uaWQpO1xyXG5cclxuXHRcdHJldHVybiBzbG90cy5qb2luKFwiLFwiKTtcclxuXHR9XHJcblxyXG5cdHRvSlNPTigpIHtcclxuXHRcdGxldCBzbG90cyA9IFtdO1xyXG5cclxuXHRcdGlmICh0aGlzLmJvZHkpIHNsb3RzLnB1c2godGhpcy5ib2R5LmlkKTtcclxuXHRcdGlmICh0aGlzLmhlYWQpIHNsb3RzLnB1c2godGhpcy5oZWFkLmlkKTtcclxuXHRcdGlmICh0aGlzLmZhY2UpIHNsb3RzLnB1c2godGhpcy5mYWNlLmlkKTtcclxuXHRcdGlmICh0aGlzLmhhaXIpIHNsb3RzLnB1c2godGhpcy5oYWlyLmlkKTtcclxuXHRcdGlmICh0aGlzLmNhcCkgc2xvdHMucHVzaCh0aGlzLmNhcC5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlGYWNlKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RmFjZS5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFeWVzKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RXllcy5pZCk7XHJcblx0XHRpZiAodGhpcy5hY2Nlc3NvcnlFYXJzKSBzbG90cy5wdXNoKHRoaXMuYWNjZXNzb3J5RWFycy5pZCk7XHJcblx0XHRpZiAodGhpcy5jb2F0KSBzbG90cy5wdXNoKHRoaXMuY29hdC5pZCk7XHJcblx0XHRpZiAodGhpcy5sb25nY29hdCkgc2xvdHMucHVzaCh0aGlzLmxvbmdjb2F0LmlkKTtcclxuXHRcdGlmICh0aGlzLnBhbnRzKSBzbG90cy5wdXNoKHRoaXMucGFudHMuaWQpO1xyXG5cdFx0aWYgKHRoaXMuc2hvZXMpIHNsb3RzLnB1c2godGhpcy5zaG9lcy5pZCk7XHJcblx0XHRpZiAodGhpcy5nbG92ZSkgc2xvdHMucHVzaCh0aGlzLmdsb3ZlLmlkKTtcclxuXHRcdGlmICh0aGlzLnNoaWVsZCkgc2xvdHMucHVzaCh0aGlzLnNoaWVsZC5pZCk7XHJcblx0XHRpZiAodGhpcy5jYXBlKSBzbG90cy5wdXNoKHRoaXMuY2FwZS5pZCk7XHJcblx0XHRpZiAodGhpcy53ZWFwb24pIHNsb3RzLnB1c2godGhpcy53ZWFwb24uaWQpO1xyXG5cclxuXHRcdHJldHVybiBzbG90cztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHJldHVybnM6IFtmYWNlLCBoYWlyLCBjYXAsIC4uLiwgd2VhcG9uXVxyXG5cdCAqL1xyXG5cdCplbnVtZXJhdGUoKSB7XHJcblx0XHRpZiAodGhpcy5mYWNlKSB5aWVsZCB0aGlzLmZhY2U7XHJcblx0XHRpZiAodGhpcy5oYWlyKSB5aWVsZCB0aGlzLmhhaXI7XHJcblxyXG5cdFx0eWllbGQqIHRoaXMuZW51bWVyYXRlX2VxdWlwKCk7XHJcblx0fVxyXG5cdCplbnVtZXJhdGVfZXF1aXAoKSB7XHJcblx0XHRpZiAodGhpcy5jYXApIHlpZWxkIHRoaXMuY2FwO1xyXG5cdFx0aWYgKHRoaXMuYWNjZXNzb3J5RmFjZSkgeWllbGQgdGhpcy5hY2Nlc3NvcnlGYWNlO1xyXG5cdFx0aWYgKHRoaXMuYWNjZXNzb3J5RXllcykgeWllbGQgdGhpcy5hY2Nlc3NvcnlFeWVzO1xyXG5cdFx0aWYgKHRoaXMuYWNjZXNzb3J5RWFycykgeWllbGQgdGhpcy5hY2Nlc3NvcnlFYXJzO1xyXG5cdFx0aWYgKHRoaXMuY29hdCkgeWllbGQgdGhpcy5jb2F0O1xyXG5cdFx0aWYgKHRoaXMubG9uZ2NvYXQpIHlpZWxkIHRoaXMubG9uZ2NvYXQ7XHJcblx0XHRpZiAodGhpcy5wYW50cykgeWllbGQgdGhpcy5wYW50cztcclxuXHRcdGlmICh0aGlzLnNob2VzKSB5aWVsZCB0aGlzLnNob2VzO1xyXG5cdFx0aWYgKHRoaXMuZ2xvdmUpIHlpZWxkIHRoaXMuZ2xvdmU7XHJcblx0XHRpZiAodGhpcy5zaGllbGQpIHlpZWxkIHRoaXMuc2hpZWxkO1xyXG5cdFx0aWYgKHRoaXMuY2FwZSkgeWllbGQgdGhpcy5jYXBlO1xyXG5cdFx0aWYgKHRoaXMud2VhcG9uKSB5aWVsZCB0aGlzLndlYXBvbjtcclxuXHR9XHJcblx0KmVudW1lcmF0ZV9mYWNlKCkge1xyXG5cdFx0aWYgKHRoaXMuZmFjZSkgeWllbGQgdGhpcy5mYWNlO1xyXG5cdFx0aWYgKHRoaXMuYWNjZXNzb3J5RmFjZSkgeWllbGQgdGhpcy5hY2Nlc3NvcnlGYWNlO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyQ2hhbmdlTG9nIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7XCJodW1hblwifFwiZWxmXCJ8XCJsZWZcInxcImhpZ2hsZWZcIn0gKi9cclxuXHRcdHRoaXMuZWFyID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nW119ICovXHJcblx0XHR0aGlzLnVzZUVxdWlwID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmdbXX0gKi9cclxuXHRcdHRoaXMudW51c2VFcXVpcCA9IFtdO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBoYWlyMiBpZCAqL1xyXG5cdFx0dGhpcy5oYWlyMiA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuaGFpck1peDIgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0Ly8vKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdC8vdGhpcy5oYWlyMyA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0Ly90aGlzLmhhaXJNaXgzID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSB3ZWFwb24gPT4gZXF1aXAgaWQgKi9cclxuXHRcdHRoaXMud2VhcG9uID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy53ZWFwb25UeXBlID0gdW5kZWZpbmVkO1xyXG5cdH1cclxuXHJcblx0Y2xlYXIoKSB7XHJcblx0XHR0aGlzLmVhciA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMudXNlRXF1aXAgPSBbXTtcclxuXHRcdHRoaXMudW51c2VFcXVpcCA9IFtdO1xyXG5cdFx0dGhpcy5oYWlyMiA9IHVuZGVmaW5lZDtcclxuXHRcdHRoaXMuaGFpck1peDIgPSB1bmRlZmluZWQ7XHJcblx0XHQvL3RoaXMuaGFpcjMgPSB1bmRlZmluZWQ7XHJcblx0XHQvL3RoaXMuaGFpck1peDMgPSB1bmRlZmluZWQ7XHJcblx0XHR0aGlzLndlYXBvblR5cGUgPSB1bmRlZmluZWQ7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hhcmFjdGVyQW5pbWF0aW9uQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHR0aGlzLl8kZGlydHkgPSAwOy8vZm9yY2UgdXBkYXRlIHZ1ZVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIOacquWujOaIkCAqL1xyXG5cdFx0dGhpcy5qb2IgPSBudWxsO1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9IC0g5pyq5a6M5oiQICovXHJcblx0XHR0aGlzLnN1YkpvYiA9IG51bGw7XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7QWN0aW9uQW5pbWF0aW9ufSAqL1xyXG5cdFx0dGhpcy5hY3RhbmkgPSBuZXcgQWN0aW9uQW5pbWF0aW9uKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gYW5pbWF0aW9uIHNwZWVkIHJhdGUgKi9cclxuXHRcdHRoaXMuc3BlZWQgPSAxO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuZml4ZWRfc3BlZWQgPSBmYWxzZTtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59IC0gcGF1c2UgYW5pbWF0aW9uICovXHJcblx0XHR0aGlzLnBhdXNlID0gZmFsc2U7XHJcblxyXG5cclxuXHRcdHRoaXMuaGlkZUJvZHkgPSBmYWxzZTtcclxuXHJcblx0XHR0aGlzLl9yaWRlX2FjdGlvbiA9IFwic3RhbmQxXCI7XHJcblx0XHRcclxuXHRcdHRoaXMuX2FjdGlvbiA9IFwic3RhbmQxXCI7XHJcblx0XHR0aGlzLl9hY3Rpb25fZnJhbWUgPSAwO1xyXG5cclxuXHRcdHRoaXMuX2Vtb3Rpb24gPSBcImJsaW5rXCI7XHJcblx0XHR0aGlzLl9lbW90aW9uX2ZyYW1lID0gMDtcclxuXHRcdHRoaXMuX2Vtb3Rpb25fdGltZSA9IDA7XHJcblx0XHR0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlID0gWzAsIDEsIDIsIDFdO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyU2xvdHN9ICovXHJcblx0XHR0aGlzLnNsb3RzID0gbmV3IENoYXJhY3RlclNsb3RzKCk7XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBpcyByZXF1aXJlIHVwZGF0ZSByZW5kZXIgZGF0YVxyXG5cdFx0ICogQHR5cGUge2Jvb2xlYW59XHJcblx0XHQgKi9cclxuXHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSA9IHRydWU7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmVbXX0gKi9cclxuXHRcdHRoaXMuX19mcmFnX2xpc3QgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckNoYW5nZUxvZ30gKiovXHJcblx0XHR0aGlzLiQkY2hhbmdlTG9nID0gbmV3IENoYXJhY3RlckNoYW5nZUxvZygpO1xyXG5cdH1cclxuXHJcblx0X2Nsb25lKCkge1xyXG5cdFx0YWxlcnQodGhpcy5jb25zdHJ1Y3Rvci5uYW1lICsgXCI6Ol9jbG9uZVwiKTtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9ICovXHJcblx0XHRsZXQgbmMgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpOy8vbm90IG11c3QgQ2hhcmFjdGVyUmVuZGVyXHJcblx0XHRpZiAoIW5jKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0bmMuc3BlZWQgPSAwO1xyXG5cclxuXHRcdG5jLnggPSB0aGlzLng7XHJcblx0XHRuYy55ID0gdGhpcy55O1xyXG5cdFx0bmMuYW5nbGUgPSB0aGlzLmFuZ2xlO1xyXG5cclxuXHRcdG5jLmFjdGlvbiA9IHRoaXMuYWN0aW9uO1xyXG5cdFx0bmMuYWN0aW9uX2ZyYW1lID0gdGhpcy5hY3Rpb25fZnJhbWU7XHJcblxyXG5cdFx0bmMuZW1vdGlvbiA9IHRoaXMuX2Vtb3Rpb247XHJcblx0XHRuYy5lbW90aW9uX2ZyYW1lID0gdGhpcy5lbW90aW9uX2ZyYW1lO1xyXG5cclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5zbG90cykge1xyXG5cdFx0XHRsZXQgaXRlbSA9IHRoaXMuc2xvdHNbaV07XHJcblx0XHRcdGlmIChpdGVtKSB7XHJcblx0XHRcdFx0bmMuc2xvdHNbaV0gPSB0aGlzLnNsb3RzW2ldOy8vbm90IG5lZWQgY29sbmUgP1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbmM7XHJcblx0fVxyXG5cdFx0XHJcblx0X3dhaXRGcmFtZVRleHR1cmVzTG9hZGVkKCkge1xyXG5cdFx0bGV0IHRhc2tzID0gW107XHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuc2xvdHMpIHtcclxuXHRcdFx0LyoqIEB0eXBlIHtDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZX0gKi9cclxuXHRcdFx0bGV0IGl0ZW0gPSB0aGlzLnNsb3RzW2ldO1xyXG5cdFx0XHRpZiAoaXRlbSkge1xyXG5cdFx0XHRcdGZvciAobGV0IGogaW4gaXRlbS5mcmFnbWVudHMpIHtcclxuXHRcdFx0XHRcdGxldCBmcmFnID0gaXRlbS5mcmFnbWVudHNbal07XHJcblx0XHRcdFx0XHRsZXQgY291bnQgPSBmcmFnLmdldEZyYW1lQ291bnQodGhpcyk7XHJcblx0XHRcdFx0XHRmb3IgKGxldCBrID0gMDsgayA8IGNvdW50OyArK2spIHtcclxuXHRcdFx0XHRcdFx0bGV0IGZ0ID0gZnJhZy5nZXRGcmFtZVRleHR1cmUodGhpcywgayk7XHJcblx0XHRcdFx0XHRcdGlmIChmdCAmJiAhZnQuX2lzTG9hZGVkX29yX2RvbG9hZCgpKSB7XHJcblx0XHRcdFx0XHRcdFx0dGFza3MucHVzaChmdC4kcHJvbWlzZSk7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBpbml0IGFuaW1hdGlvbiBzdGF0dXNcclxuXHQgKi9cclxuXHRpbml0QW5pbWF0aW9uKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmFjdGlvbiA9IFwic3RhbmQxXCI7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLl9hY3Rpb25fZnJhbWUgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5lbW90aW9uID0gXCJibGlua1wiO1xyXG5cdFx0XHRcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuX2Vtb3Rpb25fZnJhbWUgPSAwO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gMH4xICovXHJcblx0Z2V0U3BlZWQoKSB7XHJcblx0XHRpZiAodGhpcy5wYXVzZSkge1xyXG5cdFx0XHRyZXR1cm4gMDtcclxuXHRcdH1cclxuXHRcdHJldHVybiB0aGlzLmZpeGVkX3NwZWVkID8gMSA6IHRoaXMuc3BlZWQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdHlwZSB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRnZXQgZWxmRWFyKCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zbG90cy5oZWFkLmVsZkVhcjtcclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGVsZkVhcih2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHR0aGlzLnNsb3RzLmhlYWQuZWxmRWFyID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdHlwZSB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRnZXQgbGVmRWFyKCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5zbG90cy5oZWFkLmxlZkVhcjtcclxuXHRcdH1cclxuXHR9XHJcblx0c2V0IGxlZkVhcih2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHR0aGlzLnNsb3RzLmhlYWQubGVmRWFyID0gdmFsdWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdHlwZSB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRnZXQgaGlnaGxlZkVhcigpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuc2xvdHMuaGVhZC5oaWdobGVmRWFyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRzZXQgaGlnaGxlZkVhcih2YWx1ZSkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMuaGVhZCkge1xyXG5cdFx0XHR0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhciA9IHZhbHVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqIEByZXR1cm5zIHtcImh1bWFuXCJ8XCJlbGZcInxcImxlZlwifFwiaGlnaGxlZlwifSAqL1xyXG5cdGdldCBlYXIoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5oZWFkKSB7XHJcblx0XHRcdHJldHVybiB0aGlzLnNsb3RzLmhlYWQubGVmRWFyID8gXCJsZWZcIiA6ICh0aGlzLnNsb3RzLmhlYWQuZWxmRWFyID8gXCJlbGZcIiA6ICh0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhciA/IFwiaGlnaGxlZlwiIDogXCJodW1hblwiKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHNldCBlYXIodmFsdWUpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQpIHtcclxuXHRcdFx0aWYgKHZhbHVlID09IFwiZWxmXCIpIHtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQuZWxmRWFyID0gdHJ1ZTtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQubGVmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmhpZ2hsZWZFYXIgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLmVhciA9IHZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHZhbHVlID09IFwibGVmXCIpIHtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQubGVmRWFyID0gdHJ1ZTtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQuZWxmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmhpZ2hsZWZFYXIgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLmVhciA9IHZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKHZhbHVlID09IFwiaGlnaGxlZlwiKSB7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmVsZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5sZWZFYXIgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQuaGlnaGxlZkVhciA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5lYXIgPSB2YWx1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnNsb3RzLmhlYWQuZWxmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy5zbG90cy5oZWFkLmxlZkVhciA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc2xvdHMuaGVhZC5oaWdobGVmRWFyID0gZmFsc2U7XHJcblx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5lYXIgPSBcImh1bWFuXCI7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLiQkY2hhbmdlTG9nLmVhciA9IHVuZGVmaW5lZDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdGdldCBhY3Rpb24oKSB7XHJcblx0XHQvL2lmICh0aGlzLnNsb3RzLnRhbWluZ01vYikge1xyXG5cdFx0Ly9cdGNvbnN0IGFjdG1hcCA9IHRoaXMuc2xvdHMudGFtaW5nTW9iLmFjdGlvbk1hcDtcclxuXHRcdC8vXHRpZiAoYWN0bWFwKSB7XHJcblx0XHQvL1x0XHRyZXR1cm4gYWN0bWFwW3RoaXMuX2FjdGlvbl07XHJcblx0XHQvL1x0fVxyXG5cdFx0Ly9cdHJldHVybiBcInNpdFwiOy8vZGVmYXVsdFxyXG5cdFx0Ly99XHJcblx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uO1xyXG5cdH1cclxuXHRzZXQgYWN0aW9uKGFjdCkge1xyXG5cdFx0aWYgKHRoaXMuc2xvdHMudGFtaW5nTW9iKSB7XHJcblx0XHRcdGxldCBfYWN0O1xyXG5cclxuXHRcdFx0dGhpcy5fcmlkZV9hY3Rpb24gPSBhY3Q7XHJcblxyXG5cdFx0XHRpZiAodGhpcy5zbG90cy50YW1pbmdNb2IuYWN0aW9uTWFwKSB7XHJcblx0XHRcdFx0X2FjdCA9IHRoaXMuc2xvdHMudGFtaW5nTW9iLmFjdGlvbk1hcFthY3RdO1xyXG5cclxuXHRcdFx0XHRpZiAoX2FjdCA9PSBcImhpZGVCb2R5XCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuaGlkZUJvZHkgPSB0cnVlO1xyXG5cclxuXHRcdFx0XHRcdC8vVE9ETzogaGlkZUJvZHkgYWN0PT9cclxuXHJcblx0XHRcdFx0XHR0aGlzLl9hY3Rpb24gPSBhY3Q7XHJcblx0XHRcdFx0XHRpZiAodGhpcy5hY3RhbmkuX2FjdGlvbiAhPSBhY3QpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5hY3RhbmkucmVsb2FkKGFjdCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgfD0gdHJ1ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLmhpZGVCb2R5ID0gZmFsc2U7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5fYWN0aW9uID0gX2FjdDtcclxuXHRcdFx0XHRcdGlmICh0aGlzLmFjdGFuaS5fYWN0aW9uICE9IF9hY3QpIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5hY3RhbmkucmVsb2FkKF9hY3QpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGlmIChhY3QgPT0gXCJyb3BlXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuX2FjdGlvbiA9IFwicm9wZVwiOy8vZGVmYXVsdFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChhY3QgPT0gXCJsYWRkZXJcIikge1xyXG5cdFx0XHRcdFx0dGhpcy5fYWN0aW9uID0gXCJsYWRkZXJcIjsvL2RlZmF1bHRcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLl9hY3Rpb24gPSBcInNpdFwiOy8vZGVmYXVsdFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAodGhpcy5hY3RhbmkuX2FjdGlvbiAhPSBhY3QpIHtcclxuXHRcdFx0XHRcdHRoaXMuYWN0YW5pLnJlbG9hZChhY3QpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgfD0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuaGlkZUJvZHkgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5fcmlkZV9hY3Rpb24gPSBudWxsO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuYWN0YW5pLl9hY3Rpb24gIT0gYWN0ICYmIHRoaXMuc2xvdHMuYm9keSkge1xyXG5cdFx0XHRcdHRoaXMuX2FjdGlvbiA9IGFjdDtcclxuXHRcdFx0XHR0aGlzLmFjdGFuaS5yZWxvYWQoYWN0KTtcclxuXHJcblx0XHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdGdldCBhY3Rpb25fZnJhbWUoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fYWN0aW9uX2ZyYW1lO1xyXG5cdH1cclxuXHRzZXQgYWN0aW9uX2ZyYW1lKHZhbHVlKSB7XHJcblx0XHRpZiAodmFsdWUgPT09IFwiXCIpIHsvL2Zyb20gJChcImlucHV0XCIpXHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdGlmICghKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykpIHtcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHR0aGlzLl9hY3Rpb25fZnJhbWUgPSBOdW1iZXIodmFsdWUpIHwgMDtcclxuXHRcdFx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgfD0gdHJ1ZTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9hY3Rpb25fZnJhbWUgPSB2YWx1ZTtcclxuXHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IGFjdGlvbl9mcmFtZV9jb3VudCgpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGlmICh0aGlzLnNsb3RzLmJvZHkpIHtcclxuXHRcdFx0XHRyZXR1cm4gdGhpcy5zbG90cy5ib2R5LmdldEZyYW1lQ291bnQodGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdHJldHVybiAwO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0Z2V0IGVtb3Rpb24oKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fZW1vdGlvbjtcclxuXHR9XHJcblx0c2V0IGVtb3Rpb24oZW1vKSB7XHJcblx0XHRpZiAodGhpcy5fZW1vdGlvbiAhPSBlbW8gJiYgdGhpcy5zbG90cy5mYWNlICYmIHRoaXMuc2xvdHMuZmFjZS5mcmFnbWVudHMuZmFjZS50ZXh0dXJlc1tlbW9dKSB7XHJcblx0XHRcdHRoaXMuX2Vtb3Rpb24gPSBlbW87XHJcblx0XHRcdHRoaXMuX2Vtb3Rpb25fZnJhbWUgPSAwO1xyXG5cdFx0XHR0aGlzLl9lbW90aW9uX3RpbWUgPSAwO1xyXG5cclxuXHRcdFx0dGhpcy5fZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZSA9IFsuLi5jaXJjdWxhclNlcXVlbmNlKHRoaXMuZW1vdGlvbl9mcmFtZV9jb3VudCldO1xyXG5cclxuXHRcdFx0dGhpcy5fX3JlcXVpcmVfdXBkYXRlIHw9IHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQqZW1vdGlvbl9mcmFtZV9zZXF1ZW5jZV9nZW5lcmF0b3IobGVuZ3RoKSB7XHJcblx0XHRmb3IgKDsgOykge1xyXG5cdFx0XHQvL1RPRE86IHJhbmRvbSBibGlua1xyXG5cdFx0XHR5aWVsZCogY2lyY3VsYXJTZXF1ZW5jZShsZW5ndGgpO1xyXG5cclxuXHRcdFx0Zm9yICg7IE1hdGgucmFuZG9tKCkgPCAwLjU7KSB7XHJcblx0XHRcdFx0eWllbGQgMDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRcdFxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdGdldCBlbW90aW9uX2ZyYW1lKCkge1xyXG5cdFx0bGV0IGYgPSB0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlW3RoaXMuX2Vtb3Rpb25fZnJhbWUgJSB0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlLmxlbmd0aF07XHJcblx0XHRyZXR1cm4gZjtcclxuXHR9XHJcblx0c2V0IGVtb3Rpb25fZnJhbWUodmFsdWUpIHtcclxuXHRcdGlmICh2YWx1ZSA9PT0gXCJcIikgey8vZnJvbSAkKFwiaW5wdXRcIilcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuXHRcdFx0aWYgKCEodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdHRoaXMuX2Vtb3Rpb25fZnJhbWUgPSBOdW1iZXIodmFsdWUpIHwgMDtcclxuXHRcdFx0XHR0aGlzLl9lbW90aW9uX3RpbWUgPSAwO1xyXG5cdFx0XHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5fZW1vdGlvbl9mcmFtZSA9IHZhbHVlO1xyXG5cdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHRcdHRoaXMuX19yZXF1aXJlX3VwZGF0ZSB8PSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG5leHRcclxuXHQgKi9cclxuXHRfZ2V0X2Vtb3Rpb25fbmV4dF9mcmFtZShuZXh0KSB7XHJcblx0XHRsZXQgZiA9IHRoaXMuX2Vtb3Rpb25fZnJhbWUgKyBuZXh0O1xyXG5cdFx0ZiA9IGYgPCAwID8gKHRoaXMuX2Vtb3Rpb25fZnJhbWVfc2VxdWVuY2UubGVuZ3RoIC0gMSkgOiAoZiAlIHRoaXMuX2Vtb3Rpb25fZnJhbWVfc2VxdWVuY2UubGVuZ3RoKTtcclxuXHRcdHJldHVybiB0aGlzLl9lbW90aW9uX2ZyYW1lX3NlcXVlbmNlW2ZdO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IGVtb3Rpb25fdGltZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9lbW90aW9uX3RpbWU7XHJcblx0fVxyXG5cdHNldCBlbW90aW9uX3RpbWUodGltZSkge1xyXG5cdFx0aWYgKHRoaXMuZW1vdGlvbl9mcmFtZV9jb3VudCkge1xyXG5cdFx0XHRpZiAodGltZSA8IHRoaXMuZW1vdGlvbl9kZWxheSkge1xyXG5cdFx0XHRcdHRoaXMuX2Vtb3Rpb25fdGltZSA9IHRpbWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fZW1vdGlvbl90aW1lID0gMDtcclxuXHJcblx0XHRcdFx0Kyt0aGlzLl9lbW90aW9uX2ZyYW1lO1xyXG5cclxuXHRcdFx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgfD0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXQgZW1vdGlvbl9kZWxheSgpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmZhY2UpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuc2xvdHMuZmFjZS5nZXREZWxheSh0aGlzKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiA2MDtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdGdldCBlbW90aW9uX2ZyYW1lX2NvdW50KCkge1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aWYgKHRoaXMuc2xvdHMuZmFjZSkge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLnNsb3RzLmZhY2UuZ2V0RnJhbWVDb3VudCh0aGlzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXAgLSAwIDw9IHN0YW1wIDwgSW5maW5pdHlcclxuXHQgKi9cclxuXHRfdXBkYXRlKF9zdGFtcCkge1xyXG5cdFx0aWYgKHRoaXMucGF1c2UpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBzdGFtcCA9IF9zdGFtcCAqIHRoaXMuZ2V0U3BlZWQoKTtcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuYWN0YW5pKSB7XHJcblx0XHRcdGlmICh0aGlzLmFjdGFuaS5pc0VuZCgpICYmIHRoaXMuYWN0YW5pLmxvb3ApIHtcclxuXHRcdFx0XHR0aGlzLmFjdGFuaS5yZXNldCgpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLmFjdGFuaS51cGRhdGUoc3RhbXAsIHRoaXMpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZW1vdGlvbl90aW1lICs9IF9zdGFtcDtcclxuXHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuc2xvdHMpIHtcclxuXHRcdFx0bGV0IGVxdWlwID0gdGhpcy5zbG90c1tpXTtcclxuXHRcdFx0aWYgKGVxdWlwICYmIGVxdWlwLmVmZmVjdCAmJiBlcXVpcC5lZmZlY3QuZW5hYmxlKSB7XHJcblx0XHRcdFx0ZXF1aXAuZWZmZWN0LnVwZGF0ZShzdGFtcCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHthbnl9IG51bWJlciAgMCA8IHN0YW1wICogc3BlZWQgPCBJbmZpbml0eVxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0dGhpcy5fdXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdF9fZm9yY2VVcGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMuXyRkaXJ0eSA9IE1hdGgucmFuZG9tKCk7XHJcblx0XHR0aGlzLl91cGRhdGUoc3RhbXAgfCAwKTtcclxuXHRcdHRoaXMuX191cGRhdGVfZnJhZ19saXN0KCk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHksIFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBhbmdsZVxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxpcFxyXG5cdCAqL1xyXG5cdF9kcmF3KHJlbmRlcmVyLCB4LCB5LCBhbmdsZSwgZmxpcCkge1xyXG5cdFx0cmVuZGVyZXIucHVzaEdsb2JhbEFscGhhKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX19yZXF1aXJlX3VwZGF0ZSkge1xyXG5cdFx0XHR0aGlzLl9fdXBkYXRlX2ZyYWdfbGlzdCgpO1xyXG5cdFx0XHR0aGlzLl9fcmVxdWlyZV91cGRhdGUgPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHQvL2xpc3QuZmlsdGVyKGE9PmEmJmEuX3Jhdy5tYXApLmZvckVhY2goYT0+eyBmb3IgKGxldCBpIGluIGEuX3Jhdy5tYXApIHsgaWYgKHFbaV0pIHsgcVtpXS5wdXNoKGEpOyB9IGVsc2UgeyBxW2ldID0gW2FdOyB9IH0gfSlcclxuXHRcdHRoaXMuX19kcmF3X2xpc3QocmVuZGVyZXIsIHRoaXMuX19mcmFnX2xpc3QsIHgsIHksIGFuZ2xlLCBmbGlwKTtcclxuXHJcblx0XHRyZW5kZXJlci5wb3BHbG9iYWxBbHBoYSgpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge0ZyYWdtZW50VGV4dHVyZVtdfSBsaXN0XHJcblx0ICovXHJcblx0X19kcmF3X2xpc3QocmVuZGVyZXIsIGxpc3QsIHgsIHksIGFuZ2xlLCBmbGlwKSB7XHJcblx0XHRyZW5kZXJlci5wdXNoTWF0cml4KCk7XHJcblxyXG5cdFx0cmVuZGVyZXIudHJhbnNsYXRlKHgsIHkpO1xyXG5cdFx0XHJcblx0XHRpZiAoMCkge1xyXG5cdFx0XHRsZXQgY3R4ID0gcmVuZGVyZXIuY3R4O1xyXG5cdFx0XHRjdHguYmVnaW5QYXRoKCk7XHJcblx0XHRcdGN0eC5tb3ZlVG8oMCwgMCk7XHJcblx0XHRcdGN0eC5saW5lVG8oMTAwLCAwKTtcclxuXHRcdFx0Y3R4LnN0cm9rZVN0eWxlID0gXCIjRjAwXCI7XHJcblx0XHRcdGN0eC5zdHJva2UoKTtcclxuXHRcdFx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0XHRjdHgubW92ZVRvKDAsIDApO1xyXG5cdFx0XHRjdHgubGluZVRvKDAsIDEwMCk7XHJcblx0XHRcdGN0eC5zdHJva2VTdHlsZSA9IFwiIzBGMFwiO1xyXG5cdFx0XHRjdHguc3Ryb2tlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmVuZGVyZXIucm90YXRlKHdpbmRvdy5tX2EgfHwgYW5nbGUpO1xyXG5cclxuXHRcdGlmIChmbGlwKSB7XHJcblx0XHRcdHJlbmRlcmVyLnNjYWxlKC0xLCAxKTtcclxuXHRcdH1cclxuXHRcdC8ve1xyXG5cdFx0Ly9cdGxldCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHQvL1x0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0Ly9cdGN0eC5tb3ZlVG8oMCwgMCk7XHJcblx0XHQvL1x0Y3R4LmxpbmVUbygxMDAsIDApO1xyXG5cdFx0Ly9cdGN0eC5zdHJva2VTdHlsZSA9IFwiI0YwMFwiO1xyXG5cdFx0Ly9cdGN0eC5zdHJva2UoKTtcclxuXHRcdC8vXHRjdHguYmVnaW5QYXRoKCk7XHJcblx0XHQvL1x0Y3R4Lm1vdmVUbygwLCAwKTtcclxuXHRcdC8vXHRjdHgubGluZVRvKDAsIDEwMCk7XHJcblx0XHQvL1x0Y3R4LnN0cm9rZVN0eWxlID0gXCIjMEYwXCI7XHJcblx0XHQvL1x0Y3R4LnN0cm9rZSgpO1xyXG5cdFx0Ly99XHJcblxyXG5cdFx0e1xyXG5cdFx0XHRmb3IgKGxldCBpIGluIHRoaXMuc2xvdHMpIHtcclxuXHRcdFx0XHRsZXQgZXF1aXAgPSB0aGlzLnNsb3RzW2ldO1xyXG5cdFx0XHRcdGlmIChlcXVpcCAmJiBlcXVpcC5lZmZlY3QpIHtcclxuXHRcdFx0XHRcdGVxdWlwLmVmZmVjdC5yZW5kZXIocmVuZGVyZXIsIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRmb3IgKGxldCBpIGluIGxpc3QpIHtcclxuXHRcdFx0XHRsZXQgZnQgPSBsaXN0W2ldO1xyXG5cdFx0XHRcdGZ0LnJlbmRlcihyZW5kZXJlciwgdGhpcyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJlbmRlcmVyLnBvcE1hdHJpeCgpO1xyXG5cdH1cclxuXHRfX3VwZGF0ZV9mcmFnX2xpc3QoKSB7XHJcblx0XHR0aGlzLl9fZnJhZ19saXN0ID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7QXJyYXk8Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2U+W119ICovXHJcblx0XHRsZXQgc2xvdHMgPSB7fTtcclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgaSA9IDI7IGkgPD0gMzsgKytpKSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBpdGVtID0gdGhpcy5zbG90c1tcIl9oYWlyXCIgKyBpXTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuX19hZGRfZXF1aXBfdG9fZnJhZ19saXN0KHNsb3RzLCBpdGVtKTtcclxuXHRcdH1cclxuXHRcdGZvciAobGV0IGkgaW4gdGhpcy5zbG90cy5fb3JkZXJlZF9zbG90KSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyQXBwZWFyYW5jZUJhc2V9ICovXHJcblx0XHRcdGxldCBpdGVtID0gdGhpcy5zbG90cy5fb3JkZXJlZF9zbG90W2ldO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5fX2FkZF9lcXVpcF90b19mcmFnX2xpc3Qoc2xvdHMsIGl0ZW0pO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR7Ly9iYWNrXHJcblx0XHRcdGxldCBpc19iYWNrID0gZmFsc2U7XHJcblx0XHRcdFxyXG5cdFx0XHRmb3IgKGxldCBpIGluIHNsb3RzKSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmVbXX0gKi9cclxuXHRcdFx0XHRsZXQgZnRzID0gc2xvdHNbaV07XHJcblx0XHRcdFx0Zm9yIChsZXQgaiBpbiBmdHMpIHtcclxuXHRcdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdFx0bGV0IGZ0ID0gZnRzW2pdO1xyXG5cdFx0XHRcdFx0aWYgKGlzX2JhY2spIHtcclxuXHRcdFx0XHRcdFx0aWYgKGZ0Ll9wbGFjZS5zdGFydHNXaXRoKFwiZmFjZVwiKSkge1xyXG5cdFx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIGlmIChmdC5fcGxhY2Uuc3RhcnRzV2l0aChcImJhY2tIYWlyXCIpKSB7XHJcblx0XHRcdFx0XHRcdGlzX2JhY2sgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0dGhpcy5fX2FkZF9mcmFnX3RvX2xpc3QoZnQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR7XHJcblx0XHRcdGxldCBhZSA9IHRoaXMuX19mcmFnX2xpc3RbMTE0XTsvL0hBQ0s6IEFlXHJcblx0XHRcdGlmIChhZSkge1xyXG5cdFx0XHRcdHRoaXMuX19mcmFnX2xpc3QucHVzaChhZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLl9jYWxjQm91bmRCb3goKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtBcnJheTxDaGFyYWN0ZXJBcHBlYXJhbmNlQmFzZT5bXX0gc2xvdHNcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFwcGVhcmFuY2VCYXNlfSBpdGVtXHJcblx0ICovXHJcblx0X19hZGRfZXF1aXBfdG9fZnJhZ19saXN0KHNsb3RzLCBpdGVtKSB7XHJcblx0XHQvLyBpZiBlcXVpcCBub3QgdXNlIHRoZW4gdmFsdWUgaXMgbXVtYmVyKHNsb3Rfb3JkZXIpIHdoZXJlIHRoaXMuc2xvdHMuX29yZGVyZWRfc2xvdFxyXG5cdFx0aWYgKGl0ZW0gPT0gbnVsbCkge1xyXG5cdFx0XHRyZXR1cm47Ly9kZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGl0ZW0gPiAwKSB7Ly8gdHlwZW9mIGl0ZW0gPT0gJ251bWJlcic7IGl0ZW0gIT0gbnVsbCAmJiAoaXRlbSBpbnN0YW5jZW9mIENoYXJhY3RlckFwcGVhcmFuY2VCYXNlIHx8IGl0ZW0gPj0gMClcclxuXHRcdFx0cmV0dXJuOy8vY29udGludWU7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gaW5pdCBzbG90c1xyXG5cdFx0Zm9yIChsZXQgaiBpbiBpdGVtLnZzbG90KSB7XHJcblx0XHRcdGxldCBzbG90ID0gaXRlbS52c2xvdFtqXTtcclxuXHRcdFx0c2xvdHNbc2xvdF0gPSBbXTtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKGxldCBqIGluIGl0ZW0uZnJhZ21lbnRzKSB7Ly9mb3JlYWNoIGVxdWlwIHBsYWNlXHJcblx0XHRcdGxldCBzbG90ID0gc01hcFtqXTtcclxuXHRcdFx0aWYgKHNsb3QgIT0gbnVsbCkge1xyXG5cdFx0XHRcdC8qKiBAdHlwZSB7RnJhZ21lbnRUZXh0dXJlfSAqL1xyXG5cdFx0XHRcdGxldCBmdCA9IGl0ZW0uZnJhZ21lbnRzW2pdLmdldFRleHR1cmUodGhpcyk7XHJcblx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRpZiAoIXNsb3RzW3Nsb3RdKSB7XHJcblx0XHRcdFx0XHRcdHNsb3RzW3Nsb3RdID0gW2Z0XTsvL2NvdmVyID8/XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0c2xvdHNbc2xvdF0ucHVzaChmdCk7Ly9jb3ZlciA/P1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChqID09IFwiZGVmYXVsdFwiKSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtGcmFnbWVudFRleHR1cmV9ICovXHJcblx0XHRcdFx0bGV0IGZ0ID0gaXRlbS5mcmFnbWVudHNbal0uZ2V0VGV4dHVyZSh0aGlzKTtcclxuXHRcdFx0XHRzbG90ID0gaXRlbS5fcmF3LmluZm8uaXNsb3Q7XHJcblx0XHRcdFx0aWYgKGZ0KSB7XHJcblx0XHRcdFx0XHRpZiAoIXNsb3RzW3Nsb3RdKSB7XHJcblx0XHRcdFx0XHRcdHNsb3RzW3Nsb3RdID0gW2Z0XTsvL2NvdmVyID8/XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0c2xvdHNbc2xvdF0ucHVzaChmdCk7Ly9jb3ZlciA/P1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvKiogQHR5cGUge0ZyYWdtZW50VGV4dHVyZX0gKi9cclxuXHRcdFx0XHRsZXQgZnQgPSBpdGVtLmZyYWdtZW50c1tqXS5nZXRUZXh0dXJlKHRoaXMpO1xyXG5cdFx0XHRcdGlmIChmdCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fX2FkZF9mcmFnX3RvX2xpc3QoZnQpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvL2l0ZW0uZnJhZ21lbnRzW2pdLnZpc2libGUgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvKiogQHBhcmFtIHtGcmFnbWVudFRleHR1cmV9IGZ0ICovXHJcblx0X19hZGRfZnJhZ190b19saXN0KGZ0KSB7XHJcblx0XHRmdC51cGRhdGUodGhpcyk7XHJcblx0XHR0aGlzLl9fZnJhZ19saXN0W2Z0LnpdID0gZnQ7XHJcblx0fVxyXG5cclxuXHJcblx0LyoqXHJcblx0ICogY2FsYyBjdXJyZW50IGZyYW1lIGJvdW5kIGJveCBhbmQgcmVzdG9yZSByZXN1bHRcclxuXHQgKiBAcmV0dXJucyB7UmVjdGFuZ2xlfVxyXG5cdCAqL1xyXG5cdF9jYWxjQm91bmRCb3goKSB7XHJcblx0XHRsZXQgbGVmdCA9IDAsIHRvcCA9IDAsIHJpZ2h0ID0gMCwgYm90dG9tID0gMDtcclxuXHJcblx0XHRmb3IgKGxldCBpIGluIHRoaXMuX19mcmFnX2xpc3QpIHtcclxuXHRcdFx0bGV0IGZ0ID0gdGhpcy5fX2ZyYWdfbGlzdFtpXTtcclxuXHRcdFx0aWYgKGZ0LnRleHR1cmUgJiYgZnQucmVsYXRpdmUpIHtcclxuXHRcdFx0XHRsZXQgeDAgPSBmdC5yZWxhdGl2ZS54O1xyXG5cdFx0XHRcdGxldCB5MCA9IGZ0LnJlbGF0aXZlLnk7XHJcblx0XHRcdFx0bGV0IHgxID0geDAgKyBmdC53aWR0aDtcclxuXHRcdFx0XHRsZXQgeTEgPSB5MCArIGZ0LmhlaWdodDtcclxuXHJcblx0XHRcdFx0bGVmdCA9IE1hdGgubWluKGxlZnQsIHgwKTtcclxuXHRcdFx0XHR0b3AgPSBNYXRoLm1pbih0b3AsIHkwKTtcclxuXHRcdFx0XHRyaWdodCA9IE1hdGgubWF4KHJpZ2h0LCB4MSk7XHJcblx0XHRcdFx0Ym90dG9tID0gTWF0aC5tYXgoYm90dG9tLCB5MSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRoaXMuX2JvdW5kQm94ID0gbmV3IFJlY3RhbmdsZShcclxuXHRcdFx0TWF0aC50cnVuYyhsZWZ0KSxcclxuXHRcdFx0TWF0aC50cnVuYyh0b3ApLFxyXG5cdFx0XHRNYXRoLnRydW5jKHJpZ2h0IC0gbGVmdCksXHJcblx0XHRcdE1hdGgudHJ1bmMoYm90dG9tIC0gdG9wKVxyXG5cdFx0KTtcclxuXHRcdHJldHVybiB0aGlzLl9ib3VuZEJveDtcclxuXHR9XHJcblx0XHJcblx0dG9KU09OKCkge1xyXG5cdFx0bGV0IG9iaiA9IHtcclxuXHRcdFx0aGFpcjI6IHRoaXMuc2xvdHMuX2hhaXIyLmlkLFxyXG5cdFx0XHRoYWlyTWl4MjogdGhpcy5zbG90cy5oYWlyTWl4MixcclxuXHRcdFx0c2xvdHM6IHRoaXMuc2xvdHMudG9KU09OKCksXHJcblx0XHR9O1xyXG5cclxuXHRcdGlmICh0aGlzLnNsb3RzLmhlYWQuZWxmRWFyKSB7XHJcblx0XHRcdG9iai5lYXIgPSBcImVsZlwiO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy5zbG90cy5oZWFkLmxlZkVhcikge1xyXG5cdFx0XHRvYmouZWFyID0gXCJsZWZcIjtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKHRoaXMuc2xvdHMuaGVhZC5oaWdobGVmRWFyKSB7XHJcblx0XHRcdG9iai5lYXIgPSBcImhpZ2hsZWZcIjtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gb2JqO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENoYXJhY3RlclJlbmRlcmVyIGV4dGVuZHMgQ2hhcmFjdGVyQW5pbWF0aW9uQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHBvc2l0aW9uIHggKi9cclxuXHRcdHRoaXMueCA9IDA7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBwb3NpdGlvbiB5ICovXHJcblx0XHR0aGlzLnkgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHdoZXJlIGxheWVyICovXHJcblx0XHR0aGlzLnogPSA1O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHRyYW5zbGF0ZSB4IG9uY2UgZnJhbWUgKi9cclxuXHRcdHRoaXMudHggPSAwO1xyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gdHJhbnNsYXRlIHkgb25jZSBmcmFtZSAqL1xyXG5cdFx0dGhpcy50eSA9IDA7XHJcblx0XHRcclxuXHRcdHRoaXMuYW5nbGUgPSAwO1xyXG5cdFx0dGhpcy5mcm9udCA9IC0xO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7UHJvbWlzZTx2b2lkPltdfSAqL1xyXG5cdFx0dGhpcy5fX2xvYWRfdGFzayA9IFtdO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7ZnVuY3Rpb24oSVJlbmRlcmVyKX0gKi9cclxuXHRcdHRoaXMucmVuZGVyID0gZnVuY3Rpb24gKHJlbmRlcmVyKSB7XHJcblx0XHRcdC8vbm90IHJlYWR5IHRvIHJlbmRlclxyXG5cdFx0XHQvL2lmIGxvYWQgdGhlbiBzZXQgbG9hZCByZW5kZXIgPSBfcmVuZGVyXHJcblx0XHR9XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtSZWN0YW5nbGV9ICovXHJcblx0XHR0aGlzLl9ib3VuZEJveCA9IG51bGw7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgYXN5bmMgSW5pdCgpIHtcclxuXHRcdGxldCByZXN1bHQgPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcblx0XHRcdCRnZXQuZGF0YShcIi96bWFwXCIpLFxyXG5cdFx0XHQkZ2V0LmRhdGEoXCIvc21hcFwiKSxcclxuXHRcdFx0SXRlbUVmZmVjdC5Jbml0KCksXHJcblx0XHRcdEFjdGlvbkFuaW1hdGlvbi5Jbml0KCksLy9hY3Rpb24gZGVmaW5pdGlvblxyXG5cdFx0XSk7XHJcblx0XHRcclxuXHRcdHpNYXAgPSB7fTtcclxuXHRcdE9iamVjdC5rZXlzKHJlc3VsdFswXSkucmV2ZXJzZSgpLmZvckVhY2goKGssIGkpID0+IHpNYXBba10gPSBpICsgMSk7XHJcblxyXG5cdFx0c01hcCA9IHJlc3VsdFsxXTtcclxuXHR9XHJcblxyXG5cdGxvYWQoKSB7XHJcblx0XHQvL2xvYWQgYm9keSBhbmQgaGVhZCBmb3IgY2FsYyByZWxhdGl2ZSBwb3NpdGlvblxyXG5cdFx0dGhpcy51c2UoXCIwMDAwMjAxMlwiKTtcclxuXHRcdHRoaXMudXNlKFwiMDAwMTIwMTJcIik7XHJcblxyXG5cdFx0bGV0ICRwcm9taXNlID0gUHJvbWlzZS5hbGwoWy4uLnRoaXMuX19sb2FkX3Rhc2tdKTtcclxuXHRcdChmdW5jdGlvbiAodGhhdCwgJHByb21pc2UpIHtcclxuXHRcdFx0JHByb21pc2UudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XHJcblx0XHRcdFx0dGhhdC5pbml0QW5pbWF0aW9uKCk7XHJcblx0XHRcdFx0dGhhdC5yZW5kZXIgPSB0aGF0Ll9yZW5kZXI7XHJcblx0XHRcdH0pO1xyXG5cdFx0fSkodGhpcywgJHByb21pc2UpO1xyXG5cclxuXHRcdHJldHVybiAkcHJvbWlzZTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHthbnl9IG51bWJlciAgMCA8IHN0YW1wICogc3BlZWQgPCBJbmZpbml0eVxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0dGhpcy53YWl0TG9hZGVkKCk7XHJcblx0XHRzdXBlci51cGRhdGUoc3RhbXApO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0X3JlbmRlcihyZW5kZXJlcikge1xyXG5cdFx0Y29uc3QgeCA9IE1hdGgudHJ1bmModGhpcy54ICsgdGhpcy50eCk7XHJcblx0XHRjb25zdCB5ID0gTWF0aC50cnVuYyh0aGlzLnkgKyB0aGlzLnR5KTtcclxuXHRcdFxyXG5cdFx0dGhpcy5fZHJhdyhyZW5kZXJlciwgeCwgeSwgdGhpcy5hbmdsZSwgdGhpcy5mcm9udCA+IDApO1xyXG5cdFx0XHJcblx0XHQvL3RoaXMudHggPSAwOy8vYXV0byBjbGVhclxyXG5cdFx0Ly90aGlzLnR5ID0gMDsvL2F1dG8gY2xlYXJcclxuXHR9XHJcblx0XHJcblx0X3NldHVwX3Rlc3QoKSB7XHJcblx0XHR0aGlzLnVzZShcIjAwMDI2NTA5XCIpO1xyXG5cclxuXHRcdHRoaXMudXNlKFwiMDAwNDQwNDFcIik7XHJcblxyXG5cdFx0Ly90aGlzLnVzZShcIjAxMDIyMjc0XCIpO1xyXG5cclxuXHRcdHRoaXMudXNlKFwiMDEwNTMxNjlcIik7XHJcblxyXG5cdFx0dGhpcy51c2UoXCIwMTA3MTA3N1wiKTtcclxuXHJcblx0XHQvL3RoaXMudXNlKFwiMDExMDI5NjBcIik7XHJcblx0fVxyXG5cclxuXHRcclxuXHRhc3luYyBfX3N5bmNocm9uaXplKHN0YW1wKSB7XHJcblx0XHR0aGlzLl9fZm9yY2VVcGRhdGUoc3RhbXApO1xyXG5cdFxyXG5cdFx0YXdhaXQgdGhpcy53YWl0TG9hZGVkKCk7XHJcblx0XHRhd2FpdCB0aGlzLl93YWl0RnJhbWVUZXh0dXJlc0xvYWRlZCgpO1xyXG5cdH1cclxuXHRhc3luYyB3YWl0TG9hZGVkKCkge1xyXG5cdFx0bGV0IHRhc2tzID0gdGhpcy5fX2xvYWRfdGFzaztcclxuXHRcdGlmICh0YXNrcyAmJiB0YXNrcy5sZW5ndGgpIHtcclxuXHRcdFx0YXdhaXQgUHJvbWlzZS5hbGwodGFza3MpLnRoZW4oKCkgPT4ge1xyXG5cdFx0XHRcdHRoaXMuX19sb2FkX3Rhc2sgPSBbXTtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8vaXNMb2FkaW5nKCkge1xyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gY2F0ZWdvcnkgLSBjYXRlZ29yeSBvZiBjYXNoLXdlYXBvblxyXG5cdCAqL1xyXG5cdGFzeW5jIHVzZShpZCwgY2F0ZWdvcnkpIHtcclxuXHRcdGlmICghY2F0ZWdvcnkpIHtcclxuXHRcdFx0Y2F0ZWdvcnkgPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldEpvYldlYXBvbkNhdGVnb3J5KHRoaXMuam9iKTtcclxuXHRcdH1cclxuXHRcdGNvbnN0IGl0ZW1fdHlwZSA9IGlkWzBdO1xyXG5cdFx0c3dpdGNoIChpdGVtX3R5cGUpIHtcclxuXHRcdFx0Y2FzZSBcIjBcIjovL2VxdWlwXHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0aWYgKEl0ZW1DYXRlZ29yeUluZm8uaXNDYXNoV2VhcG9uKGlkKSkge1xyXG5cdFx0XHRcdFx0XHQvL3RoaXMuJCRjaGFuZ2VMb2cud2VhcG9uVHlwZSA9IHNzWzFdOy8/P1xyXG5cdFx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLndlYXBvbiA9IGlkO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cudXNlRXF1aXAucHVzaChpZCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0bGV0IHRhc2sgPSB0aGlzLnNsb3RzLl91c2UoaWQsIG51bGwsIGNhdGVnb3J5KTtcclxuXHRcdFx0XHRcdHRoaXMuX19sb2FkX3Rhc2sucHVzaCh0YXNrKTtcclxuXHRcdFx0XHRcdGF3YWl0IHRhc2s7XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdGlmIChpZC5zdGFydHNXaXRoKFwiMDE5XCIpKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuYWN0aW9uID0gdGhpcy5hY3Rpb247Ly9mb3JjZSB1cGRhdGUgYWN0aW9uXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdHRoaXMuX191cGRhdGVfZnJhZ19saXN0KCk7XHJcblx0XHRcdFx0XHR0aGlzLl9jYWxjQm91bmRCb3goKTtcclxuXHRcdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKi9cclxuXHR1bnVzZShpZCkge1xyXG5cdFx0ZGVidWdnZXI7XHJcblx0XHRpZiAoaWRbMF0gPT0gXCIwXCIpIHsvL2VxdWlwXHJcblx0XHRcdGxldCByZXN1bHQgPSB0aGlzLnNsb3RzLl91bnVzZShpZCk7XHJcblx0XHRcdGlmIChyZXN1bHQpIHtcclxuXHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLnVudXNlRXF1aXAucHVzaChpZCk7XHJcblx0XHRcdFx0dGhpcy5fY2FsY0JvdW5kQm94KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdF9wYXJzZShjb2RlKSB7XHJcblx0XHRpZiAoIWNvZGUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGVzID0gY29kZS5zcGxpdChcIixcIik7XHJcblx0XHR0aGlzLnNsb3RzLl9jbGVhcigpO1xyXG5cdFx0ZXMuZm9yRWFjaCgodiwgaSwgYSkgPT4ge1xyXG5cdFx0XHRpZiAodi5pbmRleE9mKFwifFwiKSA+PSAwKSB7XHJcblx0XHRcdFx0Y29uc3Qgc3MgPSB2LnNwbGl0KFwifFwiKTtcclxuXHRcdFx0XHRjb25zdCBjYXRlID0gSXRlbUNhdGVnb3J5SW5mby5nZXQoc3NbMF0pO1xyXG5cdFx0XHRcdGxldCBpZDtcclxuXHRcdFx0XHRpZiAoY2F0ZS5zbG90ID09IFwiZmFjZVwiKSB7XHJcblx0XHRcdFx0XHRpZCA9IHNzWzFdO1xyXG5cdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy51c2VFcXVpcC5wdXNoKGlkKTtcclxuXHRcdFx0XHRcdC8vXHJcblx0XHRcdFx0XHR0aGlzLnVzZShpZCk7XHJcblxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChjYXRlLnNsb3QgPT0gXCJoYWlyXCIpIHtcclxuXHRcdFx0XHRcdGNvbnN0IHNsb3RzID0gdGhpcy5zbG90cztcclxuXHRcdFx0XHRcdGxldCBoMiA9IHNzWzFdO1xyXG5cdFx0XHRcdFx0bGV0IGgzID0gc3NbMl07XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0aWQgPSBzc1swXTtcclxuXHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cudXNlRXF1aXAucHVzaChpZCk7XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0dGhpcy51c2UoaWQpLnRoZW4oKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHRpZiAoaDIgJiYgaDIuaW5kZXhPZihcIiVcIikgPj0gMCkge1xyXG5cdFx0XHRcdFx0XHRcdGxldCBoYyA9IGgyLnNwbGl0KFwiJVwiKTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBjMiA9IGhjWzBdO1xyXG5cdFx0XHRcdFx0XHRcdGNvbnN0IG0yID0gaGNbMV0gLyAxMDA7XHJcblx0XHRcdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdFx0XHR0aGlzLiQkY2hhbmdlTG9nLmhhaXIyID0gYzI7XHJcblx0XHRcdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5oYWlyTWl4MiA9IG0yO1xyXG5cdFx0XHRcdFx0XHRcdC8vXHJcblx0XHRcdFx0XHRcdFx0c2xvdHMuaGFpckNvbG9yMiA9IGMyO1xyXG5cdFx0XHRcdFx0XHRcdHNsb3RzLmhhaXJNaXgyID0gbTI7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0aWYgKGgzICYmIGgzLmluZGV4T2YoXCIlXCIpID49IDApIHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgaGMgPSBoMy5zcGxpdChcIiVcIik7XHJcblx0XHRcdFx0XHRcdFx0Y29uc3QgYzMgPSBoY1swXTtcclxuXHRcdFx0XHRcdFx0XHRjb25zdCBtMyA9IGhjWzFdIC8gMTAwO1xyXG5cdFx0XHRcdFx0XHRcdC8vXHJcblx0XHRcdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy5oYWlyMyA9IGMzO1xyXG5cdFx0XHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cuaGFpck1peDMgPSBtMztcclxuXHRcdFx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0XHRcdHNsb3RzLmhhaXJDb2xvcjMgPSBoY1swXTtcclxuXHRcdFx0XHRcdFx0XHRzbG90cy5oYWlyTWl4NCA9IGhjWzFdIC8gMTAwO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoY2F0ZS5zbG90ID09IFwid2VhcG9uXCIpIHtcclxuXHRcdFx0XHRcdHRoaXMuJCRjaGFuZ2VMb2cud2VhcG9uVHlwZSA9IHNzWzFdO1xyXG5cdFx0XHRcdFx0dGhpcy4kJGNoYW5nZUxvZy53ZWFwb24gPSBpZDtcclxuXHRcdFx0XHRcdHRoaXMudXNlLmFwcGx5KHRoaXMsIHNzLCBzc1sxXSk7Ly90aGlzLnVzZShzc1swXSwgc3NbMV0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChOdW1iZXIuaXNGaW5pdGUocGFyc2VJbnQodiwgMTApKSkge1xyXG5cdFx0XHRcdHRoaXMudXNlKHYpO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB0eXBlIHtzdHJpbmd9IGNvbFxyXG5cdCAqL1xyXG5cdGdldCBoYWlyQ29sb3IoKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5oYWlyKSB7XHJcblx0XHRcdHJldHVybiBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0SGFpckNvbG9yKHRoaXMuc2xvdHMuaGFpci5pZCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gXCIwXCI7XHJcblx0fVxyXG5cdHNldCBoYWlyQ29sb3IoY29sKSB7XHJcblx0XHRpZiAodGhpcy5zbG90cy5oYWlyICYmIGNvbCAhPSB0aGlzLmhhaXJDb2xvcikge1xyXG5cdFx0XHRsZXQgaWQgPSBDaGFyYWN0ZXJSZW5kZXJDb25maWcuZ2V0Q29sb3JIYWlySUQodGhpcy5zbG90cy5oYWlyLmlkLCBjb2wpO1xyXG5cdFx0XHR0aGlzLnVzZShpZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gY29sXHJcblx0ICovXHJcblx0Z2V0IGZhY2VDb2xvcigpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmZhY2UpIHtcclxuXHRcdFx0cmV0dXJuIENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRGYWNlQ29sb3IodGhpcy5zbG90cy5mYWNlLmlkKTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBcIjBcIjtcclxuXHR9XHJcblx0c2V0IGZhY2VDb2xvcihjb2wpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmZhY2UgJiYgY29sICE9IHRoaXMuZmFjZUNvbG9yKSB7XHJcblx0XHRcdGxldCBpZCA9IENoYXJhY3RlclJlbmRlckNvbmZpZy5nZXRDb2xvckZhY2VJRCh0aGlzLnNsb3RzLmZhY2UuaWQsIGNvbCk7XHJcblx0XHRcdHRoaXMudXNlKGlkKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyQ2hhbmdlTG9nfSBjaGFuZ2VMb2dcclxuXHQgKi9cclxuXHRjb21taXRDaGFuZ2UoY2hhbmdlTG9nKSB7XHJcblx0XHRpZiAoY2hhbmdlTG9nLmVhcikge1xyXG5cdFx0XHR0aGlzLmVhciA9IGNoYW5nZUxvZy5lYXI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMudXNlRXF1aXApIHtcclxuXHRcdFx0Zm9yIChsZXQgaWQgb2YgdGhpcy51c2VFcXVpcCkge1xyXG5cdFx0XHRcdHRoaXMudXNlKGlkKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLnVudXNlRXF1aXApIHtcclxuXHRcdFx0Zm9yIChsZXQgaWQgb2YgdGhpcy51bnVzZUVxdWlwKSB7XHJcblx0XHRcdFx0dGhpcy51bnVzZShpZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoY2hhbmdlTG9nLmhhaXIyICYmIGNoYW5nZUxvZy5oYWlyTWl4Mikge1xyXG5cdFx0XHR0aGlzLnNsb3RzLmhhaXJDb2xvcjIgPSBjaGFuZ2VMb2cuaGFpcjI7XHJcblx0XHRcdHRoaXMuc2xvdHMuaGFpck1peDIgPSBjaGFuZ2VMb2cuaGFpck1peDI7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGNoYW5nZUxvZy5oYWlyMyAmJiBjaGFuZ2VMb2cuaGFpck1peDMpIHtcclxuXHRcdFx0Ly90aGlzLnNsb3RzLmhhaXJDb2xvcjMgPSBjaGFuZ2VMb2cuaGFpcjM7XHJcblx0XHRcdC8vdGhpcy5zbG90cy5oYWlyTWl4MyA9IGNoYW5nZUxvZy5oYWlyTWl4MztcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYgKGNoYW5nZUxvZy53ZWFwb24gJiYgY2hhbmdlTG9nLndlYXBvblR5cGUpIHtcclxuXHRcdFx0dGhpcy51c2UoY2hhbmdlTG9nLndlYXBvbiwgY2hhbmdlTG9nLndlYXBvblR5cGUpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0X3N0cmluZ2lmeShnZW5Db2RlKSB7XHJcblx0XHRsZXQgcmVzdWx0ID0gdGhpcy5zbG90cy5fc3RyaW5naWZ5KCk7XHJcblx0XHRpZiAoZ2VuQ29kZSkge1xyXG5cdFx0XHRyZXR1cm4gYGNoYXJhLl9wYXJzZSgnJHtyZXN1bHR9JylgO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHR9XHJcblxyXG5cdF9vdXRsaW5rX29sZCgpIHtcclxuXHRcdGlmICh0aGlzLnNsb3RzLmJvZHkgJiYgdGhpcy5zbG90cy5ib2R5LmlkICYmIHRoaXMuc2xvdHMuZmFjZSAmJiB0aGlzLnNsb3RzLmZhY2UuaWQgJiYgdGhpcy5hY3Rpb24gJiYgdGhpcy5lbW90aW9uKSB7XHJcblx0XHRcdGxldCBsaW5rID0gXCJodHRwczovL2xhYnMubWFwbGVzdG9yeS5pby9hcGkvR01TL2xhdGVzdC9jaGFyYWN0ZXIvY2VudGVyL1wiICsgdGhpcy5zbG90cy5ib2R5LmlkICsgXCIvXCI7XHJcblx0XHRcdGxldCBzbG90cyA9IFsuLi50aGlzLnNsb3RzLmVudW1lcmF0ZSgpXS5tYXAoYSA9PiBwYXJzZUludChhLmlkLCAxMCkpO1xyXG5cclxuXHRcdFx0c2xvdHNbMF0gPSB0aGlzLnNsb3RzLmZhY2UuaWQgKyBcIjpcIiArIHRoaXMuZW1vdGlvbjtcclxuXHJcblx0XHRcdGxpbmsgKz0gc2xvdHMuam9pbihcIixcIik7XHJcblxyXG5cdFx0XHRsaW5rICs9IFwiL1wiICsgdGhpcy5hY3Rpb24gKyBcIj9zaG93ZWFycz1cIiArICh0aGlzLmVsZkVhciA/IFwidHJ1ZVwiIDogXCJmYWxzZVwiKTtcclxuXHJcblx0XHRcdGxpbmsgKz0gXCImc2hvd0xlZkVhcnM9XCIgKyAodGhpcy5sZWZFYXIgPyBcInRydWVcIiA6IFwiZmFsc2VcIik7XHJcblxyXG5cdFx0XHRyZXR1cm4gbGluaztcclxuXHRcdH1cclxuXHRcdGNvbnNvbGUubG9nKFwiY2hhcmFjdGVyIG5lZWQgYm9keSwgZmFjZSwgYWN0aW9uLCBlbW90aW9uXCIpO1xyXG5cdH1cclxuXHRcclxuXHRfb3V0bGluayhuYW1lKSB7XHJcblx0XHRjb25zdCBhbmltYXRpb25OYW1lID0gdGhpcy5hY3Rpb247XHJcblx0XHRjb25zdCBmcmFtZSA9IHRoaXMuYWN0aW9uX2ZyYW1lO1xyXG5cdFx0Y29uc3Qgc2xvdHMgPSB0aGlzLnNsb3RzO1xyXG5cdFx0Y29uc3QgaXRlbUxpc3QgPSBKU09OLnN0cmluZ2lmeShtYWtlSXRlbUxpc3QuY2FsbCgpKTtcclxuXHRcdHJldHVybiBlbmNvZGVVUkkoXHJcblx0XHRcdFx0XCJodHRwczovL21hcGxlc3RvcnkuaW8vYXBpL2NoYXJhY3Rlci9cIiArXHJcblx0XHRcdFx0aXRlbUxpc3Quc2xpY2UoMSwgaXRlbUxpc3QubGVuZ3RoIC0gMSkgKyAgICAvLyBub3QgYXJyYXlcclxuXHRcdFx0XHRcIi9cIiArIGFuaW1hdGlvbk5hbWUgKyBcIi9cIiArIGZyYW1lICsgXCI/XCIgK1xyXG5cdFx0XHRcdFwic2hvd2VhcnM9XCIgKyB0aGlzLmVsZkVhciArXHJcblx0XHRcdFx0XCImc2hvd0xlZkVhcnM9XCIgKyB0aGlzLmxlZkVhciArXHJcblx0XHRcdFx0XCImcmVzaXplPTFcIiArXHJcblx0XHRcdFx0KG5hbWUgPyAoXCImbmFtZT1cIiArIG5hbWUpIDogXCJcIikgK1xyXG5cdFx0XHRcdFwiJmZsaXBYPVwiICsgQm9vbGVhbih0aGlzLmZyb250ID4gMCkgK1xyXG5cdFx0XHRcdFwiJmJnQ29sb3I9MCwwLDAsMFwiXHJcblx0XHRcdFx0KTtcclxuXHRcdGZ1bmN0aW9uIG1ha2VJdGVtTGlzdCgpIHtcclxuXHRcdFx0cmV0dXJuIE9iamVjdC52YWx1ZXMoc2xvdHMpLmZpbHRlcihhID0+IGEpLm1hcCh0cmFuc2Zvcm1JdGVtRGF0YSk7XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiB0cmFuc2Zvcm1JdGVtRGF0YShpdGVtKSB7XHJcblx0XHRcdGxldCByZWdpb24sIHZlcnNpb247XHJcblx0XHRcdGlmIChpdGVtLl9yYXcuaW5mby5fX3YpIHtcclxuXHRcdFx0XHRjb25zdCBtID0gaXRlbS5fcmF3LmluZm8uX192LnRvVXBwZXJDYXNlKCkubWF0Y2goLyhbQS1aXSopKFswLTldKikvKTtcclxuXHRcdFx0XHRyZWdpb24gPSBtWzFdID09IFwiVFdNU1wiID8gXCJUTVNcIiA6IG1bMV07XHJcblx0XHRcdFx0dmVyc2lvbiA9IFwibGF0ZXN0XCI7Ly9tWzJdO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJlZ2lvbiA9XCJUTVNcIjtcclxuXHRcdFx0XHR2ZXJzaW9uID0gXCJsYXRlc3RcIjtcclxuXHRcdFx0fVxyXG5cdFx0XHRjb25zdCBmaWx0ZXIgPSBpdGVtLmZpbHRlcjtcclxuXHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRpdGVtSWQ6ICAgICAgICBOdW1iZXIoaXRlbS5pZCksXHJcblx0XHRcdFx0cmVnaW9uOiAgICAgICAgcmVnaW9uLFxyXG5cdFx0XHRcdHZlcnNpb246ICAgICAgIHZlcnNpb24sXHJcblx0XHRcdFx0aHVlOiAgICAgICAgICAgZmlsdGVyLmh1ZSxcclxuXHRcdFx0XHRzYXR1cmF0aW9uOiAgICBzdHJOdW0oZmlsdGVyLnNhdCksXHJcblx0XHRcdFx0YnJpZ2h0bmVzczogICAgc3RyTnVtKGZpbHRlci5icmkpLFxyXG5cdFx0XHRcdGNvbnRyYXN0OiAgICAgIHN0ck51bShmaWx0ZXIuY29udHJhc3QpLFxyXG5cdFx0XHRcdGFscGhhOiAgICAgICAgIE51bWJlcihpdGVtLm9wYWNpdHkudG9GaXhlZCgxKSksXHJcblx0XHRcdFx0YW5pbWF0aW9uTmFtZTogYW5pbWF0aW9uTmFtZSxcclxuXHRcdFx0fTtcclxuXHRcdH1cclxuXHRcdGZ1bmN0aW9uIHN0ck51bSh2YWwpIHtcclxuXHRcdFx0cmV0dXJuICh2YWwgLyAxMDApLnRvRml4ZWQoMSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdF9kb3dubG9hZCgpIHtcclxuXHRcdHdpbmRvdy5vcGVuKHRoaXMuX291dGxpbmsoKSk7XHJcblx0fVxyXG5cclxuXHRfc2F2ZV9hc19zdmcoKSB7XHJcblx0XHR0aGlzLl9fdGV4dHVyZV90b19iYXNlNjQoKS50aGVuKGZyYWdfbGlzdCA9PiB7XHJcblx0XHRcdGxldCBmaWxlX25hbWUgPSB0aGlzLmlkICsgXCIuc3ZnXCI7XHJcblx0XHRcdC8vbGV0IGZyYWdfbGlzdCA9IHRoaXMuX19mcmFnX2xpc3Q7XHJcblx0XHJcblx0XHRcdGxldCBzdmcgPSAnPCFET0NUWVBFIHN2ZyBQVUJMSUMgXCItLy9XM0MvL0RURCBTVkcgMS4xLy9FTlwiIFwiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkXCIgPic7XHJcblxyXG5cdFx0XHRzdmcgKz0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPSBcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIj5cXG4nOy8vIHdpZHRoPVwiNjRcIiBoZWlnaHQ9XCI5NlwiXHJcblxyXG5cdFx0XHRzdmcgKz0gJzxnIHRyYW5zZm9ybT1cInRyYW5zbGF0ZSgzMiwgOTYpXCI+JztcclxuXHRcdFx0ZnJhZ19saXN0LmZvckVhY2goZnVuY3Rpb24gKGZ0KSB7XHJcblx0XHRcdFx0aWYgKGZ0ICYmIGZ0LnJlbGF0aXZlKSB7XHJcblx0XHRcdFx0XHRsZXQgY2x6ID0gZnQuY2xhc3NMaXN0O1xyXG5cdFx0XHRcdFx0c3ZnICs9IGBcXHQ8aW1hZ2UgY2xhc3M9XCIke2Nsen1cIiBvcGFjaXR5PVwiJHtmdC52aXNpYmxlID8gZnQub3BhY2l0eSA6IDB9XCIgeD1cIiR7ZnQucmVsYXRpdmUueH1cIiB5PVwiJHtmdC5yZWxhdGl2ZS55fVwiIHdpZHRoPVwiJHtmdC53aWR0aH1cIiBoZWlnaHQ9XCIke2Z0LmhlaWdodH1cIiB4bGluazpocmVmPVwiJHtmdC5fdXJsfVwiPjwvaW1hZ2U+XFxuYDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0pO1xyXG5cdFx0XHRzdmcgKz0gJzwvZz4nO1xyXG5cclxuXHRcdFx0c3ZnICs9ICc8dGV4dCB4PVwiMFwiIHk9XCIxMjJcIiBmaWxsPVwidHJhbnNwYXJlbnRcIj4nICsgdGhpcy5fc3RyaW5naWZ5KGZhbHNlKSArICc8L3RleHQ+JztcclxuXHJcblx0XHRcdHN2ZyArPSAnPC9zdmc+JztcclxuXHJcblx0XHRcdC8vbGV0IHVybCA9IFwiZGF0YTp0ZXh0L3BsYWluO3V0ZjgsXCIgKyBzdmc7XHJcblxyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHJcblx0XHRcdC8vd2luZG93Lm9wZW4odXJsKTtcclxuXHRcdFx0RG93bmxvYWREYXRhKHN2ZywgXCJpbWFnZS9zdmcreG1sO3V0ZjhcIiwgZmlsZV9uYW1lKTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogXCJkYXRhOmltYWdlL3BuZztiYXNlNjQsWy4uLl1cIlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlbmFtZVxyXG5cdCAqIEByZXR1cm5zIHtzdHJpbmd9XHJcblx0ICovXHJcblx0X3NhdmVfYXNfcG5nKHJlbmRlcmVyLCBmaWxlbmFtZSkge1xyXG5cdFx0bGV0IGJvdW5kID0gdGhpcy5fY2FsY0JvdW5kQm94KCk7XHJcblx0XHRsZXQgc2l6ZSA9IGJvdW5kLnNpemU7XHJcblx0XHRsZXQgeCA9IC1ib3VuZC5sZWZ0O1xyXG5cdFx0bGV0IHkgPSBib3VuZC5oZWlnaHQ7XHJcblx0XHRsZXQgYW5nbGUgPSAwO1xyXG5cdFx0bGV0IGZyb250ID0gZmFsc2U7XHJcblxyXG5cdFx0Ly8gdXNlIENhbnZhczIsIG11c3Qgbm90IGZhaWxcclxuXHRcdHRyeSB7XHJcblx0XHRcdHJlbmRlcmVyLiRzd2FwQ2FudmFzKCk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihleCk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvL3NhdmUgQ2FudmFzMiBzaXplLCBjdXJyZW50IGN0eCBpcyBfY3R4MlxyXG5cdFx0Y29uc3QgYzJ3ID0gcmVuZGVyZXIuX2N0eDIuY2FudmFzLndpZHRoO1xyXG5cdFx0Y29uc3QgYzJoID0gcmVuZGVyZXIuX2N0eDIuY2FudmFzLmhlaWdodDtcclxuXHRcdC8vXHJcblx0XHRyZW5kZXJlci5jdHguY2FudmFzLndpZHRoID0gc2l6ZS54O1xyXG5cdFx0cmVuZGVyZXIuY3R4LmNhbnZhcy5oZWlnaHQgPSBzaXplLnk7XHJcblxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0dGhpcy5fZHJhdyhyZW5kZXJlciwgeCwgeSwgYW5nbGUsIGZyb250KTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKGV4KTtcclxuXHRcdFx0Ly8gbm90aGluZ1xyXG5cdFx0fVxyXG5cclxuXHRcdGxldCBiYXNlNjQgPSByZW5kZXJlci5jdHguY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcclxuXHRcdHtcclxuXHRcdFx0bGV0IGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuXHJcblx0XHRcdGxldCBuYW1lID0gYCR7ZmlsZW5hbWUgPyAoZmlsZW5hbWUrXCIuXCIpOlwiXCJ9JHt0aGlzLmFjdGlvbn1bJHt0aGlzLmFjdGlvbl9mcmFtZX1dLiR7dGhpcy5lbW90aW9ufVske3RoaXMuZW1vdGlvbl9mcmFtZX1dLnBuZ2A7XHJcblxyXG5cdFx0XHRlbGVtLmlkID0gbmFtZTtcclxuXHRcdFx0ZWxlbS5kb3dubG9hZCA9IG5hbWU7XHJcblx0XHRcdGVsZW0uaHJlZiA9IGJhc2U2NDtcclxuXHJcblx0XHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlbSk7XHJcblx0XHRcdGVsZW0uY2xpY2soKTtcclxuXHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbGVtKTtcclxuXHRcdH1cclxuXHJcblx0XHQvL3Jlc3RvcmUgQ2FudmFzMiBzaXplLCBjdXJyZW50IGN0eCBpcyBfY3R4MlxyXG5cdFx0cmVuZGVyZXIuY3R4LmNhbnZhcy53aWR0aCA9IGMydztcclxuXHRcdHJlbmRlcmVyLmN0eC5jYW52YXMuaGVpZ2h0ID0gYzJoO1xyXG5cclxuXHRcdC8vIHJlc3RvcmUgQ2FudmFzLCBtdXN0IG5vdCBmYWlsXHJcblx0XHR0cnkge1xyXG5cdFx0XHRyZW5kZXJlci4kc3dhcENhbnZhcygpO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0XHQvLyBub3RoaW5nXHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGJhc2U2NDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPEZyYWdtZW50VGV4dHVyZVtdPn1cclxuXHQgKi9cclxuXHRhc3luYyBfX3RleHR1cmVfdG9fYmFzZTY0KCkge1xyXG5cdFx0bGV0IGZyYWdfbGlzdCA9IHRoaXMuX19mcmFnX2xpc3Q7XHJcblx0XHRsZXQgdGFza3MgPSBbXTtcclxuXHJcblx0XHRmcmFnX2xpc3QuZm9yRWFjaChmdW5jdGlvbiAoZnQpIHtcclxuXHRcdFx0aWYgKCFmdCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoIWZ0Ll91cmwuc3RhcnRzV2l0aChcImRhdGE6XCIpKSB7XHJcblx0XHRcdFx0dGFza3MucHVzaCgoYXN5bmMgZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRcdFx0ZnQudGV4dHVyZS4kc3JjID0gZnQuX3VybDtcclxuXHRcdFx0XHRcdGZ0Ll91cmwgPSBhd2FpdCB0b0RhdGFVUkwoZnQuX3VybCk7XHJcblx0XHRcdFx0XHRyZXR1cm4gZnQ7XHJcblx0XHRcdFx0fSkoKSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGFza3MucHVzaChmdCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGZ0LmdyYXBoMikge1xyXG5cdFx0XHRcdGxldCBzcmMgPSBmdC5ncmFwaDIuX3VybDtcclxuXHRcdFx0XHRpZiAoIXNyYy5zdGFydHNXaXRoKFwiZGF0YTpcIikpIHtcclxuXHRcdFx0XHRcdHRhc2tzLnB1c2goKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0ZnQudGV4dHVyZS4kc3JjID0gZnQuX3VybDtcclxuXHRcdFx0XHRcdFx0ZnQuZ3JhcGgyLl91cmwgPSBhd2FpdCB0b0RhdGFVUkwoc3JjKTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0LmdyYXBoMjtcclxuXHRcdFx0XHRcdH0pKCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRhc2tzLnB1c2goZnQuZ3JhcGgyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGZ0LmdyYXBoMykge1xyXG5cdFx0XHRcdGxldCBzcmMgPSBmdC5ncmFwaDMuX3VybDtcclxuXHRcdFx0XHRpZiAoIXNyYy5zdGFydHNXaXRoKFwiZGF0YTpcIikpIHtcclxuXHRcdFx0XHRcdHRhc2tzLnB1c2goKGFzeW5jIGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdFx0ZnQudGV4dHVyZS4kc3JjID0gZnQuX3VybDtcclxuXHRcdFx0XHRcdFx0ZnQuZ3JhcGgzLl91cmwgPSBhd2FpdCB0b0RhdGFVUkwoc3JjKTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZ0LmdyYXBoMztcclxuXHRcdFx0XHRcdH0pKCkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRhc2tzLnB1c2goZnQuZ3JhcGgzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cclxuXHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XHJcblx0fVxyXG59XHJcbkFkZEluaXRUYXNrKENoYXJhY3RlclJlbmRlcmVyLkluaXQoKSk7XHJcblxyXG5mdW5jdGlvbiogY2lyY3VsYXJTZXF1ZW5jZShsZW5ndGgpIHtcclxuXHRsZXQgaSA9IDA7XHJcblx0Zm9yICg7IGkgPCBsZW5ndGg7ICsraSkgey8vYTogMCwgMSwgMiwgMywgLi4uYlxyXG5cdFx0eWllbGQgaTtcclxuXHR9XHJcblx0Zm9yIChpIC09IDI7IGkgPiAwOyAtLWkpIHsvL2I6IDIsIDEsIC4uLmFcclxuXHRcdHlpZWxkIGk7XHJcblx0fVxyXG59XHJcblxyXG5mdW5jdGlvbiogbGluZWFyU2VxdWVuY2UobGVuZ3RoKSB7XHJcblx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkge1xyXG5cdFx0eWllbGQgaTtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGV4dHJhY3RfbnVtYmVyKGlucHV0KSB7XHJcblx0cmV0dXJuIFN0cmluZyhpbnB1dCkubWF0Y2goLygtP1xcZCtcXC4/XFxkKil8KFxcLlxcZCopL2cpO1xyXG59XHJcblxyXG4vKipcclxuICogaW1hZ2UgaHJlZiB0byBkYXRhIHVybFxyXG4gKi9cclxuZnVuY3Rpb24gdG9EYXRhVVJMKHVybCkge1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcblx0XHRsZXQgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XHJcblx0XHR4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG5cdFx0XHRsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuXHRcdFx0cmVhZGVyLm9ubG9hZGVuZCA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRyZXNvbHZlKHJlYWRlci5yZXN1bHQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJlYWRlci5vbmVycm9yID0gZnVuY3Rpb24gKGV2KSB7XHJcblx0XHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdFx0cmVqZWN0KGV2KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZWFkZXIucmVhZEFzRGF0YVVSTCh4aHIucmVzcG9uc2UpO1xyXG5cdFx0fTtcclxuXHRcdHhoci5vcGVuKCdHRVQnLCB1cmwpO1xyXG5cdFx0eGhyLnJlc3BvbnNlVHlwZSA9ICdibG9iJztcclxuXHRcdHhoci5zZW5kKCk7XHJcblx0fSk7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Renderer/CharacterRenderer.js\n");

/***/ }),

/***/ "./src/init.js":
/*!*********************!*\
  !*** ./src/init.js ***!
  \*********************/
/*! exports provided: AddInitTask, InitAll */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AddInitTask\", function() { return AddInitTask; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"InitAll\", function() { return InitAll; });\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ \"./node_modules/jquery/dist/jquery.js\");\n/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jquery-ui/themes/base/core.css */ \"./node_modules/jquery-ui/themes/base/core.css\");\n/* harmony import */ var jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_core_css__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jquery-ui/themes/base/theme.css */ \"./node_modules/jquery-ui/themes/base/theme.css\");\n/* harmony import */ var jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_theme_css__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jquery-ui/themes/base/selectable.css */ \"./node_modules/jquery-ui/themes/base/selectable.css\");\n/* harmony import */ var jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_selectable_css__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! jquery-ui/themes/base/sortable.css */ \"./node_modules/jquery-ui/themes/base/sortable.css\");\n/* harmony import */ var jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_sortable_css__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! jquery-ui/themes/base/draggable.css */ \"./node_modules/jquery-ui/themes/base/draggable.css\");\n/* harmony import */ var jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_themes_base_draggable_css__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! jquery-ui/ui/core */ \"./node_modules/jquery-ui/ui/core.js\");\n/* harmony import */ var jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_core__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! jquery-ui/ui/widgets/selectable */ \"./node_modules/jquery-ui/ui/widgets/selectable.js\");\n/* harmony import */ var jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_selectable__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! jquery-ui/ui/widgets/sortable */ \"./node_modules/jquery-ui/ui/widgets/sortable.js\");\n/* harmony import */ var jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_sortable__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! jquery-ui/ui/widgets/draggable */ \"./node_modules/jquery-ui/ui/widgets/draggable.js\");\n/* harmony import */ var jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_widgets_draggable__WEBPACK_IMPORTED_MODULE_9__);\n/* harmony import */ var jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! jquery-ui/ui/disable-selection */ \"./node_modules/jquery-ui/ui/disable-selection.js\");\n/* harmony import */ var jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_disable_selection__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! jquery-ui/ui/position */ \"./node_modules/jquery-ui/ui/position.js\");\n/* harmony import */ var jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_position__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! jquery-ui/ui/effect */ \"./node_modules/jquery-ui/ui/effect.js\");\n/* harmony import */ var jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12___default = /*#__PURE__*/__webpack_require__.n(jquery_ui_ui_effect__WEBPACK_IMPORTED_MODULE_12__);\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./util.js */ \"./src/util.js\");\n/* harmony import */ var _util_js__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(_util_js__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! vue */ \"./node_modules/vue/dist/vue.esm.js\");\n/* harmony import */ var vuex__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! vuex */ \"./node_modules/vuex/dist/vuex.esm.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvue__WEBPACK_IMPORTED_MODULE_14__[\"default\"].config.productionTip = false;\r\nvue__WEBPACK_IMPORTED_MODULE_14__[\"default\"].use(vuex__WEBPACK_IMPORTED_MODULE_15__[\"default\"]);\r\n\r\nwindow.jQuery = jquery__WEBPACK_IMPORTED_MODULE_0___default.a;\r\nwindow.$ = jquery__WEBPACK_IMPORTED_MODULE_0___default.a;\r\n\r\nif (!window.onwheel) {\r\n\twindow.onwheel = function () {\r\n\t}\r\n}\r\n\r\nlet init_tasks = [];\r\n\r\nfunction AddInitTask(task) {\r\n\tinit_tasks.push(task);\r\n}\r\n\r\nfunction InitAll() {\r\n\tlet a = Promise.all(init_tasks);\r\n\tinit_tasks = [];\r\n\treturn a;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5pdC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9pbml0LmpzP2Q5OWUiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCBqUXVlcnkgZnJvbSBcImpxdWVyeVwiO1xyXG5cclxuaW1wb3J0IFwianF1ZXJ5LXVpL3RoZW1lcy9iYXNlL2NvcmUuY3NzXCI7XHJcbmltcG9ydCBcImpxdWVyeS11aS90aGVtZXMvYmFzZS90aGVtZS5jc3NcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3RoZW1lcy9iYXNlL3NlbGVjdGFibGUuY3NzXCI7XHJcbmltcG9ydCBcImpxdWVyeS11aS90aGVtZXMvYmFzZS9zb3J0YWJsZS5jc3NcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3RoZW1lcy9iYXNlL2RyYWdnYWJsZS5jc3NcIjtcclxuXHJcbmltcG9ydCBcImpxdWVyeS11aS91aS9jb3JlXCI7XHJcbmltcG9ydCBcImpxdWVyeS11aS91aS93aWRnZXRzL3NlbGVjdGFibGVcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL3dpZGdldHMvc29ydGFibGVcIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL3dpZGdldHMvZHJhZ2dhYmxlXCI7XHJcbmltcG9ydCBcImpxdWVyeS11aS91aS9kaXNhYmxlLXNlbGVjdGlvblwiO1xyXG5pbXBvcnQgXCJqcXVlcnktdWkvdWkvcG9zaXRpb25cIjtcclxuaW1wb3J0IFwianF1ZXJ5LXVpL3VpL2VmZmVjdFwiO1xyXG5cclxuaW1wb3J0IHsgfSBmcm9tIFwiLi91dGlsLmpzXCI7XHJcblxyXG5pbXBvcnQgVnVlIGZyb20gXCJ2dWVcIjtcclxuaW1wb3J0IFZ1ZXggZnJvbSBcInZ1ZXhcIjtcclxuXHJcblZ1ZS5jb25maWcucHJvZHVjdGlvblRpcCA9IGZhbHNlO1xyXG5WdWUudXNlKFZ1ZXgpO1xyXG5cclxud2luZG93LmpRdWVyeSA9IGpRdWVyeTtcclxud2luZG93LiQgPSBqUXVlcnk7XHJcblxyXG5pZiAoIXdpbmRvdy5vbndoZWVsKSB7XHJcblx0d2luZG93Lm9ud2hlZWwgPSBmdW5jdGlvbiAoKSB7XHJcblx0fVxyXG59XHJcblxyXG5sZXQgaW5pdF90YXNrcyA9IFtdO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIEFkZEluaXRUYXNrKHRhc2spIHtcclxuXHRpbml0X3Rhc2tzLnB1c2godGFzayk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBJbml0QWxsKCkge1xyXG5cdGxldCBhID0gUHJvbWlzZS5hbGwoaW5pdF90YXNrcyk7XHJcblx0aW5pdF90YXNrcyA9IFtdO1xyXG5cdHJldHVybiBhO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/init.js\n");

/***/ }),

/***/ "./src/util.js":
/*!*********************!*\
  !*** ./src/util.js ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("\r\nwindow.DownloadData = (function () {\r\n\tlet a = document.createElement(\"a\");\r\n\tdocument.body.appendChild(a);\r\n\ta.style = \"display: none\";\r\n\ta.target = \"_blank\";\r\n\treturn function (text, type, fileName) {\r\n\t\tlet blob = new Blob([text], { type: type || \"octet/stream\" });\r\n\t\tlet url = window.URL.createObjectURL(blob);\r\n\t\tif (fileName && fileName != \"\") {\r\n\t\t\ta.href = url;\r\n\t\t\ta.download = fileName;\r\n\t\t\ta.click();\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//a.href = url;\r\n\t\t\t//a.click();\r\n\t\t\twindow.open(url, '_blank');\r\n\t\t}\r\n\t\twindow.URL.revokeObjectURL(url);\r\n\t};\r\n}());\r\n\r\nwindow.SelectText = function (elem) {\r\n\tvar range, selection;\r\n\r\n\tif (document.body.createTextRange) {\r\n\t\trange = document.body.createTextRange();\r\n\t\trange.moveToElementText(elem);\r\n\t\trange.select();\r\n\t}\r\n\telse if (window.getSelection) {\r\n\t\tselection = window.getSelection();\r\n\t\trange = document.createRange();\r\n\t\trange.selectNodeContents(elem);\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\t}\r\n}\r\nwindow.copyToClipboard = function (text) {\r\n\tvar $temp = $(\"<input>\");\r\n\t$(\"body\").append($temp);\r\n\t$temp.val(text).select();\r\n\tdocument.execCommand(\"copy\");\r\n\t$temp.remove();\r\n}\r\n\r\n/**\r\n * disable textNode \"#text\"\r\n * @param {string} xml - xml\r\n * @param {string[]=} arrayTags - optional\r\n * @returns {object}\r\n */\r\nfunction parseXml(xml, arrayTags) {\r\n\tvar dom = null;\r\n\tif (window.DOMParser) {\r\n\t\tdom = (new DOMParser()).parseFromString(xml, \"text/xml\");\r\n\t}\r\n\telse if (window.ActiveXObject) {\r\n\t\tdom = new ActiveXObject('Microsoft.XMLDOM');\r\n\t\tdom.async = false;\r\n\t\tif (!dom.loadXML(xml)) {\r\n\t\t\tthrow dom.parseError.reason + \" \" + dom.parseError.srcText;\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\tthrow \"cannot parse xml string!\";\r\n\t}\r\n\r\n\tfunction isArray(o) {\r\n\t\treturn Object.prototype.toString.apply(o) === '[object Array]';\r\n\t}\r\n\r\n\tfunction parseNode(xmlNode, result) {\r\n\t\tif (xmlNode.nodeName == \"#text\" && xmlNode.nodeValue.trim() == \"\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar jsonNode = {};\r\n\t\tvar existing = result[xmlNode.nodeName];\r\n\t\tif (existing) {\r\n\t\t\tif (!isArray(existing)) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [existing, jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName].push(jsonNode);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (arrayTags && arrayTags.indexOf(xmlNode.nodeName) != -1) {\r\n\t\t\t\tresult[xmlNode.nodeName] = [jsonNode];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tresult[xmlNode.nodeName] = jsonNode;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (xmlNode.attributes) {\r\n\t\t\tvar length = xmlNode.attributes.length;\r\n\t\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\t\tvar attribute = xmlNode.attributes[i];\r\n\t\t\t\tjsonNode[attribute.nodeName] = attribute.nodeValue;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar length = xmlNode.childNodes.length;\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t\tparseNode(xmlNode.childNodes[i], jsonNode);\r\n\t\t}\r\n\t}\r\n\r\n\tvar result = {};\r\n\tif (dom.childNodes.length) {\r\n\t\tparseNode(dom.childNodes[0], result);\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdXRpbC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy91dGlsLmpzP2UwZWIiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbndpbmRvdy5Eb3dubG9hZERhdGEgPSAoZnVuY3Rpb24gKCkge1xyXG5cdGxldCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIik7XHJcblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTtcclxuXHRhLnN0eWxlID0gXCJkaXNwbGF5OiBub25lXCI7XHJcblx0YS50YXJnZXQgPSBcIl9ibGFua1wiO1xyXG5cdHJldHVybiBmdW5jdGlvbiAodGV4dCwgdHlwZSwgZmlsZU5hbWUpIHtcclxuXHRcdGxldCBibG9iID0gbmV3IEJsb2IoW3RleHRdLCB7IHR5cGU6IHR5cGUgfHwgXCJvY3RldC9zdHJlYW1cIiB9KTtcclxuXHRcdGxldCB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcclxuXHRcdGlmIChmaWxlTmFtZSAmJiBmaWxlTmFtZSAhPSBcIlwiKSB7XHJcblx0XHRcdGEuaHJlZiA9IHVybDtcclxuXHRcdFx0YS5kb3dubG9hZCA9IGZpbGVOYW1lO1xyXG5cdFx0XHRhLmNsaWNrKCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Ly9hLmhyZWYgPSB1cmw7XHJcblx0XHRcdC8vYS5jbGljaygpO1xyXG5cdFx0XHR3aW5kb3cub3Blbih1cmwsICdfYmxhbmsnKTtcclxuXHRcdH1cclxuXHRcdHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcblx0fTtcclxufSgpKTtcclxuXHJcbndpbmRvdy5TZWxlY3RUZXh0ID0gZnVuY3Rpb24gKGVsZW0pIHtcclxuXHR2YXIgcmFuZ2UsIHNlbGVjdGlvbjtcclxuXHJcblx0aWYgKGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKSB7XHJcblx0XHRyYW5nZSA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XHJcblx0XHRyYW5nZS5tb3ZlVG9FbGVtZW50VGV4dChlbGVtKTtcclxuXHRcdHJhbmdlLnNlbGVjdCgpO1xyXG5cdH1cclxuXHRlbHNlIGlmICh3aW5kb3cuZ2V0U2VsZWN0aW9uKSB7XHJcblx0XHRzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7XHJcblx0XHRyYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XHJcblx0XHRyYW5nZS5zZWxlY3ROb2RlQ29udGVudHMoZWxlbSk7XHJcblx0XHRzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7XHJcblx0XHRzZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xyXG5cdH1cclxufVxyXG53aW5kb3cuY29weVRvQ2xpcGJvYXJkID0gZnVuY3Rpb24gKHRleHQpIHtcclxuXHR2YXIgJHRlbXAgPSAkKFwiPGlucHV0PlwiKTtcclxuXHQkKFwiYm9keVwiKS5hcHBlbmQoJHRlbXApO1xyXG5cdCR0ZW1wLnZhbCh0ZXh0KS5zZWxlY3QoKTtcclxuXHRkb2N1bWVudC5leGVjQ29tbWFuZChcImNvcHlcIik7XHJcblx0JHRlbXAucmVtb3ZlKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBkaXNhYmxlIHRleHROb2RlIFwiI3RleHRcIlxyXG4gKiBAcGFyYW0ge3N0cmluZ30geG1sIC0geG1sXHJcbiAqIEBwYXJhbSB7c3RyaW5nW109fSBhcnJheVRhZ3MgLSBvcHRpb25hbFxyXG4gKiBAcmV0dXJucyB7b2JqZWN0fVxyXG4gKi9cclxuZnVuY3Rpb24gcGFyc2VYbWwoeG1sLCBhcnJheVRhZ3MpIHtcclxuXHR2YXIgZG9tID0gbnVsbDtcclxuXHRpZiAod2luZG93LkRPTVBhcnNlcikge1xyXG5cdFx0ZG9tID0gKG5ldyBET01QYXJzZXIoKSkucGFyc2VGcm9tU3RyaW5nKHhtbCwgXCJ0ZXh0L3htbFwiKTtcclxuXHR9XHJcblx0ZWxzZSBpZiAod2luZG93LkFjdGl2ZVhPYmplY3QpIHtcclxuXHRcdGRvbSA9IG5ldyBBY3RpdmVYT2JqZWN0KCdNaWNyb3NvZnQuWE1MRE9NJyk7XHJcblx0XHRkb20uYXN5bmMgPSBmYWxzZTtcclxuXHRcdGlmICghZG9tLmxvYWRYTUwoeG1sKSkge1xyXG5cdFx0XHR0aHJvdyBkb20ucGFyc2VFcnJvci5yZWFzb24gKyBcIiBcIiArIGRvbS5wYXJzZUVycm9yLnNyY1RleHQ7XHJcblx0XHR9XHJcblx0fVxyXG5cdGVsc2Uge1xyXG5cdFx0dGhyb3cgXCJjYW5ub3QgcGFyc2UgeG1sIHN0cmluZyFcIjtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGlzQXJyYXkobykge1xyXG5cdFx0cmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuYXBwbHkobykgPT09ICdbb2JqZWN0IEFycmF5XSc7XHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBwYXJzZU5vZGUoeG1sTm9kZSwgcmVzdWx0KSB7XHJcblx0XHRpZiAoeG1sTm9kZS5ub2RlTmFtZSA9PSBcIiN0ZXh0XCIgJiYgeG1sTm9kZS5ub2RlVmFsdWUudHJpbSgpID09IFwiXCIpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHZhciBqc29uTm9kZSA9IHt9O1xyXG5cdFx0dmFyIGV4aXN0aW5nID0gcmVzdWx0W3htbE5vZGUubm9kZU5hbWVdO1xyXG5cdFx0aWYgKGV4aXN0aW5nKSB7XHJcblx0XHRcdGlmICghaXNBcnJheShleGlzdGluZykpIHtcclxuXHRcdFx0XHRyZXN1bHRbeG1sTm9kZS5ub2RlTmFtZV0gPSBbZXhpc3RpbmcsIGpzb25Ob2RlXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZXN1bHRbeG1sTm9kZS5ub2RlTmFtZV0ucHVzaChqc29uTm9kZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRpZiAoYXJyYXlUYWdzICYmIGFycmF5VGFncy5pbmRleE9mKHhtbE5vZGUubm9kZU5hbWUpICE9IC0xKSB7XHJcblx0XHRcdFx0cmVzdWx0W3htbE5vZGUubm9kZU5hbWVdID0gW2pzb25Ob2RlXTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRyZXN1bHRbeG1sTm9kZS5ub2RlTmFtZV0gPSBqc29uTm9kZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh4bWxOb2RlLmF0dHJpYnV0ZXMpIHtcclxuXHRcdFx0dmFyIGxlbmd0aCA9IHhtbE5vZGUuYXR0cmlidXRlcy5sZW5ndGg7XHJcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0XHR2YXIgYXR0cmlidXRlID0geG1sTm9kZS5hdHRyaWJ1dGVzW2ldO1xyXG5cdFx0XHRcdGpzb25Ob2RlW2F0dHJpYnV0ZS5ub2RlTmFtZV0gPSBhdHRyaWJ1dGUubm9kZVZhbHVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dmFyIGxlbmd0aCA9IHhtbE5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHBhcnNlTm9kZSh4bWxOb2RlLmNoaWxkTm9kZXNbaV0sIGpzb25Ob2RlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHZhciByZXN1bHQgPSB7fTtcclxuXHRpZiAoZG9tLmNoaWxkTm9kZXMubGVuZ3RoKSB7XHJcblx0XHRwYXJzZU5vZGUoZG9tLmNoaWxkTm9kZXNbMF0sIHJlc3VsdCk7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gcmVzdWx0O1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/util.js\n");

/***/ })

}]);