(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{328:function(t,e,i){"use strict";i.r(e),i.d(e,"GlobalVar",function(){return o}),i.d(e,"$gv",function(){return r});i(353),i(333),i(335);var s=i(332),n=i(375);class o{constructor(){this.m_is_run=!0,this.MAX_FPS=60,this.FRAME_ELAPSED=1e3/60,this.CANVAS_SCALE=32,this.m_editor_mode=!1,this.m_display_foothold=!1,this.m_display_physics_debug=!1,this.m_display_debug_info=!1,this.m_debugDraw=new n.a,this.m_display_selected_object=!1,this.m_selected_object=null,this.m_hover_object=null,this.m_viewRect=new s.Rectangle(0,-384,1366,768),this.m_is_rendering_map=!0,this.m_display_back=!0,this.m_display_front=!0,this.m_display_mapobj=!0,this.m_display_maptile=!0,this.m_display_particle_system=!0,this.m_display_skeletal_anim=!0,this.m_display_portal=!0,this.m_display_player=!0,this.m_display_other_player=!0,this.m_display_life=!0,this.m_display_npc=!0,this.m_display_mob=!0,this.ChatBalloon_default_style=0,this.ChatBalloon_display_duration=5e3,this.input_keyDown={},this.input_keyUp={},this.mouse_move=0,this.mouse_x=0,this.mouse_y=0,this.mouse_dl=0,this.mouse_ul=0,this.mouse_dm=0,this.mouse_um=0,this.mouse_dr=0,this.mouse_ur=0;{let t={layeredObjects:[]};for(let e=0;e<12;++e){let i=t.layeredObjects[e]={};Object.defineProperty(i,"length",{enumerable:!1,writable:!0,value:0})}t.Update=function(e){for(let i=0;i<t.layeredObjects.length;++i){const s=t.layeredObjects[i];for(let t in s){s[t].update(e)}}},t.RenderLayer=function(e,i){const s=t.layeredObjects[i];for(let t in s){s[t].render(e)}},t.addToScene=function(e,i){if(!(Number.isSafeInteger(e)&&e in t.layeredObjects))throw new TypeError("layer");{const s=t.layeredObjects[e];i.$layer=e,i.$objectid=s.length,s[i.$objectid]=i,s.length++}},t.destroy=function(e){const i=e.$layer,s=e.$objectid,n=t.layeredObjects[i];e.destroy(),delete n[s]},this.SceneObjectMgr=t}}}const r=new o;window.$gv=r},344:function(t,e,i){"use strict";function s(t,...e){}i.d(e,"b",function(){return s}),i.d(e,"x",function(){return n}),i.d(e,"r",function(){return o}),i.d(e,"s",function(){return r}),i.d(e,"P",function(){return a}),i.d(e,"z",function(){return l}),i.d(e,"D",function(){return m}),i.d(e,"k",function(){return h}),i.d(e,"l",function(){return _}),i.d(e,"v",function(){return c}),i.d(e,"n",function(){return u}),i.d(e,"Q",function(){return d}),i.d(e,"G",function(){return f}),i.d(e,"H",function(){return p}),i.d(e,"T",function(){return A}),i.d(e,"y",function(){return y}),i.d(e,"w",function(){return x}),i.d(e,"I",function(){return B}),i.d(e,"J",function(){return S}),i.d(e,"E",function(){return C}),i.d(e,"F",function(){return b}),i.d(e,"p",function(){return g}),i.d(e,"S",function(){return V}),i.d(e,"t",function(){return w}),i.d(e,"B",function(){return v}),i.d(e,"O",function(){return M}),i.d(e,"N",function(){return P}),i.d(e,"C",function(){return I}),i.d(e,"A",function(){return G}),i.d(e,"K",function(){return D}),i.d(e,"L",function(){return F}),i.d(e,"M",function(){return R}),i.d(e,"o",function(){return L}),i.d(e,"R",function(){return T}),i.d(e,"u",function(){return k}),i.d(e,"m",function(){return z}),i.d(e,"a",function(){return j}),i.d(e,"c",function(){return q}),i.d(e,"d",function(){return O}),i.d(e,"j",function(){return N}),i.d(e,"U",function(){return J}),i.d(e,"q",function(){return E}),i.d(e,"h",function(){return X}),i.d(e,"i",function(){return W}),i.d(e,"e",function(){return U}),i.d(e,"f",function(){return Z}),i.d(e,"g",function(){return H});const n=1e37,o=1e-5,r=o*o,a=3.14159265359,l=2,m=8,h=.1,_=2,c=.008,u=2/180*a,d=2*c,f=8,p=32,A=1,y=.2,x=8/180*a,B=2,S=B*B,C=.5*a,b=C*C,g=.2,V=.75,w=-1,v=2147483647,M=.75,P=1,I=.25,G=.5,D=2,F=D*D,R=256,L=2.5,T=.5,k=.01,z=2/180*a;function j(t){return null}function q(t){}function O(t,...e){}class N{constructor(t=0,e=0,i=0){this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=i}toString(){return this.major+"."+this.minor+"."+this.revision}}const J=new N(2,3,2),E=313;function X(t){return parseInt(t,10)}function W(t){return Math.abs(parseInt(t,10))}function U(t,e){let i=[];for(let s=0;s<t;++s)i.push(e(s));return i}function Z(t){const e=[];for(let i=0;i<t;++i)e.push(null);return e}function H(t,e=0){const i=[];for(let s=0;s<t;++s)i.push(e);return i}},345:function(t,e,i){"use strict";i.d(e,"E",function(){return n}),i.d(e,"D",function(){return o}),i.d(e,"F",function(){return r}),i.d(e,"a",function(){return a}),i.d(e,"n",function(){return l}),i.d(e,"m",function(){return m}),i.d(e,"e",function(){return h}),i.d(e,"x",function(){return _}),i.d(e,"j",function(){return c}),i.d(e,"v",function(){return u}),i.d(e,"h",function(){return d}),i.d(e,"w",function(){return f}),i.d(e,"p",function(){return p}),i.d(e,"g",function(){return A}),i.d(e,"q",function(){return y}),i.d(e,"f",function(){return x}),i.d(e,"u",function(){return B}),i.d(e,"b",function(){return S}),i.d(e,"c",function(){return C}),i.d(e,"d",function(){return b}),i.d(e,"o",function(){return g}),i.d(e,"i",function(){return V}),i.d(e,"r",function(){return w}),i.d(e,"s",function(){return v}),i.d(e,"A",function(){return M}),i.d(e,"B",function(){return P}),i.d(e,"C",function(){return D}),i.d(e,"k",function(){return L}),i.d(e,"l",function(){return T}),i.d(e,"t",function(){return k}),i.d(e,"z",function(){return N}),i.d(e,"y",function(){return J});var s=i(344);const n=s.P/180,o=180/s.P,r=2*s.P,a=Math.abs,l=Math.min,m=Math.max;function h(t,e,i){return t<e?e:t>i?i:t}function _(t,e){const i=t[0];t[0]=e[0],e[0]=i}function c(t){return isFinite(t)}function u(t){return t*t}function d(t){return 1/Math.sqrt(t)}const f=Math.sqrt,p=Math.pow;function A(t){return t*n}function y(t){return t*o}const x=Math.cos,B=Math.sin,S=Math.acos,C=Math.asin,b=Math.atan2;function g(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1}function V(t){return t>0&&0==(t&t-1)}function w(){return 2*Math.random()-1}function v(t,e){return(e-t)*Math.random()+t}class M{constructor(t=0,e=0){this.x=t,this.y=e}Clone(){return new M(this.x,this.y)}SetZero(){return this.x=0,this.y=0,this}Set(t,e){return this.x=t,this.y=e,this}Copy(t){return this.x=t.x,this.y=t.y,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this}SelfAddXY(t,e){return this.x+=t,this.y+=e,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this}SelfSubXY(t,e){return this.x-=t,this.y-=e,this}SelfMul(t){return this.x*=t,this.y*=t,this}SelfMulAdd(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}SelfMulSub(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}Dot(t){return this.x*t.x+this.y*t.y}Cross(t){return this.x*t.y-this.y*t.x}Length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}LengthSquared(){const t=this.x,e=this.y;return t*t+e*e}Normalize(){const t=this.Length();if(t>=s.r){const e=1/t;this.x*=e,this.y*=e}return t}SelfNormalize(){const t=this.Length();if(t>=s.r){const e=1/t;this.x*=e,this.y*=e}return this}SelfRotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.x;return this.x=e*s-i*this.y,this.y=i*s+e*this.y,this}IsValid(){return isFinite(this.x)&&isFinite(this.y)}SelfCrossVS(t){const e=this.x;return this.x=t*this.y,this.y=-t*e,this}SelfCrossSV(t){const e=this.x;return this.x=-t*this.y,this.y=t*e,this}SelfMinV(t){return this.x=l(this.x,t.x),this.y=l(this.y,t.y),this}SelfMaxV(t){return this.x=m(this.x,t.x),this.y=m(this.y,t.y),this}SelfAbs(){return this.x=a(this.x),this.y=a(this.y),this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this}SelfSkew(){const t=this.x;return this.x=-this.y,this.y=t,this}static MakeArray(t){return Object(s.e)(t,t=>new M)}static AbsV(t,e){return function(t,e){return e.x=a(t.x),e.y=a(t.y),e}(t,e)}static MinV(t,e,i){return function(t,e,i){return i.x=l(t.x,e.x),i.y=l(t.y,e.y),i}(t,e,i)}static MaxV(t,e,i){return function(t,e,i){return i.x=m(t.x,e.x),i.y=m(t.y,e.y),i}(t,e,i)}static ClampV(t,e,i,s){return function(t,e,i,s){return s.x=h(t.x,e.x,i.x),s.y=h(t.y,e.y,i.y),s}(t,e,i,s)}static RotateV(t,e,i){return function(t,e,i){const s=t.x,n=t.y,o=Math.cos(e),r=Math.sin(e);return i.x=o*s-r*n,i.y=r*s+o*n,i}(t,e,i)}static DotVV(t,e){return function(t,e){return t.x*e.x+t.y*e.y}(t,e)}static CrossVV(t,e){return function(t,e){return t.x*e.y-t.y*e.x}(t,e)}static CrossVS(t,e,i){return function(t,e,i){const s=t.x;return i.x=e*t.y,i.y=-e*s,i}(t,e,i)}static CrossVOne(t,e){return function(t,e){const i=t.x;return e.x=t.y,e.y=-i,e}(t,e)}static CrossSV(t,e,i){return function(t,e,i){const s=e.x;return i.x=-t*e.y,i.y=t*s,i}(t,e,i)}static CrossOneV(t,e){return function(t,e){const i=t.x;return e.x=-t.y,e.y=i,e}(t,e)}static AddVV(t,e,i){return I(t,e,i)}static SubVV(t,e,i){return G(t,e,i)}static MulSV(t,e,i){return function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}(t,e,i)}static MulVS(t,e,i){return function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}(t,e,i)}static AddVMulSV(t,e,i,s){return function(t,e,i,s){return s.x=t.x+e*i.x,s.y=t.y+e*i.y,s}(t,e,i,s)}static SubVMulSV(t,e,i,s){return function(t,e,i,s){return s.x=t.x-e*i.x,s.y=t.y-e*i.y,s}(t,e,i,s)}static AddVCrossSV(t,e,i,s){return function(t,e,i,s){const n=i.x;return s.x=t.x-e*i.y,s.y=t.y+e*n,s}(t,e,i,s)}static MidVV(t,e,i){return function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}(t,e,i)}static ExtVV(t,e,i){return function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}(t,e,i)}static IsEqualToV(t,e){return function(t,e){return t.x===e.x&&t.y===e.y}(t,e)}static DistanceVV(t,e){return function(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}(t,e)}static DistanceSquaredVV(t,e){return function(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s}(t,e)}static NegV(t,e){return function(t,e){return e.x=-t.x,e.y=-t.y,e}(t,e)}}M.ZERO=new M(0,0),M.UNITX=new M(1,0),M.UNITY=new M(0,1),M.s_t0=new M,M.s_t1=new M,M.s_t2=new M,M.s_t3=new M;const P=new M(0,0);function I(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}function G(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}class D{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}Clone(){return new D(this.x,this.y,this.z)}SetZero(){return this.x=0,this.y=0,this.z=0,this}SetXYZ(t,e,i){return this.x=t,this.y=e,this.z=i,this}Copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}SelfNeg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}SelfAdd(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}SelfAddXYZ(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}SelfSub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}SelfSubXYZ(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}SelfMul(t){return this.x*=t,this.y*=t,this.z*=t,this}static DotV3V3(t,e){return F(t,e)}static CrossV3V3(t,e,i){return R(t,e,i)}}function F(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function R(t,e,i){const s=t.x,n=t.y,o=t.z,r=e.x,a=e.y,l=e.z;return i.x=n*l-o*a,i.y=o*r-s*l,i.z=s*a-n*r,i}D.ZERO=new D(0,0,0),D.s_t0=new D;class L{constructor(){this.ex=new M(1,0),this.ey=new M(0,1)}Clone(){return(new L).Copy(this)}static FromVV(t,e){return(new L).SetVV(t,e)}static FromSSSS(t,e,i,s){return(new L).SetSSSS(t,e,i,s)}static FromAngle(t){return(new L).SetAngle(t)}SetSSSS(t,e,i,s){return this.ex.Set(t,i),this.ey.Set(e,s),this}SetVV(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}SetAngle(t){const e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}SetIdentity(){return this.ex.Set(1,0),this.ey.Set(0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this}GetAngle(){return Math.atan2(this.ex.y,this.ex.x)}GetInverse(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;return 0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.y=-o*s,t.ey.y=o*e,t}Solve(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}SelfAbs(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}SelfInv(){return this.GetInverse(this)}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}SelfSubM(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}static AbsM(t,e){return function(t,e){const i=t.ex,s=t.ey;return e.ex.x=a(i.x),e.ex.y=a(i.y),e.ey.x=a(s.x),e.ey.y=a(s.y),e}(t,e)}static MulMV(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+n.x*r,i.y=s.y*o+n.y*r,i}(t,e,i)}static MulTMV(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.x,r=e.y;return i.x=s.x*o+s.y*r,i.y=n.x*o+n.y*r,i}(t,e,i)}static AddMM(t,e,i){return function(t,e,i){const s=t.ex,n=t.ey,o=e.ex,r=e.ey;return i.ex.x=s.x+o.x,i.ex.y=s.y+o.y,i.ey.x=n.x+r.x,i.ey.y=n.y+r.y,i}(t,e,i)}static MulMM(t,e,i){return function(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,m=e.ey.x,h=e.ey.y;return i.ex.x=s*a+o*l,i.ex.y=n*a+r*l,i.ey.x=s*m+o*h,i.ey.y=n*m+r*h,i}(t,e,i)}static MulTMM(t,e,i){return function(t,e,i){const s=t.ex.x,n=t.ex.y,o=t.ey.x,r=t.ey.y,a=e.ex.x,l=e.ex.y,m=e.ey.x,h=e.ey.y;return i.ex.x=s*a+n*l,i.ex.y=o*a+r*l,i.ey.x=s*m+n*h,i.ey.y=o*m+r*h,i}(t,e,i)}}L.IDENTITY=new L;class T{constructor(){this.ex=new D(1,0,0),this.ey=new D(0,1,0),this.ez=new D(0,0,1)}Clone(){return(new T).Copy(this)}SetVVV(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}Copy(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}SetIdentity(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}SetZero(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}SelfAddM(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}Solve33(t,e,i,s){const n=this.ex.x,o=this.ex.y,r=this.ex.z,a=this.ey.x,l=this.ey.y,m=this.ey.z,h=this.ez.x,_=this.ez.y,c=this.ez.z;let u=n*(l*c-m*_)+o*(m*h-a*c)+r*(a*_-l*h);return 0!==u&&(u=1/u),s.x=u*(t*(l*c-m*_)+e*(m*h-a*c)+i*(a*_-l*h)),s.y=u*(n*(e*c-i*_)+o*(i*h-t*c)+r*(t*_-e*h)),s.z=u*(n*(l*i-m*e)+o*(m*t-a*i)+r*(a*e-l*t)),s}Solve22(t,e,i){const s=this.ex.x,n=this.ey.x,o=this.ex.y,r=this.ey.y;let a=s*r-n*o;return 0!==a&&(a=1/a),i.x=a*(r*t-n*e),i.y=a*(s*e-o*t),i}GetInverse22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,n=this.ey.y;let o=e*n-i*s;0!==o&&(o=1/o),t.ex.x=o*n,t.ey.x=-o*i,t.ex.z=0,t.ex.y=-o*s,t.ey.y=o*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}GetSymInverse33(t){let e=F(this.ex,R(this.ey,this.ez,D.s_t0));0!==e&&(e=1/e);const i=this.ex.x,s=this.ey.x,n=this.ez.x,o=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(o*a-r*r),t.ex.y=e*(n*r-s*a),t.ex.z=e*(s*r-n*o),t.ey.x=t.ex.y,t.ey.y=e*(i*a-n*n),t.ey.z=e*(n*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*o-s*s)}static MulM33V3(t,e,i){return function(t,e,i){const s=e.x,n=e.y,o=e.z;return i.x=t.ex.x*s+t.ey.x*n+t.ez.x*o,i.y=t.ex.y*s+t.ey.y*n+t.ez.y*o,i.z=t.ex.z*s+t.ey.z*n+t.ez.z*o,i}(t,e,i)}static MulM33XYZ(t,e,i,s,n){return function(t,e,i,s,n){return n.x=t.ex.x*e+t.ey.x*i+t.ez.x*s,n.y=t.ex.y*e+t.ey.y*i+t.ez.y*s,n.z=t.ex.z*e+t.ey.z*i+t.ez.z*s,n}(t,e,i,s,n)}static MulM33V2(t,e,i){return function(t,e,i){const s=e.x,n=e.y;return i.x=t.ex.x*s+t.ey.x*n,i.y=t.ex.y*s+t.ey.y*n,i}(t,e,i)}static MulM33XY(t,e,i,s){return function(t,e,i,s){return s.x=t.ex.x*e+t.ey.x*i,s.y=t.ex.y*e+t.ey.y*i,s}(t,e,i,s)}}T.IDENTITY=new T;class k{constructor(t=0){this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}Clone(){return(new k).Copy(this)}Copy(t){return this.s=t.s,this.c=t.c,this}SetAngle(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}SetIdentity(){return this.s=0,this.c=1,this}GetAngle(){return Math.atan2(this.s,this.c)}GetXAxis(t){return t.x=this.c,t.y=this.s,t}GetYAxis(t){return t.x=-this.s,t.y=this.c,t}static MulRR(t,e,i){return z(t,e,i)}static MulTRR(t,e,i){return j(t,e,i)}static MulRV(t,e,i){return q(t,e,i)}static MulTRV(t,e,i){return O(t,e,i)}}function z(t,e,i){const s=t.c,n=t.s,o=e.c,r=e.s;return i.s=n*o+s*r,i.c=s*o-n*r,i}function j(t,e,i){const s=t.c,n=t.s,o=e.c,r=e.s;return i.s=s*r-n*o,i.c=s*o+n*r,i}function q(t,e,i){const s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o-n*r,i.y=n*o+s*r,i}function O(t,e,i){const s=t.c,n=t.s,o=e.x,r=e.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}k.IDENTITY=new k;class N{constructor(){this.p=new M,this.q=new k}Clone(){return(new N).Copy(this)}Copy(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}SetIdentity(){return this.p.SetZero(),this.q.SetIdentity(),this}SetPositionRotation(t,e){return this.p.Copy(t),this.q.Copy(e),this}SetPositionAngle(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}SetPosition(t){return this.p.Copy(t),this}SetPositionXY(t,e){return this.p.Set(t,e),this}SetRotation(t){return this.q.Copy(t),this}SetRotationAngle(t){return this.q.SetAngle(t),this}GetPosition(){return this.p}GetRotation(){return this.q}GetRotationAngle(){return this.q.GetAngle()}GetAngle(){return this.q.GetAngle()}static MulXV(t,e,i){return function(t,e,i){const s=t.q.c,n=t.q.s,o=e.x,r=e.y;return i.x=s*o-n*r+t.p.x,i.y=n*o+s*r+t.p.y,i}(t,e,i)}static MulTXV(t,e,i){return function(t,e,i){const s=t.q.c,n=t.q.s,o=e.x-t.p.x,r=e.y-t.p.y;return i.x=s*o+n*r,i.y=-n*o+s*r,i}(t,e,i)}static MulXX(t,e,i){return function(t,e,i){return z(t.q,e.q,i.q),I(q(t.q,e.p,i.p),t.p,i.p),i}(t,e,i)}static MulTXX(t,e,i){return function(t,e,i){return j(t.q,e.q,i.q),O(t.q,G(e.p,t.p,i.p),i.p),i}(t,e,i)}}N.IDENTITY=new N;class J{constructor(){this.localCenter=new M,this.c0=new M,this.c=new M,this.a0=0,this.a=0,this.alpha0=0}Clone(){return(new J).Copy(this)}Copy(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}GetTransform(t,e){const i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;const s=i*this.a0+e*this.a;return t.q.SetAngle(s),t.p.SelfSub(q(t.q,this.localCenter,M.s_t0)),t}Advance(t){const e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}Normalize(){const t=r*Math.floor(this.a0/r);this.a0-=t,this.a-=t}}},346:function(t,e,i){"use strict";i.d(e,"e",function(){return s}),i.d(e,"d",function(){return m}),i.d(e,"f",function(){return h}),i.d(e,"i",function(){return _}),i.d(e,"j",function(){return n}),i.d(e,"h",function(){return c}),i.d(e,"p",function(){return u}),i.d(e,"k",function(){return o}),i.d(e,"g",function(){return d}),i.d(e,"c",function(){return f}),i.d(e,"l",function(){return p}),i.d(e,"m",function(){return A}),i.d(e,"a",function(){return y}),i.d(e,"n",function(){return x}),i.d(e,"b",function(){return B}),i.d(e,"o",function(){return g});var s,n,o,r=i(344),a=i(345),l=i(359);!function(t){t[t.e_vertex=0]="e_vertex",t[t.e_face=1]="e_face"}(s||(s={}));class m{constructor(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}get key(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key}set key(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}get indexA(){return this._indexA}set indexA(t){this._indexA=t,this._key_invalid=!0}get indexB(){return this._indexB}set indexB(t){this._indexB=t,this._key_invalid=!0}get typeA(){return this._typeA}set typeA(t){this._typeA=t,this._key_invalid=!0}get typeB(){return this._typeB}set typeB(t){this._typeB=t,this._key_invalid=!0}}class h{constructor(){this.cf=new m}Copy(t){return this.key=t.key,this}Clone(){return(new h).Copy(this)}get key(){return this.cf.key}set key(t){this.cf.key=t}}class _{constructor(){this.localPoint=new a.A,this.normalImpulse=0,this.tangentImpulse=0,this.id=new h}static MakeArray(t){return Object(r.e)(t,t=>new _)}Reset(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}Copy(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circles=0]="e_circles",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(n||(n={}));class c{constructor(){this.points=_.MakeArray(r.z),this.localNormal=new a.A,this.localPoint=new a.A,this.type=n.e_unknown,this.pointCount=0}Reset(){for(let t=0;t<r.z;++t)this.points[t].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=n.e_unknown,this.pointCount=0}Copy(t){this.pointCount=t.pointCount;for(let e=0;e<r.z;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}Clone(){return(new c).Copy(this)}}class u{constructor(){this.normal=new a.A,this.points=a.A.MakeArray(r.z),this.separations=Object(r.g)(r.z)}Initialize(t,e,i,s,o){if(0!==t.pointCount)switch(t.type){case n.e_circles:{this.normal.Set(1,0);const n=a.z.MulXV(e,t.localPoint,u.Initialize_s_pointA),l=a.z.MulXV(s,t.points[0].localPoint,u.Initialize_s_pointB);a.A.DistanceSquaredVV(n,l)>r.s&&a.A.SubVV(l,n,this.normal).SelfNormalize();const m=a.A.AddVMulSV(n,i,this.normal,u.Initialize_s_cA),h=a.A.SubVMulSV(l,o,this.normal,u.Initialize_s_cB);a.A.MidVV(m,h,this.points[0]),this.separations[0]=a.A.DotVV(a.A.SubVV(h,m,a.A.s_t0),this.normal)}break;case n.e_faceA:{a.t.MulRV(e.q,t.localNormal,this.normal);const n=a.z.MulXV(e,t.localPoint,u.Initialize_s_planePoint);for(let e=0;e<t.pointCount;++e){const r=a.z.MulXV(s,t.points[e].localPoint,u.Initialize_s_clipPoint),l=i-a.A.DotVV(a.A.SubVV(r,n,a.A.s_t0),this.normal),m=a.A.AddVMulSV(r,l,this.normal,u.Initialize_s_cA),h=a.A.SubVMulSV(r,o,this.normal,u.Initialize_s_cB);a.A.MidVV(m,h,this.points[e]),this.separations[e]=a.A.DotVV(a.A.SubVV(h,m,a.A.s_t0),this.normal)}}break;case n.e_faceB:{a.t.MulRV(s.q,t.localNormal,this.normal);const n=a.z.MulXV(s,t.localPoint,u.Initialize_s_planePoint);for(let s=0;s<t.pointCount;++s){const r=a.z.MulXV(e,t.points[s].localPoint,u.Initialize_s_clipPoint),l=o-a.A.DotVV(a.A.SubVV(r,n,a.A.s_t0),this.normal),m=a.A.AddVMulSV(r,l,this.normal,u.Initialize_s_cB),h=a.A.SubVMulSV(r,i,this.normal,u.Initialize_s_cA);a.A.MidVV(h,m,this.points[s]),this.separations[s]=a.A.DotVV(a.A.SubVV(h,m,a.A.s_t0),this.normal)}this.normal.SelfNeg()}}}}function d(t,e,i,s){let n;for(n=0;n<i.pointCount;++n){const e=i.points[n].id.key;t[n]=o.b2_removeState;for(let i=0,r=s.pointCount;i<r;++i)if(s.points[i].id.key===e){t[n]=o.b2_persistState;break}}for(;n<r.z;++n)t[n]=o.b2_nullState;for(n=0;n<s.pointCount;++n){const t=s.points[n].id.key;e[n]=o.b2_addState;for(let s=0,r=i.pointCount;s<r;++s)if(i.points[s].id.key===t){e[n]=o.b2_persistState;break}}for(;n<r.z;++n)e[n]=o.b2_nullState}u.Initialize_s_pointA=new a.A,u.Initialize_s_pointB=new a.A,u.Initialize_s_cA=new a.A,u.Initialize_s_cB=new a.A,u.Initialize_s_planePoint=new a.A,u.Initialize_s_clipPoint=new a.A,function(t){t[t.b2_nullState=0]="b2_nullState",t[t.b2_addState=1]="b2_addState",t[t.b2_persistState=2]="b2_persistState",t[t.b2_removeState=3]="b2_removeState"}(o||(o={}));class f{constructor(){this.v=new a.A,this.id=new h}static MakeArray(t){return Object(r.e)(t,t=>new f)}Copy(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}class p{constructor(){this.p1=new a.A,this.p2=new a.A,this.maxFraction=1}Copy(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}class A{constructor(){this.normal=new a.A,this.fraction=0}Copy(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}class y{constructor(){this.lowerBound=new a.A,this.upperBound=new a.A,this.m_cache_center=new a.A,this.m_cache_extent=new a.A}Copy(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}IsValid(){const t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y;let i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()}GetCenter(){return a.A.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}GetExtents(){return a.A.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}GetPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}Combine1(t){return this.lowerBound.x=Object(a.n)(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Object(a.n)(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=Object(a.m)(this.upperBound.x,t.upperBound.x),this.upperBound.y=Object(a.m)(this.upperBound.y,t.upperBound.y),this}Combine2(t,e){return this.lowerBound.x=Object(a.n)(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=Object(a.n)(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=Object(a.m)(t.upperBound.x,e.upperBound.x),this.upperBound.y=Object(a.m)(t.upperBound.y,e.upperBound.y),this}static Combine(t,e,i){return i.Combine2(t,e),i}Contains(t){let e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}RayCast(t,e){let i=-r.x,s=r.x;const n=e.p1.x,o=e.p1.y,l=e.p2.x-e.p1.x,m=e.p2.y-e.p1.y,h=Object(a.a)(l),_=Object(a.a)(m),c=t.normal;if(h<r.r){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{const t=1/l;let e=(this.lowerBound.x-n)*t,o=(this.upperBound.x-n)*t,r=-1;if(e>o){const t=e;e=o,o=t,r=1}if(e>i&&(c.x=r,c.y=0,i=e),i>(s=Object(a.n)(s,o)))return!1}if(_<r.r){if(o<this.lowerBound.y||this.upperBound.y<o)return!1}else{const t=1/m;let e=(this.lowerBound.y-o)*t,n=(this.upperBound.y-o)*t,r=-1;if(e>n){const t=e;e=n,n=t,r=1}if(e>i&&(c.x=0,c.y=r,i=e),i>(s=Object(a.n)(s,n)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}TestOverlap(t){const e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,s=this.lowerBound.x-t.upperBound.x,n=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(s>0||n>0)}}function x(t,e){const i=e.lowerBound.x-t.upperBound.x,s=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.x-e.upperBound.x,o=t.lowerBound.y-e.upperBound.y;return!(i>0||s>0)&&!(n>0||o>0)}function B(t,e,i,n,o){let r=0;const l=e[0],m=e[1],h=a.A.DotVV(i,l.v)-n,_=a.A.DotVV(i,m.v)-n;if(h<=0&&t[r++].Copy(l),_<=0&&t[r++].Copy(m),h*_<0){const e=h/(h-_),i=t[r].v;i.x=l.v.x+e*(m.v.x-l.v.x),i.y=l.v.y+e*(m.v.y-l.v.y);const n=t[r].id;n.cf.indexA=o,n.cf.indexB=l.id.cf.indexB,n.cf.typeA=s.e_vertex,n.cf.typeB=s.e_face,++r}return r}const S=new l.b,C=new l.f,b=new l.c;function g(t,e,i,s,n,o){const a=S.Reset();a.proxyA.SetShape(t,e),a.proxyB.SetShape(i,s),a.transformA.Copy(n),a.transformB.Copy(o),a.useRadii=!0;const m=C.Reset();m.count=0;const h=b.Reset();return Object(l.a)(h,m,a),h.distance<10*r.r}},347:function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"c",function(){return s}),i.d(e,"b",function(){return r});var s,n=i(345);class o{constructor(){this.mass=0,this.center=new n.A(0,0),this.I=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_circleShape=0]="e_circleShape",t[t.e_edgeShape=1]="e_edgeShape",t[t.e_polygonShape=2]="e_polygonShape",t[t.e_chainShape=3]="e_chainShape",t[t.e_shapeTypeCount=4]="e_shapeTypeCount"}(s||(s={}));class r{constructor(t,e){this.m_type=s.e_unknown,this.m_radius=0,this.m_type=t,this.m_radius=e}Copy(t){return this.m_radius=t.m_radius,this}GetType(){return this.m_type}}},353:function(t,e,i){"use strict";i.d(e,"c",function(){return o}),i.d(e,"d",function(){return r}),i.d(e,"b",function(){return p}),i.d(e,"a",function(){return S});const s=[],n={};window.character_emotion_list=["blink","hit","smile","troubled","cry","angry","bewildered","stunned","vomit","oops","cheers","chu","wink","pain","glitter","despair","love","shine","blaze","hum","bowing","hot","dam","qBlue"],window.character_action_list=["walk1","walk2","stand1","stand2","alert","swingO1","swingO2","swingO3","swingOF","swingT1","swingT2","swingT3","swingTF","swingP1","swingP2","swingPF","stabO1","stabO2","stabOF","stabT1","stabT2","stabTF","shoot1","shoot2","shootF","proneStab","prone","heal","fly","jump","sit","ladder","rope"];class o{constructor(t,e,i,s,n,o="Equip"){5!=arguments.length&&alert("ItemCategoryInfo: "+[...arguments].join(",")),this.id_prefix=t,this.path=e,this.slot=s,this.listPath=i,this.categoryName=n,this.fragmentType=null,this.dataDir=null,this.iconPath=null,this.iconRawPath=null;{let t,i,n;switch(s){case"head":i="stand1/0/head",n="stand1/0/head";break;case"body":i="stand1/0/body",n="stand1/0/body";break;case"hair":i="stand1/0/hair",n="stand1/0/hair";break;case"face":i="blink/0/face",n="blink/0/face";break;default:i="info/icon",n="info/iconRaw"}"Equip"==o?t=`/Character/${e+(e?"/":"")}`:console.error("未完成"),Object.defineProperties(this,{dataDir:{value:t},iconPath:{value:i},iconRawPath:{value:n}})}}static getDataPath(t){const e=o.get(t);if(!e)return null;if("0"==t[0])return e.dataDir+t;throw new Error("未完成")}static getIconRawUrl(t){let e=o.get(t);return e?"0"==t[0]?f.imageUrl(e.dataDir+t+"/"+e.iconRawPath):void 0:null}static getIconUrl(t){let e=o.get(t);return e?"0"==t[0]?f.imageUrl(e.dataDir+t+"/"+e.iconPath):void 0:null}static async loadString(t){let e=o.get(t);if(!e)return null;let i=`/String/Eqp/Eqp/${e.path+(e.path?"/":"")}${Number(t)}`;return await f.data(i)}static get(t){let e;if(null==t||""==t)throw new TypeError;if(4==t.length){if(e=o._info[t])return e}else{if(e=o._info[t.slice(0,4)])return e;if(e=6==t.length?o._info[t]:o._info[t.slice(0,6)])return e}return console.warn("unknow item type, itemId: "+t),null}static getTypeId(){return Math.trunc(_id/1e6)}static getCategory(){return Math.trunc(_id/1e4)}static isItem(t){return 0!=Math.trunc(t/1e6)}static isEquip(t){if(null==t||""==t)return null;let e=Number(t),i=Math.trunc(e/1e4);return i>180&&i<2e3&&console.warn("?? equip: "+t),1==Math.trunc(e/1e6)}static getSubCategory(t){return Math.trunc(t/1e4)}static isCashWeapon(t){return 170==Math.trunc(t/1e4)}static getJobWeaponCategory(t){console.warn("getJobWeaponCategory: 未完成")}}o.type={Equip:"Equip",Consume:"Consume",Etc:"Etc",Install:"Install",Cash:"Cash"},o.typeName={0:"Equip",1:"Consume",2:"Etc",3:"Install",4:"Cash"},o.typeId={Equip:0,Consume:1,Etc:2,Install:3,Cash:4},o._info={"0000":new o("0000","","body","body","<body>"),"0001":new o("0001","","head","head","<head>"),"0002":new o("0002","Face","Face","face","臉型"),"0003":new o("0003","Hair","Hair","hair","髮型"),"0004":new o("0004","Hair","Hair","hair","髮型"),"0100":new o("0100","Cap","Cap","cap","帽子"),"0101":new o("0101","Accessory","accessoryFace","accessoryFace","臉飾"),"0102":new o("0102","Accessory","accessoryEyes","accessoryEyes","眼飾"),"0103":new o("0103","Accessory","accessoryEars","accessoryEars","耳環"),"0104":new o("0104","Coat","Coat","coat","上衣"),"0105":new o("0105","Longcoat","Longcoat","longcoat","套服"),"0106":new o("0106","Pants","Pants","pants","褲子"),"0107":new o("0107","Shoes","Shoes","shoes","鞋子"),"0108":new o("0108","Glove","Glove","glove","手套"),"0109":new o("0109","Shield","Shield","shield","盾牌"),"0110":new o("0110","Cape","Cape","cape","披風"),"0121":new o("0121","Weapon","閃亮克魯","weapon","閃亮克魯"),"0122":new o("0122","Weapon","靈魂射手","weapon","靈魂射手"),"0123":new o("0123","Weapon","魔劍","weapon","魔劍"),"0124":new o("0124","Weapon","能量劍","weapon","能量劍"),"0125":new o("0125","Weapon","幻獸棒","weapon","幻獸棒"),"0126":new o("0126","Weapon","ESP限制器","weapon","ESP限制器"),"0127":new o("0127","Weapon","鎖鏈","weapon","鎖鏈"),"0128":new o("0128","Weapon","魔力護腕","weapon","魔力護腕"),"0130":new o("0130","Weapon","單手劍","weapon","單手劍"),"0131":new o("0131","Weapon","單手斧","weapon","單手斧"),"0132":new o("0132","Weapon","單手錘","weapon","單手錘"),"0133":new o("0133","Weapon","短劍","weapon","短劍"),"0134":new o("0134","Weapon","雙刀","weapon","雙刀"),"013526":new o("013526","Weapon","靈魂之環","weapon","靈魂之環"),"013530":new o("013530","Weapon","控制器","weapon","控制器"),"0136":new o("0136","Weapon","手杖","weapon","手杖"),"0137":new o("0137","Weapon","短杖","weapon","短杖"),"0138":new o("0138","Weapon","長杖","weapon","長杖"),"0140":new o("0140","Weapon","雙手劍","weapon","雙手劍"),"0141":new o("0141","Weapon","雙手斧","weapon","雙手斧"),"0142":new o("0142","Weapon","雙手棍","weapon","雙手棍"),"0143":new o("0143","Weapon","槍","weapon","槍"),"0144":new o("0144","Weapon","矛","weapon","矛"),"0145":new o("0145","Weapon","弓","weapon","弓"),"0146":new o("0146","Weapon","弩","weapon","弩"),"0147":new o("0147","Weapon","拳套","weapon","拳套"),"0148":new o("0148","Weapon","指虎","weapon","指虎"),"0149":new o("0149","Weapon","火槍","weapon","火槍"),"0150":new o("0150","Weapon","鏟","weapon","鏟"),"0151":new o("0151","Weapon","鎬","weapon","鎬"),"0152":new o("0152","Weapon","雙弩槍","weapon","雙弩槍"),"0153":new o("0153","Weapon","加農砲","weapon","加農砲"),"0154":new o("0154","Weapon","太刀","weapon","太刀"),"0155":new o("0155","Weapon","扇子","weapon","扇子"),"0156":new o("0156","Weapon","琉","weapon","琉"),"0157":new o("0157","Weapon","璃","weapon","璃"),"0158":new o("0158","Weapon","重拳槍","weapon","重拳槍"),"0170":new o("0170","Weapon","0170","weapon","點裝武器")},o._categoryList=function(t){let e=[],i=new Set;for(let s in t){let n=t[s],o=n.categoryName||n.listPath;i.has(o)||(i.add(o),e.push({key:o,value:s}))}return e}(o._info);class r{static isEquipExist(t,e){const i=e.listPath,s=r.equip_map[i];return!s||s.has(t)}static async loadArchive(t){a(n,"/",JSON.parse(await r.get(t)))}static get(t){return new Promise(function(e,i){let n=new XMLHttpRequest;n.open("GET",t,!0),n.timeout=6e5,n.onload=function(){404==this.status||500==this.status?(s.push(t),i(this.status+": "+t)):200==this.status?e(this.responseText):this.status},n.ontimeout=function(e){i("timeout: "+t)},n.onabort=function(e){i("abort: "+t)},n.send()})}static get root_path(){return window.$ROOT_PATH}static get archive(){return n}static get failed_urls(){return s}}function a(t,e,i){e.endsWith("/")&&(e=e.slice(0,e.length-1));let s,n=e.split("/"),o=t,r=n.length-1;for(s=0;s<r;++s){let t=n[s];null==o[t]&&(o[t]={}),o=o[t]}let a=o[n[r]];if(a instanceof Promise)delete o[n[r]],o[n[r]]=i;else if(a&&"object"==typeof a)for(let t in i)a[t]=i[t]||a[t];else void 0!==i&&(o[n[r]]=i)}function l(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i,s=e.split("/"),n=t,o=s.length-1;for(i=0;i<o;++i){let t=s[i];if(!n[t])return;n=n[t]}return n[s[o]]}window.$ResourceManager=r;const m=Symbol("$pack"),h=RegExp.prototype.test.bind(/^(([a-zA-Z^\:]+)(\:.*)$|\/\/)/);function _(t,e,i){return h(t)?void 0:""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH)?(i&&(e[m]=!0),t=t.slice(window.$ROOT_PATH.length),a(n,t,e)):a(n,t,e)}function c(t,e){let i=u(t);if(i)return l(n,i)}function u(t){if(!h(t)&&""!=window.$ROOT_PATH&&t.startsWith(window.$ROOT_PATH))return t.slice(window.$ROOT_PATH.length)}function d(t,e){e.endsWith("/")&&(e=e.slice(0,e.length-1));let i=l(t,e);if(i)return i instanceof Promise?new Promise(async function(s,n){await i,s(await d(t,e))}):i;{let i,s=e.split("/"),n=t,o=s.length-1;for(i=0;i<o;++i){let o=s[i];if(n[o]instanceof Promise)return new Promise(async function(i,s){await n[o],i(await d(t,e))});if(!n[o])return;n=n[o]}let r=n[s[o]];return r instanceof Promise?new Promise(async function(i,s){await r,i(await d(t,e))}):r}}let f=function(t){return r.get(t)};f.pack=async function(t){let e,i=u(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e&&e[m])return e;{0;const i=f.packUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!0),e}();return _(t,s,!0),await s}},f.packSync=function(t){let e=c(t);if(e)return e},f.data=async function(t){let e,i=u(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e)return e;{const i=f.dataUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!1),e}();return _(t,s,!1),await s}},f.dataSync=function(t){let e=c(t);if(e)return e},f.list=async function(t){let e,i=u(t);if(i&&(e=d(n,i)),e instanceof Promise)return await e;if(e)return e;{const i=f.listUrl(t);let s=async function(){let s=await r.get(i);return e=JSON.parse(s),_(t,e,!1),e}();return _(t,s,!1),await s}},f.listSync=function(t){let e=c(t);if(e)return Object.keys(e)},f.dataUrl=function(t){if(h(t))return t;if(!t.startsWith("data"))return`${window.$ROOT_PATH}data${t}.json`;throw new Error("Not game data: "+t)},f.packUrl=function(t){if(h(t))return t;if(!t.startsWith("pack"))return`${window.$ROOT_PATH}pack${t}.json`;throw new Error("Not game pack: "+t)},f.listUrl=function(t){if(h(t))return t;if(!t.startsWith("ls"))return`${window.$ROOT_PATH}ls${t}.json`;throw new Error(t)},f.imageUrl=function(t){if(h(t))return t;if(!t.startsWith("images"))return`${window.$ROOT_PATH}images${t}.png`;throw new Error("Not game images: "+t)},f.soundMp3Url=function(t){if(h(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.mp3`;throw new Error("Not game sound: "+t)},f.soundWavUrl=function(t){if(h(t))return t;if(!t.startsWith("sound"))return`${window.$ROOT_PATH}sound${t}.wav`;throw new Error("Not game sound: "+t)},f.assetUrl=function(t){return`${window.$ROOT_PATH}${t}`},f.asset=function(t){return f(f.assetUrl(t))},window.$get=f;class p{static head(t){t.gender=2}static body(t){t.gender=2}static Face(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||4==e?1:0}static Hair(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=1==e||2==e||4==e||7==e?1:0}static Cap(t){p._equip(t)}static accessoryFace(t){p._equip(t)}static accessoryEyes(t){p._equip(t)}static accessoryEars(t){p._equip(t)}static Coat(t){p._equip(t)}static Longcoat(t){p._equip(t)}static Pants(t){p._equip(t)}static Shoes(t){p._equip(t)}static Glove(t){p._equip(t)}static Shield(t){p._equip(t)}static Cape(t){p._equip(t)}static _equip(t){const e=Math.trunc(t.id%1e4/1e3);t.gender=0==e?0:1==e?1:2}}const A=/(\d{4,7})\d$/,y=/(\d{2,5})\d(\d{2})$/,x=/\d{4,7}(\d)$/,B=/\d{2,5}(\d)\d{2}$/;class S{static*enumHairColor(t){let e=t.match(A);for(let t=0;t<10;++t){yield e[1]+t}}static*enumFaceColor(t){let e=t.match(y);for(let t=0;t<10;++t){yield e[1]+t+e[2]}}static getColorHairID(t,e){return t.match(A)[1]+e%10}static getColorFaceID(t,e){let i=t.match(y);return i[1]+e%10+i[2]}static isHairStyleEqual(t,e){return S.getColorHairID(t,0)==S.getColorHairID(e,0)}static isFaceStyleEqual(t,e){return S.getColorFaceID(t,0)==S.getColorFaceID(e,0)}static getHairColor(t){if(t){let e=(t=String(t)).match(x);if(e)return e[1]}}static getFaceColor(t){if(t){let e=(t=String(t)).match(B);if(e)return e[1]}}}var C={Equip:{Hat:"Cap",Cape:"Cape",Top:"Coat",Overall:"Longcoat",Glove:"Glove",Bottom:"Pants",Shield:"Shield",Shoes:"Shoes","Eye Decoration":"accessoryEyes",Earrings:"accessoryEars","Face Accessory":"accessoryFace",Face:"Face",Hair:"Hair"}};r.external={equip:{}},r.equip_map={};for(let t in C.Equip){let e=C.Equip[t];r.external.equip[e]=[],r.equip_map[e]=null}for(let t=0;t<9;++t){let e="Face"+t;r.external.equip[e]=[],r.equip_map[e]=null}for(let t=0;t<8;++t){let e="Hair"+t;r.external.equip[e]=[],r.equip_map[e]=null}async function b(t){let e;t=t||"/items.json";try{if(!(e=r._external_raw=JSON.parse(await f.asset("equip.json"))))throw Error("'/equip' is empty")}catch(t){if(!(e=r._external_raw=JSON.parse(await f("//labs.maplestory.io/api/gms/latest/item/category/equip"))))return}for(let t=0;t<e.length;++t){const i=e[t],s=String(i.id).padStart(8,"0");try{if(!i.typeInfo||!C[i.typeInfo.overallCategory])continue;let t=i.typeInfo.overallCategory.toLowerCase(),e=C[i.typeInfo.overallCategory][i.typeInfo.subCategory];if(!e)continue;"Face"==e?e+=S.getFaceColor(s):"Hair"==e&&(e+=S.getHairColor(s));let n={id:s,name:i.name,desc:i.desc,cash:i.isCash?1:0,icon:{"":`//labs.maplestory.io/api/gms/latest/item/${i.id}/icon`}};r.external[t][e].push(n)}catch(t){console.error("external resource: id("+s+")"),console.error(t)}}}let g=b();async function V(t,e){await g,w(t,e),concat_external_resource=w}function w(t,e){try{const i=r.external.equip[t];if(!i)return;let s=r.equip_map[t];s||(s=new Map,e.forEach(t=>{s.set(t.id,t)}),r.equip_map[t]=s),i.forEach(t=>{let i=t.id;if(s.has(i)){let e=s.get(i);e._name=t.name||"",e._desc=t.desc||""}else t.$foreign=!0,e.push(t)})}catch(t){console.error(t)}}window.concat_external_resource=V,window.trigger_update_external_equip_list=function(){g=b(),window.concat_external_resource=V},window.load_extern_item_data=async function(t){let e=JSON.parse(await f(`//labs.maplestory.io/api/gms/latest/item/${t}`)),i={},s=e.frameBooks.default?e.frameBooks.default.frames[0]:null;for(let t in e.frameBooks){let n=e.frameBooks[t],o=[];for(let t=0;t<n.frames.length;++t){let e=n.frames[t]||s;if(!e||!e.effects)continue;let i=e.effects,r={};for(let t in i){let e=i[t];e.image&&(r[t]={"":"data:image/png;base64,"+e.image,origin:e.originOrZero||e.origin||e.center,map:e.mapOffset,z:e.position})}o[t]=r}i[t]=o}return i.info={islot:e.metaInfo.equip.islot,vslot:e.metaInfo.equip.vslot,icon:e.metaInfo.icon?"data:image/png;base64,"+e.metaInfo.icon.iconRaw:"",cash:e.metaInfo.cash&&e.metaInfo.cash.cash?1:0},i}},355:function(t,e,i){const s=i(367),{FilterHelper:n}=i(356),{b2Vec2:o,b2Body:r,b2Fixture:a,b2Contact:l,b2Manifold:m,b2ContactImpulse:h,b2ContactListener:_}=s;window.$box2d=s;let c=new o;r.prototype.$type=null,r.prototype.Step=function(t){if(this._on_step)for(let e of this._on_step)e(t)},r.prototype.AfterStep=function(t){if(this._on_after_step)for(let e of this._on_after_step)e(t)},r.prototype.addStep=function(t){this._on_step=this._on_step||[],this._on_step.push(t)},r.prototype.addAfterStep=function(t){this._on_after_step=this._on_after_step||[],this._on_after_step.push(t)},r.prototype.SetLinearVelocity2=function(t,e){c.x=t,c.y=e,this.SetLinearVelocity(c,!0)},r.prototype.ApplyForceToCenter2=function(t,e){c.x=t,c.y=e,this.ApplyForceToCenter(c,!0)},r.prototype.ApplyLinearImpulseToCenter2=function(t,e){c.x=t,c.y=e,this.ApplyLinearImpulseToCenter(c,!0)},r.prototype.Acceleration=function(t,e,i){i||(i=this.GetWorldCenter());let s=o.SubVV(t,e,c),n=this.GetMass(),r=n*s.x,a=n*s.y,l=c.Set(r,a);this.ApplyLinearImpulse(l,i,!0)},r.prototype.AccelerationX=function(t,e,i){i||(i=this.GetWorldCenter());let s=t-e.x,n=this.GetMass()*s,o=c.Set(n,0);this.ApplyLinearImpulse(o,i,!0)},r.prototype.AccelerationY=function(t,e,i){i||(i=this.GetWorldCenter());let s=t-e.y,n=this.GetMass()*s,o=c.Set(0,n);this.ApplyLinearImpulse(o,i,!0)},r.prototype.ConstantVelocity=function(t,e){this.Acceleration(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},r.prototype.ConstantVelocity2=function(t,e,i,s){const n=new o(t,e),r=new o(i,s),a=this.GetLinearVelocity(),l=this.GetMass();let m=new o,h=o.SubVV(n,a,m);m.x=l*h.x,m.y=l*h.y,this.ApplyLinearImpulse(m,r,!0)},r.prototype.ConstantVelocityWorldCenter2=function(t,e){const i=new o(t,e),s=this.GetLinearVelocity(),n=this.GetMass();let r=new o,a=o.SubVV(i,s,r);r.x=n*a.x,r.y=n*a.y,this.ApplyLinearImpulseToCenter(r,!0)},r.prototype.ConstantVelocityX=function(t,e){this.AccelerationX(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},r.prototype.ConstantVelocityY=function(t,e){this.AccelerationY(t,this.GetLinearVelocity(),e||this.GetWorldCenter())},a.prototype.beginContact=function(t,e,i){},a.prototype.endContact=function(t,e,i){},a.prototype.preSolve=function(t,e,i,s){},a.prototype.postSolve=function(t,e,i,s){},a.prototype.getOwnerID=function(){let t=this.GetUserData();if(t&&t.owner)return t.owner.id};t.exports=Object.assign(s,{FixtureContactListener:class{beginContact(t,e,i){}endContact(t,e,i){}preSolve(t,e,i,s){}postSolve(t,e,i,s){}},FilterHelper:n})},356:function(t,e,i){"use strict";i.r(e),i.d(e,"FilterHelper",function(){return a});var s=i(360),n=i(367);let o={},r=1;class a extends s.a{ignore(t){let e=o["s_"+t];this.maskBits=(this.maskBits&~e.categoryBits)>>>0,e.maskBits=(e.maskBits&~this.categoryBits)>>>0}addCategory(t){let e=o["s_"+t];this.categoryBits=this.categoryBits|e.categoryBits}static get(t,e){let i=o["s_"+t];if(e){let t=o["s_"+e];console.warn("filter: "+e+"%o",t)}return i}static registerCategory(t){let e=o["s_"+t]=new a;return e.groupIndex=0,e.categoryBits=r,e.maskBits=4294967295,e.name=t,r<<=1,e}static get next_category(){return o}static get filter_preset(){return o}}const l=[[1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,1,1,0,1,1,1],[1,0,0,1,0,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0],[1,1,0,0,0,0,1,0,0,0,0,0],[1,1,0,0,1,1,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,0,0,1,0,0,0,0,0]];!function(){let t=[a.registerCategory("default"),a.registerCategory("body"),a.registerCategory("foothold"),a.registerCategory("foot"),a.registerCategory("bullet"),a.registerCategory("pvp_bullet"),a.registerCategory("mob"),a.registerCategory("mob_bullet"),a.registerCategory("portal"),a.registerCategory("ladder"),a.registerCategory("map_obj"),a.registerCategory("map_border")];for(let e=0;e<l.length;++e)for(let i=0;i<l[e].length;++i)l[e][i]||(t[e].maskBits=(t[e].maskBits&~(1<<i))>>>0)}(),function(){let t=new n.b2ContactFilter;function e(t){return{GetFilterData:()=>a.get(t),GetBody:()=>({GetType:()=>2,ShouldCollideConnected:()=>!0})}}t.ShouldCollide(e("body"),e("ladder")),t.ShouldCollide(e("ladder"),e("body")),t.ShouldCollide(e("foot"),e("portal")),t.ShouldCollide(e("portal"),e("foot"))}()},359:function(t,e,i){"use strict";i.d(e,"d",function(){return o}),i.d(e,"f",function(){return r}),i.d(e,"b",function(){return a}),i.d(e,"c",function(){return l}),i.d(e,"h",function(){return m}),i.d(e,"i",function(){return h}),i.d(e,"j",function(){return _}),i.d(e,"k",function(){return c}),i.d(e,"g",function(){return u}),i.d(e,"e",function(){return d}),i.d(e,"a",function(){return b});var s=i(344),n=i(345);class o{constructor(){this.m_buffer=n.A.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}Reset(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}SetShape(t,e){t.SetupDistanceProxy(this,e)}GetSupport(t){let e=0,i=n.A.DotVV(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.A.DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e}GetSupportVertex(t){let e=0,i=n.A.DotVV(this.m_vertices[0],t);for(let s=1;s<this.m_count;++s){const o=n.A.DotVV(this.m_vertices[s],t);o>i&&(e=s,i=o)}return this.m_vertices[e]}GetVertexCount(){return this.m_count}GetVertex(t){return this.m_vertices[t]}}class r{constructor(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}Reset(){return this.metric=0,this.count=0,this}}class a{constructor(){this.proxyA=new o,this.proxyB=new o,this.transformA=new n.z,this.transformB=new n.z,this.useRadii=!1}Reset(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}class l{constructor(){this.pointA=new n.A,this.pointB=new n.A,this.distance=0,this.iterations=0}Reset(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}let m=0,h=0,_=0;function c(){m=0,h=0,_=0}class u{constructor(){this.wA=new n.A,this.wB=new n.A,this.w=new n.A,this.a=0,this.indexA=0,this.indexB=0}Copy(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}class d{constructor(){this.m_v1=new u,this.m_v2=new u,this.m_v3=new u,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}ReadCache(t,e,i,o,r){this.m_count=t.count;const a=this.m_vertices;for(let s=0;s<this.m_count;++s){const l=a[s];l.indexA=t.indexA[s],l.indexB=t.indexB[s];const m=e.GetVertex(l.indexA),h=o.GetVertex(l.indexB);n.z.MulXV(i,m,l.wA),n.z.MulXV(r,h,l.wB),n.A.SubVV(l.wB,l.wA,l.w),l.a=0}if(this.m_count>1){const e=t.metric,i=this.GetMetric();(i<.5*e||2*e<i||i<s.r)&&(this.m_count=0)}if(0===this.m_count){const t=a[0];t.indexA=0,t.indexB=0;const s=e.GetVertex(0),l=o.GetVertex(0);n.z.MulXV(i,s,t.wA),n.z.MulXV(r,l,t.wB),n.A.SubVV(t.wB,t.wA,t.w),t.a=1,this.m_count=1}}WriteCache(t){t.metric=this.GetMetric(),t.count=this.m_count;const e=this.m_vertices;for(let i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}GetSearchDirection(t){switch(this.m_count){case 1:return n.A.NegV(this.m_v1.w,t);case 2:{const e=n.A.SubVV(this.m_v2.w,this.m_v1.w,t);return n.A.CrossVV(e,n.A.NegV(this.m_v1.w,n.A.s_t0))>0?n.A.CrossOneV(e,t):n.A.CrossVOne(e,t)}default:return t.SetZero()}}GetClosestPoint(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}}GetWitnessPoints(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}GetMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return n.A.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return n.A.CrossVV(n.A.SubVV(this.m_v2.w,this.m_v1.w,n.A.s_t0),n.A.SubVV(this.m_v3.w,this.m_v1.w,n.A.s_t1));default:return 0}}Solve2(){const t=this.m_v1.w,e=this.m_v2.w,i=n.A.SubVV(e,t,d.s_e12),s=-n.A.DotVV(t,i);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);const o=n.A.DotVV(e,i);if(o<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);const r=1/(o+s);this.m_v1.a=o*r,this.m_v2.a=s*r,this.m_count=2}Solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=n.A.SubVV(e,t,d.s_e12),o=n.A.DotVV(t,s),r=n.A.DotVV(e,s),a=-o,l=n.A.SubVV(i,t,d.s_e13),m=n.A.DotVV(t,l),h=n.A.DotVV(i,l),_=-m,c=n.A.SubVV(i,e,d.s_e23),u=n.A.DotVV(e,c),f=n.A.DotVV(i,c),p=-u,A=n.A.CrossVV(s,l),y=A*n.A.CrossVV(e,i),x=A*n.A.CrossVV(i,t),B=A*n.A.CrossVV(t,e);if(a<=0&&_<=0)return this.m_v1.a=1,void(this.m_count=1);if(r>0&&a>0&&B<=0){const t=1/(r+a);return this.m_v1.a=r*t,this.m_v2.a=a*t,void(this.m_count=2)}if(h>0&&_>0&&x<=0){const t=1/(h+_);return this.m_v1.a=h*t,this.m_v3.a=_*t,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(r<=0&&p<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&p>0&&y<=0){const t=1/(f+p);return this.m_v2.a=f*t,this.m_v3.a=p*t,this.m_count=2,void this.m_v1.Copy(this.m_v3)}const S=1/(y+x+B);this.m_v1.a=y*S,this.m_v2.a=x*S,this.m_v3.a=B*S,this.m_count=3}}d.s_e12=new n.A,d.s_e13=new n.A,d.s_e23=new n.A;const f=new d,p=[0,0,0],A=[0,0,0],y=new n.A,x=new n.A,B=new n.A,S=new n.A,C=new n.A;function b(t,e,i){++m;const o=i.proxyA,r=i.proxyB,a=i.transformA,l=i.transformB,c=f;c.ReadCache(e,o,a,r,l);const u=c.m_vertices,d=p,b=A;let g=0,V=s.x,w=V,v=0;for(;v<20;){g=c.m_count;for(let t=0;t<g;++t)d[t]=u[t].indexA,b[t]=u[t].indexB;switch(c.m_count){case 1:break;case 2:c.Solve2();break;case 3:c.Solve3()}if(3===c.m_count)break;V=w=c.GetClosestPoint(y).LengthSquared();const t=c.GetSearchDirection(x);if(t.LengthSquared()<s.s)break;const e=u[c.m_count];e.indexA=o.GetSupport(n.t.MulTRV(a.q,n.A.NegV(t,n.A.s_t0),S)),n.z.MulXV(a,o.GetVertex(e.indexA),e.wA),e.indexB=r.GetSupport(n.t.MulTRV(l.q,t,C)),n.z.MulXV(l,r.GetVertex(e.indexB),e.wB),n.A.SubVV(e.wB,e.wA,e.w),++v,++h;let i=!1;for(let t=0;t<g;++t)if(e.indexA===d[t]&&e.indexB===b[t]){i=!0;break}if(i)break;++c.m_count}if(_=Object(n.m)(_,v),c.GetWitnessPoints(t.pointA,t.pointB),t.distance=n.A.DistanceVV(t.pointA,t.pointB),t.iterations=v,c.WriteCache(e),i.useRadii){const e=o.m_radius,i=r.m_radius;if(t.distance>e+i&&t.distance>s.r){t.distance-=e+i;const s=n.A.SubVV(t.pointB,t.pointA,B);s.Normalize(),t.pointA.SelfMulAdd(e,s),t.pointB.SelfMulSub(i,s)}else{const e=n.A.MidVV(t.pointA,t.pointB,y);t.pointA.Copy(e),t.pointB.Copy(e),t.distance=0}}}},360:function(t,e,i){"use strict";i.d(e,"a",function(){return a}),i.d(e,"c",function(){return l}),i.d(e,"d",function(){return m}),i.d(e,"b",function(){return h});var s=i(344),n=i(345),o=i(346),r=i(347);class a{constructor(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}Clone(){return(new a).Copy(this)}Copy(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex,this}}class l{constructor(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new a}}class m{constructor(t){this.aabb=new o.a,this.childIndex=0,this.treeNode=null,this.fixture=t}}class h{constructor(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=null,this.m_proxyCount=0,this.m_filter=new a,this.m_isSensor=!1,this.m_userData=null,this.m_body=e,this.m_shape=t.shape.Clone()}GetType(){return this.m_shape.GetType()}GetShape(){return this.m_shape}SetSensor(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}IsSensor(){return this.m_isSensor}SetFilterData(t){this.m_filter.Copy(t),this.Refilter()}GetFilterData(){return this.m_filter}Refilter(){if(this.m_body)return;let t=this.m_body.GetContactList();for(;t;){const e=t.contact,i=e.GetFixtureA(),s=e.GetFixtureB();i!==this&&s!==this||e.FlagForFiltering(),t=t.next}const e=this.m_body.GetWorld();if(null===e)return;const i=e.m_contactManager.m_broadPhase;for(let t=0;t<this.m_proxyCount;++t)i.TouchProxy(this.m_proxies[t].treeNode)}GetBody(){return this.m_body}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}TestPoint(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}ComputeDistance(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}RayCast(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}GetMassData(t=new r.a){return this.m_shape.ComputeMass(t,this.m_density),t}SetDensity(t){this.m_density=t}GetDensity(){return this.m_density}GetFriction(){return this.m_friction}SetFriction(t){this.m_friction=t}GetRestitution(){return this.m_restitution}SetRestitution(t){this.m_restitution=t}GetAABB(t){return this.m_proxies[t].aabb}Dump(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}Create(t){this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_next=null,this.m_filter.Copy(t.filter),this.m_isSensor=t.isSensor,this.m_proxies=Object(s.e)(this.m_shape.GetChildCount(),t=>new m(this)),this.m_proxyCount=0,this.m_density=t.density}Destroy(){}CreateProxies(t,e){this.m_proxyCount=this.m_shape.GetChildCount();for(let i=0;i<this.m_proxyCount;++i){const s=this.m_proxies[i]=new m(this);this.m_shape.ComputeAABB(s.aabb,e,i),s.treeNode=t.CreateProxy(s.aabb,s),s.childIndex=i}}DestroyProxies(t){for(let e=0;e<this.m_proxyCount;++e){const i=this.m_proxies[e];i.treeNode.userData=null,t.DestroyProxy(i.treeNode),i.treeNode=null}this.m_proxyCount=0}Synchronize(t,e,i){if(0!==this.m_proxyCount)for(let s=0;s<this.m_proxyCount;++s){const o=this.m_proxies[s],r=h.Synchronize_s_aabb1,a=h.Synchronize_s_aabb2;this.m_shape.ComputeAABB(r,e,s),this.m_shape.ComputeAABB(a,i,s),o.aabb.Combine2(r,a);const l=n.A.SubVV(i.p,e.p,h.Synchronize_s_displacement);t.MoveProxy(o.treeNode,o.aabb,l)}}}h.Synchronize_s_aabb1=new o.a,h.Synchronize_s_aabb2=new o.a,h.Synchronize_s_displacement=new n.A},367:function(t,e,i){"use strict";i.r(e);var s,n=i(344),o=i(345);class r{constructor(t=.5,e=.5,i=.5,s=1){this.r=t,this.g=e,this.b=i,this.a=s}Clone(){return(new r).Copy(this)}Copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}IsEqual(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}IsZero(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}GetColor(t){return t.Copy(this),t}SetColor(t){this.Copy(t)}Set(t,e,i,s=1){t instanceof r?this.Copy(t):this.SetRGBA(t,e,i,s)}SetByteRGB(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}SetByteRGBA(t,e,i,s){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=s/255,this}SetRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}SetRGBA(t,e,i,s){return this.r=t,this.g=e,this.b=i,this.a=s,this}SelfAdd(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}Add(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}SelfSub(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}Sub(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}SelfMul_0_1(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}Mul_0_1(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,this}Mix(t,e){r.MixColors(this,t,e)}static MixColors(t,e,i){const s=i*(e.r-t.r),n=i*(e.g-t.g),o=i*(e.b-t.b),r=i*(e.a-t.a);t.r+=s,t.g+=n,t.b+=o,t.a+=r,e.r-=s,e.g-=n,e.b-=o,e.a-=r}MakeStyleString(t=this.a){return r.MakeStyleString(this.r,this.g,this.b,t)}static MakeStyleString(t,e,i,s=1){return t*=255,e*=255,i*=255,s<1?`rgba(${t},${e},${i},${s})`:`rgb(${t},${e},${i})`}}r.RED=new r(1,0,0),r.GREEN=new r(0,1,0),r.BLUE=new r(0,0,1),function(t){t[t.e_none=0]="e_none",t[t.e_shapeBit=1]="e_shapeBit",t[t.e_jointBit=2]="e_jointBit",t[t.e_aabbBit=4]="e_aabbBit",t[t.e_pairBit=8]="e_pairBit",t[t.e_centerOfMassBit=16]="e_centerOfMassBit",t[t.e_particleBit=32]="e_particleBit",t[t.e_controllerBit=64]="e_controllerBit",t[t.e_all=63]="e_all"}(s||(s={}));class a{constructor(){this.m_drawFlags=0}SetFlags(t){this.m_drawFlags=t}GetFlags(){return this.m_drawFlags}AppendFlags(t){this.m_drawFlags|=t}ClearFlags(t){this.m_drawFlags&=~t}PushTransform(t){}PopTransform(t){}DrawPolygon(t,e,i){}DrawSolidPolygon(t,e,i){}DrawCircle(t,e,i){}DrawSolidCircle(t,e,i,s){}DrawParticles(t,e,i,s){}DrawSegment(t,e,i){}DrawTransform(t){}}class l{constructor(){this.m_start=Date.now()}Reset(){return this.m_start=Date.now(),this}GetMilliseconds(){return Date.now()-this.m_start}}class m{constructor(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}GetCount(){return this.m_count}GetMinCount(){return this.m_min_count}GetMaxCount(){return this.m_max_count}ResetCount(){const t=this.m_count;return this.m_count=0,t}ResetMinCount(){this.m_min_count=0}ResetMaxCount(){this.m_max_count=0}Increment(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}Decrement(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}class h{constructor(t){this.m_stack=[],this.m_count=0,this.m_stack=[],this.m_count=0}Reset(){return this.m_count=0,this}Push(t){this.m_stack[this.m_count]=t,this.m_count++}Pop(){this.m_count--;const t=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,t}GetCount(){return this.m_count}}class _{}class c{}var u=i(346),d=i(359);function f(t){if(null===t)throw new Error;return t}class p{constructor(t=0){this.m_id=0,this.aabb=new u.a,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}IsLeaf(){return null===this.child1}}class A{constructor(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0}GetUserData(t){return t.userData}GetFatAABB(t){return t.aabb}Query(t,e){if(null===this.m_root)return;const i=A.s_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){const s=i.Pop();if(null!==s&&s.aabb.TestOverlap(e))if(s.IsLeaf()){if(!t(s))return}else i.Push(s.child1),i.Push(s.child2)}}RayCast(t,e){if(null===this.m_root)return;const i=e.p1,s=e.p2,n=o.A.SubVV(s,i,A.s_r);n.Normalize();const r=o.A.CrossOneV(n,A.s_v),a=o.A.AbsV(r,A.s_abs_v);let l=e.maxFraction;const m=A.s_segmentAABB;let h=i.x+l*(s.x-i.x),_=i.y+l*(s.y-i.y);m.lowerBound.x=Object(o.n)(i.x,h),m.lowerBound.y=Object(o.n)(i.y,_),m.upperBound.x=Object(o.m)(i.x,h),m.upperBound.y=Object(o.m)(i.y,_);const c=A.s_stack.Reset();for(c.Push(this.m_root);c.GetCount()>0;){const n=c.Pop();if(null===n)continue;if(!Object(u.n)(n.aabb,m))continue;const d=n.aabb.GetCenter(),f=n.aabb.GetExtents();if(!(Object(o.a)(o.A.DotVV(r,o.A.SubVV(i,d,o.A.s_t0)))-o.A.DotVV(a,f)>0))if(n.IsLeaf()){const r=A.s_subInput;r.p1.Copy(e.p1),r.p2.Copy(e.p2),r.maxFraction=l;const a=t(r,n);if(0===a)return;a>0&&(l=a,h=i.x+l*(s.x-i.x),_=i.y+l*(s.y-i.y),m.lowerBound.x=Object(o.n)(i.x,h),m.lowerBound.y=Object(o.n)(i.y,_),m.upperBound.x=Object(o.m)(i.x,h),m.upperBound.y=Object(o.m)(i.y,_))}else c.Push(n.child1),c.Push(n.child2)}}AllocateNode(){if(this.m_freeList){const t=this.m_freeList;return this.m_freeList=t.parent,t.parent=null,t.child1=null,t.child2=null,t.height=0,t.userData=null,t}return new p(A.s_node_id++)}FreeNode(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.userData=null,this.m_freeList=t}CreateProxy(t,e){const i=this.AllocateNode(),s=n.k,o=n.k;return i.aabb.lowerBound.x=t.lowerBound.x-s,i.aabb.lowerBound.y=t.lowerBound.y-o,i.aabb.upperBound.x=t.upperBound.x+s,i.aabb.upperBound.y=t.upperBound.y+o,i.userData=e,i.height=0,this.InsertLeaf(i),i}DestroyProxy(t){this.RemoveLeaf(t),this.FreeNode(t)}MoveProxy(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);const s=n.k+n.l*(i.x>0?i.x:-i.x),o=n.k+n.l*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-s,t.aabb.lowerBound.y=e.lowerBound.y-o,t.aabb.upperBound.x=e.upperBound.x+s,t.aabb.upperBound.y=e.upperBound.y+o,this.InsertLeaf(t),!0}InsertLeaf(t){if(++this.m_insertionCount,null===this.m_root)return this.m_root=t,void(this.m_root.parent=null);const e=t.aabb;let i,s,n=this.m_root;for(;!n.IsLeaf();){i=n.child1,s=n.child2;const t=n.aabb.GetPerimeter(),o=A.s_combinedAABB;o.Combine2(n.aabb,e);const r=o.GetPerimeter(),a=2*r,l=2*(r-t);let m;const h=A.s_aabb;let _,c,u;if(i.IsLeaf()?(h.Combine2(e,i.aabb),m=h.GetPerimeter()+l):(h.Combine2(e,i.aabb),_=i.aabb.GetPerimeter(),m=(c=h.GetPerimeter())-_+l),s.IsLeaf()?(h.Combine2(e,s.aabb),u=h.GetPerimeter()+l):(h.Combine2(e,s.aabb),_=s.aabb.GetPerimeter(),u=(c=h.GetPerimeter())-_+l),a<m&&a<u)break;n=m<u?i:s}const r=n,a=r.parent,l=this.AllocateNode();for(l.parent=a,l.userData=null,l.aabb.Combine2(e,r.aabb),l.height=r.height+1,a?(a.child1===r?a.child1=l:a.child2=l,l.child1=r,l.child2=t,r.parent=l,t.parent=l):(l.child1=r,l.child2=t,r.parent=l,t.parent=l,this.m_root=l),n=t.parent;null!==n;)i=(n=this.Balance(n)).child1,s=n.child2,n.height=1+Object(o.m)(i.height,s.height),n.aabb.Combine2(i.aabb,s.aabb),n=n.parent}RemoveLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=t.parent,i=e&&e.parent;let s;if(s=e.child1===t?e.child2:e.child1,i){i.child1===e?i.child1=s:i.child2=s,s.parent=i,this.FreeNode(e);let t=i;for(;t;){const e=(t=this.Balance(t)).child1,i=t.child2;t.aabb.Combine2(e.aabb,i.aabb),t.height=1+Object(o.m)(e.height,i.height),t=t.parent}}else this.m_root=s,s.parent=null,this.FreeNode(e)}Balance(t){if(t.IsLeaf()||t.height<2)return t;const e=f(t.child1),i=f(t.child2),s=i.height-e.height;if(s>1){const s=f(i.child1),n=f(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>n.height?(i.child2=s,t.child2=n,n.parent=t,t.aabb.Combine2(e.aabb,n.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.m)(e.height,n.height),i.height=1+Object(o.m)(t.height,s.height)):(i.child2=n,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.m)(e.height,s.height),i.height=1+Object(o.m)(t.height,n.height)),i}if(s<-1){const s=f(e.child1),n=f(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,s.height>n.height?(e.child2=s,t.child1=n,n.parent=t,t.aabb.Combine2(i.aabb,n.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+Object(o.m)(i.height,n.height),e.height=1+Object(o.m)(t.height,s.height)):(e.child2=n,t.child1=s,s.parent=t,t.aabb.Combine2(i.aabb,s.aabb),e.aabb.Combine2(t.aabb,n.aabb),t.height=1+Object(o.m)(i.height,s.height),e.height=1+Object(o.m)(t.height,n.height)),e}return t}GetHeight(){return null===this.m_root?0:this.m_root.height}static GetAreaNode(t){if(null===t)return 0;if(t.IsLeaf())return 0;let e=t.aabb.GetPerimeter();return e+=A.GetAreaNode(t.child1),e+=A.GetAreaNode(t.child2)}GetAreaRatio(){if(null===this.m_root)return 0;const t=this.m_root.aabb.GetPerimeter();return A.GetAreaNode(this.m_root)/t}ComputeHeightNode(t){if(t.IsLeaf())return 0;const e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+Object(o.m)(e,i)}ComputeHeight(){return this.ComputeHeightNode(this.m_root)}ValidateStructure(t){if(null===t)return;this.m_root;const e=t,i=e.child1,s=e.child2;e.IsLeaf()||(this.ValidateStructure(i),this.ValidateStructure(s))}ValidateMetrics(t){if(null===t)return;const e=t,i=e.child1,s=e.child2;e.IsLeaf()||(A.s_aabb.Combine2(i.aabb,s.aabb),this.ValidateMetrics(i),this.ValidateMetrics(s))}Validate(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);let t=this.m_freeList;for(;null!==t;)t=t.parent}static GetMaxBalanceNode(t,e){if(null===t)return e;if(t.height<=1)return e;const i=t.child1,s=t.child2,n=Object(o.a)(s.height-i.height);return Object(o.m)(e,n)}GetMaxBalance(){return A.GetMaxBalanceNode(this.m_root,0)}RebuildBottomUp(){this.Validate()}static ShiftOriginNode(t,e){if(null===t)return;if(t.height<=1)return;const i=t.child1,s=t.child2;A.ShiftOriginNode(i,e),A.ShiftOriginNode(s,e),t.aabb.lowerBound.SelfSub(e),t.aabb.upperBound.SelfSub(e)}ShiftOrigin(t){A.ShiftOriginNode(this.m_root,t)}}A.s_stack=new h(256),A.s_r=new o.A,A.s_v=new o.A,A.s_abs_v=new o.A,A.s_segmentAABB=new u.a,A.s_subInput=new u.l,A.s_combinedAABB=new u.a,A.s_aabb=new u.a,A.s_node_id=0;class y{constructor(){this.proxyA=null,this.proxyB=null}}class x{constructor(){this.m_tree=new A,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}CreateProxy(t,e){const i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}DestroyProxy(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}MoveProxy(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}TouchProxy(t){this.BufferMove(t)}GetFatAABB(t){return this.m_tree.GetFatAABB(t)}GetUserData(t){return this.m_tree.GetUserData(t)}TestOverlap(t,e){const i=this.m_tree.GetFatAABB(t),s=this.m_tree.GetFatAABB(e);return Object(u.n)(i,s)}GetProxyCount(){return this.m_proxyCount}UpdatePairs(t){this.m_pairCount=0;for(let t=0;t<this.m_moveCount;++t){const e=this.m_moveBuffer[t];if(null===e)continue;const i=t=>{if(t.m_id===e.m_id)return!0;this.m_pairCount===this.m_pairBuffer.length&&(this.m_pairBuffer[this.m_pairCount]=new y);const i=this.m_pairBuffer[this.m_pairCount];return t.m_id<e.m_id?(i.proxyA=t,i.proxyB=e):(i.proxyA=e,i.proxyB=t),++this.m_pairCount,!0},s=this.m_tree.GetFatAABB(e);this.m_tree.Query(i,s)}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(B);let e=0;for(;e<this.m_pairCount;){const i=this.m_pairBuffer[e],s=this.m_tree.GetUserData(i.proxyA),n=this.m_tree.GetUserData(i.proxyB);for(t.AddPair(s,n),++e;e<this.m_pairCount;){const t=this.m_pairBuffer[e];if(t.proxyA.m_id!==i.proxyA.m_id||t.proxyB.m_id!==i.proxyB.m_id)break;++e}}}Query(t,e){this.m_tree.Query(t,e)}RayCast(t,e){this.m_tree.RayCast(t,e)}GetTreeHeight(){return this.m_tree.GetHeight()}GetTreeBalance(){return this.m_tree.GetMaxBalance()}GetTreeQuality(){return this.m_tree.GetAreaRatio()}ShiftOrigin(t){this.m_tree.ShiftOrigin(t)}BufferMove(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}UnBufferMove(t){const e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}function B(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}let S=0,C=0,b=0,g=0,V=0,w=0,v=0;function M(){S=0,C=0,b=0,g=0,V=0,w=0,v=0}const P=new o.z,I=new o.z,G=new o.A,D=new o.A,F=new o.A,R=new o.A,L=new o.A;class T{constructor(){this.proxyA=new d.d,this.proxyB=new d.d,this.sweepA=new o.y,this.sweepB=new o.y,this.tMax=0}}var k,z;!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_failed=1]="e_failed",t[t.e_overlapped=2]="e_overlapped",t[t.e_touching=3]="e_touching",t[t.e_separated=4]="e_separated"}(k||(k={}));class j{constructor(){this.state=k.e_unknown,this.t=0}}!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_points=0]="e_points",t[t.e_faceA=1]="e_faceA",t[t.e_faceB=2]="e_faceB"}(z||(z={}));class q{constructor(){this.m_sweepA=new o.y,this.m_sweepB=new o.y,this.m_type=z.e_unknown,this.m_localPoint=new o.A,this.m_axis=new o.A}Initialize(t,e,i,s,n,r){this.m_proxyA=e,this.m_proxyB=s;const a=t.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(n);const l=P,m=I;if(this.m_sweepA.GetTransform(l,r),this.m_sweepB.GetTransform(m,r),1===a){this.m_type=z.e_points;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyB.GetVertex(t.indexB[0]),s=o.z.MulXV(l,e,G),n=o.z.MulXV(m,i,D);o.A.SubVV(n,s,this.m_axis);const r=this.m_axis.Normalize();return this.m_localPoint.SetZero(),r}if(t.indexA[0]===t.indexA[1]){this.m_type=z.e_faceB;const e=this.m_proxyB.GetVertex(t.indexB[0]),i=this.m_proxyB.GetVertex(t.indexB[1]);o.A.CrossVOne(o.A.SubVV(i,e,o.A.s_t0),this.m_axis).SelfNormalize();const s=o.t.MulRV(m.q,this.m_axis,F);o.A.MidVV(e,i,this.m_localPoint);const n=o.z.MulXV(m,this.m_localPoint,D),r=this.m_proxyA.GetVertex(t.indexA[0]),a=o.z.MulXV(l,r,G);let h=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),s);return h<0&&(this.m_axis.SelfNeg(),h=-h),h}{this.m_type=z.e_faceA;const e=this.m_proxyA.GetVertex(t.indexA[0]),i=this.m_proxyA.GetVertex(t.indexA[1]);o.A.CrossVOne(o.A.SubVV(i,e,o.A.s_t0),this.m_axis).SelfNormalize();const s=o.t.MulRV(l.q,this.m_axis,F);o.A.MidVV(e,i,this.m_localPoint);const n=o.z.MulXV(l,this.m_localPoint,G),r=this.m_proxyB.GetVertex(t.indexB[0]),a=o.z.MulXV(m,r,D);let h=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),s);return h<0&&(this.m_axis.SelfNeg(),h=-h),h}}FindMinSeparation(t,e,i){const s=P,n=I;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case z.e_points:{const i=o.t.MulTRV(s.q,this.m_axis,R),r=o.t.MulTRV(n.q,o.A.NegV(this.m_axis,o.A.s_t0),L);t[0]=this.m_proxyA.GetSupport(i),e[0]=this.m_proxyB.GetSupport(r);const a=this.m_proxyA.GetVertex(t[0]),l=this.m_proxyB.GetVertex(e[0]),m=o.z.MulXV(s,a,G),h=o.z.MulXV(n,l,D);return o.A.DotVV(o.A.SubVV(h,m,o.A.s_t0),this.m_axis)}case z.e_faceA:{const i=o.t.MulRV(s.q,this.m_axis,F),r=o.z.MulXV(s,this.m_localPoint,G),a=o.t.MulTRV(n.q,o.A.NegV(i,o.A.s_t0),L);t[0]=-1,e[0]=this.m_proxyB.GetSupport(a);const l=this.m_proxyB.GetVertex(e[0]),m=o.z.MulXV(n,l,D);return o.A.DotVV(o.A.SubVV(m,r,o.A.s_t0),i)}case z.e_faceB:{const i=o.t.MulRV(n.q,this.m_axis,F),r=o.z.MulXV(n,this.m_localPoint,D),a=o.t.MulTRV(s.q,o.A.NegV(i,o.A.s_t0),R);e[0]=-1,t[0]=this.m_proxyA.GetSupport(a);const l=this.m_proxyA.GetVertex(t[0]),m=o.z.MulXV(s,l,G);return o.A.DotVV(o.A.SubVV(m,r,o.A.s_t0),i)}default:return t[0]=-1,e[0]=-1,0}}Evaluate(t,e,i){const s=P,n=I;switch(this.m_sweepA.GetTransform(s,i),this.m_sweepB.GetTransform(n,i),this.m_type){case z.e_points:{const i=this.m_proxyA.GetVertex(t),r=this.m_proxyB.GetVertex(e),a=o.z.MulXV(s,i,G),l=o.z.MulXV(n,r,D);return o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.m_axis)}case z.e_faceA:{const t=o.t.MulRV(s.q,this.m_axis,F),i=o.z.MulXV(s,this.m_localPoint,G),r=this.m_proxyB.GetVertex(e),a=o.z.MulXV(n,r,D);return o.A.DotVV(o.A.SubVV(a,i,o.A.s_t0),t)}case z.e_faceB:{const e=o.t.MulRV(n.q,this.m_axis,F),i=o.z.MulXV(n,this.m_localPoint,D),r=this.m_proxyA.GetVertex(t),a=o.z.MulXV(s,r,G);return o.A.DotVV(o.A.SubVV(a,i,o.A.s_t0),e)}default:return 0}}}const O=new l,N=new d.f,J=new d.b,E=new d.c,X=new q,W=[0],U=[0],Z=new o.y,H=new o.y;function $(t,e){const i=O.Reset();++b,t.state=k.e_unknown,t.t=e.tMax;const s=e.proxyA,r=e.proxyB,a=Z.Copy(e.sweepA),l=H.Copy(e.sweepB);a.Normalize(),l.Normalize();const m=e.tMax,h=s.m_radius+r.m_radius,_=Object(o.m)(n.v,h-3*n.v),c=.25*n.v;let u=0;let f=0;const p=N;p.count=0;const A=J;for(A.proxyA=e.proxyA,A.proxyB=e.proxyB,A.useRadii=!1;;){const e=P,i=I;a.GetTransform(e,u),l.GetTransform(i,u),A.transformA.Copy(e),A.transformB.Copy(i);const h=E;if(Object(d.a)(h,p,A),h.distance<=0){t.state=k.e_overlapped,t.t=0;break}if(h.distance<_+c){t.state=k.e_touching,t.t=u;break}const y=X;y.Initialize(p,s,a,r,l,u);let x=!1,B=m,S=0;for(;;){const e=W,i=U;let s=y.FindMinSeparation(e,i,B);if(s>_+c){t.state=k.e_separated,t.t=m,x=!0;break}if(s>_-c){u=B;break}let r=y.Evaluate(e[0],i[0],u);if(r<_-c){t.state=k.e_failed,t.t=u,x=!0;break}if(r<=_+c){t.state=k.e_touching,t.t=u,x=!0;break}let a=0,l=u,h=B;for(;;){let t=0;t=1&a?l+(_-r)*(h-l)/(s-r):.5*(l+h),++a,++w;const n=y.Evaluate(e[0],i[0],t);if(Object(o.a)(n-_)<c){B=t;break}if(n>_?(l=t,r=n):(h=t,s=n),50===a)break}if(v=Object(o.m)(v,a),++S===n.D)break}if(++f,++g,x)break;if(20===f){t.state=k.e_failed,t.t=u;break}}V=Object(o.m)(V,f);const y=i.GetMilliseconds();C=Object(o.m)(C,y),S+=y}const Y=new o.A,Q=new o.A;function K(t,e,i,s,n){t.pointCount=0;const r=o.z.MulXV(i,e.m_p,Y),a=o.z.MulXV(n,s.m_p,Q),l=o.A.DistanceSquaredVV(r,a),m=e.m_radius+s.m_radius;l>m*m||(t.type=u.j.e_circles,t.localPoint.Copy(e.m_p),t.localNormal.SetZero(),t.pointCount=1,t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0)}const tt=new o.A,et=new o.A,it=new o.A;function st(t,e,i,s,r){t.pointCount=0;const a=o.z.MulXV(r,s.m_p,tt),l=o.z.MulTXV(i,a,et);let m=0,h=-n.x;const _=e.m_radius+s.m_radius,c=e.m_count,d=e.m_vertices,f=e.m_normals;for(let t=0;t<c;++t){const e=o.A.DotVV(f[t],o.A.SubVV(l,d[t],o.A.s_t0));if(e>_)return;e>h&&(h=e,m=t)}const p=m,A=(p+1)%c,y=d[p],x=d[A];if(h<n.r)return t.pointCount=1,t.type=u.j.e_faceA,t.localNormal.Copy(f[m]),o.A.MidVV(y,x,t.localPoint),t.points[0].localPoint.Copy(s.m_p),void(t.points[0].id.key=0);const B=o.A.DotVV(o.A.SubVV(l,y,o.A.s_t0),o.A.SubVV(x,y,o.A.s_t1)),S=o.A.DotVV(o.A.SubVV(l,x,o.A.s_t0),o.A.SubVV(y,x,o.A.s_t1));if(B<=0){if(o.A.DistanceSquaredVV(l,y)>_*_)return;t.pointCount=1,t.type=u.j.e_faceA,o.A.SubVV(l,y,t.localNormal).SelfNormalize(),t.localPoint.Copy(y),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else if(S<=0){if(o.A.DistanceSquaredVV(l,x)>_*_)return;t.pointCount=1,t.type=u.j.e_faceA,o.A.SubVV(l,x,t.localNormal).SelfNormalize(),t.localPoint.Copy(x),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}else{const e=o.A.MidVV(y,x,it);if((h=o.A.DotVV(o.A.SubVV(l,e,o.A.s_t1),f[p]))>_)return;t.pointCount=1,t.type=u.j.e_faceA,t.localNormal.Copy(f[p]).SelfNormalize(),t.localPoint.Copy(e),t.points[0].localPoint.Copy(s.m_p),t.points[0].id.key=0}}const nt=new o.A,ot=new o.A,rt=new o.A,at=new o.A;function lt(t,e,i,s,r){const a=t.m_vertices,l=t.m_normals,m=s.m_count,h=s.m_vertices,_=o.t.MulRV(e.q,l[i],nt),c=o.t.MulTRV(r.q,_,ot);let u=0,d=n.x;for(let t=0;t<m;++t){const e=o.A.DotVV(h[t],c);e<d&&(d=e,u=t)}const f=o.z.MulXV(e,a[i],rt),p=o.z.MulXV(r,h[u],at);return o.A.DotVV(o.A.SubVV(p,f,o.A.s_t0),_)}const mt=new o.A,ht=new o.A;function _t(t,e,i,s,r){const a=e.m_count,l=e.m_normals,m=o.A.SubVV(o.z.MulXV(r,s.m_centroid,o.A.s_t0),o.z.MulXV(i,e.m_centroid,o.A.s_t1),mt),h=o.t.MulTRV(i.q,m,ht);let _=0,c=-n.x;for(let t=0;t<a;++t){const e=o.A.DotVV(l[t],h);e>c&&(c=e,_=t)}let u=lt(e,i,_,s,r);const d=(_+a-1)%a,f=lt(e,i,d,s,r),p=(_+1)%a,A=lt(e,i,p,s,r);let y=0,x=0,B=0;if(f>u&&f>A)B=-1,y=d,x=f;else{if(!(A>u))return t[0]=_,u;B=1,y=p,x=A}for(;(u=lt(e,i,_=-1===B?(y+a-1)%a:(y+1)%a,s,r))>x;)y=_,x=u;return t[0]=y,x}const ct=new o.A;const ut=u.c.MakeArray(2),dt=u.c.MakeArray(2),ft=u.c.MakeArray(2),pt=[0],At=[0],yt=new o.A,xt=new o.A,Bt=new o.A,St=new o.A,Ct=new o.A,bt=new o.A,gt=new o.A,Vt=new o.A;function wt(t,e,i,s,r){t.pointCount=0;const a=e.m_radius+s.m_radius,l=pt;l[0]=0;const m=_t(l,e,i,s,r);if(m>a)return;const h=At;h[0]=0;const _=_t(h,s,r,e,i);if(_>a)return;let c,d,f,p,A=0,y=0;_>.98*m+.001?(c=s,d=e,f=r,p=i,A=h[0],t.type=u.j.e_faceB,y=1):(c=e,d=s,f=i,p=r,A=l[0],t.type=u.j.e_faceA,y=0);const x=ut;!function(t,e,i,s,r,a){const l=e.m_normals,m=r.m_count,h=r.m_vertices,_=r.m_normals,c=o.t.MulTRV(a.q,o.t.MulRV(i.q,l[s],o.A.s_t0),ct);let d=0,f=n.x;for(let t=0;t<m;++t){const e=o.A.DotVV(c,_[t]);e<f&&(f=e,d=t)}const p=d,A=(p+1)%m,y=t[0];o.z.MulXV(a,h[p],y.v);const x=y.id.cf;x.indexA=s,x.indexB=p,x.typeA=u.e.e_face,x.typeB=u.e.e_vertex;const B=t[1];o.z.MulXV(a,h[A],B.v);const S=B.id.cf;S.indexA=s,S.indexB=A,S.typeA=u.e.e_face,S.typeB=u.e.e_vertex}(x,c,f,A,d,p);const B=c.m_count,S=c.m_vertices,C=A,b=(A+1)%B,g=S[C],V=S[b],w=o.A.SubVV(V,g,yt);w.Normalize();const v=o.A.CrossVOne(w,xt),M=o.A.MidVV(g,V,Bt),P=o.t.MulRV(f.q,w,Ct),I=o.A.CrossVOne(P,St),G=o.z.MulXV(f,g,gt),D=o.z.MulXV(f,V,Vt),F=o.A.DotVV(I,G),R=-o.A.DotVV(P,G)+a,L=o.A.DotVV(P,D)+a,T=dt,k=ft;let z;const j=o.A.NegV(P,bt);if((z=Object(u.b)(T,x,j,R,C))<2)return;if((z=Object(u.b)(k,T,P,L,b))<2)return;t.localNormal.Copy(v),t.localPoint.Copy(M);let q=0;for(let e=0;e<n.z;++e){const i=k[e];if(o.A.DotVV(I,i.v)-F<=a){const e=t.points[q];if(o.z.MulTXV(p,i.v,e.localPoint),e.id.Copy(i.id),y){const t=e.id.cf;e.id.cf.indexA=t.indexB,e.id.cf.indexB=t.indexA,e.id.cf.typeA=t.typeB,e.id.cf.typeB=t.typeA}++q}}t.pointCount=q}const vt=new o.A,Mt=new o.A,Pt=new o.A,It=new o.A,Gt=new o.A,Dt=new o.A,Ft=new o.A,Rt=new u.f;function Lt(t,e,i,s,n){t.pointCount=0;const r=o.z.MulTXV(i,o.z.MulXV(n,s.m_p,o.A.s_t0),vt),a=e.m_vertex1,l=e.m_vertex2,m=o.A.SubVV(l,a,Mt),h=o.A.DotVV(m,o.A.SubVV(l,r,o.A.s_t0)),_=o.A.DotVV(m,o.A.SubVV(r,a,o.A.s_t0)),c=e.m_radius+s.m_radius,d=Rt;if(d.cf.indexB=0,d.cf.typeB=u.e.e_vertex,_<=0){const i=a,n=o.A.SubVV(r,i,Pt);if(o.A.DotVV(n,n)>c*c)return;if(e.m_hasVertex0){const t=e.m_vertex0,i=a,s=o.A.SubVV(i,t,It);if(o.A.DotVV(s,o.A.SubVV(i,r,o.A.s_t0))>0)return}return d.cf.indexA=0,d.cf.typeA=u.e.e_vertex,t.pointCount=1,t.type=u.j.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(d),void t.points[0].localPoint.Copy(s.m_p)}if(h<=0){const i=l,n=o.A.SubVV(r,i,Pt);if(o.A.DotVV(n,n)>c*c)return;if(e.m_hasVertex3){const t=e.m_vertex3,i=l,s=o.A.SubVV(t,i,Gt);if(o.A.DotVV(s,o.A.SubVV(r,i,o.A.s_t0))>0)return}return d.cf.indexA=1,d.cf.typeA=u.e.e_vertex,t.pointCount=1,t.type=u.j.e_circles,t.localNormal.SetZero(),t.localPoint.Copy(i),t.points[0].id.Copy(d),void t.points[0].localPoint.Copy(s.m_p)}const f=o.A.DotVV(m,m),p=Dt;p.x=1/f*(h*a.x+_*l.x),p.y=1/f*(h*a.y+_*l.y);const A=o.A.SubVV(r,p,Pt);if(o.A.DotVV(A,A)>c*c)return;const y=Ft.Set(-m.y,m.x);o.A.DotVV(y,o.A.SubVV(r,a,o.A.s_t0))<0&&y.Set(-y.x,-y.y),y.Normalize(),d.cf.indexA=0,d.cf.typeA=u.e.e_face,t.pointCount=1,t.type=u.j.e_faceA,t.localNormal.Copy(y),t.localPoint.Copy(a),t.points[0].id.Copy(d),t.points[0].localPoint.Copy(s.m_p)}class Tt{constructor(){this.type=0,this.index=0,this.separation=0}}class kt{constructor(){this.vertices=o.A.MakeArray(n.D),this.normals=o.A.MakeArray(n.D),this.count=0}}class zt{constructor(){this.m_polygonB=new kt,this.m_xf=new o.z,this.m_centroidB=new o.A,this.m_v0=new o.A,this.m_v1=new o.A,this.m_v2=new o.A,this.m_v3=new o.A,this.m_normal0=new o.A,this.m_normal1=new o.A,this.m_normal2=new o.A,this.m_normal=new o.A,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new o.A,this.m_upperLimit=new o.A,this.m_radius=0,this.m_front=!1}Collide(t,e,i,s,r){o.z.MulTXX(i,r,this.m_xf),o.z.MulXV(this.m_xf,s.m_centroid,this.m_centroidB),this.m_v0.Copy(e.m_vertex0),this.m_v1.Copy(e.m_vertex1),this.m_v2.Copy(e.m_vertex2),this.m_v3.Copy(e.m_vertex3);const a=e.m_hasVertex0,l=e.m_hasVertex3,m=o.A.SubVV(this.m_v2,this.m_v1,zt.s_edge1);m.Normalize(),this.m_normal1.Set(m.y,-m.x);const h=o.A.DotVV(this.m_normal1,o.A.SubVV(this.m_centroidB,this.m_v1,o.A.s_t0));let _=0,c=0,d=!1,f=!1;if(a){const t=o.A.SubVV(this.m_v1,this.m_v0,zt.s_edge0);t.Normalize(),this.m_normal0.Set(t.y,-t.x),d=o.A.CrossVV(t,m)>=0,_=o.A.DotVV(this.m_normal0,o.A.SubVV(this.m_centroidB,this.m_v0,o.A.s_t0))}if(l){const t=o.A.SubVV(this.m_v3,this.m_v2,zt.s_edge2);t.Normalize(),this.m_normal2.Set(t.y,-t.x),f=o.A.CrossVV(m,t)>0,c=o.A.DotVV(this.m_normal2,o.A.SubVV(this.m_centroidB,this.m_v2,o.A.s_t0))}a&&l?d&&f?(this.m_front=_>=0||h>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=_>=0||h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):f?(this.m_front=c>=0||_>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=_>=0&&h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?d?(this.m_front=_>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=_>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?f?(this.m_front=h>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=s.m_count;for(let t=0;t<s.m_count;++t)o.z.MulXV(this.m_xf,s.m_vertices[t],this.m_polygonB.vertices[t]),o.t.MulRV(this.m_xf.q,s.m_normals[t],this.m_polygonB.normals[t]);this.m_radius=2*n.Q,t.pointCount=0;const p=this.ComputeEdgeSeparation(zt.s_edgeAxis);if(0===p.type)return;if(p.separation>this.m_radius)return;const A=this.ComputePolygonSeparation(zt.s_polygonAxis);if(0!==A.type&&A.separation>this.m_radius)return;let y;y=0===A.type?p:A.separation>.98*p.separation+.001?A:p;const x=zt.s_ie,B=zt.s_rf;if(1===y.type){t.type=u.j.e_faceA;let e=0,i=o.A.DotVV(this.m_normal,this.m_polygonB.normals[0]);for(let t=1;t<this.m_polygonB.count;++t){const s=o.A.DotVV(this.m_normal,this.m_polygonB.normals[t]);s<i&&(i=s,e=t)}const s=e,n=(s+1)%this.m_polygonB.count,r=x[0];r.v.Copy(this.m_polygonB.vertices[s]),r.id.cf.indexA=0,r.id.cf.indexB=s,r.id.cf.typeA=u.e.e_face,r.id.cf.typeB=u.e.e_vertex;const a=x[1];a.v.Copy(this.m_polygonB.vertices[n]),a.id.cf.indexA=0,a.id.cf.indexB=n,a.id.cf.typeA=u.e.e_face,a.id.cf.typeB=u.e.e_vertex,this.m_front?(B.i1=0,B.i2=1,B.v1.Copy(this.m_v1),B.v2.Copy(this.m_v2),B.normal.Copy(this.m_normal1)):(B.i1=1,B.i2=0,B.v1.Copy(this.m_v2),B.v2.Copy(this.m_v1),B.normal.Copy(this.m_normal1).SelfNeg())}else{t.type=u.j.e_faceB;const e=x[0];e.v.Copy(this.m_v1),e.id.cf.indexA=0,e.id.cf.indexB=y.index,e.id.cf.typeA=u.e.e_vertex,e.id.cf.typeB=u.e.e_face;const i=x[1];i.v.Copy(this.m_v2),i.id.cf.indexA=0,i.id.cf.indexB=y.index,i.id.cf.typeA=u.e.e_vertex,i.id.cf.typeB=u.e.e_face,B.i1=y.index,B.i2=(B.i1+1)%this.m_polygonB.count,B.v1.Copy(this.m_polygonB.vertices[B.i1]),B.v2.Copy(this.m_polygonB.vertices[B.i2]),B.normal.Copy(this.m_polygonB.normals[B.i1])}B.sideNormal1.Set(B.normal.y,-B.normal.x),B.sideNormal2.Copy(B.sideNormal1).SelfNeg(),B.sideOffset1=o.A.DotVV(B.sideNormal1,B.v1),B.sideOffset2=o.A.DotVV(B.sideNormal2,B.v2);const S=zt.s_clipPoints1,C=zt.s_clipPoints2;let b=0;if((b=Object(u.b)(S,x,B.sideNormal1,B.sideOffset1,B.i1))<n.z)return;if((b=Object(u.b)(C,S,B.sideNormal2,B.sideOffset2,B.i2))<n.z)return;1===y.type?(t.localNormal.Copy(B.normal),t.localPoint.Copy(B.v1)):(t.localNormal.Copy(s.m_normals[B.i1]),t.localPoint.Copy(s.m_vertices[B.i1]));let g=0;for(let e=0;e<n.z;++e){let i;if((i=o.A.DotVV(B.normal,o.A.SubVV(C[e].v,B.v1,o.A.s_t0)))<=this.m_radius){const i=t.points[g];1===y.type?(o.z.MulTXV(this.m_xf,C[e].v,i.localPoint),i.id=C[e].id):(i.localPoint.Copy(C[e].v),i.id.cf.typeA=C[e].id.cf.typeB,i.id.cf.typeB=C[e].id.cf.typeA,i.id.cf.indexA=C[e].id.cf.indexB,i.id.cf.indexB=C[e].id.cf.indexA),++g}}t.pointCount=g}ComputeEdgeSeparation(t){const e=t;e.type=1,e.index=this.m_front?0:1,e.separation=n.x;for(let t=0;t<this.m_polygonB.count;++t){const i=o.A.DotVV(this.m_normal,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v1,o.A.s_t0));i<e.separation&&(e.separation=i)}return e}ComputePolygonSeparation(t){const e=t;e.type=0,e.index=-1,e.separation=-n.x;const i=zt.s_perp.Set(-this.m_normal.y,this.m_normal.x);for(let t=0;t<this.m_polygonB.count;++t){const s=o.A.NegV(this.m_polygonB.normals[t],zt.s_n),r=o.A.DotVV(s,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v1,o.A.s_t0)),a=o.A.DotVV(s,o.A.SubVV(this.m_polygonB.vertices[t],this.m_v2,o.A.s_t0)),l=Object(o.n)(r,a);if(l>this.m_radius)return e.type=2,e.index=t,e.separation=l,e;if(o.A.DotVV(s,i)>=0){if(o.A.DotVV(o.A.SubVV(s,this.m_upperLimit,o.A.s_t0),this.m_normal)<-n.n)continue}else if(o.A.DotVV(o.A.SubVV(s,this.m_lowerLimit,o.A.s_t0),this.m_normal)<-n.n)continue;l>e.separation&&(e.type=2,e.index=t,e.separation=l)}return e}}zt.s_edge1=new o.A,zt.s_edge0=new o.A,zt.s_edge2=new o.A,zt.s_ie=u.c.MakeArray(2),zt.s_rf=new class{constructor(){this.i1=0,this.i2=0,this.v1=new o.A,this.v2=new o.A,this.normal=new o.A,this.sideNormal1=new o.A,this.sideOffset1=0,this.sideNormal2=new o.A,this.sideOffset2=0}},zt.s_clipPoints1=u.c.MakeArray(2),zt.s_clipPoints2=u.c.MakeArray(2),zt.s_edgeAxis=new Tt,zt.s_polygonAxis=new Tt,zt.s_n=new o.A,zt.s_perp=new o.A;const jt=new zt;function qt(t,e,i,s,n){jt.Collide(t,e,i,s,n)}var Ot=i(347);class Nt extends Ot.b{constructor(t=0){super(Ot.c.e_circleShape,t),this.m_p=new o.A}Clone(){return(new Nt).Copy(this)}Copy(t){return super.Copy(t),this.m_p.Copy(t.m_p),this}GetChildCount(){return 1}TestPoint(t,e){const i=o.z.MulXV(t,this.m_p,Nt.TestPoint_s_center),s=o.A.SubVV(e,i,Nt.TestPoint_s_d);return o.A.DotVV(s,s)<=Object(o.v)(this.m_radius)}ComputeDistance(t,e,i,s){const n=o.z.MulXV(t,this.m_p,Nt.ComputeDistance_s_center);return o.A.SubVV(e,n,i),i.Normalize()-this.m_radius}RayCast(t,e,i,s){const r=o.z.MulXV(i,this.m_p,Nt.RayCast_s_position),a=o.A.SubVV(e.p1,r,Nt.RayCast_s_s),l=o.A.DotVV(a,a)-Object(o.v)(this.m_radius),m=o.A.SubVV(e.p2,e.p1,Nt.RayCast_s_r),h=o.A.DotVV(a,m),_=o.A.DotVV(m,m),c=h*h-_*l;if(c<0||_<n.r)return!1;let u=-(h+Object(o.w)(c));return 0<=u&&u<=e.maxFraction*_&&(u/=_,t.fraction=u,o.A.AddVMulSV(a,u,m,t.normal).SelfNormalize(),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_p,Nt.ComputeAABB_s_p);t.lowerBound.Set(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.Set(s.x+this.m_radius,s.y+this.m_radius)}ComputeMass(t,e){const i=Object(o.v)(this.m_radius);t.mass=e*n.P*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+o.A.DotVV(this.m_p,this.m_p))}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){const r=o.z.MulXV(i,this.m_p,new o.A),a=-(o.A.DotVV(t,r)-e);if(a<-this.m_radius+n.r)return 0;if(a>this.m_radius)return s.Copy(r),n.P*this.m_radius*this.m_radius;const l=this.m_radius*this.m_radius,m=a*a,h=l*(Object(o.c)(a/this.m_radius)+n.P/2)+a*Object(o.w)(l-m),_=-2/3*Object(o.p)(l-m,1.5)/h;return s.x=r.x+t.x*_,s.y=r.y+t.y*_,h}Dump(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}Nt.TestPoint_s_center=new o.A,Nt.TestPoint_s_d=new o.A,Nt.ComputeDistance_s_center=new o.A,Nt.RayCast_s_position=new o.A,Nt.RayCast_s_s=new o.A,Nt.RayCast_s_r=new o.A,Nt.ComputeAABB_s_p=new o.A;class Jt extends Ot.b{constructor(){super(Ot.c.e_polygonShape,n.Q),this.m_centroid=new o.A(0,0),this.m_vertices=o.A.MakeArray(n.D),this.m_normals=o.A.MakeArray(n.D),this.m_count=0}Clone(){return(new Jt).Copy(this)}Copy(t){super.Copy(t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count;for(let e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}GetChildCount(){return 1}Set(t,e=t.length,i=0){if(e<3)return this.SetAsBox(1,1);let s=Object(o.n)(e,n.D);const r=Jt.Set_s_ps;let a=0;for(let e=0;e<s;++e){const s=t[i+e];let l=!0;for(let t=0;t<a;++t)if(o.A.DistanceSquaredVV(s,r[t])<.5*n.v*(.5*n.v)){l=!1;break}l&&r[a++].Copy(s)}if((s=a)<3)return this.SetAsBox(1,1);let l=0,m=r[0].x;for(let t=1;t<s;++t){const e=r[t].x;(e>m||e===m&&r[t].y<r[l].y)&&(l=t,m=e)}const h=Jt.Set_s_hull;let _=0,c=l;for(;;){h[_]=c;let t=0;for(let e=1;e<s;++e){if(t===c){t=e;continue}const i=o.A.SubVV(r[t],r[h[_]],Jt.Set_s_r),s=o.A.SubVV(r[e],r[h[_]],Jt.Set_s_v),n=o.A.CrossVV(i,s);n<0&&(t=e),0===n&&s.LengthSquared()>i.LengthSquared()&&(t=e)}if(++_,c=t,t===l)break}this.m_count=_;for(let t=0;t<_;++t)this.m_vertices[t].Copy(r[h[t]]);for(let t=0;t<_;++t){const e=this.m_vertices[t],i=this.m_vertices[(t+1)%_],s=o.A.SubVV(i,e,o.A.s_t0);o.A.CrossVOne(s,this.m_normals[t]).SelfNormalize()}return Jt.ComputeCentroid(this.m_vertices,_,this.m_centroid),this}SetAsArray(t,e=t.length){return this.Set(t,e)}SetAsBox(t,e,i,s=0){if(this.m_count=4,this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i instanceof o.A){this.m_centroid.Copy(i);const t=new o.z;t.SetPosition(i),t.SetRotationAngle(s);for(let e=0;e<this.m_count;++e)o.z.MulXV(t,this.m_vertices[e],this.m_vertices[e]),o.t.MulRV(t.q,this.m_normals[e],this.m_normals[e])}return this}TestPoint(t,e){const i=o.z.MulTXV(t,e,Jt.TestPoint_s_pLocal);for(let t=0;t<this.m_count;++t){if(o.A.DotVV(this.m_normals[t],o.A.SubVV(i,this.m_vertices[t],o.A.s_t0))>0)return!1}return!0}ComputeDistance(t,e,i,s){const r=o.z.MulTXV(t,e,Jt.ComputeDistance_s_pLocal);let a=-n.x;const l=Jt.ComputeDistance_s_normalForMaxDistance.Copy(r);for(let t=0;t<this.m_count;++t){const e=o.A.DotVV(this.m_normals[t],o.A.SubVV(r,this.m_vertices[t],o.A.s_t0));e>a&&(a=e,l.Copy(this.m_normals[t]))}if(a>0){const e=Jt.ComputeDistance_s_minDistance.Copy(l);let s=a*a;for(let t=0;t<this.m_count;++t){const i=o.A.SubVV(r,this.m_vertices[t],Jt.ComputeDistance_s_distance),n=i.LengthSquared();s>n&&(e.Copy(i),s=n)}return o.t.MulRV(t.q,e,i),i.Normalize(),Math.sqrt(s)}return o.t.MulRV(t.q,l,i),a}RayCast(t,e,i,s){const n=o.z.MulTXV(i,e.p1,Jt.RayCast_s_p1),r=o.z.MulTXV(i,e.p2,Jt.RayCast_s_p2),a=o.A.SubVV(r,n,Jt.RayCast_s_d);let l=0,m=e.maxFraction,h=-1;for(let t=0;t<this.m_count;++t){const e=o.A.DotVV(this.m_normals[t],o.A.SubVV(this.m_vertices[t],n,o.A.s_t0)),i=o.A.DotVV(this.m_normals[t],a);if(0===i){if(e<0)return!1}else i<0&&e<l*i?(l=e/i,h=t):i>0&&e<m*i&&(m=e/i);if(m<l)return!1}return h>=0&&(t.fraction=l,o.t.MulRV(i.q,this.m_normals[h],t.normal),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_vertices[0],t.lowerBound),n=t.upperBound.Copy(s);for(let t=0;t<this.m_count;++t){const i=o.z.MulXV(e,this.m_vertices[t],Jt.ComputeAABB_s_v);o.A.MinV(i,s,s),o.A.MaxV(i,n,n)}const r=this.m_radius;s.SelfSubXY(r,r),n.SelfAddXY(r,r)}ComputeMass(t,e){const i=Jt.ComputeMass_s_center.SetZero();let s=0,n=0;const r=Jt.ComputeMass_s_s.SetZero();for(let t=0;t<this.m_count;++t)r.SelfAdd(this.m_vertices[t]);r.SelfMul(1/this.m_count);for(let t=0;t<this.m_count;++t){const e=o.A.SubVV(this.m_vertices[t],r,Jt.ComputeMass_s_e1),a=o.A.SubVV(this.m_vertices[(t+1)%this.m_count],r,Jt.ComputeMass_s_e2),l=o.A.CrossVV(e,a),m=.5*l;s+=m,i.SelfAdd(o.A.MulSV(m*(1/3),o.A.AddVV(e,a,o.A.s_t0),o.A.s_t1));const h=e.x,_=e.y,c=a.x,u=a.y;n+=1/3*.25*l*(h*h+c*h+c*c+(_*_+u*_+u*u))}t.mass=e*s,i.SelfMul(1/s),o.A.AddVV(i,r,t.center),t.I=e*n,t.I+=t.mass*(o.A.DotVV(t.center,t.center)-o.A.DotVV(i,i))}Validate(){for(let t=0;t<this.m_count;++t){const e=t,i=(t+1)%this.m_count,s=this.m_vertices[e],n=o.A.SubVV(this.m_vertices[i],s,Jt.Validate_s_e);for(let t=0;t<this.m_count;++t){if(t===e||t===i)continue;const r=o.A.SubVV(this.m_vertices[t],s,Jt.Validate_s_v);if(o.A.CrossVV(n,r)<0)return!1}}return!0}SetupDistanceProxy(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){const r=o.t.MulTRV(i.q,t,Jt.ComputeSubmergedArea_s_normalL),a=e-o.A.DotVV(t,i.p),l=Jt.ComputeSubmergedArea_s_depths;let m=0,h=-1,_=-1,c=!1;for(let t=0;t<this.m_count;++t){l[t]=o.A.DotVV(r,this.m_vertices[t])-a;const e=l[t]<-n.r;t>0&&(e?c||(h=t-1,m++):c&&(_=t-1,m++)),c=e}switch(m){case 0:if(c){const t=Jt.ComputeSubmergedArea_s_md;return this.ComputeMass(t,1),o.z.MulXV(i,t.center,s),t.mass}return 0;case 1:-1===h?h=this.m_count-1:_=this.m_count-1}const u=(h+1)%this.m_count,d=(_+1)%this.m_count,f=(0-l[h])/(l[u]-l[h]),p=(0-l[_])/(l[d]-l[_]),A=Jt.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-f)+this.m_vertices[u].x*f,this.m_vertices[h].y*(1-f)+this.m_vertices[u].y*f),y=Jt.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[_].x*(1-p)+this.m_vertices[d].x*p,this.m_vertices[_].y*(1-p)+this.m_vertices[d].y*p);let x=0;const B=Jt.ComputeSubmergedArea_s_center.SetZero();let S,C=this.m_vertices[u],b=u;for(;b!==d;){S=(b=(b+1)%this.m_count)===d?y:this.m_vertices[b];const t=.5*((C.x-A.x)*(S.y-A.y)-(C.y-A.y)*(S.x-A.x));x+=t,B.x+=t*(A.x+C.x+S.x)/3,B.y+=t*(A.y+C.y+S.y)/3,C=S}return B.SelfMul(1/x),o.z.MulXV(i,B,s),x}Dump(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.D);for(let e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}static ComputeCentroid(t,e,i){const s=i;s.SetZero();let n=0;const r=Jt.ComputeCentroid_s_pRef.SetZero();for(let i=0;i<e;++i){const a=r,l=t[i],m=t[(i+1)%e],h=o.A.SubVV(l,a,Jt.ComputeCentroid_s_e1),_=o.A.SubVV(m,a,Jt.ComputeCentroid_s_e2),c=.5*o.A.CrossVV(h,_);n+=c,s.x+=c*(1/3)*(a.x+l.x+m.x),s.y+=c*(1/3)*(a.y+l.y+m.y)}return s.SelfMul(1/n),s}}Jt.Set_s_ps=o.A.MakeArray(n.D),Jt.Set_s_hull=Object(n.g)(n.D),Jt.Set_s_r=new o.A,Jt.Set_s_v=new o.A,Jt.TestPoint_s_pLocal=new o.A,Jt.ComputeDistance_s_pLocal=new o.A,Jt.ComputeDistance_s_normalForMaxDistance=new o.A,Jt.ComputeDistance_s_minDistance=new o.A,Jt.ComputeDistance_s_distance=new o.A,Jt.RayCast_s_p1=new o.A,Jt.RayCast_s_p2=new o.A,Jt.RayCast_s_d=new o.A,Jt.ComputeAABB_s_v=new o.A,Jt.ComputeMass_s_center=new o.A,Jt.ComputeMass_s_s=new o.A,Jt.ComputeMass_s_e1=new o.A,Jt.ComputeMass_s_e2=new o.A,Jt.Validate_s_e=new o.A,Jt.Validate_s_v=new o.A,Jt.ComputeSubmergedArea_s_normalL=new o.A,Jt.ComputeSubmergedArea_s_depths=Object(n.g)(n.D),Jt.ComputeSubmergedArea_s_md=new Ot.a,Jt.ComputeSubmergedArea_s_intoVec=new o.A,Jt.ComputeSubmergedArea_s_outoVec=new o.A,Jt.ComputeSubmergedArea_s_center=new o.A,Jt.ComputeCentroid_s_pRef=new o.A,Jt.ComputeCentroid_s_e1=new o.A,Jt.ComputeCentroid_s_e2=new o.A;class Et extends Ot.b{constructor(){super(Ot.c.e_edgeShape,n.Q),this.m_vertex1=new o.A,this.m_vertex2=new o.A,this.m_vertex0=new o.A,this.m_vertex3=new o.A,this.m_hasVertex0=!1,this.m_hasVertex3=!1}Set(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}Clone(){return(new Et).Copy(this)}Copy(t){return super.Copy(t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}GetChildCount(){return 1}TestPoint(t,e){return!1}ComputeDistance(t,e,i,s){const n=o.z.MulXV(t,this.m_vertex1,Et.ComputeDistance_s_v1),r=o.z.MulXV(t,this.m_vertex2,Et.ComputeDistance_s_v2),a=o.A.SubVV(e,n,Et.ComputeDistance_s_d),l=o.A.SubVV(r,n,Et.ComputeDistance_s_s),m=o.A.DotVV(a,l);if(m>0){const t=o.A.DotVV(l,l);m>t?o.A.SubVV(e,r,a):a.SelfMulSub(m/t,l)}return i.Copy(a),i.Normalize()}RayCast(t,e,i,s){const n=o.z.MulTXV(i,e.p1,Et.RayCast_s_p1),r=o.z.MulTXV(i,e.p2,Et.RayCast_s_p2),a=o.A.SubVV(r,n,Et.RayCast_s_d),l=this.m_vertex1,m=this.m_vertex2,h=o.A.SubVV(m,l,Et.RayCast_s_e),_=t.normal.Set(h.y,-h.x).SelfNormalize(),c=o.A.DotVV(_,o.A.SubVV(l,n,o.A.s_t0)),u=o.A.DotVV(_,a);if(0===u)return!1;const d=c/u;if(d<0||e.maxFraction<d)return!1;const f=o.A.AddVMulSV(n,d,a,Et.RayCast_s_q),p=o.A.SubVV(m,l,Et.RayCast_s_r),A=o.A.DotVV(p,p);if(0===A)return!1;const y=o.A.DotVV(o.A.SubVV(f,l,o.A.s_t0),p)/A;return!(y<0||1<y)&&(t.fraction=d,o.t.MulRV(i.q,t.normal,t.normal),c>0&&t.normal.SelfNeg(),!0)}ComputeAABB(t,e,i){const s=o.z.MulXV(e,this.m_vertex1,Et.ComputeAABB_s_v1),n=o.z.MulXV(e,this.m_vertex2,Et.ComputeAABB_s_v2);o.A.MinV(s,n,t.lowerBound),o.A.MaxV(s,n,t.upperBound);const r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)}ComputeMass(t,e){t.mass=0,o.A.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}Et.ComputeDistance_s_v1=new o.A,Et.ComputeDistance_s_v2=new o.A,Et.ComputeDistance_s_d=new o.A,Et.ComputeDistance_s_s=new o.A,Et.RayCast_s_p1=new o.A,Et.RayCast_s_p2=new o.A,Et.RayCast_s_d=new o.A,Et.RayCast_s_e=new o.A,Et.RayCast_s_q=new o.A,Et.RayCast_s_r=new o.A,Et.ComputeAABB_s_v1=new o.A,Et.ComputeAABB_s_v2=new o.A;class Xt extends Ot.b{constructor(){super(Ot.c.e_chainShape,n.Q),this.m_count=0,this.m_prevVertex=new o.A,this.m_nextVertex=new o.A,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1}CreateLoop(t,e=t.length){this.m_count=e+1,this.m_vertices=o.A.MakeArray(this.m_count);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}CreateChain(t,e=t.length){this.m_count=e,this.m_vertices=o.A.MakeArray(e);for(let i=0;i<e;++i)this.m_vertices[i].Copy(t[i]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}SetPrevVertex(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}SetNextVertex(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}Clone(){return(new Xt).Copy(this)}Copy(t){return super.Copy(t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}GetChildCount(){return this.m_count-1}GetChildEdge(t,e){t.m_type=Ot.c.e_edgeShape,t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)}TestPoint(t,e){return!1}ComputeDistance(t,e,i,s){const n=Xt.ComputeDistance_s_edgeShape;return this.GetChildEdge(n,s),n.ComputeDistance(t,e,i,0)}RayCast(t,e,i,s){const n=Xt.RayCast_s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[s]),n.m_vertex2.Copy(this.m_vertices[(s+1)%this.m_count]),n.RayCast(t,e,i,0)}ComputeAABB(t,e,i){const s=this.m_vertices[i],n=this.m_vertices[(i+1)%this.m_count],r=o.z.MulXV(e,s,Xt.ComputeAABB_s_v1),a=o.z.MulXV(e,n,Xt.ComputeAABB_s_v2);o.A.MinV(r,a,t.lowerBound),o.A.MaxV(r,a,t.upperBound)}ComputeMass(t,e){t.mass=0,t.center.SetZero(),t.I=0}SetupDistanceProxy(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}ComputeSubmergedArea(t,e,i,s){return s.SetZero(),0}Dump(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = b2Vec2.MakeArray(%d);\n",n.D);for(let e=0;e<this.m_count;++e)t("    vs[%d].Set(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}Xt.ComputeDistance_s_edgeShape=new Et,Xt.RayCast_s_edgeShape=new Et,Xt.ComputeAABB_s_v1=new o.A,Xt.ComputeAABB_s_v2=new o.A;var Wt,Ut,Zt,Ht=i(360);!function(t){t[t.b2_unknown=-1]="b2_unknown",t[t.b2_staticBody=0]="b2_staticBody",t[t.b2_kinematicBody=1]="b2_kinematicBody",t[t.b2_dynamicBody=2]="b2_dynamicBody"}(Wt||(Wt={}));class $t{constructor(){this.type=Wt.b2_staticBody,this.position=new o.A(0,0),this.angle=0,this.linearVelocity=new o.A(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1}}class Yt{constructor(t,e){this.m_type=Wt.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new o.z,this.m_xf0=new o.z,this.m_sweep=new o.y,this.m_linearVelocity=new o.A,this.m_angularVelocity=0,this.m_force=new o.A,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,t.bullet&&(this.m_bulletFlag=!0),t.fixedRotation&&(this.m_fixedRotationFlag=!0),t.allowSleep&&(this.m_autoSleepFlag=!0),t.awake&&(this.m_awakeFlag=!0),t.active&&(this.m_activeFlag=!0),this.m_world=e,this.m_xf.p.Copy(t.position),this.m_xf.q.SetAngle(t.angle),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=t.angle,this.m_sweep.a=t.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(t.linearVelocity),this.m_angularVelocity=t.angularVelocity,this.m_linearDamping=t.linearDamping,this.m_angularDamping=t.angularDamping,this.m_gravityScale=t.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=t.type,t.type===Wt.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=t.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}CreateFixture(t,e){if(t instanceof Ht.c)return this.CreateFixtureDef(t);if(t instanceof Ot.b&&"number"==typeof e)return this.CreateFixtureShapeDensity(t,e);throw new Error}CreateFixtureDef(t){if(this.m_world.IsLocked())return null;const e=new Ht.b(t,this);if(e.Create(t),this.m_activeFlag){const t=this.m_world.m_contactManager.m_broadPhase;e.CreateProxies(t,this.m_xf)}return e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}CreateFixtureShapeDensity(t,e=0){const i=Yt.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=e,this.CreateFixtureDef(i)}DestroyFixture(t){if(this.m_world.IsLocked())return;let e=this.m_fixtureList,i=null;for(;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}let s=this.m_contactList;for(;s;){const e=s.contact;s=s.next;const i=e.GetFixtureA(),n=e.GetFixtureB();t!==i&&t!==n||this.m_world.m_contactManager.Destroy(e)}if(this.m_activeFlag){const e=this.m_world.m_contactManager.m_broadPhase;t.DestroyProxies(e)}t.Destroy(),t.m_next=null,--this.m_fixtureCount,this.ResetMassData()}SetTransformVec(t,e){this.SetTransformXY(t.x,t.y,e)}SetTransformXY(t,e,i){if(this.m_world.IsLocked())return;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;const s=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}SetTransform(t){this.SetTransformVec(t.p,t.GetAngle())}GetTransform(){return this.m_xf}GetPosition(){return this.m_xf.p}SetPosition(t){this.SetTransformVec(t,this.GetAngle())}SetPositionXY(t,e){this.SetTransformXY(t,e,this.GetAngle())}GetAngle(){return this.m_sweep.a}SetAngle(t){this.SetTransformVec(this.GetPosition(),t)}GetWorldCenter(){return this.m_sweep.c}GetLocalCenter(){return this.m_sweep.localCenter}SetLinearVelocity(t){this.m_type!==Wt.b2_staticBody&&(o.A.DotVV(t,t)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(t))}GetLinearVelocity(){return this.m_linearVelocity}SetAngularVelocity(t){this.m_type!==Wt.b2_staticBody&&(t*t>0&&this.SetAwake(!0),this.m_angularVelocity=t)}GetAngularVelocity(){return this.m_angularVelocity}GetDefinition(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}ApplyForce(t,e,i=!0){this.m_type===Wt.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y,this.m_torque+=(e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x))}ApplyForceToCenter(t,e=!0){this.m_type===Wt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=t.x,this.m_force.y+=t.y))}ApplyTorque(t,e=!0){this.m_type===Wt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}ApplyLinearImpulse(t,e,i=!0){this.m_type===Wt.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y,this.m_angularVelocity+=this.m_invI*((e.x-this.m_sweep.c.x)*t.y-(e.y-this.m_sweep.c.y)*t.x)))}ApplyLinearImpulseToCenter(t,e=!0){this.m_type===Wt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*t.x,this.m_linearVelocity.y+=this.m_invMass*t.y))}ApplyAngularImpulse(t,e=!0){this.m_type===Wt.b2_dynamicBody&&(e&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}GetMass(){return this.m_mass}GetInertia(){return this.m_I+this.m_mass*o.A.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}GetMassData(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*o.A.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}SetMassData(t){if(this.m_world.IsLocked())return;if(this.m_type!==Wt.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*o.A.DotVV(t.center,t.center),this.m_invI=1/this.m_I);const e=Yt.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t.center),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(this.m_sweep.c,e,o.A.s_t0),this.m_linearVelocity)}ResetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===Wt.b2_staticBody||this.m_type===Wt.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);const t=Yt.ResetMassData_s_localCenter.SetZero();for(let e=this.m_fixtureList;e;e=e.m_next){if(0===e.m_density)continue;const i=e.GetMassData(Yt.ResetMassData_s_massData);this.m_mass+=i.mass,t.x+=i.center.x*i.mass,t.y+=i.center.y*i.mass,this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.x*=this.m_invMass,t.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*o.A.DotVV(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);const e=Yt.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(t),o.z.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(this.m_sweep.c,e,o.A.s_t0),this.m_linearVelocity)}GetWorldPoint(t,e){return o.z.MulXV(this.m_xf,t,e)}GetWorldVector(t,e){return o.t.MulRV(this.m_xf.q,t,e)}GetLocalPoint(t,e){return o.z.MulTXV(this.m_xf,t,e)}GetLocalVector(t,e){return o.t.MulTRV(this.m_xf.q,t,e)}GetLinearVelocityFromWorldPoint(t,e){return o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(t,this.m_sweep.c,o.A.s_t0),e)}GetLinearVelocityFromLocalPoint(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}GetLinearDamping(){return this.m_linearDamping}SetLinearDamping(t){this.m_linearDamping=t}GetAngularDamping(){return this.m_angularDamping}SetAngularDamping(t){this.m_angularDamping=t}GetGravityScale(){return this.m_gravityScale}SetGravityScale(t){this.m_gravityScale=t}SetType(t){if(this.m_world.IsLocked())return;if(this.m_type===t)return;this.m_type=t,this.ResetMassData(),this.m_type===Wt.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null;const i=this.m_world.m_contactManager.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next){const e=t.m_proxyCount;for(let s=0;s<e;++s)i.TouchProxy(t.m_proxies[s].treeNode)}}GetType(){return this.m_type}SetBullet(t){this.m_bulletFlag=t}IsBullet(){return this.m_bulletFlag}SetSleepingAllowed(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}IsSleepingAllowed(){return this.m_autoSleepFlag}SetAwake(t){t?this.m_awakeFlag||(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}IsAwake(){return this.m_awakeFlag}SetActive(t){if(t!==this.IsActive())if(this.m_activeFlag=t,t){const t=this.m_world.m_contactManager.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(t,this.m_xf)}else{const t=this.m_world.m_contactManager.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies(t);let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.m_contactManager.Destroy(t.contact)}this.m_contactList=null}}IsActive(){return this.m_activeFlag}SetFixedRotation(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}IsFixedRotation(){return this.m_fixedRotationFlag}GetFixtureList(){return this.m_fixtureList}GetJointList(){return this.m_jointList}GetContactList(){return this.m_contactList}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}GetWorld(){return this.m_world}Dump(t){const e=this.m_islandIndex;t("{\n"),t("  const bd: b2BodyDef = new b2BodyDef();\n");let i="";switch(this.m_type){case Wt.b2_staticBody:i="b2BodyType.b2_staticBody";break;case Wt.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case Wt.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}t("  bd.type = %s;\n",i),t("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),t("  bd.angle = %.15f;\n",this.m_sweep.a),t("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),t("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),t("  bd.linearDamping = %.15f;\n",this.m_linearDamping),t("  bd.angularDamping = %.15f;\n",this.m_angularDamping),t("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),t("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),t("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),t("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),t("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),t("  bd.gravityScale = %.15f;\n",this.m_gravityScale),t("\n"),t("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),t("\n");for(let i=this.m_fixtureList;i;i=i.m_next)t("  {\n"),i.Dump(t,e),t("  }\n");t("}\n")}SynchronizeFixtures(){const t=Yt.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),o.t.MulRV(t.q,this.m_sweep.localCenter,t.p),o.A.SubVV(this.m_sweep.c0,t.p,t.p);const e=this.m_world.m_contactManager.m_broadPhase;for(let i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(e,t,this.m_xf)}SynchronizeTransform(){this.m_xf.q.SetAngle(this.m_sweep.a),o.t.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.A.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}ShouldCollide(t){return(this.m_type!==Wt.b2_staticBody||t.m_type!==Wt.b2_staticBody)&&this.ShouldCollideConnected(t)}ShouldCollideConnected(t){for(let e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}Advance(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),o.t.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),o.A.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}GetControllerList(){return this.m_controllerList}GetControllerCount(){return this.m_controllerCount}}Yt.CreateFixtureShapeDensity_s_def=new Ht.c,Yt.SetMassData_s_oldCenter=new o.A,Yt.ResetMassData_s_localCenter=new o.A,Yt.ResetMassData_s_oldCenter=new o.A,Yt.ResetMassData_s_massData=new Ot.a,Yt.SynchronizeFixtures_s_xf1=new o.z,function(t){t[t.e_unknownJoint=0]="e_unknownJoint",t[t.e_revoluteJoint=1]="e_revoluteJoint",t[t.e_prismaticJoint=2]="e_prismaticJoint",t[t.e_distanceJoint=3]="e_distanceJoint",t[t.e_pulleyJoint=4]="e_pulleyJoint",t[t.e_mouseJoint=5]="e_mouseJoint",t[t.e_gearJoint=6]="e_gearJoint",t[t.e_wheelJoint=7]="e_wheelJoint",t[t.e_weldJoint=8]="e_weldJoint",t[t.e_frictionJoint=9]="e_frictionJoint",t[t.e_ropeJoint=10]="e_ropeJoint",t[t.e_motorJoint=11]="e_motorJoint",t[t.e_areaJoint=12]="e_areaJoint"}(Ut||(Ut={})),function(t){t[t.e_inactiveLimit=0]="e_inactiveLimit",t[t.e_atLowerLimit=1]="e_atLowerLimit",t[t.e_atUpperLimit=2]="e_atUpperLimit",t[t.e_equalLimits=3]="e_equalLimits"}(Zt||(Zt={}));class Qt{constructor(){this.linear=new o.A,this.angularA=0,this.angularB=0}SetZero(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}Set(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}class Kt{constructor(t,e){this.prev=null,this.next=null,this.joint=t,this.other=e}}class te{constructor(t){this.type=Ut.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1,this.type=t}}class ee{constructor(t){this.m_type=Ut.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=t.type,this.m_edgeA=new Kt(this,t.bodyB),this.m_edgeB=new Kt(this,t.bodyA),this.m_bodyA=t.bodyA,this.m_bodyB=t.bodyB,this.m_collideConnected=t.collideConnected,this.m_userData=t.userData}GetType(){return this.m_type}GetBodyA(){return this.m_bodyA}GetBodyB(){return this.m_bodyB}GetAnchorA(t){return t.SetZero()}GetAnchorB(t){return t.SetZero()}GetReactionForce(t,e){return e.SetZero()}GetReactionTorque(t){return 0}GetNext(){return this.m_next}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}IsActive(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}GetCollideConnected(){return this.m_collideConnected}Dump(t){t("// Dump is not supported for this joint type.\n")}ShiftOrigin(t){}InitVelocityConstraints(t){}SolveVelocityConstraints(t){}SolvePositionConstraints(t){return!1}}class ie extends te{constructor(){super(Ut.e_distanceJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.length=1,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.length=o.A.DistanceVV(i,s),this.frequencyHz=0,this.dampingRatio=0}}class se extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_gamma=0,this.m_impulse=0,this.m_length=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_length=t.length}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse*this.m_u.x,t*this.m_impulse*this.m_u.y)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetLength(t){this.m_length=t}Length(){return this.m_length}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(c,this.m_lalcB,this.m_rB),this.m_u.x=a.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=a.y+this.m_rB.y-e.y-this.m_rA.y;const u=this.m_u.Length();u>n.v?this.m_u.SelfMul(1/u):this.m_u.SetZero();const d=o.A.CrossVV(this.m_rA,this.m_u),f=o.A.CrossVV(this.m_rB,this.m_u);let p=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==p?1/p:0,this.m_frequencyHz>0){const e=u-this.m_length,i=2*n.P*this.m_frequencyHz,s=2*this.m_mass*this.m_dampingRatio*i,o=this.m_mass*i*i,r=t.step.dt;this.m_gamma=r*(s+r*o),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=e*r*o*this.m_gamma,p+=this.m_gamma,this.m_mass=0!==p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(this.m_impulse,this.m_u,se.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*o.A.CrossVV(this.m_rA,e),m.SelfMulAdd(this.m_invMassB,e),h+=this.m_invIB*o.A.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,se.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,se.SolveVelocityConstraints_s_vpB),l=o.A.DotVV(this.m_u,o.A.SubVV(a,r,o.A.s_t0)),m=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;const h=o.A.MulSV(m,this.m_u,se.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*o.A.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,h),n+=this.m_invIB*o.A.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){if(this.m_frequencyHz>0)return!0;const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;this.m_qA.SetAngle(i),this.m_qB.SetAngle(r);const a=o.t.MulRV(this.m_qA,this.m_lalcA,this.m_rA),l=o.t.MulRV(this.m_qB,this.m_lalcB,this.m_rB),m=this.m_u;m.x=s.x+l.x-e.x-a.x,m.y=s.y+l.y-e.y-a.y;let h=this.m_u.Normalize()-this.m_length;h=Object(o.e)(h,-n.y,n.y);const _=-this.m_mass*h,c=o.A.MulSV(_,m,se.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*o.A.CrossVV(a,c),s.SelfMulAdd(this.m_invMassB,c),r+=this.m_invIB*o.A.CrossVV(l,c),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(o.a)(h)<n.v}}se.InitVelocityConstraints_s_P=new o.A,se.SolveVelocityConstraints_s_vpA=new o.A,se.SolveVelocityConstraints_s_vpB=new o.A,se.SolveVelocityConstraints_s_P=new o.A,se.SolvePositionConstraints_s_P=new o.A;class ne extends te{constructor(){super(Ut.e_areaJoint),this.world=null,this.bodies=[],this.frequencyHz=0,this.dampingRatio=0}AddBody(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}class oe extends ee{constructor(t){super(t),this.m_bodies=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_impulse=0,this.m_targetLengths=null,this.m_targetArea=0,this.m_normals=null,this.m_joints=null,this.m_deltas=null,this.m_delta=null,this.m_bodies=t.bodies,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_targetLengths=Object(n.g)(t.bodies.length),this.m_normals=o.A.MakeArray(t.bodies.length),this.m_joints=Object(n.f)(t.bodies.length),this.m_deltas=o.A.MakeArray(t.bodies.length),this.m_delta=new o.A;const e=new ie;e.frequencyHz=t.frequencyHz,e.dampingRatio=t.dampingRatio,this.m_targetArea=0;for(let i=0;i<this.m_bodies.length;++i){const s=this.m_bodies[i],n=this.m_bodies[(i+1)%this.m_bodies.length],r=s.GetWorldCenter(),a=n.GetWorldCenter();this.m_targetLengths[i]=o.A.DistanceVV(r,a),this.m_targetArea+=o.A.CrossVV(r,a),e.Initialize(s,n,r,a),this.m_joints[i]=t.world.CreateJoint(e)}this.m_targetArea*=.5}GetAnchorA(t){return t.SetZero()}GetAnchorB(t){return t.SetZero()}GetReactionForce(t,e){return e.SetZero()}GetReactionTorque(t){return 0}SetFrequency(t){this.m_frequencyHz=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t;for(let e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}GetDampingRatio(){return this.m_dampingRatio}Dump(t){t("Area joint dumping is not supported.\n")}InitVelocityConstraints(t){for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],s=this.m_bodies[(e+1)%this.m_bodies.length],n=t.positions[i.m_islandIndex].c,r=t.positions[s.m_islandIndex].c,a=this.m_deltas[e];o.A.SubVV(r,n,a)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],s=t.velocities[i.m_islandIndex].v,n=this.m_deltas[e];s.x+=i.m_invMass*n.y*.5*this.m_impulse,s.y+=i.m_invMass*-n.x*.5*this.m_impulse}}else this.m_impulse=0}SolveVelocityConstraints(t){let e=0,i=0;for(let s=0;s<this.m_bodies.length;++s){const n=this.m_bodies[s],r=t.velocities[n.m_islandIndex].v,a=this.m_deltas[s];e+=a.LengthSquared()/n.GetMass(),i+=o.A.CrossVV(r,a)}const s=-2*i/e;this.m_impulse+=s;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],n=t.velocities[i.m_islandIndex].v,o=this.m_deltas[e];n.x+=i.m_invMass*o.y*.5*s,n.y+=i.m_invMass*-o.x*.5*s}}SolvePositionConstraints(t){let e=0,i=0;for(let s=0;s<this.m_bodies.length;++s){const r=this.m_bodies[s],a=this.m_bodies[(s+1)%this.m_bodies.length],l=t.positions[r.m_islandIndex].c,m=t.positions[a.m_islandIndex].c,h=o.A.SubVV(m,l,this.m_delta);let _=h.Length();_<n.r&&(_=1),this.m_normals[s].x=h.y/_,this.m_normals[s].y=-h.x/_,e+=_,i+=o.A.CrossVV(l,m)}i*=.5;const s=.5*(this.m_targetArea-i)/e;let r=!0;for(let e=0;e<this.m_bodies.length;++e){const i=this.m_bodies[e],a=t.positions[i.m_islandIndex].c,l=(e+1)%this.m_bodies.length,m=o.A.AddVV(this.m_normals[e],this.m_normals[l],this.m_delta);m.SelfMul(s);const h=m.LengthSquared();h>Object(o.v)(n.y)&&m.SelfMul(n.y/Object(o.w)(h)),h>Object(o.v)(n.v)&&(r=!1),a.x+=m.x,a.y+=m.y}return r}}class re extends te{constructor(){super(Ut.e_frictionJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.maxForce=0,this.maxTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}class ae extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_linearImpulse=new o.A,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.k,this.m_angularMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_linearImpulse.SetZero(),this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_linearMass.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const l=this.m_qA.SetAngle(e),m=this.m_qB.SetAngle(n);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const h=o.t.MulRV(l,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const _=o.t.MulRV(m,this.m_lalcB,this.m_rB),c=this.m_invMassA,u=this.m_invMassB,d=this.m_invIA,f=this.m_invIB,p=this.m_K;if(p.ex.x=c+u+d*h.y*h.y+f*_.y*_.y,p.ex.y=-d*h.x*h.y-f*_.x*_.y,p.ey.x=p.ex.y,p.ey.y=c+u+d*h.x*h.x+f*_.x*_.x,p.GetInverse(this.m_linearMass),this.m_angularMass=d+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;i.SelfMulSub(c,e),s-=d*(o.A.CrossVV(this.m_rA,e)+this.m_angularImpulse),r.SelfMulAdd(u,e),a+=f*(o.A.CrossVV(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,h=t.step.dt;{const t=n-i;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,r=h*this.m_maxTorque;this.m_angularImpulse=Object(o.e)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-s),n+=m*e}{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),ae.SolveVelocityConstraints_s_Cdot_v2),_=o.k.MulMV(this.m_linearMass,t,ae.SolveVelocityConstraints_s_impulseV).SelfNeg(),c=ae.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(_);const u=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>u*u&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(u)),o.A.SubVV(this.m_linearImpulse,c,_),e.SelfMulSub(r,_),i-=l*o.A.CrossVV(this.m_rA,_),s.SelfMulAdd(a,_),n+=m*o.A.CrossVV(this.m_rB,_)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_linearImpulse.x,t*this.m_linearImpulse.y)}GetReactionTorque(t){return t*this.m_angularImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}ae.SolveVelocityConstraints_s_Cdot_v2=new o.A,ae.SolveVelocityConstraints_s_impulseV=new o.A,ae.SolveVelocityConstraints_s_oldImpulseV=new o.A;class le extends te{constructor(){super(Ut.e_gearJoint),this.joint1=null,this.joint2=null,this.ratio=1}}class me extends ee{constructor(t){let e,i;super(t),this.m_joint1=null,this.m_joint2=null,this.m_typeA=Ut.e_unknownJoint,this.m_typeB=Ut.e_unknownJoint,this.m_bodyC=null,this.m_bodyD=null,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localAnchorC=new o.A,this.m_localAnchorD=new o.A,this.m_localAxisC=new o.A,this.m_localAxisD=new o.A,this.m_referenceAngleA=0,this.m_referenceAngleB=0,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_indexC=0,this.m_indexD=0,this.m_lcA=new o.A,this.m_lcB=new o.A,this.m_lcC=new o.A,this.m_lcD=new o.A,this.m_mA=0,this.m_mB=0,this.m_mC=0,this.m_mD=0,this.m_iA=0,this.m_iB=0,this.m_iC=0,this.m_iD=0,this.m_JvAC=new o.A,this.m_JvBD=new o.A,this.m_JwA=0,this.m_JwB=0,this.m_JwC=0,this.m_JwD=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_qC=new o.t,this.m_qD=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_lalcC=new o.A,this.m_lalcD=new o.A,this.m_joint1=t.joint1,this.m_joint2=t.joint2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();const s=this.m_bodyA.m_xf,n=this.m_bodyA.m_sweep.a,r=this.m_bodyC.m_xf,a=this.m_bodyC.m_sweep.a;if(this.m_typeA===Ut.e_revoluteJoint){const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.SetZero(),e=n-a-this.m_referenceAngleA}else{const i=t.joint1;this.m_localAnchorC.Copy(i.m_localAnchorA),this.m_localAnchorA.Copy(i.m_localAnchorB),this.m_referenceAngleA=i.m_referenceAngle,this.m_localAxisC.Copy(i.m_localXAxisA);const n=this.m_localAnchorC,a=o.t.MulTRV(r.q,o.A.AddVV(o.t.MulRV(s.q,this.m_localAnchorA,o.A.s_t0),o.A.SubVV(s.p,r.p,o.A.s_t1),o.A.s_t0),o.A.s_t0);e=o.A.DotVV(o.A.SubVV(a,n,o.A.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();const l=this.m_bodyB.m_xf,m=this.m_bodyB.m_sweep.a,h=this.m_bodyD.m_xf,_=this.m_bodyD.m_sweep.a;if(this.m_typeB===Ut.e_revoluteJoint){const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.SetZero(),i=m-_-this.m_referenceAngleB}else{const e=t.joint2;this.m_localAnchorD.Copy(e.m_localAnchorA),this.m_localAnchorB.Copy(e.m_localAnchorB),this.m_referenceAngleB=e.m_referenceAngle,this.m_localAxisD.Copy(e.m_localXAxisA);const s=this.m_localAnchorD,n=o.t.MulTRV(h.q,o.A.AddVV(o.t.MulRV(l.q,this.m_localAnchorB,o.A.s_t0),o.A.SubVV(l.p,h.p,o.A.s_t1),o.A.s_t0),o.A.s_t0);i=o.A.DotVV(o.A.SubVV(n,s,o.A.s_t0),this.m_localAxisD)}this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*i,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const n=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v;let a=t.velocities[this.m_indexB].w;const l=t.positions[this.m_indexC].a,m=t.velocities[this.m_indexC].v;let h=t.velocities[this.m_indexC].w;const _=t.positions[this.m_indexD].a,c=t.velocities[this.m_indexD].v;let u=t.velocities[this.m_indexD].w;const d=this.m_qA.SetAngle(e),f=this.m_qB.SetAngle(n),p=this.m_qC.SetAngle(l),A=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===Ut.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=o.t.MulRV(p,this.m_localAxisC,me.InitVelocityConstraints_s_u);o.A.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);const e=o.t.MulRV(p,this.m_lalcC,me.InitVelocityConstraints_s_rC);o.A.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);const i=o.t.MulRV(d,this.m_lalcA,me.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(t),this.m_JwC=o.A.CrossVV(e,t),this.m_JwA=o.A.CrossVV(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===Ut.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=o.t.MulRV(A,this.m_localAxisD,me.InitVelocityConstraints_s_u);o.A.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);const e=o.t.MulRV(A,this.m_lalcD,me.InitVelocityConstraints_s_rD);o.A.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);const i=o.t.MulRV(f,this.m_lalcB,me.InitVelocityConstraints_s_rB);o.A.MulSV(this.m_ratio,t,this.m_JvBD),this.m_JwD=this.m_ratio*o.A.CrossVV(e,t),this.m_JwB=this.m_ratio*o.A.CrossVV(i,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.step.warmStarting?(i.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,r.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),a+=this.m_iB*this.m_impulse*this.m_JwB,m.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,c.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),u-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a,t.velocities[this.m_indexC].w=h,t.velocities[this.m_indexD].w=u}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=t.velocities[this.m_indexC].v;let a=t.velocities[this.m_indexC].w;const l=t.velocities[this.m_indexD].v;let m=t.velocities[this.m_indexD].w,h=o.A.DotVV(this.m_JvAC,o.A.SubVV(e,r,o.A.s_t0))+o.A.DotVV(this.m_JvBD,o.A.SubVV(s,l,o.A.s_t0));h+=this.m_JwA*i-this.m_JwC*a+(this.m_JwB*n-this.m_JwD*m);const _=-this.m_mass*h;this.m_impulse+=_,e.SelfMulAdd(this.m_mA*_,this.m_JvAC),i+=this.m_iA*_*this.m_JwA,s.SelfMulAdd(this.m_mB*_,this.m_JvBD),n+=this.m_iB*_*this.m_JwB,r.SelfMulSub(this.m_mC*_,this.m_JvAC),a-=this.m_iC*_*this.m_JwC,l.SelfMulSub(this.m_mD*_,this.m_JvBD),m-=this.m_iD*_*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n,t.velocities[this.m_indexC].w=a,t.velocities[this.m_indexD].w=m}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=t.positions[this.m_indexC].c;let l=t.positions[this.m_indexC].a;const m=t.positions[this.m_indexD].c;let h=t.positions[this.m_indexD].a;const _=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(r),u=this.m_qC.SetAngle(l),d=this.m_qD.SetAngle(h);let f,p;const A=this.m_JvAC,y=this.m_JvBD;let x,B,S,C,b=0;if(this.m_typeA===Ut.e_revoluteJoint)A.SetZero(),x=1,S=1,b+=this.m_iA+this.m_iC,f=i-l-this.m_referenceAngleA;else{const t=o.t.MulRV(u,this.m_localAxisC,me.SolvePositionConstraints_s_u),i=o.t.MulRV(u,this.m_lalcC,me.SolvePositionConstraints_s_rC),s=o.t.MulRV(_,this.m_lalcA,me.SolvePositionConstraints_s_rA);A.Copy(t),S=o.A.CrossVV(i,t),x=o.A.CrossVV(s,t),b+=this.m_mC+this.m_mA+this.m_iC*S*S+this.m_iA*x*x;const n=this.m_lalcC,r=o.t.MulTRV(u,o.A.AddVV(s,o.A.SubVV(e,a,o.A.s_t0),o.A.s_t0),o.A.s_t0);f=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.m_localAxisC)}if(this.m_typeB===Ut.e_revoluteJoint)y.SetZero(),B=this.m_ratio,C=this.m_ratio,b+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),p=r-h-this.m_referenceAngleB;else{const t=o.t.MulRV(d,this.m_localAxisD,me.SolvePositionConstraints_s_u),e=o.t.MulRV(d,this.m_lalcD,me.SolvePositionConstraints_s_rD),i=o.t.MulRV(c,this.m_lalcB,me.SolvePositionConstraints_s_rB);o.A.MulSV(this.m_ratio,t,y),C=this.m_ratio*o.A.CrossVV(e,t),B=this.m_ratio*o.A.CrossVV(i,t),b+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*C*C+this.m_iB*B*B;const n=this.m_lalcD,r=o.t.MulTRV(d,o.A.AddVV(i,o.A.SubVV(s,m,o.A.s_t0),o.A.s_t0),o.A.s_t0);p=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.m_localAxisD)}const g=f+this.m_ratio*p-this.m_constant;let V=0;return b>0&&(V=-g/b),e.SelfMulAdd(this.m_mA*V,A),i+=this.m_iA*V*x,s.SelfMulAdd(this.m_mB*V,y),r+=this.m_iB*V*B,a.SelfMulSub(this.m_mC*V,A),l-=this.m_iC*V*S,m.SelfMulSub(this.m_mD*V,y),h-=this.m_iD*V*C,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,t.positions[this.m_indexC].a=l,t.positions[this.m_indexD].a=h,0<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t*this.m_impulse,this.m_JvAC,e)}GetReactionTorque(t){return t*this.m_impulse*this.m_JwA}GetJoint1(){return this.m_joint1}GetJoint2(){return this.m_joint2}GetRatio(){return this.m_ratio}SetRatio(t){this.m_ratio=t}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,s=this.m_joint1.m_index,n=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",s),t("  jd.joint2 = joints[%d];\n",n),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}me.InitVelocityConstraints_s_u=new o.A,me.InitVelocityConstraints_s_rA=new o.A,me.InitVelocityConstraints_s_rB=new o.A,me.InitVelocityConstraints_s_rC=new o.A,me.InitVelocityConstraints_s_rD=new o.A,me.SolvePositionConstraints_s_u=new o.A,me.SolvePositionConstraints_s_rA=new o.A,me.SolvePositionConstraints_s_rB=new o.A,me.SolvePositionConstraints_s_rC=new o.A,me.SolvePositionConstraints_s_rD=new o.A;class he extends te{constructor(){super(Ut.e_motorJoint),this.linearOffset=new o.A(0,0),this.angularOffset=0,this.maxForce=1,this.maxTorque=1,this.correctionFactor=.3}Initialize(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);const i=this.bodyA.GetAngle(),s=this.bodyB.GetAngle();this.angularOffset=s-i}}class _e extends ee{constructor(t){super(t),this.m_linearOffset=new o.A,this.m_angularOffset=0,this.m_linearImpulse=new o.A,this.m_angularImpulse=0,this.m_maxForce=0,this.m_maxTorque=0,this.m_correctionFactor=.3,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_linearError=new o.A,this.m_angularError=0,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_linearMass=new o.k,this.m_angularMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_K=new o.k,this.m_linearOffset.Copy(t.linearOffset),this.m_linearImpulse.SetZero(),this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor}GetAnchorA(){return this.m_bodyA.GetPosition()}GetAnchorB(){return this.m_bodyB.GetPosition()}GetReactionForce(t,e){return o.A.MulSV(t,this.m_linearImpulse,e)}GetReactionTorque(t){return t*this.m_angularImpulse}SetLinearOffset(t){o.A.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}GetLinearOffset(){return this.m_linearOffset}SetAngularOffset(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}GetAngularOffset(){return this.m_angularOffset}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetMaxTorque(t){this.m_maxTorque=t}GetMaxTorque(){return this.m_maxTorque}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let n=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;const h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(a),c=o.t.MulRV(h,o.A.SubVV(this.m_linearOffset,this.m_localCenterA,o.A.s_t0),this.m_rA),u=o.t.MulRV(_,o.A.NegV(this.m_localCenterB,o.A.s_t0),this.m_rB),d=this.m_invMassA,f=this.m_invMassB,p=this.m_invIA,A=this.m_invIB,y=this.m_K;if(y.ex.x=d+f+p*c.y*c.y+A*u.y*u.y,y.ex.y=-p*c.x*c.y-A*u.x*u.y,y.ey.x=y.ex.y,y.ey.y=d+f+p*c.x*c.x+A*u.x*u.x,y.GetInverse(this.m_linearMass),this.m_angularMass=p+A,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),o.A.SubVV(o.A.AddVV(r,u,o.A.s_t0),o.A.AddVV(e,c,o.A.s_t1),this.m_linearError),this.m_angularError=a-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;const e=this.m_linearImpulse;s.SelfMulSub(d,e),n-=p*(o.A.CrossVV(c,e)+this.m_angularImpulse),l.SelfMulAdd(f,e),m+=A*(o.A.CrossVV(u,e)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=m}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,h=t.step.dt,_=t.step.inv_dt;{const t=n-i+_*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,r=h*this.m_maxTorque;this.m_angularImpulse=Object(o.e)(this.m_angularImpulse+e,-r,r),i-=l*(e=this.m_angularImpulse-s),n+=m*e}{const t=this.m_rA,c=this.m_rB,u=o.A.AddVV(o.A.SubVV(o.A.AddVV(s,o.A.CrossSV(n,c,o.A.s_t0),o.A.s_t0),o.A.AddVV(e,o.A.CrossSV(i,t,o.A.s_t1),o.A.s_t1),o.A.s_t2),o.A.MulSV(_*this.m_correctionFactor,this.m_linearError,o.A.s_t3),_e.SolveVelocityConstraints_s_Cdot_v2),d=o.k.MulMV(this.m_linearMass,u,_e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),f=_e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(d);const p=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),o.A.SubVV(this.m_linearImpulse,f,d),e.SelfMulSub(r,d),i-=l*o.A.CrossVV(t,d),s.SelfMulAdd(a,d),n+=m*o.A.CrossVV(c,d)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){return!0}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}_e.SolveVelocityConstraints_s_Cdot_v2=new o.A,_e.SolveVelocityConstraints_s_impulse_v2=new o.A,_e.SolveVelocityConstraints_s_oldImpulse_v2=new o.A;class ce extends te{constructor(){super(Ut.e_mouseJoint),this.target=new o.A,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7}}class ue extends ee{constructor(t){super(t),this.m_localAnchorB=null,this.m_targetA=null,this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_beta=0,this.m_impulse=null,this.m_maxForce=0,this.m_gamma=0,this.m_indexA=0,this.m_indexB=0,this.m_rB=null,this.m_localCenterB=null,this.m_invMassB=0,this.m_invIB=0,this.m_mass=null,this.m_C=null,this.m_qB=null,this.m_lalcB=null,this.m_K=null,this.m_localAnchorB=new o.A,this.m_targetA=new o.A,this.m_impulse=new o.A,this.m_rB=new o.A,this.m_localCenterB=new o.A,this.m_mass=new o.k,this.m_C=new o.A,this.m_qB=new o.t,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_targetA.Copy(t.target),o.z.MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=t.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0}SetTarget(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}GetTarget(){return this.m_targetA}SetMaxForce(t){this.m_maxForce=t}GetMaxForce(){return this.m_maxForce}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v;let r=t.velocities[this.m_indexB].w;const a=this.m_qB.SetAngle(i),l=this.m_bodyB.GetMass(),m=2*n.P*this.m_frequencyHz,h=2*l*this.m_dampingRatio*m,_=l*(m*m),c=t.step.dt;this.m_gamma=c*(h+c*_),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=c*_*this.m_gamma,o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(a,this.m_lalcB,this.m_rB);const u=this.m_K;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,u.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),s.x+=this.m_invMassB*this.m_impulse.x,s.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*o.A.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexB].v;let i=t.velocities[this.m_indexB].w;const s=o.A.AddVCrossSV(e,i,this.m_rB,ue.SolveVelocityConstraints_s_Cdot),n=o.k.MulMV(this.m_mass,o.A.AddVV(s,o.A.AddVV(this.m_C,o.A.MulSV(this.m_gamma,this.m_impulse,o.A.s_t0),o.A.s_t0),o.A.s_t0).SelfNeg(),ue.SolveVelocityConstraints_s_impulse),r=ue.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(n);const a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),o.A.SubVV(this.m_impulse,r,n),e.SelfMulAdd(this.m_invMassB,n),i+=this.m_invIB*o.A.CrossVV(this.m_rB,n),t.velocities[this.m_indexB].w=i}SolvePositionConstraints(t){return!0}GetAnchorA(t){return t.Copy(this.m_targetA)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t,this.m_impulse,e)}GetReactionTorque(t){return 0}Dump(t){t("Mouse joint dumping is not supported.\n")}ShiftOrigin(t){this.m_targetA.SelfSub(t)}}ue.SolveVelocityConstraints_s_Cdot=new o.A,ue.SolveVelocityConstraints_s_impulse=new o.A,ue.SolveVelocityConstraints_s_oldImpulse=new o.A;class de extends te{constructor(){super(Ut.e_prismaticJoint),this.localAnchorA=null,this.localAnchorB=null,this.localAxisA=null,this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0,this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.localAxisA=new o.A(1,0)}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class fe extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localXAxisA=new o.A,this.m_localYAxisA=new o.A,this.m_referenceAngle=0,this.m_impulse=new o.C(0,0,0),this.m_motorImpulse=0,this.m_lowerTranslation=0,this.m_upperTranslation=0,this.m_maxMotorForce=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_enableMotor=!1,this.m_limitState=Zt.e_inactiveLimit,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_axis=new o.A(0,0),this.m_perp=new o.A(0,0),this.m_s1=0,this.m_s2=0,this.m_a1=0,this.m_a2=0,this.m_K=new o.l,this.m_K3=new o.l,this.m_K2=new o.k,this.m_motorMass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_localXAxisA.Copy(t.localAxisA).SelfNormalize(),o.A.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_referenceAngle=t.referenceAngle,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const u=o.t.MulRV(_,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=o.t.MulRV(c,this.m_lalcB,this.m_rB),f=o.A.AddVV(o.A.SubVV(a,e,o.A.s_t0),o.A.SubVV(d,u,o.A.s_t1),fe.InitVelocityConstraints_s_d),p=this.m_invMassA,A=this.m_invMassB,y=this.m_invIA,x=this.m_invIB;if(o.t.MulRV(_,this.m_localXAxisA,this.m_axis),this.m_a1=o.A.CrossVV(o.A.AddVV(f,u,o.A.s_t0),this.m_axis),this.m_a2=o.A.CrossVV(d,this.m_axis),this.m_motorMass=p+A+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),o.t.MulRV(_,this.m_localYAxisA,this.m_perp),this.m_s1=o.A.CrossVV(o.A.AddVV(f,u,o.A.s_t0),this.m_perp),this.m_s2=o.A.CrossVV(d,this.m_perp),this.m_K.ex.x=p+A+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=y*this.m_s1+x*this.m_s2,this.m_K.ex.z=y*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=y+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=y*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=p+A+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){const t=o.A.DotVV(this.m_axis,f);Object(o.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*n.v?this.m_limitState=Zt.e_equalLimits:t<=this.m_lowerTranslation?this.m_limitState!==Zt.e_atLowerLimit&&(this.m_limitState=Zt.e_atLowerLimit,this.m_impulse.z=0):t>=this.m_upperTranslation?this.m_limitState!==Zt.e_atUpperLimit&&(this.m_limitState=Zt.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=Zt.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Zt.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=o.A.AddVV(o.A.MulSV(this.m_impulse.x,this.m_perp,o.A.s_t0),o.A.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,o.A.s_t1),fe.InitVelocityConstraints_s_P),i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.SelfMulSub(p,e),r-=y*i,m.SelfMulAdd(A,e),h+=x*n}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==Zt.e_equalLimits){const h=o.A.DotVV(this.m_axis,o.A.SubVV(s,e,o.A.s_t0))+this.m_a2*n-this.m_a1*i;let _=this.m_motorMass*(this.m_motorSpeed-h);const c=this.m_motorImpulse,u=t.step.dt*this.m_maxMotorForce;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+_,-u,u),_=this.m_motorImpulse-c;const d=o.A.MulSV(_,this.m_axis,fe.SolveVelocityConstraints_s_P),f=_*this.m_a1,p=_*this.m_a2;e.SelfMulSub(r,d),i-=l*f,s.SelfMulAdd(a,d),n+=m*p}const h=o.A.DotVV(this.m_perp,o.A.SubVV(s,e,o.A.s_t0))+this.m_s2*n-this.m_s1*i,_=n-i;if(this.m_enableLimit&&this.m_limitState!==Zt.e_inactiveLimit){const t=o.A.DotVV(this.m_axis,o.A.SubVV(s,e,o.A.s_t0))+this.m_a2*n-this.m_a1*i,c=fe.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),u=this.m_K.Solve33(-h,-_,-t,fe.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(u),this.m_limitState===Zt.e_atLowerLimit?this.m_impulse.z=Object(o.m)(this.m_impulse.z,0):this.m_limitState===Zt.e_atUpperLimit&&(this.m_impulse.z=Object(o.n)(this.m_impulse.z,0));const d=-h-(this.m_impulse.z-c.z)*this.m_K.ez.x,f=-_-(this.m_impulse.z-c.z)*this.m_K.ez.y,p=this.m_K.Solve22(d,f,fe.SolveVelocityConstraints_s_f2r);p.x+=c.x,p.y+=c.y,this.m_impulse.x=p.x,this.m_impulse.y=p.y,u.x=this.m_impulse.x-c.x,u.y=this.m_impulse.y-c.y,u.z=this.m_impulse.z-c.z;const A=o.A.AddVV(o.A.MulSV(u.x,this.m_perp,o.A.s_t0),o.A.MulSV(u.z,this.m_axis,o.A.s_t1),fe.SolveVelocityConstraints_s_P),y=u.x*this.m_s1+u.y+u.z*this.m_a1,x=u.x*this.m_s2+u.y+u.z*this.m_a2;e.SelfMulSub(r,A),i-=l*y,s.SelfMulAdd(a,A),n+=m*x}else{const t=this.m_K.Solve22(-h,-_,fe.SolveVelocityConstraints_s_df2);this.m_impulse.x+=t.x,this.m_impulse.y+=t.y;const c=o.A.MulSV(t.x,this.m_perp,fe.SolveVelocityConstraints_s_P),u=t.x*this.m_s1+t.y,d=t.x*this.m_s2+t.y;e.SelfMulSub(r,c),i-=l*u,s.SelfMulAdd(a,c),n+=m*d}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,u=o.t.MulRV(a,this.m_lalcA,this.m_rA),d=o.t.MulRV(l,this.m_lalcB,this.m_rB),f=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,u,o.A.s_t1),fe.SolvePositionConstraints_s_d),p=o.t.MulRV(a,this.m_localXAxisA,this.m_axis),A=o.A.CrossVV(o.A.AddVV(f,u,o.A.s_t0),p),y=o.A.CrossVV(d,p),x=o.t.MulRV(a,this.m_localYAxisA,this.m_perp),B=o.A.CrossVV(o.A.AddVV(f,u,o.A.s_t0),x),S=o.A.CrossVV(d,x);let C=fe.SolvePositionConstraints_s_impulse;const b=o.A.DotVV(x,f),g=r-i-this.m_referenceAngle;let V=Object(o.a)(b),w=Object(o.a)(g),v=!1,M=0;if(this.m_enableLimit){const t=o.A.DotVV(p,f);Object(o.a)(this.m_upperTranslation-this.m_lowerTranslation)<2*n.v?(M=Object(o.e)(t,-n.y,n.y),V=Object(o.m)(V,Object(o.a)(t)),v=!0):t<=this.m_lowerTranslation?(M=Object(o.e)(t-this.m_lowerTranslation+n.v,-n.y,0),V=Object(o.m)(V,this.m_lowerTranslation-t),v=!0):t>=this.m_upperTranslation&&(M=Object(o.e)(t-this.m_upperTranslation-n.v,0,n.y),V=Object(o.m)(V,t-this.m_upperTranslation),v=!0)}if(v){const t=m+h+_*B*B+c*S*S,e=_*B+c*S,i=_*B*A+c*S*y;let s=_+c;0===s&&(s=1);const n=_*A+c*y,o=m+h+_*A*A+c*y*y,r=this.m_K3;r.ex.SetXYZ(t,e,i),r.ey.SetXYZ(e,s,n),r.ez.SetXYZ(i,n,o),C=r.Solve33(-b,-g,-M,C)}else{const t=m+h+_*B*B+c*S*S,e=_*B+c*S;let i=_+c;0===i&&(i=1);const s=this.m_K2;s.ex.Set(t,e),s.ey.Set(e,i);const n=s.Solve(-b,-g,fe.SolvePositionConstraints_s_impulse1);C.x=n.x,C.y=n.y,C.z=0}const P=o.A.AddVV(o.A.MulSV(C.x,x,o.A.s_t0),o.A.MulSV(C.z,p,o.A.s_t1),fe.SolvePositionConstraints_s_P),I=C.x*B+C.y+C.z*A,G=C.x*S+C.y+C.z*y;return e.SelfMulSub(m,P),i-=_*I,s.SelfMulAdd(h,P),r+=c*G,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,V<=n.v&&w<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))}GetReactionTorque(t){return t*this.m_impulse.y}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetReferenceAngle(){return this.m_referenceAngle}GetJointTranslation(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,fe.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,fe.GetJointTranslation_s_pB),i=o.A.SubVV(e,t,fe.GetJointTranslation_s_d),s=this.m_bodyA.GetWorldVector(this.m_localXAxisA,fe.GetJointTranslation_s_axis);return o.A.DotVV(i,s)}GetJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;o.A.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=o.t.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const s=o.t.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=o.A.AddVV(t.m_sweep.c,i,o.A.s_t0),r=o.A.AddVV(e.m_sweep.c,s,o.A.s_t1),a=o.A.SubVV(r,n,o.A.s_t2),l=t.GetWorldVector(this.m_localXAxisA,this.m_axis),m=t.m_linearVelocity,h=e.m_linearVelocity,_=t.m_angularVelocity,c=e.m_angularVelocity;return o.A.DotVV(a,o.A.CrossSV(_,l,o.A.s_t0))+o.A.DotVV(l,o.A.SubVV(o.A.AddVCrossSV(h,c,s,o.A.s_t0),o.A.AddVCrossSV(m,_,i,o.A.s_t1),o.A.s_t0))}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerTranslation}GetUpperLimit(){return this.m_upperTranslation}SetLimits(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}SetMotorSpeed(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorForce(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t}GetMaxMotorForce(){return this.m_maxMotorForce}GetMotorForce(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}fe.InitVelocityConstraints_s_d=new o.A,fe.InitVelocityConstraints_s_P=new o.A,fe.SolveVelocityConstraints_s_P=new o.A,fe.SolveVelocityConstraints_s_f2r=new o.A,fe.SolveVelocityConstraints_s_f1=new o.C,fe.SolveVelocityConstraints_s_df3=new o.C,fe.SolveVelocityConstraints_s_df2=new o.A,fe.SolvePositionConstraints_s_d=new o.A,fe.SolvePositionConstraints_s_impulse=new o.C,fe.SolvePositionConstraints_s_impulse1=new o.A,fe.SolvePositionConstraints_s_P=new o.A,fe.GetJointTranslation_s_pA=new o.A,fe.GetJointTranslation_s_pB=new o.A,fe.GetJointTranslation_s_d=new o.A,fe.GetJointTranslation_s_axis=new o.A;class pe extends te{constructor(){super(Ut.e_pulleyJoint),this.groundAnchorA=new o.A(-1,1),this.groundAnchorB=new o.A(1,1),this.localAnchorA=new o.A(-1,0),this.localAnchorB=new o.A(1,0),this.lengthA=0,this.lengthB=0,this.ratio=1,this.collideConnected=!0}Initialize(t,e,i,s,n,r,a){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(s),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=o.A.DistanceVV(n,i),this.lengthB=o.A.DistanceVV(r,s),this.ratio=a}}class Ae extends ee{constructor(t){super(t),this.m_groundAnchorA=new o.A,this.m_groundAnchorB=new o.A,this.m_lengthA=0,this.m_lengthB=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_constant=0,this.m_ratio=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_uA=new o.A,this.m_uB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_groundAnchorA.Copy(t.groundAnchorA),this.m_groundAnchorB.Copy(t.groundAnchorB),this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_lengthA=t.lengthA,this.m_lengthB=t.lengthB,this.m_ratio=t.ratio,this.m_constant=t.lengthA+this.m_ratio*t.lengthB,this.m_impulse=0}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(c,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(a).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);const u=this.m_uA.Length(),d=this.m_uB.Length();u>10*n.v?this.m_uA.SelfMul(1/u):this.m_uA.SetZero(),d>10*n.v?this.m_uB.SelfMul(1/d):this.m_uB.SetZero();const f=o.A.CrossVV(this.m_rA,this.m_uA),p=o.A.CrossVV(this.m_rB,this.m_uB),A=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=A+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(-this.m_impulse,this.m_uA,Ae.InitVelocityConstraints_s_PA),i=o.A.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,Ae.InitVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,e),r+=this.m_invIA*o.A.CrossVV(this.m_rA,e),m.SelfMulAdd(this.m_invMassB,i),h+=this.m_invIB*o.A.CrossVV(this.m_rB,i)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,Ae.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,Ae.SolveVelocityConstraints_s_vpB),l=-o.A.DotVV(this.m_uA,r)-this.m_ratio*o.A.DotVV(this.m_uB,a),m=-this.m_mass*l;this.m_impulse+=m;const h=o.A.MulSV(-m,this.m_uA,Ae.SolveVelocityConstraints_s_PA),_=o.A.MulSV(-this.m_ratio*m,this.m_uB,Ae.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),i+=this.m_invIA*o.A.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,_),n+=this.m_invIB*o.A.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const h=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=this.m_uA.Copy(e).SelfAdd(m).SelfSub(this.m_groundAnchorA),c=this.m_uB.Copy(s).SelfAdd(h).SelfSub(this.m_groundAnchorB),u=_.Length(),d=c.Length();u>10*n.v?_.SelfMul(1/u):_.SetZero(),d>10*n.v?c.SelfMul(1/d):c.SetZero();const f=o.A.CrossVV(m,_),p=o.A.CrossVV(h,c),A=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*p*p;let x=A+this.m_ratio*this.m_ratio*y;x>0&&(x=1/x);const B=this.m_constant-u-this.m_ratio*d,S=Object(o.a)(B),C=-x*B,b=o.A.MulSV(-C,_,Ae.SolvePositionConstraints_s_PA),g=o.A.MulSV(-this.m_ratio*C,c,Ae.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,b),i+=this.m_invIA*o.A.CrossVV(m,b),s.SelfMulAdd(this.m_invMassB,g),r+=this.m_invIB*o.A.CrossVV(h,g),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,S<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse*this.m_uB.x,t*this.m_impulse*this.m_uB.y)}GetReactionTorque(t){return 0}GetGroundAnchorA(){return this.m_groundAnchorA}GetGroundAnchorB(){return this.m_groundAnchorB}GetLengthA(){return this.m_lengthA}GetLengthB(){return this.m_lengthB}GetRatio(){return this.m_ratio}GetCurrentLengthA(){const t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,Ae.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return o.A.DistanceVV(t,e)}GetCurrentLengthB(){const t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,Ae.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return o.A.DistanceVV(t,e)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}ShiftOrigin(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}Ae.InitVelocityConstraints_s_PA=new o.A,Ae.InitVelocityConstraints_s_PB=new o.A,Ae.SolveVelocityConstraints_s_vpA=new o.A,Ae.SolveVelocityConstraints_s_vpB=new o.A,Ae.SolveVelocityConstraints_s_PA=new o.A,Ae.SolveVelocityConstraints_s_PB=new o.A,Ae.SolvePositionConstraints_s_PA=new o.A,Ae.SolvePositionConstraints_s_PB=new o.A,Ae.GetCurrentLengthA_s_p=new o.A,Ae.GetCurrentLengthB_s_p=new o.A;class ye extends te{constructor(){super(Ut.e_revoluteJoint),this.localAnchorA=new o.A(0,0),this.localAnchorB=new o.A(0,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerAngle=0,this.upperAngle=0,this.enableMotor=!1,this.motorSpeed=0,this.maxMotorTorque=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class xe extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_impulse=new o.C,this.m_motorImpulse=0,this.m_enableMotor=!1,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableLimit=!1,this.m_referenceAngle=0,this.m_lowerAngle=0,this.m_upperAngle=0,this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.l,this.m_motorMass=0,this.m_limitState=Zt.e_inactiveLimit,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.k,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=Zt.e_inactiveLimit}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(e),h=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(m,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(h,this.m_lalcB,this.m_rB);const _=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,d=this.m_invIB,f=u+d===0;if(this.m_mass.ex.x=_+c+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*d,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*d,this.m_mass.ez.x=-this.m_rA.y*u-this.m_rB.y*d,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=_+c+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*d,this.m_mass.ez.y=this.m_rA.x*u+this.m_rB.x*d,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=u+d,this.m_motorMass=u+d,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!f||(this.m_motorImpulse=0),this.m_enableLimit&&!f){const t=r-e-this.m_referenceAngle;Object(o.a)(this.m_upperAngle-this.m_lowerAngle)<2*n.n?this.m_limitState=Zt.e_equalLimits:t<=this.m_lowerAngle?(this.m_limitState!==Zt.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=Zt.e_atLowerLimit):t>=this.m_upperAngle?(this.m_limitState!==Zt.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=Zt.e_atUpperLimit):(this.m_limitState=Zt.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=Zt.e_inactiveLimit;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio),this.m_motorImpulse*=t.step.dtRatio;const e=xe.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,e),s-=u*(o.A.CrossVV(this.m_rA,e)+this.m_motorImpulse+this.m_impulse.z),a.SelfMulAdd(c,e),l+=d*(o.A.CrossVV(this.m_rB,e)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB,h=l+m===0;if(this.m_enableMotor&&this.m_limitState!==Zt.e_equalLimits&&!h){const e=n-i-this.m_motorSpeed;let s=-this.m_motorMass*e;const r=this.m_motorImpulse,a=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+s,-a,a),i-=l*(s=this.m_motorImpulse-r),n+=m*s}if(this.m_enableLimit&&this.m_limitState!==Zt.e_inactiveLimit&&!h){const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),xe.SolveVelocityConstraints_s_Cdot1),h=n-i,_=this.m_mass.Solve33(t.x,t.y,h,xe.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===Zt.e_equalLimits)this.m_impulse.SelfAdd(_);else if(this.m_limitState===Zt.e_atLowerLimit){if(this.m_impulse.z+_.z<0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,xe.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}else if(this.m_limitState===Zt.e_atUpperLimit){if(this.m_impulse.z+_.z>0){const e=-t.x+this.m_impulse.z*this.m_mass.ez.x,i=-t.y+this.m_impulse.z*this.m_mass.ez.y,s=this.m_mass.Solve22(e,i,xe.SolveVelocityConstraints_s_reduced_v2);_.x=s.x,_.y=s.y,_.z=-this.m_impulse.z,this.m_impulse.x+=s.x,this.m_impulse.y+=s.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(_)}const c=xe.SolveVelocityConstraints_s_P.Set(_.x,_.y);e.SelfMulSub(r,c),i-=l*(o.A.CrossVV(this.m_rA,c)+_.z),s.SelfMulAdd(a,c),n+=m*(o.A.CrossVV(this.m_rB,c)+_.z)}else{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),xe.SolveVelocityConstraints_s_Cdot_v2),h=this.m_mass.Solve22(-t.x,-t.y,xe.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=h.x,this.m_impulse.y+=h.y,e.SelfMulSub(r,h),i-=l*o.A.CrossVV(this.m_rA,h),s.SelfMulAdd(a,h),n+=m*o.A.CrossVV(this.m_rB,h)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);let m=0,h=0;const _=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==Zt.e_inactiveLimit&&!_){const t=r-i-this.m_referenceAngle;let e=0;if(this.m_limitState===Zt.e_equalLimits){const i=Object(o.e)(t-this.m_lowerAngle,-n.w,n.w);e=-this.m_motorMass*i,m=Object(o.a)(i)}else if(this.m_limitState===Zt.e_atLowerLimit){let i=t-this.m_lowerAngle;m=-i,i=Object(o.e)(i+n.n,-n.w,0),e=-this.m_motorMass*i}else if(this.m_limitState===Zt.e_atUpperLimit){let i=t-this.m_upperAngle;m=i,i=Object(o.e)(i-n.n,0,n.w),e=-this.m_motorMass*i}i-=this.m_invIA*e,r+=this.m_invIB*e}{a.SetAngle(i),l.SetAngle(r),o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const t=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const n=o.t.MulRV(l,this.m_lalcB,this.m_rB),m=o.A.SubVV(o.A.AddVV(s,n,o.A.s_t0),o.A.AddVV(e,t,o.A.s_t1),xe.SolvePositionConstraints_s_C_v2);h=m.Length();const _=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,d=this.m_invIB,f=this.m_K;f.ex.x=_+c+u*t.y*t.y+d*n.y*n.y,f.ex.y=-u*t.x*t.y-d*n.x*n.y,f.ey.x=f.ex.y,f.ey.y=_+c+u*t.x*t.x+d*n.x*n.x;const p=f.Solve(m.x,m.y,xe.SolvePositionConstraints_s_impulse).SelfNeg();e.SelfMulSub(_,p),i-=u*o.A.CrossVV(t,p),s.SelfMulAdd(c,p),r+=d*o.A.CrossVV(n,p)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,h<=n.v&&m<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}GetJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}GetJointSpeed(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_enableMotor!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}GetMotorTorque(t){return t*this.m_motorImpulse}GetMotorSpeed(){return this.m_motorSpeed}SetMaxMotorTorque(t){this.m_maxMotorTorque=t}GetMaxMotorTorque(){return this.m_maxMotorTorque}IsLimitEnabled(){return this.m_enableLimit}EnableLimit(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}GetLowerLimit(){return this.m_lowerAngle}GetUpperLimit(){return this.m_upperAngle}SetLimits(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}SetMotorSpeed(t){this.m_motorSpeed!==t&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}xe.InitVelocityConstraints_s_P=new o.A,xe.SolveVelocityConstraints_s_P=new o.A,xe.SolveVelocityConstraints_s_Cdot_v2=new o.A,xe.SolveVelocityConstraints_s_Cdot1=new o.A,xe.SolveVelocityConstraints_s_impulse_v3=new o.C,xe.SolveVelocityConstraints_s_reduced_v2=new o.A,xe.SolveVelocityConstraints_s_impulse_v2=new o.A,xe.SolvePositionConstraints_s_C_v2=new o.A,xe.SolvePositionConstraints_s_impulse=new o.A;class Be extends te{constructor(){super(Ut.e_ropeJoint),this.localAnchorA=new o.A(-1,0),this.localAnchorB=new o.A(1,0),this.maxLength=0}}class Se extends ee{constructor(t){super(t),this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_maxLength=0,this.m_length=0,this.m_impulse=0,this.m_indexA=0,this.m_indexB=0,this.m_u=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=0,this.m_state=Zt.e_inactiveLimit,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_maxLength=t.maxLength}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v;let r=t.velocities[this.m_indexA].w;const a=t.positions[this.m_indexB].c,l=t.positions[this.m_indexB].a,m=t.velocities[this.m_indexB].v;let h=t.velocities[this.m_indexB].w;const _=this.m_qA.SetAngle(i),c=this.m_qB.SetAngle(l);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(_,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(c,this.m_lalcB,this.m_rB),this.m_u.Copy(a).SelfAdd(this.m_rB).SelfSub(e).SelfSub(this.m_rA),this.m_length=this.m_u.Length();const u=this.m_length-this.m_maxLength;if(this.m_state=u>0?Zt.e_atUpperLimit:Zt.e_inactiveLimit,!(this.m_length>n.v))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);const d=o.A.CrossVV(this.m_rA,this.m_u),f=o.A.CrossVV(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*d*d+this.m_invMassB+this.m_invIB*f*f;if(this.m_mass=0!==p?1/p:0,t.step.warmStarting){this.m_impulse*=t.step.dtRatio;const e=o.A.MulSV(this.m_impulse,this.m_u,Se.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,e),r-=this.m_invIA*o.A.CrossVV(this.m_rA,e),m.SelfMulAdd(this.m_invMassB,e),h+=this.m_invIB*o.A.CrossVV(this.m_rB,e)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=h}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=o.A.AddVCrossSV(e,i,this.m_rA,Se.SolveVelocityConstraints_s_vpA),a=o.A.AddVCrossSV(s,n,this.m_rB,Se.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength;let m=o.A.DotVV(this.m_u,o.A.SubVV(a,r,o.A.s_t0));l<0&&(m+=t.step.inv_dt*l);let h=-this.m_mass*m;const _=this.m_impulse;this.m_impulse=Object(o.n)(0,this.m_impulse+h),h=this.m_impulse-_;const c=o.A.MulSV(h,this.m_u,Se.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*o.A.CrossVV(this.m_rA,c),s.SelfMulAdd(this.m_invMassB,c),n+=this.m_invIB*o.A.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const h=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=this.m_u.Copy(s).SelfAdd(h).SelfSub(e).SelfSub(m),c=_.Normalize();let u=c-this.m_maxLength;u=Object(o.e)(u,0,n.y);const d=-this.m_mass*u,f=o.A.MulSV(d,_,Se.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),i-=this.m_invIA*o.A.CrossVV(m,f),s.SelfMulAdd(this.m_invMassB,f),r+=this.m_invIB*o.A.CrossVV(h,f),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,c-this.m_maxLength<n.v}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return o.A.MulSV(t*this.m_impulse,this.m_u,e)}GetReactionTorque(t){return 0}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}SetMaxLength(t){this.m_maxLength=t}GetMaxLength(){return this.m_maxLength}GetLimitState(){return this.m_state}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Se.InitVelocityConstraints_s_P=new o.A,Se.SolveVelocityConstraints_s_vpA=new o.A,Se.SolveVelocityConstraints_s_vpB=new o.A,Se.SolveVelocityConstraints_s_P=new o.A,Se.SolvePositionConstraints_s_P=new o.A;class Ce extends te{constructor(){super(Ut.e_weldJoint),this.localAnchorA=new o.A,this.localAnchorB=new o.A,this.referenceAngle=0,this.frequencyHz=0,this.dampingRatio=0}Initialize(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}class be extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_bias=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_referenceAngle=0,this.m_gamma=0,this.m_impulse=new o.C(0,0,0),this.m_indexA=0,this.m_indexB=0,this.m_rA=new o.A,this.m_rB=new o.A,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_mass=new o.l,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_K=new o.l,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_referenceAngle=t.referenceAngle,this.m_impulse.SetZero()}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v;let s=t.velocities[this.m_indexA].w;const r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v;let l=t.velocities[this.m_indexB].w;const m=this.m_qA.SetAngle(e),h=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),o.t.MulRV(m,this.m_lalcA,this.m_rA),o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),o.t.MulRV(h,this.m_lalcB,this.m_rB);const _=this.m_invMassA,c=this.m_invMassB,u=this.m_invIA,d=this.m_invIB,f=this.m_K;if(f.ex.x=_+c+this.m_rA.y*this.m_rA.y*u+this.m_rB.y*this.m_rB.y*d,f.ey.x=-this.m_rA.y*this.m_rA.x*u-this.m_rB.y*this.m_rB.x*d,f.ez.x=-this.m_rA.y*u-this.m_rB.y*d,f.ex.y=f.ey.x,f.ey.y=_+c+this.m_rA.x*this.m_rA.x*u+this.m_rB.x*this.m_rB.x*d,f.ez.y=this.m_rA.x*u+this.m_rB.x*d,f.ex.z=f.ez.x,f.ey.z=f.ez.y,f.ez.z=u+d,this.m_frequencyHz>0){f.GetInverse22(this.m_mass);let i=u+d;const s=i>0?1/i:0,o=r-e-this.m_referenceAngle,a=2*n.P*this.m_frequencyHz,l=2*s*this.m_dampingRatio*a,m=s*a*a,h=t.step.dt;this.m_gamma=h*(l+h*m),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=o*h*m*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!==i?1/i:0}else f.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);const e=be.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(_,e),s-=u*(o.A.CrossVV(this.m_rA,e)+this.m_impulse.z),a.SelfMulAdd(c,e),l+=d*(o.A.CrossVV(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}SolveVelocityConstraints(t){const e=t.velocities[this.m_indexA].v;let i=t.velocities[this.m_indexA].w;const s=t.velocities[this.m_indexB].v;let n=t.velocities[this.m_indexB].w;const r=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){const t=n-i,h=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=h,i-=l*h,n+=m*h;const _=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),be.SolveVelocityConstraints_s_Cdot1),c=o.l.MulM33XY(this.m_mass,_.x,_.y,be.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=c.x,this.m_impulse.y+=c.y;const u=c;e.SelfMulSub(r,u),i-=l*o.A.CrossVV(this.m_rA,u),s.SelfMulAdd(a,u),n+=m*o.A.CrossVV(this.m_rB,u)}else{const t=o.A.SubVV(o.A.AddVCrossSV(s,n,this.m_rB,o.A.s_t0),o.A.AddVCrossSV(e,i,this.m_rA,o.A.s_t1),be.SolveVelocityConstraints_s_Cdot1),h=n-i,_=o.l.MulM33XYZ(this.m_mass,t.x,t.y,h,be.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(_);const c=be.SolveVelocityConstraints_s_P.Set(_.x,_.y);e.SelfMulSub(r,c),i-=l*(o.A.CrossVV(this.m_rA,c)+_.z),s.SelfMulAdd(a,c),n+=m*(o.A.CrossVV(this.m_rB,c)+_.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=n}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r),m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB;o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const u=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const d=o.t.MulRV(l,this.m_lalcB,this.m_rB);let f,p;const A=this.m_K;if(A.ex.x=m+h+u.y*u.y*_+d.y*d.y*c,A.ey.x=-u.y*u.x*_-d.y*d.x*c,A.ez.x=-u.y*_-d.y*c,A.ex.y=A.ey.x,A.ey.y=m+h+u.x*u.x*_+d.x*d.x*c,A.ez.y=u.x*_+d.x*c,A.ex.z=A.ez.x,A.ey.z=A.ez.y,A.ez.z=_+c,this.m_frequencyHz>0){const t=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,u,o.A.s_t1),be.SolvePositionConstraints_s_C1);f=t.Length(),p=0;const n=A.Solve22(t.x,t.y,be.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(m,n),i-=_*o.A.CrossVV(u,n),s.SelfMulAdd(h,n),r+=c*o.A.CrossVV(d,n)}else{const t=o.A.SubVV(o.A.AddVV(s,d,o.A.s_t0),o.A.AddVV(e,u,o.A.s_t1),be.SolvePositionConstraints_s_C1),n=r-i-this.m_referenceAngle;f=t.Length(),p=Object(o.a)(n);const a=A.Solve33(t.x,t.y,n,be.SolvePositionConstraints_s_impulse).SelfNeg(),l=be.SolvePositionConstraints_s_P.Set(a.x,a.y);e.SelfMulSub(m,l),i-=_*(o.A.CrossVV(this.m_rA,l)+a.z),s.SelfMulAdd(h,l),r+=c*(o.A.CrossVV(this.m_rB,l)+a.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,f<=n.v&&p<=n.n}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.Set(t*this.m_impulse.x,t*this.m_impulse.y)}GetReactionTorque(t){return t*this.m_impulse.z}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetReferenceAngle(){return this.m_referenceAngle}SetFrequency(t){this.m_frequencyHz=t}GetFrequency(){return this.m_frequencyHz}SetDampingRatio(t){this.m_dampingRatio=t}GetDampingRatio(){return this.m_dampingRatio}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}be.InitVelocityConstraints_s_P=new o.A,be.SolveVelocityConstraints_s_Cdot1=new o.A,be.SolveVelocityConstraints_s_impulse1=new o.A,be.SolveVelocityConstraints_s_impulse=new o.C,be.SolveVelocityConstraints_s_P=new o.A,be.SolvePositionConstraints_s_C1=new o.A,be.SolvePositionConstraints_s_P=new o.A,be.SolvePositionConstraints_s_impulse=new o.C;class ge extends te{constructor(){super(Ut.e_wheelJoint),this.localAnchorA=new o.A(0,0),this.localAnchorB=new o.A(0,0),this.localAxisA=new o.A(1,0),this.enableMotor=!1,this.maxMotorTorque=0,this.motorSpeed=0,this.frequencyHz=2,this.dampingRatio=.7}Initialize(t,e,i,s){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(s,this.localAxisA)}}class Ve extends ee{constructor(t){super(t),this.m_frequencyHz=0,this.m_dampingRatio=0,this.m_localAnchorA=new o.A,this.m_localAnchorB=new o.A,this.m_localXAxisA=new o.A,this.m_localYAxisA=new o.A,this.m_impulse=0,this.m_motorImpulse=0,this.m_springImpulse=0,this.m_maxMotorTorque=0,this.m_motorSpeed=0,this.m_enableMotor=!1,this.m_indexA=0,this.m_indexB=0,this.m_localCenterA=new o.A,this.m_localCenterB=new o.A,this.m_invMassA=0,this.m_invMassB=0,this.m_invIA=0,this.m_invIB=0,this.m_ax=new o.A,this.m_ay=new o.A,this.m_sAx=0,this.m_sBx=0,this.m_sAy=0,this.m_sBy=0,this.m_mass=0,this.m_motorMass=0,this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_qA=new o.t,this.m_qB=new o.t,this.m_lalcA=new o.A,this.m_lalcB=new o.A,this.m_rA=new o.A,this.m_rB=new o.A,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_localAnchorA.Copy(t.localAnchorA),this.m_localAnchorB.Copy(t.localAnchorB),this.m_localXAxisA.Copy(t.localAxisA),o.A.CrossOneV(this.m_localXAxisA,this.m_localYAxisA),this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_ax.SetZero(),this.m_ay.SetZero()}GetMotorSpeed(){return this.m_motorSpeed}GetMaxMotorTorque(){return this.m_maxMotorTorque}SetSpringFrequencyHz(t){this.m_frequencyHz=t}GetSpringFrequencyHz(){return this.m_frequencyHz}SetSpringDampingRatio(t){this.m_dampingRatio=t}GetSpringDampingRatio(){return this.m_dampingRatio}InitVelocityConstraints(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,a=t.positions[this.m_indexA].c,l=t.positions[this.m_indexA].a,m=t.velocities[this.m_indexA].v;let h=t.velocities[this.m_indexA].w;const _=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,u=t.velocities[this.m_indexB].v;let d=t.velocities[this.m_indexB].w;const f=this.m_qA.SetAngle(l),p=this.m_qB.SetAngle(c);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const A=o.t.MulRV(f,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const y=o.t.MulRV(p,this.m_lalcB,this.m_rB),x=o.A.SubVV(o.A.AddVV(_,y,o.A.s_t0),o.A.AddVV(a,A,o.A.s_t1),Ve.InitVelocityConstraints_s_d);if(o.t.MulRV(f,this.m_localYAxisA,this.m_ay),this.m_sAy=o.A.CrossVV(o.A.AddVV(x,A,o.A.s_t0),this.m_ay),this.m_sBy=o.A.CrossVV(y,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){o.t.MulRV(f,this.m_localXAxisA,this.m_ax),this.m_sAx=o.A.CrossVV(o.A.AddVV(x,A,o.A.s_t0),this.m_ax),this.m_sBx=o.A.CrossVV(y,this.m_ax);const a=e+i+s*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(a>0){this.m_springMass=1/a;const e=o.A.DotVV(x,this.m_ax),i=2*n.P*this.m_frequencyHz,s=2*this.m_springMass*this.m_dampingRatio*i,r=this.m_springMass*i*i,l=t.step.dt;this.m_gamma=l*(s+l*r),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*l*r*this.m_gamma,this.m_springMass=a+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;const e=o.A.AddVV(o.A.MulSV(this.m_impulse,this.m_ay,o.A.s_t0),o.A.MulSV(this.m_springImpulse,this.m_ax,o.A.s_t1),Ve.InitVelocityConstraints_s_P),i=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,s=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;m.SelfMulSub(this.m_invMassA,e),h-=this.m_invIA*i,u.SelfMulAdd(this.m_invMassB,e),d+=this.m_invIB*s}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=h,t.velocities[this.m_indexB].w=d}SolveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,n=this.m_invIB,r=t.velocities[this.m_indexA].v;let a=t.velocities[this.m_indexA].w;const l=t.velocities[this.m_indexB].v;let m=t.velocities[this.m_indexB].w;{const t=o.A.DotVV(this.m_ax,o.A.SubVV(l,r,o.A.s_t0))+this.m_sBx*m-this.m_sAx*a,h=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=h;const _=o.A.MulSV(h,this.m_ax,Ve.SolveVelocityConstraints_s_P),c=h*this.m_sAx,u=h*this.m_sBx;r.SelfMulSub(e,_),a-=s*c,l.SelfMulAdd(i,_),m+=n*u}{const e=m-a-this.m_motorSpeed;let i=-this.m_motorMass*e;const r=this.m_motorImpulse,l=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=Object(o.e)(this.m_motorImpulse+i,-l,l),a-=s*(i=this.m_motorImpulse-r),m+=n*i}{const t=o.A.DotVV(this.m_ay,o.A.SubVV(l,r,o.A.s_t0))+this.m_sBy*m-this.m_sAy*a,h=-this.m_mass*t;this.m_impulse+=h;const _=o.A.MulSV(h,this.m_ay,Ve.SolveVelocityConstraints_s_P),c=h*this.m_sAy,u=h*this.m_sBy;r.SelfMulSub(e,_),a-=s*c,l.SelfMulAdd(i,_),m+=n*u}t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=m}SolvePositionConstraints(t){const e=t.positions[this.m_indexA].c;let i=t.positions[this.m_indexA].a;const s=t.positions[this.m_indexB].c;let r=t.positions[this.m_indexB].a;const a=this.m_qA.SetAngle(i),l=this.m_qB.SetAngle(r);o.A.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);const m=o.t.MulRV(a,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);const h=o.t.MulRV(l,this.m_lalcB,this.m_rB),_=o.A.AddVV(o.A.SubVV(s,e,o.A.s_t0),o.A.SubVV(h,m,o.A.s_t1),Ve.SolvePositionConstraints_s_d),c=o.t.MulRV(a,this.m_localYAxisA,this.m_ay),u=o.A.CrossVV(o.A.AddVV(_,m,o.A.s_t0),c),d=o.A.CrossVV(h,c),f=o.A.DotVV(_,this.m_ay),p=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let A;A=0!==p?-f/p:0;const y=o.A.MulSV(A,c,Ve.SolvePositionConstraints_s_P),x=A*u,B=A*d;return e.SelfMulSub(this.m_invMassA,y),i-=this.m_invIA*x,s.SelfMulAdd(this.m_invMassB,y),r+=this.m_invIB*B,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,Object(o.a)(f)<=n.v}GetDefinition(t){return t}GetAnchorA(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}GetAnchorB(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}GetReactionForce(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}GetReactionTorque(t){return t*this.m_motorImpulse}GetLocalAnchorA(){return this.m_localAnchorA}GetLocalAnchorB(){return this.m_localAnchorB}GetLocalAxisA(){return this.m_localXAxisA}GetJointTranslation(){return this.GetPrismaticJointTranslation()}GetJointSpeed(){return this.GetRevoluteJointSpeed()}GetPrismaticJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new o.A),s=e.GetWorldPoint(this.m_localAnchorB,new o.A),n=o.A.SubVV(s,i,new o.A),r=t.GetWorldVector(this.m_localXAxisA,new o.A);return o.A.DotVV(n,r)}GetPrismaticJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB;o.A.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);const i=o.t.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);o.A.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);const s=o.t.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),n=o.A.AddVV(t.m_sweep.c,i,o.A.s_t0),r=o.A.AddVV(e.m_sweep.c,s,o.A.s_t1),a=o.A.SubVV(r,n,o.A.s_t2),l=t.GetWorldVector(this.m_localXAxisA,new o.A),m=t.m_linearVelocity,h=e.m_linearVelocity,_=t.m_angularVelocity,c=e.m_angularVelocity;return o.A.DotVV(a,o.A.CrossSV(_,l,o.A.s_t0))+o.A.DotVV(l,o.A.SubVV(o.A.AddVCrossSV(h,c,s,o.A.s_t0),o.A.AddVCrossSV(m,_,i,o.A.s_t1),o.A.s_t0))}GetRevoluteJointAngle(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}GetRevoluteJointSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}IsMotorEnabled(){return this.m_enableMotor}EnableMotor(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t}SetMotorSpeed(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t}SetMaxMotorTorque(t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t}GetMotorTorque(t){return t*this.m_motorImpulse}Dump(t){const e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}Ve.InitVelocityConstraints_s_d=new o.A,Ve.InitVelocityConstraints_s_P=new o.A,Ve.SolveVelocityConstraints_s_P=new o.A,Ve.SolvePositionConstraints_s_d=new o.A,Ve.SolvePositionConstraints_s_P=new o.A;class we{static Create(t,e){let i=null;switch(t.type){case Ut.e_distanceJoint:i=new se(t);break;case Ut.e_mouseJoint:i=new ue(t);break;case Ut.e_prismaticJoint:i=new fe(t);break;case Ut.e_revoluteJoint:i=new xe(t);break;case Ut.e_pulleyJoint:i=new Ae(t);break;case Ut.e_gearJoint:i=new me(t);break;case Ut.e_wheelJoint:i=new Ve(t);break;case Ut.e_weldJoint:i=new be(t);break;case Ut.e_frictionJoint:i=new ae(t);break;case Ut.e_ropeJoint:i=new Se(t);break;case Ut.e_motorJoint:i=new _e(t);break;case Ut.e_areaJoint:i=new oe(t)}return i}static Destroy(t,e){}}function ve(t,e){return Object(o.w)(t*e)}function Me(t,e){return t>e?t:e}class Pe{constructor(){this.other=null,this.contact=null,this.prev=null,this.next=null}}class Ie{constructor(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new Pe,this.m_nodeB=new Pe,this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new u.h,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new u.h}GetManifold(){return this.m_manifold}GetWorldManifold(t){const e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),s.m_radius,i.GetTransform(),n.m_radius)}IsTouching(){return this.m_touchingFlag}SetEnabled(t){this.m_enabledFlag=t}IsEnabled(){return this.m_enabledFlag}GetNext(){return this.m_next}GetFixtureA(){return this.m_fixtureA}GetChildIndexA(){return this.m_indexA}GetFixtureB(){return this.m_fixtureB}GetChildIndexB(){return this.m_indexB}Evaluate(t,e,i){}FlagForFiltering(){this.m_filterFlag=!0}SetFriction(t){this.m_friction=t}GetFriction(){return this.m_friction}ResetFriction(){this.m_friction=ve(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}SetRestitution(t){this.m_restitution=t}GetRestitution(){return this.m_restitution}ResetRestitution(){this.m_restitution=Me(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}SetTangentSpeed(t){this.m_tangentSpeed=t}GetTangentSpeed(){return this.m_tangentSpeed}Reset(t,e,i,s){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=ve(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Me(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}Update(t){const e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;let i=!1;const s=this.m_touchingFlag,n=this.m_fixtureA.IsSensor(),o=this.m_fixtureB.IsSensor(),r=n||o,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),m=a.GetTransform(),h=l.GetTransform();if(r){const t=this.m_fixtureA.GetShape(),e=this.m_fixtureB.GetShape();i=Object(u.o)(t,this.m_indexA,e,this.m_indexB,m,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,m,h),i=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;const i=e.id;for(let t=0;t<this.m_oldManifold.pointCount;++t){const s=this.m_oldManifold.points[t];if(s.id.key===i.key){e.normalImpulse=s.normalImpulse,e.tangentImpulse=s.tangentImpulse;break}}}i!==s&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.BeginContact(this),s&&!i&&t&&t.EndContact(this),!r&&i&&t&&t.PreSolve(this,this.m_oldManifold)}ComputeTOI(t,e){const i=Ie.ComputeTOI_s_input;i.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),i.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),i.sweepA.Copy(t),i.sweepB.Copy(e),i.tMax=n.v;const s=Ie.ComputeTOI_s_output;return $(s,i),s.t}}Ie.ComputeTOI_s_input=new T,Ie.ComputeTOI_s_output=new j;class Ge extends Ie{constructor(){super()}static Create(t){return new Ge}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){K(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class De extends Ie{constructor(){super()}static Create(t){return new De}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){wt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Fe extends Ie{constructor(){super()}static Create(t){return new Fe}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){st(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Re extends Ie{constructor(){super()}static Create(t){return new Re}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){Lt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Le extends Ie{constructor(){super()}static Create(t){return new Le}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){qt(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}class Te extends Ie{constructor(){super()}static Create(t){return new Te}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),o=s,r=Te.Evaluate_s_edge;o.GetChildEdge(r,this.m_indexA),Lt(t,r,e,n,i)}}Te.Evaluate_s_edge=new Et;class ke extends Ie{constructor(){super()}static Create(t){return new ke}static Destroy(t,e){}Reset(t,e,i,s){super.Reset(t,e,i,s)}Evaluate(t,e,i){const s=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape(),o=s,r=ke.Evaluate_s_edge;o.GetChildEdge(r,this.m_indexA),qt(t,r,e,n,i)}}ke.Evaluate_s_edge=new Et;class ze{constructor(){this.pool=null,this.createFcn=null,this.destroyFcn=null,this.primary=!1}}class je{constructor(t){this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}AddType(t,e,i,s){const o=Object(n.e)(256,e=>t(this.m_allocator));function r(e){return o.length>0?o.pop():t(e)}function a(t,e){o.push(t)}this.m_registers[i][s].pool=o,this.m_registers[i][s].createFcn=r,this.m_registers[i][s].destroyFcn=a,this.m_registers[i][s].primary=!0,i!==s&&(this.m_registers[s][i].pool=o,this.m_registers[s][i].createFcn=r,this.m_registers[s][i].destroyFcn=a,this.m_registers[s][i].primary=!1)}InitializeRegisters(){this.m_registers=[];for(let t=0;t<Ot.c.e_shapeTypeCount;t++){this.m_registers[t]=[];for(let e=0;e<Ot.c.e_shapeTypeCount;e++)this.m_registers[t][e]=new ze}this.AddType(Ge.Create,Ge.Destroy,Ot.c.e_circleShape,Ot.c.e_circleShape),this.AddType(Fe.Create,Fe.Destroy,Ot.c.e_polygonShape,Ot.c.e_circleShape),this.AddType(De.Create,De.Destroy,Ot.c.e_polygonShape,Ot.c.e_polygonShape),this.AddType(Re.Create,Re.Destroy,Ot.c.e_edgeShape,Ot.c.e_circleShape),this.AddType(Le.Create,Le.Destroy,Ot.c.e_edgeShape,Ot.c.e_polygonShape),this.AddType(Te.Create,Te.Destroy,Ot.c.e_chainShape,Ot.c.e_circleShape),this.AddType(ke.Create,ke.Destroy,Ot.c.e_chainShape,Ot.c.e_polygonShape)}Create(t,e,i,s){const n=t.GetType(),o=i.GetType(),r=this.m_registers[n][o];if(r.createFcn){const n=r.createFcn(this.m_allocator);return r.primary?n.Reset(t,e,i,s):n.Reset(i,s,t,e),n}return null}Destroy(t){const e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));const s=e.GetType(),n=i.GetType();this.m_registers[s][n].destroyFcn(t,this.m_allocator)}}class qe{SayGoodbyeJoint(t){}SayGoodbyeFixture(t){}SayGoodbyeParticleGroup(t){}SayGoodbyeParticle(t,e){}}class Oe{ShouldCollide(t,e){const i=t.GetBody(),s=e.GetBody();if(s.GetType()===Wt.b2_staticBody&&i.GetType()===Wt.b2_staticBody)return!1;if(!s.ShouldCollideConnected(i))return!1;const n=t.GetFilterData(),o=e.GetFilterData();return n.groupIndex===o.groupIndex&&0!==n.groupIndex?n.groupIndex>0:0!=(n.maskBits&o.categoryBits)&&0!=(n.categoryBits&o.maskBits)}ShouldCollideFixtureParticle(t,e,i){return!0}ShouldCollideParticleParticle(t,e,i){return!0}}Oe.b2_defaultFilter=new Oe;class Ne{constructor(){this.normalImpulses=Object(n.g)(n.z),this.tangentImpulses=Object(n.g)(n.z),this.count=0}}class Je{BeginContact(t){}EndContact(t){}BeginContactFixtureParticle(t,e){}EndContactFixtureParticle(t,e){}BeginContactParticleParticle(t,e){}EndContactParticleParticle(t,e){}PreSolve(t,e){}PostSolve(t,e){}}Je.b2_defaultListener=new Je;class Ee{ReportFixture(t){return!0}ReportParticle(t,e){return!1}ShouldQueryParticleSystem(t){return!0}}class Xe{ReportFixture(t,e,i,s){return s}ReportParticle(t,e,i,s,n){return 0}ShouldQueryParticleSystem(t){return!0}}class We{constructor(){this.m_broadPhase=new x,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=Oe.b2_defaultFilter,this.m_contactListener=Je.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=null,this.m_contactFactory=new je(this.m_allocator)}AddPair(t,e){let i=t.fixture,s=e.fixture,n=t.childIndex,o=e.childIndex,r=i.GetBody(),a=s.GetBody();if(r===a)return;let l=a.GetContactList();for(;l;){if(l.other===r){const t=l.contact.GetFixtureA(),e=l.contact.GetFixtureB(),r=l.contact.GetChildIndexA(),a=l.contact.GetChildIndexB();if(t===i&&e===s&&r===n&&a===o)return;if(t===s&&e===i&&r===o&&a===n)return}l=l.next}if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,s))return;const m=this.m_contactFactory.Create(i,n,s,o);null!==m&&(i=m.GetFixtureA(),s=m.GetFixtureB(),n=m.GetChildIndexA(),o=m.GetChildIndexB(),r=i.m_body,a=s.m_body,m.m_prev=null,m.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=m),this.m_contactList=m,m.m_nodeA.contact=m,m.m_nodeA.other=a,m.m_nodeA.prev=null,m.m_nodeA.next=r.m_contactList,null!==r.m_contactList&&(r.m_contactList.prev=m.m_nodeA),r.m_contactList=m.m_nodeA,m.m_nodeB.contact=m,m.m_nodeB.other=r,m.m_nodeB.prev=null,m.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=m.m_nodeB),a.m_contactList=m.m_nodeB,i.IsSensor()||s.IsSensor()||(r.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}FindNewContacts(){this.m_broadPhase.UpdatePairs(this)}Destroy(t){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=e.GetBody(),n=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===s.m_contactList&&(s.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===n.m_contactList&&(n.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}Collide(){let t=this.m_contactList;for(;t;){const e=t.GetFixtureA(),i=t.GetFixtureB(),s=t.GetChildIndexA(),n=t.GetChildIndexB(),o=e.GetBody(),r=i.GetBody();if(t.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(e,i)){const e=t;t=e.m_next,this.Destroy(e);continue}t.m_filterFlag=!1}const a=o.IsAwake()&&o.m_type!==Wt.b2_staticBody,l=r.IsAwake()&&r.m_type!==Wt.b2_staticBody;if(!a&&!l){t=t.m_next;continue}const m=e.m_proxies[s].treeNode,h=i.m_proxies[n].treeNode;if(this.m_broadPhase.TestOverlap(m,h))t.Update(this.m_contactListener),t=t.m_next;else{const e=t;t=e.m_next,this.Destroy(e)}}}}class Ue{constructor(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}Reset(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}class Ze{constructor(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}Copy(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}class He{constructor(){this.c=new o.A,this.a=0}static MakeArray(t){return Object(n.e)(t,t=>new He)}}class $e{constructor(){this.v=new o.A,this.w=0}static MakeArray(t){return Object(n.e)(t,t=>new $e)}}class Ye{constructor(){this.step=new Ze,this.positions=null,this.velocities=null}}class Qe{constructor(){this.rA=new o.A,this.rB=new o.A,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}static MakeArray(t){return Object(n.e)(t,t=>new Qe)}}class Ke{constructor(){this.points=Qe.MakeArray(n.z),this.normal=new o.A,this.tangent=new o.A,this.normalMass=new o.k,this.K=new o.k,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}static MakeArray(t){return Object(n.e)(t,t=>new Ke)}}class ti{constructor(){this.localPoints=o.A.MakeArray(n.z),this.localNormal=new o.A,this.localPoint=new o.A,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new o.A,this.localCenterB=new o.A,this.invIA=0,this.invIB=0,this.type=u.j.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}static MakeArray(t){return Object(n.e)(t,t=>new ti)}}class ei{constructor(){this.step=new Ze,this.contacts=null,this.count=0,this.positions=null,this.velocities=null,this.allocator=null}}class ii{constructor(){this.normal=new o.A,this.point=new o.A,this.separation=0}Initialize(t,e,i,s){const n=ii.Initialize_s_pointA,r=ii.Initialize_s_pointB,a=ii.Initialize_s_planePoint,l=ii.Initialize_s_clipPoint;switch(t.type){case u.j.e_circles:o.z.MulXV(e,t.localPoint,n),o.z.MulXV(i,t.localPoints[0],r),o.A.SubVV(r,n,this.normal).SelfNormalize(),o.A.MidVV(n,r,this.point),this.separation=o.A.DotVV(o.A.SubVV(r,n,o.A.s_t0),this.normal)-t.radiusA-t.radiusB;break;case u.j.e_faceA:o.t.MulRV(e.q,t.localNormal,this.normal),o.z.MulXV(e,t.localPoint,a),o.z.MulXV(i,t.localPoints[s],l),this.separation=o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l);break;case u.j.e_faceB:o.t.MulRV(i.q,t.localNormal,this.normal),o.z.MulXV(i,t.localPoint,a),o.z.MulXV(e,t.localPoints[s],l),this.separation=o.A.DotVV(o.A.SubVV(l,a,o.A.s_t0),this.normal)-t.radiusA-t.radiusB,this.point.Copy(l),this.normal.SelfNeg()}}}ii.Initialize_s_pointA=new o.A,ii.Initialize_s_pointB=new o.A,ii.Initialize_s_planePoint=new o.A,ii.Initialize_s_clipPoint=new o.A;class si{constructor(){this.m_step=new Ze,this.m_positions=null,this.m_velocities=null,this.m_allocator=null,this.m_positionConstraints=ti.MakeArray(1024),this.m_velocityConstraints=Ke.MakeArray(1024),this.m_contacts=null,this.m_count=0}Initialize(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count){const t=Object(o.m)(2*this.m_positionConstraints.length,this.m_count);for(;this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new ti}if(this.m_velocityConstraints.length<this.m_count){const t=Object(o.m)(2*this.m_velocityConstraints.length,this.m_count);for(;this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new Ke}this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(let t=0;t<this.m_count;++t){const e=this.m_contacts[t],i=e.m_fixtureA,s=e.m_fixtureB,n=i.GetShape(),o=s.GetShape(),r=n.m_radius,a=o.m_radius,l=i.GetBody(),m=s.GetBody(),h=e.GetManifold(),_=h.pointCount,c=this.m_velocityConstraints[t];c.friction=e.m_friction,c.restitution=e.m_restitution,c.tangentSpeed=e.m_tangentSpeed,c.indexA=l.m_islandIndex,c.indexB=m.m_islandIndex,c.invMassA=l.m_invMass,c.invMassB=m.m_invMass,c.invIA=l.m_invI,c.invIB=m.m_invI,c.contactIndex=t,c.pointCount=_,c.K.SetZero(),c.normalMass.SetZero();const u=this.m_positionConstraints[t];u.indexA=l.m_islandIndex,u.indexB=m.m_islandIndex,u.invMassA=l.m_invMass,u.invMassB=m.m_invMass,u.localCenterA.Copy(l.m_sweep.localCenter),u.localCenterB.Copy(m.m_sweep.localCenter),u.invIA=l.m_invI,u.invIB=m.m_invI,u.localNormal.Copy(h.localNormal),u.localPoint.Copy(h.localPoint),u.pointCount=_,u.radiusA=r,u.radiusB=a,u.type=h.type;for(let t=0;t<_;++t){const e=h.points[t],i=c.points[t];this.m_step.warmStarting?(i.normalImpulse=this.m_step.dtRatio*e.normalImpulse,i.tangentImpulse=this.m_step.dtRatio*e.tangentImpulse):(i.normalImpulse=0,i.tangentImpulse=0),i.rA.SetZero(),i.rB.SetZero(),i.normalMass=0,i.tangentMass=0,i.velocityBias=0,u.localPoints[t].Copy(e.localPoint)}}return this}InitializeVelocityConstraints(){const t=si.InitializeVelocityConstraints_s_xfA,e=si.InitializeVelocityConstraints_s_xfB,i=si.InitializeVelocityConstraints_s_worldManifold;for(let s=0;s<this.m_count;++s){const r=this.m_velocityConstraints[s],a=this.m_positionConstraints[s],l=a.radiusA,m=a.radiusB,h=this.m_contacts[r.contactIndex].GetManifold(),_=r.indexA,c=r.indexB,u=r.invMassA,d=r.invMassB,f=r.invIA,p=r.invIB,A=a.localCenterA,y=a.localCenterB,x=this.m_positions[_].c,B=this.m_positions[_].a,S=this.m_velocities[_].v,C=this.m_velocities[_].w,b=this.m_positions[c].c,g=this.m_positions[c].a,V=this.m_velocities[c].v,w=this.m_velocities[c].w;t.q.SetAngle(B),e.q.SetAngle(g),o.A.SubVV(x,o.t.MulRV(t.q,A,o.A.s_t0),t.p),o.A.SubVV(b,o.t.MulRV(e.q,y,o.A.s_t0),e.p),i.Initialize(h,t,l,e,m),r.normal.Copy(i.normal),o.A.CrossVOne(r.normal,r.tangent);const v=r.pointCount;for(let t=0;t<v;++t){const e=r.points[t];o.A.SubVV(i.points[t],x,e.rA),o.A.SubVV(i.points[t],b,e.rB);const s=o.A.CrossVV(e.rA,r.normal),a=o.A.CrossVV(e.rB,r.normal),l=u+d+f*s*s+p*a*a;e.normalMass=l>0?1/l:0;const m=r.tangent,h=o.A.CrossVV(e.rA,m),_=o.A.CrossVV(e.rB,m),c=u+d+f*h*h+p*_*_;e.tangentMass=c>0?1/c:0,e.velocityBias=0;const A=o.A.DotVV(r.normal,o.A.SubVV(o.A.AddVCrossSV(V,w,e.rB,o.A.s_t0),o.A.AddVCrossSV(S,C,e.rA,o.A.s_t1),o.A.s_t0));A<-n.T&&(e.velocityBias+=-r.restitution*A)}if(2===r.pointCount){const t=r.points[0],e=r.points[1],i=o.A.CrossVV(t.rA,r.normal),s=o.A.CrossVV(t.rB,r.normal),n=o.A.CrossVV(e.rA,r.normal),a=o.A.CrossVV(e.rB,r.normal),l=u+d+f*i*i+p*s*s,m=u+d+f*n*n+p*a*a,h=u+d+f*i*n+p*s*a;l*l<1e3*(l*m-h*h)?(r.K.ex.Set(l,h),r.K.ey.Set(h,m),r.K.GetInverse(r.normalMass)):r.pointCount=1}}}WarmStart(){const t=si.WarmStart_s_P;for(let e=0;e<this.m_count;++e){const i=this.m_velocityConstraints[e],s=i.indexA,n=i.indexB,r=i.invMassA,a=i.invIA,l=i.invMassB,m=i.invIB,h=i.pointCount,_=this.m_velocities[s].v;let c=this.m_velocities[s].w;const u=this.m_velocities[n].v;let d=this.m_velocities[n].w;const f=i.normal,p=i.tangent;for(let e=0;e<h;++e){const s=i.points[e];o.A.AddVV(o.A.MulSV(s.normalImpulse,f,o.A.s_t0),o.A.MulSV(s.tangentImpulse,p,o.A.s_t1),t),c-=a*o.A.CrossVV(s.rA,t),_.SelfMulSub(r,t),d+=m*o.A.CrossVV(s.rB,t),u.SelfMulAdd(l,t)}this.m_velocities[s].w=c,this.m_velocities[n].w=d}}SolveVelocityConstraints(){const t=si.SolveVelocityConstraints_s_dv,e=si.SolveVelocityConstraints_s_dv1,i=si.SolveVelocityConstraints_s_dv2,s=si.SolveVelocityConstraints_s_P,n=si.SolveVelocityConstraints_s_a,r=si.SolveVelocityConstraints_s_b,a=si.SolveVelocityConstraints_s_x,l=si.SolveVelocityConstraints_s_d,m=si.SolveVelocityConstraints_s_P1,h=si.SolveVelocityConstraints_s_P2,_=si.SolveVelocityConstraints_s_P1P2;for(let c=0;c<this.m_count;++c){const u=this.m_velocityConstraints[c],d=u.indexA,f=u.indexB,p=u.invMassA,A=u.invIA,y=u.invMassB,x=u.invIB,B=u.pointCount,S=this.m_velocities[d].v;let C=this.m_velocities[d].w;const b=this.m_velocities[f].v;let g=this.m_velocities[f].w;const V=u.normal,w=u.tangent,v=u.friction;for(let e=0;e<B;++e){const i=u.points[e];o.A.SubVV(o.A.AddVCrossSV(b,g,i.rB,o.A.s_t0),o.A.AddVCrossSV(S,C,i.rA,o.A.s_t1),t);const n=o.A.DotVV(t,w)-u.tangentSpeed;let r=i.tangentMass*-n;const a=v*i.normalImpulse,l=Object(o.e)(i.tangentImpulse+r,-a,a);r=l-i.tangentImpulse,i.tangentImpulse=l,o.A.MulSV(r,w,s),S.SelfMulSub(p,s),C-=A*o.A.CrossVV(i.rA,s),b.SelfMulAdd(y,s),g+=x*o.A.CrossVV(i.rB,s)}if(1===u.pointCount){const e=u.points[0];o.A.SubVV(o.A.AddVCrossSV(b,g,e.rB,o.A.s_t0),o.A.AddVCrossSV(S,C,e.rA,o.A.s_t1),t);const i=o.A.DotVV(t,V);let n=-e.normalMass*(i-e.velocityBias);const r=Object(o.m)(e.normalImpulse+n,0);n=r-e.normalImpulse,e.normalImpulse=r,o.A.MulSV(n,V,s),S.SelfMulSub(p,s),C-=A*o.A.CrossVV(e.rA,s),b.SelfMulAdd(y,s),g+=x*o.A.CrossVV(e.rB,s)}else{const t=u.points[0],s=u.points[1];n.Set(t.normalImpulse,s.normalImpulse),o.A.SubVV(o.A.AddVCrossSV(b,g,t.rB,o.A.s_t0),o.A.AddVCrossSV(S,C,t.rA,o.A.s_t1),e),o.A.SubVV(o.A.AddVCrossSV(b,g,s.rB,o.A.s_t0),o.A.AddVCrossSV(S,C,s.rA,o.A.s_t1),i);let c=o.A.DotVV(e,V),d=o.A.DotVV(i,V);for(r.x=c-t.velocityBias,r.y=d-s.velocityBias,r.SelfSub(o.k.MulMV(u.K,n,o.A.s_t0));;){if(o.k.MulMV(u.normalMass,r,a).SelfNeg(),a.x>=0&&a.y>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,V,m),o.A.MulSV(l.y,V,h),o.A.AddVV(m,h,_),S.SelfMulSub(p,_),C-=A*(o.A.CrossVV(t.rA,m)+o.A.CrossVV(s.rA,h)),b.SelfMulAdd(y,_),g+=x*(o.A.CrossVV(t.rB,m)+o.A.CrossVV(s.rB,h)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=-t.normalMass*r.x,a.y=0,c=0,d=u.K.ex.y*a.x+r.y,a.x>=0&&d>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,V,m),o.A.MulSV(l.y,V,h),o.A.AddVV(m,h,_),S.SelfMulSub(p,_),C-=A*(o.A.CrossVV(t.rA,m)+o.A.CrossVV(s.rA,h)),b.SelfMulAdd(y,_),g+=x*(o.A.CrossVV(t.rB,m)+o.A.CrossVV(s.rB,h)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=0,a.y=-s.normalMass*r.y,c=u.K.ey.x*a.y+r.x,d=0,a.y>=0&&c>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,V,m),o.A.MulSV(l.y,V,h),o.A.AddVV(m,h,_),S.SelfMulSub(p,_),C-=A*(o.A.CrossVV(t.rA,m)+o.A.CrossVV(s.rA,h)),b.SelfMulAdd(y,_),g+=x*(o.A.CrossVV(t.rB,m)+o.A.CrossVV(s.rB,h)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}if(a.x=0,a.y=0,c=r.x,d=r.y,c>=0&&d>=0){o.A.SubVV(a,n,l),o.A.MulSV(l.x,V,m),o.A.MulSV(l.y,V,h),o.A.AddVV(m,h,_),S.SelfMulSub(p,_),C-=A*(o.A.CrossVV(t.rA,m)+o.A.CrossVV(s.rA,h)),b.SelfMulAdd(y,_),g+=x*(o.A.CrossVV(t.rB,m)+o.A.CrossVV(s.rB,h)),t.normalImpulse=a.x,s.normalImpulse=a.y;break}break}}this.m_velocities[d].w=C,this.m_velocities[f].w=g}}StoreImpulses(){for(let t=0;t<this.m_count;++t){let e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold();for(let t=0;t<e.pointCount;++t)i.points[t].normalImpulse=e.points[t].normalImpulse,i.points[t].tangentImpulse=e.points[t].tangentImpulse}}SolvePositionConstraints(){const t=si.SolvePositionConstraints_s_xfA,e=si.SolvePositionConstraints_s_xfB,i=si.SolvePositionConstraints_s_psm,s=si.SolvePositionConstraints_s_rA,r=si.SolvePositionConstraints_s_rB,a=si.SolvePositionConstraints_s_P;let l=0;for(let m=0;m<this.m_count;++m){const h=this.m_positionConstraints[m],_=h.indexA,c=h.indexB,u=h.localCenterA,d=h.invMassA,f=h.invIA,p=h.localCenterB,A=h.invMassB,y=h.invIB,x=h.pointCount,B=this.m_positions[_].c;let S=this.m_positions[_].a;const C=this.m_positions[c].c;let b=this.m_positions[c].a;for(let m=0;m<x;++m){t.q.SetAngle(S),e.q.SetAngle(b),o.A.SubVV(B,o.t.MulRV(t.q,u,o.A.s_t0),t.p),o.A.SubVV(C,o.t.MulRV(e.q,p,o.A.s_t0),e.p),i.Initialize(h,t,e,m);const _=i.normal,c=i.point,x=i.separation;o.A.SubVV(c,B,s),o.A.SubVV(c,C,r),l=Object(o.n)(l,x);const g=Object(o.e)(n.p*(x+n.v),-n.y,0),V=o.A.CrossVV(s,_),w=o.A.CrossVV(r,_),v=d+A+f*V*V+y*w*w,M=v>0?-g/v:0;o.A.MulSV(M,_,a),B.SelfMulSub(d,a),S-=f*o.A.CrossVV(s,a),C.SelfMulAdd(A,a),b+=y*o.A.CrossVV(r,a)}this.m_positions[_].a=S,this.m_positions[c].a=b}return l>-3*n.v}SolveTOIPositionConstraints(t,e){const i=si.SolveTOIPositionConstraints_s_xfA,s=si.SolveTOIPositionConstraints_s_xfB,r=si.SolveTOIPositionConstraints_s_psm,a=si.SolveTOIPositionConstraints_s_rA,l=si.SolveTOIPositionConstraints_s_rB,m=si.SolveTOIPositionConstraints_s_P;let h=0;for(let _=0;_<this.m_count;++_){const c=this.m_positionConstraints[_],u=c.indexA,d=c.indexB,f=c.localCenterA,p=c.localCenterB,A=c.pointCount;let y=0,x=0;u!==t&&u!==e||(y=c.invMassA,x=c.invIA);let B=0,S=0;d!==t&&d!==e||(B=c.invMassB,S=c.invIB);const C=this.m_positions[u].c;let b=this.m_positions[u].a;const g=this.m_positions[d].c;let V=this.m_positions[d].a;for(let t=0;t<A;++t){i.q.SetAngle(b),s.q.SetAngle(V),o.A.SubVV(C,o.t.MulRV(i.q,f,o.A.s_t0),i.p),o.A.SubVV(g,o.t.MulRV(s.q,p,o.A.s_t0),s.p),r.Initialize(c,i,s,t);const e=r.normal,_=r.point,u=r.separation;o.A.SubVV(_,C,a),o.A.SubVV(_,g,l),h=Object(o.n)(h,u);const d=Object(o.e)(n.S*(u+n.v),-n.y,0),A=o.A.CrossVV(a,e),w=o.A.CrossVV(l,e),v=y+B+x*A*A+S*w*w,M=v>0?-d/v:0;o.A.MulSV(M,e,m),C.SelfMulSub(y,m),b-=x*o.A.CrossVV(a,m),g.SelfMulAdd(B,m),V+=S*o.A.CrossVV(l,m)}this.m_positions[u].a=b,this.m_positions[d].a=V}return h>=-1.5*n.v}}si.InitializeVelocityConstraints_s_xfA=new o.z,si.InitializeVelocityConstraints_s_xfB=new o.z,si.InitializeVelocityConstraints_s_worldManifold=new u.p,si.WarmStart_s_P=new o.A,si.SolveVelocityConstraints_s_dv=new o.A,si.SolveVelocityConstraints_s_dv1=new o.A,si.SolveVelocityConstraints_s_dv2=new o.A,si.SolveVelocityConstraints_s_P=new o.A,si.SolveVelocityConstraints_s_a=new o.A,si.SolveVelocityConstraints_s_b=new o.A,si.SolveVelocityConstraints_s_x=new o.A,si.SolveVelocityConstraints_s_d=new o.A,si.SolveVelocityConstraints_s_P1=new o.A,si.SolveVelocityConstraints_s_P2=new o.A,si.SolveVelocityConstraints_s_P1P2=new o.A,si.SolvePositionConstraints_s_xfA=new o.z,si.SolvePositionConstraints_s_xfB=new o.z,si.SolvePositionConstraints_s_psm=new ii,si.SolvePositionConstraints_s_rA=new o.A,si.SolvePositionConstraints_s_rB=new o.A,si.SolvePositionConstraints_s_P=new o.A,si.SolveTOIPositionConstraints_s_xfA=new o.z,si.SolveTOIPositionConstraints_s_xfB=new o.z,si.SolveTOIPositionConstraints_s_psm=new ii,si.SolveTOIPositionConstraints_s_rA=new o.A,si.SolveTOIPositionConstraints_s_rB=new o.A,si.SolveTOIPositionConstraints_s_P=new o.A;class ni{constructor(){this.m_allocator=null,this.m_listener=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=He.MakeArray(1024),this.m_velocities=$e.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}Initialize(t,e,i,s,n){for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=s,this.m_listener=n;this.m_bodies.length<t;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<e;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<i;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<t){const e=Object(o.m)(2*this.m_positions.length,t);for(;this.m_positions.length<e;)this.m_positions[this.m_positions.length]=new He}if(this.m_velocities.length<t){const e=Object(o.m)(2*this.m_velocities.length,t);for(;this.m_velocities.length<e;)this.m_velocities[this.m_velocities.length]=new $e}}Clear(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}AddBody(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}AddContact(t){this.m_contacts[this.m_contactCount++]=t}AddJoint(t){this.m_joints[this.m_jointCount++]=t}Solve(t,e,i,s){const r=ni.s_timer.Reset(),a=e.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c);const s=e.m_sweep.a,n=this.m_velocities[t].v.Copy(e.m_linearVelocity);let o=e.m_angularVelocity;e.m_sweep.c0.Copy(e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.m_type===Wt.b2_dynamicBody&&(n.x+=a*(e.m_gravityScale*i.x+e.m_invMass*e.m_force.x),n.y+=a*(e.m_gravityScale*i.y+e.m_invMass*e.m_force.y),o+=a*e.m_invI*e.m_torque,n.SelfMul(1/(1+a*e.m_linearDamping)),o*=1/(1+a*e.m_angularDamping)),this.m_positions[t].a=s,this.m_velocities[t].w=o}r.Reset();const l=ni.s_solverData;l.step.Copy(e),l.positions=this.m_positions,l.velocities=this.m_velocities;const m=ni.s_contactSolverDef;m.step.Copy(e),m.contacts=this.m_contacts,m.count=this.m_contactCount,m.positions=this.m_positions,m.velocities=this.m_velocities,m.allocator=this.m_allocator;const h=ni.s_contactSolver.Initialize(m);h.InitializeVelocityConstraints(),e.warmStarting&&h.WarmStart();for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(l);t.solveInit=r.GetMilliseconds(),r.Reset();for(let t=0;t<e.velocityIterations;++t){for(let t=0;t<this.m_jointCount;++t)this.m_joints[t].SolveVelocityConstraints(l);h.SolveVelocityConstraints()}h.StoreImpulses(),t.solveVelocity=r.GetMilliseconds();for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const s=this.m_velocities[t].v;let r=this.m_velocities[t].w;const l=o.A.MulSV(a,s,ni.s_translation);if(o.A.DotVV(l,l)>n.J){const t=n.I/l.Length();s.SelfMul(t)}const m=a*r;if(m*m>n.F){r*=n.E/Object(o.a)(m)}e.x+=a*s.x,e.y+=a*s.y,i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r}r.Reset();let _=!1;for(let t=0;t<e.positionIterations;++t){const t=h.SolvePositionConstraints();let e=!0;for(let t=0;t<this.m_jointCount;++t){const i=this.m_joints[t].SolvePositionConstraints(l);e=e&&i}if(t&&e){_=!0;break}}for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];e.m_sweep.c.Copy(this.m_positions[t].c),e.m_sweep.a=this.m_positions[t].a,e.m_linearVelocity.Copy(this.m_velocities[t].v),e.m_angularVelocity=this.m_velocities[t].w,e.SynchronizeTransform()}if(t.solvePosition=r.GetMilliseconds(),this.Report(h.m_velocityConstraints),s){let t=n.x;const e=n.u*n.u,i=n.m*n.m;for(let s=0;s<this.m_bodyCount;++s){const n=this.m_bodies[s];n.GetType()!==Wt.b2_staticBody&&(!n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>i||o.A.DotVV(n.m_linearVelocity,n.m_linearVelocity)>e?(n.m_sleepTime=0,t=0):(n.m_sleepTime+=a,t=Object(o.n)(t,n.m_sleepTime)))}if(t>=n.R&&_)for(let t=0;t<this.m_bodyCount;++t){this.m_bodies[t].SetAwake(!1)}}}SolveTOI(t,e,i){for(let t=0;t<this.m_bodyCount;++t){const e=this.m_bodies[t];this.m_positions[t].c.Copy(e.m_sweep.c),this.m_positions[t].a=e.m_sweep.a,this.m_velocities[t].v.Copy(e.m_linearVelocity),this.m_velocities[t].w=e.m_angularVelocity}const s=ni.s_contactSolverDef;s.contacts=this.m_contacts,s.count=this.m_contactCount,s.allocator=this.m_allocator,s.step.Copy(t),s.positions=this.m_positions,s.velocities=this.m_velocities;const r=ni.s_contactSolver.Initialize(s);for(let s=0;s<t.positionIterations;++s){if(r.SolveTOIPositionConstraints(e,i))break}this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,r.InitializeVelocityConstraints();for(let e=0;e<t.velocityIterations;++e)r.SolveVelocityConstraints();const a=t.dt;for(let t=0;t<this.m_bodyCount;++t){const e=this.m_positions[t].c;let i=this.m_positions[t].a;const s=this.m_velocities[t].v;let r=this.m_velocities[t].w;const l=o.A.MulSV(a,s,ni.s_translation);if(o.A.DotVV(l,l)>n.J){const t=n.I/l.Length();s.SelfMul(t)}const m=a*r;if(m*m>n.F){r*=n.E/Object(o.a)(m)}e.SelfMulAdd(a,s),i+=a*r,this.m_positions[t].a=i,this.m_velocities[t].w=r;const h=this.m_bodies[t];h.m_sweep.c.Copy(e),h.m_sweep.a=i,h.m_linearVelocity.Copy(s),h.m_angularVelocity=r,h.SynchronizeTransform()}this.Report(r.m_velocityConstraints)}Report(t){if(null!==this.m_listener)for(let e=0;e<this.m_contactCount;++e){const i=this.m_contacts[e];if(!i)continue;const s=t[e],n=ni.s_impulse;n.count=s.pointCount;for(let t=0;t<s.pointCount;++t)n.normalImpulses[t]=s.points[t].normalImpulse,n.tangentImpulses[t]=s.points[t].tangentImpulse;this.m_listener.PostSolve(i,n)}}}var oi,ri;ni.s_timer=new l,ni.s_solverData=new Ye,ni.s_contactSolverDef=new ei,ni.s_contactSolver=new si,ni.s_translation=new o.A,ni.s_impulse=new Ne,function(t){t[t.b2_waterParticle=0]="b2_waterParticle",t[t.b2_zombieParticle=2]="b2_zombieParticle",t[t.b2_wallParticle=4]="b2_wallParticle",t[t.b2_springParticle=8]="b2_springParticle",t[t.b2_elasticParticle=16]="b2_elasticParticle",t[t.b2_viscousParticle=32]="b2_viscousParticle",t[t.b2_powderParticle=64]="b2_powderParticle",t[t.b2_tensileParticle=128]="b2_tensileParticle",t[t.b2_colorMixingParticle=256]="b2_colorMixingParticle",t[t.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",t[t.b2_barrierParticle=1024]="b2_barrierParticle",t[t.b2_staticPressureParticle=2048]="b2_staticPressureParticle",t[t.b2_reactiveParticle=4096]="b2_reactiveParticle",t[t.b2_repulsiveParticle=8192]="b2_repulsiveParticle",t[t.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",t[t.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",t[t.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",t[t.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle"}(oi||(oi={}));class ai{constructor(){this.flags=0,this.position=new o.A,this.velocity=new o.A,this.color=new r,this.lifetime=0,this.userData=null,this.group=null}}function li(t,e,i){const s=Math.ceil(Math.sqrt(t/(.01*e))*i);return Object(o.e)(s,1,8)}class mi{constructor(){this.m_index=n.t}GetIndex(){return this.m_index}SetIndex(t){this.m_index=t}}!function(t){t[t.b2_solidParticleGroup=1]="b2_solidParticleGroup",t[t.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",t[t.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",t[t.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",t[t.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",t[t.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask"}(ri||(ri={}));class hi{constructor(){this.flags=0,this.groupFlags=0,this.position=new o.A,this.angle=0,this.linearVelocity=new o.A,this.angularVelocity=0,this.color=new r,this.strength=1,this.shape=null,this.shapes=null,this.shapeCount=0,this.stride=0,this.particleCount=0,this.positionData=null,this.lifetime=0,this.userData=null,this.group=null}}class _i{constructor(t){this.m_system=null,this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new o.A,this.m_linearVelocity=new o.A,this.m_angularVelocity=0,this.m_transform=new o.z,this.m_userData=null,this.m_system=t}GetNext(){return this.m_next}GetParticleSystem(){return this.m_system}GetParticleCount(){return this.m_lastIndex-this.m_firstIndex}GetBufferIndex(){return this.m_firstIndex}ContainsParticle(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}GetAllParticleFlags(){let t=0;for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}GetGroupFlags(){return this.m_groupFlags}SetGroupFlags(t){t|=this.m_groupFlags&ri.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,t)}GetMass(){return this.UpdateStatistics(),this.m_mass}GetInertia(){return this.UpdateStatistics(),this.m_inertia}GetCenter(){return this.UpdateStatistics(),this.m_center}GetLinearVelocity(){return this.UpdateStatistics(),this.m_linearVelocity}GetAngularVelocity(){return this.UpdateStatistics(),this.m_angularVelocity}GetTransform(){return this.m_transform}GetPosition(){return this.m_transform.p}GetAngle(){return this.m_transform.q.GetAngle()}GetLinearVelocityFromWorldPoint(t,e){const i=_i.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),o.A.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,o.A.SubVV(t,this.m_center,i),e)}GetUserData(){return this.m_userData}SetUserData(t){this.m_userData=t}ApplyForce(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}ApplyLinearImpulse(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}DestroyParticles(t){if(!this.m_system.m_world.IsLocked())for(let e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}UpdateStatistics(){const t=new o.A,e=new o.A;if(this.m_timestamp!==this.m_system.m_timestamp){const i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(let t=this.m_firstIndex;t<this.m_lastIndex;t++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[t]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[t]);if(this.m_mass>0){const t=1/this.m_mass;this.m_center.SelfMul(t),this.m_linearVelocity.SelfMul(t)}this.m_inertia=0,this.m_angularVelocity=0;for(let s=this.m_firstIndex;s<this.m_lastIndex;s++)o.A.SubVV(this.m_system.m_positionBuffer.data[s],this.m_center,t),o.A.SubVV(this.m_system.m_velocityBuffer.data[s],this.m_linearVelocity,e),this.m_inertia+=i*o.A.DotVV(t,t),this.m_angularVelocity+=i*o.A.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}_i.GetLinearVelocityFromWorldPoint_s_t0=new o.A;class ci{constructor(t){this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=Object(n.e)(t,t=>null),this.m_capacity=t}Push(t){if(this.m_back>=this.m_capacity){for(let t=this.m_front;t<this.m_back;t++)this.m_buffer[t-this.m_front]=this.m_buffer[t];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(Object(n.e)(this.m_capacity,t=>null)),this.m_capacity*=2):(this.m_buffer.concat(Object(n.e)(1,t=>null)),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}Pop(){this.m_front,this.m_back,delete this.m_buffer[this.m_front],this.m_front++}Empty(){return this.m_front,this.m_back,this.m_front===this.m_back}Front(){return this.m_buffer[this.m_front]}}class ui{constructor(t){this.m_generatorBuffer=null,this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=null,this.m_generatorBuffer=Object(n.e)(t,t=>new ui.Generator),this.m_generatorCapacity=t}AddGenerator(t,e,i){this.m_generatorCount,this.m_generatorCapacity;let s=this.m_generatorBuffer[this.m_generatorCount++];s.center.Copy(t),s.tag=e,s.necessary=i}Generate(t,e){this.m_diagram;let i=1/t,s=new o.A(+n.x,+n.x),r=new o.A(-n.x,-n.x),a=0;for(let t=0;t<this.m_generatorCount;t++){let e=this.m_generatorBuffer[t];e.necessary&&(o.A.MinV(s,e.center,s),o.A.MaxV(r,e.center,r),++a)}if(0===a)return this.m_countX=0,void(this.m_countY=0);s.x-=e,s.y-=e,r.x+=e,r.y+=e,this.m_countX=1+Math.floor(i*(r.x-s.x)),this.m_countY=1+Math.floor(i*(r.y-s.y)),this.m_diagram=Object(n.e)(this.m_countX*this.m_countY,t=>null);let l=new ci(4*this.m_countX*this.m_countY);for(let t=0;t<this.m_generatorCount;t++){let e=this.m_generatorBuffer[t];e.center.SelfSub(s).SelfMul(i);let n=Math.floor(e.center.x),o=Math.floor(e.center.y);n>=0&&o>=0&&n<this.m_countX&&o<this.m_countY&&l.Push(new ui.Task(n,o,n+o*this.m_countX,e))}for(;!l.Empty();){let t=l.Front(),e=t.m_x,i=t.m_y,s=t.m_i,n=t.m_generator;l.Pop(),this.m_diagram[s]||(this.m_diagram[s]=n,e>0&&l.Push(new ui.Task(e-1,i,s-1,n)),i>0&&l.Push(new ui.Task(e,i-1,s-this.m_countX,n)),e<this.m_countX-1&&l.Push(new ui.Task(e+1,i,s+1,n)),i<this.m_countY-1&&l.Push(new ui.Task(e,i+1,s+this.m_countX,n)))}for(let t=0;t<this.m_countY;t++)for(let e=0;e<this.m_countX-1;e++){let i=e+t*this.m_countX,s=this.m_diagram[i],n=this.m_diagram[i+1];s!==n&&(l.Push(new ui.Task(e,t,i,n)),l.Push(new ui.Task(e+1,t,i+1,s)))}for(let t=0;t<this.m_countY-1;t++)for(let e=0;e<this.m_countX;e++){let i=e+t*this.m_countX,s=this.m_diagram[i],n=this.m_diagram[i+this.m_countX];s!==n&&(l.Push(new ui.Task(e,t,i,n)),l.Push(new ui.Task(e,t+1,i+this.m_countX,s)))}for(;!l.Empty();){let t=l.Front(),e=t.m_x,i=t.m_y,s=t.m_i,n=t.m_generator;l.Pop();let o=this.m_diagram[s],r=n;if(o!==r){let t=o.center.x-e,n=o.center.y-i,a=r.center.x-e,m=r.center.y-i;t*t+n*n>a*a+m*m&&(this.m_diagram[s]=r,e>0&&l.Push(new ui.Task(e-1,i,s-1,r)),i>0&&l.Push(new ui.Task(e,i-1,s-this.m_countX,r)),e<this.m_countX-1&&l.Push(new ui.Task(e+1,i,s+1,r)),i<this.m_countY-1&&l.Push(new ui.Task(e,i+1,s+this.m_countX,r)))}}}GetNodes(t){for(let e=0;e<this.m_countY-1;e++)for(let i=0;i<this.m_countX-1;i++){let s=i+e*this.m_countX,n=this.m_diagram[s],o=this.m_diagram[s+1],r=this.m_diagram[s+this.m_countX],a=this.m_diagram[s+1+this.m_countX];o!==r&&(n!==o&&n!==r&&(n.necessary||o.necessary||r.necessary)&&t(n.tag,o.tag,r.tag),a!==o&&a!==r&&(n.necessary||o.necessary||r.necessary)&&t(o.tag,a.tag,r.tag))}}}function di(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function fi(t,e){return t<e}function pi(t,e=0,i=t.length-e,s=fi){let n=e,o=[],r=0;for(;;){for(;n+1<i;i++){let e=t[n+Math.floor(Math.random()*(i-n))];o[r++]=i;for(let o=n-1;;){for(;s(t[++o],e););for(;s(e,t[--i]););if(o>=i)break;di(t,o,i)}}if(0===r)break;n=i,i=o[--r]}return t}function Ai(t,e=0,i=t.length-e,s=fi){return pi(t,e,i,s)}function yi(t,e,i=t.length){let s=0;for(let n=0;n<i;++n)e(t[n])||(n!==s?di(t,s++,n):++s);return s}function xi(t,e,i,s,n=fi){let o=i-e;for(;o>0;){let i=Math.floor(o/2),r=e+i;n(t[r],s)?(e=++r,o-=i+1):o=i}return e}function Bi(t,e,i,s,n=fi){let o=i-e;for(;o>0;){let i=Math.floor(o/2),r=e+i;n(s,t[r])?o=i:(e=++r,o-=i+1)}return e}function Si(t,e,i,s){let n=i;for(;e!==n;)di(t,e++,n++),n===s?n=i:e===i&&(i=n)}!function(t){t.Generator=class{constructor(){this.center=new o.A,this.tag=0,this.necessary=!1}};t.Task=class{constructor(t,e,i,s){this.m_x=0,this.m_y=0,this.m_i=0,this.m_generator=null,this.m_x=t,this.m_y=e,this.m_i=i,this.m_generator=s}}}(ui||(ui={}));class Ci{constructor(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}Append(){return this.count>=this.capacity&&this.Grow(),this.count++}Reserve(t){if(!(this.capacity>=t)){this.capacity,this.data.length;for(let e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}Grow(){let t=this.capacity?2*this.capacity:n.M;this.capacity,this.Reserve(t)}Free(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}Shorten(t){}Data(){return this.data}GetCount(){return this.count}SetCount(t){this.count=t}GetCapacity(){return this.capacity}RemoveIf(t){for(let e=0;e<this.count;++e)t(this.data[e])||0;this.count=yi(this.data,t,this.count),this.count}Unique(t){this.count=function(t,e,i,s){if(e===i)return i;let n=e;for(;++e!==i;)s(t[n],t[e])||di(t,++n,e);return++n}(this.data,0,this.count,t)}}class bi extends Ee{constructor(t){super(),this.m_system=t}ShouldQueryParticleSystem(t){return!1}ReportFixture(t){if(t.IsSensor())return!0;const e=t.GetShape().GetChildCount();for(let i=0;i<e;i++){const e=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(e);let n;for(;(n=s.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,n)}return!0}ReportParticle(t,e){return!1}ReportFixtureAndParticle(t,e,i){}}class gi{constructor(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new o.A,this.flags=0}SetIndices(t,e){t<=n.B&&n.B,this.indexA=t,this.indexB=e}SetWeight(t){this.weight=t}SetNormal(t){this.normal.Copy(t)}SetFlags(t){this.flags=t}GetIndexA(){return this.indexA}GetIndexB(){return this.indexB}GetWeight(){return this.weight}GetNormal(){return this.normal}GetFlags(){return this.flags}IsEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}IsNotEqual(t){return!this.IsEqual(t)}ApproximatelyEqual(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&Object(o.a)(this.weight-t.weight)<.01&&o.A.DistanceSquaredVV(this.normal,t.normal)<1e-4}}class Vi{constructor(){this.index=0,this.body=null,this.fixture=null,this.weight=0,this.normal=new o.A,this.mass=0}}class wi{constructor(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0}}class vi{constructor(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new o.A(0,0),this.pb=new o.A(0,0),this.pc=new o.A(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0}}class Mi{constructor(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}Copy(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}Clone(){return(new Mi).Copy(this)}}class Pi{constructor(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new Pi.UserOverridableBuffer,this.m_flagsBuffer=new Pi.UserOverridableBuffer,this.m_positionBuffer=new Pi.UserOverridableBuffer,this.m_velocityBuffer=new Pi.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new Pi.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new Pi.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new Pi.UserOverridableBuffer,this.m_bodyContactCountBuffer=new Pi.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new Pi.UserOverridableBuffer,this.m_stuckParticleBuffer=new Ci(()=>0),this.m_proxyBuffer=new Ci(()=>new Pi.Proxy),this.m_contactBuffer=new Ci(()=>new gi),this.m_bodyContactBuffer=new Ci(()=>new Vi),this.m_pairBuffer=new Ci(()=>new wi),this.m_triadBuffer=new Ci(()=>new vi),this.m_expirationTimeBuffer=new Pi.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new Pi.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Mi,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),t.lifetimeGranularity,this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}static computeTag(t,e){return(e+Pi.yOffset>>>0<<Pi.yShift)+(Pi.xScale*t+Pi.xOffset>>>0)>>>0}static computeRelativeTag(t,e,i){return t+(i<<Pi.yShift)+(e<<Pi.xShift)>>>0}Drop(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}CreateParticle(t){if(this.m_world.IsLocked(),this.m_world.IsLocked())return 0;if(this.m_count>=this.m_internalAllocatedCapacity){let t=this.m_count?2*this.m_count:n.M;this.ReallocateInternalAllocatedBuffers(t)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return n.t;this.DestroyOldestParticle(0,!1),this.SolveZombie()}let e=this.m_count++;this.m_flagsBuffer.data[e]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=0),this.m_positionBuffer.data[e]=(this.m_positionBuffer.data[e]||new o.A).Copy(t.position),this.m_velocityBuffer.data[e]=(this.m_velocityBuffer.data[e]||new o.A).Copy(t.velocity),this.m_weightBuffer[e]=0,this.m_forceBuffer[e]=(this.m_forceBuffer[e]||new o.A).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=0),this.m_depthBuffer&&(this.m_depthBuffer[e]=0),!this.m_colorBuffer.data&&t.color.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[e]=(this.m_colorBuffer.data[e]||new r).Copy(t.color)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[e]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[e]=null);let i=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],s=t.lifetime>0;(this.m_expirationTimeBuffer.data||s)&&(this.SetParticleLifetime(e,s?t.lifetime:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[e]=e),i.index=e;let a=t.group;return this.m_groupBuffer[e]=a,a&&(a.m_firstIndex<a.m_lastIndex?(this.RotateBuffer(a.m_firstIndex,a.m_lastIndex,e),a.m_lastIndex,a.m_lastIndex=e+1):(a.m_firstIndex=e,a.m_lastIndex=e+1)),this.SetParticleFlags(e,t.flags),e}GetParticleHandleFromIndex(t){t>=0&&t<this.GetParticleCount()&&n.t,this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);let e=this.m_handleIndexBuffer.data[t];return e||((e=new mi).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}DestroyParticle(t,e=!1){let i=oi.b2_zombieParticle;e&&(i|=oi.b2_destructionListenerParticle),this.SetParticleFlags(t,this.m_flagsBuffer.data[t]|i)}DestroyOldestParticle(t,e=!1){const i=this.GetParticleCount();this.m_indexByExpirationTimeBuffer.data;const s=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],n=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[s]>0?s:n,e)}DestroyParticlesInShape(t,e,i=!1){const s=Pi.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked(),this.m_world.IsLocked())return 0;const n=new Pi.DestroyParticlesInShapeCallback(this,t,e,i),o=s;return t.ComputeAABB(o,e,0),this.m_world.QueryAABB(n,o),n.Destroyed()}CreateParticleGroup(t){let e=Pi.CreateParticleGroup_s_transform;if(this.m_world.IsLocked(),this.m_world.IsLocked())return null;let i=e;i.SetPositionAngle(t.position,t.angle);let s=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,i),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,t.shapeCount,t,i),t.particleCount){t.positionData;for(let e=0;e<t.particleCount;e++){let s=t.positionData[e];this.CreateParticleForGroup(t,i,s)}}let n=this.m_count,o=new _i(this);o.m_firstIndex=s,o.m_lastIndex=n,o.m_strength=t.strength,o.m_userData=t.userData,o.m_transform.Copy(i),o.m_prev=null,o.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=o),this.m_groupList=o,++this.m_groupCount;for(let t=s;t<n;t++)this.m_groupBuffer[t]=o;this.SetGroupFlags(o,t.groupFlags);let r=new Pi.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(s,n,r),t.group&&(this.JoinParticleGroups(t.group,o),o=t.group),o}JoinParticleGroups(t,e){if(this.m_world.IsLocked(),this.m_world.IsLocked())return;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),e.m_lastIndex,this.m_count,this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex),t.m_lastIndex,e.m_firstIndex;let i=new Pi.JoinParticleGroupsFilter(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,i);for(let i=e.m_firstIndex;i<e.m_lastIndex;i++)this.m_groupBuffer[i]=t;let s=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,s),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)}SplitParticleGroup(t){this.UpdateContacts(!0);let e=t.GetParticleCount(),i=Object(n.e)(e,t=>new Pi.ParticleListNode);Pi.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);let s=Pi.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,s),this.CreateParticleGroupsFromParticleList(t,i,s),this.UpdatePairsAndTriadsWithParticleList(t,i)}GetParticleGroupList(){return this.m_groupList}GetParticleGroupCount(){return this.m_groupCount}GetParticleCount(){return this.m_count}GetMaxParticleCount(){return this.m_def.maxCount}SetMaxParticleCount(t){this.m_count,this.m_def.maxCount=t}GetAllParticleFlags(){return this.m_allParticleFlags}GetAllGroupFlags(){return this.m_allGroupFlags}SetPaused(t){this.m_paused=t}GetPaused(){return this.m_paused}SetDensity(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}GetDensity(){return this.m_def.density}SetGravityScale(t){this.m_def.gravityScale=t}GetGravityScale(){return this.m_def.gravityScale}SetDamping(t){this.m_def.dampingStrength=t}GetDamping(){return this.m_def.dampingStrength}SetStaticPressureIterations(t){this.m_def.staticPressureIterations=t}GetStaticPressureIterations(){return this.m_def.staticPressureIterations}SetRadius(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}GetRadius(){return this.m_particleDiameter/2}GetPositionBuffer(){return this.m_positionBuffer.data}GetVelocityBuffer(){return this.m_velocityBuffer.data}GetColorBuffer(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}GetGroupBuffer(){return this.m_groupBuffer}GetWeightBuffer(){return this.m_weightBuffer}GetUserDataBuffer(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}GetFlagsBuffer(){return this.m_flagsBuffer.data}SetParticleFlags(t,e){this.m_flagsBuffer.data[t]&~e&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&e&&(e&oi.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),e&oi.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=e),this.m_flagsBuffer.data[t]=e}GetParticleFlags(t){return this.m_flagsBuffer.data[t]}SetFlagsBuffer(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}SetPositionBuffer(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}SetVelocityBuffer(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}SetColorBuffer(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}SetUserDataBuffer(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}GetContacts(){return this.m_contactBuffer.data}GetContactCount(){return this.m_contactBuffer.count}GetBodyContacts(){return this.m_bodyContactBuffer.data}GetBodyContactCount(){return this.m_bodyContactBuffer.count}GetPairs(){return this.m_pairBuffer.data}GetPairCount(){return this.m_pairBuffer.count}GetTriads(){return this.m_triadBuffer.data}GetTriadCount(){return this.m_triadBuffer.count}SetStuckThreshold(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}GetStuckCandidates(){return this.m_stuckParticleBuffer.Data()}GetStuckCandidateCount(){return this.m_stuckParticleBuffer.GetCount()}ComputeCollisionEnergy(){let t=Pi.ComputeCollisionEnergy_s_v,e=this.m_velocityBuffer.data,i=0;for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],r=n.indexA,a=n.indexB,l=n.normal,m=o.A.SubVV(e[a],e[r],t),h=o.A.DotVV(m,l);h<0&&(i+=h*h)}return.5*this.GetParticleMass()*i}SetStrictContactCheck(t){this.m_def.strictContactCheck=t}GetStrictContactCheck(){return this.m_def.strictContactCheck}SetParticleLifetime(t,e){this.ValidateParticleIndex(t);let i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i){let t=this.GetParticleCount();for(let e=0;e<t;++e)this.m_indexByExpirationTimeBuffer.data[e]=e}let s=e/this.m_def.lifetimeGranularity,n=s>0?this.GetQuantizedTimeElapsed()+s:s;n!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=n,this.m_expirationTimeBufferRequiresSorting=!0)}GetParticleLifetime(t){return this.ValidateParticleIndex(t),this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}SetDestructionByAge(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}GetDestructionByAge(){return this.m_def.destroyByAge}GetExpirationTimeBuffer(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}ExpirationTimeToLifetime(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}GetIndexByExpirationTimeBuffer(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data}ParticleApplyLinearImpulse(t,e){this.ApplyLinearImpulse(t,t+1,e)}ApplyLinearImpulse(t,e,i){let s=this.m_velocityBuffer.data,n=(e-t)*this.GetParticleMass(),o=i.Clone().SelfMul(1/n);for(let i=t;i<e;i++)s[i].SelfAdd(o)}static IsSignificantForce(t){return 0!==t.x||0!==t.y}ParticleApplyForce(t,e){Pi.IsSignificantForce(e)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(e))}ApplyForce(t,e,i){let s=i.Clone().SelfMul(1/(e-t));if(Pi.IsSignificantForce(s)){this.PrepareForceBuffer();for(let i=t;i<e;i++)this.m_forceBuffer[i].SelfAdd(s)}}GetNext(){return this.m_next}QueryAABB(t,e){if(0===this.m_proxyBuffer.count)return;let i=this.m_proxyBuffer.count,s=xi(this.m_proxyBuffer.data,0,i,Pi.computeTag(this.m_inverseDiameter*e.lowerBound.x,this.m_inverseDiameter*e.lowerBound.y),Pi.Proxy.CompareProxyTag),n=Bi(this.m_proxyBuffer.data,s,i,Pi.computeTag(this.m_inverseDiameter*e.upperBound.x,this.m_inverseDiameter*e.upperBound.y),Pi.Proxy.CompareTagProxy),o=this.m_positionBuffer.data;for(let i=s;i<n;++i){let s=this.m_proxyBuffer.data[i].index,n=o[s];if(e.lowerBound.x<n.x&&n.x<e.upperBound.x&&e.lowerBound.y<n.y&&n.y<e.upperBound.y&&!t.ReportParticle(this,s))break}}QueryShapeAABB(t,e,i,s=0){let n=Pi.QueryShapeAABB_s_aabb;e.ComputeAABB(n,i,s),this.QueryAABB(t,n)}QueryPointAABB(t,e,i=n.v){let s=Pi.QueryPointAABB_s_aabb;s.lowerBound.Set(e.x-i,e.y-i),s.upperBound.Set(e.x+i,e.y+i),this.QueryAABB(t,s)}RayCast(t,e,i){let s=Pi.RayCast_s_aabb,n=Pi.RayCast_s_p,r=Pi.RayCast_s_v,a=Pi.RayCast_s_n,l=Pi.RayCast_s_point;if(0===this.m_proxyBuffer.count)return;let m=this.m_positionBuffer.data,h=s;o.A.MinV(e,i,h.lowerBound),o.A.MaxV(e,i,h.upperBound);let _,c=1,u=o.A.SubVV(i,e,r),d=o.A.DotVV(u,u),f=this.GetInsideBoundsEnumerator(h);for(;(_=f.GetNext())>=0;){let i=o.A.SubVV(e,m[_],n),s=o.A.DotVV(i,u),r=s*s-d*(o.A.DotVV(i,i)-this.m_squaredDiameter);if(r>=0){let n=Object(o.w)(r),m=(-s-n)/d;if(m>c)continue;if(m<0&&((m=(-s+n)/d)<0||m>c))continue;let h=o.A.AddVMulSV(i,m,u,a);h.Normalize();let f=t.ReportParticle(this,_,o.A.AddVMulSV(e,m,u,l),h,m);if((c=Object(o.n)(c,f))<=0)break}}}ComputeAABB(t){let e=this.GetParticleCount();t.lowerBound.x=+n.x,t.lowerBound.y=+n.x,t.upperBound.x=-n.x,t.upperBound.y=-n.x;let i=this.m_positionBuffer.data;for(let s=0;s<e;s++){let e=i[s];o.A.MinV(t.lowerBound,e,t.lowerBound),o.A.MaxV(t.upperBound,e,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}FreeBuffer(t,e){null!==t&&(t.length=0)}FreeUserOverridableBuffer(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}ReallocateBuffer3(t,e,i){let s=t?t.slice():[];return s.length=i,s}ReallocateBuffer5(t,e,i,s,n){return n&&!t||e||(t=this.ReallocateBuffer3(t,i,s)),t}ReallocateBuffer4(t,e,i,s){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,s)}RequestBuffer(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(n.M),(t=[]).length=this.m_internalAllocatedCapacity),t}ReallocateHandleBuffers(t){this.m_internalAllocatedCapacity,this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}ReallocateInternalAllocatedBuffers(t){function e(t,e){return e&&t>e?e:t}if(t=e(t=e(t=e(t=e(t=e(t=e(t,this.m_def.maxCount),this.m_flagsBuffer.userSuppliedCapacity),this.m_positionBuffer.userSuppliedCapacity),this.m_velocityBuffer.userSuppliedCapacity),this.m_colorBuffer.userSuppliedCapacity),this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);let e=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,e),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,e),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,e),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}CreateParticleForGroup(t,e,i){let s=new ai;s.flags=t.flags,o.z.MulXV(e,i,s.position),o.A.AddVV(t.linearVelocity,o.A.CrossSV(t.angularVelocity,o.A.SubVV(s.position,t.position,o.A.s_t0),o.A.s_t0),s.velocity),s.color.Copy(t.color),s.lifetime=t.lifetime,s.userData=t.userData,this.CreateParticle(s)}CreateParticlesStrokeShapeForGroup(t,e,i){let s=Pi.CreateParticlesStrokeShapeForGroup_s_edge,n=Pi.CreateParticlesStrokeShapeForGroup_s_d,r=Pi.CreateParticlesStrokeShapeForGroup_s_p,a=e.stride;0===a&&(a=this.GetParticleStride());let l=0,m=t.GetChildCount();for(let h=0;h<m;h++){let m=null;t.GetType()===Ot.c.e_edgeShape?m=t:(t.GetType(),Ot.c.e_chainShape,m=s,t.GetChildEdge(m,h));let _=o.A.SubVV(m.m_vertex2,m.m_vertex1,n),c=_.Length();for(;l<c;){let t=o.A.AddVMulSV(m.m_vertex1,l/c,_,r);this.CreateParticleForGroup(e,i,t),l+=a}l-=c}}CreateParticlesFillShapeForGroup(t,e,i){let s=Pi.CreateParticlesFillShapeForGroup_s_aabb,n=Pi.CreateParticlesFillShapeForGroup_s_p,r=e.stride;0===r&&(r=this.GetParticleStride());let a=o.z.IDENTITY,l=s;t.GetChildCount(),t.ComputeAABB(l,a,0);for(let s=Math.floor(l.lowerBound.y/r)*r;s<l.upperBound.y;s+=r)for(let o=Math.floor(l.lowerBound.x/r)*r;o<l.upperBound.x;o+=r){let r=n.Set(o,s);t.TestPoint(a,r)&&this.CreateParticleForGroup(e,i,r)}}CreateParticlesWithShapeForGroup(t,e,i){switch(t.GetType()){case Ot.c.e_edgeShape:case Ot.c.e_chainShape:this.CreateParticlesStrokeShapeForGroup(t,e,i);break;case Ot.c.e_polygonShape:case Ot.c.e_circleShape:this.CreateParticlesFillShapeForGroup(t,e,i)}}CreateParticlesWithShapesForGroup(t,e,i,s){let n=new Pi.CompositeShape(t,e);this.CreateParticlesFillShapeForGroup(n,i,s)}CloneParticle(t,e){let i=new ai;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;let s=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){let e=this.m_handleIndexBuffer.data[t];e&&e.SetIndex(s),this.m_handleIndexBuffer.data[s]=e,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[s]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[s]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[s]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[s].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[s]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[s]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[s]=this.m_expirationTimeBuffer.data[t]),s}DestroyParticlesInGroup(t,e=!1){for(let i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}DestroyParticleGroup(t){this.m_groupCount,this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}static ParticleCanBeConnected(t,e){return 0!=(t&(oi.b2_wallParticle|oi.b2_springParticle|oi.b2_elasticParticle))||null!==e&&0!=(e.GetGroupFlags()&ri.b2_rigidParticleGroup)}UpdatePairsAndTriads(t,e,i){let s=Pi.UpdatePairsAndTriads_s_dab,r=Pi.UpdatePairsAndTriads_s_dbc,a=Pi.UpdatePairsAndTriads_s_dca,l=this.m_positionBuffer.data,m=0;for(let i=t;i<e;i++)m|=this.m_flagsBuffer.data[i];if(m&Pi.k_pairFlags)for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],r=n.indexA,a=n.indexB,m=this.m_flagsBuffer.data[r],h=this.m_flagsBuffer.data[a],_=this.m_groupBuffer[r],c=this.m_groupBuffer[a];if(r>=t&&r<e&&a>=t&&a<e&&!((m|h)&oi.b2_zombieParticle)&&(m|h)&Pi.k_pairFlags&&(i.IsNecessary(r)||i.IsNecessary(a))&&Pi.ParticleCanBeConnected(m,_)&&Pi.ParticleCanBeConnected(h,c)&&i.ShouldCreatePair(r,a)){let t=this.m_pairBuffer.data[this.m_pairBuffer.Append()];t.indexA=r,t.indexB=a,t.flags=n.flags,t.strength=Object(o.n)(_?_.m_strength:1,c?c.m_strength:1),t.distance=o.A.DistanceVV(l[r],l[a])}Ai(this.m_pairBuffer.data,0,this.m_pairBuffer.count,Pi.ComparePairIndices),this.m_pairBuffer.Unique(Pi.MatchPairIndices)}if(m&Pi.k_triadFlags){let m=new ui(e-t);for(let s=t;s<e;s++){let t=this.m_flagsBuffer.data[s],e=this.m_groupBuffer[s];t&oi.b2_zombieParticle||!Pi.ParticleCanBeConnected(t,e)||m.AddGenerator(l[s],s,i.IsNecessary(s))}let h=this.GetParticleStride();m.Generate(h/2,2*h);const _=this;let c=(t,e,m)=>{let h=_.m_flagsBuffer.data[t],c=_.m_flagsBuffer.data[e],u=_.m_flagsBuffer.data[m];if((h|c|u)&Pi.k_triadFlags&&i.ShouldCreateTriad(t,e,m)){let i=l[t],d=l[e],f=l[m],p=o.A.SubVV(i,d,s),A=o.A.SubVV(d,f,r),y=o.A.SubVV(f,i,a),x=n.L*_.m_squaredDiameter;if(o.A.DotVV(p,p)>x||o.A.DotVV(A,A)>x||o.A.DotVV(y,y)>x)return;let B=_.m_groupBuffer[t],S=_.m_groupBuffer[e],C=_.m_groupBuffer[m],b=_.m_triadBuffer.data[_.m_triadBuffer.Append()];b.indexA=t,b.indexB=e,b.indexC=m,b.flags=h|c|u,b.strength=Object(o.n)(Object(o.n)(B?B.m_strength:1,S?S.m_strength:1),C?C.m_strength:1);let g=(i.x+d.x+f.x)/3,V=(i.y+d.y+f.y)/3;b.pa.x=i.x-g,b.pa.y=i.y-V,b.pb.x=d.x-g,b.pb.y=d.y-V,b.pc.x=f.x-g,b.pc.y=f.y-V,b.ka=-o.A.DotVV(y,p),b.kb=-o.A.DotVV(p,A),b.kc=-o.A.DotVV(A,y),b.s=o.A.CrossVV(i,d)+o.A.CrossVV(d,f)+o.A.CrossVV(f,i)}};m.GetNodes(c),Ai(this.m_triadBuffer.data,0,this.m_triadBuffer.count,Pi.CompareTriadIndices),this.m_triadBuffer.Unique(Pi.MatchTriadIndices)}}UpdatePairsAndTriadsWithReactiveParticles(){let t=new Pi.ReactiveFilter(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,t);for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&=~oi.b2_reactiveParticle;this.m_allParticleFlags&=~oi.b2_reactiveParticle}static ComparePairIndices(t,e){let i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}static MatchPairIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}static CompareTriadIndices(t,e){let i=t.indexA-e.indexA;if(0!==i)return i<0;let s=t.indexB-e.indexB;return 0!==s?s<0:t.indexC<e.indexC}static MatchTriadIndices(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}static InitializeParticleLists(t,e){let i=t.GetBufferIndex(),s=t.GetParticleCount();for(let t=0;t<s;t++){let s=e[t];s.list=s,s.next=null,s.count=1,s.index=t+i}}MergeParticleListsInContact(t,e){let i=t.GetBufferIndex();for(let s=0;s<this.m_contactBuffer.count;s++){let n=this.m_contactBuffer.data[s],o=n.indexA,r=n.indexB;if(!t.ContainsParticle(o)||!t.ContainsParticle(r))continue;let a=e[o-i].list,l=e[r-i].list;if(a!==l){if(a.count<l.count){let t=a;a=l,l=t}a.count,l.count,Pi.MergeParticleLists(a,l)}}}static MergeParticleLists(t,e){for(let i=e;;){i.list=t;let e=i.next;if(!e){i.next=t.next;break}i=e}t.next=e,t.count+=e.count,e.count=0}static FindLongestParticleList(t,e){let i=t.GetParticleCount(),s=e[0];for(let t=0;t<i;t++){let i=e[t];s.count<i.count&&(s=i)}return s}MergeZombieParticleListNodes(t,e,i){let s=t.GetParticleCount();for(let t=0;t<s;t++){let s=e[t];s!==i&&this.m_flagsBuffer.data[s.index]&oi.b2_zombieParticle&&Pi.MergeParticleListAndNode(i,s)}}static MergeParticleListAndNode(t,e){e.list,e.count,e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}CreateParticleGroupsFromParticleList(t,e,i){let s=t.GetParticleCount(),n=new hi;n.groupFlags=t.GetGroupFlags(),n.userData=t.GetUserData();for(let t=0;t<s;t++){let s=e[t];if(!s.count||s===i)continue;s.list;let o=this.CreateParticleGroup(n);for(let t=s;t;t=t.next){let e=t.index;this.m_flagsBuffer.data[e];oi.b2_zombieParticle;let i=this.CloneParticle(e,o);this.m_flagsBuffer.data[e]|=oi.b2_zombieParticle,t.index=i}}}UpdatePairsAndTriadsWithParticleList(t,e){let i=t.GetBufferIndex();for(let s=0;s<this.m_pairBuffer.count;s++){let n=this.m_pairBuffer.data[s],o=n.indexA,r=n.indexB;t.ContainsParticle(o)&&(n.indexA=e[o-i].index),t.ContainsParticle(r)&&(n.indexB=e[r-i].index)}for(let s=0;s<this.m_triadBuffer.count;s++){let n=this.m_triadBuffer.data[s],o=n.indexA,r=n.indexB,a=n.indexC;t.ContainsParticle(o)&&(n.indexA=e[o-i].index),t.ContainsParticle(r)&&(n.indexB=e[r-i].index),t.ContainsParticle(a)&&(n.indexC=e[a-i].index)}}ComputeDepth(){let t=[],e=0;for(let i=0;i<this.m_contactBuffer.count;i++){let s=this.m_contactBuffer.data[i],n=s.indexA,o=s.indexB,r=this.m_groupBuffer[n],a=this.m_groupBuffer[o];r&&r===a&&r.m_groupFlags&ri.b2_particleGroupNeedsUpdateDepth&&(t[e++]=s)}let i=[],s=0;for(let t=this.m_groupList;t;t=t.GetNext())if(t.m_groupFlags&ri.b2_particleGroupNeedsUpdateDepth){i[s++]=t,this.SetGroupFlags(t,t.m_groupFlags&~ri.b2_particleGroupNeedsUpdateDepth);for(let e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_accumulationBuffer[e]=0}for(let i=0;i<e;i++){let e=t[i],s=e.indexA,n=e.indexB,o=e.weight;this.m_accumulationBuffer[s]+=o,this.m_accumulationBuffer[n]+=o}this.m_depthBuffer;for(let t=0;t<s;t++){let e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++){let e=this.m_accumulationBuffer[t];this.m_depthBuffer[t]=e<.8?0:n.x}}let r=Object(o.w)(this.m_count)>>0;for(let i=0;i<r;i++){let i=!1;for(let s=0;s<e;s++){let e=t[s],n=e.indexA,o=e.indexB,r=1-e.weight,a=this.m_depthBuffer[n],l=this.m_depthBuffer[o],m=l+r,h=a+r;a>m&&(this.m_depthBuffer[n]=m,i=!0),l>h&&(this.m_depthBuffer[o]=h,i=!0)}if(!i)break}for(let t=0;t<s;t++){let e=i[t];for(let t=e.m_firstIndex;t<e.m_lastIndex;t++)this.m_depthBuffer[t]<n.x?this.m_depthBuffer[t]*=this.m_particleDiameter:this.m_depthBuffer[t]=0}}GetInsideBoundsEnumerator(t){let e=Pi.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=Pi.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),s=this.m_proxyBuffer.count,n=xi(this.m_proxyBuffer.data,0,s,e,Pi.Proxy.CompareProxyTag),o=Bi(this.m_proxyBuffer.data,0,s,i,Pi.Proxy.CompareTagProxy);return new Pi.InsideBoundsEnumerator(this,e,i,n,o)}UpdateAllParticleFlags(){this.m_allParticleFlags=0;for(let t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}UpdateAllGroupFlags(){this.m_allGroupFlags=0;for(let t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}AddContact(t,e,i){let s=Pi.AddContact_s_d,n=this.m_positionBuffer.data;this.m_contactBuffer;let r=o.A.SubVV(n[e],n[t],s),a=o.A.DotVV(r,r);if(a<this.m_squaredDiameter){let i=Object(o.h)(a);isFinite(i)||(i=198177537e11);let s=this.m_contactBuffer.data[this.m_contactBuffer.Append()];s.indexA=t,s.indexB=e,s.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[e],s.weight=1-a*i*this.m_inverseDiameter,o.A.MulSV(i,r,s.normal)}}FindContacts_Reference(t){this.m_contactBuffer;let e=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(let t=0,i=0;t<e;t++){let s=Pi.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,0);for(let i=t+1;i<e&&!(s<this.m_proxyBuffer.data[i].tag);i++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[i].index,this.m_contactBuffer);let n=Pi.computeRelativeTag(this.m_proxyBuffer.data[t].tag,-1,1);for(;i<e&&!(n<=this.m_proxyBuffer.data[i].tag);i++);let o=Pi.computeRelativeTag(this.m_proxyBuffer.data[t].tag,1,1);for(let s=i;s<e&&!(o<this.m_proxyBuffer.data[s].tag);s++)this.AddContact(this.m_proxyBuffer.data[t].index,this.m_proxyBuffer.data[s].index,this.m_contactBuffer)}}FindContacts(t){this.FindContacts_Reference(t)}UpdateProxies_Reference(t){this.m_proxyBuffer;let e=this.m_positionBuffer.data,i=this.m_inverseDiameter;for(let t=0;t<this.m_proxyBuffer.count;++t){let s=this.m_proxyBuffer.data[t],n=e[s.index];s.tag=Pi.computeTag(i*n.x,i*n.y)}}UpdateProxies(t){this.UpdateProxies_Reference(t)}SortProxies(t){this.m_proxyBuffer,pi(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,Pi.Proxy.CompareProxyProxy)}FilterContacts(t){let e=this.GetParticleContactFilter();if(null===e)return;this.m_contactBuffer;const i=this;this.m_contactBuffer.RemoveIf(t=>t.flags&oi.b2_particleContactFilterParticle&&!e.ShouldCollideParticleParticle(i,t.indexA,t.indexB))}NotifyContactListenerPreContact(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}NotifyContactListenerPostContact(t){let e=this.GetParticleContactListener();if(null!==e){for(let i=0;i<this.m_contactBuffer.count;++i){let s=this.m_contactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactParticleParticle(this,s)}throw new Error}}static b2ParticleContactIsZombie(t){return(t.flags&oi.b2_zombieParticle)===oi.b2_zombieParticle}UpdateContacts(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);let e=new Pi.b2ParticlePairSet;this.NotifyContactListenerPreContact(e),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(e),t&&this.m_contactBuffer.RemoveIf(Pi.b2ParticleContactIsZombie)}NotifyBodyContactListenerPreContact(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}NotifyBodyContactListenerPostContact(t){let e=this.GetFixtureContactListener();if(null!==e){for(let i=0;i<this.m_bodyContactBuffer.count;i++){let s=this.m_bodyContactBuffer.data[i],n=-1;n>=0?t.Invalidate(n):e.BeginContactFixtureParticle(this,s)}throw new Error}}UpdateBodyContacts(){let t=Pi.UpdateBodyContacts_s_aabb,e=new Pi.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(e),this.m_stuckThreshold>0){let t=this.GetParticleCount();for(let e=0;e<t;e++)this.m_bodyContactCountBuffer.data[e]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[e]+1&&(this.m_consecutiveContactStepsBuffer.data[e]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);let i=t;this.ComputeAABB(i);let s=new Pi.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(s,i),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(e)}Solve(t){let e=Pi.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(t),this.m_allParticleFlags&oi.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<t.particleIterations;this.m_iterationIndex++){++this.m_timestamp;let i=e.Copy(t);i.dt/=t.particleIterations,i.inv_dt*=t.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&ri.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&oi.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(i),this.m_allParticleFlags&oi.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&oi.b2_repulsiveParticle&&this.SolveRepulsive(i),this.m_allParticleFlags&oi.b2_powderParticle&&this.SolvePowder(i),this.m_allParticleFlags&oi.b2_tensileParticle&&this.SolveTensile(i),this.m_allGroupFlags&ri.b2_solidParticleGroup&&this.SolveSolid(i),this.m_allParticleFlags&oi.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(i),this.m_allParticleFlags&oi.b2_staticPressureParticle&&this.SolveStaticPressure(i),this.SolvePressure(i),this.SolveDamping(i),this.m_allParticleFlags&Pi.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&oi.b2_elasticParticle&&this.SolveElastic(i),this.m_allParticleFlags&oi.b2_springParticle&&this.SolveSpring(i),this.LimitVelocity(i),this.m_allGroupFlags&ri.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&oi.b2_barrierParticle&&this.SolveBarrier(i),this.SolveCollision(i),this.m_allGroupFlags&ri.b2_rigidParticleGroup&&this.SolveRigid(i),this.m_allParticleFlags&oi.b2_wallParticle&&this.SolveWall();for(let t=0;t<this.m_count;t++)this.m_positionBuffer.data[t].SelfMulAdd(i.dt,this.m_velocityBuffer.data[t])}}SolveCollision(t){let e=Pi.SolveCollision_s_aabb,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=e;r.lowerBound.x=+n.x,r.lowerBound.y=+n.x,r.upperBound.x=-n.x,r.upperBound.y=-n.x;for(let e=0;e<this.m_count;e++){let n=s[e],a=i[e],l=a.x+t.dt*n.x,m=a.y+t.dt*n.y;r.lowerBound.x=Object(o.n)(r.lowerBound.x,Object(o.n)(a.x,l)),r.lowerBound.y=Object(o.n)(r.lowerBound.y,Object(o.n)(a.y,m)),r.upperBound.x=Object(o.m)(r.upperBound.x,Object(o.m)(a.x,l)),r.upperBound.y=Object(o.m)(r.upperBound.y,Object(o.m)(a.y,m))}let a=new Pi.SolveCollisionCallback(this,t);this.m_world.QueryAABB(a,r)}LimitVelocity(t){let e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t);for(let t=0;t<this.m_count;t++){let s=e[t],n=o.A.DotVV(s,s);n>i&&s.SelfMul(Object(o.w)(i/n))}}SolveGravity(t){let e=Pi.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,s=o.A.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),e);for(let t=0;t<this.m_count;t++)i[t].SelfAdd(s)}SolveBarrier(t){let e=Pi.SolveBarrier_s_aabb,i=Pi.SolveBarrier_s_va,s=Pi.SolveBarrier_s_vb,r=Pi.SolveBarrier_s_pba,a=Pi.SolveBarrier_s_vba,l=Pi.SolveBarrier_s_vc,m=Pi.SolveBarrier_s_pca,h=Pi.SolveBarrier_s_vca,_=Pi.SolveBarrier_s_qba,c=Pi.SolveBarrier_s_qca,u=Pi.SolveBarrier_s_dv,d=Pi.SolveBarrier_s_f,f=this.m_positionBuffer.data,p=this.m_velocityBuffer.data;for(let t=0;t<this.m_count;t++){0!=(this.m_flagsBuffer.data[t]&Pi.k_barrierWallFlags)&&p[t].SetZero()}let A=n.o*t.dt,y=this.GetParticleMass();for(let n=0;n<this.m_pairBuffer.count;n++){let x=this.m_pairBuffer.data[n];if(x.flags&oi.b2_barrierParticle){let n=x.indexA,B=x.indexB,S=f[n],C=f[B],b=e;o.A.MinV(S,C,b.lowerBound),o.A.MaxV(S,C,b.upperBound);let g,V=this.m_groupBuffer[n],w=this.m_groupBuffer[B],v=this.GetLinearVelocity(V,n,S,i),M=this.GetLinearVelocity(w,B,C,s),P=o.A.SubVV(C,S,r),I=o.A.SubVV(M,v,a),G=this.GetInsideBoundsEnumerator(b);for(;(g=G.GetNext())>=0;){let e=f[g],i=this.m_groupBuffer[g];if(V!==i&&w!==i){let s,n,r=this.GetLinearVelocity(i,g,e,l),a=o.A.SubVV(e,S,m),f=o.A.SubVV(r,v,h),x=o.A.CrossVV(I,f),B=o.A.CrossVV(P,f)-o.A.CrossVV(a,I),C=o.A.CrossVV(P,a),b=_,V=c;if(0===x){if(0===B)continue;if(!((n=-C/B)>=0&&n<A))continue;if(o.A.AddVMulSV(P,n,I,b),o.A.AddVMulSV(a,n,f,V),!((s=o.A.DotVV(b,V)/o.A.DotVV(b,b))>=0&&s<=1))continue}else{let t=B*B-4*C*x;if(t<0)continue;let e=Object(o.w)(t),i=(-B-e)/(2*x),r=(-B+e)/(2*x);if(i>r){let t=i;i=r,r=t}if(n=i,o.A.AddVMulSV(P,n,I,b),o.A.AddVMulSV(a,n,f,V),s=o.A.DotVV(b,V)/o.A.DotVV(b,b),!(n>=0&&n<A&&s>=0&&s<=1)){if(!((n=r)>=0&&n<A))continue;if(o.A.AddVMulSV(P,n,I,b),o.A.AddVMulSV(a,n,f,V),!((s=o.A.DotVV(b,V)/o.A.DotVV(b,b))>=0&&s<=1))continue}}let w=u;w.x=v.x+s*I.x-r.x,w.y=v.y+s*I.y-r.y;let M=o.A.MulSV(y,w,d);if(this.IsRigidGroup(i)){let t=i.GetMass(),s=i.GetInertia();t>0&&i.m_linearVelocity.SelfMulAdd(1/t,M),s>0&&(i.m_angularVelocity+=o.A.CrossVV(o.A.SubVV(e,i.GetCenter(),o.A.s_t0),M)/s)}else p[g].SelfAdd(w);this.ParticleApplyForce(g,M.SelfMul(-t.inv_dt))}}}}}SolveStaticPressure(t){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);let e=this.GetCriticalPressure(t),i=this.m_def.staticPressureStrength*e,s=n.C*e,r=this.m_def.staticPressureRelaxation;for(let t=0;t<this.m_def.staticPressureIterations;t++){for(let t=0;t<this.m_count;t++)this.m_accumulationBuffer[t]=0;for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];if(e.flags&oi.b2_staticPressureParticle){let t=e.indexA,i=e.indexB,s=e.weight;this.m_accumulationBuffer[t]+=s*this.m_staticPressureBuffer[i],this.m_accumulationBuffer[i]+=s*this.m_staticPressureBuffer[t]}}for(let t=0;t<this.m_count;t++){let e=this.m_weightBuffer[t];if(this.m_flagsBuffer.data[t]&oi.b2_staticPressureParticle){let a=(this.m_accumulationBuffer[t]+i*(e-n.N))/(e+r);this.m_staticPressureBuffer[t]=Object(o.e)(a,0,s)}else this.m_staticPressureBuffer[t]=0}}}ComputeWeight(){for(let t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t],i=e.index,s=e.weight;this.m_weightBuffer[i]+=s}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t],i=e.indexA,s=e.indexB,n=e.weight;this.m_weightBuffer[i]+=n,this.m_weightBuffer[s]+=n}}SolvePressure(t){let e=Pi.SolvePressure_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.GetCriticalPressure(t),a=this.m_def.pressureStrength*r,l=n.C*r;for(let t=0;t<this.m_count;t++){let e=this.m_weightBuffer[t],i=a*Object(o.m)(0,e-n.N);this.m_accumulationBuffer[t]=Object(o.n)(i,l)}if(this.m_allParticleFlags&Pi.k_noPressureFlags)for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&Pi.k_noPressureFlags&&(this.m_accumulationBuffer[t]=0);if(this.m_allParticleFlags&oi.b2_staticPressureParticle){this.m_staticPressureBuffer;for(let t=0;t<this.m_count;t++)this.m_flagsBuffer.data[t]&oi.b2_staticPressureParticle&&(this.m_accumulationBuffer[t]+=this.m_staticPressureBuffer[t])}let m=t.dt/(this.m_def.density*this.m_particleDiameter),h=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let n=this.m_bodyContactBuffer.data[t],r=n.index,l=n.body,_=n.weight,c=n.mass,u=n.normal,d=i[r],f=this.m_accumulationBuffer[r]+a*_,p=o.A.MulSV(m*_*c*f,u,e);s[r].SelfMulSub(h,p),l.ApplyLinearImpulse(p,d,!0)}for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t],n=i.indexA,r=i.indexB,a=i.weight,l=i.normal,h=this.m_accumulationBuffer[n]+this.m_accumulationBuffer[r],_=o.A.MulSV(m*a*h,l,e);s[n].SelfSub(_),s[r].SelfAdd(_)}}SolveDamping(t){let e=Pi.SolveDamping_s_v,i=Pi.SolveDamping_s_f,s=this.m_positionBuffer.data,n=this.m_velocityBuffer.data,r=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let m=this.m_bodyContactBuffer.data[t],h=m.index,_=m.body,c=m.weight,u=m.mass,d=m.normal,f=s[h],p=o.A.SubVV(_.GetLinearVelocityFromWorldPoint(f,o.A.s_t0),n[h],e),A=o.A.DotVV(p,d);if(A<0){let t=Object(o.m)(r*c,Object(o.n)(-a*A,.5)),e=o.A.MulSV(t*u*A,d,i);n[h].SelfMulAdd(l,e),_.ApplyLinearImpulse(e.SelfNeg(),f,!0)}}for(let t=0;t<this.m_contactBuffer.count;t++){let s=this.m_contactBuffer.data[t],l=s.indexA,m=s.indexB,h=s.weight,_=s.normal,c=o.A.SubVV(n[m],n[l],e),u=o.A.DotVV(c,_);if(u<0){let t=Object(o.m)(r*h,Object(o.n)(-a*u,.5)),e=o.A.MulSV(t*u,_,i);n[l].SelfAdd(e),n[m].SelfSub(e)}}}SolveRigidDamping(){let t=Pi.SolveRigidDamping_s_t0,e=Pi.SolveRigidDamping_s_t1,i=Pi.SolveRigidDamping_s_p,s=Pi.SolveRigidDamping_s_v,n=[0],r=[0],a=[0],l=[0],m=[0],h=[0],_=this.m_positionBuffer.data,c=this.m_def.dampingStrength;for(let i=0;i<this.m_bodyContactBuffer.count;i++){let u=this.m_bodyContactBuffer.data[i],d=u.index,f=this.m_groupBuffer[d];if(this.IsRigidGroup(f)){let i=u.body,p=u.normal,A=u.weight,y=_[d],x=o.A.SubVV(i.GetLinearVelocityFromWorldPoint(y,t),f.GetLinearVelocityFromWorldPoint(y,e),s),B=o.A.DotVV(x,p);if(B<0){this.InitDampingParameterWithRigidGroupOrParticle(n,r,a,!0,f,d,y,p),this.InitDampingParameter(l,m,h,i.GetMass(),i.GetInertia()-i.GetMass()*i.GetLocalCenter().LengthSquared(),i.GetWorldCenter(),y,p);let t=c*Object(o.n)(A,1)*this.ComputeDampingImpulse(n[0],r[0],a[0],l[0],m[0],h[0],B);this.ApplyDamping(n[0],r[0],a[0],!0,f,d,t,p),i.ApplyLinearImpulse(o.A.MulSV(-t,p,o.A.s_t0),y,!0)}}}for(let u=0;u<this.m_contactBuffer.count;u++){let d=this.m_contactBuffer.data[u],f=d.indexA,p=d.indexB,A=d.normal,y=d.weight,x=this.m_groupBuffer[f],B=this.m_groupBuffer[p],S=this.IsRigidGroup(x),C=this.IsRigidGroup(B);if(x!==B&&(S||C)){let u=o.A.MidVV(_[f],_[p],i),d=o.A.SubVV(this.GetLinearVelocity(B,p,u,t),this.GetLinearVelocity(x,f,u,e),s),b=o.A.DotVV(d,A);if(b<0){this.InitDampingParameterWithRigidGroupOrParticle(n,r,a,S,x,f,u,A),this.InitDampingParameterWithRigidGroupOrParticle(l,m,h,C,B,p,u,A);let t=c*y*this.ComputeDampingImpulse(n[0],r[0],a[0],l[0],m[0],h[0],b);this.ApplyDamping(n[0],r[0],a[0],S,x,f,t,A),this.ApplyDamping(l[0],m[0],h[0],C,B,p,-t,A)}}}}SolveExtraDamping(){let t=Pi.SolveExtraDamping_s_v,e=Pi.SolveExtraDamping_s_f,i=this.m_velocityBuffer.data,s=this.m_positionBuffer.data,n=this.GetParticleInvMass();for(let r=0;r<this.m_bodyContactBuffer.count;r++){let a=this.m_bodyContactBuffer.data[r],l=a.index;if(this.m_flagsBuffer.data[l]&Pi.k_extraDampingFlags){let r=a.body,m=a.mass,h=a.normal,_=s[l],c=o.A.SubVV(r.GetLinearVelocityFromWorldPoint(_,o.A.s_t0),i[l],t),u=o.A.DotVV(c,h);if(u<0){let t=o.A.MulSV(.5*m*u,h,e);i[l].SelfMulAdd(n,t),r.ApplyLinearImpulse(t.SelfNeg(),_,!0)}}}}SolveWall(){let t=this.m_velocityBuffer.data;for(let e=0;e<this.m_count;e++)this.m_flagsBuffer.data[e]&oi.b2_wallParticle&&t[e].SetZero()}SolveRigid(t){let e=Pi.SolveRigid_s_position,i=Pi.SolveRigid_s_rotation,s=Pi.SolveRigid_s_transform,n=Pi.SolveRigid_s_velocityTransform,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data;for(let l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&ri.b2_rigidParticleGroup){l.UpdateStatistics();let m=i;m.SetAngle(t.dt*l.m_angularVelocity);let h=o.A.AddVV(l.m_center,o.A.SubVV(o.A.MulSV(t.dt,l.m_linearVelocity,o.A.s_t0),o.t.MulRV(m,l.m_center,o.A.s_t1),o.A.s_t0),e),_=s;_.SetPositionRotation(h,m),o.z.MulXX(_,l.m_transform,l.m_transform);let c=n;c.p.x=t.inv_dt*_.p.x,c.p.y=t.inv_dt*_.p.y,c.q.s=t.inv_dt*_.q.s,c.q.c=t.inv_dt*(_.q.c-1);for(let t=l.m_firstIndex;t<l.m_lastIndex;t++)o.z.MulXV(c,r[t],a[t])}}SolveElastic(t){let e=Pi.SolveElastic_s_pa,i=Pi.SolveElastic_s_pb,s=Pi.SolveElastic_s_pc,n=Pi.SolveElastic_s_r,r=Pi.SolveElastic_s_t0,a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,m=t.inv_dt*this.m_def.elasticStrength;for(let h=0;h<this.m_triadBuffer.count;h++){let _=this.m_triadBuffer.data[h];if(_.flags&oi.b2_elasticParticle){let h=_.indexA,c=_.indexB,u=_.indexC,d=_.pa,f=_.pb,p=_.pc,A=e.Copy(a[h]),y=i.Copy(a[c]),x=s.Copy(a[u]),B=l[h],S=l[c],C=l[u];A.SelfMulAdd(t.dt,B),y.SelfMulAdd(t.dt,S),x.SelfMulAdd(t.dt,C);let b=(A.x+y.x+x.x)/3,g=(A.y+y.y+x.y)/3;A.x-=b,A.y-=g,y.x-=b,y.y-=g,x.x-=b,x.y-=g;let V=n;V.s=o.A.CrossVV(d,A)+o.A.CrossVV(f,y)+o.A.CrossVV(p,x),V.c=o.A.DotVV(d,A)+o.A.DotVV(f,y)+o.A.DotVV(p,x);let w=V.s*V.s+V.c*V.c,v=Object(o.h)(w);isFinite(v)||(v=198177537e11),V.s*=v,V.c*=v;let M=m*_.strength;o.t.MulRV(V,d,r),o.A.SubVV(r,A,r),o.A.MulSV(M,r,r),B.SelfAdd(r),o.t.MulRV(V,f,r),o.A.SubVV(r,y,r),o.A.MulSV(M,r,r),S.SelfAdd(r),o.t.MulRV(V,p,r),o.A.SubVV(r,x,r),o.A.MulSV(M,r,r),C.SelfAdd(r)}}}SolveSpring(t){let e=Pi.SolveSpring_s_pa,i=Pi.SolveSpring_s_pb,s=Pi.SolveSpring_s_d,n=Pi.SolveSpring_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,l=t.inv_dt*this.m_def.springStrength;for(let m=0;m<this.m_pairBuffer.count;m++){let h=this.m_pairBuffer.data[m];if(h.flags&oi.b2_springParticle){let m=h.indexA,_=h.indexB,c=e.Copy(r[m]),u=i.Copy(r[_]),d=a[m],f=a[_];c.SelfMulAdd(t.dt,d),u.SelfMulAdd(t.dt,f);let p=o.A.SubVV(u,c,s),A=h.distance,y=p.Length(),x=l*h.strength,B=o.A.MulSV(x*(A-y)/y,p,n);d.SelfSub(B),f.SelfAdd(B)}}}SolveTensile(t){let e=Pi.SolveTensile_s_weightedNormal,i=Pi.SolveTensile_s_s,s=Pi.SolveTensile_s_f,r=this.m_velocityBuffer.data;this.m_accumulation2Buffer;for(let t=0;t<this.m_count;t++)this.m_accumulation2Buffer[t]=new o.A,this.m_accumulation2Buffer[t].SetZero();for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];if(i.flags&oi.b2_tensileParticle){let t=i.indexA,s=i.indexB,n=i.weight,r=i.normal,a=o.A.MulSV((1-n)*n,r,e);this.m_accumulation2Buffer[t].SelfSub(a),this.m_accumulation2Buffer[s].SelfAdd(a)}}let a=this.GetCriticalVelocity(t),l=this.m_def.surfaceTensionPressureStrength*a,m=this.m_def.surfaceTensionNormalStrength*a,h=n.A*a;for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];if(e.flags&oi.b2_tensileParticle){let t=e.indexA,n=e.indexB,a=e.weight,_=e.normal,c=this.m_weightBuffer[t]+this.m_weightBuffer[n],u=o.A.SubVV(this.m_accumulation2Buffer[n],this.m_accumulation2Buffer[t],i),d=Object(o.n)(l*(c-2)+m*o.A.DotVV(u,_),h)*a,f=o.A.MulSV(d,_,s);r[t].SelfSub(f),r[n].SelfAdd(f)}}}SolveViscous(){let t=Pi.SolveViscous_s_v,e=Pi.SolveViscous_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,n=this.m_def.viscousStrength,r=this.GetParticleInvMass();for(let a=0;a<this.m_bodyContactBuffer.count;a++){let l=this.m_bodyContactBuffer.data[a],m=l.index;if(this.m_flagsBuffer.data[m]&oi.b2_viscousParticle){let a=l.body,h=l.weight,_=l.mass,c=i[m],u=o.A.SubVV(a.GetLinearVelocityFromWorldPoint(c,o.A.s_t0),s[m],t),d=o.A.MulSV(n*_*h,u,e);s[m].SelfMulAdd(r,d),a.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}for(let i=0;i<this.m_contactBuffer.count;i++){let r=this.m_contactBuffer.data[i];if(r.flags&oi.b2_viscousParticle){let i=r.indexA,a=r.indexB,l=r.weight,m=o.A.SubVV(s[a],s[i],t),h=o.A.MulSV(n*l,m,e);s[i].SelfAdd(h),s[a].SelfSub(h)}}}SolveRepulsive(t){let e=Pi.SolveRepulsive_s_f,i=this.m_velocityBuffer.data,s=this.m_def.repulsiveStrength*this.GetCriticalVelocity(t);for(let t=0;t<this.m_contactBuffer.count;t++){let n=this.m_contactBuffer.data[t];if(n.flags&oi.b2_repulsiveParticle){let t=n.indexA,r=n.indexB;if(this.m_groupBuffer[t]!==this.m_groupBuffer[r]){let a=n.weight,l=n.normal,m=o.A.MulSV(s*a,l,e);i[t].SelfSub(m),i[r].SelfAdd(m)}}}}SolvePowder(t){let e=Pi.SolvePowder_s_f,i=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=this.m_def.powderStrength*this.GetCriticalVelocity(t),a=1-n.O,l=this.GetParticleInvMass();for(let t=0;t<this.m_bodyContactBuffer.count;t++){let n=this.m_bodyContactBuffer.data[t],m=n.index;if(this.m_flagsBuffer.data[m]&oi.b2_powderParticle){let t=n.weight;if(t>a){let h=n.body,_=n.mass,c=i[m],u=n.normal,d=o.A.MulSV(r*_*(t-a),u,e);s[m].SelfMulSub(l,d),h.ApplyLinearImpulse(d,c,!0)}}}for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];if(i.flags&oi.b2_powderParticle){let t=i.weight;if(t>a){let n=i.indexA,l=i.indexB,m=i.normal,h=o.A.MulSV(r*(t-a),m,e);s[n].SelfSub(h),s[l].SelfAdd(h)}}}}SolveSolid(t){let e=Pi.SolveSolid_s_f,i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);let s=t.inv_dt*this.m_def.ejectionStrength;for(let t=0;t<this.m_contactBuffer.count;t++){let n=this.m_contactBuffer.data[t],r=n.indexA,a=n.indexB;if(this.m_groupBuffer[r]!==this.m_groupBuffer[a]){let t=n.weight,l=n.normal,m=this.m_depthBuffer[r]+this.m_depthBuffer[a],h=o.A.MulSV(s*m*t,l,e);i[r].SelfSub(h),i[a].SelfAdd(h)}}}SolveForce(t){let e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass();for(let t=0;t<this.m_count;t++)e[t].SelfMulAdd(i,this.m_forceBuffer[t]);this.m_hasForce=!1}SolveColorMixing(){this.m_colorBuffer.data;const t=.5*this.m_def.colorMixingStrength;if(t)for(let e=0;e<this.m_contactBuffer.count;e++){let i=this.m_contactBuffer.data[e],s=i.indexA,n=i.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[n]&oi.b2_colorMixingParticle){let e=this.m_colorBuffer.data[s],i=this.m_colorBuffer.data[n];r.MixColors(e,i,t)}}}SolveZombie(){let t=0,e=[];for(let t=0;t<this.m_count;t++)e[t]=n.t;e.length,this.m_count;let i=0;for(let s=0;s<this.m_count;s++){let o=this.m_flagsBuffer.data[s];if(o&oi.b2_zombieParticle){let t=this.m_world.m_destructionListener;if(o&oi.b2_destructionListenerParticle&&t&&t.SayGoodbyeParticle(this,s),this.m_handleIndexBuffer.data){let t=this.m_handleIndexBuffer.data[s];t&&(t.SetIndex(n.t),this.m_handleIndexBuffer.data[s]=null)}e[s]=n.t}else{if(e[s]=t,s!==t){if(this.m_handleIndexBuffer.data){let e=this.m_handleIndexBuffer.data[s];e&&e.SetIndex(t),this.m_handleIndexBuffer.data[t]=e}this.m_flagsBuffer.data[t]=this.m_flagsBuffer.data[s],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[t]=this.m_lastBodyContactStepBuffer.data[s]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[t]=this.m_bodyContactCountBuffer.data[s]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[t]=this.m_consecutiveContactStepsBuffer.data[s]),this.m_positionBuffer.data[t].Copy(this.m_positionBuffer.data[s]),this.m_velocityBuffer.data[t].Copy(this.m_velocityBuffer.data[s]),this.m_groupBuffer[t]=this.m_groupBuffer[s],this.m_hasForce&&this.m_forceBuffer[t].Copy(this.m_forceBuffer[s]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[t]=this.m_staticPressureBuffer[s]),this.m_depthBuffer&&(this.m_depthBuffer[t]=this.m_depthBuffer[s]),this.m_colorBuffer.data&&this.m_colorBuffer.data[t].Copy(this.m_colorBuffer.data[s]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[t]=this.m_userDataBuffer.data[s]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[t]=this.m_expirationTimeBuffer.data[s])}t++,i|=o}}let s=t=>t.index<0,r=t=>t.indexA<0||t.indexB<0,a=t=>t.index<0,l=t=>t.indexA<0||t.indexB<0,m=t=>t.indexA<0||t.indexB<0||t.indexC<0;for(let t=0;t<this.m_proxyBuffer.count;t++){let i=this.m_proxyBuffer.data[t];i.index=e[i.index]}this.m_proxyBuffer.RemoveIf(s);for(let t=0;t<this.m_contactBuffer.count;t++){let i=this.m_contactBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_contactBuffer.RemoveIf(r);for(let t=0;t<this.m_bodyContactBuffer.count;t++){let i=this.m_bodyContactBuffer.data[t];i.index=e[i.index]}this.m_bodyContactBuffer.RemoveIf(a);for(let t=0;t<this.m_pairBuffer.count;t++){let i=this.m_pairBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB]}this.m_pairBuffer.RemoveIf(l);for(let t=0;t<this.m_triadBuffer.count;t++){let i=this.m_triadBuffer.data[t];i.indexA=e[i.indexA],i.indexB=e[i.indexB],i.indexC=e[i.indexC]}if(this.m_triadBuffer.RemoveIf(m),this.m_indexByExpirationTimeBuffer.data){let t=0;for(let i=0;i<this.m_count;i++){let s=e[this.m_indexByExpirationTimeBuffer.data[i]];s!==n.t&&(this.m_indexByExpirationTimeBuffer.data[t++]=s)}}for(let i=this.m_groupList;i;i=i.GetNext()){let s=t,n=0,r=!1;for(let t=i.m_firstIndex;t<i.m_lastIndex;t++){let i=e[t];i>=0?(s=Object(o.n)(s,i),n=Object(o.m)(n,i+1)):r=!0}s<n?(i.m_firstIndex=s,i.m_lastIndex=n,r&&i.m_groupFlags&ri.b2_solidParticleGroup&&this.SetGroupFlags(i,i.m_groupFlags|ri.b2_particleGroupNeedsUpdateDepth)):(i.m_firstIndex=0,i.m_lastIndex=0,i.m_groupFlags&ri.b2_particleGroupCanBeEmpty||this.SetGroupFlags(i,i.m_groupFlags|ri.b2_particleGroupWillBeDestroyed))}this.m_count=t,this.m_allParticleFlags=i,this.m_needsUpdateAllParticleFlags=!1;for(let t=this.m_groupList;t;){let e=t.GetNext();t.m_groupFlags&ri.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(t),t=e}}SolveLifetimes(t){this.m_expirationTimeBuffer.data,this.m_indexByExpirationTimeBuffer.data,this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);let e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,s=this.m_indexByExpirationTimeBuffer.data,n=this.GetParticleCount();if(this.m_expirationTimeBufferRequiresSorting){pi(s,0,n,(t,e)=>{let s=i[t],n=i[e],o=s<=0;return o===n<=0?s>n:o}),this.m_expirationTimeBufferRequiresSorting=!1}for(let t=n-1;t>=0;--t){let n=s[t],o=i[n];if(e<o||o<=0)break;this.DestroyParticle(n)}}RotateBuffer(t,e,i){if(t!==e&&e!==i){if(Si(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&Si(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&Si(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&Si(this.m_consecutiveContactStepsBuffer.data,t,e,i),Si(this.m_positionBuffer.data,t,e,i),Si(this.m_velocityBuffer.data,t,e,i),Si(this.m_groupBuffer,t,e,i),this.m_hasForce&&Si(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&Si(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&Si(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&Si(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&Si(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){Si(this.m_handleIndexBuffer.data,t,e,i);for(let e=t;e<i;++e){let t=this.m_handleIndexBuffer.data[e];t&&t.SetIndex(s(t.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Si(this.m_expirationTimeBuffer.data,t,e,i);let n=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data;for(let t=0;t<n;++t)o[t]=s(o[t])}for(let t=0;t<this.m_proxyBuffer.count;t++){let e=this.m_proxyBuffer.data[t];e.index=s(e.index)}for(let t=0;t<this.m_contactBuffer.count;t++){let e=this.m_contactBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB)}for(let t=0;t<this.m_bodyContactBuffer.count;t++){let e=this.m_bodyContactBuffer.data[t];e.index=s(e.index)}for(let t=0;t<this.m_pairBuffer.count;t++){let e=this.m_pairBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB)}for(let t=0;t<this.m_triadBuffer.count;t++){let e=this.m_triadBuffer.data[t];e.indexA=s(e.indexA),e.indexB=s(e.indexB),e.indexC=s(e.indexC)}for(let t=this.m_groupList;t;t=t.GetNext())t.m_firstIndex=s(t.m_firstIndex),t.m_lastIndex=s(t.m_lastIndex-1)+1}function s(s){return s<t?s:s<e?s+i-e:s<i?s+t-e:s}}GetCriticalVelocity(t){return this.m_particleDiameter*t.inv_dt}GetCriticalVelocitySquared(t){let e=this.GetCriticalVelocity(t);return e*e}GetCriticalPressure(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}GetParticleStride(){return n.O*this.m_particleDiameter}GetParticleMass(){let t=this.GetParticleStride();return this.m_def.density*t*t}GetParticleInvMass(){let t=this.m_inverseDiameter*(1/n.O);return this.m_inverseDensity*t*t}GetFixtureContactFilter(){return this.m_allParticleFlags&oi.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetParticleContactFilter(){return this.m_allParticleFlags&oi.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}GetFixtureContactListener(){return this.m_allParticleFlags&oi.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}GetParticleContactListener(){return this.m_allParticleFlags&oi.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}SetUserOverridableBuffer(t,e,i){t.data=e,t.userSuppliedCapacity=i}SetGroupFlags(t,e){let i=t.m_groupFlags;(i^e)&ri.b2_solidParticleGroup&&(e|=ri.b2_particleGroupNeedsUpdateDepth),i&~e&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&e&&(e&ri.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=e),t.m_groupFlags=e}static BodyContactCompare(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}RemoveSpuriousBodyContacts(){pi(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,Pi.BodyContactCompare);let t=Pi.RemoveSpuriousBodyContacts_s_n,e=Pi.RemoveSpuriousBodyContacts_s_pos,i=Pi.RemoveSpuriousBodyContacts_s_normal;const s=this;let r=-1,a=0;this.m_bodyContactBuffer.count=yi(this.m_bodyContactBuffer.data,l=>{if(l.index!==r&&(a=0,r=l.index),a++>3)return!0;let m=t.Copy(l.normal);m.SelfMul(s.m_particleDiameter*(1-l.weight));let h=o.A.AddVV(s.m_positionBuffer.data[l.index],m,e);if(!l.fixture.TestPoint(h)){let t=l.fixture.GetShape().GetChildCount();for(let e=0;e<t;e++){let t=i;if(l.fixture.ComputeDistance(h,t,e)<n.v)return!1}return!0}return!1},this.m_bodyContactBuffer.count)}DetectStuckParticle(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)}ValidateParticleIndex(t){return t>=0&&t<this.GetParticleCount()&&t!==n.t}GetQuantizedTimeElapsed(){return Math.floor(this.m_timeElapsed/4294967296)}LifetimeToExpirationTime(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}ForceCanBeApplied(t){return!(t&oi.b2_wallParticle)}PrepareForceBuffer(){if(!this.m_hasForce){for(let t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}IsRigidGroup(t){return null!==t&&0!=(t.m_groupFlags&ri.b2_rigidParticleGroup)}GetLinearVelocity(t,e,i,s){return this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(i,s):s.Copy(this.m_velocityBuffer.data[e])}InitDampingParameter(t,e,i,s,n,r,a,l){t[0]=s>0?1/s:0,e[0]=n>0?1/n:0,i[0]=o.A.CrossVV(o.A.SubVV(a,r,o.A.s_t0),l)}InitDampingParameterWithRigidGroupOrParticle(t,e,i,s,n,o,r,a){if(s)this.InitDampingParameter(t,e,i,n.GetMass(),n.GetInertia(),n.GetCenter(),r,a);else{let s=this.m_flagsBuffer.data[o];this.InitDampingParameter(t,e,i,s&oi.b2_wallParticle?0:this.GetParticleMass(),0,r,r,a)}}ComputeDampingImpulse(t,e,i,s,n,o,r){let a=t+e*i*i+s+n*o*o;return a>0?r/a:0}ApplyDamping(t,e,i,s,n,o,r,a){s?(n.m_linearVelocity.SelfMulAdd(r*t,a),n.m_angularVelocity+=r*i*e):this.m_velocityBuffer.data[o].SelfMulAdd(r*t,a)}}Pi.xTruncBits=12,Pi.yTruncBits=12,Pi.tagBits=32,Pi.yOffset=1<<Pi.yTruncBits-1,Pi.yShift=Pi.tagBits-Pi.yTruncBits,Pi.xShift=Pi.tagBits-Pi.yTruncBits-Pi.xTruncBits,Pi.xScale=1<<Pi.xShift,Pi.xOffset=Pi.xScale*(1<<Pi.xTruncBits-1),Pi.yMask=(1<<Pi.yTruncBits)-1<<Pi.yShift,Pi.xMask=~Pi.yMask,Pi.DestroyParticlesInShape_s_aabb=new u.a,Pi.CreateParticleGroup_s_transform=new o.z,Pi.ComputeCollisionEnergy_s_v=new o.A,Pi.QueryShapeAABB_s_aabb=new u.a,Pi.QueryPointAABB_s_aabb=new u.a,Pi.RayCast_s_aabb=new u.a,Pi.RayCast_s_p=new o.A,Pi.RayCast_s_v=new o.A,Pi.RayCast_s_n=new o.A,Pi.RayCast_s_point=new o.A,Pi.k_pairFlags=oi.b2_springParticle,Pi.k_triadFlags=oi.b2_elasticParticle,Pi.k_noPressureFlags=oi.b2_powderParticle|oi.b2_tensileParticle,Pi.k_extraDampingFlags=oi.b2_staticPressureParticle,Pi.k_barrierWallFlags=oi.b2_barrierParticle|oi.b2_wallParticle,Pi.CreateParticlesStrokeShapeForGroup_s_edge=new Et,Pi.CreateParticlesStrokeShapeForGroup_s_d=new o.A,Pi.CreateParticlesStrokeShapeForGroup_s_p=new o.A,Pi.CreateParticlesFillShapeForGroup_s_aabb=new u.a,Pi.CreateParticlesFillShapeForGroup_s_p=new o.A,Pi.UpdatePairsAndTriads_s_dab=new o.A,Pi.UpdatePairsAndTriads_s_dbc=new o.A,Pi.UpdatePairsAndTriads_s_dca=new o.A,Pi.AddContact_s_d=new o.A,Pi.UpdateBodyContacts_s_aabb=new u.a,Pi.Solve_s_subStep=new Ze,Pi.SolveCollision_s_aabb=new u.a,Pi.SolveGravity_s_gravity=new o.A,Pi.SolveBarrier_s_aabb=new u.a,Pi.SolveBarrier_s_va=new o.A,Pi.SolveBarrier_s_vb=new o.A,Pi.SolveBarrier_s_pba=new o.A,Pi.SolveBarrier_s_vba=new o.A,Pi.SolveBarrier_s_vc=new o.A,Pi.SolveBarrier_s_pca=new o.A,Pi.SolveBarrier_s_vca=new o.A,Pi.SolveBarrier_s_qba=new o.A,Pi.SolveBarrier_s_qca=new o.A,Pi.SolveBarrier_s_dv=new o.A,Pi.SolveBarrier_s_f=new o.A,Pi.SolvePressure_s_f=new o.A,Pi.SolveDamping_s_v=new o.A,Pi.SolveDamping_s_f=new o.A,Pi.SolveRigidDamping_s_t0=new o.A,Pi.SolveRigidDamping_s_t1=new o.A,Pi.SolveRigidDamping_s_p=new o.A,Pi.SolveRigidDamping_s_v=new o.A,Pi.SolveExtraDamping_s_v=new o.A,Pi.SolveExtraDamping_s_f=new o.A,Pi.SolveRigid_s_position=new o.A,Pi.SolveRigid_s_rotation=new o.t,Pi.SolveRigid_s_transform=new o.z,Pi.SolveRigid_s_velocityTransform=new o.z,Pi.SolveElastic_s_pa=new o.A,Pi.SolveElastic_s_pb=new o.A,Pi.SolveElastic_s_pc=new o.A,Pi.SolveElastic_s_r=new o.t,Pi.SolveElastic_s_t0=new o.A,Pi.SolveSpring_s_pa=new o.A,Pi.SolveSpring_s_pb=new o.A,Pi.SolveSpring_s_d=new o.A,Pi.SolveSpring_s_f=new o.A,Pi.SolveTensile_s_weightedNormal=new o.A,Pi.SolveTensile_s_s=new o.A,Pi.SolveTensile_s_f=new o.A,Pi.SolveViscous_s_v=new o.A,Pi.SolveViscous_s_f=new o.A,Pi.SolveRepulsive_s_f=new o.A,Pi.SolvePowder_s_f=new o.A,Pi.SolveSolid_s_f=new o.A,Pi.RemoveSpuriousBodyContacts_s_n=new o.A,Pi.RemoveSpuriousBodyContacts_s_pos=new o.A,Pi.RemoveSpuriousBodyContacts_s_normal=new o.A,function(t){t.UserOverridableBuffer=class{constructor(){this.data=null,this.userSuppliedCapacity=0}};t.Proxy=class{constructor(){this.index=n.t,this.tag=0}static CompareProxyProxy(t,e){return t.tag<e.tag}static CompareTagProxy(t,e){return t<e.tag}static CompareProxyTag(t,e){return t.tag<e}};t.InsideBoundsEnumerator=class{constructor(e,i,s,n,o){this.m_system=e,this.m_xLower=(i&t.xMask)>>>0,this.m_xUpper=(s&t.xMask)>>>0,this.m_yLower=(i&t.yMask)>>>0,this.m_yUpper=(s&t.yMask)>>>0,this.m_first=n,this.m_last=o,this.m_first,this.m_last}GetNext(){for(;this.m_first<this.m_last;){let e=(this.m_system.m_proxyBuffer.data[this.m_first].tag&t.xMask)>>>0;if(e>=this.m_xLower&&e<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return n.t}};t.ParticleListNode=class{constructor(){this.list=null,this.next=null,this.count=0,this.index=0}};t.FixedSetAllocator=class{Allocate(t,e){return e}Clear(){}GetCount(){return 0}Invalidate(t){}GetValidBuffer(){return[]}GetBuffer(){return[]}SetCount(t){}};t.FixtureParticle=class{constructor(t,e){this.second=n.t,this.first=t,this.second=e}};t.FixtureParticleSet=class extends t.FixedSetAllocator{Initialize(t,e){}Find(t){return n.t}};t.ParticlePair=class{constructor(t,e){this.first=n.t,this.second=n.t,this.first=t,this.second=e}};t.b2ParticlePairSet=class extends t.FixedSetAllocator{Initialize(t,e){}Find(t){return n.t}};t.ConnectionFilter=class{IsNecessary(t){return!0}ShouldCreatePair(t,e){return!0}ShouldCreateTriad(t,e,i){return!0}};t.DestroyParticlesInShapeCallback=class extends Ee{constructor(t,e,i,s){super(),this.m_callDestructionListener=!1,this.m_destroyed=0,this.m_system=t,this.m_shape=e,this.m_xf=i,this.m_callDestructionListener=s,this.m_destroyed=0}ReportFixture(t){return!1}ReportParticle(t,e){return t===this.m_system&&(e>=0&&this.m_system.m_count,this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)}Destroyed(){return this.m_destroyed}};t.JoinParticleGroupsFilter=class extends t.ConnectionFilter{constructor(t){super(),this.m_threshold=0,this.m_threshold=t}ShouldCreatePair(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}ShouldCreateTriad(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}};t.CompositeShape=class extends Ot.b{constructor(t,e=t.length){super(Ot.c.e_unknown,0),this.m_shapeCount=0,this.m_shapes=t,this.m_shapeCount=e}Clone(){throw new Error}GetChildCount(){return 1}TestPoint(t,e){for(let i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}ComputeDistance(t,e,i,s){return 0}RayCast(t,e,i,s){return!1}ComputeAABB(t,e,i){let s=new u.a;t.lowerBound.x=+n.x,t.lowerBound.y=+n.x,t.upperBound.x=-n.x,t.upperBound.y=-n.x;for(let i=0;i<this.m_shapeCount;i++){let n=this.m_shapes[i].GetChildCount();for(let o=0;o<n;o++){let n=s;this.m_shapes[i].ComputeAABB(n,e,o),t.Combine1(n)}}}ComputeMass(t,e){}SetupDistanceProxy(t,e){}ComputeSubmergedArea(t,e,i,s){return 0}Dump(t){}};t.ReactiveFilter=class extends t.ConnectionFilter{constructor(t){super(),this.m_flagsBuffer=t}IsNecessary(t){return 0!=(this.m_flagsBuffer.data[t]&oi.b2_reactiveParticle)}};class e extends bi{constructor(t,e){super(t),this.m_contactFilter=e}ShouldCollideFixtureParticle(t,e,i){if(this.m_contactFilter){if(this.m_system.GetFlagsBuffer()[i]&oi.b2_fixtureContactFilterParticle)return this.m_contactFilter.ShouldCollideFixtureParticle(t,this.m_system,i)}return!0}ReportFixtureAndParticle(e,i,s){let n=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,r=t.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp,a=this.m_system.m_positionBuffer.data[s],l=n,m=e.ComputeDistance(a,l,i);if(m<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,s)){let t=e.GetBody(),i=t.GetWorldCenter(),n=t.GetMass(),h=t.GetInertia()-n*t.GetLocalCenter().LengthSquared(),_=n>0?1/n:0,c=h>0?1/h:0,u=this.m_system.m_flagsBuffer.data[s]&oi.b2_wallParticle?0:this.m_system.GetParticleInvMass(),d=o.A.SubVV(a,i,r),f=o.A.CrossVV(d,l),p=u+_+c*f*f,A=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];A.index=s,A.body=t,A.fixture=e,A.weight=1-m*this.m_system.m_inverseDiameter,A.normal.Copy(l.SelfNeg()),A.mass=p>0?1/p:0,this.m_system.DetectStuckParticle(s)}}}e.ReportFixtureAndParticle_s_n=new o.A,e.ReportFixtureAndParticle_s_rp=new o.A,t.UpdateBodyContactsCallback=e;class i extends bi{constructor(t,e){super(t),this.m_step=e}ReportFixtureAndParticle(e,i,s){let r=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,a=t.SolveCollisionCallback.ReportFixtureAndParticle_s_output,l=t.SolveCollisionCallback.ReportFixtureAndParticle_s_input,m=t.SolveCollisionCallback.ReportFixtureAndParticle_s_p,h=t.SolveCollisionCallback.ReportFixtureAndParticle_s_v,_=t.SolveCollisionCallback.ReportFixtureAndParticle_s_f,c=e.GetBody(),u=this.m_system.m_positionBuffer.data[s],d=this.m_system.m_velocityBuffer.data[s],f=a,p=l;if(0===this.m_system.m_iterationIndex){let t=o.z.MulTXV(c.m_xf0,u,r);e.GetShape().GetType()===Ot.c.e_circleShape&&(t.SelfSub(c.GetLocalCenter()),o.t.MulRV(c.m_xf0.q,t,t),o.t.MulTRV(c.m_xf.q,t,t),t.SelfAdd(c.GetLocalCenter())),o.z.MulXV(c.m_xf,t,p.p1)}else p.p1.Copy(u);if(o.A.AddVMulSV(u,this.m_step.dt,d,p.p2),p.maxFraction=1,e.RayCast(f,p,i)){let t=f.normal,e=m;e.x=(1-f.fraction)*p.p1.x+f.fraction*p.p2.x+n.v*t.x,e.y=(1-f.fraction)*p.p1.y+f.fraction*p.p2.y+n.v*t.y;let i=h;i.x=this.m_step.inv_dt*(e.x-u.x),i.y=this.m_step.inv_dt*(e.y-u.y),this.m_system.m_velocityBuffer.data[s].Copy(i);let o=_;o.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.x-i.x),o.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.y-i.y),this.m_system.ParticleApplyForce(s,o)}}ReportParticle(t,e){return!1}}i.ReportFixtureAndParticle_s_p1=new o.A,i.ReportFixtureAndParticle_s_output=new u.m,i.ReportFixtureAndParticle_s_input=new u.l,i.ReportFixtureAndParticle_s_p=new o.A,i.ReportFixtureAndParticle_s_v=new o.A,i.ReportFixtureAndParticle_s_f=new o.A,t.SolveCollisionCallback=i}(Pi||(Pi={}));class Ii{constructor(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new We,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new o.A,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new Ue,this.m_island=new ni,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}SetDestructionListener(t){this.m_destructionListener=t}SetContactFilter(t){this.m_contactManager.m_contactFilter=t}SetContactListener(t){this.m_contactManager.m_contactListener=t}SetDebugDraw(t){this.m_debugDraw=t}CreateBody(t){if(this.IsLocked())return null;const e=new Yt(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}DestroyBody(t){if(this.IsLocked())return;let e=t.m_jointList;for(;e;){const i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;let i=t.m_controllerList;for(;i;){const e=i;i=i.nextController,e.controller.RemoveBody(t)}let s=t.m_contactList;for(;s;){const t=s;s=s.next,this.m_contactManager.Destroy(t.contact)}t.m_contactList=null;let n=t.m_fixtureList;for(;n;){const e=n;n=n.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(e),e.DestroyProxies(this.m_contactManager.m_broadPhase),e.Destroy(),t.m_fixtureList=n,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}CreateJoint(t){if(this.IsLocked())return null;const e=we.Create(t,null);e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_edgeA.prev=null,e.m_edgeA.next=e.m_bodyA.m_jointList,e.m_bodyA.m_jointList&&(e.m_bodyA.m_jointList.prev=e.m_edgeA),e.m_bodyA.m_jointList=e.m_edgeA,e.m_edgeB.prev=null,e.m_edgeB.next=e.m_bodyB.m_jointList,e.m_bodyB.m_jointList&&(e.m_bodyB.m_jointList.prev=e.m_edgeB),e.m_bodyB.m_jointList=e.m_edgeB;const i=t.bodyA,s=t.bodyB;if(!t.collideConnected){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}return e}DestroyJoint(t){if(this.IsLocked())return;const e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);const i=t.m_bodyA,s=t.m_bodyB;if(i.SetAwake(!0),s.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===i.m_jointList&&(i.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,we.Destroy(t,null),--this.m_jointCount,!e){let t=s.GetContactList();for(;t;)t.other===i&&t.contact.FlagForFiltering(),t=t.next}}CreateParticleSystem(t){if(this.IsLocked())return null;const e=new Pi(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}DestroyParticleSystem(t){this.IsLocked()||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next))}CalculateReasonableParticleIterations(t){if(null===this.m_particleSystemList)return 1;return li(this.m_gravity.Length(),function(t){let e=n.x;for(let i=t.GetParticleSystemList();null!==i;i=i.m_next)e=Object(o.n)(e,i.GetRadius());return e}(this),t)}Step(t,e,i,s=this.CalculateReasonableParticleIterations(t)){const n=Ii.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;const o=Ii.Step_s_step;o.dt=t,o.velocityIterations=e,o.positionIterations=i,o.particleIterations=s,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;const r=Ii.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=r.GetMilliseconds(),this.m_stepComplete&&o.dt>0){const t=Ii.Step_s_timer.Reset();for(let t=this.m_particleSystemList;t;t=t.m_next)t.Solve(o);this.Solve(o),this.m_profile.solve=t.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){const t=Ii.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=t.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=n.GetMilliseconds()}ClearForces(){for(let t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}DrawParticleSystem(t){const e=t.GetParticleCount();if(e){const i=t.GetRadius(),s=t.GetPositionBuffer();if(t.m_colorBuffer.data){const n=t.GetColorBuffer();this.m_debugDraw.DrawParticles(s,i,n,e)}else this.m_debugDraw.DrawParticles(s,i,null,e)}}DrawDebugData(){if(null===this.m_debugDraw)return;const t=this.m_debugDraw.GetFlags(),e=Ii.DrawDebugData_s_color.SetRGB(0,0,0);if(t&s.e_shapeBit)for(let t=this.m_bodyList;t;t=t.m_next){const i=t.m_xf;this.m_debugDraw.PushTransform(i);for(let i=t.GetFixtureList();i;i=i.m_next)t.IsActive()?t.GetType()===Wt.b2_staticBody?(e.SetRGB(.5,.9,.5),this.DrawShape(i,e)):t.GetType()===Wt.b2_kinematicBody?(e.SetRGB(.5,.5,.9),this.DrawShape(i,e)):t.IsAwake()?(e.SetRGB(.9,.7,.7),this.DrawShape(i,e)):(e.SetRGB(.6,.6,.6),this.DrawShape(i,e)):(e.SetRGB(.5,.5,.3),this.DrawShape(i,e));this.m_debugDraw.PopTransform(i)}if(t&s.e_particleBit)for(let t=this.m_particleSystemList;t;t=t.m_next)this.DrawParticleSystem(t);if(t&s.e_jointBit)for(let t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(t&s.e_aabbBit){e.SetRGB(.9,.3,.9);const t=this.m_contactManager.m_broadPhase,i=Ii.DrawDebugData_s_vs;for(let s=this.m_bodyList;s;s=s.m_next)if(s.IsActive())for(let n=s.GetFixtureList();n;n=n.m_next)for(let s=0;s<n.m_proxyCount;++s){const o=n.m_proxies[s],r=t.GetFatAABB(o.treeNode);i[0].Set(r.lowerBound.x,r.lowerBound.y),i[1].Set(r.upperBound.x,r.lowerBound.y),i[2].Set(r.upperBound.x,r.upperBound.y),i[3].Set(r.lowerBound.x,r.upperBound.y),this.m_debugDraw.DrawPolygon(i,4,e)}}if(t&s.e_centerOfMassBit)for(let t=this.m_bodyList;t;t=t.m_next){const e=Ii.DrawDebugData_s_xf;e.q.Copy(t.m_xf.q),e.p.Copy(t.GetWorldCenter()),this.m_debugDraw.DrawTransform(e)}if(t&s.e_controllerBit)for(let t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw)}QueryAABB(t,e){const i=this.m_contactManager.m_broadPhase;if(i.Query(function(e){const s=i.GetUserData(e).fixture;return t instanceof Ee?t.ReportFixture(s):t(s)},e),t instanceof Ee)for(let i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryAABB(t,e)}QueryShape(t,e,i){const s=this.m_contactManager.m_broadPhase;const n=Ii.QueryShape_s_aabb;if(e.ComputeAABB(n,i,0),s.Query(function(n){const o=s.GetUserData(n).fixture;return!Object(u.o)(e,0,o.GetShape(),0,i,o.GetBody().GetTransform())||(t instanceof Ee?t.ReportFixture(o):t(o))},n),t instanceof Ee)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,n)}QueryPoint(t,e){const i=this.m_contactManager.m_broadPhase;const s=Ii.QueryPoint_s_aabb;if(s.lowerBound.Set(e.x-n.v,e.y-n.v),s.upperBound.Set(e.x+n.v,e.y+n.v),i.Query(function(s){const n=i.GetUserData(s).fixture;return!n.TestPoint(e)||(t instanceof Ee?t.ReportFixture(n):t(n))},s),t instanceof Ee)for(let e=this.m_particleSystemList;e;e=e.m_next)t.ShouldQueryParticleSystem(e)&&e.QueryAABB(t,s)}RayCast(t,e,i){const s=this.m_contactManager.m_broadPhase;const n=Ii.RayCast_s_input;if(n.maxFraction=1,n.p1.Copy(e),n.p2.Copy(i),s.RayCast(function(n,o){const r=s.GetUserData(o),a=r.fixture,l=r.childIndex,m=Ii.RayCast_s_output;if(a.RayCast(m,n,l)){const s=m.fraction,n=Ii.RayCast_s_point;return n.Set((1-s)*e.x+s*i.x,(1-s)*e.y+s*i.y),t instanceof Xe?t.ReportFixture(a,n,m.normal,s):t(a,n,m.normal,s)}return n.maxFraction},n),t instanceof Xe)for(let s=this.m_particleSystemList;s;s=s.m_next)t.ShouldQueryParticleSystem(s)&&s.RayCast(t,e,i)}RayCastOne(t,e){let i=null,s=1;return this.RayCast(function(t,e,n,o){return o<s&&(s=o,i=t),s},t,e),i}RayCastAll(t,e,i=[]){return this.RayCast(function(t,e,s,n){return i.push(t),1},t,e),i}GetBodyList(){return this.m_bodyList}GetJointList(){return this.m_jointList}GetParticleSystemList(){return this.m_particleSystemList}GetContactList(){return this.m_contactManager.m_contactList}SetAllowSleeping(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetAllowSleeping(){return this.m_allowSleep}SetWarmStarting(t){this.m_warmStarting=t}GetWarmStarting(){return this.m_warmStarting}SetContinuousPhysics(t){this.m_continuousPhysics=t}GetContinuousPhysics(){return this.m_continuousPhysics}SetSubStepping(t){this.m_subStepping=t}GetSubStepping(){return this.m_subStepping}GetProxyCount(){return this.m_contactManager.m_broadPhase.GetProxyCount()}GetBodyCount(){return this.m_bodyCount}GetJointCount(){return this.m_jointCount}GetContactCount(){return this.m_contactManager.m_contactCount}GetTreeHeight(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}GetTreeBalance(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}GetTreeQuality(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}SetGravity(t,e=!0){if(!o.A.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(let t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)}GetGravity(){return this.m_gravity}IsLocked(){return this.m_locked}SetAutoClearForces(t){this.m_clearForces=t}GetAutoClearForces(){return this.m_clearForces}ShiftOrigin(t){if(!this.IsLocked()){for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(let e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}}GetContactManager(){return this.m_contactManager}GetProfile(){return this.m_profile}Dump(t){if(this.m_locked)return;t("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),t("this.m_world.SetGravity(g);\n"),t("const bodies: b2Body[] = [];\n"),t("const joints: b2Joint[] = [];\n");let e=0;for(let i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=e,i.Dump(t),++e;e=0;for(let t=this.m_jointList;t;t=t.m_next)t.m_index=e,++e;for(let e=this.m_jointList;e;e=e.m_next)e.m_type!==Ut.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"));for(let e=this.m_jointList;e;e=e.m_next)e.m_type===Ut.e_gearJoint&&(t("{\n"),e.Dump(t),t("}\n"))}DrawJoint(t){const e=t.GetBodyA(),i=t.GetBodyB(),s=e.m_xf,n=i.m_xf,o=s.p,r=n.p,a=t.GetAnchorA(Ii.DrawJoint_s_p1),l=t.GetAnchorB(Ii.DrawJoint_s_p2),m=Ii.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(t.m_type){case Ut.e_distanceJoint:this.m_debugDraw.DrawSegment(a,l,m);break;case Ut.e_pulleyJoint:{const e=t,i=e.GetGroundAnchorA(),s=e.GetGroundAnchorB();this.m_debugDraw.DrawSegment(i,a,m),this.m_debugDraw.DrawSegment(s,l,m),this.m_debugDraw.DrawSegment(i,s,m)}break;case Ut.e_mouseJoint:this.m_debugDraw.DrawSegment(a,l,m);break;default:this.m_debugDraw.DrawSegment(o,a,m),this.m_debugDraw.DrawSegment(a,l,m),this.m_debugDraw.DrawSegment(r,l,m)}}DrawShape(t,e){const i=t.GetShape();switch(i.m_type){case Ot.c.e_circleShape:{const t=i,s=t.m_p,n=t.m_radius,r=o.A.UNITX;this.m_debugDraw.DrawSolidCircle(s,n,r,e)}break;case Ot.c.e_edgeShape:{const t=i,s=t.m_vertex1,n=t.m_vertex2;this.m_debugDraw.DrawSegment(s,n,e)}break;case Ot.c.e_chainShape:{const t=i,s=t.m_count,n=t.m_vertices;let o=n[0];this.m_debugDraw.DrawCircle(o,.05,e);for(let t=1;t<s;++t){const i=n[t];this.m_debugDraw.DrawSegment(o,i,e),this.m_debugDraw.DrawCircle(i,.05,e),o=i}}break;case Ot.c.e_polygonShape:{const t=i,s=t.m_count,n=t.m_vertices;this.m_debugDraw.DrawSolidPolygon(n,s,e)}}}Solve(t){for(let t=this.m_bodyList;t;t=t.m_next)t.m_xf0.Copy(t.m_xf);for(let e=this.m_controllerList;e;e=e.m_next)e.Step(t);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;const e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=this.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.s_stack;for(let s=this.m_bodyList;s;s=s.m_next){if(s.m_islandFlag)continue;if(!s.IsAwake()||!s.IsActive())continue;if(s.GetType()===Wt.b2_staticBody)continue;e.Clear();let n=0;for(i[n++]=s,s.m_islandFlag=!0;n>0;){const t=i[--n];if(e.AddBody(t),t.SetAwake(!0),t.GetType()!==Wt.b2_staticBody){for(let s=t.m_contactList;s;s=s.next){const t=s.contact;if(t.m_islandFlag)continue;if(!t.IsEnabled()||!t.IsTouching())continue;const o=t.m_fixtureA.m_isSensor,r=t.m_fixtureB.m_isSensor;if(o||r)continue;e.AddContact(t),t.m_islandFlag=!0;const a=s.other;a.m_islandFlag||(i[n++]=a,a.m_islandFlag=!0)}for(let s=t.m_jointList;s;s=s.next){if(s.joint.m_islandFlag)continue;const t=s.other;t.IsActive()&&(e.AddJoint(s.joint),s.joint.m_islandFlag=!0,t.m_islandFlag||(i[n++]=t,t.m_islandFlag=!0))}}}const o=new Ue;e.Solve(o,t,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=o.solveInit,this.m_profile.solveVelocity+=o.solveVelocity,this.m_profile.solvePosition+=o.solvePosition;for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];i.GetType()===Wt.b2_staticBody&&(i.m_islandFlag=!1)}}for(let t=0;t<i.length&&i[t];++t)i[t]=null;const s=new l;for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag&&t.GetType()!==Wt.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=s.GetMilliseconds()}SolveTOI(t){const e=this.m_island;if(e.Initialize(2*n.H,n.H,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(let t=this.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let i=null,s=1;for(let t=this.m_contactManager.m_contactList;t;t=t.m_next){if(!t.IsEnabled())continue;if(t.m_toiCount>n.G)continue;let e=1;if(t.m_toiFlag)e=t.m_toi;else{const i=t.GetFixtureA(),s=t.GetFixtureB();if(i.IsSensor()||s.IsSensor())continue;const n=i.GetBody(),r=s.GetBody(),a=n.m_type,l=r.m_type,m=n.IsAwake()&&a!==Wt.b2_staticBody,h=r.IsAwake()&&l!==Wt.b2_staticBody;if(!m&&!h)continue;const _=n.IsBullet()||a!==Wt.b2_dynamicBody,c=r.IsBullet()||l!==Wt.b2_dynamicBody;if(!_&&!c)continue;let u=n.m_sweep.alpha0;n.m_sweep.alpha0<r.m_sweep.alpha0?(u=r.m_sweep.alpha0,n.m_sweep.Advance(u)):r.m_sweep.alpha0<n.m_sweep.alpha0&&(u=n.m_sweep.alpha0,r.m_sweep.Advance(u));const d=t.GetChildIndexA(),f=t.GetChildIndexB(),p=Ii.SolveTOI_s_toi_input;p.proxyA.SetShape(i.GetShape(),d),p.proxyB.SetShape(s.GetShape(),f),p.sweepA.Copy(n.m_sweep),p.sweepB.Copy(r.m_sweep),p.tMax=1;const A=Ii.SolveTOI_s_toi_output;$(A,p);const y=A.t;e=A.state===k.e_touching?Object(o.n)(u+(1-u)*y,1):1,t.m_toi=e,t.m_toiFlag=!0}e<s&&(i=t,s=e)}if(null===i||1-10*n.r<s){this.m_stepComplete=!0;break}const r=i.GetFixtureA(),a=i.GetFixtureB(),l=r.GetBody(),m=a.GetBody(),h=Ii.SolveTOI_s_backup1.Copy(l.m_sweep),_=Ii.SolveTOI_s_backup2.Copy(m.m_sweep);if(l.Advance(s),m.Advance(s),i.Update(this.m_contactManager.m_contactListener),i.m_toiFlag=!1,++i.m_toiCount,!i.IsEnabled()||!i.IsTouching()){i.SetEnabled(!1),l.m_sweep.Copy(h),m.m_sweep.Copy(_),l.SynchronizeTransform(),m.SynchronizeTransform();continue}l.SetAwake(!0),m.SetAwake(!0),e.Clear(),e.AddBody(l),e.AddBody(m),e.AddContact(i),l.m_islandFlag=!0,m.m_islandFlag=!0,i.m_islandFlag=!0;for(let t=0;t<2;++t){const i=0===t?l:m;if(i.m_type===Wt.b2_dynamicBody)for(let t=i.m_contactList;t&&e.m_bodyCount!==e.m_bodyCapacity&&e.m_contactCount!==e.m_contactCapacity;t=t.next){const n=t.contact;if(n.m_islandFlag)continue;const o=t.other;if(o.m_type===Wt.b2_dynamicBody&&!i.IsBullet()&&!o.IsBullet())continue;const r=n.m_fixtureA.m_isSensor,a=n.m_fixtureB.m_isSensor;if(r||a)continue;const l=Ii.SolveTOI_s_backup.Copy(o.m_sweep);o.m_islandFlag||o.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.IsEnabled()&&n.IsTouching()?(n.m_islandFlag=!0,e.AddContact(n),o.m_islandFlag||(o.m_islandFlag=!0,o.m_type!==Wt.b2_staticBody&&o.SetAwake(!0),e.AddBody(o))):(o.m_sweep.Copy(l),o.SynchronizeTransform())}}const c=Ii.SolveTOI_s_subStep;c.dt=(1-s)*t.dt,c.inv_dt=1/c.dt,c.dtRatio=1,c.positionIterations=20,c.velocityIterations=t.velocityIterations,c.particleIterations=t.particleIterations,c.warmStarting=!1,e.SolveTOI(c,l.m_islandIndex,m.m_islandIndex);for(let t=0;t<e.m_bodyCount;++t){const i=e.m_bodies[t];if(i.m_islandFlag=!1,i.m_type===Wt.b2_dynamicBody){i.SynchronizeFixtures();for(let t=i.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}}AddController(t){return t.m_world=this,t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}RemoveController(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t.m_world=null,t}}Ii.Step_s_step=new Ze,Ii.Step_s_stepTimer=new l,Ii.Step_s_timer=new l,Ii.DrawDebugData_s_color=new r(0,0,0),Ii.DrawDebugData_s_vs=o.A.MakeArray(4),Ii.DrawDebugData_s_xf=new o.z,Ii.QueryShape_s_aabb=new u.a,Ii.QueryPoint_s_aabb=new u.a,Ii.RayCast_s_input=new u.l,Ii.RayCast_s_output=new u.m,Ii.RayCast_s_point=new o.A,Ii.DrawJoint_s_p1=new o.A,Ii.DrawJoint_s_p2=new o.A,Ii.DrawJoint_s_color=new r(.5,.8,.8),Ii.SolveTOI_s_subStep=new Ze,Ii.SolveTOI_s_backup=new o.y,Ii.SolveTOI_s_backup1=new o.y,Ii.SolveTOI_s_backup2=new o.y,Ii.SolveTOI_s_toi_input=new T,Ii.SolveTOI_s_toi_output=new j;class Gi{constructor(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new o.A(0,0),this.damping=.1,this.k2=.9,this.k3=.1}}class Di{constructor(){this.m_count=0,this.m_ps=null,this.m_p0s=null,this.m_vs=null,this.m_ims=null,this.m_Ls=null,this.m_as=null,this.m_gravity=new o.A,this.m_damping=0,this.m_k2=1,this.m_k3=.1}GetVertexCount(){return this.m_count}GetVertices(){return this.m_ps}Initialize(t){this.m_count=t.count,this.m_ps=o.A.MakeArray(this.m_count),this.m_p0s=o.A.MakeArray(this.m_count),this.m_vs=o.A.MakeArray(this.m_count),this.m_ims=Object(n.g)(this.m_count);for(let e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();const i=t.masses[e];this.m_ims[e]=i>0?1/i:0}const e=this.m_count-1,i=this.m_count-2;this.m_Ls=Object(n.g)(e),this.m_as=Object(n.g)(i);for(let t=0;t<e;++t){const e=this.m_ps[t],i=this.m_ps[t+1];this.m_Ls[t]=o.A.DistanceVV(e,i)}for(let t=0;t<i;++t){const e=this.m_ps[t],i=this.m_ps[t+1],s=this.m_ps[t+2],n=o.A.SubVV(i,e,o.A.s_t0),r=o.A.SubVV(s,i,o.A.s_t1),a=o.A.CrossVV(n,r),l=o.A.DotVV(n,r);this.m_as[t]=Object(o.d)(a,l)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}Step(t,e){if(0===t)return;const i=Math.exp(-t*this.m_damping);for(let e=0;e<this.m_count;++e)this.m_p0s[e].Copy(this.m_ps[e]),this.m_ims[e]>0&&this.m_vs[e].SelfMulAdd(t,this.m_gravity),this.m_vs[e].SelfMul(i),this.m_ps[e].SelfMulAdd(t,this.m_vs[e]);for(let t=0;t<e;++t)this.SolveC2(),this.SolveC3(),this.SolveC2();const s=1/t;for(let t=0;t<this.m_count;++t)o.A.MulSV(s,o.A.SubVV(this.m_ps[t],this.m_p0s[t],o.A.s_t0),this.m_vs[t])}SolveC2(){const t=this.m_count-1;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=o.A.SubVV(i,t,Di.s_d),n=s.Normalize(),r=this.m_ims[e],a=this.m_ims[e+1];if(r+a===0)continue;const l=r/(r+a),m=a/(r+a);t.SelfMulSub(this.m_k2*l*(this.m_Ls[e]-n),s),i.SelfMulAdd(this.m_k2*m*(this.m_Ls[e]-n),s)}}SetAngle(t){const e=this.m_count-2;for(let i=0;i<e;++i)this.m_as[i]=t}SolveC3(){const t=this.m_count-2;for(let e=0;e<t;++e){const t=this.m_ps[e],i=this.m_ps[e+1],s=this.m_ps[e+2],r=this.m_ims[e],a=this.m_ims[e+1],l=this.m_ims[e+2],m=o.A.SubVV(i,t,Di.s_d1),h=o.A.SubVV(s,i,Di.s_d2),_=m.LengthSquared(),c=h.LengthSquared();if(_*c==0)continue;const u=o.A.CrossVV(m,h),d=o.A.DotVV(m,h);let f=Object(o.d)(u,d);const p=o.A.MulSV(-1/_,m.SelfSkew(),Di.s_Jd1),A=o.A.MulSV(1/c,h.SelfSkew(),Di.s_Jd2),y=o.A.NegV(p,Di.s_J1),x=o.A.SubVV(p,A,Di.s_J2),B=A;let S=r*o.A.DotVV(y,y)+a*o.A.DotVV(x,x)+l*o.A.DotVV(B,B);if(0===S)continue;S=1/S;let C=f-this.m_as[e];for(;C>n.P;)C=(f-=2*n.P)-this.m_as[e];for(;C<-n.P;)C=(f+=2*n.P)-this.m_as[e];const b=-this.m_k3*S*C;t.SelfMulAdd(r*b,y),i.SelfMulAdd(a*b,x),s.SelfMulAdd(l*b,B)}}Draw(t){const e=new r(.4,.5,.7);for(let i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}Di.s_d=new o.A,Di.s_d1=new o.A,Di.s_d2=new o.A,Di.s_Jd1=new o.A,Di.s_Jd2=new o.A,Di.s_J1=new o.A,Di.s_J2=new o.A,i.d(e,"b2Assert",function(){return n.b}),i.d(e,"b2_maxFloat",function(){return n.x}),i.d(e,"b2_epsilon",function(){return n.r}),i.d(e,"b2_epsilon_sq",function(){return n.s}),i.d(e,"b2_pi",function(){return n.P}),i.d(e,"b2_maxManifoldPoints",function(){return n.z}),i.d(e,"b2_maxPolygonVertices",function(){return n.D}),i.d(e,"b2_aabbExtension",function(){return n.k}),i.d(e,"b2_aabbMultiplier",function(){return n.l}),i.d(e,"b2_linearSlop",function(){return n.v}),i.d(e,"b2_angularSlop",function(){return n.n}),i.d(e,"b2_polygonRadius",function(){return n.Q}),i.d(e,"b2_maxSubSteps",function(){return n.G}),i.d(e,"b2_maxTOIContacts",function(){return n.H}),i.d(e,"b2_velocityThreshold",function(){return n.T}),i.d(e,"b2_maxLinearCorrection",function(){return n.y}),i.d(e,"b2_maxAngularCorrection",function(){return n.w}),i.d(e,"b2_maxTranslation",function(){return n.I}),i.d(e,"b2_maxTranslationSquared",function(){return n.J}),i.d(e,"b2_maxRotation",function(){return n.E}),i.d(e,"b2_maxRotationSquared",function(){return n.F}),i.d(e,"b2_baumgarte",function(){return n.p}),i.d(e,"b2_toiBaumgarte",function(){return n.S}),i.d(e,"b2_invalidParticleIndex",function(){return n.t}),i.d(e,"b2_maxParticleIndex",function(){return n.B}),i.d(e,"b2_particleStride",function(){return n.O}),i.d(e,"b2_minParticleWeight",function(){return n.N}),i.d(e,"b2_maxParticlePressure",function(){return n.C}),i.d(e,"b2_maxParticleForce",function(){return n.A}),i.d(e,"b2_maxTriadDistance",function(){return n.K}),i.d(e,"b2_maxTriadDistanceSquared",function(){return n.L}),i.d(e,"b2_minParticleSystemBufferCapacity",function(){return n.M}),i.d(e,"b2_barrierCollisionTime",function(){return n.o}),i.d(e,"b2_timeToSleep",function(){return n.R}),i.d(e,"b2_linearSleepTolerance",function(){return n.u}),i.d(e,"b2_angularSleepTolerance",function(){return n.m}),i.d(e,"b2Alloc",function(){return n.a}),i.d(e,"b2Free",function(){return n.c}),i.d(e,"b2Log",function(){return n.d}),i.d(e,"b2Version",function(){return n.j}),i.d(e,"b2_version",function(){return n.U}),i.d(e,"b2_changelist",function(){return n.q}),i.d(e,"b2ParseInt",function(){return n.h}),i.d(e,"b2ParseUInt",function(){return n.i}),i.d(e,"b2MakeArray",function(){return n.e}),i.d(e,"b2MakeNullArray",function(){return n.f}),i.d(e,"b2MakeNumberArray",function(){return n.g}),i.d(e,"b2_pi_over_180",function(){return o.E}),i.d(e,"b2_180_over_pi",function(){return o.D}),i.d(e,"b2_two_pi",function(){return o.F}),i.d(e,"b2Abs",function(){return o.a}),i.d(e,"b2Min",function(){return o.n}),i.d(e,"b2Max",function(){return o.m}),i.d(e,"b2Clamp",function(){return o.e}),i.d(e,"b2Swap",function(){return o.x}),i.d(e,"b2IsValid",function(){return o.j}),i.d(e,"b2Sq",function(){return o.v}),i.d(e,"b2InvSqrt",function(){return o.h}),i.d(e,"b2Sqrt",function(){return o.w}),i.d(e,"b2Pow",function(){return o.p}),i.d(e,"b2DegToRad",function(){return o.g}),i.d(e,"b2RadToDeg",function(){return o.q}),i.d(e,"b2Cos",function(){return o.f}),i.d(e,"b2Sin",function(){return o.u}),i.d(e,"b2Acos",function(){return o.b}),i.d(e,"b2Asin",function(){return o.c}),i.d(e,"b2Atan2",function(){return o.d}),i.d(e,"b2NextPowerOfTwo",function(){return o.o}),i.d(e,"b2IsPowerOfTwo",function(){return o.i}),i.d(e,"b2Random",function(){return o.r}),i.d(e,"b2RandomRange",function(){return o.s}),i.d(e,"b2Vec2",function(){return o.A}),i.d(e,"b2Vec2_zero",function(){return o.B}),i.d(e,"b2Vec3",function(){return o.C}),i.d(e,"b2Mat22",function(){return o.k}),i.d(e,"b2Mat33",function(){return o.l}),i.d(e,"b2Rot",function(){return o.t}),i.d(e,"b2Transform",function(){return o.z}),i.d(e,"b2Sweep",function(){return o.y}),i.d(e,"b2Color",function(){return r}),i.d(e,"b2DrawFlags",function(){return s}),i.d(e,"b2Draw",function(){return a}),i.d(e,"b2Timer",function(){return l}),i.d(e,"b2Counter",function(){return m}),i.d(e,"b2GrowableStack",function(){return h}),i.d(e,"b2BlockAllocator",function(){return _}),i.d(e,"b2StackAllocator",function(){return c}),i.d(e,"b2ContactFeatureType",function(){return u.e}),i.d(e,"b2ContactFeature",function(){return u.d}),i.d(e,"b2ContactID",function(){return u.f}),i.d(e,"b2ManifoldPoint",function(){return u.i}),i.d(e,"b2ManifoldType",function(){return u.j}),i.d(e,"b2Manifold",function(){return u.h}),i.d(e,"b2WorldManifold",function(){return u.p}),i.d(e,"b2PointState",function(){return u.k}),i.d(e,"b2GetPointStates",function(){return u.g}),i.d(e,"b2ClipVertex",function(){return u.c}),i.d(e,"b2RayCastInput",function(){return u.l}),i.d(e,"b2RayCastOutput",function(){return u.m}),i.d(e,"b2AABB",function(){return u.a}),i.d(e,"b2TestOverlapAABB",function(){return u.n}),i.d(e,"b2ClipSegmentToLine",function(){return u.b}),i.d(e,"b2TestOverlapShape",function(){return u.o}),i.d(e,"b2DistanceProxy",function(){return d.d}),i.d(e,"b2SimplexCache",function(){return d.f}),i.d(e,"b2DistanceInput",function(){return d.b}),i.d(e,"b2DistanceOutput",function(){return d.c}),i.d(e,"b2_gjkCalls",function(){return d.h}),i.d(e,"b2_gjkIters",function(){return d.i}),i.d(e,"b2_gjkMaxIters",function(){return d.j}),i.d(e,"b2_gjk_reset",function(){return d.k}),i.d(e,"b2SimplexVertex",function(){return d.g}),i.d(e,"b2Simplex",function(){return d.e}),i.d(e,"b2Distance",function(){return d.a}),i.d(e,"b2Pair",function(){return y}),i.d(e,"b2BroadPhase",function(){return x}),i.d(e,"b2PairLessThan",function(){return B}),i.d(e,"b2TreeNode",function(){return p}),i.d(e,"b2DynamicTree",function(){return A}),i.d(e,"b2_toiTime",function(){return S}),i.d(e,"b2_toiMaxTime",function(){return C}),i.d(e,"b2_toiCalls",function(){return b}),i.d(e,"b2_toiIters",function(){return g}),i.d(e,"b2_toiMaxIters",function(){return V}),i.d(e,"b2_toiRootIters",function(){return w}),i.d(e,"b2_toiMaxRootIters",function(){return v}),i.d(e,"b2_toi_reset",function(){return M}),i.d(e,"b2TOIInput",function(){return T}),i.d(e,"b2TOIOutputState",function(){return k}),i.d(e,"b2TOIOutput",function(){return j}),i.d(e,"b2SeparationFunctionType",function(){return z}),i.d(e,"b2SeparationFunction",function(){return q}),i.d(e,"b2TimeOfImpact",function(){return $}),i.d(e,"b2CollideCircles",function(){return K}),i.d(e,"b2CollidePolygonAndCircle",function(){return st}),i.d(e,"b2CollidePolygons",function(){return wt}),i.d(e,"b2CollideEdgeAndCircle",function(){return Lt}),i.d(e,"b2CollideEdgeAndPolygon",function(){return qt}),i.d(e,"b2MassData",function(){return Ot.a}),i.d(e,"b2ShapeType",function(){return Ot.c}),i.d(e,"b2Shape",function(){return Ot.b}),i.d(e,"b2CircleShape",function(){return Nt}),i.d(e,"b2PolygonShape",function(){return Jt}),i.d(e,"b2EdgeShape",function(){return Et}),i.d(e,"b2ChainShape",function(){return Xt}),i.d(e,"b2Filter",function(){return Ht.a}),i.d(e,"b2FixtureDef",function(){return Ht.c}),i.d(e,"b2FixtureProxy",function(){return Ht.d}),i.d(e,"b2Fixture",function(){return Ht.b}),i.d(e,"b2BodyType",function(){return Wt}),i.d(e,"b2BodyDef",function(){return $t}),i.d(e,"b2Body",function(){return Yt}),i.d(e,"b2World",function(){return Ii}),i.d(e,"b2DestructionListener",function(){return qe}),i.d(e,"b2ContactFilter",function(){return Oe}),i.d(e,"b2ContactImpulse",function(){return Ne}),i.d(e,"b2ContactListener",function(){return Je}),i.d(e,"b2QueryCallback",function(){return Ee}),i.d(e,"b2RayCastCallback",function(){return Xe}),i.d(e,"b2Island",function(){return ni}),i.d(e,"b2Profile",function(){return Ue}),i.d(e,"b2TimeStep",function(){return Ze}),i.d(e,"b2Position",function(){return He}),i.d(e,"b2Velocity",function(){return $e}),i.d(e,"b2SolverData",function(){return Ye}),i.d(e,"b2ContactManager",function(){return We}),i.d(e,"b2MixFriction",function(){return ve}),i.d(e,"b2MixRestitution",function(){return Me}),i.d(e,"b2ContactEdge",function(){return Pe}),i.d(e,"b2Contact",function(){return Ie}),i.d(e,"b2ContactRegister",function(){return ze}),i.d(e,"b2ContactFactory",function(){return je}),i.d(e,"b2VelocityConstraintPoint",function(){return Qe}),i.d(e,"b2ContactVelocityConstraint",function(){return Ke}),i.d(e,"b2ContactPositionConstraint",function(){return ti}),i.d(e,"b2ContactSolverDef",function(){return ei}),i.d(e,"b2PositionSolverManifold",function(){return ii}),i.d(e,"b2ContactSolver",function(){return si}),i.d(e,"b2CircleContact",function(){return Ge}),i.d(e,"b2PolygonContact",function(){return De}),i.d(e,"b2PolygonAndCircleContact",function(){return Fe}),i.d(e,"b2EdgeAndCircleContact",function(){return Re}),i.d(e,"b2EdgeAndPolygonContact",function(){return Le}),i.d(e,"b2ChainAndCircleContact",function(){return Te}),i.d(e,"b2ChainAndPolygonContact",function(){return ke}),i.d(e,"b2JointType",function(){return Ut}),i.d(e,"b2LimitState",function(){return Zt}),i.d(e,"b2Jacobian",function(){return Qt}),i.d(e,"b2JointEdge",function(){return Kt}),i.d(e,"b2JointDef",function(){return te}),i.d(e,"b2Joint",function(){return ee}),i.d(e,"b2JointFactory",function(){return we}),i.d(e,"b2AreaJointDef",function(){return ne}),i.d(e,"b2AreaJoint",function(){return oe}),i.d(e,"b2DistanceJointDef",function(){return ie}),i.d(e,"b2DistanceJoint",function(){return se}),i.d(e,"b2FrictionJointDef",function(){return re}),i.d(e,"b2FrictionJoint",function(){return ae}),i.d(e,"b2GearJointDef",function(){return le}),i.d(e,"b2GearJoint",function(){return me}),i.d(e,"b2MotorJointDef",function(){return he}),i.d(e,"b2MotorJoint",function(){return _e}),i.d(e,"b2MouseJointDef",function(){return ce}),i.d(e,"b2MouseJoint",function(){return ue}),i.d(e,"b2PrismaticJointDef",function(){return de}),i.d(e,"b2PrismaticJoint",function(){return fe}),i.d(e,"b2_minPulleyLength",function(){return 2}),i.d(e,"b2PulleyJointDef",function(){return pe}),i.d(e,"b2PulleyJoint",function(){return Ae}),i.d(e,"b2RevoluteJointDef",function(){return ye}),i.d(e,"b2RevoluteJoint",function(){return xe}),i.d(e,"b2RopeJointDef",function(){return Be}),i.d(e,"b2RopeJoint",function(){return Se}),i.d(e,"b2WeldJointDef",function(){return Ce}),i.d(e,"b2WeldJoint",function(){return be}),i.d(e,"b2WheelJointDef",function(){return ge}),i.d(e,"b2WheelJoint",function(){return Ve}),i.d(e,"b2ParticleFlag",function(){return oi}),i.d(e,"b2ParticleDef",function(){return ai}),i.d(e,"b2CalculateParticleIterations",function(){return li}),i.d(e,"b2ParticleHandle",function(){return mi}),i.d(e,"b2ParticleGroupFlag",function(){return ri}),i.d(e,"b2ParticleGroupDef",function(){return hi}),i.d(e,"b2ParticleGroup",function(){return _i}),i.d(e,"b2GrowableBuffer",function(){return Ci}),i.d(e,"b2FixtureParticleQueryCallback",function(){return bi}),i.d(e,"b2ParticleContact",function(){return gi}),i.d(e,"b2ParticleBodyContact",function(){return Vi}),i.d(e,"b2ParticlePair",function(){return wi}),i.d(e,"b2ParticleTriad",function(){return vi}),i.d(e,"b2ParticleSystemDef",function(){return Mi}),i.d(e,"b2ParticleSystem",function(){return Pi}),i.d(e,"b2RopeDef",function(){return Gi}),i.d(e,"b2Rope",function(){return Di})},375:function(t,e,i){"use strict";var s=i(355);i(332);function n(t,e,i){return i?t|e:t&~e}class o extends s.b2Draw{constructor(t){super(...arguments),this.m_ctx=t,this.axis_length=1,this.viewRotation=new s.b2Rot(Object(s.b2DegToRad)(0)),this.viewZoom=1,this.flag_drawShape=!0,this.flag_drawJoint=!0,this.flag_drawAabb=!1,this.flag_drawCenterOfMass=!0,this.flag_drawController=!0,this.flag_drawParticle=!0}get canvasScale(){return $gv.CANVAS_SCALE}set canvasScale(t){$gv.CANVAS_SCALE=t}get viewRect(){return $gv.m_viewRect}set flag_drawAll(t){this.m_drawFlags=t?s.b2DrawFlags.e_all:s.b2DrawFlags.e_none}set flag_drawShape(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_shapeBit,t)}set flag_drawJoint(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_jointBit,t)}set flag_drawAabb(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_aabbBit,t)}set flag_drawPair(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_pairBit,t)}set flag_drawCenterOfMass(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_centerOfMassBit,t)}set flag_drawParticle(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_particleBit,t)}set flag_drawController(t){this.m_drawFlags=n(this.m_drawFlags,s.b2DrawFlags.e_controllerBit,t)}get flag_drawAll(){this.m_drawFlags}get flag_drawShape(){return this.m_drawFlags&s.b2DrawFlags.e_shapeBit}get flag_drawJoint(){return this.m_drawFlags&s.b2DrawFlags.e_jointBit}get flag_drawAabb(){return this.m_drawFlags&s.b2DrawFlags.e_aabbBit}get flag_drawPair(){return this.m_drawFlags&s.b2DrawFlags.e_pairBit}get flag_drawCenterOfMass(){return this.m_drawFlags&s.b2DrawFlags.e_centerOfMassBit}get flag_drawParticle(){return this.m_drawFlags&s.b2DrawFlags.e_particleBit}get flag_drawController(){return this.m_drawFlags&s.b2DrawFlags.e_controllerBit}get flagNames(){return["flag_drawAll","flag_drawShape","flag_drawJoint","flag_drawAabb","flag_drawPair","flag_drawCenterOfMass","flag_drawParticle","flag_drawController"]}}o.prototype.PushTransform=function(t){let e=this.m_ctx;e.save(),e.transform(t.q.c,t.q.s,-t.q.s,t.q.c,t.p.x,t.p.y)},o.prototype.PopTransform=function(t){this.m_ctx.restore()},o.prototype.DrawPolygon=function(t,e,i){if(!e)return;let s=this.m_ctx;s.beginPath(),s.moveTo(t[0].x,t[0].y);for(let i=1;i<e;i++)s.lineTo(t[i].x,t[i].y);s.closePath(),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawSolidPolygon=function(t,e,i){if(!e)return;let s=this.m_ctx;s.beginPath(),s.moveTo(t[0].x,t[0].y);for(let i=1;i<e;i++)s.lineTo(t[i].x,t[i].y);s.closePath(),s.fillStyle=i.MakeStyleString(.5),s.fill(),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawCircle=function(t,e,i){if(!e)return;let n=this.m_ctx;n.beginPath(),n.arc(t.x,t.y,e,0,2*s.b2_pi,!0),n.strokeStyle=i.MakeStyleString(1),n.stroke()},o.prototype.DrawSolidCircle=function(t,e,i,n){if(!e)return;let o=this.m_ctx,r=t.x,a=t.y;o.beginPath(),o.arc(r,a,e,0,2*s.b2_pi,!0),o.moveTo(r,a),o.lineTo(r+i.x*e,a+i.y*e),o.fillStyle=n.MakeStyleString(.5),o.fill(),o.strokeStyle=n.MakeStyleString(1),o.stroke()},o.prototype.DrawParticles=function(t,e,i,s){const n=this.m_ctx;if(n)if(null!==i)for(let o=0;o<s;++o){let s=t[o],r=i[o];n.fillStyle=r.MakeStyleString(.5),n.fillRect(s.x-e,s.y-e,2*e,2*e)}else{n.fillStyle="rgba(255,255,255,0.5)",n.beginPath();for(let i=0;i<s;++i){let s=t[i];n.rect(s.x-e,s.y-e,2*e,2*e)}n.fill()}},o.prototype.DrawSegment=function(t,e,i){let s=this.m_ctx;s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.strokeStyle=i.MakeStyleString(1),s.stroke()},o.prototype.DrawTransform=function(t){if(0==this.axis_length)return;let e=this.canvasScale;if(!this.viewRect.collide4f2(t.p.x*e,t.p.y*e,this.axis_length*e,this.axis_length*e))return;let i=this.m_ctx;this.PushTransform(t),i.beginPath(),i.moveTo(0,0),i.lineTo(this.axis_length,0),i.strokeStyle=s.b2Color.RED.MakeStyleString(1),i.stroke(),i.beginPath(),i.moveTo(0,0),i.lineTo(0,this.axis_length),i.strokeStyle=s.b2Color.GREEN.MakeStyleString(1),i.stroke(),this.PopTransform(t)},o.prototype.DrawPoint=function(t,e,i){let s=this.m_ctx;s.fillStyle=i.MakeStyleString(),e/=this.viewZoom;let n=(e/=this.canvasScale)/2;s.fillRect(t.x-n,t.y-n,e,e)},o.prototype.DrawString=function(t,e,i,s){let n=this.m_ctx;const r=n.font;let a=Array.prototype.slice.call(arguments),l=goog.string.format.apply(null,a.slice(2));n.save(),n.setTransform(1,0,0,1,0,0),n.font="18pt helvetica";let m=o.prototype.DrawString.s_color;n.fillStyle=m.MakeStyleString(),n.fillText(l,t,e),n.restore(),n.font=r},o.prototype.DrawString.s_color=new s.b2Color(.9,.6,.6),o.prototype.DrawStringWorld=function(t,e,i,n){let r=o.prototype.DrawStringWorld.s_p.Set(t,e),a=this.viewCenter;s.b2Vec2.SubVV(r,a,r);let l=this.viewRotation;s.b2Rot.MulTRV(l,r,r);let m=this.viewZoom;s.b2Vec2.MulSV(m,r,r);let h=this.canvasScale;s.b2Vec2.MulSV(h,r,r),r.y*=-1;let _=o.prototype.DrawStringWorld.s_cc.Set(.5*this.m_canvas.width,.5*this.m_canvas.height);s.b2Vec2.AddVV(r,_,r);let c=this.m_ctx;const u=c.font;let d=Array.prototype.slice.call(arguments),f=goog.string.format.apply(null,d.slice(2));c.save(),c.setTransform(1,0,0,1,0,0),c.font="18pt helvetica";let p=o.prototype.DrawStringWorld.s_color;c.fillStyle=p.MakeStyleString(),c.fillText(f,r.x,r.y),c.restore(),c.font=u},o.prototype.DrawStringWorld.s_p=new s.b2Vec2,o.prototype.DrawStringWorld.s_cc=new s.b2Vec2,o.prototype.DrawStringWorld.s_color=new s.b2Color(.5,.9,.5),o.prototype.DrawAABB=function(t,e){let i=this.m_ctx;i.strokeStyle=e.MakeStyleString();let s=t.lowerBound.x,n=t.lowerBound.y,o=t.upperBound.x-t.lowerBound.x,r=t.upperBound.y-t.lowerBound.y;i.strokeRect(s,n,o,r)},e.a=o}}]);
//# sourceMappingURL=4.js.map