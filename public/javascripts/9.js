(window["webpackJsonp"] = window["webpackJsonp"] || []).push([[9],{

/***/ "./src/Client/PMovePath.js":
/*!*********************************!*\
  !*** ./src/Client/PMovePath.js ***!
  \*********************************/
/*! exports provided: BaseMoveElem, CharacterMoveElem, MobMoveElem */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BaseMoveElem\", function() { return BaseMoveElem; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CharacterMoveElem\", function() { return CharacterMoveElem; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobMoveElem\", function() { return MobMoveElem; });\n/* harmony import */ var _game_Physics_PPlayer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../game/Physics/PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n﻿\r\n//debug\r\n\r\n\r\nclass BaseMoveElem {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.x = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.y = null;\r\n\r\n\t\t/** @type {number} - linear velocity x */\r\n\t\tthis.vx = undefined;\r\n\r\n\t\t/** @type {number} - linear velocity y */\r\n\t\tthis.vy = undefined;\r\n\r\n\t\t/** @type {number} - force x */\r\n\t\tthis.fx = undefined;\r\n\r\n\t\t/** @type {number} - force y */\r\n\t\tthis.fy = undefined;\r\n\r\n\t\t/** @type {PPlayerState} - player physics state */\r\n\t\tthis.pState = null;\r\n\r\n\t\t/** @type {number} - time elapsed */\r\n\t\tthis.elapsed = 0;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.isAwake = undefined;// value = ?\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.action = undefined;\r\n\t\t/** @type {number} */\r\n\t\tthis.action_frame = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.emotion = undefined;\r\n\t\t/** @type {number} */\r\n\t\tthis.emotion_frame = undefined;\r\n\t}\r\n}\r\n\r\nclass CharacterMoveElem extends BaseMoveElem {\r\n}\r\n\r\nclass MobMoveElem extends BaseMoveElem {\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ2xpZW50L1BNb3ZlUGF0aC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9DbGllbnQvUE1vdmVQYXRoLmpzPzEwZDkiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IFBQbGF5ZXJTdGF0ZSB9IGZyb20gXCIuLi9nYW1lL1BoeXNpY3MvUFBsYXllci5qc1wiOy8vZGVidWdcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgQmFzZU1vdmVFbGVtIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy54ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMueSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gbGluZWFyIHZlbG9jaXR5IHggKi9cclxuXHRcdHRoaXMudnggPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gbGluZWFyIHZlbG9jaXR5IHkgKi9cclxuXHRcdHRoaXMudnkgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gZm9yY2UgeCAqL1xyXG5cdFx0dGhpcy5meCA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBmb3JjZSB5ICovXHJcblx0XHR0aGlzLmZ5ID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7UFBsYXllclN0YXRlfSAtIHBsYXllciBwaHlzaWNzIHN0YXRlICovXHJcblx0XHR0aGlzLnBTdGF0ZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gdGltZSBlbGFwc2VkICovXHJcblx0XHR0aGlzLmVsYXBzZWQgPSAwO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLmlzQXdha2UgPSB1bmRlZmluZWQ7Ly8gdmFsdWUgPSA/XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmFjdGlvbiA9IHVuZGVmaW5lZDtcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb25fZnJhbWUgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmVtb3Rpb24gPSB1bmRlZmluZWQ7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZW1vdGlvbl9mcmFtZSA9IHVuZGVmaW5lZDtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDaGFyYWN0ZXJNb3ZlRWxlbSBleHRlbmRzIEJhc2VNb3ZlRWxlbSB7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNb2JNb3ZlRWxlbSBleHRlbmRzIEJhc2VNb3ZlRWxlbSB7XHJcbn1cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/Client/PMovePath.js\n");

/***/ }),

/***/ "./src/Common/AttackInfo.js":
/*!**********************************!*\
  !*** ./src/Common/AttackInfo.js ***!
  \**********************************/
/*! exports provided: AttackInfo, AttackPair, DamagePair */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AttackInfo\", function() { return AttackInfo; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"AttackPair\", function() { return AttackPair; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DamagePair\", function() { return DamagePair; });\n/* harmony import */ var _game_Skill_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../game/Skill.js */ \"./src/game/Skill.js\");\n/* harmony import */ var _game_SceneObject_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../game/SceneObject.js */ \"./src/game/SceneObject.js\");\n﻿\r\n\r\n//?? ref\r\n\r\n\r\nclass AttackInfo {\r\n\tconstructor() {\r\n\t\t/** @type {AttackPair[]} - { objectid, attack }[each monster] */\r\n\t\tthis.allAttack = [];\r\n\t\t\r\n\t\t//TODO: make this JSON\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.skillId = null;\r\n\t}\r\n\t\r\n\t///** returns {AttackInfo} */\r\n\t//clone() {\r\n\t//\tlet ai = new AttackInfo();\r\n\t//\t//ai.allAttack = this.allAttack.slice();//??\r\n\t//\tai.skill = this.skill;\r\n\t//\treturn ai;\r\n\t//}\r\n\t\r\n\t///**\r\n\t// * @param {number} objectid\r\n\t// * @returns {AttackPair}\r\n\t// */\r\n\t//addAttack(objectid) {\r\n\t//\tlet attack = new AttackPair();\r\n\t//\tattack.objectid = objectid;\r\n\t//\tthis.allAttack.push(attack);\r\n\t//}\r\n\t\r\n\t/**\r\n\t * return current attack and set new instance\r\n\t * @returns {AttackPair[]} - { objectid, attack }[each monster]\r\n\t */\r\n\tshiftAllAttack() {\r\n\t\tlet allAttack = this.allAttack;\r\n\t\tthis.allAttack = [];\r\n\t\treturn allAttack;\r\n\t}\r\n}\r\n\r\nconst symbol_targetObject = Symbol(\"targetObject\");\r\n\r\nclass AttackPair {\r\n\tconstructor() {\r\n\t\t/** @type {SceneObject} */\r\n\t\tthis[symbol_targetObject] = null;\r\n\r\n\t\t///** @type {number} */\r\n\t\t//this.objectid = null;\r\n\r\n\t\t/** @type {DamagePair[]} - { realDamage, critical }[attackCount] */\r\n\t\tthis.allDamage = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {SceneObject}\r\n\t */\r\n\tgetTargetObject() {\r\n\t\treturn this[symbol_targetObject];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {SceneObject} targetObject\r\n\t */\r\n\tsetTargetObject(targetObject) {\r\n\t\tthis[symbol_targetObject] = targetObject;\r\n\t}\r\n\r\n\t/**\r\n\t * targetObject # $objectid\r\n\t * @returns {number}\r\n\t */\r\n\tget objectid() {\r\n\t\t/** @type {SceneObject} */\r\n\t\tlet obj = this[symbol_targetObject];\r\n\t\treturn obj.$objectid;\r\n\t}\r\n\t/**\r\n\t * set targetObject by objectid\r\n\t * @param {number} objectid\r\n\t */\r\n\tset objectid(objectid) {\r\n\t\tif (Number.isSafeInteger(objectid)) {\r\n\t\t\t/** @type {SceneObject} */\r\n\t\t\tlet obj = scene_map.lifeMgr.entities[objectid];\r\n\r\n\t\t\tthis.setTargetObject(obj);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//TODO: targetObject is player's character\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} realDamage\r\n\t * @param {boolean} critical\r\n\t * @returns {DamagePair}\r\n\t */\r\n\taddDamage(realDamage, critical) {\r\n\t\tthis.allDamage.push(new DamagePair(realDamage, critical));\r\n\t}\r\n}\r\n\r\nclass DamagePair {\r\n\t/**\r\n\t * @param {number} realDamage\r\n\t * @param {boolean} critical\r\n\t */\r\n\tconstructor(realDamage, critical) {\r\n\t\t/** @type {number} */\r\n\t\tthis.realDamage = realDamage;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.critical = critical;\r\n\t}\r\n\r\n\t_validating() {\r\n\t\treturn Number.isSafeInteger(this.realDamage);\r\n\t}\r\n\r\n\t/** @param {IRenderer} */\r\n\t_draw(renderer) {\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = renderer.ctx;\r\n\t\tif (Number.isSafeInteger(this.realDamage)) {\r\n\t\t\t//draw\r\n\t\t}\r\n\t\telse {// debug, invalid damage\r\n\t\t\tctx.filter = \"gray-scale(1)\";\r\n\t\t\t//draw\r\n\t\t\tctx.filter = \"none\";\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL0F0dGFja0luZm8uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQ29tbW9uL0F0dGFja0luZm8uanM/MmE4MCJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgU2tpbGxBbmltYXRpb24gfSBmcm9tIFwiLi4vZ2FtZS9Ta2lsbC5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZU9iamVjdCB9IGZyb20gXCIuLi9nYW1lL1NjZW5lT2JqZWN0LmpzXCI7Ly8/PyByZWZcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgQXR0YWNrSW5mbyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge0F0dGFja1BhaXJbXX0gLSB7IG9iamVjdGlkLCBhdHRhY2sgfVtlYWNoIG1vbnN0ZXJdICovXHJcblx0XHR0aGlzLmFsbEF0dGFjayA9IFtdO1xyXG5cdFx0XHJcblx0XHQvL1RPRE86IG1ha2UgdGhpcyBKU09OXHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5za2lsbElkID0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0Ly8vKiogcmV0dXJucyB7QXR0YWNrSW5mb30gKi9cclxuXHQvL2Nsb25lKCkge1xyXG5cdC8vXHRsZXQgYWkgPSBuZXcgQXR0YWNrSW5mbygpO1xyXG5cdC8vXHQvL2FpLmFsbEF0dGFjayA9IHRoaXMuYWxsQXR0YWNrLnNsaWNlKCk7Ly8/P1xyXG5cdC8vXHRhaS5za2lsbCA9IHRoaXMuc2tpbGw7XHJcblx0Ly9cdHJldHVybiBhaTtcclxuXHQvL31cclxuXHRcclxuXHQvLy8qKlxyXG5cdC8vICogQHBhcmFtIHtudW1iZXJ9IG9iamVjdGlkXHJcblx0Ly8gKiBAcmV0dXJucyB7QXR0YWNrUGFpcn1cclxuXHQvLyAqL1xyXG5cdC8vYWRkQXR0YWNrKG9iamVjdGlkKSB7XHJcblx0Ly9cdGxldCBhdHRhY2sgPSBuZXcgQXR0YWNrUGFpcigpO1xyXG5cdC8vXHRhdHRhY2sub2JqZWN0aWQgPSBvYmplY3RpZDtcclxuXHQvL1x0dGhpcy5hbGxBdHRhY2sucHVzaChhdHRhY2spO1xyXG5cdC8vfVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIHJldHVybiBjdXJyZW50IGF0dGFjayBhbmQgc2V0IG5ldyBpbnN0YW5jZVxyXG5cdCAqIEByZXR1cm5zIHtBdHRhY2tQYWlyW119IC0geyBvYmplY3RpZCwgYXR0YWNrIH1bZWFjaCBtb25zdGVyXVxyXG5cdCAqL1xyXG5cdHNoaWZ0QWxsQXR0YWNrKCkge1xyXG5cdFx0bGV0IGFsbEF0dGFjayA9IHRoaXMuYWxsQXR0YWNrO1xyXG5cdFx0dGhpcy5hbGxBdHRhY2sgPSBbXTtcclxuXHRcdHJldHVybiBhbGxBdHRhY2s7XHJcblx0fVxyXG59XHJcblxyXG5jb25zdCBzeW1ib2xfdGFyZ2V0T2JqZWN0ID0gU3ltYm9sKFwidGFyZ2V0T2JqZWN0XCIpO1xyXG5cclxuZXhwb3J0IGNsYXNzIEF0dGFja1BhaXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtTY2VuZU9iamVjdH0gKi9cclxuXHRcdHRoaXNbc3ltYm9sX3RhcmdldE9iamVjdF0gPSBudWxsO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHQvL3RoaXMub2JqZWN0aWQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7RGFtYWdlUGFpcltdfSAtIHsgcmVhbERhbWFnZSwgY3JpdGljYWwgfVthdHRhY2tDb3VudF0gKi9cclxuXHRcdHRoaXMuYWxsRGFtYWdlID0gW107XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7U2NlbmVPYmplY3R9XHJcblx0ICovXHJcblx0Z2V0VGFyZ2V0T2JqZWN0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXNbc3ltYm9sX3RhcmdldE9iamVjdF07XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1NjZW5lT2JqZWN0fSB0YXJnZXRPYmplY3RcclxuXHQgKi9cclxuXHRzZXRUYXJnZXRPYmplY3QodGFyZ2V0T2JqZWN0KSB7XHJcblx0XHR0aGlzW3N5bWJvbF90YXJnZXRPYmplY3RdID0gdGFyZ2V0T2JqZWN0O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogdGFyZ2V0T2JqZWN0ICMgJG9iamVjdGlkXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRnZXQgb2JqZWN0aWQoKSB7XHJcblx0XHQvKiogQHR5cGUge1NjZW5lT2JqZWN0fSAqL1xyXG5cdFx0bGV0IG9iaiA9IHRoaXNbc3ltYm9sX3RhcmdldE9iamVjdF07XHJcblx0XHRyZXR1cm4gb2JqLiRvYmplY3RpZDtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogc2V0IHRhcmdldE9iamVjdCBieSBvYmplY3RpZFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBvYmplY3RpZFxyXG5cdCAqL1xyXG5cdHNldCBvYmplY3RpZChvYmplY3RpZCkge1xyXG5cdFx0aWYgKE51bWJlci5pc1NhZmVJbnRlZ2VyKG9iamVjdGlkKSkge1xyXG5cdFx0XHQvKiogQHR5cGUge1NjZW5lT2JqZWN0fSAqL1xyXG5cdFx0XHRsZXQgb2JqID0gc2NlbmVfbWFwLmxpZmVNZ3IuZW50aXRpZXNbb2JqZWN0aWRdO1xyXG5cclxuXHRcdFx0dGhpcy5zZXRUYXJnZXRPYmplY3Qob2JqKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHQvL1RPRE86IHRhcmdldE9iamVjdCBpcyBwbGF5ZXIncyBjaGFyYWN0ZXJcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSByZWFsRGFtYWdlXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBjcml0aWNhbFxyXG5cdCAqIEByZXR1cm5zIHtEYW1hZ2VQYWlyfVxyXG5cdCAqL1xyXG5cdGFkZERhbWFnZShyZWFsRGFtYWdlLCBjcml0aWNhbCkge1xyXG5cdFx0dGhpcy5hbGxEYW1hZ2UucHVzaChuZXcgRGFtYWdlUGFpcihyZWFsRGFtYWdlLCBjcml0aWNhbCkpO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIERhbWFnZVBhaXIge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSByZWFsRGFtYWdlXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBjcml0aWNhbFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHJlYWxEYW1hZ2UsIGNyaXRpY2FsKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMucmVhbERhbWFnZSA9IHJlYWxEYW1hZ2U7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5jcml0aWNhbCA9IGNyaXRpY2FsO1xyXG5cdH1cclxuXHJcblx0X3ZhbGlkYXRpbmcoKSB7XHJcblx0XHRyZXR1cm4gTnVtYmVyLmlzU2FmZUludGVnZXIodGhpcy5yZWFsRGFtYWdlKTtcclxuXHR9XHJcblxyXG5cdC8qKiBAcGFyYW0ge0lSZW5kZXJlcn0gKi9cclxuXHRfZHJhdyhyZW5kZXJlcikge1xyXG5cdFx0LyoqIEB0eXBlIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9ICovXHJcblx0XHRjb25zdCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHRpZiAoTnVtYmVyLmlzU2FmZUludGVnZXIodGhpcy5yZWFsRGFtYWdlKSkge1xyXG5cdFx0XHQvL2RyYXdcclxuXHRcdH1cclxuXHRcdGVsc2Ugey8vIGRlYnVnLCBpbnZhbGlkIGRhbWFnZVxyXG5cdFx0XHRjdHguZmlsdGVyID0gXCJncmF5LXNjYWxlKDEpXCI7XHJcblx0XHRcdC8vZHJhd1xyXG5cdFx0XHRjdHguZmlsdGVyID0gXCJub25lXCI7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/Common/AttackInfo.js\n");

/***/ }),

/***/ "./src/Common/Packet/CharacterPacket.js":
/*!**********************************************!*\
  !*** ./src/Common/Packet/CharacterPacket.js ***!
  \**********************************************/
/*! exports provided: $Packet_CharacterMove */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"$Packet_CharacterMove\", function() { return $Packet_CharacterMove; });\n/* harmony import */ var _Client_PMovePath__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../Client/PMovePath */ \"./src/Client/PMovePath.js\");\n﻿\r\n\r\n\r\n/**\r\n * @type {{[x:string]:string}[]}\r\n */\r\nconst keyboard_map = [{\r\n\tArrowUp: \"up\",\r\n\tArrowLeft: \"left\",\r\n\tArrowDown: \"down\",\r\n\tArrowRight: \"right\",\r\n\tz: \"jump\",\r\n\tx: \"skill_1\",\r\n\tc: \"skill_2\",\r\n\tv: \"skill_3\",\r\n},\r\n{\r\n\tw: \"up\",\r\n\ta: \"left\",\r\n\ts: \"down\",\r\n\td: \"right\",\r\n\tq: \"jump\",\r\n\tx: \"skill_1\",\r\n\tc: \"skill_2\",\r\n\tv: \"skill_3\",\r\n}];\r\n\r\nclass $Packet_CharacterMove {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis.id = undefined;\r\n\r\n\t\t/** @type {CharacterMoveElem[]} */\r\n\t\tthis.path = [];\r\n\r\n\t\t/** @type {number} - time stamp */\r\n\t\tthis.stamp = (new Date().getTime());\r\n\t}\r\n\tcapture(chara) {\r\n\t\tconst phy = chara.$physics;\r\n\t\tconst body = phy.body;\r\n\t\tlet elem = new _Client_PMovePath__WEBPACK_IMPORTED_MODULE_0__[\"CharacterMoveElem\"]();\r\n\r\n\t\t{\r\n\t\t\tconst crr = chara.renderer;\r\n\r\n\t\t\telem.action = crr.action;\r\n\t\t\t//elem.action_frame = crr.action_frame;\r\n\t\t\telem.emotion = crr.emotion;\r\n\t\t\t//elem.emotion_frame = crr.emotion_frame;\r\n\t\t}\r\n\r\n\t\telem.isAwake = body.IsAwake();\r\n\t\tif (elem.isAwake) {\r\n\r\n\t\t\tlet pos = phy.getPosition();\r\n\t\t\tlet vel = body.GetLinearVelocity();\r\n\r\n\t\t\telem.x = pos.x;\r\n\t\t\telem.y = pos.y;\r\n\t\t\telem.vx = vel.x;\r\n\t\t\telem.vy = vel.y;\r\n\t\t\t//elem.fx = force.x;\r\n\t\t\t//elem.fy = force.y;\r\n\r\n\t\t\telem.pState = phy.state;\r\n\r\n\t\t\telem.elapsed = (new Date().getTime()) - this.stamp;\r\n\t\t}\r\n\r\n\t\tthis.path.push(elem);\r\n\t}\r\n}\r\n\r\nclass $CharacterMoveItemElem {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.from = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.to = null;\r\n\r\n\t\t/** @type {string} - equip id */\r\n\t\tthis.item = null;\r\n\t}\r\n}\r\nclass $Packet_CharacterMoveItem {\r\n\tconstructor() {\r\n\t\t/** @type {$CharacterMoveItemElem} */\r\n\t\tthis.elem = [];\r\n\t}\r\n}\r\n\r\nclass $Packet_CharacterSkill {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis.skillId = null;\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL1BhY2tldC9DaGFyYWN0ZXJQYWNrZXQuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQ29tbW9uL1BhY2tldC9DaGFyYWN0ZXJQYWNrZXQuanM/YmE3NCJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgQ2hhcmFjdGVyTW92ZUVsZW0gfSBmcm9tIFwiLi4vLi4vQ2xpZW50L1BNb3ZlUGF0aFwiO1xyXG5cclxuLyoqXHJcbiAqIEB0eXBlIHt7W3g6c3RyaW5nXTpzdHJpbmd9W119XHJcbiAqL1xyXG5jb25zdCBrZXlib2FyZF9tYXAgPSBbe1xyXG5cdEFycm93VXA6IFwidXBcIixcclxuXHRBcnJvd0xlZnQ6IFwibGVmdFwiLFxyXG5cdEFycm93RG93bjogXCJkb3duXCIsXHJcblx0QXJyb3dSaWdodDogXCJyaWdodFwiLFxyXG5cdHo6IFwianVtcFwiLFxyXG5cdHg6IFwic2tpbGxfMVwiLFxyXG5cdGM6IFwic2tpbGxfMlwiLFxyXG5cdHY6IFwic2tpbGxfM1wiLFxyXG59LFxyXG57XHJcblx0dzogXCJ1cFwiLFxyXG5cdGE6IFwibGVmdFwiLFxyXG5cdHM6IFwiZG93blwiLFxyXG5cdGQ6IFwicmlnaHRcIixcclxuXHRxOiBcImp1bXBcIixcclxuXHR4OiBcInNraWxsXzFcIixcclxuXHRjOiBcInNraWxsXzJcIixcclxuXHR2OiBcInNraWxsXzNcIixcclxufV07XHJcblxyXG5leHBvcnQgY2xhc3MgJFBhY2tldF9DaGFyYWN0ZXJNb3ZlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5pZCA9IHVuZGVmaW5lZDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3Rlck1vdmVFbGVtW119ICovXHJcblx0XHR0aGlzLnBhdGggPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSB0aW1lIHN0YW1wICovXHJcblx0XHR0aGlzLnN0YW1wID0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpKTtcclxuXHR9XHJcblx0Y2FwdHVyZShjaGFyYSkge1xyXG5cdFx0Y29uc3QgcGh5ID0gY2hhcmEuJHBoeXNpY3M7XHJcblx0XHRjb25zdCBib2R5ID0gcGh5LmJvZHk7XHJcblx0XHRsZXQgZWxlbSA9IG5ldyBDaGFyYWN0ZXJNb3ZlRWxlbSgpO1xyXG5cclxuXHRcdHtcclxuXHRcdFx0Y29uc3QgY3JyID0gY2hhcmEucmVuZGVyZXI7XHJcblxyXG5cdFx0XHRlbGVtLmFjdGlvbiA9IGNyci5hY3Rpb247XHJcblx0XHRcdC8vZWxlbS5hY3Rpb25fZnJhbWUgPSBjcnIuYWN0aW9uX2ZyYW1lO1xyXG5cdFx0XHRlbGVtLmVtb3Rpb24gPSBjcnIuZW1vdGlvbjtcclxuXHRcdFx0Ly9lbGVtLmVtb3Rpb25fZnJhbWUgPSBjcnIuZW1vdGlvbl9mcmFtZTtcclxuXHRcdH1cclxuXHJcblx0XHRlbGVtLmlzQXdha2UgPSBib2R5LklzQXdha2UoKTtcclxuXHRcdGlmIChlbGVtLmlzQXdha2UpIHtcclxuXHJcblx0XHRcdGxldCBwb3MgPSBwaHkuZ2V0UG9zaXRpb24oKTtcclxuXHRcdFx0bGV0IHZlbCA9IGJvZHkuR2V0TGluZWFyVmVsb2NpdHkoKTtcclxuXHJcblx0XHRcdGVsZW0ueCA9IHBvcy54O1xyXG5cdFx0XHRlbGVtLnkgPSBwb3MueTtcclxuXHRcdFx0ZWxlbS52eCA9IHZlbC54O1xyXG5cdFx0XHRlbGVtLnZ5ID0gdmVsLnk7XHJcblx0XHRcdC8vZWxlbS5meCA9IGZvcmNlLng7XHJcblx0XHRcdC8vZWxlbS5meSA9IGZvcmNlLnk7XHJcblxyXG5cdFx0XHRlbGVtLnBTdGF0ZSA9IHBoeS5zdGF0ZTtcclxuXHJcblx0XHRcdGVsZW0uZWxhcHNlZCA9IChuZXcgRGF0ZSgpLmdldFRpbWUoKSkgLSB0aGlzLnN0YW1wO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMucGF0aC5wdXNoKGVsZW0pO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgJENoYXJhY3Rlck1vdmVJdGVtRWxlbSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZnJvbSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLnRvID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBlcXVpcCBpZCAqL1xyXG5cdFx0dGhpcy5pdGVtID0gbnVsbDtcclxuXHR9XHJcbn1cclxuY2xhc3MgJFBhY2tldF9DaGFyYWN0ZXJNb3ZlSXRlbSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUgeyRDaGFyYWN0ZXJNb3ZlSXRlbUVsZW19ICovXHJcblx0XHR0aGlzLmVsZW0gPSBbXTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzICRQYWNrZXRfQ2hhcmFjdGVyU2tpbGwge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLnNraWxsSWQgPSBudWxsO1xyXG5cdH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/Common/Packet/CharacterPacket.js\n");

/***/ }),

/***/ "./src/Common/Packet/ChatPacket.js":
/*!*****************************************!*\
  !*** ./src/Common/Packet/ChatPacket.js ***!
  \*****************************************/
/*! exports provided: $Packet_CharacterChat */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"$Packet_CharacterChat\", function() { return $Packet_CharacterChat; });\n﻿\r\n\r\nclass $Packet_CharacterChat {\r\n\tconstructor() {\r\n\t\t/** @type {number} - chat type */\r\n\t\tthis.type = null;\r\n\r\n\t\t/** @type {number} - ChatBalloon style */\r\n\t\tthis.$style = null;\r\n\r\n\t\t/** @type {string} - chat text */\r\n\t\tthis.text = null;\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL1BhY2tldC9DaGF0UGFja2V0LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL0NvbW1vbi9QYWNrZXQvQ2hhdFBhY2tldC5qcz8wYjFiIl0sInNvdXJjZXNDb250ZW50IjpbIu+7v1xyXG5cclxuZXhwb3J0IGNsYXNzICRQYWNrZXRfQ2hhcmFjdGVyQ2hhdCB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBjaGF0IHR5cGUgKi9cclxuXHRcdHRoaXMudHlwZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gQ2hhdEJhbGxvb24gc3R5bGUgKi9cclxuXHRcdHRoaXMuJHN0eWxlID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBjaGF0IHRleHQgKi9cclxuXHRcdHRoaXMudGV4dCA9IG51bGw7XHJcblx0fVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/Common/Packet/ChatPacket.js\n");

/***/ }),

/***/ "./src/Common/Packet/LoginPacket.js":
/*!******************************************!*\
  !*** ./src/Common/Packet/LoginPacket.js ***!
  \******************************************/
/*! exports provided: $RequestPacket_SelectChara, $ResponsePacket_SelectChara */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"$RequestPacket_SelectChara\", function() { return $RequestPacket_SelectChara; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"$ResponsePacket_SelectChara\", function() { return $ResponsePacket_SelectChara; });\n/* harmony import */ var _Common_PlayerData__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../Common/PlayerData */ \"./src/Common/PlayerData.js\");\n/* harmony import */ var _Common_PlayerData__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Common_PlayerData__WEBPACK_IMPORTED_MODULE_0__);\n﻿\r\n\r\n\r\nclass $RequestPacket_SelectChara {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis.charaId = undefined;\r\n\t}\r\n}\r\nclass $ResponsePacket_SelectChara {\r\n\tconstructor() {\r\n\t\t/** @type {$PlayerData} */\r\n\t\tthis.charaData = null;\r\n\r\n\t\t/** @type {$RemotePlayerData[]} */\r\n\t\tthis.remoteCharacters = null;\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL1BhY2tldC9Mb2dpblBhY2tldC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9Db21tb24vUGFja2V0L0xvZ2luUGFja2V0LmpzPzk3YjYiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IENoYXJhY3RlclN0YXQsICRSZW1vdGVQbGF5ZXJEYXRhLCAkUGxheWVyRGF0YSB9IGZyb20gXCIuLi8uLi9Db21tb24vUGxheWVyRGF0YVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzICRSZXF1ZXN0UGFja2V0X1NlbGVjdENoYXJhIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5jaGFyYUlkID0gdW5kZWZpbmVkO1xyXG5cdH1cclxufVxyXG5leHBvcnQgY2xhc3MgJFJlc3BvbnNlUGFja2V0X1NlbGVjdENoYXJhIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7JFBsYXllckRhdGF9ICovXHJcblx0XHR0aGlzLmNoYXJhRGF0YSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHskUmVtb3RlUGxheWVyRGF0YVtdfSAqL1xyXG5cdFx0dGhpcy5yZW1vdGVDaGFyYWN0ZXJzID0gbnVsbDtcclxuXHR9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/Common/Packet/LoginPacket.js\n");

/***/ }),

/***/ "./src/Common/Packet/index.js":
/*!************************************!*\
  !*** ./src/Common/Packet/index.js ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("﻿\r\nlet LoginPacket = __webpack_require__(/*! ./LoginPacket.js */ \"./src/Common/Packet/LoginPacket.js\");\r\nlet ChatPacket = __webpack_require__(/*! ./ChatPacket.js */ \"./src/Common/Packet/ChatPacket.js\");\r\nlet CharacterPacket = __webpack_require__(/*! ./CharacterPacket.js */ \"./src/Common/Packet/CharacterPacket.js\");\r\n\r\nlet ex = Object.assign({},\r\n\tLoginPacket,\r\n\tChatPacket,\r\n\tCharacterPacket\r\n);\r\n\r\nmodule.exports = ex;\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL1BhY2tldC9pbmRleC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9Db21tb24vUGFja2V0L2luZGV4LmpzPzk1OWQiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmxldCBMb2dpblBhY2tldCA9IHJlcXVpcmUoXCIuL0xvZ2luUGFja2V0LmpzXCIpO1xyXG5sZXQgQ2hhdFBhY2tldCA9IHJlcXVpcmUoXCIuL0NoYXRQYWNrZXQuanNcIik7XHJcbmxldCBDaGFyYWN0ZXJQYWNrZXQgPSByZXF1aXJlKFwiLi9DaGFyYWN0ZXJQYWNrZXQuanNcIik7XHJcblxyXG5sZXQgZXggPSBPYmplY3QuYXNzaWduKHt9LFxyXG5cdExvZ2luUGFja2V0LFxyXG5cdENoYXRQYWNrZXQsXHJcblx0Q2hhcmFjdGVyUGFja2V0XHJcbik7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IGV4O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/Common/Packet/index.js\n");

/***/ }),

/***/ "./src/Common/PlayerData.js":
/*!**********************************!*\
  !*** ./src/Common/PlayerData.js ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("﻿\r\nclass CharacterBaseStat {\r\n\tconstructor() {\r\n\t\tthis.hp = 8855;\r\n\t\tthis.mp = 5246;\r\n\t\tthis.mhp = 28855;\r\n\t\tthis.mmp = 25246;\r\n\t\tthis.exp = 55;\r\n\r\n\t\tthis.str = 123;\r\n\t\tthis.luk = 4;\r\n\t\tthis.dex = 999;\r\n\t\tthis.int = 4;\r\n\t}\r\n}\r\n\r\nclass CharacterTemporaryStat {\r\n}\r\n\r\nconst symbol_job = Symbol(\"job\");\r\nconst symbol_onJobChange = Symbol(\"onJobChange\");\r\n\r\nclass CharacterStat extends CharacterBaseStat {\r\n\tconstructor(sceneChara) {\r\n\t\tsuper();\r\n\r\n\t\tthis._$sceneChara = sceneChara;\r\n\r\n\t\tthis.level = 150;\r\n\r\n\t\t//this._job = 3;\r\n\t\t//this._spec_job = 3;\r\n\r\n\t\t///** @type {number} - 最大屬性攻擊 */\r\n\t\t//this.currentMaxBaseDamage = 10000;\r\n\r\n\t\t///** @type {number} - 最小屬性攻擊 */\r\n\t\t//this.currentMinBaseDamage = 1000;\r\n\r\n\t\t/** @type {number} - 爆擊率 0~100 */\r\n\t\tthis.critRate = 50;\r\n\r\n\t\t/** @type {number} - 爆擊傷害 0~100 */\r\n\t\tthis.critDamage = 80;\r\n\r\n\t\t///** @type {number} - 最大爆擊傷害 0~100 */\r\n\t\t//this.maxCritDamage = 80;\r\n\r\n\t\t///** @type {number} - 最小爆擊傷害 0~100 */\r\n\t\t//this.minCritDamage = 40;\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget job() {\r\n\t\treturn this[symbolStatJob];\r\n\t}\r\n\tset job(value) {\r\n\t\tthis[symbolStatJob] = value;\r\n\r\n\t\tconst onJobChange = this[symbol_onJobChange];\r\n\r\n\t\tif (_onJobChange) {\r\n\t\t\t_onJobChange()\r\n\t\t}\r\n\t}\r\n\r\n\t/** @param {function():void} cbfunc */\r\n\tonJobChange(cbfunc) {\r\n\t\tthis[symbol_onJobChange] = cbfunc;\r\n\t}\r\n\r\n\t_getTotalAttack() {\r\n\t\treturn 100;\r\n\t}\r\n\r\n\t/** @returns {number} - 最大屬性攻擊 */\r\n\tgetCurrentMaxBaseDamage() {\r\n\t\t//return this.currentMaxBaseDamage;\r\n\t\treturn 1.30 * (4 * this.dex + this.str) * (this._getTotalAttack() / 100);\r\n\t}\r\n\t/** @returns {number} - 最小屬性攻擊 */\r\n\tgetCurrentMinBaseDamage() {\r\n\t\t//return this.currentMinBaseDamage;\r\n\t\treturn 1.30 * (this.dex + this.str) * (this._getTotalAttack() / 100);\r\n\t}\r\n\t/** @returns {number} - 爆擊率 0~100 */\r\n\tgetCritRate() {\r\n\t\treturn this.critRate;\r\n\t}\r\n\t/** @returns {number} - 爆擊傷害 0~100 */\r\n\tgetCritDamage() {\r\n\t\treturn this.critDamage;\r\n\t}\r\n\t///** @returns {number} - 最大爆擊傷害 0~100 */\r\n\t//getMaxCritDamage() {\r\n\t//\treturn this._$maxCritDamage;\r\n\t//}\r\n\t///** @returns {number} - 最小爆擊傷害 0~100 */\r\n\t//getMinCritDamage() {\r\n\t//\treturn this._$minCritDamage;\r\n\t//}\r\n\r\n\tgetHpPercentS() {\r\n\t\treturn (this.hp * 100 / this.mhp).toFixed(0);\r\n\t}\r\n\tgetMpPercentS() {\r\n\t\treturn (this.mp * 100 / this.mmp).toFixed(0);\r\n\t}\r\n\tgetExpPercentS() {\r\n\t\treturn (this.exp * 100 / this.getNextExp()).toFixed(2);\r\n\t}\r\n\tgetNextExp() {\r\n\t\treturn 100;\r\n\t}\r\n}\r\n\r\n//?? packet\r\nclass $RemotePlayerData {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis.id = undefined;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.equips_code = null;\r\n\t\t\r\n\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis.chatBalloonStyle = 0;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.labelStyle = 0;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.damageSkin = \"default\";\r\n\t}\r\n}\r\n//?? packet\r\nclass $PlayerData extends $RemotePlayerData {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t/** @type {CharacterStat} */\r\n\t\tthis.stat = undefined;\r\n\t}\r\n\r\n\tgetRemoteData() {\r\n\t\treturn {\r\n\t\t\tid: this.id,\r\n\t\t\tmapId: this.mapId,\r\n\t\t\tequips_code: this.equips_code,\r\n\t\t};\r\n\t}\r\n}\r\n\r\nmodule.exports = {\r\n\tCharacterStat,\r\n\t$RemotePlayerData, $PlayerData,\r\n};\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvQ29tbW9uL1BsYXllckRhdGEuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvQ29tbW9uL1BsYXllckRhdGEuanM/Mjg4ZCJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuY2xhc3MgQ2hhcmFjdGVyQmFzZVN0YXQge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5ocCA9IDg4NTU7XHJcblx0XHR0aGlzLm1wID0gNTI0NjtcclxuXHRcdHRoaXMubWhwID0gMjg4NTU7XHJcblx0XHR0aGlzLm1tcCA9IDI1MjQ2O1xyXG5cdFx0dGhpcy5leHAgPSA1NTtcclxuXHJcblx0XHR0aGlzLnN0ciA9IDEyMztcclxuXHRcdHRoaXMubHVrID0gNDtcclxuXHRcdHRoaXMuZGV4ID0gOTk5O1xyXG5cdFx0dGhpcy5pbnQgPSA0O1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgQ2hhcmFjdGVyVGVtcG9yYXJ5U3RhdCB7XHJcbn1cclxuXHJcbmNvbnN0IHN5bWJvbF9qb2IgPSBTeW1ib2woXCJqb2JcIik7XHJcbmNvbnN0IHN5bWJvbF9vbkpvYkNoYW5nZSA9IFN5bWJvbChcIm9uSm9iQ2hhbmdlXCIpO1xyXG5cclxuY2xhc3MgQ2hhcmFjdGVyU3RhdCBleHRlbmRzIENoYXJhY3RlckJhc2VTdGF0IHtcclxuXHRjb25zdHJ1Y3RvcihzY2VuZUNoYXJhKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuXyRzY2VuZUNoYXJhID0gc2NlbmVDaGFyYTtcclxuXHJcblx0XHR0aGlzLmxldmVsID0gMTUwO1xyXG5cclxuXHRcdC8vdGhpcy5fam9iID0gMztcclxuXHRcdC8vdGhpcy5fc3BlY19qb2IgPSAzO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtudW1iZXJ9IC0g5pyA5aSn5bGs5oCn5pS75pOKICovXHJcblx0XHQvL3RoaXMuY3VycmVudE1heEJhc2VEYW1hZ2UgPSAxMDAwMDtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7bnVtYmVyfSAtIOacgOWwj+WxrOaAp+aUu+aTiiAqL1xyXG5cdFx0Ly90aGlzLmN1cnJlbnRNaW5CYXNlRGFtYWdlID0gMTAwMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSDniIbmk4rnjocgMH4xMDAgKi9cclxuXHRcdHRoaXMuY3JpdFJhdGUgPSA1MDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSDniIbmk4rlgrflrrMgMH4xMDAgKi9cclxuXHRcdHRoaXMuY3JpdERhbWFnZSA9IDgwO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtudW1iZXJ9IC0g5pyA5aSn54iG5pOK5YK35a6zIDB+MTAwICovXHJcblx0XHQvL3RoaXMubWF4Q3JpdERhbWFnZSA9IDgwO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtudW1iZXJ9IC0g5pyA5bCP54iG5pOK5YK35a6zIDB+MTAwICovXHJcblx0XHQvL3RoaXMubWluQ3JpdERhbWFnZSA9IDQwO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IGpvYigpIHtcclxuXHRcdHJldHVybiB0aGlzW3N5bWJvbFN0YXRKb2JdO1xyXG5cdH1cclxuXHRzZXQgam9iKHZhbHVlKSB7XHJcblx0XHR0aGlzW3N5bWJvbFN0YXRKb2JdID0gdmFsdWU7XHJcblxyXG5cdFx0Y29uc3Qgb25Kb2JDaGFuZ2UgPSB0aGlzW3N5bWJvbF9vbkpvYkNoYW5nZV07XHJcblxyXG5cdFx0aWYgKF9vbkpvYkNoYW5nZSkge1xyXG5cdFx0XHRfb25Kb2JDaGFuZ2UoKVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqIEBwYXJhbSB7ZnVuY3Rpb24oKTp2b2lkfSBjYmZ1bmMgKi9cclxuXHRvbkpvYkNoYW5nZShjYmZ1bmMpIHtcclxuXHRcdHRoaXNbc3ltYm9sX29uSm9iQ2hhbmdlXSA9IGNiZnVuYztcclxuXHR9XHJcblxyXG5cdF9nZXRUb3RhbEF0dGFjaygpIHtcclxuXHRcdHJldHVybiAxMDA7XHJcblx0fVxyXG5cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gLSDmnIDlpKflsazmgKfmlLvmk4ogKi9cclxuXHRnZXRDdXJyZW50TWF4QmFzZURhbWFnZSgpIHtcclxuXHRcdC8vcmV0dXJuIHRoaXMuY3VycmVudE1heEJhc2VEYW1hZ2U7XHJcblx0XHRyZXR1cm4gMS4zMCAqICg0ICogdGhpcy5kZXggKyB0aGlzLnN0cikgKiAodGhpcy5fZ2V0VG90YWxBdHRhY2soKSAvIDEwMCk7XHJcblx0fVxyXG5cdC8qKiBAcmV0dXJucyB7bnVtYmVyfSAtIOacgOWwj+WxrOaAp+aUu+aTiiAqL1xyXG5cdGdldEN1cnJlbnRNaW5CYXNlRGFtYWdlKCkge1xyXG5cdFx0Ly9yZXR1cm4gdGhpcy5jdXJyZW50TWluQmFzZURhbWFnZTtcclxuXHRcdHJldHVybiAxLjMwICogKHRoaXMuZGV4ICsgdGhpcy5zdHIpICogKHRoaXMuX2dldFRvdGFsQXR0YWNrKCkgLyAxMDApO1xyXG5cdH1cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gLSDniIbmk4rnjocgMH4xMDAgKi9cclxuXHRnZXRDcml0UmF0ZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLmNyaXRSYXRlO1xyXG5cdH1cclxuXHQvKiogQHJldHVybnMge251bWJlcn0gLSDniIbmk4rlgrflrrMgMH4xMDAgKi9cclxuXHRnZXRDcml0RGFtYWdlKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuY3JpdERhbWFnZTtcclxuXHR9XHJcblx0Ly8vKiogQHJldHVybnMge251bWJlcn0gLSDmnIDlpKfniIbmk4rlgrflrrMgMH4xMDAgKi9cclxuXHQvL2dldE1heENyaXREYW1hZ2UoKSB7XHJcblx0Ly9cdHJldHVybiB0aGlzLl8kbWF4Q3JpdERhbWFnZTtcclxuXHQvL31cclxuXHQvLy8qKiBAcmV0dXJucyB7bnVtYmVyfSAtIOacgOWwj+eIhuaTiuWCt+WusyAwfjEwMCAqL1xyXG5cdC8vZ2V0TWluQ3JpdERhbWFnZSgpIHtcclxuXHQvL1x0cmV0dXJuIHRoaXMuXyRtaW5Dcml0RGFtYWdlO1xyXG5cdC8vfVxyXG5cclxuXHRnZXRIcFBlcmNlbnRTKCkge1xyXG5cdFx0cmV0dXJuICh0aGlzLmhwICogMTAwIC8gdGhpcy5taHApLnRvRml4ZWQoMCk7XHJcblx0fVxyXG5cdGdldE1wUGVyY2VudFMoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMubXAgKiAxMDAgLyB0aGlzLm1tcCkudG9GaXhlZCgwKTtcclxuXHR9XHJcblx0Z2V0RXhwUGVyY2VudFMoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMuZXhwICogMTAwIC8gdGhpcy5nZXROZXh0RXhwKCkpLnRvRml4ZWQoMik7XHJcblx0fVxyXG5cdGdldE5leHRFeHAoKSB7XHJcblx0XHRyZXR1cm4gMTAwO1xyXG5cdH1cclxufVxyXG5cclxuLy8/PyBwYWNrZXRcclxuY2xhc3MgJFJlbW90ZVBsYXllckRhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmlkID0gdW5kZWZpbmVkO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5lcXVpcHNfY29kZSA9IG51bGw7XHJcblx0XHRcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmNoYXRCYWxsb29uU3R5bGUgPSAwO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMubGFiZWxTdHlsZSA9IDA7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5kYW1hZ2VTa2luID0gXCJkZWZhdWx0XCI7XHJcblx0fVxyXG59XHJcbi8vPz8gcGFja2V0XHJcbmNsYXNzICRQbGF5ZXJEYXRhIGV4dGVuZHMgJFJlbW90ZVBsYXllckRhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyU3RhdH0gKi9cclxuXHRcdHRoaXMuc3RhdCA9IHVuZGVmaW5lZDtcclxuXHR9XHJcblxyXG5cdGdldFJlbW90ZURhdGEoKSB7XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHRpZDogdGhpcy5pZCxcclxuXHRcdFx0bWFwSWQ6IHRoaXMubWFwSWQsXHJcblx0XHRcdGVxdWlwc19jb2RlOiB0aGlzLmVxdWlwc19jb2RlLFxyXG5cdFx0fTtcclxuXHR9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cdENoYXJhY3RlclN0YXQsXHJcblx0JFJlbW90ZVBsYXllckRhdGEsICRQbGF5ZXJEYXRhLFxyXG59O1xyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/Common/PlayerData.js\n");

/***/ }),

/***/ "./src/game/InputKey.js":
/*!******************************!*\
  !*** ./src/game/InputKey.js ***!
  \******************************/
/*! exports provided: InputKey */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"InputKey\", function() { return InputKey; });\n\r\n/*interface InputKeyMap {\r\n\t[keyName: string]: number;\r\n}*/\r\n\r\nclass InputKey {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.time = 0;\r\n\t\t\r\n\t\t/** @type {string[][]} */\r\n\t\tthis.inputCommand = [];\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis._skip_prev = false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t * @param {InputKeyMap} keyDownMap\r\n\t */\r\n\tupdate(stamp, keyDownMap) {\r\n\t\tif ((stamp - this.time) > 333) {\r\n\t\t\tthis.inputCommand.length = 0;//clear\r\n\t\t}\r\n\t\t/** @type {string[]} */\r\n\t\tlet keys = [];\r\n\t\tfor (let keyName in keyDownMap) {\r\n\t\t\tif (keyDownMap[keyName]) {\r\n\t\t\t\tkeys.push(keyName);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (!this.inputCommand.length || this._skip_prev) {\r\n\t\t\tthis._skip_prev = false;\r\n\t\t\tthis.inputCommand.push(keys);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (keys.length) {\r\n\t\t\t\tthis._skip_prev = false;\r\n\t\t\t\tif (!this._equals_input(this.inputCommand.length - 1, keys)) {\r\n\t\t\t\t\tthis.inputCommand.push(keys);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._skip_prev = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.time = stamp;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} index - this.inputCommand[index]\r\n\t * @param {string[]} keys\r\n\t */\r\n\t_equals_input(index, keys) {\r\n\t\tconst iCmd = this.inputCommand[index];\r\n\t\tif (!iCmd) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tfor (let j = 0; j < keys.length; ++j) {\r\n\t\t\tconst keyName = keys[j];\r\n\t\t\t\r\n\t\t\tif (!(iCmd && iCmd.indexOf(keyName) >= 0 && iCmd.length == keys.length)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string[][]} command\r\n\t * @param {number} length - command length\r\n\t * @returns {boolean}\r\n\t *\r\n\t * length = length + command.length\r\n\t */\r\n\tmatch(command, length = command.length) {\r\n\t\tif (!this.inputCommand.length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tif (length < 0) {\r\n\t\t\tlength = length + command.length;\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < length; ++i) {\r\n\t\t\tlet r = this._equals_input(i, command[i]);\r\n\t\t\tif (!r) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nfunction unit_test () {\r\n\t(function () {\r\n\t\tlet ctrller = new InputKey();\r\n\r\n\t\tctrller.update(0, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\t\tctrller.update(222, {\r\n\t\t\t\"down\": 1,\r\n\t\t\t\"right\": 1,\r\n\t\t});\r\n\t\tctrller.update(444, {\r\n\t\t\t\"right\": 1,\r\n\t\t});\r\n\r\n\t\tlet r = ctrller.match([\r\n\t\t\t[\"down\"],\r\n\t\t\t[\"down\", \"right\"],\r\n\t\t\t[\"right\"],\r\n\t\t]);\r\n\r\n\t\tconsole.log(\"%o: %o\\n\\t%o\", \"全部正確\", r, ctrller);\r\n\t})();\r\n\r\n\t(function () {\r\n\t\tlet ctrller = new InputKey();\r\n\r\n\t\tctrller.update(0, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\t\tctrller.update(222, {\r\n\t\t\t\"down\": 1,\r\n\t\t\t\"right\": 1,\r\n\t\t});\r\n\t\tctrller.update(444, {\r\n\t\t\t\"down\": 1,\r\n\t\t\t\"right\": 1,\r\n\t\t});\r\n\r\n\t\tlet r = ctrller.match([\r\n\t\t\t[\"down\"],\r\n\t\t\t[\"down\", \"right\"],\r\n\t\t\t[\"right\"],\r\n\t\t]);\r\n\r\n\t\tconsole.log(\"%o: %o\\n\\t%o\", \"多按一個鍵\", r == false, ctrller);\r\n\t})();\r\n\r\n\t(function () {\r\n\t\tlet ctrller = new InputKey();\r\n\r\n\t\tctrller.update(0, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\t\tctrller.update(222, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\r\n\t\tlet r = ctrller.match([\r\n\t\t\t[\"down\"],\r\n\t\t\t[\"down\"],\r\n\t\t]);\r\n\r\n\t\tconsole.log(\"%o: %o\\n\\t%o\", \"按住\", r == false, ctrller);\r\n\t})();\r\n\r\n\t(function () {\r\n\t\tlet ctrller = new InputKey();\r\n\r\n\t\tctrller.update(0, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\t\tctrller.update(666, {\r\n\t\t\t\"right\": 1,\r\n\t\t});\r\n\r\n\t\tlet r = ctrller.match([\r\n\t\t\t[\"down\"],\r\n\t\t\t[\"right\"],\r\n\t\t]);\r\n\r\n\t\tconsole.log(\"%o: %o\\n\\t%o\", \"間隔太長\", r == false, ctrller);\r\n\t})();\r\n\r\n\t(function () {\r\n\t\tlet ctrller = new InputKey();\r\n\r\n\t\tctrller.update(0, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\t\tctrller.update(222, {\r\n\t\t});\r\n\t\tctrller.update(444, {\r\n\t\t\t\"down\": 1,\r\n\t\t});\r\n\r\n\t\tlet r = ctrller.match([\r\n\t\t\t[\"down\"],\r\n\t\t\t[\"down\"],\r\n\t\t]);\r\n\r\n\t\tconsole.log(\"%o: %o\\n\\t%o\", \"連按\", r, ctrller);\r\n\t})();\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9JbnB1dEtleS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL0lucHV0S2V5LmpzP2M0NmQiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbi8qaW50ZXJmYWNlIElucHV0S2V5TWFwIHtcclxuXHRba2V5TmFtZTogc3RyaW5nXTogbnVtYmVyO1xyXG59Ki9cclxuXHJcbmV4cG9ydCBjbGFzcyBJbnB1dEtleSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nW11bXX0gKi9cclxuXHRcdHRoaXMuaW5wdXRDb21tYW5kID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuX3NraXBfcHJldiA9IGZhbHNlO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKiBAcGFyYW0ge0lucHV0S2V5TWFwfSBrZXlEb3duTWFwXHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wLCBrZXlEb3duTWFwKSB7XHJcblx0XHRpZiAoKHN0YW1wIC0gdGhpcy50aW1lKSA+IDMzMykge1xyXG5cdFx0XHR0aGlzLmlucHV0Q29tbWFuZC5sZW5ndGggPSAwOy8vY2xlYXJcclxuXHRcdH1cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nW119ICovXHJcblx0XHRsZXQga2V5cyA9IFtdO1xyXG5cdFx0Zm9yIChsZXQga2V5TmFtZSBpbiBrZXlEb3duTWFwKSB7XHJcblx0XHRcdGlmIChrZXlEb3duTWFwW2tleU5hbWVdKSB7XHJcblx0XHRcdFx0a2V5cy5wdXNoKGtleU5hbWUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmICghdGhpcy5pbnB1dENvbW1hbmQubGVuZ3RoIHx8IHRoaXMuX3NraXBfcHJldikge1xyXG5cdFx0XHR0aGlzLl9za2lwX3ByZXYgPSBmYWxzZTtcclxuXHRcdFx0dGhpcy5pbnB1dENvbW1hbmQucHVzaChrZXlzKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRpZiAoa2V5cy5sZW5ndGgpIHtcclxuXHRcdFx0XHR0aGlzLl9za2lwX3ByZXYgPSBmYWxzZTtcclxuXHRcdFx0XHRpZiAoIXRoaXMuX2VxdWFsc19pbnB1dCh0aGlzLmlucHV0Q29tbWFuZC5sZW5ndGggLSAxLCBrZXlzKSkge1xyXG5cdFx0XHRcdFx0dGhpcy5pbnB1dENvbW1hbmQucHVzaChrZXlzKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fc2tpcF9wcmV2ID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0aGlzLnRpbWUgPSBzdGFtcDtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gdGhpcy5pbnB1dENvbW1hbmRbaW5kZXhdXHJcblx0ICogQHBhcmFtIHtzdHJpbmdbXX0ga2V5c1xyXG5cdCAqL1xyXG5cdF9lcXVhbHNfaW5wdXQoaW5kZXgsIGtleXMpIHtcclxuXHRcdGNvbnN0IGlDbWQgPSB0aGlzLmlucHV0Q29tbWFuZFtpbmRleF07XHJcblx0XHRpZiAoIWlDbWQpIHtcclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0Zm9yIChsZXQgaiA9IDA7IGogPCBrZXlzLmxlbmd0aDsgKytqKSB7XHJcblx0XHRcdGNvbnN0IGtleU5hbWUgPSBrZXlzW2pdO1xyXG5cdFx0XHRcclxuXHRcdFx0aWYgKCEoaUNtZCAmJiBpQ21kLmluZGV4T2Yoa2V5TmFtZSkgPj0gMCAmJiBpQ21kLmxlbmd0aCA9PSBrZXlzLmxlbmd0aCkpIHtcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ1tdW119IGNvbW1hbmRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbGVuZ3RoIC0gY29tbWFuZCBsZW5ndGhcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKlxyXG5cdCAqIGxlbmd0aCA9IGxlbmd0aCArIGNvbW1hbmQubGVuZ3RoXHJcblx0ICovXHJcblx0bWF0Y2goY29tbWFuZCwgbGVuZ3RoID0gY29tbWFuZC5sZW5ndGgpIHtcclxuXHRcdGlmICghdGhpcy5pbnB1dENvbW1hbmQubGVuZ3RoKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYgKGxlbmd0aCA8IDApIHtcclxuXHRcdFx0bGVuZ3RoID0gbGVuZ3RoICsgY29tbWFuZC5sZW5ndGg7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IHIgPSB0aGlzLl9lcXVhbHNfaW5wdXQoaSwgY29tbWFuZFtpXSk7XHJcblx0XHRcdGlmICghcikge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVuaXRfdGVzdCAoKSB7XHJcblx0KGZ1bmN0aW9uICgpIHtcclxuXHRcdGxldCBjdHJsbGVyID0gbmV3IElucHV0S2V5KCk7XHJcblxyXG5cdFx0Y3RybGxlci51cGRhdGUoMCwge1xyXG5cdFx0XHRcImRvd25cIjogMSxcclxuXHRcdH0pO1xyXG5cdFx0Y3RybGxlci51cGRhdGUoMjIyLCB7XHJcblx0XHRcdFwiZG93blwiOiAxLFxyXG5cdFx0XHRcInJpZ2h0XCI6IDEsXHJcblx0XHR9KTtcclxuXHRcdGN0cmxsZXIudXBkYXRlKDQ0NCwge1xyXG5cdFx0XHRcInJpZ2h0XCI6IDEsXHJcblx0XHR9KTtcclxuXHJcblx0XHRsZXQgciA9IGN0cmxsZXIubWF0Y2goW1xyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XHRbXCJkb3duXCIsIFwicmlnaHRcIl0sXHJcblx0XHRcdFtcInJpZ2h0XCJdLFxyXG5cdFx0XSk7XHJcblxyXG5cdFx0Y29uc29sZS5sb2coXCIlbzogJW9cXG5cXHQlb1wiLCBcIuWFqOmDqOato+eiulwiLCByLCBjdHJsbGVyKTtcclxuXHR9KSgpO1xyXG5cclxuXHQoZnVuY3Rpb24gKCkge1xyXG5cdFx0bGV0IGN0cmxsZXIgPSBuZXcgSW5wdXRLZXkoKTtcclxuXHJcblx0XHRjdHJsbGVyLnVwZGF0ZSgwLCB7XHJcblx0XHRcdFwiZG93blwiOiAxLFxyXG5cdFx0fSk7XHJcblx0XHRjdHJsbGVyLnVwZGF0ZSgyMjIsIHtcclxuXHRcdFx0XCJkb3duXCI6IDEsXHJcblx0XHRcdFwicmlnaHRcIjogMSxcclxuXHRcdH0pO1xyXG5cdFx0Y3RybGxlci51cGRhdGUoNDQ0LCB7XHJcblx0XHRcdFwiZG93blwiOiAxLFxyXG5cdFx0XHRcInJpZ2h0XCI6IDEsXHJcblx0XHR9KTtcclxuXHJcblx0XHRsZXQgciA9IGN0cmxsZXIubWF0Y2goW1xyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XHRbXCJkb3duXCIsIFwicmlnaHRcIl0sXHJcblx0XHRcdFtcInJpZ2h0XCJdLFxyXG5cdFx0XSk7XHJcblxyXG5cdFx0Y29uc29sZS5sb2coXCIlbzogJW9cXG5cXHQlb1wiLCBcIuWkmuaMieS4gOWAi+mNtVwiLCByID09IGZhbHNlLCBjdHJsbGVyKTtcclxuXHR9KSgpO1xyXG5cclxuXHQoZnVuY3Rpb24gKCkge1xyXG5cdFx0bGV0IGN0cmxsZXIgPSBuZXcgSW5wdXRLZXkoKTtcclxuXHJcblx0XHRjdHJsbGVyLnVwZGF0ZSgwLCB7XHJcblx0XHRcdFwiZG93blwiOiAxLFxyXG5cdFx0fSk7XHJcblx0XHRjdHJsbGVyLnVwZGF0ZSgyMjIsIHtcclxuXHRcdFx0XCJkb3duXCI6IDEsXHJcblx0XHR9KTtcclxuXHJcblx0XHRsZXQgciA9IGN0cmxsZXIubWF0Y2goW1xyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XSk7XHJcblxyXG5cdFx0Y29uc29sZS5sb2coXCIlbzogJW9cXG5cXHQlb1wiLCBcIuaMieS9j1wiLCByID09IGZhbHNlLCBjdHJsbGVyKTtcclxuXHR9KSgpO1xyXG5cclxuXHQoZnVuY3Rpb24gKCkge1xyXG5cdFx0bGV0IGN0cmxsZXIgPSBuZXcgSW5wdXRLZXkoKTtcclxuXHJcblx0XHRjdHJsbGVyLnVwZGF0ZSgwLCB7XHJcblx0XHRcdFwiZG93blwiOiAxLFxyXG5cdFx0fSk7XHJcblx0XHRjdHJsbGVyLnVwZGF0ZSg2NjYsIHtcclxuXHRcdFx0XCJyaWdodFwiOiAxLFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0bGV0IHIgPSBjdHJsbGVyLm1hdGNoKFtcclxuXHRcdFx0W1wiZG93blwiXSxcclxuXHRcdFx0W1wicmlnaHRcIl0sXHJcblx0XHRdKTtcclxuXHJcblx0XHRjb25zb2xlLmxvZyhcIiVvOiAlb1xcblxcdCVvXCIsIFwi6ZaT6ZqU5aSq6ZW3XCIsIHIgPT0gZmFsc2UsIGN0cmxsZXIpO1xyXG5cdH0pKCk7XHJcblxyXG5cdChmdW5jdGlvbiAoKSB7XHJcblx0XHRsZXQgY3RybGxlciA9IG5ldyBJbnB1dEtleSgpO1xyXG5cclxuXHRcdGN0cmxsZXIudXBkYXRlKDAsIHtcclxuXHRcdFx0XCJkb3duXCI6IDEsXHJcblx0XHR9KTtcclxuXHRcdGN0cmxsZXIudXBkYXRlKDIyMiwge1xyXG5cdFx0fSk7XHJcblx0XHRjdHJsbGVyLnVwZGF0ZSg0NDQsIHtcclxuXHRcdFx0XCJkb3duXCI6IDEsXHJcblx0XHR9KTtcclxuXHJcblx0XHRsZXQgciA9IGN0cmxsZXIubWF0Y2goW1xyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XHRbXCJkb3duXCJdLFxyXG5cdFx0XSk7XHJcblxyXG5cdFx0Y29uc29sZS5sb2coXCIlbzogJW9cXG5cXHQlb1wiLCBcIumAo+aMiVwiLCByLCBjdHJsbGVyKTtcclxuXHR9KSgpO1xyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/InputKey.js\n");

/***/ }),

/***/ "./src/game/Item.js":
/*!**************************!*\
  !*** ./src/game/Item.js ***!
  \**************************/
/*! exports provided: ItemBase, ItemEquip, ItemConsume, ItemEtc, ItemInstall, ItemCash, $createItem, ItemSlot */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemBase\", function() { return ItemBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemEquip\", function() { return ItemEquip; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemConsume\", function() { return ItemConsume; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemEtc\", function() { return ItemEtc; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemInstall\", function() { return ItemInstall; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemCash\", function() { return ItemCash; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"$createItem\", function() { return $createItem; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ItemSlot\", function() { return ItemSlot; });\n/* harmony import */ var _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../public/javascripts/resource.js */ \"./public/javascripts/resource.js\");\n/* harmony import */ var _Sprite__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Sprite */ \"./src/game/Sprite.js\");\n/* harmony import */ var _ui_Basic_KeySlotData_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ui/Basic/KeySlotData.js */ \"./src/ui/Basic/KeySlotData.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n/** @type {$ItemRawData} */\r\nlet _loadedItem = {};\r\n\r\nwindow.$loadedItem = _loadedItem;\r\n\r\n\r\nclass $ItemRawData {\r\n\tconstructor() {\r\n\t}\r\n}\r\n\r\n\r\n//class ItemInfo {\r\n//\t/**\r\n//\t * @param {{}} _rawInfo\r\n//\t */\r\n//\tconstructor(_raw) {\r\n//\t\tthis.icon = new Sprite(_raw.icon);\r\n//\t\tthis.iconRaw = new Sprite(_raw.iconRaw);\r\n//\t}\r\n//\r\n//\t/**\r\n//\t * @param {string} itemId\r\n//\t * @returns {Promise<Sprite[]>}\r\n//\t */\r\n//\tload(itemId, loadSprite = false) {\r\n//\t\tlet url = ItemCategoryInfo.getIconUrl(itemId);\r\n//\t\tlet rawUrl = ItemCategoryInfo.getIconRawUrl(itemId);\r\n//\r\n//\t\tthis.icon._url = url;\r\n//\t\tthis.iconRaw._url = rawUrl;\r\n//\r\n//\t\t// 目前用不到 Sprite\r\n//\t\t// UI 只會用到 _raw, Image\r\n//\r\n//\t\tif (loadSprite) {\r\n//\t\t\t//manual load\r\n//\t\t\tthis.icon.__loadTexture();\r\n//\t\t\tthis.iconRaw.__loadTexture();\r\n//\r\n//\t\t\treturn Promise.all([this.icon.$promise, this.iconRaw.$promise]);\r\n//\t\t}\r\n//\t}\r\n//}\r\n\r\nconst SLOT_EQUIP = 0;\r\nconst SLOT_COS = 1;\r\nconst SLOT_ETC = 2;\r\nconst SLOT_INS = 3;\r\nconst SLOT_CASH = 4;\r\n\r\nconst TYPE_TO_SLOT_MAP = [\r\n\tSLOT_EQUIP, SLOT_EQUIP, SLOT_COS, SLOT_INS, SLOT_ETC, SLOT_CASH\r\n];\r\n\r\nclass ItemBase {\r\n\t/**\r\n\t * @param {string} itemId\r\n\t * @param {{}} _raw\r\n\t */\r\n\tconstructor(itemId, _raw) {\r\n\t\t//this.assign(this, _raw);\r\n\r\n\t\t/**\r\n\t\t * @readonly\r\n\t\t * @type {Object}\r\n\t\t */\r\n\t\tthis._raw = null;\r\n\r\n\t\t/**\r\n\t\t * @readonly\r\n\t\t * @type {string}\r\n\t\t */\r\n\t\tthis.id = null;\r\n\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t\"_raw\": {\r\n\t\t\t\tvalue: _raw\r\n\t\t\t},\r\n\t\t\t\"id\": {\r\n\t\t\t\tvalue: itemId\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetSlot() {\r\n\t\treturn TYPE_TO_SLOT_MAP[this.id[1]];\r\n\t}\r\n}\r\n\r\nclass ItemEquip extends ItemBase {\r\n}\r\n\r\nclass ItemConsume extends ItemBase {\r\n}\r\n\r\nclass ItemEtc extends ItemBase {\r\n}\r\n\r\nclass ItemInstall extends ItemBase {\r\n}\r\n\r\nclass ItemCash extends ItemBase {\r\n\tgetSlot() {\r\n\t\tif (this.id == 7) {\r\n\t\t\treturn TYPE_TO_SLOT_MAP[this.id[0]];\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn TYPE_TO_SLOT_MAP[this.id[1]];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * 自訂道具\r\n * @template T\r\n * @param {string} itemId\r\n * @param {...Partial<T>} props\r\n * @returns {Promise<T>}\r\n */\r\nfunction _createItemSync(itemId, ...props) {\r\n\tlet itemPrototype = _loadedItem[itemId];\r\n\tif (!itemPrototype) {\r\n\t\tthrow new TypeError();\r\n\t}\r\n\r\n\t/** @type {string} - 1 digit */\r\n\tlet typeId = itemId[1];\r\n\r\n\t/** @type {ItemEquip | ItemConsume | ItemEtc | ItemInstall | ItemCash} */\r\n\tlet _itemType;\r\n\r\n\tswitch (typeId) {\r\n\t\tcase '0':\r\n\t\t\t_itemType = ItemEquip;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthrow new Error(\"未完成\");\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\tlet item = new _itemType(itemId, itemPrototype);\r\n\r\n\tif (props && props.length) {\r\n\t\tObject.assign(item, ...props);\r\n\t}\r\n\r\n\treturn item;\r\n}\r\n\r\n/**\r\n * 載入道具\r\n * @template T\r\n * @param {string} itemId\r\n * @param {...Partial<T>} props\r\n * @returns {Promise<T>}\r\n */\r\nasync function $createItem(itemId, ...props) {\r\n\tif (itemId.length == 7 && itemId[0] == 5) {\r\n\t\tthrow new Error(\"未完成 pet\");\r\n\t}\r\n\t/** @type {string} - 1 digit */\r\n\tlet typeId = itemId[1];\r\n\r\n\t/** @type {ItemEquip | ItemConsume | ItemEtc | ItemInstall | ItemCash} */\r\n\tlet _itemType;\r\n\r\n\tswitch (typeId) {\r\n\t\tcase \"0\":\r\n\t\t\tif (!$gv.m_editor_mode) {\r\n\t\t\t\tthrow new Error(\"$gv.m_editor_mode: %o\" + $gv.m_editor_mode);\r\n\t\t\t}\r\n\t\tcase \"1\":\r\n\t\t\t_itemType = ItemEquip;\r\n\t\t\tbreak;\r\n\t\tcase \"2\":\r\n\t\t\tconsole.error(\"未完成 ItemConsume\");\r\n\t\t\t_itemType = ItemConsume;\r\n\t\t\tbreak;\r\n\t\tcase \"3\":\r\n\t\t\t//TODO: ItemInstall\r\n\t\t\t_itemType = ItemInstall;\r\n\t\t\tbreak;\r\n\t\tcase \"4\":\r\n\t\t\tconsole.error(\"未完成 ItemEtc\");\r\n\t\t\t_itemType = ItemEtc;\r\n\t\t\tbreak;\r\n\t\tcase \"5\":\r\n\t\t\tconsole.error(\"未完成 ItemCash\");\r\n\t\t\t_itemType = ItemCash;\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tthrow new Error(\"?? typeId: \" + typeId);\r\n\t\t\treturn null;\r\n\t}\r\n\r\n\tlet itemPrototype;\r\n\ttry {\r\n\t\titemPrototype = await _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].getItem(itemId);// raw\r\n\t}\r\n\tcatch (ex) {\r\n\t\tthrow ex;\r\n\t}\r\n\tif (!itemPrototype) {\r\n\t\tconsole.warn(\"item not exist: \" + itemId);\r\n\t\treturn null;\r\n\t}\r\n\t_loadedItem[itemId] = itemPrototype;\r\n\r\n\tlet item = new _itemType(itemId, itemPrototype);\r\n\r\n\tif (props && props.length) {\r\n\t\t//TODO: deep copy\r\n\t\tObject.assign(item, ...props);\r\n\t}\r\n\r\n\treturn item;\r\n}\r\n\r\n\r\nclass ItemSlot extends _ui_Basic_KeySlotData_js__WEBPACK_IMPORTED_MODULE_2__[\"KeySlotData\"] {\r\n\t/**\r\n\t * @template T\r\n\t * @param {number} itemSlot\r\n\t * @param {number} itemSN\r\n\t * @param {T extends ItemBase ? T : never} itemData\r\n\t * @param {number} amount\r\n\t */\r\n\tconstructor(itemSlot, itemSN, itemData, amount) {\r\n\t\tsuper();\r\n\r\n\t\tthis.SN = itemSN;\r\n\t\tthis.slot = itemSlot;\r\n\t\tthis.amount = amount;\r\n\t\t\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * @type {ItemEquip | ItemConsume | ItemEtc | ItemInstall | ItemCash} - item props\r\n\t\t */\r\n\t\tthis.data = itemData;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @template T\r\n\t * @param {number} itemSlot\r\n\t * @param {number} itemSN\r\n\t * @param {T extends ItemBase ? T : never} itemData\r\n\t * @param {number} amount\r\n\t */\r\n\tassign(itemSlot, itemSN, itemData, amount) {\r\n\t\tthis.SN = itemSN;\r\n\t\tthis.slot = itemSlot;\r\n\t\tthis.amount = amount;\r\n\r\n\t\tthis.data = itemData;\r\n\t}\r\n\r\n\t_clear() {\r\n\t\tthis.data = null;\r\n\t\tthis.amount = 0;\r\n\t}\r\n\r\n\tisEmpty() {\r\n\t\tif (true) {\r\n\t\t\tif ((!this.data && this.amount) || (this.data && !this.amount)) {\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn !this.data && !this.amount;\r\n\t}\r\n\r\n\tgetData() {\r\n\t\treturn this.data;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {ItemEquip | ItemConsume | ItemEtc | ItemInstall | ItemCash} data\r\n\t */\r\n\tsetData(data) {\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} text\r\n\t */\r\n\tstatic parse(text) {\r\n\t\tif (text.__proto__ == String.prototype) {\r\n\t\t\tlet iSlot = new ItemSlot();\r\n\t\t\tlet o = JSON.parse(text);\r\n\t\t\t//iSlot.SN = o.SN;\r\n\t\t\t//iSlot.slot = o.slot;\r\n\t\t\t//iSlot.amount = o.amount;\r\n\t\t\t//iSlot.itemId = o.itemId;\r\n\t\t\tObject.assign(iSlot, o);\r\n\t\t\treturn iSlot;\r\n\t\t}\r\n\t\tthrow new TypeError();\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9JdGVtLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvSXRlbS5qcz9lZTRlIl0sInNvdXJjZXNDb250ZW50IjpbIu+7v1xyXG5pbXBvcnQgeyBJdGVtQ2F0ZWdvcnlJbmZvIH0gZnJvbSBcIi4uLy4uL3B1YmxpYy9qYXZhc2NyaXB0cy9yZXNvdXJjZS5qc1wiO1xyXG5cclxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSBcIi4vU3ByaXRlXCI7XHJcblxyXG5pbXBvcnQgeyBLZXlTbG90RGF0YSB9IGZyb20gXCIuLi91aS9CYXNpYy9LZXlTbG90RGF0YS5qc1wiO1xyXG5cclxuXHJcbi8qKiBAdHlwZSB7JEl0ZW1SYXdEYXRhfSAqL1xyXG5sZXQgX2xvYWRlZEl0ZW0gPSB7fTtcclxuXHJcbndpbmRvdy4kbG9hZGVkSXRlbSA9IF9sb2FkZWRJdGVtO1xyXG5cclxuXHJcbmNsYXNzICRJdGVtUmF3RGF0YSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0fVxyXG59XHJcblxyXG5cclxuLy9jbGFzcyBJdGVtSW5mbyB7XHJcbi8vXHQvKipcclxuLy9cdCAqIEBwYXJhbSB7e319IF9yYXdJbmZvXHJcbi8vXHQgKi9cclxuLy9cdGNvbnN0cnVjdG9yKF9yYXcpIHtcclxuLy9cdFx0dGhpcy5pY29uID0gbmV3IFNwcml0ZShfcmF3Lmljb24pO1xyXG4vL1x0XHR0aGlzLmljb25SYXcgPSBuZXcgU3ByaXRlKF9yYXcuaWNvblJhdyk7XHJcbi8vXHR9XHJcbi8vXHJcbi8vXHQvKipcclxuLy9cdCAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtSWRcclxuLy9cdCAqIEByZXR1cm5zIHtQcm9taXNlPFNwcml0ZVtdPn1cclxuLy9cdCAqL1xyXG4vL1x0bG9hZChpdGVtSWQsIGxvYWRTcHJpdGUgPSBmYWxzZSkge1xyXG4vL1x0XHRsZXQgdXJsID0gSXRlbUNhdGVnb3J5SW5mby5nZXRJY29uVXJsKGl0ZW1JZCk7XHJcbi8vXHRcdGxldCByYXdVcmwgPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldEljb25SYXdVcmwoaXRlbUlkKTtcclxuLy9cclxuLy9cdFx0dGhpcy5pY29uLl91cmwgPSB1cmw7XHJcbi8vXHRcdHRoaXMuaWNvblJhdy5fdXJsID0gcmF3VXJsO1xyXG4vL1xyXG4vL1x0XHQvLyDnm67liY3nlKjkuI3liLAgU3ByaXRlXHJcbi8vXHRcdC8vIFVJIOWPquacg+eUqOWIsCBfcmF3LCBJbWFnZVxyXG4vL1xyXG4vL1x0XHRpZiAobG9hZFNwcml0ZSkge1xyXG4vL1x0XHRcdC8vbWFudWFsIGxvYWRcclxuLy9cdFx0XHR0aGlzLmljb24uX19sb2FkVGV4dHVyZSgpO1xyXG4vL1x0XHRcdHRoaXMuaWNvblJhdy5fX2xvYWRUZXh0dXJlKCk7XHJcbi8vXHJcbi8vXHRcdFx0cmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmljb24uJHByb21pc2UsIHRoaXMuaWNvblJhdy4kcHJvbWlzZV0pO1xyXG4vL1x0XHR9XHJcbi8vXHR9XHJcbi8vfVxyXG5cclxuY29uc3QgU0xPVF9FUVVJUCA9IDA7XHJcbmNvbnN0IFNMT1RfQ09TID0gMTtcclxuY29uc3QgU0xPVF9FVEMgPSAyO1xyXG5jb25zdCBTTE9UX0lOUyA9IDM7XHJcbmNvbnN0IFNMT1RfQ0FTSCA9IDQ7XHJcblxyXG5jb25zdCBUWVBFX1RPX1NMT1RfTUFQID0gW1xyXG5cdFNMT1RfRVFVSVAsIFNMT1RfRVFVSVAsIFNMT1RfQ09TLCBTTE9UX0lOUywgU0xPVF9FVEMsIFNMT1RfQ0FTSFxyXG5dO1xyXG5cclxuZXhwb3J0IGNsYXNzIEl0ZW1CYXNlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXHJcblx0ICogQHBhcmFtIHt7fX0gX3Jhd1xyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGl0ZW1JZCwgX3Jhdykge1xyXG5cdFx0Ly90aGlzLmFzc2lnbih0aGlzLCBfcmF3KTtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIEByZWFkb25seVxyXG5cdFx0ICogQHR5cGUge09iamVjdH1cclxuXHRcdCAqL1xyXG5cdFx0dGhpcy5fcmF3ID0gbnVsbDtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIEByZWFkb25seVxyXG5cdFx0ICogQHR5cGUge3N0cmluZ31cclxuXHRcdCAqL1xyXG5cdFx0dGhpcy5pZCA9IG51bGw7XHJcblxyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnRpZXModGhpcywge1xyXG5cdFx0XHRcIl9yYXdcIjoge1xyXG5cdFx0XHRcdHZhbHVlOiBfcmF3XHJcblx0XHRcdH0sXHJcblx0XHRcdFwiaWRcIjoge1xyXG5cdFx0XHRcdHZhbHVlOiBpdGVtSWRcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHRnZXRTbG90KCkge1xyXG5cdFx0cmV0dXJuIFRZUEVfVE9fU0xPVF9NQVBbdGhpcy5pZFsxXV07XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSXRlbUVxdWlwIGV4dGVuZHMgSXRlbUJhc2Uge1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSXRlbUNvbnN1bWUgZXh0ZW5kcyBJdGVtQmFzZSB7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJdGVtRXRjIGV4dGVuZHMgSXRlbUJhc2Uge1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgSXRlbUluc3RhbGwgZXh0ZW5kcyBJdGVtQmFzZSB7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBJdGVtQ2FzaCBleHRlbmRzIEl0ZW1CYXNlIHtcclxuXHRnZXRTbG90KCkge1xyXG5cdFx0aWYgKHRoaXMuaWQgPT0gNykge1xyXG5cdFx0XHRyZXR1cm4gVFlQRV9UT19TTE9UX01BUFt0aGlzLmlkWzBdXTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gVFlQRV9UT19TTE9UX01BUFt0aGlzLmlkWzFdXTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDoh6roqILpgZPlhbdcclxuICogQHRlbXBsYXRlIFRcclxuICogQHBhcmFtIHtzdHJpbmd9IGl0ZW1JZFxyXG4gKiBAcGFyYW0gey4uLlBhcnRpYWw8VD59IHByb3BzXHJcbiAqIEByZXR1cm5zIHtQcm9taXNlPFQ+fVxyXG4gKi9cclxuZnVuY3Rpb24gX2NyZWF0ZUl0ZW1TeW5jKGl0ZW1JZCwgLi4ucHJvcHMpIHtcclxuXHRsZXQgaXRlbVByb3RvdHlwZSA9IF9sb2FkZWRJdGVtW2l0ZW1JZF07XHJcblx0aWYgKCFpdGVtUHJvdG90eXBlKSB7XHJcblx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCk7XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge3N0cmluZ30gLSAxIGRpZ2l0ICovXHJcblx0bGV0IHR5cGVJZCA9IGl0ZW1JZFsxXTtcclxuXHJcblx0LyoqIEB0eXBlIHtJdGVtRXF1aXAgfCBJdGVtQ29uc3VtZSB8IEl0ZW1FdGMgfCBJdGVtSW5zdGFsbCB8IEl0ZW1DYXNofSAqL1xyXG5cdGxldCBfaXRlbVR5cGU7XHJcblxyXG5cdHN3aXRjaCAodHlwZUlkKSB7XHJcblx0XHRjYXNlICcwJzpcclxuXHRcdFx0X2l0ZW1UeXBlID0gSXRlbUVxdWlwO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGRlZmF1bHQ6XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIuacquWujOaIkFwiKTtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHRsZXQgaXRlbSA9IG5ldyBfaXRlbVR5cGUoaXRlbUlkLCBpdGVtUHJvdG90eXBlKTtcclxuXHJcblx0aWYgKHByb3BzICYmIHByb3BzLmxlbmd0aCkge1xyXG5cdFx0T2JqZWN0LmFzc2lnbihpdGVtLCAuLi5wcm9wcyk7XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gaXRlbTtcclxufVxyXG5cclxuLyoqXHJcbiAqIOi8ieWFpemBk+WFt1xyXG4gKiBAdGVtcGxhdGUgVFxyXG4gKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXHJcbiAqIEBwYXJhbSB7Li4uUGFydGlhbDxUPn0gcHJvcHNcclxuICogQHJldHVybnMge1Byb21pc2U8VD59XHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gJGNyZWF0ZUl0ZW0oaXRlbUlkLCAuLi5wcm9wcykge1xyXG5cdGlmIChpdGVtSWQubGVuZ3RoID09IDcgJiYgaXRlbUlkWzBdID09IDUpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIuacquWujOaIkCBwZXRcIik7XHJcblx0fVxyXG5cdC8qKiBAdHlwZSB7c3RyaW5nfSAtIDEgZGlnaXQgKi9cclxuXHRsZXQgdHlwZUlkID0gaXRlbUlkWzFdO1xyXG5cclxuXHQvKiogQHR5cGUge0l0ZW1FcXVpcCB8IEl0ZW1Db25zdW1lIHwgSXRlbUV0YyB8IEl0ZW1JbnN0YWxsIHwgSXRlbUNhc2h9ICovXHJcblx0bGV0IF9pdGVtVHlwZTtcclxuXHJcblx0c3dpdGNoICh0eXBlSWQpIHtcclxuXHRcdGNhc2UgXCIwXCI6XHJcblx0XHRcdGlmICghJGd2Lm1fZWRpdG9yX21vZGUpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCIkZ3YubV9lZGl0b3JfbW9kZTogJW9cIiArICRndi5tX2VkaXRvcl9tb2RlKTtcclxuXHRcdFx0fVxyXG5cdFx0Y2FzZSBcIjFcIjpcclxuXHRcdFx0X2l0ZW1UeXBlID0gSXRlbUVxdWlwO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCIyXCI6XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCLmnKrlrozmiJAgSXRlbUNvbnN1bWVcIik7XHJcblx0XHRcdF9pdGVtVHlwZSA9IEl0ZW1Db25zdW1lO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCIzXCI6XHJcblx0XHRcdC8vVE9ETzogSXRlbUluc3RhbGxcclxuXHRcdFx0X2l0ZW1UeXBlID0gSXRlbUluc3RhbGw7XHJcblx0XHRcdGJyZWFrO1xyXG5cdFx0Y2FzZSBcIjRcIjpcclxuXHRcdFx0Y29uc29sZS5lcnJvcihcIuacquWujOaIkCBJdGVtRXRjXCIpO1xyXG5cdFx0XHRfaXRlbVR5cGUgPSBJdGVtRXRjO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGNhc2UgXCI1XCI6XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCLmnKrlrozmiJAgSXRlbUNhc2hcIik7XHJcblx0XHRcdF9pdGVtVHlwZSA9IEl0ZW1DYXNoO1xyXG5cdFx0XHRicmVhaztcclxuXHRcdGRlZmF1bHQ6XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIj8/IHR5cGVJZDogXCIgKyB0eXBlSWQpO1xyXG5cdFx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblxyXG5cdGxldCBpdGVtUHJvdG90eXBlO1xyXG5cdHRyeSB7XHJcblx0XHRpdGVtUHJvdG90eXBlID0gYXdhaXQgSXRlbUNhdGVnb3J5SW5mby5nZXRJdGVtKGl0ZW1JZCk7Ly8gcmF3XHJcblx0fVxyXG5cdGNhdGNoIChleCkge1xyXG5cdFx0dGhyb3cgZXg7XHJcblx0fVxyXG5cdGlmICghaXRlbVByb3RvdHlwZSkge1xyXG5cdFx0Y29uc29sZS53YXJuKFwiaXRlbSBub3QgZXhpc3Q6IFwiICsgaXRlbUlkKTtcclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxuXHRfbG9hZGVkSXRlbVtpdGVtSWRdID0gaXRlbVByb3RvdHlwZTtcclxuXHJcblx0bGV0IGl0ZW0gPSBuZXcgX2l0ZW1UeXBlKGl0ZW1JZCwgaXRlbVByb3RvdHlwZSk7XHJcblxyXG5cdGlmIChwcm9wcyAmJiBwcm9wcy5sZW5ndGgpIHtcclxuXHRcdC8vVE9ETzogZGVlcCBjb3B5XHJcblx0XHRPYmplY3QuYXNzaWduKGl0ZW0sIC4uLnByb3BzKTtcclxuXHR9XHJcblxyXG5cdHJldHVybiBpdGVtO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEl0ZW1TbG90IGV4dGVuZHMgS2V5U2xvdERhdGEge1xyXG5cdC8qKlxyXG5cdCAqIEB0ZW1wbGF0ZSBUXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TbG90XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1TTlxyXG5cdCAqIEBwYXJhbSB7VCBleHRlbmRzIEl0ZW1CYXNlID8gVCA6IG5ldmVyfSBpdGVtRGF0YVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnRcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihpdGVtU2xvdCwgaXRlbVNOLCBpdGVtRGF0YSwgYW1vdW50KSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMuU04gPSBpdGVtU047XHJcblx0XHR0aGlzLnNsb3QgPSBpdGVtU2xvdDtcclxuXHRcdHRoaXMuYW1vdW50ID0gYW1vdW50O1xyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIEBwcml2YXRlXHJcblx0XHQgKiBAdHlwZSB7SXRlbUVxdWlwIHwgSXRlbUNvbnN1bWUgfCBJdGVtRXRjIHwgSXRlbUluc3RhbGwgfCBJdGVtQ2FzaH0gLSBpdGVtIHByb3BzXHJcblx0XHQgKi9cclxuXHRcdHRoaXMuZGF0YSA9IGl0ZW1EYXRhO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAdGVtcGxhdGUgVFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU2xvdFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpdGVtU05cclxuXHQgKiBAcGFyYW0ge1QgZXh0ZW5kcyBJdGVtQmFzZSA/IFQgOiBuZXZlcn0gaXRlbURhdGFcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW1vdW50XHJcblx0ICovXHJcblx0YXNzaWduKGl0ZW1TbG90LCBpdGVtU04sIGl0ZW1EYXRhLCBhbW91bnQpIHtcclxuXHRcdHRoaXMuU04gPSBpdGVtU047XHJcblx0XHR0aGlzLnNsb3QgPSBpdGVtU2xvdDtcclxuXHRcdHRoaXMuYW1vdW50ID0gYW1vdW50O1xyXG5cclxuXHRcdHRoaXMuZGF0YSA9IGl0ZW1EYXRhO1xyXG5cdH1cclxuXHJcblx0X2NsZWFyKCkge1xyXG5cdFx0dGhpcy5kYXRhID0gbnVsbDtcclxuXHRcdHRoaXMuYW1vdW50ID0gMDtcclxuXHR9XHJcblxyXG5cdGlzRW1wdHkoKSB7XHJcblx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG5cdFx0XHRpZiAoKCF0aGlzLmRhdGEgJiYgdGhpcy5hbW91bnQpIHx8ICh0aGlzLmRhdGEgJiYgIXRoaXMuYW1vdW50KSkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gIXRoaXMuZGF0YSAmJiAhdGhpcy5hbW91bnQ7XHJcblx0fVxyXG5cclxuXHRnZXREYXRhKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuZGF0YTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SXRlbUVxdWlwIHwgSXRlbUNvbnN1bWUgfCBJdGVtRXRjIHwgSXRlbUluc3RhbGwgfCBJdGVtQ2FzaH0gZGF0YVxyXG5cdCAqL1xyXG5cdHNldERhdGEoZGF0YSkge1xyXG5cdFx0dGhpcy5kYXRhID0gZGF0YTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0XHJcblx0ICovXHJcblx0c3RhdGljIHBhcnNlKHRleHQpIHtcclxuXHRcdGlmICh0ZXh0Ll9fcHJvdG9fXyA9PSBTdHJpbmcucHJvdG90eXBlKSB7XHJcblx0XHRcdGxldCBpU2xvdCA9IG5ldyBJdGVtU2xvdCgpO1xyXG5cdFx0XHRsZXQgbyA9IEpTT04ucGFyc2UodGV4dCk7XHJcblx0XHRcdC8vaVNsb3QuU04gPSBvLlNOO1xyXG5cdFx0XHQvL2lTbG90LnNsb3QgPSBvLnNsb3Q7XHJcblx0XHRcdC8vaVNsb3QuYW1vdW50ID0gby5hbW91bnQ7XHJcblx0XHRcdC8vaVNsb3QuaXRlbUlkID0gby5pdGVtSWQ7XHJcblx0XHRcdE9iamVjdC5hc3NpZ24oaVNsb3QsIG8pO1xyXG5cdFx0XHRyZXR1cm4gaVNsb3Q7XHJcblx0XHR9XHJcblx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCk7XHJcblx0fVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Item.js\n");

/***/ }),

/***/ "./src/game/Map.js":
/*!*************************!*\
  !*** ./src/game/Map.js ***!
  \*************************/
/*! exports provided: LifeSpawnPoint, MapLifeEntity, SceneMap */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LifeSpawnPoint\", function() { return LifeSpawnPoint; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MapLifeEntity\", function() { return MapLifeEntity; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SceneMap\", function() { return SceneMap; });\n/* harmony import */ var _init_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../init.js */ \"./src/init.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./math.js */ \"./src/game/math.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Engine_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Engine.js */ \"./src/game/Engine.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _Renderer_LifeRenderer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Renderer/LifeRenderer.js */ \"./src/game/Renderer/LifeRenderer.js\");\n/* harmony import */ var _Renderer_MobRenderer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Renderer/MobRenderer.js */ \"./src/game/Renderer/MobRenderer.js\");\n/* harmony import */ var _Renderer_NpcRenderer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Renderer/NpcRenderer.js */ \"./src/game/Renderer/NpcRenderer.js\");\n/* harmony import */ var _Renderer_ParticleSystem_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Renderer/ParticleSystem.js */ \"./src/game/Renderer/ParticleSystem.js\");\n/* harmony import */ var _Physics_World_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Physics/World.js */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _Physics_Ground_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./Physics/Ground.js */ \"./src/game/Physics/Ground.js\");\n/* harmony import */ var _Physics_PMob_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Physics/PMob.js */ \"./src/game/Physics/PMob.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./SceneObject.js */ \"./src/game/SceneObject.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nwindow.enable_skeletal_anim = true;\r\n\r\n/**\r\n * map sprite data\r\n */\r\nconst map_sprite = {\r\n\tBack: {},\r\n\tObj: {},\r\n\tTile: {},\r\n};\r\n\r\nwindow.$map_sprite = map_sprite;\r\n\r\n$gv.allQuest = {};\r\n\r\nasync function map_load_package(cat, pack) {\r\n\tif (!cat || !pack) {\r\n\t\tdebugger;\r\n\t}\r\n\tif (!map_sprite[cat][pack]) {\r\n\t\tlet url = `/Map/${cat}/${pack}`;\r\n\t\t\r\n\t\tmap_sprite[cat][pack] = await $get.data(url);\r\n\r\n\t\tif (map_sprite[cat][pack] == null) {\r\n\t\t\tconsole.warn(\"Empty package: \" + url);\r\n\t\t}\r\n\t}\r\n\tif (map_sprite[cat][pack]) {\r\n\t\treturn map_sprite[cat][pack];\r\n\t}\r\n\t//throw new Error();\r\n}\r\n\r\n\r\n/**\r\n * Map texture\r\n */\r\nclass MapTexture extends _Sprite_js__WEBPACK_IMPORTED_MODULE_4__[\"Sprite\"] {\r\n\t/**\r\n\t * @param {!any} raw\r\n\t * @param {!string} url\r\n\t * @param {!MapTexture} texture0\r\n\t */\r\n\tconstructor(_raw, url, texture0) {\r\n\t\tsuper(_raw, url);\r\n\t\t//this.className = _path;\r\n\r\n\t\ttexture0 = texture0 || MapTexture.raw_default;\r\n\t\t\r\n\t\tthis.a0 = this._get(-1, \"a0\", Number);\r\n\t\tthis.a1 = this._get(-1, \"a1\", Number);\r\n\r\n\t\tthis.movetype = this._get(texture0.movetype, \"moveType\", Number);\r\n\t\tthis.movew = this._get(texture0.movew, \"moveW\", Number);\r\n\t\tthis.moveh = this._get(texture0.moveh, \"moveH\", Number);\r\n\t\tthis.movep = this._get(texture0.movep, \"moveP\", Number);\r\n\t\tthis.mover = this._get(texture0.mover, \"moveR\", Number);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {boolean} f - flip\r\n\t * @param {number} px - position.x:int\r\n\t * @param {number} py - position.y:int\r\n\t * @param {number} time - movement_animation:float\r\n\t * @param {number} delta - graph_animation:float\r\n\t * @param {maple_scene_label} border\r\n\t */\r\n\tdraw(renderer, f, px, py, time, delta) {\r\n\t\tlet ratio = time / this.delay;\r\n\t\tlet alpha = (0 <= this.a0 || 0 <= this.a1 ? ((0 > this.a0 ? 0 : this.a0) * (1.0 - ratio) + (0 > this.a1 ? 0 : this.a1) * ratio) : 255.0);\r\n\t\tlet angle = 0;\r\n\r\n\t\tswitch (this.movetype) {\r\n\t\t\tcase 1: px = px + this.movew * Math.sin(0 == this.movep ? (delta / 1000.0) : (delta * 2.0 * Math.PI / this.movep)); break;\r\n\t\t\tcase 2: py = py + this.moveh * Math.sin(0 == this.movep ? (delta / 1000.0) : (delta * 2.0 * Math.PI / this.movep)); break;\r\n\t\t\tcase 3: if (0 != this.mover) angle = delta / this.mover; break;\r\n\t\t}\r\n\t\t\r\n\t\tlet ctx = renderer.ctx;\r\n\t\tfunction axis(x, y, w, h, c1, c2) {\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(x, y);\r\n\t\t\tctx.lineTo(x + w, y);\r\n\t\t\tstroke(c1, c2);\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.moveTo(x, y);\r\n\t\t\tctx.lineTo(x, y + h);\r\n\t\t\tstroke(c2, c1);\r\n\t\t}\r\n\t\tfunction stroke(c1, c2) {\r\n\t\t\tctx.lineWidth = 3;\r\n\t\t\tctx.strokeStyle = c1;\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\r\n\t\trenderer.loadIdentity();\r\n\t\trenderer.translate(Math.trunc(-$gv.m_viewRect.x + 0.5), Math.trunc(-$gv.m_viewRect.y + 0.5));\r\n\t\t{\r\n\t\t\trenderer.globalAlpha = Math.max(0, Math.min(alpha / 255, 1));\r\n\r\n\t\t\trenderer._drawRotaGraph(this, px, py, angle, f);\r\n\t\t}\r\n\t}\r\n}\r\nMapTexture.raw_default = {\r\n\ta0: -1,\r\n\ta1: -1,\r\n\tmovetype: 0,\r\n\tmovew: 0,\r\n\tmoveh: 0,\r\n\tmovep: 0,\r\n\tmover: 0,\r\n};\r\n\r\n/**\r\n * Map clip-texture\r\n */\r\nclass MapTextureClip extends MapTexture {\r\n\tconstructor(_raw, url) {\r\n\t\tsuper(_raw, url);\r\n\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis.clip = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"]();//zero Rectangle\r\n\t}\r\n}\r\n\r\nclass MapObjectBase {\r\n\tconstructor(_raw) {\r\n\t\tif (_raw == null) {\r\n\t\t\tdebugger;\r\n\t\t\tconsole.error(_raw);\r\n\t\t}\r\n\t\tthis._raw = _raw;\r\n\r\n\r\n\t\t/** @type {MapTexture[]} */\r\n\t\tthis.textures = [];\r\n\r\n\t\t/** @type {number} int */\r\n\t\tthis.frame = 0;\r\n\r\n\t\t/** @type {number} time_in_ms:float */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** @type {number} timeElapsed_in_ms:float */\r\n\t\tthis.delta = 0;\r\n\r\n\r\n\t\t/** @type {{[questId:string]: number}} */\r\n\t\tthis.quest = _raw.quest;\r\n\r\n\t\tfor (let qid in _raw.quest) {\r\n\t\t\tif (!$gv.allQuest[qid]) {\r\n\t\t\t\t$gv.allQuest[qid] = new Set();\r\n\t\t\t}\r\n\t\t\t$gv.allQuest[qid].add(_raw.quest[qid]);\r\n\t\t}\r\n\t\t\r\n\t\tthis._load_object_info();\r\n\t\tthis._load_back_info();\r\n\t\tthis._load_tile_info();\r\n\r\n\t\tthis.aabb = null;\r\n\t\tthis.display_aabb = false;\r\n\t\tthis.aabb_color = null;\r\n\t\t\r\n\t\tif (true) {\r\n\t\t\tthis.__max_repeat_count = 1;\r\n\t\t}\r\n\t}\r\n\t\r\n\t_load_object_info() {\r\n\t\t/** @type{number} obj-type */\r\n\t\tthis.type = this._get(0, \"sign\", Number);\r\n\r\n\t\t/** @type{number} x */\r\n\t\tthis.x = this._get(0, \"x\", Number);\r\n\r\n\t\t/** @type{number} y */\r\n\t\tthis.y = this._get(0, \"y\", Number);\r\n\r\n\t\t/** @type{number} z */\r\n\t\tthis.z = this._get(0, \"z\", Number);\r\n\r\n\t\t/** @type{number} zM */\r\n\t\tthis.zM = this._get(0, \"zM\", Number);\r\n\r\n\t\t/** @type{number} flip */\r\n\t\tthis.f = this._get(0, \"f\", Number);\r\n\t\t\r\n\t\t/** @type{name} named object */\r\n\t\tthis.name = this._raw.name;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._url = null;//data url //debug\r\n\t}\r\n\t_load_back_info() {\r\n\t\t/** @type {number} move type */\r\n\t\tthis.typeb = this._get(0, \"type\", Number);\r\n\t\tif (this.typeb < 0 || this.typeb > 7) {\r\n\t\t\talert(\"MapBackBase.typeb: \" + this.typeb);\r\n\t\t\tconsole.warn(\"MapBackBase.typeb: \" + this.typeb);\r\n\t\t}\r\n\r\n\t\t/** @type {number} a */\r\n\t\tthis.a = this._get(0, \"a\", Number);\r\n\r\n\t\t/** @type {number} rx */\r\n\t\tthis.rx = this._get(0, \"rx\", Number);\r\n\r\n\t\t/** @type {number} ry */\r\n\t\tthis.ry = this._get(0, \"ry\", Number);\r\n\r\n\t\t/** @type {number} center y */\r\n\t\tthis.cx = this._get(0, \"cx\", Number);\r\n\r\n\t\t/** @type {number} center y */\r\n\t\tthis.cy = this._get(0, \"cy\", Number);\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.backTags = this._raw.backTags;\r\n\t}\r\n\t_load_tile_info() {\r\n\t\t/** @type{number} flow */\r\n\t\tthis.flow = this._get(0, \"flow\", Number);\r\n\t\t\r\n\t\tif (this.flow & 1 && !this.cx) {\r\n\t\t\tthis.cx = 1000;\r\n\t\t}\r\n\t\tif (this.flow & 2 && !this.cy) {\r\n\t\t\tthis.cy = 1000;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @returns {Promise}\r\n\t */\r\n\tload() {\r\n\t\tlet texture0 = this._load_texture(0, null);\r\n\t\tthis.textures[0] = texture0;\r\n\r\n\t\tfor (let i = 1; i in this._texture_raw; ++i) {//not array\r\n\t\t\tthis.textures[i] = this._load_texture(i, texture0);\r\n\t\t}\r\n\t\tthis.__calc_aabb();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @virtual\r\n\t * @param {number} i - texture index\r\n\t * @param {MapTexture} texture0\r\n\t */\r\n\t_load_texture() {\r\n\t\t//nothing\r\n\t}\r\n\t\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tunload() {\r\n\t\tthis.textures = [];\r\n\t}\r\n\t\r\n\t__calc_aabb() {\r\n\t\tif (this.textures.length >= 1) {\r\n\t\t\tlet mover = 0;\r\n\t\t\tfor (let i = 0; i < this.textures.length; ++i) {\r\n\t\t\t\tlet texture = this.textures[i];\r\n\t\t\t\tmover = mover | texture.mover;\r\n\t\t\t}\r\n\t\t\tconst aabb = this.compute_max_rectangle();\r\n\t\t\tif (mover) {\r\n\t\t\t\tconst r = Math.round(Math.sqrt(aabb.width ** 2 + aabb.height ** 2));\r\n\t\t\t\tconst hr = Math.round(r * 0.5);\r\n\t\t\t\tthis.aabb = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"](this.x - hr, this.y - hr, r, r);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.aabb = aabb;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {T} defaultValue\r\n\t * @param {string} propertyName\r\n\t * @param {function(any):T} constructor\r\n\t * @returns {T}\r\n\t * @template T\r\n\t */\r\n\t_get(defaultValue, propertyName, converter) {\r\n\t\tif (propertyName in this._raw) {\r\n\t\t\tif (converter) {\r\n\t\t\t\treturn converter(this._raw[propertyName]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn this._raw[propertyName];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn defaultValue;\r\n\t}\r\n\r\n\tupdate(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\r\n\t\tif (fc > 1) {\r\n\t\t\tthis.time = this.time + stamp;\r\n\r\n\t\t\tif (this.time > this.textures[this.frame].delay) {\r\n\t\t\t\tthis.frame = ++this.frame;\r\n\r\n\t\t\t\tthis.time = 0;\r\n\r\n\t\t\t\tif (this.frame >= fc) {\r\n\t\t\t\t\tthis.frame = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//this.frame = Math.trunc(this.time / 1000) % fc;\r\n\t\t}\r\n\r\n\t\tthis.delta += stamp;\r\n\r\n\t\tif ($gv.m_editor_mode && this.aabb) {\r\n\t\t\tthis.$editor_mouse();\r\n\t\t}\r\n\t}\r\n\t_update_and_preload(stamp) {\r\n\t\tconst fc = this.textures.length;\r\n\t\t\r\n\t\tif (fc > 1) {\r\n\t\t\tconst texture = this.textures[this.frame];\r\n\r\n\t\t\tthis.time = this.time + stamp;\r\n\t\t\t\r\n\t\t\tif (!texture.isLoaded()) {\r\n\t\t\t\ttexture.__loadTexture();\r\n\t\t\t}\r\n\r\n\t\t\tif (this.time > texture.delay) {\r\n\t\t\t\tthis.frame = ++this.frame;\r\n\r\n\t\t\t\tthis.time = 0;\r\n\r\n\t\t\t\tif (this.frame >= fc) {\r\n\t\t\t\t\tthis.frame = 0;\r\n\r\n\t\t\t\t\tdelete this.update;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst next_texture = this.textures[this.frame + 1];\r\n\t\t\tif (next_texture && !next_texture.isLoaded()) {\r\n\t\t\t\tnext_texture.__loadTexture();\r\n\t\t\t}\r\n\r\n\t\t\t//this.frame = Math.trunc(this.time / 1000) % fc;\r\n\t\t}\r\n\t\t\r\n\t\tthis.delta += stamp;\r\n\t\t\r\n\t\tif ($gv.m_editor_mode && this.aabb) {\r\n\t\t\tthis.$editor_mouse();\r\n\t\t}\r\n\t}\r\n\t$editor_mouse() {\r\n\t\tconst vrect = $gv.m_viewRect;\r\n\t\tconst mcx = $gv.m_viewRect.left + $gv.mouse_x;\r\n\t\tconst mcy = $gv.m_viewRect.top + $gv.mouse_y;\r\n\t\tif (this.typeb == 0 && this.aabb.collide4f2(mcx, mcy, 1, 1))\r\n\t\t{\r\n\t\t\tthis.display_aabb = true;\r\n\t\t\tif ($gv.mouse_dl == 1 && (window.m_selected_object != this || window.m_selected_object == null)) {\r\n\t\t\t\tthis.$select();\r\n\t\t\t}\r\n\t\t\telse if (window.m_hover_object == null) {\r\n\t\t\t\twindow.m_hover_object = this;\r\n\t\t\t\tthis.aabb_color = \"rgba(0,255,0,0.25)\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.aabb_color = \"rgba(0,0,255,0.25)\";\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$unselect();\r\n\t\t}\r\n\t\tif (window.m_selected_object == this) {\r\n\t\t\tthis.display_aabb = true;\r\n\t\t\tthis.aabb_color = \"rgba(255,0,0,0.5)\";\r\n\t\t}\r\n\t}\r\n\t$select() {\r\n\t\tif (window.m_selected_object) {\r\n\t\t\twindow.m_selected_object.$unselect();//prev\r\n\t\t}\r\n\t\twindow.m_selected_object = this;\r\n\t\twindow.m_hover_object = null;\r\n\t\t$gv.mouse_dl = 0;\r\n\t}\r\n\t$unselect() {\r\n\t\tthis.display_aabb = false;\r\n\t}\r\n\t$isRepeatX() {\r\n\t\treturn this.typeb == 1 || this.typeb == 4;\r\n\t}\r\n\t$isRepeatY() {\r\n\t\treturn this.typeb == 2 || this.typeb == 5;\r\n\t}\r\n\t\r\n\tcompute_rectangle(index) {\r\n\t\tconst texture = this.textures[index];\r\n\t\tif (texture) {\r\n\t\t\tconst width = texture.width;\r\n\t\t\tconst height = texture.height;\r\n\r\n\t\t\treturn new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"](this.x - (this.f ? -texture.x + width : texture.x), this.y - texture.y, width, height);\r\n\t\t}\r\n\t}\r\n\tcompute_max_rectangle() {\r\n\t\tif (this.textures.length > 0) {\r\n\t\t\tlet { left, top, right, bottom } = this.compute_rectangle(0);\r\n\t\t\t\t\r\n\t\t\tfor (let j = 1; j < this.textures.length; ++j) {\r\n\t\t\t\tlet rect = this.compute_rectangle(j);\r\n\t\t\t\t\r\n\t\t\t\tleft = Math.min(left, rect.left);\r\n\t\t\t\ttop = Math.min(top, rect.top);\r\n\t\t\t\tright = Math.max(right, rect.right);\r\n\t\t\t\tbottom = Math.max(bottom, rect.bottom);\r\n\t\t\t}\r\n\t\t\treturn _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"].parse(left, top, right, bottom);\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} index_of_texture\r\n\t * @param {number} mx - move x\r\n\t * @param {number} my - move x\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\t__draw_texture(renderer, index_of_texture, mx, my, viewRect) {\r\n\t\tif (true) {\r\n\t\t\tif ((--this.__max_repeat_count) <= 0) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif (this.typeb != 0 || (!this.aabb || this.aabb.collide(viewRect))) {\r\n\t\t\tlet texture = this.textures[index_of_texture];\r\n\r\n\t\t\tif (index_of_texture && !texture.isLoaded()) {\r\n\t\t\t\t// find loaded texture\r\n\t\t\t\tfor (let i = index_of_texture - 1; i >= 0; --i) {\r\n\t\t\t\t\ttexture = this.textures[index_of_texture];\r\n\t\t\t\t\tif (texture.isLoaded()) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttexture.draw(renderer, this.f, this.x + mx, this.y + my, this.time, this.delta);//MapleSceneTexture#draw\r\n\t\t}\r\n\t\t\r\n\t\tif ($gv.m_display_selected_object && $gv.m_editor_mode && this.aabb && this.display_aabb) {\r\n\t\t\tconst ctx = renderer.ctx;\r\n\t\t\tconst x = Math.trunc((-viewRect.left + 0.5) + this.aabb.left);\r\n\t\t\tconst y = Math.trunc((-viewRect.top + 0.5) + this.aabb.top);\r\n\t\t\t\r\n\t\t\trenderer.loadIdentity();\r\n\r\n\t\t\trenderer.globalAlpha = 1;\r\n\t\t\t\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.rect(x, y, this.aabb.width, this.aabb.height);\r\n\t\t\tctx.fillStyle = this.aabb_color || \"rgba(20,255,20,0.5)\";//\r\n\t\t\tctx.fill();\r\n\t\t\t\r\n\t\t\tctx.lineWidth = 3;\r\n\t\t\t//ctx.lineCap = \"round\";\r\n\r\n\t\t\tctx.setLineDash([3, 3]);\r\n\t\t\tctx.lineDashOffset = 0;\r\n\t\t\tctx.strokeStyle = \"rgba(0,0,0,0.5)\";\r\n\t\t\tctx.stroke();\r\n\r\n\t\t\tctx.setLineDash([3, 3]);\r\n\t\t\tctx.lineDashOffset = 3;\r\n\t\t\tctx.strokeStyle = \"rgba(255,255,255,0.5)\";\r\n\t\t\tctx.stroke();\r\n\r\n\t\t\tctx.setLineDash([]);\r\n\t\t\tctx.lineWidth = 1;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @protected\r\n\t * @param {IRenderer} renderer\r\n\t * @param {int} mx\r\n\t * @param {int} my\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\t__draw(renderer, mx, my, viewRect) {\r\n\t\tthis.__draw_texture(renderer, this.frame, mx, my, viewRect);//MapleSceneTexture#draw\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {boolean} horizontal\r\n\t * @param {boolean} vertical\r\n\t * @param {number} mx - int\r\n\t * @param {number} my - int\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\t_draw(renderer, horizontal, vertical, mx, my, viewRect) {\r\n\t\tlet texture = this.textures[this.frame];\r\n\t\tif (texture == null) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// viewRect - canvas rectangle\r\n\t\tlet { left, top, right, bottom } = viewRect;\r\n\t\t// image position\r\n\t\tlet ix = this.x - (this.f ? -texture.x + texture.width : texture.x);\r\n\t\tlet iy = this.y - texture.y;\r\n\t\t// tile size\r\n\t\tlet tw = 0 == this.cx ? texture.width : this.cx;\r\n\t\tlet th = 0 == this.cy ? texture.height : this.cy;\r\n\t\t// tile area\r\n\t\tlet x1 = left - (tw + (left - mx - ix) % tw);\r\n\t\tlet y1 = top - (th + (top - my - iy) % th);\r\n\t\tlet x2 = right + (tw - (right - mx - ix) % tw);\r\n\t\tlet y2 = bottom + (th - (bottom - my - iy) % th);\r\n\t\t\r\n\t\tif (true) {\r\n\t\t\tthis.__max_repeat_count = 1024;\r\n\t\t}\r\n\r\n\t\tif (horizontal)\r\n\t\t\tif (vertical)\r\n\t\t\t\tfor (let yy = y1; yy < y2; yy = yy + th)\r\n\t\t\t\t\tfor (let xx = x1; xx < x2; xx = xx + tw)\r\n\t\t\t\t\t\tthis.__draw(renderer, xx - ix, yy - iy, viewRect);\r\n\t\t\telse\r\n\t\t\t\tfor (let xx = x1; xx < x2; xx = xx + tw)\r\n\t\t\t\t\tthis.__draw(renderer, xx - ix, my, viewRect);\r\n\t\telse if (vertical)\r\n\t\t\tfor (let yy = y1; yy < y2; yy = yy + th)\r\n\t\t\t\tthis.__draw(renderer, mx, yy - iy, viewRect);\r\n\t\telse\r\n\t\t\tthis.__draw(renderer, mx, my, viewRect);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tif (!this.textures.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet mrx = (this.rx + 100) * center.x / 100;\r\n\t\tlet mry = (this.ry + 100) * center.y / 100;\r\n\r\n\t\tswitch (this.typeb) {\r\n\t\t\tcase 0: this._draw(renderer, false, false, mrx, mry, viewRect); break;\r\n\t\t\tcase 1: this._draw(renderer, true, false, mrx, mry, viewRect); break;\r\n\t\t\tcase 2: this._draw(renderer, false, true, mrx, mry, viewRect); break;\r\n\t\t\tcase 3: this._draw(renderer, true, true, mrx, mry, viewRect); break;\r\n\t\t\tcase 4: this._draw(renderer, true, false, Math.trunc(this.delta / 200 * this.rx), mry, viewRect); break;\r\n\t\t\tcase 5: this._draw(renderer, false, true, mrx, Math.trunc(this.delta / 200 * this.ry), viewRect); break;\r\n\t\t\tcase 6: this._draw(renderer, true, true, Math.trunc(this.delta / 200 * this.rx), mry, viewRect); break;\r\n\t\t\tcase 7: this._draw(renderer, true, true, mrx, Math.trunc(this.delta / 200 * this.ry), viewRect); break;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tget _texture_base_path() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n\r\nclass MapObject extends MapObjectBase {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t\t\r\n\t\tif (this._raw.cx != null && (!this._raw.ry || this._raw.ry == -100)) {\r\n\t\t\tif (this._raw.rx) {//!= null && != 0\r\n\t\t\t\tif (this._raw.cy != null) {\r\n\t\t\t\t\tthis.typeb = 6;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.typeb = 4;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.typeb = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this._raw.cy != null && (!this._raw.rx || this._raw.rx == -100)) {\r\n\t\t\tif (this._raw.ry) {//!= null && != 0\r\n\t\t\t\tif (this._raw.cx != null) {\r\n\t\t\t\t\tthis.typeb = 7;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.typeb = 5;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.typeb = 2;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.update = this._update_and_preload;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} i - texture index\r\n\t * @param {MapTexture} texture0\r\n\t * @returns {MapTexture}\r\n\t */\r\n\t_load_texture(i, texture0) {\r\n\t\tconst null_url = undefined;\r\n\t\tlet path = [\"/Map\", \"Obj\", this._texture_base_path, i].join(\"/\");\r\n\r\n\t\tlet texture = new MapTexture(this._texture_raw[i], null_url, texture0);\r\n\t\ttexture._url = path;\r\n\r\n\t\treturn texture;\r\n\t}\r\n\r\n\tget _texture_base_path() {\r\n\t\treturn [this._raw.oS, this._raw.l0, this._raw.l1, this._raw.l2].join(\"/\");\r\n\t}\r\n\r\n\t/**\r\n\t * raw data\r\n\t * textures; info & data\r\n\t */\r\n\tget _texture_raw() {\r\n\t\ttry {\r\n\t\t\treturn map_sprite.Obj[this._raw.oS][this._raw.l0][this._raw.l1][this._raw.l2];\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nclass MapParticle extends MapObject {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t\t/** @type {ParticleGroup[]} */\r\n\t\tthis.groups = [];\r\n\t}\r\n\t\r\n\tasync load(particle_name) {\r\n\t\tlet pg = new _Renderer_ParticleSystem_js__WEBPACK_IMPORTED_MODULE_8__[\"ParticleGroup\"]();\r\n\t\t\r\n\t\tawait pg.load(particle_name);\r\n\r\n\t\tlet keys = Object.keys(this._raw)\r\n\t\t\t.map(i => {\r\n\t\t\t\tlet n = parseInt(i, 10);\r\n\t\t\t\tif (Number.isSafeInteger(n)) {\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"MapParticle.\" + particle_name + \".id: \" + i);\r\n\t\t\t\treturn null;\r\n\t\t\t})\r\n\t\t\t.filter(i => i != null);\r\n\t\t\t\r\n\t\tfor (let i of keys) {\r\n\t\t\tthis.groups[i] = pg.clone();\r\n\t\t\tthis.groups[i].x = this._raw[i].x;\r\n\t\t\tthis.groups[i].y = this._raw[i].y;\r\n\t\t\tthis.groups[i].evaluate();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @param {number} stamp - time in millisecond */\r\n\tupdate(stamp) {\r\n\t\tfor (let i = 0; i < this.groups.length; ++i) {\r\n\t\t\tconst pg = this.groups[i];\r\n\t\t\tpg.update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tfor (let i = 0; i < this.groups.length; ++i) {\r\n\t\t\tconst pg = this.groups[i];\r\n\t\t\tlet mx = (this.rx + 100) * center.x / 100;\r\n\t\t\tlet my = (this.ry + 100) * center.y / 100;\r\n\t\t\tpg.render(renderer, viewRect, mx, my);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {{particle:{[name:string]:{}}}} mapRawData\r\n\t * @param {SceneMap} sceneMap\r\n\t */\r\n\tstatic construct(mapRawData, sceneMap) {\r\n\t\tlet tasks = [];\r\n\t\tlet particleList = [];\r\n\t\tfor (let particleName in mapRawData.particle) {\r\n\t\t\tlet particleRaw = mapRawData.particle[particleName];\r\n\t\t\tlet mpp = new MapParticle(particleRaw);\r\n\t\t\ttasks.push(mpp.load(particleName));\r\n\t\t\tparticleList.push(mpp);\r\n\t\t}\r\n\t\tsceneMap.particleList = particleList;\r\n\t\treturn tasks;\r\n\t}\r\n}\r\n\r\nclass MapObjectSkeletalAnim extends MapObject {\r\n\tconstructor(_raw, url) {\r\n\t\tsuper(_raw);\r\n\t\t/** @type {SSAnim} */\r\n\t\tthis.ssanim = null;\r\n\t\t/** @type {string} */\r\n\t\tthis._fname = null;\r\n\t\t\r\n\t\t///** @type{number} tags */\r\n\t\t//this._tags = this._get(0, \"tags\", String);\r\n\t}\r\n\t/** @type {string} */\r\n\tget _folder() {\r\n\t\tconst raw = this._raw;\r\n\t\t//[\"Obj\"\t ][obj.oS][obj.l0][obj.l1][obj.l2][0    ][\"\"]\r\n\t\treturn `/Map/Obj/${raw.oS}/${raw.l0}/${raw.l1}/${raw.l2}`;\r\n\t}\r\n\tasync load() {\r\n\t\tif (SSAnim) {\r\n\t\t\tconst raw = this._raw;\r\n\t\t\tlet ssanim;\r\n\t\t\t\r\n\t\t\tssanim = new SSAnim();\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tawait ssanim.load(this._folder);\r\n\t\t\t\tssanim.update(0);//init pos data\r\n\t\t\t}\r\n\t\t\tcatch (ex) {\r\n\t\t\t\tconsole.error(ex);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (raw.spineRandomStart) {\r\n\t\t\t\tlet t = ssanim.anim_length * Math.random();\r\n\t\t\t\tssanim.setAnimTime(t);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst r = Math.round(Math.sqrt(ssanim.width ** 2 + ssanim.height ** 2));\r\n\t\t\tconst hr = Math.round(r * 0.5);\r\n\t\t\tthis.aabb = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"](this.x - hr, this.y - hr, r, r);\r\n\t\t\t\r\n\t\t\tthis.ssanim = ssanim;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tunload() {\r\n\t\tif (this.ssanim) {\r\n\t\t\tthis.ssanim.unload();\r\n\t\t\tthis.ssanim = null;\r\n\t\t}\r\n\t}\r\n\tupdate(stamp) {\r\n\t\tthis.delta += stamp;\r\n\t\t\r\n\t\tif (this.ssanim && window.enable_skeletal_anim) {\r\n\t\t\tthis.ssanim.update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect - ?? no use\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tif ($gv.m_display_skeletal_anim) {\r\n\t\t\tconst x = Math.trunc((-$gv.m_viewRect.x + 0.5) + this.x);\r\n\t\t\tconst y = Math.trunc((-$gv.m_viewRect.y + 0.5) + this.y);\r\n\r\n\t\t\trenderer.ctx.setTransform(1, 0, 0, -1, x, y);\r\n\r\n\t\t\tif (this.ssanim) {\r\n\t\t\t\tthis.ssanim.render();\r\n\t\t\t}\r\n\t\t\tif (this.display_aabb) {\r\n\t\t\t\tconst ctx = renderer.ctx;\r\n\r\n\t\t\t\trenderer.ctx.setTransform(1, 0, 0, 1, Math.trunc(-$gv.m_viewRect.x + 0.5), Math.trunc(-$gv.m_viewRect.y + 0.5));\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.rect(this.x - this.ssanim.width * 0.5, this.y - this.ssanim.height, this.ssanim.width, this.ssanim.height);\r\n\t\t\t\tctx.fillStyle = \"rgba(20,255,20,0.5)\";\r\n\t\t\t\tctx.fill();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass MapTile extends MapObject {\r\n\tconstructor(_raw, info) {\r\n\t\tsuper(_raw);\r\n\t\tthis._info = info;\r\n\t\tthis.update = this._update_and_preload;\r\n\t}\r\n\tload() {\r\n\t\tlet texture = new MapTexture(this._texture_raw);\r\n\r\n\t\tthis.textures[0] = texture;\r\n\t\tthis.textures[0]._url = [\"/Map\", \"Tile\", this._info.tS, this._raw.u, this._raw.no].join(\"/\");\r\n\r\n\t\tthis.__calc_aabb();\r\n\t}\r\n\r\n\t/**\r\n\t * raw data\r\n\t * textures; info & data\r\n\t */\r\n\tget _texture_raw() {\r\n\t\ttry{\r\n\t\t\treturn map_sprite.Tile[this._info.tS][this._raw.u][this._raw.no];\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\t\r\n\tget _texture_base_path() {\r\n\t\treturn [this._info.tS, this._raw.u, this._raw.no].join(\"/\");\r\n\t}\r\n}\r\n\r\n/**\r\n * MapEditor: Map Portal\r\n * Map graph (struct): \"Map/Map/Graph/\"\r\n */\r\nclass MapPortal extends MapObject {\r\n\tconstructor(_raw, mapRenderer) {\r\n\t\tsuper(_raw);//load x, y\r\n\t\t\r\n\t\tthis.mapRenderer = mapRenderer;\r\n\t\t\r\n\t\t/** @type {number} - to mapId */\r\n\t\tthis.tm = null;\r\n\t\t\r\n\t\t/** @type {string} - tn to pn */\r\n\t\tthis.tn = null;\r\n\r\n\t\t/** @type {string} - pn to tn */\r\n\t\tthis.pn = null;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.script = null;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.enable = null;\r\n\t\t\r\n\t\t/** @type {\"portalStart\"|\"portalContinue\"|\"portalExit\"} */\r\n\t\tthis.state = null;\r\n\r\n\t\t/** @type {[\"portalStart\",\"portalContinue\",\"portalExit\"]} */\r\n\t\tthis.states = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.skin = null;\r\n\r\n\t\tthis.update = this._update_and_preload;\r\n\t}\r\n\t\r\n\t//sync\r\n\tload() {\r\n\t\tthis.tm = this._get(\"\", \"tm\", String).padStart(9, \"0\");//??\r\n\t\tthis.tn = this._get(\"\", \"tn\", String);//??\r\n\t\tthis.pn = this._get(\"\", \"pn\", String);//pt_go01 => goto portal_01\r\n\t\tthis.script = this._get(null, \"script\", String);\r\n\t\t\r\n\t\tthis.enable = this.tm != \"\" && this.tm != \"999999999\";\r\n\r\n\t\tthis._loadTexture();\r\n\t}\r\n\tunload() {\r\n\t\tif (this.body) {\r\n\t\t\tthis.body.GetWorld().DestroyBody(this.body);\r\n\t\t\tthis.body = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\tgetMap() {\r\n\t\tif (this.enable) {\r\n\t\t\treturn this.tm;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tif (this.enable) {\r\n\t\t\tsuper.draw(renderer, center, viewRect);\r\n\t\t}\r\n\t\telse if (this.__display_mode) {\r\n\t\t\tsuper.draw(renderer, center, viewRect);\r\n\t\t}\r\n\t}\r\n\r\n\t_loadTexture() {\r\n\t\t///** @type {number} */\r\n\t\t//let type = this._raw.pt;\r\n\t\t//\r\n\t\t//let skins = this._loaded_portals[this.__display_mode][type];\r\n\t\t//\r\n\t\t//this.textures = skins.default || skins[0];\r\n\r\n\t\t//MapObject::type\r\n\t\tif (this.__display_mode == \"game\") {\r\n\t\t\tthis.type = \"p\";//??\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.type = \"q\";//??\r\n\t\t}\r\n\r\n\t\tconst _raw = MapPortal._portals_raw;\r\n\r\n\t\tthis.textures.length = 0;//clear\r\n\r\n\t\tconst type = MapPortal._type_map[this._raw.pt];\r\n\t\t\r\n\t\tif (this.__display_mode == \"editor\") {\r\n\t\t\tlet texture = new MapTexture(_raw.editor[type]);\r\n\t\t\ttexture._url = [this._texture_base_path, this.__display_mode, type].join(\"/\");\r\n\t\t\tthis.textures[0] = texture;\r\n\t\t}\r\n\t\telse if (_raw.game[type]) {\r\n\t\t\tlet skin = this.skin != null ? this.skin : \"default\";\r\n\t\t\tif (\"0\" in _raw.game[type][skin]) {//is animation frames\r\n\t\t\t\tlet textures = _raw.game[type][skin];\r\n\t\t\t\tfor (let i in textures) {\r\n\t\t\t\t\tlet texture = new MapTexture(textures[i]);\r\n\t\t\t\t\ttexture._url = [this._texture_base_path, this.__display_mode, type, skin, i].join(\"/\");\r\n\t\t\t\t\tthis.textures.push(texture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//TODO: need default state\r\n\t\t\t\tthis.states = Object.keys(_raw.game[type][skin]);\r\n\t\t\t\tthis.state = this.states[1 % this.states.length];\r\n\r\n\t\t\t\tlet textures = _raw.game[type][skin][this.state];\r\n\t\t\t\tfor (let i in textures) {\r\n\t\t\t\t\tlet texture = new MapTexture(textures[i]);\r\n\t\t\t\t\ttexture._url = [this._texture_base_path, this.__display_mode, type, skin, this.state, i].join(\"/\");\r\n\t\t\t\t\tthis.textures.push(texture);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//reset\r\n\t\tthis.delta = 0;\r\n\t\tthis.time = 0;\r\n\t\tthis.frame = 0;\r\n\t}\r\n\r\n\tget _texture_base_path() {\r\n\t\treturn \"/Map/MapHelper/portal\";\r\n\t}\r\n\tget _getTexturePath() {\r\n\t\tif (this.__display_mode == \"editor\") {\r\n\t\t\treturn [\"/Map/MapHelper/portal\", this.__display_mode].join(\"/\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn [\"/Map/MapHelper/portal\", this.__display_mode].join(\"/\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @returns {\"editor\"|\"game\"}\r\n\t */\r\n\tget __display_mode() {\r\n\t\treturn $gv.m_editor_mode ? \"editor\" : \"game\";\r\n\t}\r\n\r\n\t///**\r\n\t// * @type {{editor:{[pt:number]:{[skin:number]:MapTexture}},game:{[pt:number]:{[skin:number]:MapTexture[],default:MapTexture[]}}}}\r\n\t// */\r\n\t//get _loaded_portals() {\r\n\t//\treturn MapPortal._portals;\r\n\t//}\r\n\t\r\n\tstatic async Init() {\r\n\t\tMapPortal._portals_raw = await $get.data(\"/Map/MapHelper/portal\");\r\n\r\n\t\tMapPortal._type_map = Object.keys(MapPortal._portals_raw.editor);\r\n\t}\r\n}\r\nMapPortal._portals_raw = {};\r\nMapPortal._type_map = {};\r\n//MapPortal._portals = {};\r\nMapPortal._script = {};\r\n\r\nclass MapPortalManager {\r\n\tconstructor() {\r\n\t\t/** @type {MapPortal[]} */\r\n\t\tthis.portals = null;\r\n\r\n\t\tthis.__display_mode = this.__display_mode;\r\n\t}\r\n\t\r\n\tasync load(map_raw_data, mapRenderer) {\r\n\t\tlet portals = [];\r\n\t\tfor (let i = 0; i in map_raw_data.portal; ++i) {\r\n\t\t\tlet raw = map_raw_data.portal[i];\r\n\t\t\tlet pt = new MapPortal(raw, mapRenderer);\r\n\t\t\t\r\n\t\t\tpt.load();//sync\r\n\t\t\t\r\n\t\t\t//if (pt.enable) {\r\n\t\t\t\tmapRenderer.controller.createPortal(pt);//inject body\r\n\t\t\t//}\r\n\t\t\t\r\n\t\t\tportals.push(pt);\r\n\t\t}\r\n\t\tthis.portals = portals;\r\n\t}\r\n\tunload() {\r\n\t\tfor (let i = 0; i < this.portals.length; ++i) {\r\n\t\t\tlet ptl = this.portals[i];\r\n\t\t\tptl.unload();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.__display_mode != $gv.m_editor_mode) {\r\n\t\t\tthis.__display_mode = $gv.m_editor_mode;\r\n\r\n\t\t\tfor (let i = 0; i < this.portals.length; ++i) {\r\n\t\t\t\tlet portal = this.portals[i];\r\n\t\t\t\tportal._loadTexture();\r\n\t\t\t\tportal.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfor (let i = 0; i < this.portals.length; ++i) {\r\n\t\t\t\tlet portal = this.portals[i];\r\n\t\t\t\tportal.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tfor (let i = 0; i < this.portals.length; ++i) {\r\n\t\t\tlet portal = this.portals[i];\r\n\t\t\tportal.draw(renderer, center, viewRect);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//          [category][source]\r\n//\r\n//static back\r\n//imgBack = [category][source][class ][number][\"\"]\r\n//imgBack = [\"Back\"  ][obj.bS][\"bacK\"][obj.no][\"\"]\r\n//\r\n//animation back\r\n//imgBack = [category][source][class ][number][frame][\"\"]\r\n//imgBack = [\"Back\"  ][obj.bS][\"ani\" ][obj.no][0    ][\"\"]\r\n//\r\n//object\r\n//imgObj  = [category][source][path_0][path_1][path_2][frame][\"\"]\r\n//imgObj  = [\"Obj\"\t ][obj.oS][obj.l0][obj.l1][obj.l2][0    ][\"\"]\r\n\r\nclass MapBackBase extends MapObjectBase {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t}\r\n}\r\n\r\n/**\r\n * @implements {IAsyncLoading}\r\n */\r\nclass MapBack extends MapBackBase {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t\tthis.update = this._update_and_preload;\r\n\t}\r\n\r\n\tload() {\r\n\t\tlet path = [\"/Map\", \"Back\", this._texture_base_path].join(\"/\");\r\n\r\n\t\tif (this._raw.bS) {\r\n\t\t\tconst raw = this._texture_raw;\r\n\t\t\tif (raw) {\r\n\t\t\t\tthis.textures[0] = new MapTexture(this._texture_raw);\r\n\t\t\t\tthis.textures[0]._url = path;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn(\"MapBack path ?: \" + path);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget _texture_base_path() {\r\n\t\treturn [this._raw.bS, \"back\", this._raw.no].join(\"/\");\r\n\t}\r\n\r\n\t/**\r\n\t * raw data\r\n\t * texture; info & data\r\n\t */\r\n\tget _texture_raw() {\r\n\t\tif (this._raw.bS && this._raw.no) {\r\n\t\t\treturn map_sprite.Back[this._raw.bS][\"back\"][this._raw.no];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\n/**\r\n * @implements {IAsyncLoading}\r\n */\r\nclass MapBackAnimation extends MapBackBase {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t\tthis.update = this._update_and_preload;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} i - texture index\r\n\t * @param {MapTexture} texture0\r\n\t * @returns {MapTexture}\r\n\t */\r\n\t_load_texture(i, texture0) {\r\n\t\tlet path = [\"/Map\", \"Back\", this._texture_base_path, i].join(\"/\");\r\n\r\n\t\tlet texture = new MapTexture(this._texture_raw[i]);\r\n\t\ttexture._url = path;\r\n\r\n\t\treturn texture;\r\n\t}\r\n\t\r\n\tget _texture_base_path() {\r\n\t\treturn [this._raw.bS, \"ani\", this._raw.no].join(\"/\");\r\n\t}\r\n\r\n\t/**\r\n\t * raw data\r\n\t * texture set; info & data\r\n\t * not array\r\n\t */\r\n\tget _texture_raw() {\r\n\t\ttry {\r\n\t\t\treturn map_sprite.Back[this._raw.bS][\"ani\"][this._raw.no];\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nclass MapBackSkeletalAnim extends MapBackBase {\r\n\tconstructor(_raw) {\r\n\t\tsuper(_raw);\r\n\t\t/** @type {SSAnim} */\r\n\t\tthis.ssanim = null;\r\n\t}\r\n\t/** @type {string} */\r\n\tget _folder() {\r\n\t\tconst ob = this._raw;\r\n\t\t//[\"Back\"  ][obj.bS][\"ani\" ][obj.no][0    ][\"\"]\r\n\t\treturn `/Map/Back/${ob.bS}/spine/${ob.no}`;\r\n\t}\r\n\tasync load() {\r\n\t\tif (SSAnim) {\r\n\t\t\tlet ssanim = new SSAnim();\r\n\t\t\ttry {\r\n\t\t\t\tawait ssanim.load(this._folder);\r\n\t\t\t\tssanim.update(0);//init pos data\r\n\t\t\t}\r\n\t\t\tcatch (ex) {\r\n\t\t\t\tconsole.error(ex);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.ssanim = ssanim;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\tunload() {\r\n\t\tif (this.ssanim) {\r\n\t\t\tthis.ssanim.unload();\r\n\t\t\tthis.ssanim = null;\r\n\t\t}\r\n\t}\r\n\tupdate(stamp) {\r\n\t\tif (this.ssanim && window.enable_skeletal_anim) {\r\n\t\t\tthis.ssanim.update(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect - ?? no use\r\n\t */\r\n\tdraw(renderer, center, viewRect) {\r\n\t\tif ($gv.m_display_skeletal_anim) {\r\n\t\t\tif (this.ssanim) {\r\n\t\t\t\tconst x = Math.trunc((-$gv.m_viewRect.x + 0.5) + this.x);\r\n\t\t\t\tconst y = Math.trunc((-$gv.m_viewRect.y + 0.5) + this.y);\r\n\r\n\t\t\t\trenderer.ctx.setTransform(1, 0, 0, -1, x, y);\r\n\r\n\t\t\t\tthis.ssanim.render();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nclass LifeSpawnPoint {\r\n\t/**\r\n\t * @param {object} raw\r\n\t * @param {string} spawnId - spawn index\r\n\t */\r\n\tconstructor(raw, spawnId) {\r\n\t\tObject.assign(this, raw);\r\n\t\t\r\n\t\tthis.spawnId = spawnId;\r\n\t\t\r\n\t\t/**\r\n\t\t * millisecond elapsed after life spawn\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/**\r\n\t\t * now count of life was spawn\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.count = 0;\r\n\r\n\t\tif (!(raw instanceof LifeSpawnPoint)) {\r\n\t\t\tthis.fh = raw.fh - 1;\r\n\t\t}\r\n\t}\r\n\tincreaseLife() {\r\n\t\t++this.count;\r\n\t\tthis.time = 0;\r\n\t}\r\n\tdecreaseLife() {\r\n\t\t--this.count;\r\n\t\tthis.time = 0;\r\n\t}\r\n\tgetTimeElapsedAfterLifeSpawn() {\r\n\t\treturn this.time;\r\n\t}\r\n\tgetNowCountOfLifeWasSpawn() {\r\n\t\treturn this.count;\r\n\t}\r\n\t/**\r\n\t * @returns {LifeSpawnPoint}\r\n\t */\r\n\tclone() {\r\n\t\treturn new this.constructor(this);\r\n\t}\r\n}\r\n\r\n/**\r\n * Mob / NPC controller\r\n */\r\nclass MapLifeEntity extends _SceneObject_js__WEBPACK_IMPORTED_MODULE_12__[\"SceneObject\"] {\r\n\t/**\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint\r\n\t * @param {number} lifeId - life index\r\n\t */\r\n\tconstructor(lifeSpawnPoint, lifeId) {\r\n\t\tsuper();\r\n\t\tlet a = {\r\n\t\t\ttype: \"m\",\r\n\t\t\tid: 8643000,\r\n\t\t\tx: 720,\r\n\t\t\ty: -771,\r\n\t\t\tmobTime: 0,\r\n\t\t\tf: 0,\r\n\t\t\thide: 0,\r\n\t\t\tfh: 41 - 1,\r\n\t\t\tcy: -761,\r\n\t\t\trx0: 647,\r\n\t\t\trx1: 720,\r\n\t\t};\r\n\r\n\t\t/** @type {LifeRenderer} LifeRenderer|MobRenderer|NpcRenderer */\r\n\t\tthis.renderer = null;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_dead = false;\r\n\r\n\t\t/** @type {LifeSpawnPoint} */\r\n\t\tthis.spawn = lifeSpawnPoint;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.x = lifeSpawnPoint.x;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.y = lifeSpawnPoint.cy;//lifeSpawnPoint.y\r\n\t\t\r\n\t\tthis.z = 5;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.angle = 0;\r\n\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis.front = Number(lifeSpawnPoint.f) ? 1 : -1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.opacity = Number(lifeSpawnPoint.hide) ? 0.5 : 1;\r\n\t\t\r\n\t\tthis.lifeId = lifeId;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.type = lifeSpawnPoint.type;\r\n\r\n\t\t///** @type {string} */\r\n\t\t//this.id = lifeSpawnPoint.id;\r\n\r\n\t\t///** @type {number} */\r\n\t\t//this.mobTime = lifeSpawnPoint.mobTime;\r\n\r\n\t\t/////** @type {number} */\r\n\t\t////this.cy = lifeSpawnPoint.cy;\r\n\r\n\t\t///** @type {number} */\r\n\t\t//this.rx0 = lifeSpawnPoint.rx0;\r\n\r\n\t\t///** @type {number} */\r\n\t\t//this.rx1 = lifeSpawnPoint.rx1;\r\n\t}\r\n\r\n\t//AfterStep\r\n\t//get x() {\r\n\t//\treturn this._x;\r\n\t//}\r\n\t//set x(x) {\r\n\t//\tthis._x = x;\r\n\t//}\r\n\t//get y() {\r\n\t//\treturn this._y;\r\n\t//}\r\n\t//set y(y) {\r\n\t//\tthis._y = y;\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint\r\n\t * @param {World} mapController\r\n\t * @param {number} lifeId - life index\r\n\t */\r\n\tstatic Create(lifeSpawnPoint, mapController, lifeId) {\r\n\t\tlet life;\r\n\r\n\t\tif (lifeSpawnPoint.type == \"m\") {\r\n\t\t\tlife = new MapMob(lifeSpawnPoint, lifeId);\r\n\t\t}\r\n\t\telse if (lifeSpawnPoint.type == \"n\") {\r\n\t\t\tlife = new MapNpc(lifeSpawnPoint, lifeId);\r\n\t\t\t//return;\r\n\t\t}\r\n\t\telse {\r\n\t\t\talert(\"map life type: \" + lifeSpawnPoint.type);\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (life) {\r\n\t\t\tlife.load(lifeSpawnPoint.id, mapController);\r\n\t\t}\r\n\r\n\t\treturn life;\r\n\t}\r\n\t\r\n\t/**\r\n\t * load life description\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint - {id: string, type:\"m\"||\"n\"}\r\n\t */\r\n\tstatic async loadLifeDesc(lifeSpawnPoint) {\r\n\t\tlet desc, id = lifeSpawnPoint.id;\r\n\t\t\r\n\t\tswitch (lifeSpawnPoint.type) {\r\n\t\t\tcase \"m\":\r\n\t\t\t\tdesc = _Renderer_MobRenderer_js__WEBPACK_IMPORTED_MODULE_6__[\"MobRenderer\"].loadDescription(id);\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"n\":\r\n\t\t\t\tdesc = _Renderer_NpcRenderer_js__WEBPACK_IMPORTED_MODULE_7__[\"NpcRenderer\"].loadDescription(id);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\talert(\"map life type: \" + lifeSpawnPoint.type);\r\n\t\t\t\tdebugger;\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\treturn desc;\r\n\t}\r\n\r\n\t/**\r\n\t * create entity, load data\r\n\t * @param {string} id -  npc or mob id\r\n\t * @param {World} mapController - no use\r\n\t */\r\n\tasync load(id, mapController) {//??: rename to create\r\n\t\tif (this.renderer) {\r\n\t\t\tawait this.renderer.load(id);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t\talert(\"Unknow type of life in map\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t_destroy(mapController) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * set die animation\r\n\t * @param {number} type\r\n\t */\r\n\tdie(type) {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t\tthis.is_dead = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.renderer.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tdraw(renderer) {\r\n\t\trenderer.globalAlpha = Math.max(0, Math.min(this.opacity, 1));\r\n\t\tthis.renderer.draw(renderer, this.x, this.y, this.angle, this.front < 0);\r\n\t}\r\n}\r\nclass MapMob extends MapLifeEntity {\r\n\t/**\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint\r\n\t * @param {number} lifeId - life index\r\n\t */\r\n\tconstructor(lifeSpawnPoint, lifeId) {\r\n\t\tsuper(lifeSpawnPoint, lifeId);\r\n\t\tthis.renderer = new _Renderer_MobRenderer_js__WEBPACK_IMPORTED_MODULE_6__[\"MobRenderer\"]();\r\n\r\n\t\t/** @type {PMob} */\r\n\t\tthis.$physics = null;\r\n\t\t\r\n\t\t/** @type {{[x:string]: object}} - {[level]: skill} */\r\n\t\tthis.skills = {};\r\n\r\n\t\t//TODO: load mob info\r\n\t\tthis.hp = 100000;\r\n\t}\r\n\t/**\r\n\t * @param {string} id mobId\r\n\t * @param {World} mapController\r\n\t */\r\n\tasync load(id, mapController) {//??: rename to create\r\n\t\tawait super.load(id);\r\n\r\n\t\tthis.$physics = mapController.createMob(this);\r\n\t\tthis.$physics._loadAction(this.renderer.actions);\r\n\t\t\r\n\t\tawait this._load_skill_by_mob_id(id);\r\n\r\n\t\t// experiment\r\n\t\ttry {\r\n\t\t\tthis._load_skill_info();\r\n\r\n\t\t\tconst firstAttack = this.renderer._raw.info.attack[this.renderer._raw.info.firstAttack].info;\r\n\t\t\tif (this.skill_map[firstAttack]) {\r\n\t\t\t\tconst firstSkillInfo = this.skill_map[firstAttack].skill_list[0];\r\n\r\n\t\t\t\tthis.invokeSkill(firstSkillInfo.skill, firstSkillInfo.level);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\t//not thing\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {SceneObject} chara - 被 chara 攻擊\r\n\t * @param {number} damage - 傷害\r\n\t */\r\n\tdamage(chara, damage) {\r\n\t\tif (!this.is_dead) {\r\n\t\t\tthis.hp -= damage;\r\n\r\n\t\t\tconsole.log(`Mob(${this.$objectid}) 被 ${chara.$objectid} 攻擊，減少 ${damage} HP，剩下 ${this.hp}`);\r\n\t\t\t\r\n\t\t\tif (this.hp <= 0) {\r\n\t\t\t\tthis.die();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * if (chara == null) ??\r\n\t * @param {SceneObject|null} chara - 被 chara 攻擊\r\n\t * @param {number} moveX - unit is pixel\r\n\t * @param {number} moveY - unit is pixel\r\n\t */\r\n\tknockback(chara, moveX, moveY) {\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PPlayerState} pState\r\n\t */\r\n\t_applyState(pState) {\r\n\t\t//move stand jump hit1 die1\r\n\r\n\t\tif (pState.jump) {\r\n\t\t\tthis.renderer.action = \"jump\";\r\n\t\t}\r\n\t\telse if (pState.walk) {\r\n\t\t\tthis.renderer.action = \"move\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.renderer.action = \"stand\";\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.$physics) {\r\n\t\t\tif (!this.is_dead) {\r\n\t\t\t\tthis._applyState(this.$physics.state);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.$physics.stop();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.renderer.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tdraw(renderer) {\r\n\t\tif ($gv.m_display_mob) {\r\n\t\t\tsuper.draw(renderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/* skill need map to action */\r\n\t_load_skill_info() {\r\n\t\tconst _raw = this.renderer._raw;\r\n\t\tlet attack = _raw.info.attack;\r\n\t\tlet skill = _raw.info.skill;\r\n\t\t\r\n\t\tattack[1].info == _raw.info.skill[0].info\r\n\t\tattack[1].info == _raw.skill1.info\r\n\t\t\r\n\t\tvar skill_map = {};\r\n\t\tfor (let i = 1, sname; (sname = \"skill\" + i) in _raw; ++i) {\r\n\t\t\tlet s = _raw[sname];\r\n\t\t\tif (s.info) {\r\n\t\t\t\tskill_map[s.info] = {\r\n\t\t\t\t\tanim: sname,\r\n\t\t\t\t\tskill_list: [],\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar skill_info = {};\r\n\t\tfor (let i in _raw.info.skill) {\r\n\t\t\tlet si = _raw.info.skill[i];\r\n\t\t\tskill_info[si.skill + \".\" + si.level] = si;\r\n\t\t\tif (skill_map[si.info]) {\r\n\t\t\t\tskill_info[si.skill + \".\" + si.level].$anim = skill_map[si.info].anim;\r\n\t\t\t\tskill_map[si.info].skill_list.push(si);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tthis.skill_map = skill_map;\r\n\t\tthis.skill_info = skill_info;\r\n\t}\r\n\t\r\n\t_load_skill_by_mob_id(mob_id) {\r\n\t\tlet tasks = [];\r\n\t\tswitch(mob_id) {\r\n\t\t\tcase \"8880140\":\r\n\t\t\tcase \"8880141\": {\r\n\t\t\t\t\tconst FlowerTrap = __webpack_require__(/*! ./MobSkill/238.FlowerTrap.js */ \"./src/game/MobSkill/238.FlowerTrap.js\").FlowerTrap;\r\n\t\t\t\t\tconst FairyDust = __webpack_require__(/*! ./MobSkill/238.FairyDust.js */ \"./src/game/MobSkill/238.FairyDust.js\").FairyDust;\r\n\t\t\t\t\tthis.skills = {\r\n\t\t\t\t\t\t[1]: new FlowerTrap(),\r\n\t\t\t\t\t\t[2]: new FlowerTrap(),\r\n\t\t\t\t\t\t[3]: new FlowerTrap(),\r\n\t\t\t\t\t\t[4]: new FairyDust(null, null),\r\n\t\t\t\t\t\t[5]: { load() {}, invoke: function (level) { console.info(\"invoke LaserRain\"); } },\r\n\t\t\t\t\t\t[6]: { load() {}, invoke: function (level) { console.info(\"invoke ForcedTelepor\"); } },\r\n\t\t\t\t\t\t[7]: { load() {}, invoke: function (level) { console.info(\"invoke Dragon\"); } },\r\n\t\t\t\t\t\t[8]: { load() {}, invoke: function (level) { console.info(\"invoke Rush\"); } },\r\n\t\t\t\t\t\t[9]: { load() {}, invoke: function (level) { console.info(\"invoke WelcomeBarrage\"); } },\r\n\t\t\t\t\t\t[10]: new FairyDust(null, null),\r\n\t\t\t\t\t};\r\n\t\t\t\t\tthis.skill_map_action = [];\r\n\t\t\t\t\tfor (let i = 1; i <= 10; ++i) {\r\n\t\t\t\t\t\tswitch (i) {\r\n\t\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\tcase 10:\r\n\t\t\t\t\t\t\t\tthis.skill_map_action[i] = \"skill1\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 6:\r\n\t\t\t\t\t\t\t\tthis.skill_map_action[i] = \"skill4\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 7:\r\n\t\t\t\t\t\t\t\tthis.skill_map_action[i] = \"skill2\";\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 8:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 9:\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tfor (let lev in this.skills) {\r\n\t\t\tconst skill = this.skills[lev];\r\n\t\t\ttasks.push(skill.load(lev));\r\n\t\t}\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\t\r\n\tinvokeSkill(skill_id, level) {\r\n\t\tconst skill = this.skills[level];\r\n\t\tif (skill) {\r\n\t\t\tconst anim = this.skill_map_action[level];\r\n\t\t\tif (anim) {\r\n\t\t\t\tthis.renderer.action = anim;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tskill.invoke(level);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.warn({ \"unknow skill\": skill_id, \"level\": level });\r\n\t\t}\r\n\t}\r\n\t\r\n\t_destroy(mapController) {\r\n\t\tlet lifeSpawnPoint = this.spawn;\r\n\t\tif (lifeSpawnPoint instanceof LifeSpawnPoint) {\r\n\t\t\tlifeSpawnPoint.decreaseLife();\r\n\t\t}\r\n\t\tmapController.destroyMob(this);\r\n\t\tthis.renderer = null;\r\n\t}\r\n\r\n\t/**\r\n\t * set die animation\r\n\t * @param {number=1} type\r\n\t */\r\n\tdie(type = 1) {\r\n\t\tthis.renderer.action = \"die\" + type;\r\n\t\tthis.is_dead = true;\r\n\t}\r\n}\r\n\r\nclass MapNpc extends MapLifeEntity {\r\n\t/**\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint\r\n\t * @param {number} lifeId - life index\r\n\t */\r\n\tconstructor(lifeSpawnPoint, lifeId) {\r\n\t\tsuper(lifeSpawnPoint, lifeId);\r\n\t\tthis.renderer = new _Renderer_NpcRenderer_js__WEBPACK_IMPORTED_MODULE_7__[\"NpcRenderer\"]();\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tdraw(renderer) {\r\n\t\tif ($gv.m_display_npc) {\r\n\t\t\tsuper.draw(renderer);\r\n\t\t}\r\n\t}\r\n\r\n\t_destroy(mapController) {\r\n\t\tlet lifeSpawnPoint = this.spawn;\r\n\t\tlifeSpawnPoint.decreaseLife();\r\n\t\tmapController.destroyNpc(this);\r\n\t\tthis.renderer = null;\r\n\t}\r\n\r\n\t/**\r\n\t * set die animation\r\n\t * @param {number} type\r\n\t */\r\n\tdie(type) {\r\n\t\t//TODO: npc die ??\r\n\t\tthis.is_dead = true;\r\n\t}\r\n}\r\n\r\nlet MapLifeEntityCapacityRate = 1;\r\n\r\nclass MapLifeManager {\r\n\t/**\r\n\t * @param {World} mapController\r\n\t */\r\n\tconstructor(mapController) {\r\n\t\t/** @type {object} */\r\n\t\tthis._raw = null;\r\n\r\n\t\t/** @type {LifeSpawnPoint[]} */\r\n\t\tthis.spawnPoints = [];\r\n\r\n\t\t/** @type {MapMob[]} */\r\n\t\tthis.entities = [];\r\n\r\n\t\t/** @type {World} */\r\n\t\tthis.mapController = mapController;\r\n\t}\r\n\r\n\t/**\r\n\t * @async\r\n\t * @param {{life:{[spawnId:number]:{}}}} mapRawData\r\n\t * @returns {Promise<undefined[]>}\r\n\t */\r\n\tload(mapRawData) {\r\n\t\tlet tasks = [];\r\n\t\tthis._raw = mapRawData.life;\r\n\r\n\t\tlet keys = Object.keys(this._raw)\r\n\t\t\t.map(i => {\r\n\t\t\t\tlet n = parseInt(i, 10);\r\n\t\t\t\tif (Number.isSafeInteger(n)) {\r\n\t\t\t\t\treturn n;\r\n\t\t\t\t}\r\n\t\t\t\tconsole.warn(\"MapLife.spawnId: \" + i);\r\n\t\t\t\treturn null;\r\n\t\t\t})\r\n\t\t\t.filter(i => i != null);\r\n\r\n\t\tfor (let spawnId of keys) {\r\n\t\t\tlet d = new LifeSpawnPoint(this._raw[spawnId], spawnId);\r\n\t\t\ttasks.push(MapLifeEntity.loadLifeDesc(d));\r\n\t\t\tthis.spawnPoints.push(d);\r\n\t\t}\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\r\n\tunload() {\r\n\t\tfor (let i = 0; i < this.entities.length; ++i) {\r\n\t\t\tconst entity = this.entities[i];\r\n\t\t\tif (entity.spawn.type == \"m\") {\r\n\t\t\t\tentity.$physics._destroy(this.mapController);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.spawnPoints = [];\r\n\t\tthis.entities = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tfor (let i = 0; i < this.spawnPoints.length; ++i) {\r\n\t\t\tlet lifeSpawnPoint = this.spawnPoints[i];\r\n\r\n\t\t\tlifeSpawnPoint.time += stamp;\r\n\r\n\t\t\tif (lifeSpawnPoint.time >= 1000 && lifeSpawnPoint.count < MapLifeEntityCapacityRate) {\r\n\t\t\t\tlifeSpawnPoint.increaseLife();\r\n\t\t\t\tthis.spawn(lifeSpawnPoint);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (let i = 0; i < this.entities.length; ++i) {\r\n\t\t\tlet entity = this.entities[i];\r\n\t\t\tif (entity) {\r\n\t\t\t\tif (entity.renderer.action && entity.renderer.action.startsWith(\"die\")) {\r\n\t\t\t\t\tconst act = entity.renderer.actions[entity.renderer.action];\r\n\t\t\t\t\tif (act && act.isEnd()) {\r\n\t\t\t\t\t\tthis.destroyLife(entity);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tentity.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * spawn life(npc / mob) by spawner\r\n\t * @param {LifeSpawnPoint} lifeSpawnPoint\r\n\t */\r\n\tspawn(lifeSpawnPoint) {\r\n\t\tlet lifeId = 0;\r\n\r\n\t\tfor (; lifeId < this.entities.length; ++lifeId) {\r\n\t\t\tif (!this.entities[lifeId]) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet entity = MapLifeEntity.Create(lifeSpawnPoint, this.mapController, lifeId);\r\n\t\t\r\n\t\tif (lifeId < this.entities.length) {\r\n\t\t\tthis.entities[lifeId] = entity;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.entities.push(entity);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * directly spawn npc\r\n\t * @param {string} npcID\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tspawnNpc(npcID, x, y, flip=false, fh=0) {\r\n\t\tlet lifeSpawnPoint = new LifeSpawnPoint({\r\n\t\t\ttype: \"n\",\r\n\t\t\tx: x | 0, y: y | 0, cy: y | 0,\r\n\t\t\tid: npcID,\r\n\t\t\tfh: fh,\r\n\t\t\tis_dummy: true,\r\n\t\t});\r\n\t\tthis.spawn(lifeSpawnPoint);\r\n\t}\r\n\t/**\r\n\t * directly spawn mob\r\n\t * @param {string} mobID\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tspawnMob(mobID, x, y, flip=false, fh=0) {\r\n\t\tlet lifeSpawnPoint = new LifeSpawnPoint({\r\n\t\t\ttype: \"m\",\r\n\t\t\tx: x | 0, y: y | 0, cy: y | 0,\r\n\t\t\tid: mobID,\r\n\t\t\tfh: fh,\r\n\t\t\tis_dummy: true,\r\n\t\t});\r\n\t\tthis.spawn(lifeSpawnPoint);\r\n\t}\r\n\t\r\n\tdestroyLife(entity) {\r\n\t\tif (!(entity instanceof MapLifeEntity)) {\r\n\t\t\talert(\"MapLifeManager.killLife: can't kill non life\");\r\n\t\t\tconsole.error(\"MapLifeManager.killLife: can't kill non life\");\r\n\t\t}\r\n\t\tentity._destroy(this.mapController);\r\n\t\tdelete this.entities[entity.lifeId];\r\n\t}\r\n\tdestroyAll() {\r\n\t\tthis.entities.forEach(a => this.destroyLife(a))\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Vec2} center\r\n\t * @param {Rectangle} viewRect\r\n\t * @param {number} whereLayer - where layer index\r\n\t */\r\n\tdraw(renderer, center, viewRect, whereLayer) {\r\n\t\tfor (let i = 0; i < this.entities.length; ++i) {\r\n\t\t\tlet entity = this.entities[i];\r\n\t\t\tif (entity && ((entity.z != null && entity.z == whereLayer) || whereLayer == null)) {\r\n\t\t\t\tentity.draw(renderer);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * require Renderer\r\n * @implements {IAsyncLoading}\r\n */\r\nclass SceneMap {\r\n\tconstructor() {\r\n\t\t/** @type {number} */\r\n\t\tthis.stamp = 0;\r\n\r\n\t\t/** @type {MapBack[]} */\r\n\t\tthis.background = [];\r\n\r\n\t\t/** @type {MapBack[]} */\r\n\t\tthis.frontground = [];\r\n\r\n\t\t/** @type {MapObject[]} */\r\n\t\tthis.layeredObject = [];\r\n\r\n\t\t/** @type {MapTile[]} */\r\n\t\tthis.layeredTile = [];\r\n\t\t\r\n\t\t/** @type {{[tag:string]:MapBackBase}} */\r\n\t\tthis.backTags = {};\r\n\t\t\r\n\t\t/** @type {{[name:string]:MapObject}} */\r\n\t\tthis.namedObject = {};\r\n\r\n\t\t/** @type {World} */\r\n\t\tthis.controller = new _Physics_World_js__WEBPACK_IMPORTED_MODULE_9__[\"World\"]();\r\n\r\n\t\t/** @type {MapLifeManager} */\r\n\t\tthis.lifeMgr = new MapLifeManager(this.controller);\r\n\t\t\r\n\t\t/** @type {MapPortalManager} */\r\n\t\tthis.portalMgr = new MapPortalManager();\r\n\t\t\r\n\t\t/** @type {MapParticle[]} */\r\n\t\tthis.particleList = null;\r\n\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis.mapBound = null;\r\n\r\n\t\t/** @type {{[questId:string]: number}} */\r\n\t\tthis.quest = {};\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._url = null;//data url //debug\r\n\r\n\t\t/** @type {Promise<any>[]} */\r\n\t\tthis.$load_tasks = [];\r\n\r\n\t\t/** @type {Promise<any>} */\r\n\t\tthis.$promise = null;\r\n\r\n\t\tthis.$loading_status = \"unload\";\r\n\t\t\r\n\t\t/** @type {function():void} */\r\n\t\tthis.onload = null;\r\n\t\t\r\n\t\t/** @type {(function():void)[]} */\r\n\t\tthis._onload = [];\r\n\t}\r\n\r\n\tstatic async _Init() {\r\n\t\tlet $_mapString = null;\r\n\t\tlet $mapString = {};\r\n\r\n\t\t$_mapString = await $get.data(\"/String/Map\");\r\n\r\n\t\tfor (let i in $_mapString) {\r\n\t\t\tfor (let j in $_mapString[i]) {\r\n\t\t\t\t$mapString[j] = $_mapString[i][j];\r\n\t\t\t\t$mapString[j].$region = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tSceneMap._map_names = $mapString;\r\n\r\n\t\twindow.$MapNames = SceneMap._map_names;\r\n\t}\r\n\tstatic Init() {\r\n\t\treturn Promise.all([\r\n\t\t\tSceneMap._Init(),\r\n\t\t\tMapPortal.Init(),\r\n\t\t]);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {{[questId:string]: number}} quest\r\n\t */\r\n\tisActivated(quest) {\r\n\t\tif (quest) {\r\n\t\t\tfor (let id in quest) {\r\n\t\t\t\tif (this.quest[id] != quest[id]) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tget $map_sprite() {\r\n\t\treturn window.$map_sprite;\r\n\t}\r\n\r\n\t/**\r\n\t * load map from loaded data\r\n\t * @param {{back:{[backId:string]:any}}} raw\r\n\t */\r\n\tasync _constructBack(raw) {\r\n\t\tif (!(\"back\" in raw)) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet loading_task_map = new Map();\r\n\t\tfor (let i = 0; i in raw.back; ++i) {\r\n\t\t\tlet ob = raw.back[i];\r\n\t\t\tconst url = this._url + `back/${i}`;\r\n\r\n\t\t\t/** @type {MapBack|MapBackAnimation} */\r\n\t\t\tlet back;\r\n\r\n\t\t\tif (ob.ani == 0) {\r\n\t\t\t\tback = new MapBack(ob);\r\n\t\t\t}\r\n\t\t\telse if (ob.ani == 1) {\r\n\t\t\t\tback = new MapBackAnimation(ob);\r\n\t\t\t}\r\n\t\t\telse if (ob.ani == 2) {//Spine skeletal animation\r\n\t\t\t\tback = new MapBackSkeletalAnim(ob);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthrow new Error(\"ob.ani: \" + ob.ani);\r\n\t\t\t}\r\n\t\t\tback._url = url;\r\n\t\t\tif (back.backTags != null) {\r\n\t\t\t\tthis.backTags[back.backTags] = back;\r\n\t\t\t}\r\n\r\n\t\t\tif (ob.ani != 2) {\r\n\t\t\t\t// add loading task\r\n\t\t\t\tif (back._raw.bS) {\r\n\t\t\t\t\tlet ps = \"Back/\" + back._raw.bS;\r\n\t\t\t\t\tif (!loading_task_map.has(ps)) {\r\n\t\t\t\t\t\tloading_task_map.set(ps, map_load_package(\"Back\", back._raw.bS));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.warn(\"MapBack: map.back[\" + i + \"].bS = \" + back._raw.bS);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (ob.front != 0) {\r\n\t\t\t\tthis.frontground.push(back);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.background.push(back);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tawait Promise.all([...loading_task_map.values()]);\r\n\r\n\t\tfor (let i = 0; i < this.frontground.length; ++i) {\r\n\t\t\tlet back = this.frontground[i];\r\n\t\t\tback.load();\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.background.length; ++i) {\r\n\t\t\tlet back = this.background[i];\r\n\t\t\tback.load();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * load map from loaded data\r\n\t * @param {{[layer:number]:{objs:{},tiles:{},info:{}}}} mapRawData\r\n\t */\r\n\tasync _constructLayeredObject(mapRawData) {\r\n\t\tlet loading_task_map = new Map();\r\n\r\n\t\tfor (let i = 0, layer = mapRawData[i]; !objIsEmpty(layer); i++ , layer = mapRawData[i]) {//layer[1...8]\r\n\t\t\tlet objs = this.__constructLayeredObject_obj(i, layer, loading_task_map);\r\n\t\t\tlet tiles = this.__constructLayeredObject_tile(i, layer, loading_task_map);\r\n\r\n\t\t\t// ?? map:867116550 雷射在 tiles 前面\r\n\t\t\ttiles.sort((a, b) => { return a.z - b.z; });\r\n\t\t\tobjs.sort((a, b) => { return a.z - b.z; });\r\n\r\n\t\t\t//this.layeredObject[i] = objs.concat(tiles);//(objs.concat(tiles)).sort(function (a, b) { return a.z - b.z; });\r\n\t\t\t\r\n\t\t\tthis.layeredObject[i] = objs;\r\n\t\t\tthis.layeredTile[i] = tiles;\r\n\t\t}\r\n\r\n\t\t//wait all texture package loaded\r\n\t\tawait Promise.all([...loading_task_map.values()]);\r\n\r\n\t\tfor (let i = 0; i < this.layeredObject.length; ++i) {\r\n\t\t\tconst objs = this.layeredObject[i];\r\n\t\t\tfor (let j = 0; j < objs.length; ++j) {\r\n\t\t\t\t/**\r\n\t\t\t\t * @type {MapObject}\r\n\t\t\t\t */\r\n\t\t\t\tlet obj = objs[j];\r\n\t\t\t\tif (true) {//is debug\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tobj.load();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcatch (ex) {\r\n\t\t\t\t\t\tconsole.error(\"load textures failed: \" + new URL(\"xml2\" + obj._url, window.location).href);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (let i = 0; i < this.layeredTile.length; ++i) {\r\n\t\t\tconst tiles = this.layeredTile[i];\r\n\t\t\tfor (let j = 0; j < tiles.length; ++j) {\r\n\t\t\t\tlet tile = tiles[j];\r\n\t\t\t\ttile.load();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__constructLayeredObject_tile(i, layer, loading_task_map) {\r\n\t\tconst info = layer.info;\r\n\t\tlet tiles = [];\r\n\r\n\t\tif (info.tS) {\r\n\t\t\tlet ps = \"Tile/\" + info.tS;\r\n\t\t\tif (!loading_task_map.has(ps)) {\r\n\t\t\t\tloading_task_map.set(ps, map_load_package(\"Tile\", info.tS));\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (Object.keys(layer.tile).length) {\r\n\t\t\tdebugger;\r\n\t\t\tconsole.warn(\"[\" + i + \"].tile = \" + JSON.stringify(layer.tile));\r\n\t\t}\r\n\t\tfor (let j = 0, ti = layer.tile[j]; !objIsEmpty(ti); j++ , ti = layer.tile[j]) {\r\n\t\t\tlet tile = new MapTile(ti, info);\r\n\r\n\t\t\ttile._url = this._url + `${i}/tile/${j}`;\r\n\r\n\t\t\ttiles.push(tile);\r\n\t\t}\r\n\r\n\t\treturn tiles;\r\n\t}\r\n\t__constructLayeredObject_obj(i, layer, loading_task_map) {\r\n\t\tlet objs = [];\r\n\r\n\t\tfor (let j = 0, raw = layer.obj[j]; !objIsEmpty(raw); j++ , raw = layer.obj[j]) {\r\n\t\t\tlet obj;\r\n\r\n\t\t\tif (raw.spineAni) {\r\n\t\t\t\tswitch (raw.spineAni) {\r\n\t\t\t\t\tcase \"animation\":\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"idle\":\r\n\t\t\t\t\t\tconsole.warn(\"spine animation: idle ??\");\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tconsole.groupCollapsed(\"unknow spine:\" + raw.spineAni);\r\n\t\t\t\t\t\tconsole.warn(`LayeredObject[${i}][${j}]`);\r\n\t\t\t\t\t\tconsole.warn(raw);\r\n\t\t\t\t\t\tconsole.groupEnd();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tobj = new MapObjectSkeletalAnim(raw);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tobj = new MapObject(raw);\r\n\r\n\t\t\t\tlet ps = \"Obj/\" + obj._raw.oS;\r\n\t\t\t\tif (!loading_task_map.has(ps)) {\r\n\t\t\t\t\tloading_task_map.set(ps, map_load_package(\"Obj\", obj._raw.oS));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tobj._url = this._url + `${i}/obj/${j}`;\r\n\t\t\t\r\n\t\t\tif (obj.name != null) {\r\n\t\t\t\tthis.namedObject[obj.name] = obj;\r\n\t\t\t}\r\n\r\n\t\t\tobjs.push(obj);\r\n\t\t}\r\n\r\n\t\treturn objs;\r\n\t}\r\n\r\n\t/**\r\n\t * top-bottom-border compute by visible mapObject\r\n\t */\r\n\t__compute_top_bottom_border(layeredObject) {\r\n\t\tlet top = null, bottom = null;//left, right,\r\n\t\t//let i = 0;\r\n\t\t\r\n\t\tfor (let i = 0; i < layeredObject.length; ++i) {\r\n\t\t\tconst objs = layeredObject[i];\r\n\t\t\tfor (let j = 0; j < objs.length; ++j) {\r\n\t\t\t\tconst obj = objs[j];\r\n\t\t\t\tlet rect = obj.compute_max_rectangle();\r\n\t\t\t\tif (rect && top != null && bottom != null) {\r\n\t\t\t\t\t//left = Math.min(left, rect.left);\r\n\t\t\t\t\ttop = Math.min(top, rect.top);\r\n\t\t\t\t\t//right = Math.max(right, rect.right);\r\n\t\t\t\t\tbottom = Math.max(bottom, rect.bottom);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t//left = rect.left;\r\n\t\t\t\t\ttop = rect.top;\r\n\t\t\t\t\t//right = rect.right;\r\n\t\t\t\t\tbottom = rect.bottom;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn { top, bottom };\r\n\t}\r\n\t\r\n\t/**\r\n\t * top-bottom-border compute by visible mapObject\r\n\t */\r\n\t_compute_top_bottom_border() {\r\n\t\tlet objtb = this.__compute_top_bottom_border(this.layeredObject);\r\n\t\tlet tiletb = this.__compute_top_bottom_border(this.layeredTile);\r\n\t\tlet top = Math.min(objtb.top, tiletb.top);\r\n\t\tlet bottom = Math.max(objtb.bottom, tiletb.bottom);\r\n\t\treturn { top, bottom };\r\n\t}\r\n\r\n\t//_compute_view_rectangle\r\n\t\r\n\t_compute_map_bound(reCalc) {\r\n\t\tif (this.mapBound && !reCalc) {\r\n\t\t\treturn this.mapBound;\r\n\t\t}\r\n\r\n\t\tconst info = this._raw.info;\r\n\t\tlet top, bottom;\r\n\r\n\t\tif (info.VRLeft != null && info.VRTop != null && info.VRRight != null && info.VRBottom != null) {\r\n\t\t\ttop = info.VRTop;\r\n\t\t\tbottom = info.VRBottom;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet tb = this._compute_top_bottom_border();\r\n\t\t\ttop = tb.top;\r\n\t\t\tbottom = tb.bottom;\r\n\t\t}\r\n\r\n\t\tconst lr = this.controller.ground._compute_left_right_border();\r\n\r\n\t\tlet rect = _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Rectangle\"].parse(lr.left, top, lr.right, bottom);\r\n\t\tthis.mapBound = rect;//store\r\n\r\n\t\treturn rect;\r\n\t}\r\n\t\r\n\tget _window_title() {\r\n\t\tif (this.mapName) {\r\n\t\t\treturn `${[this.mapName, this.streetName].join(\"·\")} (${this.map_id})`;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn `${this.map_id}`;\r\n\t\t}\r\n\t}\r\n\t\r\n\t_get_map_data_url(map_id) {\r\n\t\treturn `/Map/Map/Map${map_id.slice(0, 1)}/${map_id}`;\r\n\t}\r\n\r\n\t/**\r\n\t * loading: map data\r\n\t * @param {string} map_id\r\n\t * @param {boolean} reload - download\r\n\t */\r\n\tasync load(map_id, reload) {\r\n\t\tthis.$promise = await this._route_load(map_id, reload);\r\n\t\tdelete this.$promise;//loaded\r\n\t}\r\n\t/**\r\n\t * loading: map data\r\n\t * @param {string} map_id\r\n\t * @param {boolean} reload - download\r\n\t */\r\n\tasync _route_load(map_id, reload) {\r\n\t\tthis.$loading_status = \"loading\";\r\n\t\t\r\n\t\tif (!reload && map_id != null && this.map_id == map_id && this._raw != null) {\r\n\t\t\tif (this.isLoaded()) {\r\n\t\t\t\tthis.unload();\r\n\t\t\t}\r\n\t\t\tawait this._load(this._raw);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst url = this._get_map_data_url(map_id);\r\n\t\t\r\n\t\tlet raw;\r\n\t\ttry {\r\n\t\t\traw = await $get.data(url);\r\n\t\t\tif (!raw) {\r\n\t\t\t\talert(\"map not exit\");\r\n\t\t\t\tdebugger;\r\n\t\t\t\tthrow new Error(\"map not exit\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthis.$loading_status = \"failed: load\";\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (raw.info && raw.info.link) {\r\n\t\t\t\tconst url2 = this._get_map_data_url(raw.info.link);\r\n\t\t\t\t\t\r\n\t\t\t\traw = await $get.data(url2);\r\n\t\t\t\tif (!raw) {\r\n\t\t\t\t\talert(\"map-link not exit\");\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthis.$loading_status = \"failed: link\";\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tif (this.isLoaded()) {\r\n\t\t\t\tthis.unload();\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.warn(\"SceneMap#unload\");\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tthis._url = url;\r\n\t\t\tthis.map_id = map_id;\r\n\t\t\t\r\n\t\t\tawait this._load(raw);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthis.$loading_status = \"failed: constructor map\";\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\tdelete this.$loading_status;//loaded\r\n\t}\r\n\t/**\r\n\t * load map from loaded data\r\n\t * @param {{[prop:string]:{}}} raw\r\n\t */\r\n\tasync _load(raw) {\r\n\t\tconst map_id = this.map_id;\r\n\t\t\r\n\t\tthis._raw = raw;\r\n\r\n\t\t$gv.allQuest = {};\r\n\t\t\r\n\t\tthis.controller.stop = true;//begin load\r\n\t\t\r\n\t\tif (SceneMap._map_names[map_id]) {\r\n\t\t\tthis.mapName = SceneMap._map_names[map_id].mapName;\r\n\t\t\tthis.streetName = SceneMap._map_names[map_id].streetName;\r\n\t\t}\r\n\r\n\t\tthis.$load_tasks = [];\r\n\r\n\t\tthis._loadBgm(raw);\r\n\r\n\t\tthis.$load_tasks.push(this._constructBack(raw, this));\r\n\t\t\r\n\t\tthis.$load_tasks.push(this._constructLayeredObject(raw, this).then((mapobj) => {\r\n\t\t\t//this.layeredObject\r\n\t\t\t//this.layeredTile\r\n\t\t}));\r\n\t\t\r\n\t\tthis.$load_tasks.push(this.portalMgr.load(raw, this).then((portals) => {\r\n\t\t}));\r\n\t\t\r\n\t\tthis.$load_tasks.push(this.__constructMiniMap(raw, this));\r\n\r\n\t\tthis.$load_tasks.push(this.controller.load(raw, this));//load foothold...\r\n\t\tthis.$load_tasks.push(this.lifeMgr.load(raw, this));\r\n\t\t\r\n\t\tthis.$load_tasks.push(MapParticle.construct(raw, this));\r\n\r\n\t\tlet load_results = await Promise.all(this.$load_tasks);\r\n\t\t\r\n\t\tconst viewRect = this._compute_map_bound();\r\n\t\tconst viewCenter = viewRect.center;\r\n\t\t\r\n\t\t$gv.m_viewRect.setCenter(viewCenter.x, viewCenter.y);\r\n\t\t\r\n\t\tthis.controller._createMapBound(viewRect);\r\n\t\t\r\n\t\tthis.controller.stop = false;//end load\r\n\t\t\r\n\t\tthis.$load_tasks = [];\r\n\t\tconsole.log(\"completed scene_map.waitLoaded: [...]\");\r\n\t\t\r\n\t\tthis._script();\r\n\t\t\r\n\t\tif (this.onload) {\r\n\t\t\tthis.onload.call(this);//history.pushState\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log(\"End scene_map.load\");\r\n\t}\r\n\t_script() {\r\n\t\tswitch (this.map_id) {\r\n\t\t\tcase \"450004150\":\r\n\t\t\tcase \"450004450\":\r\n\t\t\tcase \"450004750\":\r\n\t\t\t\tthis.lifeMgr.spawnMob(\"8880166\", 1000, 47, false, 0);//from /Etc/BossLucid\r\n\t\t\t\tthis.lifeMgr.spawnMob(\"8880140\", 1000, 47, false, 0);//from /Etc/BossLucid\r\n\t\t\t\t//this.lifeMgr.spawnMob(\"8880176\", 1000, 47, false, 0);\r\n\t\t\t\t//this.lifeMgr.spawnMob(\"8880141\", 1000, 47, false, 0);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\treload() {\r\n\t\tthis.unload();\r\n\t\tthis._load(this._raw);\r\n\t}\r\n\t\r\n\tunload() {\r\n\t\tthis.$loading_status = \"loading\";\r\n\t\t\r\n\t\tfor (let i = 0; i < this.background.length; ++i) {\r\n\t\t\tthis.background[i].unload();\r\n\t\t}\r\n\t\tthis.background = [];\r\n\t\t\r\n\t\tfor (let i = 0; i < this.frontground.length; ++i) {\r\n\t\t\tthis.frontground[i].unload();\r\n\t\t}\r\n\t\tthis.frontground = [];\r\n\t\t\r\n\t\tfor (let i = 0; i < this.layeredObject.length; ++i) {\r\n\t\t\tlet objs = this.layeredObject[i];\r\n\t\t\tfor (let j = 0; j < objs.length; ++j) {\r\n\t\t\t\tobjs[j].unload();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.layeredObject = [];\r\n\t\t\r\n\t\tfor (let i = 0; i < this.layeredTile.length; ++i) {\r\n\t\t\tlet tiles = this.layeredTile[i];\r\n\t\t\tfor (let j = 0; j < tiles.length; ++j) {\r\n\t\t\t\ttiles[j].unload();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.layeredTile = [];\r\n\t\t\r\n\t\tthis.backTags = {};\r\n\t\t\r\n\t\tthis.particleList = null;\r\n\t\t\r\n\t\tthis.controller.unload();\r\n\t\tthis.lifeMgr.unload();\r\n\t\tthis.portalMgr.unload();\r\n\t\t\r\n\t\tmap_sprite.Back = {};\r\n\t\tmap_sprite.Obj = {};\r\n\t\tmap_sprite.Tile = {};\r\n\t}\r\n\r\n\t/**\r\n\t * load map from loaded data\r\n\t * @param {{info:{bgm:string}}} mapRawData\r\n\t */\r\n\t_getBgmPath(mapRawData) {\r\n\t\tlet bgmPath = mapRawData.info.bgm;\r\n\t\tlet i = bgmPath.indexOf(\"/\"), path = bgmPath.slice(0, i) + bgmPath.slice(i);\r\n\t\t//let m = bgmPath.match(/([^\\/]+)(\\/.*)/), path = [m[1], m[2]].join(\"/\");\r\n\t\treturn [\"\", \"Sound\", path].join(\"/\");\r\n\t}\r\n\r\n\t/**\r\n\t * load map from loaded data\r\n\t * @param {{info:{bgm:string}}} mapRawData\r\n\t */\r\n\t_loadBgm(mapRawData) {\r\n\t\tconst elem_bgm = document.getElementById(\"bgm\");\r\n\t\tif (elem_bgm) {\r\n\t\t\tconst path = this._getBgmPath(mapRawData);\r\n\t\t\tthis._bgm_path = path;\r\n\r\n\t\t\tconst url = $get.soundMp3Url(path);\r\n\t\t\t\r\n\t\t\telem_bgm.innerHTML = `<source src=\"${url}\" type=\"audio/mpeg\">`;\r\n\t\t\t\r\n\t\t\tif (false) {}\r\n\t\t\telse {\r\n\t\t\t\telem_bgm.autoplay = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(new TypeError(\"#bgm\"));\r\n\t\t}\r\n\t}\r\n\r\n\tplayBgm() {\r\n\t\tdocument.getElementById(\"bgm\").play();\r\n\t}\r\n\r\n\tpauseBgm() {\r\n\t\tdocument.getElementById(\"bgm\").pause();\r\n\t}\r\n\t\r\n\t__constructMiniMap(raw) {\r\n\t\tif (raw.miniMap) {\r\n\t\t\t//const hw = raw.miniMap.width * 0.5;\r\n\t\t\t//const hh = raw.miniMap.height * 0.5;\r\n\t\t\t//const cx = raw.miniMap.centerX;\r\n\t\t\t//const cy = raw.miniMap.centerY;\r\n\t\t\tthis.width = raw.miniMap.width;\r\n\t\t\tthis.height = raw.miniMap.height;\r\n\t\t\tthis.centerX = raw.miniMap.centerX;\r\n\t\t\tthis.centerY = raw.miniMap.centerY;\r\n\t\t\t//this.boundRect = new Rectangle(cx - hw, cy - hh, raw.miniMap.width, raw.miniMap.height);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.width = 0;\r\n\t\t\tthis.height = 0;\r\n\t\t\tthis.centerX = 0;\r\n\t\t\tthis.centerY = 0;\r\n\t\t}\r\n\t}\r\n\t\r\n\t_miniMap_src() {\r\n\t\treturn this._url + \"miniMap/canvas\";\r\n\t\tconst a = {\r\n\t\t\t\"canvas\": {\r\n\t\t\t\t\"\": \"\"\r\n\t\t\t},\r\n\t\t\t\"width\": 4483,\r\n\t\t\t\"height\": 1244,\r\n\t\t\t\"centerX\": 1030,\r\n\t\t\t\"centerY\": 781,\r\n\t\t\t\"mag\": 4\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * wait all task: return true if nothing to loading else list of loaded object\r\n\t * loading: texture...\r\n\t * @returns {Promise<true>|Promise<any[]>}\r\n\t */\r\n\tasync waitLoaded() {\r\n\t\tawait this.$promise;\r\n\t}\r\n\r\n\tisLoaded() {\r\n\t\treturn ((!this.$load_tasks || !this.$load_tasks.length) && this._raw && !this.$loading_status);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\twindow.m_hover_object = null;\r\n\t\tif ($gv.mouse_dm || $gv.mouse_dr) {\r\n\t\t\twindow.m_selected_object = null;\r\n\t\t}\r\n\t\t\r\n\t\tif (stamp != null) {\r\n\t\t\tthis.stamp = stamp;\r\n\r\n\t\t\tthis.lifeMgr.update(stamp);\r\n\r\n\t\t\tif (this.isLoaded()) {\r\n\t\t\t\tthis.controller.update(stamp);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {SceneCharacter} chara\r\n\t */\r\n\t_addChara(chara) {\r\n\t\ttry {\r\n\t\t\tlet player_spawns = this.portalMgr.portals.filter(a => a.pn == \"sp\");\r\n\t\t\tlet spawn = player_spawns[Math.trunc(Math.random() * 100) % player_spawns.length];\r\n\t\t\tconst $physics = chara.$physics;\r\n\t\t\tconst x = spawn.x / $gv.CANVAS_SCALE;\r\n\t\t\tconst y = spawn.y / $gv.CANVAS_SCALE;\r\n\t\t\t$physics.setPosition(x, y);\r\n\t\t\t$physics.body.SetAwake(true);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {SceneCharacter} chara\r\n\t */\r\n\taddChara(chara) {\r\n\t\tif (this.$promise) {\r\n\t\t\tthis.$promise.then(() => {\r\n\t\t\t\tthis._addChara(chara);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._addChara(chara);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tapplyCamera(renderer) {\r\n\t\trenderer.ctx.setTransform(1, 0, 0, 1, Math.trunc(-$gv.m_viewRect.x), Math.trunc(-$gv.m_viewRect.y));\r\n\t}\r\n\r\n\t/**\r\n\t * pushGlobalAlpha\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tbeginRender(renderer) {\r\n\t\trenderer.pushGlobalAlpha();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tendRender(renderer) {\r\n\t\trenderer.popGlobalAlpha();\r\n\t\t//renderer.popMatrix();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} whereLayer - where layer index\r\n\t */\r\n\trenderLife(renderer, whereLayer) {\r\n\t\tif (!$gv.m_display_life) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"].empty;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tthis.lifeMgr.draw(renderer, center, viewRect, whereLayer);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderPortal(renderer) {\r\n\t\tif (!$gv.m_display_portal) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"].empty;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\r\n\t\tthis.portalMgr.update(this.stamp);\r\n\t\tthis.portalMgr.draw(renderer, center, viewRect);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderFrontground(renderer) {\r\n\t\tif (!$gv.m_display_front) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = $gv.m_viewRect.center;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tfor (let i = 0; i < this.frontground.length; ++i) {\r\n\t\t\tlet back = this.frontground[i];\r\n\t\t\tif (this.isActivated(back.quest)) {\r\n\t\t\t\tback.update(this.stamp);\r\n\t\t\t\tback.draw(renderer, center, viewRect);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderLayeredObject(renderer, layerIndex) {\r\n\t\tif (!$gv.m_display_mapobj) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"].empty;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tconst objs = this.layeredObject[layerIndex];\r\n\t\tfor (let j = 0; j < objs.length; ++j) {\r\n\t\t\tlet obj = objs[j];\r\n\t\t\tif (this.isActivated(obj.quest)) {\r\n\t\t\t\tobj.update(this.stamp);\r\n\t\t\t\tobj.draw(renderer, center, viewRect);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderLayeredTile(renderer, layerIndex) {\r\n\t\tif (!$gv.m_display_maptile) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"].empty;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tconst tiles = this.layeredTile[layerIndex];\r\n\t\tfor (let j = 0; j < tiles.length; ++j) {\r\n\t\t\tlet tile = tiles[j];\r\n\t\t\tif (this.isActivated(tile.quest)) {\r\n\t\t\t\ttile.update(this.stamp);\r\n\t\t\t\ttile.draw(renderer, center, viewRect);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderBackground(renderer) {\r\n\t\tif (!$gv.m_display_back) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst center = $gv.m_viewRect.center;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tfor (let i = 0; i < this.background.length; ++i) {\r\n\t\t\tlet back = this.background[i];\r\n\t\t\tif (this.isActivated(back.quest)) {\r\n\t\t\t\tback.update(this.stamp);\r\n\t\t\t\tback.draw(renderer, center, viewRect);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trenderParticle(renderer) {\r\n\t\tif (!$gv.m_display_particle_system) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//const center = Vec2.empty;\r\n\t\tconst center = $gv.m_viewRect.center;\r\n\t\tconst viewRect = $gv.m_viewRect;\r\n\t\t\r\n\t\tfor (let i = 0; i < this.particleList.length; ++i) {\r\n\t\t\tlet particle = this.particleList[i];\r\n\t\t\tif (this.isActivated(particle.quest)) {\r\n\t\t\t\tparticle.update(this.stamp);\r\n\t\t\t\tparticle.draw(renderer, center, viewRect);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nObject(_init_js__WEBPACK_IMPORTED_MODULE_0__[\"AddInitTask\"])(SceneMap.Init);\r\n\r\n///////////////////////////////////////////////////////////////////////////////\r\n//\r\n///////////////////////////////////////////////////////////////////////////////\r\n\r\nfunction objIsEmpty(x) {\r\n\tif (typeof x == 'object' && x == null)\r\n\t\tthrow new Error();\r\n\treturn typeof x == 'undefined' || x == null;\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9NYXAuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9NYXAuanM/ZDBjMSJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgQWRkSW5pdFRhc2sgfSBmcm9tIFwiLi4vaW5pdC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgVmVjMiwgUmVjdGFuZ2xlIH0gZnJvbSBcIi4vbWF0aC5qc1wiO1xyXG5pbXBvcnQgeyBJR3JhcGgsIElSZW5kZXJlciB9IGZyb20gXCIuL0lSZW5kZXJlci5qc1wiO1xyXG5pbXBvcnQgeyBlbmdpbmUsIEdyYXBoIH0gZnJvbSBcIi4vRW5naW5lLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBTcHJpdGUgfSBmcm9tIFwiLi9TcHJpdGUuanNcIjtcclxuaW1wb3J0IHsgTGlmZVJlbmRlcmVyIH0gZnJvbSBcIi4vUmVuZGVyZXIvTGlmZVJlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IE1vYlJlbmRlcmVyIH0gZnJvbSBcIi4vUmVuZGVyZXIvTW9iUmVuZGVyZXIuanNcIjtcclxuaW1wb3J0IHsgTnBjUmVuZGVyZXIgfSBmcm9tIFwiLi9SZW5kZXJlci9OcGNSZW5kZXJlci5qc1wiO1xyXG5cclxuaW1wb3J0IHsgUGFydGljbGVHcm91cCB9IGZyb20gXCIuL1JlbmRlcmVyL1BhcnRpY2xlU3lzdGVtLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBXb3JsZCB9IGZyb20gXCIuL1BoeXNpY3MvV29ybGQuanNcIjtcclxuaW1wb3J0IHsgR3JvdW5kIH0gZnJvbSBcIi4vUGh5c2ljcy9Hcm91bmQuanNcIjtcclxuaW1wb3J0IHsgUE1vYiB9IGZyb20gXCIuL1BoeXNpY3MvUE1vYi5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZU9iamVjdCB9IGZyb20gXCIuL1NjZW5lT2JqZWN0LmpzXCI7XHJcblxyXG5cclxud2luZG93LmVuYWJsZV9za2VsZXRhbF9hbmltID0gdHJ1ZTtcclxuXHJcbi8qKlxyXG4gKiBtYXAgc3ByaXRlIGRhdGFcclxuICovXHJcbmNvbnN0IG1hcF9zcHJpdGUgPSB7XHJcblx0QmFjazoge30sXHJcblx0T2JqOiB7fSxcclxuXHRUaWxlOiB7fSxcclxufTtcclxuXHJcbndpbmRvdy4kbWFwX3Nwcml0ZSA9IG1hcF9zcHJpdGU7XHJcblxyXG4kZ3YuYWxsUXVlc3QgPSB7fTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIG1hcF9sb2FkX3BhY2thZ2UoY2F0LCBwYWNrKSB7XHJcblx0aWYgKCFjYXQgfHwgIXBhY2spIHtcclxuXHRcdGRlYnVnZ2VyO1xyXG5cdH1cclxuXHRpZiAoIW1hcF9zcHJpdGVbY2F0XVtwYWNrXSkge1xyXG5cdFx0bGV0IHVybCA9IGAvTWFwLyR7Y2F0fS8ke3BhY2t9YDtcclxuXHRcdFxyXG5cdFx0bWFwX3Nwcml0ZVtjYXRdW3BhY2tdID0gYXdhaXQgJGdldC5kYXRhKHVybCk7XHJcblxyXG5cdFx0aWYgKG1hcF9zcHJpdGVbY2F0XVtwYWNrXSA9PSBudWxsKSB7XHJcblx0XHRcdGNvbnNvbGUud2FybihcIkVtcHR5IHBhY2thZ2U6IFwiICsgdXJsKTtcclxuXHRcdH1cclxuXHR9XHJcblx0aWYgKG1hcF9zcHJpdGVbY2F0XVtwYWNrXSkge1xyXG5cdFx0cmV0dXJuIG1hcF9zcHJpdGVbY2F0XVtwYWNrXTtcclxuXHR9XHJcblx0Ly90aHJvdyBuZXcgRXJyb3IoKTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBNYXAgdGV4dHVyZVxyXG4gKi9cclxuY2xhc3MgTWFwVGV4dHVyZSBleHRlbmRzIFNwcml0ZSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHshYW55fSByYXdcclxuXHQgKiBAcGFyYW0geyFzdHJpbmd9IHVybFxyXG5cdCAqIEBwYXJhbSB7IU1hcFRleHR1cmV9IHRleHR1cmUwXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoX3JhdywgdXJsLCB0ZXh0dXJlMCkge1xyXG5cdFx0c3VwZXIoX3JhdywgdXJsKTtcclxuXHRcdC8vdGhpcy5jbGFzc05hbWUgPSBfcGF0aDtcclxuXHJcblx0XHR0ZXh0dXJlMCA9IHRleHR1cmUwIHx8IE1hcFRleHR1cmUucmF3X2RlZmF1bHQ7XHJcblx0XHRcclxuXHRcdHRoaXMuYTAgPSB0aGlzLl9nZXQoLTEsIFwiYTBcIiwgTnVtYmVyKTtcclxuXHRcdHRoaXMuYTEgPSB0aGlzLl9nZXQoLTEsIFwiYTFcIiwgTnVtYmVyKTtcclxuXHJcblx0XHR0aGlzLm1vdmV0eXBlID0gdGhpcy5fZ2V0KHRleHR1cmUwLm1vdmV0eXBlLCBcIm1vdmVUeXBlXCIsIE51bWJlcik7XHJcblx0XHR0aGlzLm1vdmV3ID0gdGhpcy5fZ2V0KHRleHR1cmUwLm1vdmV3LCBcIm1vdmVXXCIsIE51bWJlcik7XHJcblx0XHR0aGlzLm1vdmVoID0gdGhpcy5fZ2V0KHRleHR1cmUwLm1vdmVoLCBcIm1vdmVIXCIsIE51bWJlcik7XHJcblx0XHR0aGlzLm1vdmVwID0gdGhpcy5fZ2V0KHRleHR1cmUwLm1vdmVwLCBcIm1vdmVQXCIsIE51bWJlcik7XHJcblx0XHR0aGlzLm1vdmVyID0gdGhpcy5fZ2V0KHRleHR1cmUwLm1vdmVyLCBcIm1vdmVSXCIsIE51bWJlcik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGYgLSBmbGlwXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHB4IC0gcG9zaXRpb24ueDppbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gcHkgLSBwb3NpdGlvbi55OmludFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB0aW1lIC0gbW92ZW1lbnRfYW5pbWF0aW9uOmZsb2F0XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGRlbHRhIC0gZ3JhcGhfYW5pbWF0aW9uOmZsb2F0XHJcblx0ICogQHBhcmFtIHttYXBsZV9zY2VuZV9sYWJlbH0gYm9yZGVyXHJcblx0ICovXHJcblx0ZHJhdyhyZW5kZXJlciwgZiwgcHgsIHB5LCB0aW1lLCBkZWx0YSkge1xyXG5cdFx0bGV0IHJhdGlvID0gdGltZSAvIHRoaXMuZGVsYXk7XHJcblx0XHRsZXQgYWxwaGEgPSAoMCA8PSB0aGlzLmEwIHx8IDAgPD0gdGhpcy5hMSA/ICgoMCA+IHRoaXMuYTAgPyAwIDogdGhpcy5hMCkgKiAoMS4wIC0gcmF0aW8pICsgKDAgPiB0aGlzLmExID8gMCA6IHRoaXMuYTEpICogcmF0aW8pIDogMjU1LjApO1xyXG5cdFx0bGV0IGFuZ2xlID0gMDtcclxuXHJcblx0XHRzd2l0Y2ggKHRoaXMubW92ZXR5cGUpIHtcclxuXHRcdFx0Y2FzZSAxOiBweCA9IHB4ICsgdGhpcy5tb3ZldyAqIE1hdGguc2luKDAgPT0gdGhpcy5tb3ZlcCA/IChkZWx0YSAvIDEwMDAuMCkgOiAoZGVsdGEgKiAyLjAgKiBNYXRoLlBJIC8gdGhpcy5tb3ZlcCkpOyBicmVhaztcclxuXHRcdFx0Y2FzZSAyOiBweSA9IHB5ICsgdGhpcy5tb3ZlaCAqIE1hdGguc2luKDAgPT0gdGhpcy5tb3ZlcCA/IChkZWx0YSAvIDEwMDAuMCkgOiAoZGVsdGEgKiAyLjAgKiBNYXRoLlBJIC8gdGhpcy5tb3ZlcCkpOyBicmVhaztcclxuXHRcdFx0Y2FzZSAzOiBpZiAoMCAhPSB0aGlzLm1vdmVyKSBhbmdsZSA9IGRlbHRhIC8gdGhpcy5tb3ZlcjsgYnJlYWs7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGxldCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHRmdW5jdGlvbiBheGlzKHgsIHksIHcsIGgsIGMxLCBjMikge1xyXG5cdFx0XHRjdHguYmVnaW5QYXRoKCk7XHJcblx0XHRcdGN0eC5tb3ZlVG8oeCwgeSk7XHJcblx0XHRcdGN0eC5saW5lVG8oeCArIHcsIHkpO1xyXG5cdFx0XHRzdHJva2UoYzEsIGMyKTtcclxuXHJcblx0XHRcdGN0eC5iZWdpblBhdGgoKTtcclxuXHRcdFx0Y3R4Lm1vdmVUbyh4LCB5KTtcclxuXHRcdFx0Y3R4LmxpbmVUbyh4LCB5ICsgaCk7XHJcblx0XHRcdHN0cm9rZShjMiwgYzEpO1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gc3Ryb2tlKGMxLCBjMikge1xyXG5cdFx0XHRjdHgubGluZVdpZHRoID0gMztcclxuXHRcdFx0Y3R4LnN0cm9rZVN0eWxlID0gYzE7XHJcblx0XHRcdGN0eC5zdHJva2UoKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZW5kZXJlci5sb2FkSWRlbnRpdHkoKTtcclxuXHRcdHJlbmRlcmVyLnRyYW5zbGF0ZShNYXRoLnRydW5jKC0kZ3YubV92aWV3UmVjdC54ICsgMC41KSwgTWF0aC50cnVuYygtJGd2Lm1fdmlld1JlY3QueSArIDAuNSkpO1xyXG5cdFx0e1xyXG5cdFx0XHRyZW5kZXJlci5nbG9iYWxBbHBoYSA9IE1hdGgubWF4KDAsIE1hdGgubWluKGFscGhhIC8gMjU1LCAxKSk7XHJcblxyXG5cdFx0XHRyZW5kZXJlci5fZHJhd1JvdGFHcmFwaCh0aGlzLCBweCwgcHksIGFuZ2xlLCBmKTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuTWFwVGV4dHVyZS5yYXdfZGVmYXVsdCA9IHtcclxuXHRhMDogLTEsXHJcblx0YTE6IC0xLFxyXG5cdG1vdmV0eXBlOiAwLFxyXG5cdG1vdmV3OiAwLFxyXG5cdG1vdmVoOiAwLFxyXG5cdG1vdmVwOiAwLFxyXG5cdG1vdmVyOiAwLFxyXG59O1xyXG5cclxuLyoqXHJcbiAqIE1hcCBjbGlwLXRleHR1cmVcclxuICovXHJcbmNsYXNzIE1hcFRleHR1cmVDbGlwIGV4dGVuZHMgTWFwVGV4dHVyZSB7XHJcblx0Y29uc3RydWN0b3IoX3JhdywgdXJsKSB7XHJcblx0XHRzdXBlcihfcmF3LCB1cmwpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7UmVjdGFuZ2xlfSAqL1xyXG5cdFx0dGhpcy5jbGlwID0gbmV3IFJlY3RhbmdsZSgpOy8vemVybyBSZWN0YW5nbGVcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIE1hcE9iamVjdEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcpIHtcclxuXHRcdGlmIChfcmF3ID09IG51bGwpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoX3Jhdyk7XHJcblx0XHR9XHJcblx0XHR0aGlzLl9yYXcgPSBfcmF3O1xyXG5cclxuXHJcblx0XHQvKiogQHR5cGUge01hcFRleHR1cmVbXX0gKi9cclxuXHRcdHRoaXMudGV4dHVyZXMgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gaW50ICovXHJcblx0XHR0aGlzLmZyYW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gdGltZV9pbl9tczpmbG9hdCAqL1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gdGltZUVsYXBzZWRfaW5fbXM6ZmxvYXQgKi9cclxuXHRcdHRoaXMuZGVsdGEgPSAwO1xyXG5cclxuXHJcblx0XHQvKiogQHR5cGUge3tbcXVlc3RJZDpzdHJpbmddOiBudW1iZXJ9fSAqL1xyXG5cdFx0dGhpcy5xdWVzdCA9IF9yYXcucXVlc3Q7XHJcblxyXG5cdFx0Zm9yIChsZXQgcWlkIGluIF9yYXcucXVlc3QpIHtcclxuXHRcdFx0aWYgKCEkZ3YuYWxsUXVlc3RbcWlkXSkge1xyXG5cdFx0XHRcdCRndi5hbGxRdWVzdFtxaWRdID0gbmV3IFNldCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdCRndi5hbGxRdWVzdFtxaWRdLmFkZChfcmF3LnF1ZXN0W3FpZF0pO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0aGlzLl9sb2FkX29iamVjdF9pbmZvKCk7XHJcblx0XHR0aGlzLl9sb2FkX2JhY2tfaW5mbygpO1xyXG5cdFx0dGhpcy5fbG9hZF90aWxlX2luZm8oKTtcclxuXHJcblx0XHR0aGlzLmFhYmIgPSBudWxsO1xyXG5cdFx0dGhpcy5kaXNwbGF5X2FhYmIgPSBmYWxzZTtcclxuXHRcdHRoaXMuYWFiYl9jb2xvciA9IG51bGw7XHJcblx0XHRcclxuXHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdHRoaXMuX19tYXhfcmVwZWF0X2NvdW50ID0gMTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0X2xvYWRfb2JqZWN0X2luZm8oKSB7XHJcblx0XHQvKiogQHR5cGV7bnVtYmVyfSBvYmotdHlwZSAqL1xyXG5cdFx0dGhpcy50eXBlID0gdGhpcy5fZ2V0KDAsIFwic2lnblwiLCBOdW1iZXIpO1xyXG5cclxuXHRcdC8qKiBAdHlwZXtudW1iZXJ9IHggKi9cclxuXHRcdHRoaXMueCA9IHRoaXMuX2dldCgwLCBcInhcIiwgTnVtYmVyKTtcclxuXHJcblx0XHQvKiogQHR5cGV7bnVtYmVyfSB5ICovXHJcblx0XHR0aGlzLnkgPSB0aGlzLl9nZXQoMCwgXCJ5XCIsIE51bWJlcik7XHJcblxyXG5cdFx0LyoqIEB0eXBle251bWJlcn0geiAqL1xyXG5cdFx0dGhpcy56ID0gdGhpcy5fZ2V0KDAsIFwielwiLCBOdW1iZXIpO1xyXG5cclxuXHRcdC8qKiBAdHlwZXtudW1iZXJ9IHpNICovXHJcblx0XHR0aGlzLnpNID0gdGhpcy5fZ2V0KDAsIFwiek1cIiwgTnVtYmVyKTtcclxuXHJcblx0XHQvKiogQHR5cGV7bnVtYmVyfSBmbGlwICovXHJcblx0XHR0aGlzLmYgPSB0aGlzLl9nZXQoMCwgXCJmXCIsIE51bWJlcik7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZXtuYW1lfSBuYW1lZCBvYmplY3QgKi9cclxuXHRcdHRoaXMubmFtZSA9IHRoaXMuX3Jhdy5uYW1lO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5fdXJsID0gbnVsbDsvL2RhdGEgdXJsIC8vZGVidWdcclxuXHR9XHJcblx0X2xvYWRfYmFja19pbmZvKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IG1vdmUgdHlwZSAqL1xyXG5cdFx0dGhpcy50eXBlYiA9IHRoaXMuX2dldCgwLCBcInR5cGVcIiwgTnVtYmVyKTtcclxuXHRcdGlmICh0aGlzLnR5cGViIDwgMCB8fCB0aGlzLnR5cGViID4gNykge1xyXG5cdFx0XHRhbGVydChcIk1hcEJhY2tCYXNlLnR5cGViOiBcIiArIHRoaXMudHlwZWIpO1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJNYXBCYWNrQmFzZS50eXBlYjogXCIgKyB0aGlzLnR5cGViKTtcclxuXHRcdH1cclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gYSAqL1xyXG5cdFx0dGhpcy5hID0gdGhpcy5fZ2V0KDAsIFwiYVwiLCBOdW1iZXIpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSByeCAqL1xyXG5cdFx0dGhpcy5yeCA9IHRoaXMuX2dldCgwLCBcInJ4XCIsIE51bWJlcik7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IHJ5ICovXHJcblx0XHR0aGlzLnJ5ID0gdGhpcy5fZ2V0KDAsIFwicnlcIiwgTnVtYmVyKTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gY2VudGVyIHkgKi9cclxuXHRcdHRoaXMuY3ggPSB0aGlzLl9nZXQoMCwgXCJjeFwiLCBOdW1iZXIpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSBjZW50ZXIgeSAqL1xyXG5cdFx0dGhpcy5jeSA9IHRoaXMuX2dldCgwLCBcImN5XCIsIE51bWJlcik7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5iYWNrVGFncyA9IHRoaXMuX3Jhdy5iYWNrVGFncztcclxuXHR9XHJcblx0X2xvYWRfdGlsZV9pbmZvKCkge1xyXG5cdFx0LyoqIEB0eXBle251bWJlcn0gZmxvdyAqL1xyXG5cdFx0dGhpcy5mbG93ID0gdGhpcy5fZ2V0KDAsIFwiZmxvd1wiLCBOdW1iZXIpO1xyXG5cdFx0XHJcblx0XHRpZiAodGhpcy5mbG93ICYgMSAmJiAhdGhpcy5jeCkge1xyXG5cdFx0XHR0aGlzLmN4ID0gMTAwMDtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmZsb3cgJiAyICYmICF0aGlzLmN5KSB7XHJcblx0XHRcdHRoaXMuY3kgPSAxMDAwO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7UHJvbWlzZX1cclxuXHQgKi9cclxuXHRsb2FkKCkge1xyXG5cdFx0bGV0IHRleHR1cmUwID0gdGhpcy5fbG9hZF90ZXh0dXJlKDAsIG51bGwpO1xyXG5cdFx0dGhpcy50ZXh0dXJlc1swXSA9IHRleHR1cmUwO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAxOyBpIGluIHRoaXMuX3RleHR1cmVfcmF3OyArK2kpIHsvL25vdCBhcnJheVxyXG5cdFx0XHR0aGlzLnRleHR1cmVzW2ldID0gdGhpcy5fbG9hZF90ZXh0dXJlKGksIHRleHR1cmUwKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuX19jYWxjX2FhYmIoKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaSAtIHRleHR1cmUgaW5kZXhcclxuXHQgKiBAcGFyYW0ge01hcFRleHR1cmV9IHRleHR1cmUwXHJcblx0ICovXHJcblx0X2xvYWRfdGV4dHVyZSgpIHtcclxuXHRcdC8vbm90aGluZ1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqL1xyXG5cdHVubG9hZCgpIHtcclxuXHRcdHRoaXMudGV4dHVyZXMgPSBbXTtcclxuXHR9XHJcblx0XHJcblx0X19jYWxjX2FhYmIoKSB7XHJcblx0XHRpZiAodGhpcy50ZXh0dXJlcy5sZW5ndGggPj0gMSkge1xyXG5cdFx0XHRsZXQgbW92ZXIgPSAwO1xyXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudGV4dHVyZXMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHRsZXQgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbaV07XHJcblx0XHRcdFx0bW92ZXIgPSBtb3ZlciB8IHRleHR1cmUubW92ZXI7XHJcblx0XHRcdH1cclxuXHRcdFx0Y29uc3QgYWFiYiA9IHRoaXMuY29tcHV0ZV9tYXhfcmVjdGFuZ2xlKCk7XHJcblx0XHRcdGlmIChtb3Zlcikge1xyXG5cdFx0XHRcdGNvbnN0IHIgPSBNYXRoLnJvdW5kKE1hdGguc3FydChhYWJiLndpZHRoICoqIDIgKyBhYWJiLmhlaWdodCAqKiAyKSk7XHJcblx0XHRcdFx0Y29uc3QgaHIgPSBNYXRoLnJvdW5kKHIgKiAwLjUpO1xyXG5cdFx0XHRcdHRoaXMuYWFiYiA9IG5ldyBSZWN0YW5nbGUodGhpcy54IC0gaHIsIHRoaXMueSAtIGhyLCByLCByKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLmFhYmIgPSBhYWJiO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1R9IGRlZmF1bHRWYWx1ZVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBwcm9wZXJ0eU5hbWVcclxuXHQgKiBAcGFyYW0ge2Z1bmN0aW9uKGFueSk6VH0gY29uc3RydWN0b3JcclxuXHQgKiBAcmV0dXJucyB7VH1cclxuXHQgKiBAdGVtcGxhdGUgVFxyXG5cdCAqL1xyXG5cdF9nZXQoZGVmYXVsdFZhbHVlLCBwcm9wZXJ0eU5hbWUsIGNvbnZlcnRlcikge1xyXG5cdFx0aWYgKHByb3BlcnR5TmFtZSBpbiB0aGlzLl9yYXcpIHtcclxuXHRcdFx0aWYgKGNvbnZlcnRlcikge1xyXG5cdFx0XHRcdHJldHVybiBjb252ZXJ0ZXIodGhpcy5fcmF3W3Byb3BlcnR5TmFtZV0pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJldHVybiB0aGlzLl9yYXdbcHJvcGVydHlOYW1lXTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuXHR9XHJcblxyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0Y29uc3QgZmMgPSB0aGlzLnRleHR1cmVzLmxlbmd0aDtcclxuXHJcblx0XHRpZiAoZmMgPiAxKSB7XHJcblx0XHRcdHRoaXMudGltZSA9IHRoaXMudGltZSArIHN0YW1wO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMudGltZSA+IHRoaXMudGV4dHVyZXNbdGhpcy5mcmFtZV0uZGVsYXkpIHtcclxuXHRcdFx0XHR0aGlzLmZyYW1lID0gKyt0aGlzLmZyYW1lO1xyXG5cclxuXHRcdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5mcmFtZSA+PSBmYykge1xyXG5cdFx0XHRcdFx0dGhpcy5mcmFtZSA9IDA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdC8vdGhpcy5mcmFtZSA9IE1hdGgudHJ1bmModGhpcy50aW1lIC8gMTAwMCkgJSBmYztcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLmRlbHRhICs9IHN0YW1wO1xyXG5cclxuXHRcdGlmICgkZ3YubV9lZGl0b3JfbW9kZSAmJiB0aGlzLmFhYmIpIHtcclxuXHRcdFx0dGhpcy4kZWRpdG9yX21vdXNlKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdF91cGRhdGVfYW5kX3ByZWxvYWQoc3RhbXApIHtcclxuXHRcdGNvbnN0IGZjID0gdGhpcy50ZXh0dXJlcy5sZW5ndGg7XHJcblx0XHRcclxuXHRcdGlmIChmYyA+IDEpIHtcclxuXHRcdFx0Y29uc3QgdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbdGhpcy5mcmFtZV07XHJcblxyXG5cdFx0XHR0aGlzLnRpbWUgPSB0aGlzLnRpbWUgKyBzdGFtcDtcclxuXHRcdFx0XHJcblx0XHRcdGlmICghdGV4dHVyZS5pc0xvYWRlZCgpKSB7XHJcblx0XHRcdFx0dGV4dHVyZS5fX2xvYWRUZXh0dXJlKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLnRpbWUgPiB0ZXh0dXJlLmRlbGF5KSB7XHJcblx0XHRcdFx0dGhpcy5mcmFtZSA9ICsrdGhpcy5mcmFtZTtcclxuXHJcblx0XHRcdFx0dGhpcy50aW1lID0gMDtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuZnJhbWUgPj0gZmMpIHtcclxuXHRcdFx0XHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLnVwZGF0ZTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IG5leHRfdGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbdGhpcy5mcmFtZSArIDFdO1xyXG5cdFx0XHRpZiAobmV4dF90ZXh0dXJlICYmICFuZXh0X3RleHR1cmUuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdG5leHRfdGV4dHVyZS5fX2xvYWRUZXh0dXJlKCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdC8vdGhpcy5mcmFtZSA9IE1hdGgudHJ1bmModGhpcy50aW1lIC8gMTAwMCkgJSBmYztcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5kZWx0YSArPSBzdGFtcDtcclxuXHRcdFxyXG5cdFx0aWYgKCRndi5tX2VkaXRvcl9tb2RlICYmIHRoaXMuYWFiYikge1xyXG5cdFx0XHR0aGlzLiRlZGl0b3JfbW91c2UoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0JGVkaXRvcl9tb3VzZSgpIHtcclxuXHRcdGNvbnN0IHZyZWN0ID0gJGd2Lm1fdmlld1JlY3Q7XHJcblx0XHRjb25zdCBtY3ggPSAkZ3YubV92aWV3UmVjdC5sZWZ0ICsgJGd2Lm1vdXNlX3g7XHJcblx0XHRjb25zdCBtY3kgPSAkZ3YubV92aWV3UmVjdC50b3AgKyAkZ3YubW91c2VfeTtcclxuXHRcdGlmICh0aGlzLnR5cGViID09IDAgJiYgdGhpcy5hYWJiLmNvbGxpZGU0ZjIobWN4LCBtY3ksIDEsIDEpKVxyXG5cdFx0e1xyXG5cdFx0XHR0aGlzLmRpc3BsYXlfYWFiYiA9IHRydWU7XHJcblx0XHRcdGlmICgkZ3YubW91c2VfZGwgPT0gMSAmJiAod2luZG93Lm1fc2VsZWN0ZWRfb2JqZWN0ICE9IHRoaXMgfHwgd2luZG93Lm1fc2VsZWN0ZWRfb2JqZWN0ID09IG51bGwpKSB7XHJcblx0XHRcdFx0dGhpcy4kc2VsZWN0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAod2luZG93Lm1faG92ZXJfb2JqZWN0ID09IG51bGwpIHtcclxuXHRcdFx0XHR3aW5kb3cubV9ob3Zlcl9vYmplY3QgPSB0aGlzO1xyXG5cdFx0XHRcdHRoaXMuYWFiYl9jb2xvciA9IFwicmdiYSgwLDI1NSwwLDAuMjUpXCI7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5hYWJiX2NvbG9yID0gXCJyZ2JhKDAsMCwyNTUsMC4yNSlcIjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuJHVuc2VsZWN0KCk7XHJcblx0XHR9XHJcblx0XHRpZiAod2luZG93Lm1fc2VsZWN0ZWRfb2JqZWN0ID09IHRoaXMpIHtcclxuXHRcdFx0dGhpcy5kaXNwbGF5X2FhYmIgPSB0cnVlO1xyXG5cdFx0XHR0aGlzLmFhYmJfY29sb3IgPSBcInJnYmEoMjU1LDAsMCwwLjUpXCI7XHJcblx0XHR9XHJcblx0fVxyXG5cdCRzZWxlY3QoKSB7XHJcblx0XHRpZiAod2luZG93Lm1fc2VsZWN0ZWRfb2JqZWN0KSB7XHJcblx0XHRcdHdpbmRvdy5tX3NlbGVjdGVkX29iamVjdC4kdW5zZWxlY3QoKTsvL3ByZXZcclxuXHRcdH1cclxuXHRcdHdpbmRvdy5tX3NlbGVjdGVkX29iamVjdCA9IHRoaXM7XHJcblx0XHR3aW5kb3cubV9ob3Zlcl9vYmplY3QgPSBudWxsO1xyXG5cdFx0JGd2Lm1vdXNlX2RsID0gMDtcclxuXHR9XHJcblx0JHVuc2VsZWN0KCkge1xyXG5cdFx0dGhpcy5kaXNwbGF5X2FhYmIgPSBmYWxzZTtcclxuXHR9XHJcblx0JGlzUmVwZWF0WCgpIHtcclxuXHRcdHJldHVybiB0aGlzLnR5cGViID09IDEgfHwgdGhpcy50eXBlYiA9PSA0O1xyXG5cdH1cclxuXHQkaXNSZXBlYXRZKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMudHlwZWIgPT0gMiB8fCB0aGlzLnR5cGViID09IDU7XHJcblx0fVxyXG5cdFxyXG5cdGNvbXB1dGVfcmVjdGFuZ2xlKGluZGV4KSB7XHJcblx0XHRjb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1tpbmRleF07XHJcblx0XHRpZiAodGV4dHVyZSkge1xyXG5cdFx0XHRjb25zdCB3aWR0aCA9IHRleHR1cmUud2lkdGg7XHJcblx0XHRcdGNvbnN0IGhlaWdodCA9IHRleHR1cmUuaGVpZ2h0O1xyXG5cclxuXHRcdFx0cmV0dXJuIG5ldyBSZWN0YW5nbGUodGhpcy54IC0gKHRoaXMuZiA/IC10ZXh0dXJlLnggKyB3aWR0aCA6IHRleHR1cmUueCksIHRoaXMueSAtIHRleHR1cmUueSwgd2lkdGgsIGhlaWdodCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGNvbXB1dGVfbWF4X3JlY3RhbmdsZSgpIHtcclxuXHRcdGlmICh0aGlzLnRleHR1cmVzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0bGV0IHsgbGVmdCwgdG9wLCByaWdodCwgYm90dG9tIH0gPSB0aGlzLmNvbXB1dGVfcmVjdGFuZ2xlKDApO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRmb3IgKGxldCBqID0gMTsgaiA8IHRoaXMudGV4dHVyZXMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0XHRsZXQgcmVjdCA9IHRoaXMuY29tcHV0ZV9yZWN0YW5nbGUoaik7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0bGVmdCA9IE1hdGgubWluKGxlZnQsIHJlY3QubGVmdCk7XHJcblx0XHRcdFx0dG9wID0gTWF0aC5taW4odG9wLCByZWN0LnRvcCk7XHJcblx0XHRcdFx0cmlnaHQgPSBNYXRoLm1heChyaWdodCwgcmVjdC5yaWdodCk7XHJcblx0XHRcdFx0Ym90dG9tID0gTWF0aC5tYXgoYm90dG9tLCByZWN0LmJvdHRvbSk7XHJcblx0XHRcdH1cclxuXHRcdFx0cmV0dXJuIFJlY3RhbmdsZS5wYXJzZShsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleF9vZl90ZXh0dXJlXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG14IC0gbW92ZSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG15IC0gbW92ZSB4XHJcblx0ICogQHBhcmFtIHtSZWN0YW5nbGV9IHZpZXdSZWN0XHJcblx0ICovXHJcblx0X19kcmF3X3RleHR1cmUocmVuZGVyZXIsIGluZGV4X29mX3RleHR1cmUsIG14LCBteSwgdmlld1JlY3QpIHtcclxuXHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdGlmICgoLS10aGlzLl9fbWF4X3JlcGVhdF9jb3VudCkgPD0gMCkge1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZiAodGhpcy50eXBlYiAhPSAwIHx8ICghdGhpcy5hYWJiIHx8IHRoaXMuYWFiYi5jb2xsaWRlKHZpZXdSZWN0KSkpIHtcclxuXHRcdFx0bGV0IHRleHR1cmUgPSB0aGlzLnRleHR1cmVzW2luZGV4X29mX3RleHR1cmVdO1xyXG5cclxuXHRcdFx0aWYgKGluZGV4X29mX3RleHR1cmUgJiYgIXRleHR1cmUuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdC8vIGZpbmQgbG9hZGVkIHRleHR1cmVcclxuXHRcdFx0XHRmb3IgKGxldCBpID0gaW5kZXhfb2ZfdGV4dHVyZSAtIDE7IGkgPj0gMDsgLS1pKSB7XHJcblx0XHRcdFx0XHR0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1tpbmRleF9vZl90ZXh0dXJlXTtcclxuXHRcdFx0XHRcdGlmICh0ZXh0dXJlLmlzTG9hZGVkKCkpIHtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHR0ZXh0dXJlLmRyYXcocmVuZGVyZXIsIHRoaXMuZiwgdGhpcy54ICsgbXgsIHRoaXMueSArIG15LCB0aGlzLnRpbWUsIHRoaXMuZGVsdGEpOy8vTWFwbGVTY2VuZVRleHR1cmUjZHJhd1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRpZiAoJGd2Lm1fZGlzcGxheV9zZWxlY3RlZF9vYmplY3QgJiYgJGd2Lm1fZWRpdG9yX21vZGUgJiYgdGhpcy5hYWJiICYmIHRoaXMuZGlzcGxheV9hYWJiKSB7XHJcblx0XHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHRcdFx0Y29uc3QgeCA9IE1hdGgudHJ1bmMoKC12aWV3UmVjdC5sZWZ0ICsgMC41KSArIHRoaXMuYWFiYi5sZWZ0KTtcclxuXHRcdFx0Y29uc3QgeSA9IE1hdGgudHJ1bmMoKC12aWV3UmVjdC50b3AgKyAwLjUpICsgdGhpcy5hYWJiLnRvcCk7XHJcblx0XHRcdFxyXG5cdFx0XHRyZW5kZXJlci5sb2FkSWRlbnRpdHkoKTtcclxuXHJcblx0XHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gMTtcclxuXHRcdFx0XHJcblx0XHRcdGN0eC5iZWdpblBhdGgoKTtcclxuXHRcdFx0Y3R4LnJlY3QoeCwgeSwgdGhpcy5hYWJiLndpZHRoLCB0aGlzLmFhYmIuaGVpZ2h0KTtcclxuXHRcdFx0Y3R4LmZpbGxTdHlsZSA9IHRoaXMuYWFiYl9jb2xvciB8fCBcInJnYmEoMjAsMjU1LDIwLDAuNSlcIjsvL1xyXG5cdFx0XHRjdHguZmlsbCgpO1xyXG5cdFx0XHRcclxuXHRcdFx0Y3R4LmxpbmVXaWR0aCA9IDM7XHJcblx0XHRcdC8vY3R4LmxpbmVDYXAgPSBcInJvdW5kXCI7XHJcblxyXG5cdFx0XHRjdHguc2V0TGluZURhc2goWzMsIDNdKTtcclxuXHRcdFx0Y3R4LmxpbmVEYXNoT2Zmc2V0ID0gMDtcclxuXHRcdFx0Y3R4LnN0cm9rZVN0eWxlID0gXCJyZ2JhKDAsMCwwLDAuNSlcIjtcclxuXHRcdFx0Y3R4LnN0cm9rZSgpO1xyXG5cclxuXHRcdFx0Y3R4LnNldExpbmVEYXNoKFszLCAzXSk7XHJcblx0XHRcdGN0eC5saW5lRGFzaE9mZnNldCA9IDM7XHJcblx0XHRcdGN0eC5zdHJva2VTdHlsZSA9IFwicmdiYSgyNTUsMjU1LDI1NSwwLjUpXCI7XHJcblx0XHRcdGN0eC5zdHJva2UoKTtcclxuXHJcblx0XHRcdGN0eC5zZXRMaW5lRGFzaChbXSk7XHJcblx0XHRcdGN0eC5saW5lV2lkdGggPSAxO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcHJvdGVjdGVkXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtpbnR9IG14XHJcblx0ICogQHBhcmFtIHtpbnR9IG15XHJcblx0ICogQHBhcmFtIHtSZWN0YW5nbGV9IHZpZXdSZWN0XHJcblx0ICovXHJcblx0X19kcmF3KHJlbmRlcmVyLCBteCwgbXksIHZpZXdSZWN0KSB7XHJcblx0XHR0aGlzLl9fZHJhd190ZXh0dXJlKHJlbmRlcmVyLCB0aGlzLmZyYW1lLCBteCwgbXksIHZpZXdSZWN0KTsvL01hcGxlU2NlbmVUZXh0dXJlI2RyYXdcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gaG9yaXpvbnRhbFxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gdmVydGljYWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbXggLSBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbXkgLSBpbnRcclxuXHQgKiBAcGFyYW0ge1JlY3RhbmdsZX0gdmlld1JlY3RcclxuXHQgKi9cclxuXHRfZHJhdyhyZW5kZXJlciwgaG9yaXpvbnRhbCwgdmVydGljYWwsIG14LCBteSwgdmlld1JlY3QpIHtcclxuXHRcdGxldCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1t0aGlzLmZyYW1lXTtcclxuXHRcdGlmICh0ZXh0dXJlID09IG51bGwpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyB2aWV3UmVjdCAtIGNhbnZhcyByZWN0YW5nbGVcclxuXHRcdGxldCB7IGxlZnQsIHRvcCwgcmlnaHQsIGJvdHRvbSB9ID0gdmlld1JlY3Q7XHJcblx0XHQvLyBpbWFnZSBwb3NpdGlvblxyXG5cdFx0bGV0IGl4ID0gdGhpcy54IC0gKHRoaXMuZiA/IC10ZXh0dXJlLnggKyB0ZXh0dXJlLndpZHRoIDogdGV4dHVyZS54KTtcclxuXHRcdGxldCBpeSA9IHRoaXMueSAtIHRleHR1cmUueTtcclxuXHRcdC8vIHRpbGUgc2l6ZVxyXG5cdFx0bGV0IHR3ID0gMCA9PSB0aGlzLmN4ID8gdGV4dHVyZS53aWR0aCA6IHRoaXMuY3g7XHJcblx0XHRsZXQgdGggPSAwID09IHRoaXMuY3kgPyB0ZXh0dXJlLmhlaWdodCA6IHRoaXMuY3k7XHJcblx0XHQvLyB0aWxlIGFyZWFcclxuXHRcdGxldCB4MSA9IGxlZnQgLSAodHcgKyAobGVmdCAtIG14IC0gaXgpICUgdHcpO1xyXG5cdFx0bGV0IHkxID0gdG9wIC0gKHRoICsgKHRvcCAtIG15IC0gaXkpICUgdGgpO1xyXG5cdFx0bGV0IHgyID0gcmlnaHQgKyAodHcgLSAocmlnaHQgLSBteCAtIGl4KSAlIHR3KTtcclxuXHRcdGxldCB5MiA9IGJvdHRvbSArICh0aCAtIChib3R0b20gLSBteSAtIGl5KSAlIHRoKTtcclxuXHRcdFxyXG5cdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuXHRcdFx0dGhpcy5fX21heF9yZXBlYXRfY291bnQgPSAxMDI0O1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChob3Jpem9udGFsKVxyXG5cdFx0XHRpZiAodmVydGljYWwpXHJcblx0XHRcdFx0Zm9yIChsZXQgeXkgPSB5MTsgeXkgPCB5MjsgeXkgPSB5eSArIHRoKVxyXG5cdFx0XHRcdFx0Zm9yIChsZXQgeHggPSB4MTsgeHggPCB4MjsgeHggPSB4eCArIHR3KVxyXG5cdFx0XHRcdFx0XHR0aGlzLl9fZHJhdyhyZW5kZXJlciwgeHggLSBpeCwgeXkgLSBpeSwgdmlld1JlY3QpO1xyXG5cdFx0XHRlbHNlXHJcblx0XHRcdFx0Zm9yIChsZXQgeHggPSB4MTsgeHggPCB4MjsgeHggPSB4eCArIHR3KVxyXG5cdFx0XHRcdFx0dGhpcy5fX2RyYXcocmVuZGVyZXIsIHh4IC0gaXgsIG15LCB2aWV3UmVjdCk7XHJcblx0XHRlbHNlIGlmICh2ZXJ0aWNhbClcclxuXHRcdFx0Zm9yIChsZXQgeXkgPSB5MTsgeXkgPCB5MjsgeXkgPSB5eSArIHRoKVxyXG5cdFx0XHRcdHRoaXMuX19kcmF3KHJlbmRlcmVyLCBteCwgeXkgLSBpeSwgdmlld1JlY3QpO1xyXG5cdFx0ZWxzZVxyXG5cdFx0XHR0aGlzLl9fZHJhdyhyZW5kZXJlciwgbXgsIG15LCB2aWV3UmVjdCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1ZlYzJ9IGNlbnRlclxyXG5cdCAqIEBwYXJhbSB7UmVjdGFuZ2xlfSB2aWV3UmVjdFxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpIHtcclxuXHRcdGlmICghdGhpcy50ZXh0dXJlcy5sZW5ndGgpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IG1yeCA9ICh0aGlzLnJ4ICsgMTAwKSAqIGNlbnRlci54IC8gMTAwO1xyXG5cdFx0bGV0IG1yeSA9ICh0aGlzLnJ5ICsgMTAwKSAqIGNlbnRlci55IC8gMTAwO1xyXG5cclxuXHRcdHN3aXRjaCAodGhpcy50eXBlYikge1xyXG5cdFx0XHRjYXNlIDA6IHRoaXMuX2RyYXcocmVuZGVyZXIsIGZhbHNlLCBmYWxzZSwgbXJ4LCBtcnksIHZpZXdSZWN0KTsgYnJlYWs7XHJcblx0XHRcdGNhc2UgMTogdGhpcy5fZHJhdyhyZW5kZXJlciwgdHJ1ZSwgZmFsc2UsIG1yeCwgbXJ5LCB2aWV3UmVjdCk7IGJyZWFrO1xyXG5cdFx0XHRjYXNlIDI6IHRoaXMuX2RyYXcocmVuZGVyZXIsIGZhbHNlLCB0cnVlLCBtcngsIG1yeSwgdmlld1JlY3QpOyBicmVhaztcclxuXHRcdFx0Y2FzZSAzOiB0aGlzLl9kcmF3KHJlbmRlcmVyLCB0cnVlLCB0cnVlLCBtcngsIG1yeSwgdmlld1JlY3QpOyBicmVhaztcclxuXHRcdFx0Y2FzZSA0OiB0aGlzLl9kcmF3KHJlbmRlcmVyLCB0cnVlLCBmYWxzZSwgTWF0aC50cnVuYyh0aGlzLmRlbHRhIC8gMjAwICogdGhpcy5yeCksIG1yeSwgdmlld1JlY3QpOyBicmVhaztcclxuXHRcdFx0Y2FzZSA1OiB0aGlzLl9kcmF3KHJlbmRlcmVyLCBmYWxzZSwgdHJ1ZSwgbXJ4LCBNYXRoLnRydW5jKHRoaXMuZGVsdGEgLyAyMDAgKiB0aGlzLnJ5KSwgdmlld1JlY3QpOyBicmVhaztcclxuXHRcdFx0Y2FzZSA2OiB0aGlzLl9kcmF3KHJlbmRlcmVyLCB0cnVlLCB0cnVlLCBNYXRoLnRydW5jKHRoaXMuZGVsdGEgLyAyMDAgKiB0aGlzLnJ4KSwgbXJ5LCB2aWV3UmVjdCk7IGJyZWFrO1xyXG5cdFx0XHRjYXNlIDc6IHRoaXMuX2RyYXcocmVuZGVyZXIsIHRydWUsIHRydWUsIG1yeCwgTWF0aC50cnVuYyh0aGlzLmRlbHRhIC8gMjAwICogdGhpcy5yeSksIHZpZXdSZWN0KTsgYnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICovXHJcblx0Z2V0IF90ZXh0dXJlX2Jhc2VfcGF0aCgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBNYXBPYmplY3QgZXh0ZW5kcyBNYXBPYmplY3RCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcihfcmF3KSB7XHJcblx0XHRzdXBlcihfcmF3KTtcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuX3Jhdy5jeCAhPSBudWxsICYmICghdGhpcy5fcmF3LnJ5IHx8IHRoaXMuX3Jhdy5yeSA9PSAtMTAwKSkge1xyXG5cdFx0XHRpZiAodGhpcy5fcmF3LnJ4KSB7Ly8hPSBudWxsICYmICE9IDBcclxuXHRcdFx0XHRpZiAodGhpcy5fcmF3LmN5ICE9IG51bGwpIHtcclxuXHRcdFx0XHRcdHRoaXMudHlwZWIgPSA2O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMudHlwZWIgPSA0O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnR5cGViID0gMTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuX3Jhdy5jeSAhPSBudWxsICYmICghdGhpcy5fcmF3LnJ4IHx8IHRoaXMuX3Jhdy5yeCA9PSAtMTAwKSkge1xyXG5cdFx0XHRpZiAodGhpcy5fcmF3LnJ5KSB7Ly8hPSBudWxsICYmICE9IDBcclxuXHRcdFx0XHRpZiAodGhpcy5fcmF3LmN4ICE9IG51bGwpIHtcclxuXHRcdFx0XHRcdHRoaXMudHlwZWIgPSA3O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMudHlwZWIgPSA1O1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnR5cGViID0gMjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMudXBkYXRlID0gdGhpcy5fdXBkYXRlX2FuZF9wcmVsb2FkO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGkgLSB0ZXh0dXJlIGluZGV4XHJcblx0ICogQHBhcmFtIHtNYXBUZXh0dXJlfSB0ZXh0dXJlMFxyXG5cdCAqIEByZXR1cm5zIHtNYXBUZXh0dXJlfVxyXG5cdCAqL1xyXG5cdF9sb2FkX3RleHR1cmUoaSwgdGV4dHVyZTApIHtcclxuXHRcdGNvbnN0IG51bGxfdXJsID0gdW5kZWZpbmVkO1xyXG5cdFx0bGV0IHBhdGggPSBbXCIvTWFwXCIsIFwiT2JqXCIsIHRoaXMuX3RleHR1cmVfYmFzZV9wYXRoLCBpXS5qb2luKFwiL1wiKTtcclxuXHJcblx0XHRsZXQgdGV4dHVyZSA9IG5ldyBNYXBUZXh0dXJlKHRoaXMuX3RleHR1cmVfcmF3W2ldLCBudWxsX3VybCwgdGV4dHVyZTApO1xyXG5cdFx0dGV4dHVyZS5fdXJsID0gcGF0aDtcclxuXHJcblx0XHRyZXR1cm4gdGV4dHVyZTtcclxuXHR9XHJcblxyXG5cdGdldCBfdGV4dHVyZV9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gW3RoaXMuX3Jhdy5vUywgdGhpcy5fcmF3LmwwLCB0aGlzLl9yYXcubDEsIHRoaXMuX3Jhdy5sMl0uam9pbihcIi9cIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiByYXcgZGF0YVxyXG5cdCAqIHRleHR1cmVzOyBpbmZvICYgZGF0YVxyXG5cdCAqL1xyXG5cdGdldCBfdGV4dHVyZV9yYXcoKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRyZXR1cm4gbWFwX3Nwcml0ZS5PYmpbdGhpcy5fcmF3Lm9TXVt0aGlzLl9yYXcubDBdW3RoaXMuX3Jhdy5sMV1bdGhpcy5fcmF3LmwyXTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdH1cclxuXHRcdHJldHVybiBudWxsO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgTWFwUGFydGljbGUgZXh0ZW5kcyBNYXBPYmplY3Qge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcpIHtcclxuXHRcdHN1cGVyKF9yYXcpO1xyXG5cdFx0LyoqIEB0eXBlIHtQYXJ0aWNsZUdyb3VwW119ICovXHJcblx0XHR0aGlzLmdyb3VwcyA9IFtdO1xyXG5cdH1cclxuXHRcclxuXHRhc3luYyBsb2FkKHBhcnRpY2xlX25hbWUpIHtcclxuXHRcdGxldCBwZyA9IG5ldyBQYXJ0aWNsZUdyb3VwKCk7XHJcblx0XHRcclxuXHRcdGF3YWl0IHBnLmxvYWQocGFydGljbGVfbmFtZSk7XHJcblxyXG5cdFx0bGV0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLl9yYXcpXHJcblx0XHRcdC5tYXAoaSA9PiB7XHJcblx0XHRcdFx0bGV0IG4gPSBwYXJzZUludChpLCAxMCk7XHJcblx0XHRcdFx0aWYgKE51bWJlci5pc1NhZmVJbnRlZ2VyKG4pKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gbjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0Y29uc29sZS53YXJuKFwiTWFwUGFydGljbGUuXCIgKyBwYXJ0aWNsZV9uYW1lICsgXCIuaWQ6IFwiICsgaSk7XHJcblx0XHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHRcdH0pXHJcblx0XHRcdC5maWx0ZXIoaSA9PiBpICE9IG51bGwpO1xyXG5cdFx0XHRcclxuXHRcdGZvciAobGV0IGkgb2Yga2V5cykge1xyXG5cdFx0XHR0aGlzLmdyb3Vwc1tpXSA9IHBnLmNsb25lKCk7XHJcblx0XHRcdHRoaXMuZ3JvdXBzW2ldLnggPSB0aGlzLl9yYXdbaV0ueDtcclxuXHRcdFx0dGhpcy5ncm91cHNbaV0ueSA9IHRoaXMuX3Jhd1tpXS55O1xyXG5cdFx0XHR0aGlzLmdyb3Vwc1tpXS5ldmFsdWF0ZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKiogQHBhcmFtIHtudW1iZXJ9IHN0YW1wIC0gdGltZSBpbiBtaWxsaXNlY29uZCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmdyb3Vwcy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRjb25zdCBwZyA9IHRoaXMuZ3JvdXBzW2ldO1xyXG5cdFx0XHRwZy51cGRhdGUoc3RhbXApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtWZWMyfSBjZW50ZXJcclxuXHQgKiBAcGFyYW0ge1JlY3RhbmdsZX0gdmlld1JlY3RcclxuXHQgKi9cclxuXHRkcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0KSB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZ3JvdXBzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGNvbnN0IHBnID0gdGhpcy5ncm91cHNbaV07XHJcblx0XHRcdGxldCBteCA9ICh0aGlzLnJ4ICsgMTAwKSAqIGNlbnRlci54IC8gMTAwO1xyXG5cdFx0XHRsZXQgbXkgPSAodGhpcy5yeSArIDEwMCkgKiBjZW50ZXIueSAvIDEwMDtcclxuXHRcdFx0cGcucmVuZGVyKHJlbmRlcmVyLCB2aWV3UmVjdCwgbXgsIG15KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7e3BhcnRpY2xlOntbbmFtZTpzdHJpbmddOnt9fX19IG1hcFJhd0RhdGFcclxuXHQgKiBAcGFyYW0ge1NjZW5lTWFwfSBzY2VuZU1hcFxyXG5cdCAqL1xyXG5cdHN0YXRpYyBjb25zdHJ1Y3QobWFwUmF3RGF0YSwgc2NlbmVNYXApIHtcclxuXHRcdGxldCB0YXNrcyA9IFtdO1xyXG5cdFx0bGV0IHBhcnRpY2xlTGlzdCA9IFtdO1xyXG5cdFx0Zm9yIChsZXQgcGFydGljbGVOYW1lIGluIG1hcFJhd0RhdGEucGFydGljbGUpIHtcclxuXHRcdFx0bGV0IHBhcnRpY2xlUmF3ID0gbWFwUmF3RGF0YS5wYXJ0aWNsZVtwYXJ0aWNsZU5hbWVdO1xyXG5cdFx0XHRsZXQgbXBwID0gbmV3IE1hcFBhcnRpY2xlKHBhcnRpY2xlUmF3KTtcclxuXHRcdFx0dGFza3MucHVzaChtcHAubG9hZChwYXJ0aWNsZU5hbWUpKTtcclxuXHRcdFx0cGFydGljbGVMaXN0LnB1c2gobXBwKTtcclxuXHRcdH1cclxuXHRcdHNjZW5lTWFwLnBhcnRpY2xlTGlzdCA9IHBhcnRpY2xlTGlzdDtcclxuXHRcdHJldHVybiB0YXNrcztcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIE1hcE9iamVjdFNrZWxldGFsQW5pbSBleHRlbmRzIE1hcE9iamVjdCB7XHJcblx0Y29uc3RydWN0b3IoX3JhdywgdXJsKSB7XHJcblx0XHRzdXBlcihfcmF3KTtcclxuXHRcdC8qKiBAdHlwZSB7U1NBbmltfSAqL1xyXG5cdFx0dGhpcy5zc2FuaW0gPSBudWxsO1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl9mbmFtZSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8vLyoqIEB0eXBle251bWJlcn0gdGFncyAqL1xyXG5cdFx0Ly90aGlzLl90YWdzID0gdGhpcy5fZ2V0KDAsIFwidGFnc1wiLCBTdHJpbmcpO1xyXG5cdH1cclxuXHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRnZXQgX2ZvbGRlcigpIHtcclxuXHRcdGNvbnN0IHJhdyA9IHRoaXMuX3JhdztcclxuXHRcdC8vW1wiT2JqXCJcdCBdW29iai5vU11bb2JqLmwwXVtvYmoubDFdW29iai5sMl1bMCAgICBdW1wiXCJdXHJcblx0XHRyZXR1cm4gYC9NYXAvT2JqLyR7cmF3Lm9TfS8ke3Jhdy5sMH0vJHtyYXcubDF9LyR7cmF3LmwyfWA7XHJcblx0fVxyXG5cdGFzeW5jIGxvYWQoKSB7XHJcblx0XHRpZiAoU1NBbmltKSB7XHJcblx0XHRcdGNvbnN0IHJhdyA9IHRoaXMuX3JhdztcclxuXHRcdFx0bGV0IHNzYW5pbTtcclxuXHRcdFx0XHJcblx0XHRcdHNzYW5pbSA9IG5ldyBTU0FuaW0oKTtcclxuXHRcdFx0XHJcblx0XHRcdHRyeSB7XHJcblx0XHRcdFx0YXdhaXQgc3NhbmltLmxvYWQodGhpcy5fZm9sZGVyKTtcclxuXHRcdFx0XHRzc2FuaW0udXBkYXRlKDApOy8vaW5pdCBwb3MgZGF0YVxyXG5cdFx0XHR9XHJcblx0XHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0aWYgKHJhdy5zcGluZVJhbmRvbVN0YXJ0KSB7XHJcblx0XHRcdFx0bGV0IHQgPSBzc2FuaW0uYW5pbV9sZW5ndGggKiBNYXRoLnJhbmRvbSgpO1xyXG5cdFx0XHRcdHNzYW5pbS5zZXRBbmltVGltZSh0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRcclxuXHRcdFx0Y29uc3QgciA9IE1hdGgucm91bmQoTWF0aC5zcXJ0KHNzYW5pbS53aWR0aCAqKiAyICsgc3NhbmltLmhlaWdodCAqKiAyKSk7XHJcblx0XHRcdGNvbnN0IGhyID0gTWF0aC5yb3VuZChyICogMC41KTtcclxuXHRcdFx0dGhpcy5hYWJiID0gbmV3IFJlY3RhbmdsZSh0aGlzLnggLSBociwgdGhpcy55IC0gaHIsIHIsIHIpO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5zc2FuaW0gPSBzc2FuaW07XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdHVubG9hZCgpIHtcclxuXHRcdGlmICh0aGlzLnNzYW5pbSkge1xyXG5cdFx0XHR0aGlzLnNzYW5pbS51bmxvYWQoKTtcclxuXHRcdFx0dGhpcy5zc2FuaW0gPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMuZGVsdGEgKz0gc3RhbXA7XHJcblx0XHRcclxuXHRcdGlmICh0aGlzLnNzYW5pbSAmJiB3aW5kb3cuZW5hYmxlX3NrZWxldGFsX2FuaW0pIHtcclxuXHRcdFx0dGhpcy5zc2FuaW0udXBkYXRlKHN0YW1wKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7VmVjMn0gY2VudGVyXHJcblx0ICogQHBhcmFtIHtSZWN0YW5nbGV9IHZpZXdSZWN0IC0gPz8gbm8gdXNlXHJcblx0ICovXHJcblx0ZHJhdyhyZW5kZXJlciwgY2VudGVyLCB2aWV3UmVjdCkge1xyXG5cdFx0aWYgKCRndi5tX2Rpc3BsYXlfc2tlbGV0YWxfYW5pbSkge1xyXG5cdFx0XHRjb25zdCB4ID0gTWF0aC50cnVuYygoLSRndi5tX3ZpZXdSZWN0LnggKyAwLjUpICsgdGhpcy54KTtcclxuXHRcdFx0Y29uc3QgeSA9IE1hdGgudHJ1bmMoKC0kZ3YubV92aWV3UmVjdC55ICsgMC41KSArIHRoaXMueSk7XHJcblxyXG5cdFx0XHRyZW5kZXJlci5jdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIC0xLCB4LCB5KTtcclxuXHJcblx0XHRcdGlmICh0aGlzLnNzYW5pbSkge1xyXG5cdFx0XHRcdHRoaXMuc3NhbmltLnJlbmRlcigpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLmRpc3BsYXlfYWFiYikge1xyXG5cdFx0XHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHJcblx0XHRcdFx0cmVuZGVyZXIuY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAxLCBNYXRoLnRydW5jKC0kZ3YubV92aWV3UmVjdC54ICsgMC41KSwgTWF0aC50cnVuYygtJGd2Lm1fdmlld1JlY3QueSArIDAuNSkpO1xyXG5cclxuXHRcdFx0XHRjdHguYmVnaW5QYXRoKCk7XHJcblx0XHRcdFx0Y3R4LnJlY3QodGhpcy54IC0gdGhpcy5zc2FuaW0ud2lkdGggKiAwLjUsIHRoaXMueSAtIHRoaXMuc3NhbmltLmhlaWdodCwgdGhpcy5zc2FuaW0ud2lkdGgsIHRoaXMuc3NhbmltLmhlaWdodCk7XHJcblx0XHRcdFx0Y3R4LmZpbGxTdHlsZSA9IFwicmdiYSgyMCwyNTUsMjAsMC41KVwiO1xyXG5cdFx0XHRcdGN0eC5maWxsKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIE1hcFRpbGUgZXh0ZW5kcyBNYXBPYmplY3Qge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcsIGluZm8pIHtcclxuXHRcdHN1cGVyKF9yYXcpO1xyXG5cdFx0dGhpcy5faW5mbyA9IGluZm87XHJcblx0XHR0aGlzLnVwZGF0ZSA9IHRoaXMuX3VwZGF0ZV9hbmRfcHJlbG9hZDtcclxuXHR9XHJcblx0bG9hZCgpIHtcclxuXHRcdGxldCB0ZXh0dXJlID0gbmV3IE1hcFRleHR1cmUodGhpcy5fdGV4dHVyZV9yYXcpO1xyXG5cclxuXHRcdHRoaXMudGV4dHVyZXNbMF0gPSB0ZXh0dXJlO1xyXG5cdFx0dGhpcy50ZXh0dXJlc1swXS5fdXJsID0gW1wiL01hcFwiLCBcIlRpbGVcIiwgdGhpcy5faW5mby50UywgdGhpcy5fcmF3LnUsIHRoaXMuX3Jhdy5ub10uam9pbihcIi9cIik7XHJcblxyXG5cdFx0dGhpcy5fX2NhbGNfYWFiYigpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogcmF3IGRhdGFcclxuXHQgKiB0ZXh0dXJlczsgaW5mbyAmIGRhdGFcclxuXHQgKi9cclxuXHRnZXQgX3RleHR1cmVfcmF3KCkge1xyXG5cdFx0dHJ5e1xyXG5cdFx0XHRyZXR1cm4gbWFwX3Nwcml0ZS5UaWxlW3RoaXMuX2luZm8udFNdW3RoaXMuX3Jhdy51XVt0aGlzLl9yYXcubm9dO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG5cdFxyXG5cdGdldCBfdGV4dHVyZV9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gW3RoaXMuX2luZm8udFMsIHRoaXMuX3Jhdy51LCB0aGlzLl9yYXcubm9dLmpvaW4oXCIvXCIpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIE1hcEVkaXRvcjogTWFwIFBvcnRhbFxyXG4gKiBNYXAgZ3JhcGggKHN0cnVjdCk6IFwiTWFwL01hcC9HcmFwaC9cIlxyXG4gKi9cclxuY2xhc3MgTWFwUG9ydGFsIGV4dGVuZHMgTWFwT2JqZWN0IHtcclxuXHRjb25zdHJ1Y3RvcihfcmF3LCBtYXBSZW5kZXJlcikge1xyXG5cdFx0c3VwZXIoX3Jhdyk7Ly9sb2FkIHgsIHlcclxuXHRcdFxyXG5cdFx0dGhpcy5tYXBSZW5kZXJlciA9IG1hcFJlbmRlcmVyO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSB0byBtYXBJZCAqL1xyXG5cdFx0dGhpcy50bSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtIHRuIHRvIHBuICovXHJcblx0XHR0aGlzLnRuID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBwbiB0byB0biAqL1xyXG5cdFx0dGhpcy5wbiA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5zY3JpcHQgPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLmVuYWJsZSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7XCJwb3J0YWxTdGFydFwifFwicG9ydGFsQ29udGludWVcInxcInBvcnRhbEV4aXRcIn0gKi9cclxuXHRcdHRoaXMuc3RhdGUgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7W1wicG9ydGFsU3RhcnRcIixcInBvcnRhbENvbnRpbnVlXCIsXCJwb3J0YWxFeGl0XCJdfSAqL1xyXG5cdFx0dGhpcy5zdGF0ZXMgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5za2luID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLnVwZGF0ZSA9IHRoaXMuX3VwZGF0ZV9hbmRfcHJlbG9hZDtcclxuXHR9XHJcblx0XHJcblx0Ly9zeW5jXHJcblx0bG9hZCgpIHtcclxuXHRcdHRoaXMudG0gPSB0aGlzLl9nZXQoXCJcIiwgXCJ0bVwiLCBTdHJpbmcpLnBhZFN0YXJ0KDksIFwiMFwiKTsvLz8/XHJcblx0XHR0aGlzLnRuID0gdGhpcy5fZ2V0KFwiXCIsIFwidG5cIiwgU3RyaW5nKTsvLz8/XHJcblx0XHR0aGlzLnBuID0gdGhpcy5fZ2V0KFwiXCIsIFwicG5cIiwgU3RyaW5nKTsvL3B0X2dvMDEgPT4gZ290byBwb3J0YWxfMDFcclxuXHRcdHRoaXMuc2NyaXB0ID0gdGhpcy5fZ2V0KG51bGwsIFwic2NyaXB0XCIsIFN0cmluZyk7XHJcblx0XHRcclxuXHRcdHRoaXMuZW5hYmxlID0gdGhpcy50bSAhPSBcIlwiICYmIHRoaXMudG0gIT0gXCI5OTk5OTk5OTlcIjtcclxuXHJcblx0XHR0aGlzLl9sb2FkVGV4dHVyZSgpO1xyXG5cdH1cclxuXHR1bmxvYWQoKSB7XHJcblx0XHRpZiAodGhpcy5ib2R5KSB7XHJcblx0XHRcdHRoaXMuYm9keS5HZXRXb3JsZCgpLkRlc3Ryb3lCb2R5KHRoaXMuYm9keSk7XHJcblx0XHRcdHRoaXMuYm9keSA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGdldE1hcCgpIHtcclxuXHRcdGlmICh0aGlzLmVuYWJsZSkge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy50bTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtWZWMyfSBjZW50ZXJcclxuXHQgKiBAcGFyYW0ge1JlY3RhbmdsZX0gdmlld1JlY3RcclxuXHQgKi9cclxuXHRkcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0KSB7XHJcblx0XHRpZiAodGhpcy5lbmFibGUpIHtcclxuXHRcdFx0c3VwZXIuZHJhdyhyZW5kZXJlciwgY2VudGVyLCB2aWV3UmVjdCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0aGlzLl9fZGlzcGxheV9tb2RlKSB7XHJcblx0XHRcdHN1cGVyLmRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0X2xvYWRUZXh0dXJlKCkge1xyXG5cdFx0Ly8vKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdC8vbGV0IHR5cGUgPSB0aGlzLl9yYXcucHQ7XHJcblx0XHQvL1xyXG5cdFx0Ly9sZXQgc2tpbnMgPSB0aGlzLl9sb2FkZWRfcG9ydGFsc1t0aGlzLl9fZGlzcGxheV9tb2RlXVt0eXBlXTtcclxuXHRcdC8vXHJcblx0XHQvL3RoaXMudGV4dHVyZXMgPSBza2lucy5kZWZhdWx0IHx8IHNraW5zWzBdO1xyXG5cclxuXHRcdC8vTWFwT2JqZWN0Ojp0eXBlXHJcblx0XHRpZiAodGhpcy5fX2Rpc3BsYXlfbW9kZSA9PSBcImdhbWVcIikge1xyXG5cdFx0XHR0aGlzLnR5cGUgPSBcInBcIjsvLz8/XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy50eXBlID0gXCJxXCI7Ly8/P1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IF9yYXcgPSBNYXBQb3J0YWwuX3BvcnRhbHNfcmF3O1xyXG5cclxuXHRcdHRoaXMudGV4dHVyZXMubGVuZ3RoID0gMDsvL2NsZWFyXHJcblxyXG5cdFx0Y29uc3QgdHlwZSA9IE1hcFBvcnRhbC5fdHlwZV9tYXBbdGhpcy5fcmF3LnB0XTtcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuX19kaXNwbGF5X21vZGUgPT0gXCJlZGl0b3JcIikge1xyXG5cdFx0XHRsZXQgdGV4dHVyZSA9IG5ldyBNYXBUZXh0dXJlKF9yYXcuZWRpdG9yW3R5cGVdKTtcclxuXHRcdFx0dGV4dHVyZS5fdXJsID0gW3RoaXMuX3RleHR1cmVfYmFzZV9wYXRoLCB0aGlzLl9fZGlzcGxheV9tb2RlLCB0eXBlXS5qb2luKFwiL1wiKTtcclxuXHRcdFx0dGhpcy50ZXh0dXJlc1swXSA9IHRleHR1cmU7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChfcmF3LmdhbWVbdHlwZV0pIHtcclxuXHRcdFx0bGV0IHNraW4gPSB0aGlzLnNraW4gIT0gbnVsbCA/IHRoaXMuc2tpbiA6IFwiZGVmYXVsdFwiO1xyXG5cdFx0XHRpZiAoXCIwXCIgaW4gX3Jhdy5nYW1lW3R5cGVdW3NraW5dKSB7Ly9pcyBhbmltYXRpb24gZnJhbWVzXHJcblx0XHRcdFx0bGV0IHRleHR1cmVzID0gX3Jhdy5nYW1lW3R5cGVdW3NraW5dO1xyXG5cdFx0XHRcdGZvciAobGV0IGkgaW4gdGV4dHVyZXMpIHtcclxuXHRcdFx0XHRcdGxldCB0ZXh0dXJlID0gbmV3IE1hcFRleHR1cmUodGV4dHVyZXNbaV0pO1xyXG5cdFx0XHRcdFx0dGV4dHVyZS5fdXJsID0gW3RoaXMuX3RleHR1cmVfYmFzZV9wYXRoLCB0aGlzLl9fZGlzcGxheV9tb2RlLCB0eXBlLCBza2luLCBpXS5qb2luKFwiL1wiKTtcclxuXHRcdFx0XHRcdHRoaXMudGV4dHVyZXMucHVzaCh0ZXh0dXJlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Ly9UT0RPOiBuZWVkIGRlZmF1bHQgc3RhdGVcclxuXHRcdFx0XHR0aGlzLnN0YXRlcyA9IE9iamVjdC5rZXlzKF9yYXcuZ2FtZVt0eXBlXVtza2luXSk7XHJcblx0XHRcdFx0dGhpcy5zdGF0ZSA9IHRoaXMuc3RhdGVzWzEgJSB0aGlzLnN0YXRlcy5sZW5ndGhdO1xyXG5cclxuXHRcdFx0XHRsZXQgdGV4dHVyZXMgPSBfcmF3LmdhbWVbdHlwZV1bc2tpbl1bdGhpcy5zdGF0ZV07XHJcblx0XHRcdFx0Zm9yIChsZXQgaSBpbiB0ZXh0dXJlcykge1xyXG5cdFx0XHRcdFx0bGV0IHRleHR1cmUgPSBuZXcgTWFwVGV4dHVyZSh0ZXh0dXJlc1tpXSk7XHJcblx0XHRcdFx0XHR0ZXh0dXJlLl91cmwgPSBbdGhpcy5fdGV4dHVyZV9iYXNlX3BhdGgsIHRoaXMuX19kaXNwbGF5X21vZGUsIHR5cGUsIHNraW4sIHRoaXMuc3RhdGUsIGldLmpvaW4oXCIvXCIpO1xyXG5cdFx0XHRcdFx0dGhpcy50ZXh0dXJlcy5wdXNoKHRleHR1cmUpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vcmVzZXRcclxuXHRcdHRoaXMuZGVsdGEgPSAwO1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdHRoaXMuZnJhbWUgPSAwO1xyXG5cdH1cclxuXHJcblx0Z2V0IF90ZXh0dXJlX2Jhc2VfcGF0aCgpIHtcclxuXHRcdHJldHVybiBcIi9NYXAvTWFwSGVscGVyL3BvcnRhbFwiO1xyXG5cdH1cclxuXHRnZXQgX2dldFRleHR1cmVQYXRoKCkge1xyXG5cdFx0aWYgKHRoaXMuX19kaXNwbGF5X21vZGUgPT0gXCJlZGl0b3JcIikge1xyXG5cdFx0XHRyZXR1cm4gW1wiL01hcC9NYXBIZWxwZXIvcG9ydGFsXCIsIHRoaXMuX19kaXNwbGF5X21vZGVdLmpvaW4oXCIvXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiBbXCIvTWFwL01hcEhlbHBlci9wb3J0YWxcIiwgdGhpcy5fX2Rpc3BsYXlfbW9kZV0uam9pbihcIi9cIik7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEByZXR1cm5zIHtcImVkaXRvclwifFwiZ2FtZVwifVxyXG5cdCAqL1xyXG5cdGdldCBfX2Rpc3BsYXlfbW9kZSgpIHtcclxuXHRcdHJldHVybiAkZ3YubV9lZGl0b3JfbW9kZSA/IFwiZWRpdG9yXCIgOiBcImdhbWVcIjtcclxuXHR9XHJcblxyXG5cdC8vLyoqXHJcblx0Ly8gKiBAdHlwZSB7e2VkaXRvcjp7W3B0Om51bWJlcl06e1tza2luOm51bWJlcl06TWFwVGV4dHVyZX19LGdhbWU6e1twdDpudW1iZXJdOntbc2tpbjpudW1iZXJdOk1hcFRleHR1cmVbXSxkZWZhdWx0Ok1hcFRleHR1cmVbXX19fX1cclxuXHQvLyAqL1xyXG5cdC8vZ2V0IF9sb2FkZWRfcG9ydGFscygpIHtcclxuXHQvL1x0cmV0dXJuIE1hcFBvcnRhbC5fcG9ydGFscztcclxuXHQvL31cclxuXHRcclxuXHRzdGF0aWMgYXN5bmMgSW5pdCgpIHtcclxuXHRcdE1hcFBvcnRhbC5fcG9ydGFsc19yYXcgPSBhd2FpdCAkZ2V0LmRhdGEoXCIvTWFwL01hcEhlbHBlci9wb3J0YWxcIik7XHJcblxyXG5cdFx0TWFwUG9ydGFsLl90eXBlX21hcCA9IE9iamVjdC5rZXlzKE1hcFBvcnRhbC5fcG9ydGFsc19yYXcuZWRpdG9yKTtcclxuXHR9XHJcbn1cclxuTWFwUG9ydGFsLl9wb3J0YWxzX3JhdyA9IHt9O1xyXG5NYXBQb3J0YWwuX3R5cGVfbWFwID0ge307XHJcbi8vTWFwUG9ydGFsLl9wb3J0YWxzID0ge307XHJcbk1hcFBvcnRhbC5fc2NyaXB0ID0ge307XHJcblxyXG5jbGFzcyBNYXBQb3J0YWxNYW5hZ2VyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7TWFwUG9ydGFsW119ICovXHJcblx0XHR0aGlzLnBvcnRhbHMgPSBudWxsO1xyXG5cclxuXHRcdHRoaXMuX19kaXNwbGF5X21vZGUgPSB0aGlzLl9fZGlzcGxheV9tb2RlO1xyXG5cdH1cclxuXHRcclxuXHRhc3luYyBsb2FkKG1hcF9yYXdfZGF0YSwgbWFwUmVuZGVyZXIpIHtcclxuXHRcdGxldCBwb3J0YWxzID0gW107XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSBpbiBtYXBfcmF3X2RhdGEucG9ydGFsOyArK2kpIHtcclxuXHRcdFx0bGV0IHJhdyA9IG1hcF9yYXdfZGF0YS5wb3J0YWxbaV07XHJcblx0XHRcdGxldCBwdCA9IG5ldyBNYXBQb3J0YWwocmF3LCBtYXBSZW5kZXJlcik7XHJcblx0XHRcdFxyXG5cdFx0XHRwdC5sb2FkKCk7Ly9zeW5jXHJcblx0XHRcdFxyXG5cdFx0XHQvL2lmIChwdC5lbmFibGUpIHtcclxuXHRcdFx0XHRtYXBSZW5kZXJlci5jb250cm9sbGVyLmNyZWF0ZVBvcnRhbChwdCk7Ly9pbmplY3QgYm9keVxyXG5cdFx0XHQvL31cclxuXHRcdFx0XHJcblx0XHRcdHBvcnRhbHMucHVzaChwdCk7XHJcblx0XHR9XHJcblx0XHR0aGlzLnBvcnRhbHMgPSBwb3J0YWxzO1xyXG5cdH1cclxuXHR1bmxvYWQoKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucG9ydGFscy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRsZXQgcHRsID0gdGhpcy5wb3J0YWxzW2ldO1xyXG5cdFx0XHRwdGwudW5sb2FkKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0aWYgKHRoaXMuX19kaXNwbGF5X21vZGUgIT0gJGd2Lm1fZWRpdG9yX21vZGUpIHtcclxuXHRcdFx0dGhpcy5fX2Rpc3BsYXlfbW9kZSA9ICRndi5tX2VkaXRvcl9tb2RlO1xyXG5cclxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBvcnRhbHMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHRsZXQgcG9ydGFsID0gdGhpcy5wb3J0YWxzW2ldO1xyXG5cdFx0XHRcdHBvcnRhbC5fbG9hZFRleHR1cmUoKTtcclxuXHRcdFx0XHRwb3J0YWwudXBkYXRlKHN0YW1wKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wb3J0YWxzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0bGV0IHBvcnRhbCA9IHRoaXMucG9ydGFsc1tpXTtcclxuXHRcdFx0XHRwb3J0YWwudXBkYXRlKHN0YW1wKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1ZlYzJ9IGNlbnRlclxyXG5cdCAqIEBwYXJhbSB7UmVjdGFuZ2xlfSB2aWV3UmVjdFxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wb3J0YWxzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGxldCBwb3J0YWwgPSB0aGlzLnBvcnRhbHNbaV07XHJcblx0XHRcdHBvcnRhbC5kcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0KTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8vICAgICAgICAgIFtjYXRlZ29yeV1bc291cmNlXVxyXG4vL1xyXG4vL3N0YXRpYyBiYWNrXHJcbi8vaW1nQmFjayA9IFtjYXRlZ29yeV1bc291cmNlXVtjbGFzcyBdW251bWJlcl1bXCJcIl1cclxuLy9pbWdCYWNrID0gW1wiQmFja1wiICBdW29iai5iU11bXCJiYWNLXCJdW29iai5ub11bXCJcIl1cclxuLy9cclxuLy9hbmltYXRpb24gYmFja1xyXG4vL2ltZ0JhY2sgPSBbY2F0ZWdvcnldW3NvdXJjZV1bY2xhc3MgXVtudW1iZXJdW2ZyYW1lXVtcIlwiXVxyXG4vL2ltZ0JhY2sgPSBbXCJCYWNrXCIgIF1bb2JqLmJTXVtcImFuaVwiIF1bb2JqLm5vXVswICAgIF1bXCJcIl1cclxuLy9cclxuLy9vYmplY3RcclxuLy9pbWdPYmogID0gW2NhdGVnb3J5XVtzb3VyY2VdW3BhdGhfMF1bcGF0aF8xXVtwYXRoXzJdW2ZyYW1lXVtcIlwiXVxyXG4vL2ltZ09iaiAgPSBbXCJPYmpcIlx0IF1bb2JqLm9TXVtvYmoubDBdW29iai5sMV1bb2JqLmwyXVswICAgIF1bXCJcIl1cclxuXHJcbmNsYXNzIE1hcEJhY2tCYXNlIGV4dGVuZHMgTWFwT2JqZWN0QmFzZSB7XHJcblx0Y29uc3RydWN0b3IoX3Jhdykge1xyXG5cdFx0c3VwZXIoX3Jhdyk7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQGltcGxlbWVudHMge0lBc3luY0xvYWRpbmd9XHJcbiAqL1xyXG5jbGFzcyBNYXBCYWNrIGV4dGVuZHMgTWFwQmFja0Jhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcpIHtcclxuXHRcdHN1cGVyKF9yYXcpO1xyXG5cdFx0dGhpcy51cGRhdGUgPSB0aGlzLl91cGRhdGVfYW5kX3ByZWxvYWQ7XHJcblx0fVxyXG5cclxuXHRsb2FkKCkge1xyXG5cdFx0bGV0IHBhdGggPSBbXCIvTWFwXCIsIFwiQmFja1wiLCB0aGlzLl90ZXh0dXJlX2Jhc2VfcGF0aF0uam9pbihcIi9cIik7XHJcblxyXG5cdFx0aWYgKHRoaXMuX3Jhdy5iUykge1xyXG5cdFx0XHRjb25zdCByYXcgPSB0aGlzLl90ZXh0dXJlX3JhdztcclxuXHRcdFx0aWYgKHJhdykge1xyXG5cdFx0XHRcdHRoaXMudGV4dHVyZXNbMF0gPSBuZXcgTWFwVGV4dHVyZSh0aGlzLl90ZXh0dXJlX3Jhdyk7XHJcblx0XHRcdFx0dGhpcy50ZXh0dXJlc1swXS5fdXJsID0gcGF0aDtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGNvbnNvbGUud2FybihcIk1hcEJhY2sgcGF0aCA/OiBcIiArIHBhdGgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRnZXQgX3RleHR1cmVfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFt0aGlzLl9yYXcuYlMsIFwiYmFja1wiLCB0aGlzLl9yYXcubm9dLmpvaW4oXCIvXCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogcmF3IGRhdGFcclxuXHQgKiB0ZXh0dXJlOyBpbmZvICYgZGF0YVxyXG5cdCAqL1xyXG5cdGdldCBfdGV4dHVyZV9yYXcoKSB7XHJcblx0XHRpZiAodGhpcy5fcmF3LmJTICYmIHRoaXMuX3Jhdy5ubykge1xyXG5cdFx0XHRyZXR1cm4gbWFwX3Nwcml0ZS5CYWNrW3RoaXMuX3Jhdy5iU11bXCJiYWNrXCJdW3RoaXMuX3Jhdy5ub107XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAaW1wbGVtZW50cyB7SUFzeW5jTG9hZGluZ31cclxuICovXHJcbmNsYXNzIE1hcEJhY2tBbmltYXRpb24gZXh0ZW5kcyBNYXBCYWNrQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoX3Jhdykge1xyXG5cdFx0c3VwZXIoX3Jhdyk7XHJcblx0XHR0aGlzLnVwZGF0ZSA9IHRoaXMuX3VwZGF0ZV9hbmRfcHJlbG9hZDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpIC0gdGV4dHVyZSBpbmRleFxyXG5cdCAqIEBwYXJhbSB7TWFwVGV4dHVyZX0gdGV4dHVyZTBcclxuXHQgKiBAcmV0dXJucyB7TWFwVGV4dHVyZX1cclxuXHQgKi9cclxuXHRfbG9hZF90ZXh0dXJlKGksIHRleHR1cmUwKSB7XHJcblx0XHRsZXQgcGF0aCA9IFtcIi9NYXBcIiwgXCJCYWNrXCIsIHRoaXMuX3RleHR1cmVfYmFzZV9wYXRoLCBpXS5qb2luKFwiL1wiKTtcclxuXHJcblx0XHRsZXQgdGV4dHVyZSA9IG5ldyBNYXBUZXh0dXJlKHRoaXMuX3RleHR1cmVfcmF3W2ldKTtcclxuXHRcdHRleHR1cmUuX3VybCA9IHBhdGg7XHJcblxyXG5cdFx0cmV0dXJuIHRleHR1cmU7XHJcblx0fVxyXG5cdFxyXG5cdGdldCBfdGV4dHVyZV9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gW3RoaXMuX3Jhdy5iUywgXCJhbmlcIiwgdGhpcy5fcmF3Lm5vXS5qb2luKFwiL1wiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHJhdyBkYXRhXHJcblx0ICogdGV4dHVyZSBzZXQ7IGluZm8gJiBkYXRhXHJcblx0ICogbm90IGFycmF5XHJcblx0ICovXHJcblx0Z2V0IF90ZXh0dXJlX3JhdygpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdHJldHVybiBtYXBfc3ByaXRlLkJhY2tbdGhpcy5fcmF3LmJTXVtcImFuaVwiXVt0aGlzLl9yYXcubm9dO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIG51bGw7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBNYXBCYWNrU2tlbGV0YWxBbmltIGV4dGVuZHMgTWFwQmFja0Jhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcpIHtcclxuXHRcdHN1cGVyKF9yYXcpO1xyXG5cdFx0LyoqIEB0eXBlIHtTU0FuaW19ICovXHJcblx0XHR0aGlzLnNzYW5pbSA9IG51bGw7XHJcblx0fVxyXG5cdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdGdldCBfZm9sZGVyKCkge1xyXG5cdFx0Y29uc3Qgb2IgPSB0aGlzLl9yYXc7XHJcblx0XHQvL1tcIkJhY2tcIiAgXVtvYmouYlNdW1wiYW5pXCIgXVtvYmoubm9dWzAgICAgXVtcIlwiXVxyXG5cdFx0cmV0dXJuIGAvTWFwL0JhY2svJHtvYi5iU30vc3BpbmUvJHtvYi5ub31gO1xyXG5cdH1cclxuXHRhc3luYyBsb2FkKCkge1xyXG5cdFx0aWYgKFNTQW5pbSkge1xyXG5cdFx0XHRsZXQgc3NhbmltID0gbmV3IFNTQW5pbSgpO1xyXG5cdFx0XHR0cnkge1xyXG5cdFx0XHRcdGF3YWl0IHNzYW5pbS5sb2FkKHRoaXMuX2ZvbGRlcik7XHJcblx0XHRcdFx0c3NhbmltLnVwZGF0ZSgwKTsvL2luaXQgcG9zIGRhdGFcclxuXHRcdFx0fVxyXG5cdFx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKGV4KTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5zc2FuaW0gPSBzc2FuaW07XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdHVubG9hZCgpIHtcclxuXHRcdGlmICh0aGlzLnNzYW5pbSkge1xyXG5cdFx0XHR0aGlzLnNzYW5pbS51bmxvYWQoKTtcclxuXHRcdFx0dGhpcy5zc2FuaW0gPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGlmICh0aGlzLnNzYW5pbSAmJiB3aW5kb3cuZW5hYmxlX3NrZWxldGFsX2FuaW0pIHtcclxuXHRcdFx0dGhpcy5zc2FuaW0udXBkYXRlKHN0YW1wKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7VmVjMn0gY2VudGVyXHJcblx0ICogQHBhcmFtIHtSZWN0YW5nbGV9IHZpZXdSZWN0IC0gPz8gbm8gdXNlXHJcblx0ICovXHJcblx0ZHJhdyhyZW5kZXJlciwgY2VudGVyLCB2aWV3UmVjdCkge1xyXG5cdFx0aWYgKCRndi5tX2Rpc3BsYXlfc2tlbGV0YWxfYW5pbSkge1xyXG5cdFx0XHRpZiAodGhpcy5zc2FuaW0pIHtcclxuXHRcdFx0XHRjb25zdCB4ID0gTWF0aC50cnVuYygoLSRndi5tX3ZpZXdSZWN0LnggKyAwLjUpICsgdGhpcy54KTtcclxuXHRcdFx0XHRjb25zdCB5ID0gTWF0aC50cnVuYygoLSRndi5tX3ZpZXdSZWN0LnkgKyAwLjUpICsgdGhpcy55KTtcclxuXHJcblx0XHRcdFx0cmVuZGVyZXIuY3R4LnNldFRyYW5zZm9ybSgxLCAwLCAwLCAtMSwgeCwgeSk7XHJcblxyXG5cdFx0XHRcdHRoaXMuc3NhbmltLnJlbmRlcigpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIExpZmVTcGF3blBvaW50IHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge29iamVjdH0gcmF3XHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHNwYXduSWQgLSBzcGF3biBpbmRleFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgc3Bhd25JZCkge1xyXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCByYXcpO1xyXG5cdFx0XHJcblx0XHR0aGlzLnNwYXduSWQgPSBzcGF3bklkO1xyXG5cdFx0XHJcblx0XHQvKipcclxuXHRcdCAqIG1pbGxpc2Vjb25kIGVsYXBzZWQgYWZ0ZXIgbGlmZSBzcGF3blxyXG5cdFx0ICogQHR5cGUge251bWJlcn1cclxuXHRcdCAqL1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIG5vdyBjb3VudCBvZiBsaWZlIHdhcyBzcGF3blxyXG5cdFx0ICogQHR5cGUge251bWJlcn1cclxuXHRcdCAqL1xyXG5cdFx0dGhpcy5jb3VudCA9IDA7XHJcblxyXG5cdFx0aWYgKCEocmF3IGluc3RhbmNlb2YgTGlmZVNwYXduUG9pbnQpKSB7XHJcblx0XHRcdHRoaXMuZmggPSByYXcuZmggLSAxO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRpbmNyZWFzZUxpZmUoKSB7XHJcblx0XHQrK3RoaXMuY291bnQ7XHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdH1cclxuXHRkZWNyZWFzZUxpZmUoKSB7XHJcblx0XHQtLXRoaXMuY291bnQ7XHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdH1cclxuXHRnZXRUaW1lRWxhcHNlZEFmdGVyTGlmZVNwYXduKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMudGltZTtcclxuXHR9XHJcblx0Z2V0Tm93Q291bnRPZkxpZmVXYXNTcGF3bigpIHtcclxuXHRcdHJldHVybiB0aGlzLmNvdW50O1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7TGlmZVNwYXduUG9pbnR9XHJcblx0ICovXHJcblx0Y2xvbmUoKSB7XHJcblx0XHRyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IodGhpcyk7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogTW9iIC8gTlBDIGNvbnRyb2xsZXJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBNYXBMaWZlRW50aXR5IGV4dGVuZHMgU2NlbmVPYmplY3Qge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7TGlmZVNwYXduUG9pbnR9IGxpZmVTcGF3blBvaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxpZmVJZCAtIGxpZmUgaW5kZXhcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0bGV0IGEgPSB7XHJcblx0XHRcdHR5cGU6IFwibVwiLFxyXG5cdFx0XHRpZDogODY0MzAwMCxcclxuXHRcdFx0eDogNzIwLFxyXG5cdFx0XHR5OiAtNzcxLFxyXG5cdFx0XHRtb2JUaW1lOiAwLFxyXG5cdFx0XHRmOiAwLFxyXG5cdFx0XHRoaWRlOiAwLFxyXG5cdFx0XHRmaDogNDEgLSAxLFxyXG5cdFx0XHRjeTogLTc2MSxcclxuXHRcdFx0cngwOiA2NDcsXHJcblx0XHRcdHJ4MTogNzIwLFxyXG5cdFx0fTtcclxuXHJcblx0XHQvKiogQHR5cGUge0xpZmVSZW5kZXJlcn0gTGlmZVJlbmRlcmVyfE1vYlJlbmRlcmVyfE5wY1JlbmRlcmVyICovXHJcblx0XHR0aGlzLnJlbmRlcmVyID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLmlzX2RlYWQgPSBmYWxzZTtcclxuXHJcblx0XHQvKiogQHR5cGUge0xpZmVTcGF3blBvaW50fSAqL1xyXG5cdFx0dGhpcy5zcGF3biA9IGxpZmVTcGF3blBvaW50O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy54ID0gbGlmZVNwYXduUG9pbnQueDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMueSA9IGxpZmVTcGF3blBvaW50LmN5Oy8vbGlmZVNwYXduUG9pbnQueVxyXG5cdFx0XHJcblx0XHR0aGlzLnogPSA1O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5hbmdsZSA9IDA7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5mcm9udCA9IE51bWJlcihsaWZlU3Bhd25Qb2ludC5mKSA/IDEgOiAtMTtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLm9wYWNpdHkgPSBOdW1iZXIobGlmZVNwYXduUG9pbnQuaGlkZSkgPyAwLjUgOiAxO1xyXG5cdFx0XHJcblx0XHR0aGlzLmxpZmVJZCA9IGxpZmVJZDtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0Ly90aGlzLnR5cGUgPSBsaWZlU3Bhd25Qb2ludC50eXBlO1xyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHQvL3RoaXMuaWQgPSBsaWZlU3Bhd25Qb2ludC5pZDtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0Ly90aGlzLm1vYlRpbWUgPSBsaWZlU3Bhd25Qb2ludC5tb2JUaW1lO1xyXG5cclxuXHRcdC8vLy8vKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdC8vLy90aGlzLmN5ID0gbGlmZVNwYXduUG9pbnQuY3k7XHJcblxyXG5cdFx0Ly8vKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdC8vdGhpcy5yeDAgPSBsaWZlU3Bhd25Qb2ludC5yeDA7XHJcblxyXG5cdFx0Ly8vKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdC8vdGhpcy5yeDEgPSBsaWZlU3Bhd25Qb2ludC5yeDE7XHJcblx0fVxyXG5cclxuXHQvL0FmdGVyU3RlcFxyXG5cdC8vZ2V0IHgoKSB7XHJcblx0Ly9cdHJldHVybiB0aGlzLl94O1xyXG5cdC8vfVxyXG5cdC8vc2V0IHgoeCkge1xyXG5cdC8vXHR0aGlzLl94ID0geDtcclxuXHQvL31cclxuXHQvL2dldCB5KCkge1xyXG5cdC8vXHRyZXR1cm4gdGhpcy5feTtcclxuXHQvL31cclxuXHQvL3NldCB5KHkpIHtcclxuXHQvL1x0dGhpcy5feSA9IHk7XHJcblx0Ly99XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7TGlmZVNwYXduUG9pbnR9IGxpZmVTcGF3blBvaW50XHJcblx0ICogQHBhcmFtIHtXb3JsZH0gbWFwQ29udHJvbGxlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBsaWZlSWQgLSBsaWZlIGluZGV4XHJcblx0ICovXHJcblx0c3RhdGljIENyZWF0ZShsaWZlU3Bhd25Qb2ludCwgbWFwQ29udHJvbGxlciwgbGlmZUlkKSB7XHJcblx0XHRsZXQgbGlmZTtcclxuXHJcblx0XHRpZiAobGlmZVNwYXduUG9pbnQudHlwZSA9PSBcIm1cIikge1xyXG5cdFx0XHRsaWZlID0gbmV3IE1hcE1vYihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGxpZmVTcGF3blBvaW50LnR5cGUgPT0gXCJuXCIpIHtcclxuXHRcdFx0bGlmZSA9IG5ldyBNYXBOcGMobGlmZVNwYXduUG9pbnQsIGxpZmVJZCk7XHJcblx0XHRcdC8vcmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGFsZXJ0KFwibWFwIGxpZmUgdHlwZTogXCIgKyBsaWZlU3Bhd25Qb2ludC50eXBlKTtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAobGlmZSkge1xyXG5cdFx0XHRsaWZlLmxvYWQobGlmZVNwYXduUG9pbnQuaWQsIG1hcENvbnRyb2xsZXIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBsaWZlO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBsb2FkIGxpZmUgZGVzY3JpcHRpb25cclxuXHQgKiBAcGFyYW0ge0xpZmVTcGF3blBvaW50fSBsaWZlU3Bhd25Qb2ludCAtIHtpZDogc3RyaW5nLCB0eXBlOlwibVwifHxcIm5cIn1cclxuXHQgKi9cclxuXHRzdGF0aWMgYXN5bmMgbG9hZExpZmVEZXNjKGxpZmVTcGF3blBvaW50KSB7XHJcblx0XHRsZXQgZGVzYywgaWQgPSBsaWZlU3Bhd25Qb2ludC5pZDtcclxuXHRcdFxyXG5cdFx0c3dpdGNoIChsaWZlU3Bhd25Qb2ludC50eXBlKSB7XHJcblx0XHRcdGNhc2UgXCJtXCI6XHJcblx0XHRcdFx0ZGVzYyA9IE1vYlJlbmRlcmVyLmxvYWREZXNjcmlwdGlvbihpZCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGNhc2UgXCJuXCI6XHJcblx0XHRcdFx0ZGVzYyA9IE5wY1JlbmRlcmVyLmxvYWREZXNjcmlwdGlvbihpZCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0YWxlcnQoXCJtYXAgbGlmZSB0eXBlOiBcIiArIGxpZmVTcGF3blBvaW50LnR5cGUpO1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0cmV0dXJuIGRlc2M7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBjcmVhdGUgZW50aXR5LCBsb2FkIGRhdGFcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSAgbnBjIG9yIG1vYiBpZFxyXG5cdCAqIEBwYXJhbSB7V29ybGR9IG1hcENvbnRyb2xsZXIgLSBubyB1c2VcclxuXHQgKi9cclxuXHRhc3luYyBsb2FkKGlkLCBtYXBDb250cm9sbGVyKSB7Ly8/PzogcmVuYW1lIHRvIGNyZWF0ZVxyXG5cdFx0aWYgKHRoaXMucmVuZGVyZXIpIHtcclxuXHRcdFx0YXdhaXQgdGhpcy5yZW5kZXJlci5sb2FkKGlkKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0YWxlcnQoXCJVbmtub3cgdHlwZSBvZiBsaWZlIGluIG1hcFwiKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0X2Rlc3Ryb3kobWFwQ29udHJvbGxlcikge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHNldCBkaWUgYW5pbWF0aW9uXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHR5cGVcclxuXHQgKi9cclxuXHRkaWUodHlwZSkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHRcdHRoaXMuaXNfZGVhZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMucmVuZGVyZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIpIHtcclxuXHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gTWF0aC5tYXgoMCwgTWF0aC5taW4odGhpcy5vcGFjaXR5LCAxKSk7XHJcblx0XHR0aGlzLnJlbmRlcmVyLmRyYXcocmVuZGVyZXIsIHRoaXMueCwgdGhpcy55LCB0aGlzLmFuZ2xlLCB0aGlzLmZyb250IDwgMCk7XHJcblx0fVxyXG59XHJcbmNsYXNzIE1hcE1vYiBleHRlbmRzIE1hcExpZmVFbnRpdHkge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7TGlmZVNwYXduUG9pbnR9IGxpZmVTcGF3blBvaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxpZmVJZCAtIGxpZmUgaW5kZXhcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKSB7XHJcblx0XHRzdXBlcihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKTtcclxuXHRcdHRoaXMucmVuZGVyZXIgPSBuZXcgTW9iUmVuZGVyZXIoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge1BNb2J9ICovXHJcblx0XHR0aGlzLiRwaHlzaWNzID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHt7W3g6c3RyaW5nXTogb2JqZWN0fX0gLSB7W2xldmVsXTogc2tpbGx9ICovXHJcblx0XHR0aGlzLnNraWxscyA9IHt9O1xyXG5cclxuXHRcdC8vVE9ETzogbG9hZCBtb2IgaW5mb1xyXG5cdFx0dGhpcy5ocCA9IDEwMDAwMDtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkIG1vYklkXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gbWFwQ29udHJvbGxlclxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQoaWQsIG1hcENvbnRyb2xsZXIpIHsvLz8/OiByZW5hbWUgdG8gY3JlYXRlXHJcblx0XHRhd2FpdCBzdXBlci5sb2FkKGlkKTtcclxuXHJcblx0XHR0aGlzLiRwaHlzaWNzID0gbWFwQ29udHJvbGxlci5jcmVhdGVNb2IodGhpcyk7XHJcblx0XHR0aGlzLiRwaHlzaWNzLl9sb2FkQWN0aW9uKHRoaXMucmVuZGVyZXIuYWN0aW9ucyk7XHJcblx0XHRcclxuXHRcdGF3YWl0IHRoaXMuX2xvYWRfc2tpbGxfYnlfbW9iX2lkKGlkKTtcclxuXHJcblx0XHQvLyBleHBlcmltZW50XHJcblx0XHR0cnkge1xyXG5cdFx0XHR0aGlzLl9sb2FkX3NraWxsX2luZm8oKTtcclxuXHJcblx0XHRcdGNvbnN0IGZpcnN0QXR0YWNrID0gdGhpcy5yZW5kZXJlci5fcmF3LmluZm8uYXR0YWNrW3RoaXMucmVuZGVyZXIuX3Jhdy5pbmZvLmZpcnN0QXR0YWNrXS5pbmZvO1xyXG5cdFx0XHRpZiAodGhpcy5za2lsbF9tYXBbZmlyc3RBdHRhY2tdKSB7XHJcblx0XHRcdFx0Y29uc3QgZmlyc3RTa2lsbEluZm8gPSB0aGlzLnNraWxsX21hcFtmaXJzdEF0dGFja10uc2tpbGxfbGlzdFswXTtcclxuXHJcblx0XHRcdFx0dGhpcy5pbnZva2VTa2lsbChmaXJzdFNraWxsSW5mby5za2lsbCwgZmlyc3RTa2lsbEluZm8ubGV2ZWwpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdC8vbm90IHRoaW5nXHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge1NjZW5lT2JqZWN0fSBjaGFyYSAtIOiiqyBjaGFyYSDmlLvmk4pcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZGFtYWdlIC0g5YK35a6zXHJcblx0ICovXHJcblx0ZGFtYWdlKGNoYXJhLCBkYW1hZ2UpIHtcclxuXHRcdGlmICghdGhpcy5pc19kZWFkKSB7XHJcblx0XHRcdHRoaXMuaHAgLT0gZGFtYWdlO1xyXG5cclxuXHRcdFx0Y29uc29sZS5sb2coYE1vYigke3RoaXMuJG9iamVjdGlkfSkg6KKrICR7Y2hhcmEuJG9iamVjdGlkfSDmlLvmk4rvvIzmuJvlsJEgJHtkYW1hZ2V9IEhQ77yM5Ymp5LiLICR7dGhpcy5ocH1gKTtcclxuXHRcdFx0XHJcblx0XHRcdGlmICh0aGlzLmhwIDw9IDApIHtcclxuXHRcdFx0XHR0aGlzLmRpZSgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIGlmIChjaGFyYSA9PSBudWxsKSA/P1xyXG5cdCAqIEBwYXJhbSB7U2NlbmVPYmplY3R8bnVsbH0gY2hhcmEgLSDooqsgY2hhcmEg5pS75pOKXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG1vdmVYIC0gdW5pdCBpcyBwaXhlbFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBtb3ZlWSAtIHVuaXQgaXMgcGl4ZWxcclxuXHQgKi9cclxuXHRrbm9ja2JhY2soY2hhcmEsIG1vdmVYLCBtb3ZlWSkge1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQUGxheWVyU3RhdGV9IHBTdGF0ZVxyXG5cdCAqL1xyXG5cdF9hcHBseVN0YXRlKHBTdGF0ZSkge1xyXG5cdFx0Ly9tb3ZlIHN0YW5kIGp1bXAgaGl0MSBkaWUxXHJcblxyXG5cdFx0aWYgKHBTdGF0ZS5qdW1wKSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIuYWN0aW9uID0gXCJqdW1wXCI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChwU3RhdGUud2Fsaykge1xyXG5cdFx0XHR0aGlzLnJlbmRlcmVyLmFjdGlvbiA9IFwibW92ZVwiO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIuYWN0aW9uID0gXCJzdGFuZFwiO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wKSB7XHJcblx0XHRpZiAodGhpcy4kcGh5c2ljcykge1xyXG5cdFx0XHRpZiAoIXRoaXMuaXNfZGVhZCkge1xyXG5cdFx0XHRcdHRoaXMuX2FwcGx5U3RhdGUodGhpcy4kcGh5c2ljcy5zdGF0ZSk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy4kcGh5c2ljcy5zdG9wKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRoaXMucmVuZGVyZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIpIHtcclxuXHRcdGlmICgkZ3YubV9kaXNwbGF5X21vYikge1xyXG5cdFx0XHRzdXBlci5kcmF3KHJlbmRlcmVyKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0Lyogc2tpbGwgbmVlZCBtYXAgdG8gYWN0aW9uICovXHJcblx0X2xvYWRfc2tpbGxfaW5mbygpIHtcclxuXHRcdGNvbnN0IF9yYXcgPSB0aGlzLnJlbmRlcmVyLl9yYXc7XHJcblx0XHRsZXQgYXR0YWNrID0gX3Jhdy5pbmZvLmF0dGFjaztcclxuXHRcdGxldCBza2lsbCA9IF9yYXcuaW5mby5za2lsbDtcclxuXHRcdFxyXG5cdFx0YXR0YWNrWzFdLmluZm8gPT0gX3Jhdy5pbmZvLnNraWxsWzBdLmluZm9cclxuXHRcdGF0dGFja1sxXS5pbmZvID09IF9yYXcuc2tpbGwxLmluZm9cclxuXHRcdFxyXG5cdFx0dmFyIHNraWxsX21hcCA9IHt9O1xyXG5cdFx0Zm9yIChsZXQgaSA9IDEsIHNuYW1lOyAoc25hbWUgPSBcInNraWxsXCIgKyBpKSBpbiBfcmF3OyArK2kpIHtcclxuXHRcdFx0bGV0IHMgPSBfcmF3W3NuYW1lXTtcclxuXHRcdFx0aWYgKHMuaW5mbykge1xyXG5cdFx0XHRcdHNraWxsX21hcFtzLmluZm9dID0ge1xyXG5cdFx0XHRcdFx0YW5pbTogc25hbWUsXHJcblx0XHRcdFx0XHRza2lsbF9saXN0OiBbXSxcclxuXHRcdFx0XHR9O1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHZhciBza2lsbF9pbmZvID0ge307XHJcblx0XHRmb3IgKGxldCBpIGluIF9yYXcuaW5mby5za2lsbCkge1xyXG5cdFx0XHRsZXQgc2kgPSBfcmF3LmluZm8uc2tpbGxbaV07XHJcblx0XHRcdHNraWxsX2luZm9bc2kuc2tpbGwgKyBcIi5cIiArIHNpLmxldmVsXSA9IHNpO1xyXG5cdFx0XHRpZiAoc2tpbGxfbWFwW3NpLmluZm9dKSB7XHJcblx0XHRcdFx0c2tpbGxfaW5mb1tzaS5za2lsbCArIFwiLlwiICsgc2kubGV2ZWxdLiRhbmltID0gc2tpbGxfbWFwW3NpLmluZm9dLmFuaW07XHJcblx0XHRcdFx0c2tpbGxfbWFwW3NpLmluZm9dLnNraWxsX2xpc3QucHVzaChzaSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5za2lsbF9tYXAgPSBza2lsbF9tYXA7XHJcblx0XHR0aGlzLnNraWxsX2luZm8gPSBza2lsbF9pbmZvO1xyXG5cdH1cclxuXHRcclxuXHRfbG9hZF9za2lsbF9ieV9tb2JfaWQobW9iX2lkKSB7XHJcblx0XHRsZXQgdGFza3MgPSBbXTtcclxuXHRcdHN3aXRjaChtb2JfaWQpIHtcclxuXHRcdFx0Y2FzZSBcIjg4ODAxNDBcIjpcclxuXHRcdFx0Y2FzZSBcIjg4ODAxNDFcIjoge1xyXG5cdFx0XHRcdFx0Y29uc3QgRmxvd2VyVHJhcCA9IHJlcXVpcmUoXCIuL01vYlNraWxsLzIzOC5GbG93ZXJUcmFwLmpzXCIpLkZsb3dlclRyYXA7XHJcblx0XHRcdFx0XHRjb25zdCBGYWlyeUR1c3QgPSByZXF1aXJlKFwiLi9Nb2JTa2lsbC8yMzguRmFpcnlEdXN0LmpzXCIpLkZhaXJ5RHVzdDtcclxuXHRcdFx0XHRcdHRoaXMuc2tpbGxzID0ge1xyXG5cdFx0XHRcdFx0XHRbMV06IG5ldyBGbG93ZXJUcmFwKCksXHJcblx0XHRcdFx0XHRcdFsyXTogbmV3IEZsb3dlclRyYXAoKSxcclxuXHRcdFx0XHRcdFx0WzNdOiBuZXcgRmxvd2VyVHJhcCgpLFxyXG5cdFx0XHRcdFx0XHRbNF06IG5ldyBGYWlyeUR1c3QobnVsbCwgbnVsbCksXHJcblx0XHRcdFx0XHRcdFs1XTogeyBsb2FkKCkge30sIGludm9rZTogZnVuY3Rpb24gKGxldmVsKSB7IGNvbnNvbGUuaW5mbyhcImludm9rZSBMYXNlclJhaW5cIik7IH0gfSxcclxuXHRcdFx0XHRcdFx0WzZdOiB7IGxvYWQoKSB7fSwgaW52b2tlOiBmdW5jdGlvbiAobGV2ZWwpIHsgY29uc29sZS5pbmZvKFwiaW52b2tlIEZvcmNlZFRlbGVwb3JcIik7IH0gfSxcclxuXHRcdFx0XHRcdFx0WzddOiB7IGxvYWQoKSB7fSwgaW52b2tlOiBmdW5jdGlvbiAobGV2ZWwpIHsgY29uc29sZS5pbmZvKFwiaW52b2tlIERyYWdvblwiKTsgfSB9LFxyXG5cdFx0XHRcdFx0XHRbOF06IHsgbG9hZCgpIHt9LCBpbnZva2U6IGZ1bmN0aW9uIChsZXZlbCkgeyBjb25zb2xlLmluZm8oXCJpbnZva2UgUnVzaFwiKTsgfSB9LFxyXG5cdFx0XHRcdFx0XHRbOV06IHsgbG9hZCgpIHt9LCBpbnZva2U6IGZ1bmN0aW9uIChsZXZlbCkgeyBjb25zb2xlLmluZm8oXCJpbnZva2UgV2VsY29tZUJhcnJhZ2VcIik7IH0gfSxcclxuXHRcdFx0XHRcdFx0WzEwXTogbmV3IEZhaXJ5RHVzdChudWxsLCBudWxsKSxcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0XHR0aGlzLnNraWxsX21hcF9hY3Rpb24gPSBbXTtcclxuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAxOyBpIDw9IDEwOyArK2kpIHtcclxuXHRcdFx0XHRcdFx0c3dpdGNoIChpKSB7XHJcblx0XHRcdFx0XHRcdFx0Y2FzZSAxOlxyXG5cdFx0XHRcdFx0XHRcdGNhc2UgMjpcclxuXHRcdFx0XHRcdFx0XHRjYXNlIDM6XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlIDQ6XHJcblx0XHRcdFx0XHRcdFx0Y2FzZSAxMDpcclxuXHRcdFx0XHRcdFx0XHRcdHRoaXMuc2tpbGxfbWFwX2FjdGlvbltpXSA9IFwic2tpbGwxXCI7XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlIDU6XHJcblx0XHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0XHRjYXNlIDY6XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLnNraWxsX21hcF9hY3Rpb25baV0gPSBcInNraWxsNFwiO1xyXG5cdFx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdFx0Y2FzZSA3OlxyXG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5za2lsbF9tYXBfYWN0aW9uW2ldID0gXCJza2lsbDJcIjtcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgODpcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHRcdGNhc2UgOTpcclxuXHRcdFx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdFx0Zm9yIChsZXQgbGV2IGluIHRoaXMuc2tpbGxzKSB7XHJcblx0XHRcdGNvbnN0IHNraWxsID0gdGhpcy5za2lsbHNbbGV2XTtcclxuXHRcdFx0dGFza3MucHVzaChza2lsbC5sb2FkKGxldikpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKHRhc2tzKTtcclxuXHR9XHJcblx0XHJcblx0aW52b2tlU2tpbGwoc2tpbGxfaWQsIGxldmVsKSB7XHJcblx0XHRjb25zdCBza2lsbCA9IHRoaXMuc2tpbGxzW2xldmVsXTtcclxuXHRcdGlmIChza2lsbCkge1xyXG5cdFx0XHRjb25zdCBhbmltID0gdGhpcy5za2lsbF9tYXBfYWN0aW9uW2xldmVsXTtcclxuXHRcdFx0aWYgKGFuaW0pIHtcclxuXHRcdFx0XHR0aGlzLnJlbmRlcmVyLmFjdGlvbiA9IGFuaW07XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdHNraWxsLmludm9rZShsZXZlbCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS53YXJuKHsgXCJ1bmtub3cgc2tpbGxcIjogc2tpbGxfaWQsIFwibGV2ZWxcIjogbGV2ZWwgfSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdF9kZXN0cm95KG1hcENvbnRyb2xsZXIpIHtcclxuXHRcdGxldCBsaWZlU3Bhd25Qb2ludCA9IHRoaXMuc3Bhd247XHJcblx0XHRpZiAobGlmZVNwYXduUG9pbnQgaW5zdGFuY2VvZiBMaWZlU3Bhd25Qb2ludCkge1xyXG5cdFx0XHRsaWZlU3Bhd25Qb2ludC5kZWNyZWFzZUxpZmUoKTtcclxuXHRcdH1cclxuXHRcdG1hcENvbnRyb2xsZXIuZGVzdHJveU1vYih0aGlzKTtcclxuXHRcdHRoaXMucmVuZGVyZXIgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogc2V0IGRpZSBhbmltYXRpb25cclxuXHQgKiBAcGFyYW0ge251bWJlcj0xfSB0eXBlXHJcblx0ICovXHJcblx0ZGllKHR5cGUgPSAxKSB7XHJcblx0XHR0aGlzLnJlbmRlcmVyLmFjdGlvbiA9IFwiZGllXCIgKyB0eXBlO1xyXG5cdFx0dGhpcy5pc19kZWFkID0gdHJ1ZTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIE1hcE5wYyBleHRlbmRzIE1hcExpZmVFbnRpdHkge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7TGlmZVNwYXduUG9pbnR9IGxpZmVTcGF3blBvaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxpZmVJZCAtIGxpZmUgaW5kZXhcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKSB7XHJcblx0XHRzdXBlcihsaWZlU3Bhd25Qb2ludCwgbGlmZUlkKTtcclxuXHRcdHRoaXMucmVuZGVyZXIgPSBuZXcgTnBjUmVuZGVyZXIoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIpIHtcclxuXHRcdGlmICgkZ3YubV9kaXNwbGF5X25wYykge1xyXG5cdFx0XHRzdXBlci5kcmF3KHJlbmRlcmVyKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdF9kZXN0cm95KG1hcENvbnRyb2xsZXIpIHtcclxuXHRcdGxldCBsaWZlU3Bhd25Qb2ludCA9IHRoaXMuc3Bhd247XHJcblx0XHRsaWZlU3Bhd25Qb2ludC5kZWNyZWFzZUxpZmUoKTtcclxuXHRcdG1hcENvbnRyb2xsZXIuZGVzdHJveU5wYyh0aGlzKTtcclxuXHRcdHRoaXMucmVuZGVyZXIgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogc2V0IGRpZSBhbmltYXRpb25cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gdHlwZVxyXG5cdCAqL1xyXG5cdGRpZSh0eXBlKSB7XHJcblx0XHQvL1RPRE86IG5wYyBkaWUgPz9cclxuXHRcdHRoaXMuaXNfZGVhZCA9IHRydWU7XHJcblx0fVxyXG59XHJcblxyXG5sZXQgTWFwTGlmZUVudGl0eUNhcGFjaXR5UmF0ZSA9IDE7XHJcblxyXG5jbGFzcyBNYXBMaWZlTWFuYWdlciB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gbWFwQ29udHJvbGxlclxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKG1hcENvbnRyb2xsZXIpIHtcclxuXHRcdC8qKiBAdHlwZSB7b2JqZWN0fSAqL1xyXG5cdFx0dGhpcy5fcmF3ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0xpZmVTcGF3blBvaW50W119ICovXHJcblx0XHR0aGlzLnNwYXduUG9pbnRzID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtNYXBNb2JbXX0gKi9cclxuXHRcdHRoaXMuZW50aXRpZXMgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge1dvcmxkfSAqL1xyXG5cdFx0dGhpcy5tYXBDb250cm9sbGVyID0gbWFwQ29udHJvbGxlcjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBhc3luY1xyXG5cdCAqIEBwYXJhbSB7e2xpZmU6e1tzcGF3bklkOm51bWJlcl06e319fX0gbWFwUmF3RGF0YVxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPHVuZGVmaW5lZFtdPn1cclxuXHQgKi9cclxuXHRsb2FkKG1hcFJhd0RhdGEpIHtcclxuXHRcdGxldCB0YXNrcyA9IFtdO1xyXG5cdFx0dGhpcy5fcmF3ID0gbWFwUmF3RGF0YS5saWZlO1xyXG5cclxuXHRcdGxldCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5fcmF3KVxyXG5cdFx0XHQubWFwKGkgPT4ge1xyXG5cdFx0XHRcdGxldCBuID0gcGFyc2VJbnQoaSwgMTApO1xyXG5cdFx0XHRcdGlmIChOdW1iZXIuaXNTYWZlSW50ZWdlcihuKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIG47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGNvbnNvbGUud2FybihcIk1hcExpZmUuc3Bhd25JZDogXCIgKyBpKTtcclxuXHRcdFx0XHRyZXR1cm4gbnVsbDtcclxuXHRcdFx0fSlcclxuXHRcdFx0LmZpbHRlcihpID0+IGkgIT0gbnVsbCk7XHJcblxyXG5cdFx0Zm9yIChsZXQgc3Bhd25JZCBvZiBrZXlzKSB7XHJcblx0XHRcdGxldCBkID0gbmV3IExpZmVTcGF3blBvaW50KHRoaXMuX3Jhd1tzcGF3bklkXSwgc3Bhd25JZCk7XHJcblx0XHRcdHRhc2tzLnB1c2goTWFwTGlmZUVudGl0eS5sb2FkTGlmZURlc2MoZCkpO1xyXG5cdFx0XHR0aGlzLnNwYXduUG9pbnRzLnB1c2goZCk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwodGFza3MpO1xyXG5cdH1cclxuXHJcblx0dW5sb2FkKCkge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVudGl0aWVzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGNvbnN0IGVudGl0eSA9IHRoaXMuZW50aXRpZXNbaV07XHJcblx0XHRcdGlmIChlbnRpdHkuc3Bhd24udHlwZSA9PSBcIm1cIikge1xyXG5cdFx0XHRcdGVudGl0eS4kcGh5c2ljcy5fZGVzdHJveSh0aGlzLm1hcENvbnRyb2xsZXIpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLnNwYXduUG9pbnRzID0gW107XHJcblx0XHR0aGlzLmVudGl0aWVzID0gW107XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zcGF3blBvaW50cy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRsZXQgbGlmZVNwYXduUG9pbnQgPSB0aGlzLnNwYXduUG9pbnRzW2ldO1xyXG5cclxuXHRcdFx0bGlmZVNwYXduUG9pbnQudGltZSArPSBzdGFtcDtcclxuXHJcblx0XHRcdGlmIChsaWZlU3Bhd25Qb2ludC50aW1lID49IDEwMDAgJiYgbGlmZVNwYXduUG9pbnQuY291bnQgPCBNYXBMaWZlRW50aXR5Q2FwYWNpdHlSYXRlKSB7XHJcblx0XHRcdFx0bGlmZVNwYXduUG9pbnQuaW5jcmVhc2VMaWZlKCk7XHJcblx0XHRcdFx0dGhpcy5zcGF3bihsaWZlU3Bhd25Qb2ludCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW50aXRpZXMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IGVudGl0eSA9IHRoaXMuZW50aXRpZXNbaV07XHJcblx0XHRcdGlmIChlbnRpdHkpIHtcclxuXHRcdFx0XHRpZiAoZW50aXR5LnJlbmRlcmVyLmFjdGlvbiAmJiBlbnRpdHkucmVuZGVyZXIuYWN0aW9uLnN0YXJ0c1dpdGgoXCJkaWVcIikpIHtcclxuXHRcdFx0XHRcdGNvbnN0IGFjdCA9IGVudGl0eS5yZW5kZXJlci5hY3Rpb25zW2VudGl0eS5yZW5kZXJlci5hY3Rpb25dO1xyXG5cdFx0XHRcdFx0aWYgKGFjdCAmJiBhY3QuaXNFbmQoKSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmRlc3Ryb3lMaWZlKGVudGl0eSk7XHJcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbnRpdHkudXBkYXRlKHN0YW1wKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogc3Bhd24gbGlmZShucGMgLyBtb2IpIGJ5IHNwYXduZXJcclxuXHQgKiBAcGFyYW0ge0xpZmVTcGF3blBvaW50fSBsaWZlU3Bhd25Qb2ludFxyXG5cdCAqL1xyXG5cdHNwYXduKGxpZmVTcGF3blBvaW50KSB7XHJcblx0XHRsZXQgbGlmZUlkID0gMDtcclxuXHJcblx0XHRmb3IgKDsgbGlmZUlkIDwgdGhpcy5lbnRpdGllcy5sZW5ndGg7ICsrbGlmZUlkKSB7XHJcblx0XHRcdGlmICghdGhpcy5lbnRpdGllc1tsaWZlSWRdKSB7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGxldCBlbnRpdHkgPSBNYXBMaWZlRW50aXR5LkNyZWF0ZShsaWZlU3Bhd25Qb2ludCwgdGhpcy5tYXBDb250cm9sbGVyLCBsaWZlSWQpO1xyXG5cdFx0XHJcblx0XHRpZiAobGlmZUlkIDwgdGhpcy5lbnRpdGllcy5sZW5ndGgpIHtcclxuXHRcdFx0dGhpcy5lbnRpdGllc1tsaWZlSWRdID0gZW50aXR5O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuZW50aXRpZXMucHVzaChlbnRpdHkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBkaXJlY3RseSBzcGF3biBucGNcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gbnBjSURcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICovXHJcblx0c3Bhd25OcGMobnBjSUQsIHgsIHksIGZsaXA9ZmFsc2UsIGZoPTApIHtcclxuXHRcdGxldCBsaWZlU3Bhd25Qb2ludCA9IG5ldyBMaWZlU3Bhd25Qb2ludCh7XHJcblx0XHRcdHR5cGU6IFwiblwiLFxyXG5cdFx0XHR4OiB4IHwgMCwgeTogeSB8IDAsIGN5OiB5IHwgMCxcclxuXHRcdFx0aWQ6IG5wY0lELFxyXG5cdFx0XHRmaDogZmgsXHJcblx0XHRcdGlzX2R1bW15OiB0cnVlLFxyXG5cdFx0fSk7XHJcblx0XHR0aGlzLnNwYXduKGxpZmVTcGF3blBvaW50KTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogZGlyZWN0bHkgc3Bhd24gbW9iXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IG1vYklEXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqL1xyXG5cdHNwYXduTW9iKG1vYklELCB4LCB5LCBmbGlwPWZhbHNlLCBmaD0wKSB7XHJcblx0XHRsZXQgbGlmZVNwYXduUG9pbnQgPSBuZXcgTGlmZVNwYXduUG9pbnQoe1xyXG5cdFx0XHR0eXBlOiBcIm1cIixcclxuXHRcdFx0eDogeCB8IDAsIHk6IHkgfCAwLCBjeTogeSB8IDAsXHJcblx0XHRcdGlkOiBtb2JJRCxcclxuXHRcdFx0Zmg6IGZoLFxyXG5cdFx0XHRpc19kdW1teTogdHJ1ZSxcclxuXHRcdH0pO1xyXG5cdFx0dGhpcy5zcGF3bihsaWZlU3Bhd25Qb2ludCk7XHJcblx0fVxyXG5cdFxyXG5cdGRlc3Ryb3lMaWZlKGVudGl0eSkge1xyXG5cdFx0aWYgKCEoZW50aXR5IGluc3RhbmNlb2YgTWFwTGlmZUVudGl0eSkpIHtcclxuXHRcdFx0YWxlcnQoXCJNYXBMaWZlTWFuYWdlci5raWxsTGlmZTogY2FuJ3Qga2lsbCBub24gbGlmZVwiKTtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihcIk1hcExpZmVNYW5hZ2VyLmtpbGxMaWZlOiBjYW4ndCBraWxsIG5vbiBsaWZlXCIpO1xyXG5cdFx0fVxyXG5cdFx0ZW50aXR5Ll9kZXN0cm95KHRoaXMubWFwQ29udHJvbGxlcik7XHJcblx0XHRkZWxldGUgdGhpcy5lbnRpdGllc1tlbnRpdHkubGlmZUlkXTtcclxuXHR9XHJcblx0ZGVzdHJveUFsbCgpIHtcclxuXHRcdHRoaXMuZW50aXRpZXMuZm9yRWFjaChhID0+IHRoaXMuZGVzdHJveUxpZmUoYSkpXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1ZlYzJ9IGNlbnRlclxyXG5cdCAqIEBwYXJhbSB7UmVjdGFuZ2xlfSB2aWV3UmVjdFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB3aGVyZUxheWVyIC0gd2hlcmUgbGF5ZXIgaW5kZXhcclxuXHQgKi9cclxuXHRkcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0LCB3aGVyZUxheWVyKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW50aXRpZXMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IGVudGl0eSA9IHRoaXMuZW50aXRpZXNbaV07XHJcblx0XHRcdGlmIChlbnRpdHkgJiYgKChlbnRpdHkueiAhPSBudWxsICYmIGVudGl0eS56ID09IHdoZXJlTGF5ZXIpIHx8IHdoZXJlTGF5ZXIgPT0gbnVsbCkpIHtcclxuXHRcdFx0XHRlbnRpdHkuZHJhdyhyZW5kZXJlcik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiByZXF1aXJlIFJlbmRlcmVyXHJcbiAqIEBpbXBsZW1lbnRzIHtJQXN5bmNMb2FkaW5nfVxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNjZW5lTWFwIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5zdGFtcCA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtNYXBCYWNrW119ICovXHJcblx0XHR0aGlzLmJhY2tncm91bmQgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge01hcEJhY2tbXX0gKi9cclxuXHRcdHRoaXMuZnJvbnRncm91bmQgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge01hcE9iamVjdFtdfSAqL1xyXG5cdFx0dGhpcy5sYXllcmVkT2JqZWN0ID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtNYXBUaWxlW119ICovXHJcblx0XHR0aGlzLmxheWVyZWRUaWxlID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7e1t0YWc6c3RyaW5nXTpNYXBCYWNrQmFzZX19ICovXHJcblx0XHR0aGlzLmJhY2tUYWdzID0ge307XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7e1tuYW1lOnN0cmluZ106TWFwT2JqZWN0fX0gKi9cclxuXHRcdHRoaXMubmFtZWRPYmplY3QgPSB7fTtcclxuXHJcblx0XHQvKiogQHR5cGUge1dvcmxkfSAqL1xyXG5cdFx0dGhpcy5jb250cm9sbGVyID0gbmV3IFdvcmxkKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtNYXBMaWZlTWFuYWdlcn0gKi9cclxuXHRcdHRoaXMubGlmZU1nciA9IG5ldyBNYXBMaWZlTWFuYWdlcih0aGlzLmNvbnRyb2xsZXIpO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge01hcFBvcnRhbE1hbmFnZXJ9ICovXHJcblx0XHR0aGlzLnBvcnRhbE1nciA9IG5ldyBNYXBQb3J0YWxNYW5hZ2VyKCk7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7TWFwUGFydGljbGVbXX0gKi9cclxuXHRcdHRoaXMucGFydGljbGVMaXN0ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge1JlY3RhbmdsZX0gKi9cclxuXHRcdHRoaXMubWFwQm91bmQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e1txdWVzdElkOnN0cmluZ106IG51bWJlcn19ICovXHJcblx0XHR0aGlzLnF1ZXN0ID0ge307XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl91cmwgPSBudWxsOy8vZGF0YSB1cmwgLy9kZWJ1Z1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7UHJvbWlzZTxhbnk+W119ICovXHJcblx0XHR0aGlzLiRsb2FkX3Rhc2tzID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtQcm9taXNlPGFueT59ICovXHJcblx0XHR0aGlzLiRwcm9taXNlID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLiRsb2FkaW5nX3N0YXR1cyA9IFwidW5sb2FkXCI7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7ZnVuY3Rpb24oKTp2b2lkfSAqL1xyXG5cdFx0dGhpcy5vbmxvYWQgPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUgeyhmdW5jdGlvbigpOnZvaWQpW119ICovXHJcblx0XHR0aGlzLl9vbmxvYWQgPSBbXTtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBhc3luYyBfSW5pdCgpIHtcclxuXHRcdGxldCAkX21hcFN0cmluZyA9IG51bGw7XHJcblx0XHRsZXQgJG1hcFN0cmluZyA9IHt9O1xyXG5cclxuXHRcdCRfbWFwU3RyaW5nID0gYXdhaXQgJGdldC5kYXRhKFwiL1N0cmluZy9NYXBcIik7XHJcblxyXG5cdFx0Zm9yIChsZXQgaSBpbiAkX21hcFN0cmluZykge1xyXG5cdFx0XHRmb3IgKGxldCBqIGluICRfbWFwU3RyaW5nW2ldKSB7XHJcblx0XHRcdFx0JG1hcFN0cmluZ1tqXSA9ICRfbWFwU3RyaW5nW2ldW2pdO1xyXG5cdFx0XHRcdCRtYXBTdHJpbmdbal0uJHJlZ2lvbiA9IGk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRTY2VuZU1hcC5fbWFwX25hbWVzID0gJG1hcFN0cmluZztcclxuXHJcblx0XHR3aW5kb3cuJE1hcE5hbWVzID0gU2NlbmVNYXAuX21hcF9uYW1lcztcclxuXHR9XHJcblx0c3RhdGljIEluaXQoKSB7XHJcblx0XHRyZXR1cm4gUHJvbWlzZS5hbGwoW1xyXG5cdFx0XHRTY2VuZU1hcC5fSW5pdCgpLFxyXG5cdFx0XHRNYXBQb3J0YWwuSW5pdCgpLFxyXG5cdFx0XSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3tbcXVlc3RJZDpzdHJpbmddOiBudW1iZXJ9fSBxdWVzdFxyXG5cdCAqL1xyXG5cdGlzQWN0aXZhdGVkKHF1ZXN0KSB7XHJcblx0XHRpZiAocXVlc3QpIHtcclxuXHRcdFx0Zm9yIChsZXQgaWQgaW4gcXVlc3QpIHtcclxuXHRcdFx0XHRpZiAodGhpcy5xdWVzdFtpZF0gIT0gcXVlc3RbaWRdKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblx0XHJcblx0Z2V0ICRtYXBfc3ByaXRlKCkge1xyXG5cdFx0cmV0dXJuIHdpbmRvdy4kbWFwX3Nwcml0ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGxvYWQgbWFwIGZyb20gbG9hZGVkIGRhdGFcclxuXHQgKiBAcGFyYW0ge3tiYWNrOntbYmFja0lkOnN0cmluZ106YW55fX19IHJhd1xyXG5cdCAqL1xyXG5cdGFzeW5jIF9jb25zdHJ1Y3RCYWNrKHJhdykge1xyXG5cdFx0aWYgKCEoXCJiYWNrXCIgaW4gcmF3KSkge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0bGV0IGxvYWRpbmdfdGFza19tYXAgPSBuZXcgTWFwKCk7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSBpbiByYXcuYmFjazsgKytpKSB7XHJcblx0XHRcdGxldCBvYiA9IHJhdy5iYWNrW2ldO1xyXG5cdFx0XHRjb25zdCB1cmwgPSB0aGlzLl91cmwgKyBgYmFjay8ke2l9YDtcclxuXHJcblx0XHRcdC8qKiBAdHlwZSB7TWFwQmFja3xNYXBCYWNrQW5pbWF0aW9ufSAqL1xyXG5cdFx0XHRsZXQgYmFjaztcclxuXHJcblx0XHRcdGlmIChvYi5hbmkgPT0gMCkge1xyXG5cdFx0XHRcdGJhY2sgPSBuZXcgTWFwQmFjayhvYik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAob2IuYW5pID09IDEpIHtcclxuXHRcdFx0XHRiYWNrID0gbmV3IE1hcEJhY2tBbmltYXRpb24ob2IpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKG9iLmFuaSA9PSAyKSB7Ly9TcGluZSBza2VsZXRhbCBhbmltYXRpb25cclxuXHRcdFx0XHRiYWNrID0gbmV3IE1hcEJhY2tTa2VsZXRhbEFuaW0ob2IpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcIm9iLmFuaTogXCIgKyBvYi5hbmkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGJhY2suX3VybCA9IHVybDtcclxuXHRcdFx0aWYgKGJhY2suYmFja1RhZ3MgIT0gbnVsbCkge1xyXG5cdFx0XHRcdHRoaXMuYmFja1RhZ3NbYmFjay5iYWNrVGFnc10gPSBiYWNrO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAob2IuYW5pICE9IDIpIHtcclxuXHRcdFx0XHQvLyBhZGQgbG9hZGluZyB0YXNrXHJcblx0XHRcdFx0aWYgKGJhY2suX3Jhdy5iUykge1xyXG5cdFx0XHRcdFx0bGV0IHBzID0gXCJCYWNrL1wiICsgYmFjay5fcmF3LmJTO1xyXG5cdFx0XHRcdFx0aWYgKCFsb2FkaW5nX3Rhc2tfbWFwLmhhcyhwcykpIHtcclxuXHRcdFx0XHRcdFx0bG9hZGluZ190YXNrX21hcC5zZXQocHMsIG1hcF9sb2FkX3BhY2thZ2UoXCJCYWNrXCIsIGJhY2suX3Jhdy5iUykpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGNvbnNvbGUud2FybihcIk1hcEJhY2s6IG1hcC5iYWNrW1wiICsgaSArIFwiXS5iUyA9IFwiICsgYmFjay5fcmF3LmJTKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChvYi5mcm9udCAhPSAwKSB7XHJcblx0XHRcdFx0dGhpcy5mcm9udGdyb3VuZC5wdXNoKGJhY2spO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuYmFja2dyb3VuZC5wdXNoKGJhY2spO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0YXdhaXQgUHJvbWlzZS5hbGwoWy4uLmxvYWRpbmdfdGFza19tYXAudmFsdWVzKCldKTtcclxuXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJvbnRncm91bmQubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IGJhY2sgPSB0aGlzLmZyb250Z3JvdW5kW2ldO1xyXG5cdFx0XHRiYWNrLmxvYWQoKTtcclxuXHRcdH1cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5iYWNrZ3JvdW5kLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGxldCBiYWNrID0gdGhpcy5iYWNrZ3JvdW5kW2ldO1xyXG5cdFx0XHRiYWNrLmxvYWQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogbG9hZCBtYXAgZnJvbSBsb2FkZWQgZGF0YVxyXG5cdCAqIEBwYXJhbSB7e1tsYXllcjpudW1iZXJdOntvYmpzOnt9LHRpbGVzOnt9LGluZm86e319fX0gbWFwUmF3RGF0YVxyXG5cdCAqL1xyXG5cdGFzeW5jIF9jb25zdHJ1Y3RMYXllcmVkT2JqZWN0KG1hcFJhd0RhdGEpIHtcclxuXHRcdGxldCBsb2FkaW5nX3Rhc2tfbWFwID0gbmV3IE1hcCgpO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwLCBsYXllciA9IG1hcFJhd0RhdGFbaV07ICFvYmpJc0VtcHR5KGxheWVyKTsgaSsrICwgbGF5ZXIgPSBtYXBSYXdEYXRhW2ldKSB7Ly9sYXllclsxLi4uOF1cclxuXHRcdFx0bGV0IG9ianMgPSB0aGlzLl9fY29uc3RydWN0TGF5ZXJlZE9iamVjdF9vYmooaSwgbGF5ZXIsIGxvYWRpbmdfdGFza19tYXApO1xyXG5cdFx0XHRsZXQgdGlsZXMgPSB0aGlzLl9fY29uc3RydWN0TGF5ZXJlZE9iamVjdF90aWxlKGksIGxheWVyLCBsb2FkaW5nX3Rhc2tfbWFwKTtcclxuXHJcblx0XHRcdC8vID8/IG1hcDo4NjcxMTY1NTAg6Zu35bCE5ZyoIHRpbGVzIOWJjemdolxyXG5cdFx0XHR0aWxlcy5zb3J0KChhLCBiKSA9PiB7IHJldHVybiBhLnogLSBiLno7IH0pO1xyXG5cdFx0XHRvYmpzLnNvcnQoKGEsIGIpID0+IHsgcmV0dXJuIGEueiAtIGIuejsgfSk7XHJcblxyXG5cdFx0XHQvL3RoaXMubGF5ZXJlZE9iamVjdFtpXSA9IG9ianMuY29uY2F0KHRpbGVzKTsvLyhvYmpzLmNvbmNhdCh0aWxlcykpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsgcmV0dXJuIGEueiAtIGIuejsgfSk7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLmxheWVyZWRPYmplY3RbaV0gPSBvYmpzO1xyXG5cdFx0XHR0aGlzLmxheWVyZWRUaWxlW2ldID0gdGlsZXM7XHJcblx0XHR9XHJcblxyXG5cdFx0Ly93YWl0IGFsbCB0ZXh0dXJlIHBhY2thZ2UgbG9hZGVkXHJcblx0XHRhd2FpdCBQcm9taXNlLmFsbChbLi4ubG9hZGluZ190YXNrX21hcC52YWx1ZXMoKV0pO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sYXllcmVkT2JqZWN0Lmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGNvbnN0IG9ianMgPSB0aGlzLmxheWVyZWRPYmplY3RbaV07XHJcblx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgb2Jqcy5sZW5ndGg7ICsraikge1xyXG5cdFx0XHRcdC8qKlxyXG5cdFx0XHRcdCAqIEB0eXBlIHtNYXBPYmplY3R9XHJcblx0XHRcdFx0ICovXHJcblx0XHRcdFx0bGV0IG9iaiA9IG9ianNbal07XHJcblx0XHRcdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsvL2lzIGRlYnVnXHJcblx0XHRcdFx0XHR0cnkge1xyXG5cdFx0XHRcdFx0XHRvYmoubG9hZCgpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJsb2FkIHRleHR1cmVzIGZhaWxlZDogXCIgKyBuZXcgVVJMKFwieG1sMlwiICsgb2JqLl91cmwsIHdpbmRvdy5sb2NhdGlvbikuaHJlZik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0b2JqLmxvYWQoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5sYXllcmVkVGlsZS5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRjb25zdCB0aWxlcyA9IHRoaXMubGF5ZXJlZFRpbGVbaV07XHJcblx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgdGlsZXMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0XHRsZXQgdGlsZSA9IHRpbGVzW2pdO1xyXG5cdFx0XHRcdHRpbGUubG9hZCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdF9fY29uc3RydWN0TGF5ZXJlZE9iamVjdF90aWxlKGksIGxheWVyLCBsb2FkaW5nX3Rhc2tfbWFwKSB7XHJcblx0XHRjb25zdCBpbmZvID0gbGF5ZXIuaW5mbztcclxuXHRcdGxldCB0aWxlcyA9IFtdO1xyXG5cclxuXHRcdGlmIChpbmZvLnRTKSB7XHJcblx0XHRcdGxldCBwcyA9IFwiVGlsZS9cIiArIGluZm8udFM7XHJcblx0XHRcdGlmICghbG9hZGluZ190YXNrX21hcC5oYXMocHMpKSB7XHJcblx0XHRcdFx0bG9hZGluZ190YXNrX21hcC5zZXQocHMsIG1hcF9sb2FkX3BhY2thZ2UoXCJUaWxlXCIsIGluZm8udFMpKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoT2JqZWN0LmtleXMobGF5ZXIudGlsZSkubGVuZ3RoKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJbXCIgKyBpICsgXCJdLnRpbGUgPSBcIiArIEpTT04uc3RyaW5naWZ5KGxheWVyLnRpbGUpKTtcclxuXHRcdH1cclxuXHRcdGZvciAobGV0IGogPSAwLCB0aSA9IGxheWVyLnRpbGVbal07ICFvYmpJc0VtcHR5KHRpKTsgaisrICwgdGkgPSBsYXllci50aWxlW2pdKSB7XHJcblx0XHRcdGxldCB0aWxlID0gbmV3IE1hcFRpbGUodGksIGluZm8pO1xyXG5cclxuXHRcdFx0dGlsZS5fdXJsID0gdGhpcy5fdXJsICsgYCR7aX0vdGlsZS8ke2p9YDtcclxuXHJcblx0XHRcdHRpbGVzLnB1c2godGlsZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRpbGVzO1xyXG5cdH1cclxuXHRfX2NvbnN0cnVjdExheWVyZWRPYmplY3Rfb2JqKGksIGxheWVyLCBsb2FkaW5nX3Rhc2tfbWFwKSB7XHJcblx0XHRsZXQgb2JqcyA9IFtdO1xyXG5cclxuXHRcdGZvciAobGV0IGogPSAwLCByYXcgPSBsYXllci5vYmpbal07ICFvYmpJc0VtcHR5KHJhdyk7IGorKyAsIHJhdyA9IGxheWVyLm9ialtqXSkge1xyXG5cdFx0XHRsZXQgb2JqO1xyXG5cclxuXHRcdFx0aWYgKHJhdy5zcGluZUFuaSkge1xyXG5cdFx0XHRcdHN3aXRjaCAocmF3LnNwaW5lQW5pKSB7XHJcblx0XHRcdFx0XHRjYXNlIFwiYW5pbWF0aW9uXCI6XHJcblx0XHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdFx0Y2FzZSBcImlkbGVcIjpcclxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKFwic3BpbmUgYW5pbWF0aW9uOiBpZGxlID8/XCIpO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0XHRcdGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoXCJ1bmtub3cgc3BpbmU6XCIgKyByYXcuc3BpbmVBbmkpO1xyXG5cdFx0XHRcdFx0XHRjb25zb2xlLndhcm4oYExheWVyZWRPYmplY3RbJHtpfV1bJHtqfV1gKTtcclxuXHRcdFx0XHRcdFx0Y29uc29sZS53YXJuKHJhdyk7XHJcblx0XHRcdFx0XHRcdGNvbnNvbGUuZ3JvdXBFbmQoKTtcclxuXHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdG9iaiA9IG5ldyBNYXBPYmplY3RTa2VsZXRhbEFuaW0ocmF3KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRvYmogPSBuZXcgTWFwT2JqZWN0KHJhdyk7XHJcblxyXG5cdFx0XHRcdGxldCBwcyA9IFwiT2JqL1wiICsgb2JqLl9yYXcub1M7XHJcblx0XHRcdFx0aWYgKCFsb2FkaW5nX3Rhc2tfbWFwLmhhcyhwcykpIHtcclxuXHRcdFx0XHRcdGxvYWRpbmdfdGFza19tYXAuc2V0KHBzLCBtYXBfbG9hZF9wYWNrYWdlKFwiT2JqXCIsIG9iai5fcmF3Lm9TKSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRvYmouX3VybCA9IHRoaXMuX3VybCArIGAke2l9L29iai8ke2p9YDtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChvYmoubmFtZSAhPSBudWxsKSB7XHJcblx0XHRcdFx0dGhpcy5uYW1lZE9iamVjdFtvYmoubmFtZV0gPSBvYmo7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdG9ianMucHVzaChvYmopO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiBvYmpzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogdG9wLWJvdHRvbS1ib3JkZXIgY29tcHV0ZSBieSB2aXNpYmxlIG1hcE9iamVjdFxyXG5cdCAqL1xyXG5cdF9fY29tcHV0ZV90b3BfYm90dG9tX2JvcmRlcihsYXllcmVkT2JqZWN0KSB7XHJcblx0XHRsZXQgdG9wID0gbnVsbCwgYm90dG9tID0gbnVsbDsvL2xlZnQsIHJpZ2h0LFxyXG5cdFx0Ly9sZXQgaSA9IDA7XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbGF5ZXJlZE9iamVjdC5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRjb25zdCBvYmpzID0gbGF5ZXJlZE9iamVjdFtpXTtcclxuXHRcdFx0Zm9yIChsZXQgaiA9IDA7IGogPCBvYmpzLmxlbmd0aDsgKytqKSB7XHJcblx0XHRcdFx0Y29uc3Qgb2JqID0gb2Jqc1tqXTtcclxuXHRcdFx0XHRsZXQgcmVjdCA9IG9iai5jb21wdXRlX21heF9yZWN0YW5nbGUoKTtcclxuXHRcdFx0XHRpZiAocmVjdCAmJiB0b3AgIT0gbnVsbCAmJiBib3R0b20gIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0Ly9sZWZ0ID0gTWF0aC5taW4obGVmdCwgcmVjdC5sZWZ0KTtcclxuXHRcdFx0XHRcdHRvcCA9IE1hdGgubWluKHRvcCwgcmVjdC50b3ApO1xyXG5cdFx0XHRcdFx0Ly9yaWdodCA9IE1hdGgubWF4KHJpZ2h0LCByZWN0LnJpZ2h0KTtcclxuXHRcdFx0XHRcdGJvdHRvbSA9IE1hdGgubWF4KGJvdHRvbSwgcmVjdC5ib3R0b20pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdC8vbGVmdCA9IHJlY3QubGVmdDtcclxuXHRcdFx0XHRcdHRvcCA9IHJlY3QudG9wO1xyXG5cdFx0XHRcdFx0Ly9yaWdodCA9IHJlY3QucmlnaHQ7XHJcblx0XHRcdFx0XHRib3R0b20gPSByZWN0LmJvdHRvbTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0cmV0dXJuIHsgdG9wLCBib3R0b20gfTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogdG9wLWJvdHRvbS1ib3JkZXIgY29tcHV0ZSBieSB2aXNpYmxlIG1hcE9iamVjdFxyXG5cdCAqL1xyXG5cdF9jb21wdXRlX3RvcF9ib3R0b21fYm9yZGVyKCkge1xyXG5cdFx0bGV0IG9ianRiID0gdGhpcy5fX2NvbXB1dGVfdG9wX2JvdHRvbV9ib3JkZXIodGhpcy5sYXllcmVkT2JqZWN0KTtcclxuXHRcdGxldCB0aWxldGIgPSB0aGlzLl9fY29tcHV0ZV90b3BfYm90dG9tX2JvcmRlcih0aGlzLmxheWVyZWRUaWxlKTtcclxuXHRcdGxldCB0b3AgPSBNYXRoLm1pbihvYmp0Yi50b3AsIHRpbGV0Yi50b3ApO1xyXG5cdFx0bGV0IGJvdHRvbSA9IE1hdGgubWF4KG9ianRiLmJvdHRvbSwgdGlsZXRiLmJvdHRvbSk7XHJcblx0XHRyZXR1cm4geyB0b3AsIGJvdHRvbSB9O1xyXG5cdH1cclxuXHJcblx0Ly9fY29tcHV0ZV92aWV3X3JlY3RhbmdsZVxyXG5cdFxyXG5cdF9jb21wdXRlX21hcF9ib3VuZChyZUNhbGMpIHtcclxuXHRcdGlmICh0aGlzLm1hcEJvdW5kICYmICFyZUNhbGMpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMubWFwQm91bmQ7XHJcblx0XHR9XHJcblxyXG5cdFx0Y29uc3QgaW5mbyA9IHRoaXMuX3Jhdy5pbmZvO1xyXG5cdFx0bGV0IHRvcCwgYm90dG9tO1xyXG5cclxuXHRcdGlmIChpbmZvLlZSTGVmdCAhPSBudWxsICYmIGluZm8uVlJUb3AgIT0gbnVsbCAmJiBpbmZvLlZSUmlnaHQgIT0gbnVsbCAmJiBpbmZvLlZSQm90dG9tICE9IG51bGwpIHtcclxuXHRcdFx0dG9wID0gaW5mby5WUlRvcDtcclxuXHRcdFx0Ym90dG9tID0gaW5mby5WUkJvdHRvbTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRsZXQgdGIgPSB0aGlzLl9jb21wdXRlX3RvcF9ib3R0b21fYm9yZGVyKCk7XHJcblx0XHRcdHRvcCA9IHRiLnRvcDtcclxuXHRcdFx0Ym90dG9tID0gdGIuYm90dG9tO1xyXG5cdFx0fVxyXG5cclxuXHRcdGNvbnN0IGxyID0gdGhpcy5jb250cm9sbGVyLmdyb3VuZC5fY29tcHV0ZV9sZWZ0X3JpZ2h0X2JvcmRlcigpO1xyXG5cclxuXHRcdGxldCByZWN0ID0gUmVjdGFuZ2xlLnBhcnNlKGxyLmxlZnQsIHRvcCwgbHIucmlnaHQsIGJvdHRvbSk7XHJcblx0XHR0aGlzLm1hcEJvdW5kID0gcmVjdDsvL3N0b3JlXHJcblxyXG5cdFx0cmV0dXJuIHJlY3Q7XHJcblx0fVxyXG5cdFxyXG5cdGdldCBfd2luZG93X3RpdGxlKCkge1xyXG5cdFx0aWYgKHRoaXMubWFwTmFtZSkge1xyXG5cdFx0XHRyZXR1cm4gYCR7W3RoaXMubWFwTmFtZSwgdGhpcy5zdHJlZXROYW1lXS5qb2luKFwiwrdcIil9ICgke3RoaXMubWFwX2lkfSlgO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiBgJHt0aGlzLm1hcF9pZH1gO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRfZ2V0X21hcF9kYXRhX3VybChtYXBfaWQpIHtcclxuXHRcdHJldHVybiBgL01hcC9NYXAvTWFwJHttYXBfaWQuc2xpY2UoMCwgMSl9LyR7bWFwX2lkfWA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBsb2FkaW5nOiBtYXAgZGF0YVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBtYXBfaWRcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IHJlbG9hZCAtIGRvd25sb2FkXHJcblx0ICovXHJcblx0YXN5bmMgbG9hZChtYXBfaWQsIHJlbG9hZCkge1xyXG5cdFx0dGhpcy4kcHJvbWlzZSA9IGF3YWl0IHRoaXMuX3JvdXRlX2xvYWQobWFwX2lkLCByZWxvYWQpO1xyXG5cdFx0ZGVsZXRlIHRoaXMuJHByb21pc2U7Ly9sb2FkZWRcclxuXHR9XHJcblx0LyoqXHJcblx0ICogbG9hZGluZzogbWFwIGRhdGFcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gbWFwX2lkXHJcblx0ICogQHBhcmFtIHtib29sZWFufSByZWxvYWQgLSBkb3dubG9hZFxyXG5cdCAqL1xyXG5cdGFzeW5jIF9yb3V0ZV9sb2FkKG1hcF9pZCwgcmVsb2FkKSB7XHJcblx0XHR0aGlzLiRsb2FkaW5nX3N0YXR1cyA9IFwibG9hZGluZ1wiO1xyXG5cdFx0XHJcblx0XHRpZiAoIXJlbG9hZCAmJiBtYXBfaWQgIT0gbnVsbCAmJiB0aGlzLm1hcF9pZCA9PSBtYXBfaWQgJiYgdGhpcy5fcmF3ICE9IG51bGwpIHtcclxuXHRcdFx0aWYgKHRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdHRoaXMudW5sb2FkKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0YXdhaXQgdGhpcy5fbG9hZCh0aGlzLl9yYXcpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCB1cmwgPSB0aGlzLl9nZXRfbWFwX2RhdGFfdXJsKG1hcF9pZCk7XHJcblx0XHRcclxuXHRcdGxldCByYXc7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRyYXcgPSBhd2FpdCAkZ2V0LmRhdGEodXJsKTtcclxuXHRcdFx0aWYgKCFyYXcpIHtcclxuXHRcdFx0XHRhbGVydChcIm1hcCBub3QgZXhpdFwiKTtcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoXCJtYXAgbm90IGV4aXRcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHR0aGlzLiRsb2FkaW5nX3N0YXR1cyA9IFwiZmFpbGVkOiBsb2FkXCI7XHJcblx0XHRcdHRocm93IGV4O1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAocmF3LmluZm8gJiYgcmF3LmluZm8ubGluaykge1xyXG5cdFx0XHRcdGNvbnN0IHVybDIgPSB0aGlzLl9nZXRfbWFwX2RhdGFfdXJsKHJhdy5pbmZvLmxpbmspO1xyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0cmF3ID0gYXdhaXQgJGdldC5kYXRhKHVybDIpO1xyXG5cdFx0XHRcdGlmICghcmF3KSB7XHJcblx0XHRcdFx0XHRhbGVydChcIm1hcC1saW5rIG5vdCBleGl0XCIpO1xyXG5cdFx0XHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0dGhpcy4kbG9hZGluZ19zdGF0dXMgPSBcImZhaWxlZDogbGlua1wiO1xyXG5cdFx0XHR0aHJvdyBleDtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aWYgKHRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdHRoaXMudW5sb2FkKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJTY2VuZU1hcCN1bmxvYWRcIik7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRyeSB7XHJcblx0XHRcdHRoaXMuX3VybCA9IHVybDtcclxuXHRcdFx0dGhpcy5tYXBfaWQgPSBtYXBfaWQ7XHJcblx0XHRcdFxyXG5cdFx0XHRhd2FpdCB0aGlzLl9sb2FkKHJhdyk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0dGhpcy4kbG9hZGluZ19zdGF0dXMgPSBcImZhaWxlZDogY29uc3RydWN0b3IgbWFwXCI7XHJcblx0XHRcdHRocm93IGV4O1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRkZWxldGUgdGhpcy4kbG9hZGluZ19zdGF0dXM7Ly9sb2FkZWRcclxuXHR9XHJcblx0LyoqXHJcblx0ICogbG9hZCBtYXAgZnJvbSBsb2FkZWQgZGF0YVxyXG5cdCAqIEBwYXJhbSB7e1twcm9wOnN0cmluZ106e319fSByYXdcclxuXHQgKi9cclxuXHRhc3luYyBfbG9hZChyYXcpIHtcclxuXHRcdGNvbnN0IG1hcF9pZCA9IHRoaXMubWFwX2lkO1xyXG5cdFx0XHJcblx0XHR0aGlzLl9yYXcgPSByYXc7XHJcblxyXG5cdFx0JGd2LmFsbFF1ZXN0ID0ge307XHJcblx0XHRcclxuXHRcdHRoaXMuY29udHJvbGxlci5zdG9wID0gdHJ1ZTsvL2JlZ2luIGxvYWRcclxuXHRcdFxyXG5cdFx0aWYgKFNjZW5lTWFwLl9tYXBfbmFtZXNbbWFwX2lkXSkge1xyXG5cdFx0XHR0aGlzLm1hcE5hbWUgPSBTY2VuZU1hcC5fbWFwX25hbWVzW21hcF9pZF0ubWFwTmFtZTtcclxuXHRcdFx0dGhpcy5zdHJlZXROYW1lID0gU2NlbmVNYXAuX21hcF9uYW1lc1ttYXBfaWRdLnN0cmVldE5hbWU7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy4kbG9hZF90YXNrcyA9IFtdO1xyXG5cclxuXHRcdHRoaXMuX2xvYWRCZ20ocmF3KTtcclxuXHJcblx0XHR0aGlzLiRsb2FkX3Rhc2tzLnB1c2godGhpcy5fY29uc3RydWN0QmFjayhyYXcsIHRoaXMpKTtcclxuXHRcdFxyXG5cdFx0dGhpcy4kbG9hZF90YXNrcy5wdXNoKHRoaXMuX2NvbnN0cnVjdExheWVyZWRPYmplY3QocmF3LCB0aGlzKS50aGVuKChtYXBvYmopID0+IHtcclxuXHRcdFx0Ly90aGlzLmxheWVyZWRPYmplY3RcclxuXHRcdFx0Ly90aGlzLmxheWVyZWRUaWxlXHJcblx0XHR9KSk7XHJcblx0XHRcclxuXHRcdHRoaXMuJGxvYWRfdGFza3MucHVzaCh0aGlzLnBvcnRhbE1nci5sb2FkKHJhdywgdGhpcykudGhlbigocG9ydGFscykgPT4ge1xyXG5cdFx0fSkpO1xyXG5cdFx0XHJcblx0XHR0aGlzLiRsb2FkX3Rhc2tzLnB1c2godGhpcy5fX2NvbnN0cnVjdE1pbmlNYXAocmF3LCB0aGlzKSk7XHJcblxyXG5cdFx0dGhpcy4kbG9hZF90YXNrcy5wdXNoKHRoaXMuY29udHJvbGxlci5sb2FkKHJhdywgdGhpcykpOy8vbG9hZCBmb290aG9sZC4uLlxyXG5cdFx0dGhpcy4kbG9hZF90YXNrcy5wdXNoKHRoaXMubGlmZU1nci5sb2FkKHJhdywgdGhpcykpO1xyXG5cdFx0XHJcblx0XHR0aGlzLiRsb2FkX3Rhc2tzLnB1c2goTWFwUGFydGljbGUuY29uc3RydWN0KHJhdywgdGhpcykpO1xyXG5cclxuXHRcdGxldCBsb2FkX3Jlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLiRsb2FkX3Rhc2tzKTtcclxuXHRcdFxyXG5cdFx0Y29uc3Qgdmlld1JlY3QgPSB0aGlzLl9jb21wdXRlX21hcF9ib3VuZCgpO1xyXG5cdFx0Y29uc3Qgdmlld0NlbnRlciA9IHZpZXdSZWN0LmNlbnRlcjtcclxuXHRcdFxyXG5cdFx0JGd2Lm1fdmlld1JlY3Quc2V0Q2VudGVyKHZpZXdDZW50ZXIueCwgdmlld0NlbnRlci55KTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jb250cm9sbGVyLl9jcmVhdGVNYXBCb3VuZCh2aWV3UmVjdCk7XHJcblx0XHRcclxuXHRcdHRoaXMuY29udHJvbGxlci5zdG9wID0gZmFsc2U7Ly9lbmQgbG9hZFxyXG5cdFx0XHJcblx0XHR0aGlzLiRsb2FkX3Rhc2tzID0gW107XHJcblx0XHRjb25zb2xlLmxvZyhcImNvbXBsZXRlZCBzY2VuZV9tYXAud2FpdExvYWRlZDogWy4uLl1cIik7XHJcblx0XHRcclxuXHRcdHRoaXMuX3NjcmlwdCgpO1xyXG5cdFx0XHJcblx0XHRpZiAodGhpcy5vbmxvYWQpIHtcclxuXHRcdFx0dGhpcy5vbmxvYWQuY2FsbCh0aGlzKTsvL2hpc3RvcnkucHVzaFN0YXRlXHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGNvbnNvbGUubG9nKFwiRW5kIHNjZW5lX21hcC5sb2FkXCIpO1xyXG5cdH1cclxuXHRfc2NyaXB0KCkge1xyXG5cdFx0c3dpdGNoICh0aGlzLm1hcF9pZCkge1xyXG5cdFx0XHRjYXNlIFwiNDUwMDA0MTUwXCI6XHJcblx0XHRcdGNhc2UgXCI0NTAwMDQ0NTBcIjpcclxuXHRcdFx0Y2FzZSBcIjQ1MDAwNDc1MFwiOlxyXG5cdFx0XHRcdHRoaXMubGlmZU1nci5zcGF3bk1vYihcIjg4ODAxNjZcIiwgMTAwMCwgNDcsIGZhbHNlLCAwKTsvL2Zyb20gL0V0Yy9Cb3NzTHVjaWRcclxuXHRcdFx0XHR0aGlzLmxpZmVNZ3Iuc3Bhd25Nb2IoXCI4ODgwMTQwXCIsIDEwMDAsIDQ3LCBmYWxzZSwgMCk7Ly9mcm9tIC9FdGMvQm9zc0x1Y2lkXHJcblx0XHRcdFx0Ly90aGlzLmxpZmVNZ3Iuc3Bhd25Nb2IoXCI4ODgwMTc2XCIsIDEwMDAsIDQ3LCBmYWxzZSwgMCk7XHJcblx0XHRcdFx0Ly90aGlzLmxpZmVNZ3Iuc3Bhd25Nb2IoXCI4ODgwMTQxXCIsIDEwMDAsIDQ3LCBmYWxzZSwgMCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJlbG9hZCgpIHtcclxuXHRcdHRoaXMudW5sb2FkKCk7XHJcblx0XHR0aGlzLl9sb2FkKHRoaXMuX3Jhdyk7XHJcblx0fVxyXG5cdFxyXG5cdHVubG9hZCgpIHtcclxuXHRcdHRoaXMuJGxvYWRpbmdfc3RhdHVzID0gXCJsb2FkaW5nXCI7XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5iYWNrZ3JvdW5kLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHRoaXMuYmFja2dyb3VuZFtpXS51bmxvYWQoKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuYmFja2dyb3VuZCA9IFtdO1xyXG5cdFx0XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJvbnRncm91bmQubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0dGhpcy5mcm9udGdyb3VuZFtpXS51bmxvYWQoKTtcclxuXHRcdH1cclxuXHRcdHRoaXMuZnJvbnRncm91bmQgPSBbXTtcclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxheWVyZWRPYmplY3QubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IG9ianMgPSB0aGlzLmxheWVyZWRPYmplY3RbaV07XHJcblx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgb2Jqcy5sZW5ndGg7ICsraikge1xyXG5cdFx0XHRcdG9ianNbal0udW5sb2FkKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRoaXMubGF5ZXJlZE9iamVjdCA9IFtdO1xyXG5cdFx0XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGF5ZXJlZFRpbGUubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IHRpbGVzID0gdGhpcy5sYXllcmVkVGlsZVtpXTtcclxuXHRcdFx0Zm9yIChsZXQgaiA9IDA7IGogPCB0aWxlcy5sZW5ndGg7ICsraikge1xyXG5cdFx0XHRcdHRpbGVzW2pdLnVubG9hZCgpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLmxheWVyZWRUaWxlID0gW107XHJcblx0XHRcclxuXHRcdHRoaXMuYmFja1RhZ3MgPSB7fTtcclxuXHRcdFxyXG5cdFx0dGhpcy5wYXJ0aWNsZUxpc3QgPSBudWxsO1xyXG5cdFx0XHJcblx0XHR0aGlzLmNvbnRyb2xsZXIudW5sb2FkKCk7XHJcblx0XHR0aGlzLmxpZmVNZ3IudW5sb2FkKCk7XHJcblx0XHR0aGlzLnBvcnRhbE1nci51bmxvYWQoKTtcclxuXHRcdFxyXG5cdFx0bWFwX3Nwcml0ZS5CYWNrID0ge307XHJcblx0XHRtYXBfc3ByaXRlLk9iaiA9IHt9O1xyXG5cdFx0bWFwX3Nwcml0ZS5UaWxlID0ge307XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBsb2FkIG1hcCBmcm9tIGxvYWRlZCBkYXRhXHJcblx0ICogQHBhcmFtIHt7aW5mbzp7YmdtOnN0cmluZ319fSBtYXBSYXdEYXRhXHJcblx0ICovXHJcblx0X2dldEJnbVBhdGgobWFwUmF3RGF0YSkge1xyXG5cdFx0bGV0IGJnbVBhdGggPSBtYXBSYXdEYXRhLmluZm8uYmdtO1xyXG5cdFx0bGV0IGkgPSBiZ21QYXRoLmluZGV4T2YoXCIvXCIpLCBwYXRoID0gYmdtUGF0aC5zbGljZSgwLCBpKSArIGJnbVBhdGguc2xpY2UoaSk7XHJcblx0XHQvL2xldCBtID0gYmdtUGF0aC5tYXRjaCgvKFteXFwvXSspKFxcLy4qKS8pLCBwYXRoID0gW21bMV0sIG1bMl1dLmpvaW4oXCIvXCIpO1xyXG5cdFx0cmV0dXJuIFtcIlwiLCBcIlNvdW5kXCIsIHBhdGhdLmpvaW4oXCIvXCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogbG9hZCBtYXAgZnJvbSBsb2FkZWQgZGF0YVxyXG5cdCAqIEBwYXJhbSB7e2luZm86e2JnbTpzdHJpbmd9fX0gbWFwUmF3RGF0YVxyXG5cdCAqL1xyXG5cdF9sb2FkQmdtKG1hcFJhd0RhdGEpIHtcclxuXHRcdGNvbnN0IGVsZW1fYmdtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZ21cIik7XHJcblx0XHRpZiAoZWxlbV9iZ20pIHtcclxuXHRcdFx0Y29uc3QgcGF0aCA9IHRoaXMuX2dldEJnbVBhdGgobWFwUmF3RGF0YSk7XHJcblx0XHRcdHRoaXMuX2JnbV9wYXRoID0gcGF0aDtcclxuXHJcblx0XHRcdGNvbnN0IHVybCA9ICRnZXQuc291bmRNcDNVcmwocGF0aCk7XHJcblx0XHRcdFxyXG5cdFx0XHRlbGVtX2JnbS5pbm5lckhUTUwgPSBgPHNvdXJjZSBzcmM9XCIke3VybH1cIiB0eXBlPVwiYXVkaW8vbXBlZ1wiPmA7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xyXG5cdFx0XHRcdGVsZW1fYmdtLmF1dG9wbGF5ID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRlbGVtX2JnbS5hdXRvcGxheSA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5lcnJvcihuZXcgVHlwZUVycm9yKFwiI2JnbVwiKSk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRwbGF5QmdtKCkge1xyXG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJiZ21cIikucGxheSgpO1xyXG5cdH1cclxuXHJcblx0cGF1c2VCZ20oKSB7XHJcblx0XHRkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImJnbVwiKS5wYXVzZSgpO1xyXG5cdH1cclxuXHRcclxuXHRfX2NvbnN0cnVjdE1pbmlNYXAocmF3KSB7XHJcblx0XHRpZiAocmF3Lm1pbmlNYXApIHtcclxuXHRcdFx0Ly9jb25zdCBodyA9IHJhdy5taW5pTWFwLndpZHRoICogMC41O1xyXG5cdFx0XHQvL2NvbnN0IGhoID0gcmF3Lm1pbmlNYXAuaGVpZ2h0ICogMC41O1xyXG5cdFx0XHQvL2NvbnN0IGN4ID0gcmF3Lm1pbmlNYXAuY2VudGVyWDtcclxuXHRcdFx0Ly9jb25zdCBjeSA9IHJhdy5taW5pTWFwLmNlbnRlclk7XHJcblx0XHRcdHRoaXMud2lkdGggPSByYXcubWluaU1hcC53aWR0aDtcclxuXHRcdFx0dGhpcy5oZWlnaHQgPSByYXcubWluaU1hcC5oZWlnaHQ7XHJcblx0XHRcdHRoaXMuY2VudGVyWCA9IHJhdy5taW5pTWFwLmNlbnRlclg7XHJcblx0XHRcdHRoaXMuY2VudGVyWSA9IHJhdy5taW5pTWFwLmNlbnRlclk7XHJcblx0XHRcdC8vdGhpcy5ib3VuZFJlY3QgPSBuZXcgUmVjdGFuZ2xlKGN4IC0gaHcsIGN5IC0gaGgsIHJhdy5taW5pTWFwLndpZHRoLCByYXcubWluaU1hcC5oZWlnaHQpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMud2lkdGggPSAwO1xyXG5cdFx0XHR0aGlzLmhlaWdodCA9IDA7XHJcblx0XHRcdHRoaXMuY2VudGVyWCA9IDA7XHJcblx0XHRcdHRoaXMuY2VudGVyWSA9IDA7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdF9taW5pTWFwX3NyYygpIHtcclxuXHRcdHJldHVybiB0aGlzLl91cmwgKyBcIm1pbmlNYXAvY2FudmFzXCI7XHJcblx0XHRjb25zdCBhID0ge1xyXG5cdFx0XHRcImNhbnZhc1wiOiB7XHJcblx0XHRcdFx0XCJcIjogXCJcIlxyXG5cdFx0XHR9LFxyXG5cdFx0XHRcIndpZHRoXCI6IDQ0ODMsXHJcblx0XHRcdFwiaGVpZ2h0XCI6IDEyNDQsXHJcblx0XHRcdFwiY2VudGVyWFwiOiAxMDMwLFxyXG5cdFx0XHRcImNlbnRlcllcIjogNzgxLFxyXG5cdFx0XHRcIm1hZ1wiOiA0XHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogd2FpdCBhbGwgdGFzazogcmV0dXJuIHRydWUgaWYgbm90aGluZyB0byBsb2FkaW5nIGVsc2UgbGlzdCBvZiBsb2FkZWQgb2JqZWN0XHJcblx0ICogbG9hZGluZzogdGV4dHVyZS4uLlxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPHRydWU+fFByb21pc2U8YW55W10+fVxyXG5cdCAqL1xyXG5cdGFzeW5jIHdhaXRMb2FkZWQoKSB7XHJcblx0XHRhd2FpdCB0aGlzLiRwcm9taXNlO1xyXG5cdH1cclxuXHJcblx0aXNMb2FkZWQoKSB7XHJcblx0XHRyZXR1cm4gKCghdGhpcy4kbG9hZF90YXNrcyB8fCAhdGhpcy4kbG9hZF90YXNrcy5sZW5ndGgpICYmIHRoaXMuX3JhdyAmJiAhdGhpcy4kbG9hZGluZ19zdGF0dXMpO1xyXG5cdH1cclxuXHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0d2luZG93Lm1faG92ZXJfb2JqZWN0ID0gbnVsbDtcclxuXHRcdGlmICgkZ3YubW91c2VfZG0gfHwgJGd2Lm1vdXNlX2RyKSB7XHJcblx0XHRcdHdpbmRvdy5tX3NlbGVjdGVkX29iamVjdCA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmIChzdGFtcCAhPSBudWxsKSB7XHJcblx0XHRcdHRoaXMuc3RhbXAgPSBzdGFtcDtcclxuXHJcblx0XHRcdHRoaXMubGlmZU1nci51cGRhdGUoc3RhbXApO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuaXNMb2FkZWQoKSkge1xyXG5cdFx0XHRcdHRoaXMuY29udHJvbGxlci51cGRhdGUoc3RhbXApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7U2NlbmVDaGFyYWN0ZXJ9IGNoYXJhXHJcblx0ICovXHJcblx0X2FkZENoYXJhKGNoYXJhKSB7XHJcblx0XHR0cnkge1xyXG5cdFx0XHRsZXQgcGxheWVyX3NwYXducyA9IHRoaXMucG9ydGFsTWdyLnBvcnRhbHMuZmlsdGVyKGEgPT4gYS5wbiA9PSBcInNwXCIpO1xyXG5cdFx0XHRsZXQgc3Bhd24gPSBwbGF5ZXJfc3Bhd25zW01hdGgudHJ1bmMoTWF0aC5yYW5kb20oKSAqIDEwMCkgJSBwbGF5ZXJfc3Bhd25zLmxlbmd0aF07XHJcblx0XHRcdGNvbnN0ICRwaHlzaWNzID0gY2hhcmEuJHBoeXNpY3M7XHJcblx0XHRcdGNvbnN0IHggPSBzcGF3bi54IC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFx0Y29uc3QgeSA9IHNwYXduLnkgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0XHQkcGh5c2ljcy5zZXRQb3NpdGlvbih4LCB5KTtcclxuXHRcdFx0JHBoeXNpY3MuYm9keS5TZXRBd2FrZSh0cnVlKTtcclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKGV4KTtcclxuXHRcdH1cclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtTY2VuZUNoYXJhY3Rlcn0gY2hhcmFcclxuXHQgKi9cclxuXHRhZGRDaGFyYShjaGFyYSkge1xyXG5cdFx0aWYgKHRoaXMuJHByb21pc2UpIHtcclxuXHRcdFx0dGhpcy4kcHJvbWlzZS50aGVuKCgpID0+IHtcclxuXHRcdFx0XHR0aGlzLl9hZGRDaGFyYShjaGFyYSk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuX2FkZENoYXJhKGNoYXJhKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0YXBwbHlDYW1lcmEocmVuZGVyZXIpIHtcclxuXHRcdHJlbmRlcmVyLmN0eC5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgTWF0aC50cnVuYygtJGd2Lm1fdmlld1JlY3QueCksIE1hdGgudHJ1bmMoLSRndi5tX3ZpZXdSZWN0LnkpKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHB1c2hHbG9iYWxBbHBoYVxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdGJlZ2luUmVuZGVyKHJlbmRlcmVyKSB7XHJcblx0XHRyZW5kZXJlci5wdXNoR2xvYmFsQWxwaGEoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdGVuZFJlbmRlcihyZW5kZXJlcikge1xyXG5cdFx0cmVuZGVyZXIucG9wR2xvYmFsQWxwaGEoKTtcclxuXHRcdC8vcmVuZGVyZXIucG9wTWF0cml4KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gd2hlcmVMYXllciAtIHdoZXJlIGxheWVyIGluZGV4XHJcblx0ICovXHJcblx0cmVuZGVyTGlmZShyZW5kZXJlciwgd2hlcmVMYXllcikge1xyXG5cdFx0aWYgKCEkZ3YubV9kaXNwbGF5X2xpZmUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgY2VudGVyID0gVmVjMi5lbXB0eTtcclxuXHRcdGNvbnN0IHZpZXdSZWN0ID0gJGd2Lm1fdmlld1JlY3Q7XHJcblx0XHRcclxuXHRcdHRoaXMubGlmZU1nci5kcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0LCB3aGVyZUxheWVyKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0cmVuZGVyUG9ydGFsKHJlbmRlcmVyKSB7XHJcblx0XHRpZiAoISRndi5tX2Rpc3BsYXlfcG9ydGFsKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGNvbnN0IGNlbnRlciA9IFZlYzIuZW1wdHk7XHJcblx0XHRjb25zdCB2aWV3UmVjdCA9ICRndi5tX3ZpZXdSZWN0O1xyXG5cclxuXHRcdHRoaXMucG9ydGFsTWdyLnVwZGF0ZSh0aGlzLnN0YW1wKTtcclxuXHRcdHRoaXMucG9ydGFsTWdyLmRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0cmVuZGVyRnJvbnRncm91bmQocmVuZGVyZXIpIHtcclxuXHRcdGlmICghJGd2Lm1fZGlzcGxheV9mcm9udCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCBjZW50ZXIgPSAkZ3YubV92aWV3UmVjdC5jZW50ZXI7XHJcblx0XHRjb25zdCB2aWV3UmVjdCA9ICRndi5tX3ZpZXdSZWN0O1xyXG5cdFx0XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJvbnRncm91bmQubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IGJhY2sgPSB0aGlzLmZyb250Z3JvdW5kW2ldO1xyXG5cdFx0XHRpZiAodGhpcy5pc0FjdGl2YXRlZChiYWNrLnF1ZXN0KSkge1xyXG5cdFx0XHRcdGJhY2sudXBkYXRlKHRoaXMuc3RhbXApO1xyXG5cdFx0XHRcdGJhY2suZHJhdyhyZW5kZXJlciwgY2VudGVyLCB2aWV3UmVjdCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHJlbmRlckxheWVyZWRPYmplY3QocmVuZGVyZXIsIGxheWVySW5kZXgpIHtcclxuXHRcdGlmICghJGd2Lm1fZGlzcGxheV9tYXBvYmopIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgY2VudGVyID0gVmVjMi5lbXB0eTtcclxuXHRcdGNvbnN0IHZpZXdSZWN0ID0gJGd2Lm1fdmlld1JlY3Q7XHJcblx0XHRcclxuXHRcdGNvbnN0IG9ianMgPSB0aGlzLmxheWVyZWRPYmplY3RbbGF5ZXJJbmRleF07XHJcblx0XHRmb3IgKGxldCBqID0gMDsgaiA8IG9ianMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0bGV0IG9iaiA9IG9ianNbal07XHJcblx0XHRcdGlmICh0aGlzLmlzQWN0aXZhdGVkKG9iai5xdWVzdCkpIHtcclxuXHRcdFx0XHRvYmoudXBkYXRlKHRoaXMuc3RhbXApO1xyXG5cdFx0XHRcdG9iai5kcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKi9cclxuXHRyZW5kZXJMYXllcmVkVGlsZShyZW5kZXJlciwgbGF5ZXJJbmRleCkge1xyXG5cdFx0aWYgKCEkZ3YubV9kaXNwbGF5X21hcHRpbGUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0Y29uc3QgY2VudGVyID0gVmVjMi5lbXB0eTtcclxuXHRcdGNvbnN0IHZpZXdSZWN0ID0gJGd2Lm1fdmlld1JlY3Q7XHJcblx0XHRcclxuXHRcdGNvbnN0IHRpbGVzID0gdGhpcy5sYXllcmVkVGlsZVtsYXllckluZGV4XTtcclxuXHRcdGZvciAobGV0IGogPSAwOyBqIDwgdGlsZXMubGVuZ3RoOyArK2opIHtcclxuXHRcdFx0bGV0IHRpbGUgPSB0aWxlc1tqXTtcclxuXHRcdFx0aWYgKHRoaXMuaXNBY3RpdmF0ZWQodGlsZS5xdWVzdCkpIHtcclxuXHRcdFx0XHR0aWxlLnVwZGF0ZSh0aGlzLnN0YW1wKTtcclxuXHRcdFx0XHR0aWxlLmRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKi9cclxuXHRyZW5kZXJCYWNrZ3JvdW5kKHJlbmRlcmVyKSB7XHJcblx0XHRpZiAoISRndi5tX2Rpc3BsYXlfYmFjaykge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRjb25zdCBjZW50ZXIgPSAkZ3YubV92aWV3UmVjdC5jZW50ZXI7XHJcblx0XHRjb25zdCB2aWV3UmVjdCA9ICRndi5tX3ZpZXdSZWN0O1xyXG5cdFx0XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuYmFja2dyb3VuZC5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRsZXQgYmFjayA9IHRoaXMuYmFja2dyb3VuZFtpXTtcclxuXHRcdFx0aWYgKHRoaXMuaXNBY3RpdmF0ZWQoYmFjay5xdWVzdCkpIHtcclxuXHRcdFx0XHRiYWNrLnVwZGF0ZSh0aGlzLnN0YW1wKTtcclxuXHRcdFx0XHRiYWNrLmRyYXcocmVuZGVyZXIsIGNlbnRlciwgdmlld1JlY3QpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHJlbmRlclBhcnRpY2xlKHJlbmRlcmVyKSB7XHJcblx0XHRpZiAoISRndi5tX2Rpc3BsYXlfcGFydGljbGVfc3lzdGVtKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdC8vY29uc3QgY2VudGVyID0gVmVjMi5lbXB0eTtcclxuXHRcdGNvbnN0IGNlbnRlciA9ICRndi5tX3ZpZXdSZWN0LmNlbnRlcjtcclxuXHRcdGNvbnN0IHZpZXdSZWN0ID0gJGd2Lm1fdmlld1JlY3Q7XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYXJ0aWNsZUxpc3QubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0bGV0IHBhcnRpY2xlID0gdGhpcy5wYXJ0aWNsZUxpc3RbaV07XHJcblx0XHRcdGlmICh0aGlzLmlzQWN0aXZhdGVkKHBhcnRpY2xlLnF1ZXN0KSkge1xyXG5cdFx0XHRcdHBhcnRpY2xlLnVwZGF0ZSh0aGlzLnN0YW1wKTtcclxuXHRcdFx0XHRwYXJ0aWNsZS5kcmF3KHJlbmRlcmVyLCBjZW50ZXIsIHZpZXdSZWN0KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5BZGRJbml0VGFzayhTY2VuZU1hcC5Jbml0KTtcclxuXHJcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuLy9cclxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuZnVuY3Rpb24gb2JqSXNFbXB0eSh4KSB7XHJcblx0aWYgKHR5cGVvZiB4ID09ICdvYmplY3QnICYmIHggPT0gbnVsbClcclxuXHRcdHRocm93IG5ldyBFcnJvcigpO1xyXG5cdHJldHVybiB0eXBlb2YgeCA9PSAndW5kZWZpbmVkJyB8fCB4ID09IG51bGw7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Map.js\n");

/***/ }),

/***/ "./src/game/MobSkill/238.FairyDust.js":
/*!********************************************!*\
  !*** ./src/game/MobSkill/238.FairyDust.js ***!
  \********************************************/
/*! exports provided: FairyDustBall, FairyDustBallHit, FairyDust, _FairyDust */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FairyDustBall\", function() { return FairyDustBall; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FairyDustBallHit\", function() { return FairyDustBallHit; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FairyDust\", function() { return FairyDust; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_FairyDust\", function() { return _FairyDust; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../SceneObject.js */ \"./src/game/SceneObject.js\");\n/* harmony import */ var _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MobSkillBase.js */ \"./src/game/MobSkill/MobSkillBase.js\");\n\r\n/**\r\n * usage:\r\n *\tvar fairyDust = new FairyDust();\r\n *\tfairyDust.load(4).then(()=>fairyDust.invoke());\r\n */\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass FairyDustBallDefinition extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBallDefinition\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.scale = 0;// 1~3\r\n\t}\r\n}\r\n\r\nclass FairyDustBall extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBallBase\"] {\r\n\t/**\r\n\t * @param {FairyDustBallDefinition} ballDef\r\n\t */\r\n\tconstructor(ballDef, animations) {\r\n\t\tsuper(ballDef, animations);\r\n\t\t\r\n\t\tthis.x = 1000;\r\n\t\tthis.y = -80;\r\n\t\t\r\n\t\t//this.scale = ballDef.scale;\r\n\t\t\r\n\t\tthis.renderer = animations[\"ball\" + ballDef.scale].clone();\r\n\t}\r\n\t\r\n\t/** @param {PWorld} pWorld */\r\n\tcreate(pWorld) {\r\n\t\tthis.$physics = {// make dummy for debug\r\n\t\t\tstate: {}\r\n\t\t};\r\n\t\t\r\n\t\tsuper.create(pWorld);//complete create\r\n\t}\r\n\t\r\n\tget _BallDefinition() {\r\n\t\treturn FairyDustBallDefinition;\r\n\t}\r\n}\r\nclass FairyDustBallHit extends _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__[\"SceneObject\"] {\r\n\tconstructor(target, animations) {\r\n\t\tsuper();\r\n\t\t//MouseJoint\r\n\t\t//World.CreateJoint()\r\n\t}\r\n}\r\n\r\nclass FairyDust extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBase\"] {\r\n\tconstructor(_raw, _url) {\r\n\t\tsuper(_raw, _url);\r\n\t}\r\n\t\r\n\t/** @param {4|10} level */\r\n\t\r\n\tinvoke() {\r\n\t\tconst s = this._raw.s;\r\n\t\tconst s2 = this._raw.s2;\r\n\t\tconst v = this._raw.v;\r\n\t\tconst v2 = this._raw.v2;\r\n\t\tconst w = this._raw.w;\r\n\t\tconst w2 = this._raw.w2;\r\n\t\tconst u = this._raw.u;\r\n\t\tlet x = this._raw.x;\r\n\t\t\r\n\t\tfor (let i = 0, max = _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].randInt(w, w + w2); i < max; i++) {\r\n\t\t\tx += _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].nextInt(x);\r\n\t\t\tlet ball = new FairyDustBall({\r\n\t\t\t\tscale: _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].nextInt(3),\r\n\t\t\t\tcreateDelay: u,\r\n\t\t\t\tmoveSpeed: v + _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].nextInt(v2),\r\n\t\t\t\tangle: x + _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].randInt(s, s2),\r\n\t\t\t}, this.animations);\r\n\t\t\t$gv.SceneObjectMgr.addToScene(10, ball);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @returns {string[]} */\r\n\tget _anima_name_list() {\r\n\t\treturn [\"ball0\", \"ball1\", \"ball2\"];\r\n\t}\r\n\t\r\n\tget _base_path() {\r\n\t\treturn \"/Skill/MobSkill/238/level\";\r\n\t}\r\n}\r\n\r\nclass _FairyDust extends FairyDust {\r\n\tconstructor(_raw, _url) {\r\n\t\tsuper(_raw, _url);\r\n\t}\r\n\t/** @override */\r\n\tload(level) {\r\n\t\tif (!this._raw && !this._url) {\r\n\t\t\tthis._raw = window.MOB_SKILL_RAW[238].level[level];\r\n\t\t\tthis._url = [this._base_path, level].join(\"/\");\r\n\t\t}\r\n\t\tsuper.load(level);\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9Nb2JTa2lsbC8yMzguRmFpcnlEdXN0LmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvTW9iU2tpbGwvMjM4LkZhaXJ5RHVzdC5qcz85ODc4Il0sInNvdXJjZXNDb250ZW50IjpbIlxyXG4vKipcclxuICogdXNhZ2U6XHJcbiAqXHR2YXIgZmFpcnlEdXN0ID0gbmV3IEZhaXJ5RHVzdCgpO1xyXG4gKlx0ZmFpcnlEdXN0LmxvYWQoNCkudGhlbigoKT0+ZmFpcnlEdXN0Lmludm9rZSgpKTtcclxuICovXHJcblxyXG5pbXBvcnQgeyBSYW5kb21pemVyIH0gZnJvbSBcIi4uL21hdGguanNcIjtcclxuXHJcbmltcG9ydCB7IEFuaW1hdGlvbiB9IGZyb20gXCIuLi9BbmltYXRpb24uanNcIjtcclxuaW1wb3J0IHsgU2NlbmVPYmplY3QgfSBmcm9tIFwiLi4vU2NlbmVPYmplY3QuanNcIjtcclxuXHJcbmltcG9ydCB7IE1vYlNraWxsQmFsbERlZmluaXRpb24sIE1vYlNraWxsQmFsbEJhc2UsIE1vYlNraWxsQmFzZSB9IGZyb20gXCIuL01vYlNraWxsQmFzZS5qc1wiO1xyXG5cclxuXHJcbmNsYXNzIEZhaXJ5RHVzdEJhbGxEZWZpbml0aW9uIGV4dGVuZHMgTW9iU2tpbGxCYWxsRGVmaW5pdGlvbiB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy5zY2FsZSA9IDA7Ly8gMX4zXHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRmFpcnlEdXN0QmFsbCBleHRlbmRzIE1vYlNraWxsQmFsbEJhc2Uge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7RmFpcnlEdXN0QmFsbERlZmluaXRpb259IGJhbGxEZWZcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihiYWxsRGVmLCBhbmltYXRpb25zKSB7XHJcblx0XHRzdXBlcihiYWxsRGVmLCBhbmltYXRpb25zKTtcclxuXHRcdFxyXG5cdFx0dGhpcy54ID0gMTAwMDtcclxuXHRcdHRoaXMueSA9IC04MDtcclxuXHRcdFxyXG5cdFx0Ly90aGlzLnNjYWxlID0gYmFsbERlZi5zY2FsZTtcclxuXHRcdFxyXG5cdFx0dGhpcy5yZW5kZXJlciA9IGFuaW1hdGlvbnNbXCJiYWxsXCIgKyBiYWxsRGVmLnNjYWxlXS5jbG9uZSgpO1xyXG5cdH1cclxuXHRcclxuXHQvKiogQHBhcmFtIHtQV29ybGR9IHBXb3JsZCAqL1xyXG5cdGNyZWF0ZShwV29ybGQpIHtcclxuXHRcdHRoaXMuJHBoeXNpY3MgPSB7Ly8gbWFrZSBkdW1teSBmb3IgZGVidWdcclxuXHRcdFx0c3RhdGU6IHt9XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRzdXBlci5jcmVhdGUocFdvcmxkKTsvL2NvbXBsZXRlIGNyZWF0ZVxyXG5cdH1cclxuXHRcclxuXHRnZXQgX0JhbGxEZWZpbml0aW9uKCkge1xyXG5cdFx0cmV0dXJuIEZhaXJ5RHVzdEJhbGxEZWZpbml0aW9uO1xyXG5cdH1cclxufVxyXG5leHBvcnQgY2xhc3MgRmFpcnlEdXN0QmFsbEhpdCBleHRlbmRzIFNjZW5lT2JqZWN0IHtcclxuXHRjb25zdHJ1Y3Rvcih0YXJnZXQsIGFuaW1hdGlvbnMpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHQvL01vdXNlSm9pbnRcclxuXHRcdC8vV29ybGQuQ3JlYXRlSm9pbnQoKVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEZhaXJ5RHVzdCBleHRlbmRzIE1vYlNraWxsQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoX3JhdywgX3VybCkge1xyXG5cdFx0c3VwZXIoX3JhdywgX3VybCk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAcGFyYW0gezR8MTB9IGxldmVsICovXHJcblx0XHJcblx0aW52b2tlKCkge1xyXG5cdFx0Y29uc3QgcyA9IHRoaXMuX3Jhdy5zO1xyXG5cdFx0Y29uc3QgczIgPSB0aGlzLl9yYXcuczI7XHJcblx0XHRjb25zdCB2ID0gdGhpcy5fcmF3LnY7XHJcblx0XHRjb25zdCB2MiA9IHRoaXMuX3Jhdy52MjtcclxuXHRcdGNvbnN0IHcgPSB0aGlzLl9yYXcudztcclxuXHRcdGNvbnN0IHcyID0gdGhpcy5fcmF3LncyO1xyXG5cdFx0Y29uc3QgdSA9IHRoaXMuX3Jhdy51O1xyXG5cdFx0bGV0IHggPSB0aGlzLl9yYXcueDtcclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIG1heCA9IFJhbmRvbWl6ZXIucmFuZEludCh3LCB3ICsgdzIpOyBpIDwgbWF4OyBpKyspIHtcclxuXHRcdFx0eCArPSBSYW5kb21pemVyLm5leHRJbnQoeCk7XHJcblx0XHRcdGxldCBiYWxsID0gbmV3IEZhaXJ5RHVzdEJhbGwoe1xyXG5cdFx0XHRcdHNjYWxlOiBSYW5kb21pemVyLm5leHRJbnQoMyksXHJcblx0XHRcdFx0Y3JlYXRlRGVsYXk6IHUsXHJcblx0XHRcdFx0bW92ZVNwZWVkOiB2ICsgUmFuZG9taXplci5uZXh0SW50KHYyKSxcclxuXHRcdFx0XHRhbmdsZTogeCArIFJhbmRvbWl6ZXIucmFuZEludChzLCBzMiksXHJcblx0XHRcdH0sIHRoaXMuYW5pbWF0aW9ucyk7XHJcblx0XHRcdCRndi5TY2VuZU9iamVjdE1nci5hZGRUb1NjZW5lKDEwLCBiYWxsKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqIEByZXR1cm5zIHtzdHJpbmdbXX0gKi9cclxuXHRnZXQgX2FuaW1hX25hbWVfbGlzdCgpIHtcclxuXHRcdHJldHVybiBbXCJiYWxsMFwiLCBcImJhbGwxXCIsIFwiYmFsbDJcIl07XHJcblx0fVxyXG5cdFxyXG5cdGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL1NraWxsL01vYlNraWxsLzIzOC9sZXZlbFwiO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIF9GYWlyeUR1c3QgZXh0ZW5kcyBGYWlyeUR1c3Qge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcsIF91cmwpIHtcclxuXHRcdHN1cGVyKF9yYXcsIF91cmwpO1xyXG5cdH1cclxuXHQvKiogQG92ZXJyaWRlICovXHJcblx0bG9hZChsZXZlbCkge1xyXG5cdFx0aWYgKCF0aGlzLl9yYXcgJiYgIXRoaXMuX3VybCkge1xyXG5cdFx0XHR0aGlzLl9yYXcgPSB3aW5kb3cuTU9CX1NLSUxMX1JBV1syMzhdLmxldmVsW2xldmVsXTtcclxuXHRcdFx0dGhpcy5fdXJsID0gW3RoaXMuX2Jhc2VfcGF0aCwgbGV2ZWxdLmpvaW4oXCIvXCIpO1xyXG5cdFx0fVxyXG5cdFx0c3VwZXIubG9hZChsZXZlbCk7XHJcblx0fVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/MobSkill/238.FairyDust.js\n");

/***/ }),

/***/ "./src/game/MobSkill/238.FlowerTrap.js":
/*!*********************************************!*\
  !*** ./src/game/MobSkill/238.FlowerTrap.js ***!
  \*********************************************/
/*! exports provided: FlowerTrapBall, FlowerTrap */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FlowerTrapBall\", function() { return FlowerTrapBall; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FlowerTrap\", function() { return FlowerTrap; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../SceneObject.js */ \"./src/game/SceneObject.js\");\n/* harmony import */ var _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MobSkillBase.js */ \"./src/game/MobSkill/MobSkillBase.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass FlowerTrapBallDefinition extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBallDefinition\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.size = 0;// 1~3\r\n\t}\r\n}\r\n\r\nclass FlowerTrapBall extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBallBase\"] {\r\n\t/**\r\n\t * @param {FlowerTrapBallDefinition} ballDef\r\n\t */\r\n\tconstructor(ballDef, animations) {\r\n\t\tsuper(ballDef, animations);\r\n\t\t\r\n\t\tthis.renderer = animations[ballDef.size].clone();\r\n\t}\r\n\t\r\n\t/** @param {PWorld} pWorld */\r\n\tcreate(pWorld) {\r\n\t\tthis.$physics = {// make dummy for debug\r\n\t\t\tstate: {}\r\n\t\t};\r\n\t\t\r\n\t\tsuper.create(pWorld);//complete create\r\n\t}\r\n\t\r\n\tget _BallDefinition() {\r\n\t\treturn FlowerTrapBallDefinition;\r\n\t}\r\n}\r\n\r\nclass FlowerTrap extends _MobSkillBase_js__WEBPACK_IMPORTED_MODULE_3__[\"MobSkillBase\"] {\r\n\tconstructor(_raw, _url) {\r\n\t\tsuper(_raw, _url);\r\n\t\tthis.patterns = {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} pattern - 0~2 int\r\n\t * @param {number} x - int\r\n\t * @param {number} y - int\r\n\t * @param {boolean} flip - not sure\r\n\t */\r\n\t_invoke(pattern, x, y, flip) {\r\n\t\tconst pats = this._raw[\"pattern\" + pattern];\r\n\t\tfor (let i = 0; i in pats; ++i) {\r\n\t\t\tconst pat = pats[i];\r\n\t\t\tlet mx, my, angle;\r\n\t\t\t\r\n\t\t\tmx = x + (flip ? (-pat.pos.x) : (pat.pos.x));\r\n\t\t\tmy = y + pat.pos.y;\r\n\t\t\tangle = pat.angle - 90;//texture is vertical, angle - 90deg\r\n\t\t\t\r\n\t\t\tlet ball = new FlowerTrapBall({\r\n\t\t\t\tx: mx, y: my, angle: angle,\r\n\t\t\t\tsize: pat.size,\r\n\t\t\t\tcreateDelay: pat.createDelay,\r\n\t\t\t\tcollisionDelay: pat.collisionDelay,\r\n\t\t\t\tduration: pat.duration\r\n\t\t\t}, this.animations);\r\n\t\t\t\r\n\t\t\t$gv.SceneObjectMgr.addToScene(10, ball);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @returns {void} */\r\n\tinvoke() {\r\n\t\tthis._invoke(_math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].nextInt(3), 1000, 48, _math_js__WEBPACK_IMPORTED_MODULE_0__[\"Randomizer\"].nextBoolean());\r\n\t}\r\n\t\r\n\t/** @returns {string[]} */\r\n\tget _anima_name_list() {\r\n\t\treturn [\"XL\", \"L\", \"M\", \"S\"];\r\n\t}\r\n\t\r\n\t/** @returns {string} */\r\n\tget _base_path() {\r\n\t\treturn \"/Skill/MobSkill/238/level\";\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9Nb2JTa2lsbC8yMzguRmxvd2VyVHJhcC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL01vYlNraWxsLzIzOC5GbG93ZXJUcmFwLmpzPzc4Y2IiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IFJhbmRvbWl6ZXIgfSBmcm9tIFwiLi4vbWF0aC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgQW5pbWF0aW9uIH0gZnJvbSBcIi4uL0FuaW1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZU9iamVjdCB9IGZyb20gXCIuLi9TY2VuZU9iamVjdC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgTW9iU2tpbGxCYWxsRGVmaW5pdGlvbiwgTW9iU2tpbGxCYWxsQmFzZSwgTW9iU2tpbGxCYXNlIH0gZnJvbSBcIi4vTW9iU2tpbGxCYXNlLmpzXCI7XHJcblxyXG5jbGFzcyBGbG93ZXJUcmFwQmFsbERlZmluaXRpb24gZXh0ZW5kcyBNb2JTa2lsbEJhbGxEZWZpbml0aW9uIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHR0aGlzLnNpemUgPSAwOy8vIDF+M1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIEZsb3dlclRyYXBCYWxsIGV4dGVuZHMgTW9iU2tpbGxCYWxsQmFzZSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtGbG93ZXJUcmFwQmFsbERlZmluaXRpb259IGJhbGxEZWZcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihiYWxsRGVmLCBhbmltYXRpb25zKSB7XHJcblx0XHRzdXBlcihiYWxsRGVmLCBhbmltYXRpb25zKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5yZW5kZXJlciA9IGFuaW1hdGlvbnNbYmFsbERlZi5zaXplXS5jbG9uZSgpO1xyXG5cdH1cclxuXHRcclxuXHQvKiogQHBhcmFtIHtQV29ybGR9IHBXb3JsZCAqL1xyXG5cdGNyZWF0ZShwV29ybGQpIHtcclxuXHRcdHRoaXMuJHBoeXNpY3MgPSB7Ly8gbWFrZSBkdW1teSBmb3IgZGVidWdcclxuXHRcdFx0c3RhdGU6IHt9XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRzdXBlci5jcmVhdGUocFdvcmxkKTsvL2NvbXBsZXRlIGNyZWF0ZVxyXG5cdH1cclxuXHRcclxuXHRnZXQgX0JhbGxEZWZpbml0aW9uKCkge1xyXG5cdFx0cmV0dXJuIEZsb3dlclRyYXBCYWxsRGVmaW5pdGlvbjtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGbG93ZXJUcmFwIGV4dGVuZHMgTW9iU2tpbGxCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcihfcmF3LCBfdXJsKSB7XHJcblx0XHRzdXBlcihfcmF3LCBfdXJsKTtcclxuXHRcdHRoaXMucGF0dGVybnMgPSB7fTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHBhdHRlcm4gLSAwfjIgaW50XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHggLSBpbnRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSAtIGludFxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gZmxpcCAtIG5vdCBzdXJlXHJcblx0ICovXHJcblx0X2ludm9rZShwYXR0ZXJuLCB4LCB5LCBmbGlwKSB7XHJcblx0XHRjb25zdCBwYXRzID0gdGhpcy5fcmF3W1wicGF0dGVyblwiICsgcGF0dGVybl07XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSBpbiBwYXRzOyArK2kpIHtcclxuXHRcdFx0Y29uc3QgcGF0ID0gcGF0c1tpXTtcclxuXHRcdFx0bGV0IG14LCBteSwgYW5nbGU7XHJcblx0XHRcdFxyXG5cdFx0XHRteCA9IHggKyAoZmxpcCA/ICgtcGF0LnBvcy54KSA6IChwYXQucG9zLngpKTtcclxuXHRcdFx0bXkgPSB5ICsgcGF0LnBvcy55O1xyXG5cdFx0XHRhbmdsZSA9IHBhdC5hbmdsZSAtIDkwOy8vdGV4dHVyZSBpcyB2ZXJ0aWNhbCwgYW5nbGUgLSA5MGRlZ1xyXG5cdFx0XHRcclxuXHRcdFx0bGV0IGJhbGwgPSBuZXcgRmxvd2VyVHJhcEJhbGwoe1xyXG5cdFx0XHRcdHg6IG14LCB5OiBteSwgYW5nbGU6IGFuZ2xlLFxyXG5cdFx0XHRcdHNpemU6IHBhdC5zaXplLFxyXG5cdFx0XHRcdGNyZWF0ZURlbGF5OiBwYXQuY3JlYXRlRGVsYXksXHJcblx0XHRcdFx0Y29sbGlzaW9uRGVsYXk6IHBhdC5jb2xsaXNpb25EZWxheSxcclxuXHRcdFx0XHRkdXJhdGlvbjogcGF0LmR1cmF0aW9uXHJcblx0XHRcdH0sIHRoaXMuYW5pbWF0aW9ucyk7XHJcblx0XHRcdFxyXG5cdFx0XHQkZ3YuU2NlbmVPYmplY3RNZ3IuYWRkVG9TY2VuZSgxMCwgYmFsbCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAcmV0dXJucyB7dm9pZH0gKi9cclxuXHRpbnZva2UoKSB7XHJcblx0XHR0aGlzLl9pbnZva2UoUmFuZG9taXplci5uZXh0SW50KDMpLCAxMDAwLCA0OCwgUmFuZG9taXplci5uZXh0Qm9vbGVhbigpKTtcclxuXHR9XHJcblx0XHJcblx0LyoqIEByZXR1cm5zIHtzdHJpbmdbXX0gKi9cclxuXHRnZXQgX2FuaW1hX25hbWVfbGlzdCgpIHtcclxuXHRcdHJldHVybiBbXCJYTFwiLCBcIkxcIiwgXCJNXCIsIFwiU1wiXTtcclxuXHR9XHJcblx0XHJcblx0LyoqIEByZXR1cm5zIHtzdHJpbmd9ICovXHJcblx0Z2V0IF9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gXCIvU2tpbGwvTW9iU2tpbGwvMjM4L2xldmVsXCI7XHJcblx0fVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/MobSkill/238.FlowerTrap.js\n");

/***/ }),

/***/ "./src/game/MobSkill/MobSkillBase.js":
/*!*******************************************!*\
  !*** ./src/game/MobSkill/MobSkillBase.js ***!
  \*******************************************/
/*! exports provided: MobSkillBallDefinition, MobSkillBallBase, MobSkillBase */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobSkillBallDefinition\", function() { return MobSkillBallDefinition; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobSkillBallBase\", function() { return MobSkillBallBase; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobSkillBase\", function() { return MobSkillBase; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../SceneObject.js */ \"./src/game/SceneObject.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass MobSkillBallDefinition {\r\n\tconstructor() {\r\n\t\tthis.createDelay = 0;\r\n\t\tthis.collisionDelay = 0;\r\n\t\tthis.duration = 0;\r\n\t\t\r\n\t\tthis.moveSpeed = 0;\r\n\t\tthis.angle = 0;\r\n\t\t\r\n\t\tthis.flip = false;\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis._speed_x = 0;//uint: px/second\r\n\t\tthis._speed_y = 0;//uint: px/second\r\n\t}\r\n}\r\n\r\nclass MobSkillBallBase extends _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__[\"SceneObject\"] {\r\n\t/**\r\n\t * @param {MobSkillBallDefinition} ballDef\r\n\t * @param {{[x:string]:Animation} animations\r\n\t */\r\n\tconstructor(ballDef, animations) {\r\n\t\tsuper();\r\n\t\t\r\n\t\tballDef = Object.assign(new this._BallDefinition(), ballDef);\r\n\t\t\r\n\t\tthis.createDelay = ballDef.createDelay;\r\n\t\tthis.collisionDelay = ballDef.collisionDelay;\r\n\t\tthis.duration = ballDef.duration;\r\n\t\t\r\n\t\tthis.moveSpeed = ballDef.moveSpeed;\r\n\t\tthis.angle = ballDef.angle * Math.PI / 180;//deg to rad\r\n\t\t\r\n\t\tthis.x = ballDef.x;\r\n\t\tthis.y = ballDef.y;\r\n\t\t\r\n\t\tif (this.moveSpeed) {\r\n\t\t\tthis._speed_x = Math.cos(this.angle + Math.PI) * this.moveSpeed;//uint: px/second\r\n\t\t\tthis._speed_y = Math.sin(this.angle + Math.PI) * this.moveSpeed;//uint: px/second\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._speed_x = 0;//uint: px/second\r\n\t\t\tthis._speed_y = 0;//uint: px/second\r\n\t\t}\r\n\t\t\r\n\t\tthis.state = this.E_BEFORE_CREATE;\r\n\t}\r\n\t\r\n\tget E_BEFORE_CREATE() { return 0; }\r\n\tget E_CREATED() { return 1; }\r\n\tget E_BEGIN_COLLISION() { return 2; }\r\n\tget E_ENG_COLLISION() { return 3; }\r\n\t\r\n\t/** @param {PWorld} pWorld */\r\n\tcreate(pWorld) {\r\n\t\tthis.state = this.E_CREATED;\r\n\t\tif (this.collisionDelay > 0) {\r\n\t\t\tthis.enablePhysics = false;\r\n\t\t}\r\n\t}\r\n\t\r\n\tbegin_collision() {\r\n\t\tthis.enablePhysics = true;\r\n\t\tthis.state = this.E_BEGIN_COLLISION;\r\n\t}\r\n\t\r\n\tend_collision() {\r\n\t\tthis.enablePhysics = false;\r\n\t\tthis.state = this.E_ENG_COLLISION;\r\n\t}\r\n\t\r\n\t/**\r\n\t * debug\r\n\t * @param {PWorld} pWorld\r\n\t */\r\n\tupdate(stamp, pWorld) {\r\n\t\tif (this.state == this.E_BEFORE_CREATE) {\r\n\t\t\tthis.createDelay -= stamp;\r\n\t\t\tif (this.createDelay <= 0) {\r\n\t\t\t\tthis.create();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.state == this.E_CREATED) {\r\n\t\t\t\tthis.collisionDelay -= stamp;\r\n\t\t\t\tif (this.collisionDelay <= 0) {\r\n\t\t\t\t\tthis.begin_collision();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (this.state == this.E_BEGIN_COLLISION) {\r\n\t\t\t\tif (this.duration > 0) {\r\n\t\t\t\t\tthis.duration -= stamp;\r\n\t\t\t\t\tif (this.duration) {\r\n\t\t\t\t\t\tthis.end_collision();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!window.$stop) {//debug\r\n\t\t\t\tthis.x += this._speed_x * stamp / 1000;//debug\r\n\t\t\t\tthis.y += this._speed_y * stamp / 1000;//debug\r\n\t\t\t}\r\n\t\t\tthis.renderer.update(stamp);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} engine\r\n\t */\r\n\trender(engine) {\r\n\t\tif (this.state != this.E_BEFORE_CREATE) {\r\n\t\t\tconst flip = this.flip;\r\n\t\t\tthis.renderer.draw(engine, this.x, this.y, this.angle, flip);\r\n\t\t}\r\n\t}\r\n\t\r\n\tget _BallDefinition() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n\r\nclass MobSkillBase {\r\n\tconstructor(_raw, _url) {\r\n\t\tthis._raw = _raw;\r\n\t\tthis._url = _url;\r\n\t\t\r\n\t\tthis.level = null;\r\n\t\t\r\n\t\tthis.animations = {};\r\n\t}\r\n\t\r\n\t/** @param {number} level */\r\n\tasync load(level) {\r\n\t\tthis.level = level;\r\n\t\t\r\n\t\tif (!this._raw && !this._url) {\r\n\t\t\tthis._url = [this._base_path, level].join(\"/\");\r\n\t\t\t\r\n\t\t\tthis._raw = await $get.data(this._url);\r\n\t\t}\r\n\t\t\r\n\t\tfor (let name of this._anima_name_list) {\r\n\t\t\t//name = \"ball0\";\r\n\t\t\tlet anima = new _Animation_js__WEBPACK_IMPORTED_MODULE_1__[\"Animation\"](this._raw[name], [this._url, name].join(\"/\"));\r\n\t\t\tanima.is_loop = true;\r\n\t\t\tanima.load();\r\n\t\t\tthis.animations[name] = anima;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @returns {void} */\r\n\tinvoke() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\t\r\n\t/** @returns {string[]} */\r\n\tget _anima_name_list() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\t\r\n\t/** @returns {string} */\r\n\tget _base_path() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9Nb2JTa2lsbC9Nb2JTa2lsbEJhc2UuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9Nb2JTa2lsbC9Nb2JTa2lsbEJhc2UuanM/MGNlNyJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgUmFuZG9taXplciB9IGZyb20gXCIuLi9tYXRoLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBBbmltYXRpb24gfSBmcm9tIFwiLi4vQW5pbWF0aW9uLmpzXCI7XHJcbmltcG9ydCB7IFNjZW5lT2JqZWN0IH0gZnJvbSBcIi4uL1NjZW5lT2JqZWN0LmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgTW9iU2tpbGxCYWxsRGVmaW5pdGlvbiB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHR0aGlzLmNyZWF0ZURlbGF5ID0gMDtcclxuXHRcdHRoaXMuY29sbGlzaW9uRGVsYXkgPSAwO1xyXG5cdFx0dGhpcy5kdXJhdGlvbiA9IDA7XHJcblx0XHRcclxuXHRcdHRoaXMubW92ZVNwZWVkID0gMDtcclxuXHRcdHRoaXMuYW5nbGUgPSAwO1xyXG5cdFx0XHJcblx0XHR0aGlzLmZsaXAgPSBmYWxzZTtcclxuXHRcdHRoaXMueCA9IDA7XHJcblx0XHR0aGlzLnkgPSAwO1xyXG5cdFx0dGhpcy5fc3BlZWRfeCA9IDA7Ly91aW50OiBweC9zZWNvbmRcclxuXHRcdHRoaXMuX3NwZWVkX3kgPSAwOy8vdWludDogcHgvc2Vjb25kXHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgTW9iU2tpbGxCYWxsQmFzZSBleHRlbmRzIFNjZW5lT2JqZWN0IHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge01vYlNraWxsQmFsbERlZmluaXRpb259IGJhbGxEZWZcclxuXHQgKiBAcGFyYW0ge3tbeDpzdHJpbmddOkFuaW1hdGlvbn0gYW5pbWF0aW9uc1xyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGJhbGxEZWYsIGFuaW1hdGlvbnMpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHRcclxuXHRcdGJhbGxEZWYgPSBPYmplY3QuYXNzaWduKG5ldyB0aGlzLl9CYWxsRGVmaW5pdGlvbigpLCBiYWxsRGVmKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jcmVhdGVEZWxheSA9IGJhbGxEZWYuY3JlYXRlRGVsYXk7XHJcblx0XHR0aGlzLmNvbGxpc2lvbkRlbGF5ID0gYmFsbERlZi5jb2xsaXNpb25EZWxheTtcclxuXHRcdHRoaXMuZHVyYXRpb24gPSBiYWxsRGVmLmR1cmF0aW9uO1xyXG5cdFx0XHJcblx0XHR0aGlzLm1vdmVTcGVlZCA9IGJhbGxEZWYubW92ZVNwZWVkO1xyXG5cdFx0dGhpcy5hbmdsZSA9IGJhbGxEZWYuYW5nbGUgKiBNYXRoLlBJIC8gMTgwOy8vZGVnIHRvIHJhZFxyXG5cdFx0XHJcblx0XHR0aGlzLnggPSBiYWxsRGVmLng7XHJcblx0XHR0aGlzLnkgPSBiYWxsRGVmLnk7XHJcblx0XHRcclxuXHRcdGlmICh0aGlzLm1vdmVTcGVlZCkge1xyXG5cdFx0XHR0aGlzLl9zcGVlZF94ID0gTWF0aC5jb3ModGhpcy5hbmdsZSArIE1hdGguUEkpICogdGhpcy5tb3ZlU3BlZWQ7Ly91aW50OiBweC9zZWNvbmRcclxuXHRcdFx0dGhpcy5fc3BlZWRfeSA9IE1hdGguc2luKHRoaXMuYW5nbGUgKyBNYXRoLlBJKSAqIHRoaXMubW92ZVNwZWVkOy8vdWludDogcHgvc2Vjb25kXHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fc3BlZWRfeCA9IDA7Ly91aW50OiBweC9zZWNvbmRcclxuXHRcdFx0dGhpcy5fc3BlZWRfeSA9IDA7Ly91aW50OiBweC9zZWNvbmRcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5zdGF0ZSA9IHRoaXMuRV9CRUZPUkVfQ1JFQVRFO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgRV9CRUZPUkVfQ1JFQVRFKCkgeyByZXR1cm4gMDsgfVxyXG5cdGdldCBFX0NSRUFURUQoKSB7IHJldHVybiAxOyB9XHJcblx0Z2V0IEVfQkVHSU5fQ09MTElTSU9OKCkgeyByZXR1cm4gMjsgfVxyXG5cdGdldCBFX0VOR19DT0xMSVNJT04oKSB7IHJldHVybiAzOyB9XHJcblx0XHJcblx0LyoqIEBwYXJhbSB7UFdvcmxkfSBwV29ybGQgKi9cclxuXHRjcmVhdGUocFdvcmxkKSB7XHJcblx0XHR0aGlzLnN0YXRlID0gdGhpcy5FX0NSRUFURUQ7XHJcblx0XHRpZiAodGhpcy5jb2xsaXNpb25EZWxheSA+IDApIHtcclxuXHRcdFx0dGhpcy5lbmFibGVQaHlzaWNzID0gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGJlZ2luX2NvbGxpc2lvbigpIHtcclxuXHRcdHRoaXMuZW5hYmxlUGh5c2ljcyA9IHRydWU7XHJcblx0XHR0aGlzLnN0YXRlID0gdGhpcy5FX0JFR0lOX0NPTExJU0lPTjtcclxuXHR9XHJcblx0XHJcblx0ZW5kX2NvbGxpc2lvbigpIHtcclxuXHRcdHRoaXMuZW5hYmxlUGh5c2ljcyA9IGZhbHNlO1xyXG5cdFx0dGhpcy5zdGF0ZSA9IHRoaXMuRV9FTkdfQ09MTElTSU9OO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBkZWJ1Z1xyXG5cdCAqIEBwYXJhbSB7UFdvcmxkfSBwV29ybGRcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXAsIHBXb3JsZCkge1xyXG5cdFx0aWYgKHRoaXMuc3RhdGUgPT0gdGhpcy5FX0JFRk9SRV9DUkVBVEUpIHtcclxuXHRcdFx0dGhpcy5jcmVhdGVEZWxheSAtPSBzdGFtcDtcclxuXHRcdFx0aWYgKHRoaXMuY3JlYXRlRGVsYXkgPD0gMCkge1xyXG5cdFx0XHRcdHRoaXMuY3JlYXRlKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRpZiAodGhpcy5zdGF0ZSA9PSB0aGlzLkVfQ1JFQVRFRCkge1xyXG5cdFx0XHRcdHRoaXMuY29sbGlzaW9uRGVsYXkgLT0gc3RhbXA7XHJcblx0XHRcdFx0aWYgKHRoaXMuY29sbGlzaW9uRGVsYXkgPD0gMCkge1xyXG5cdFx0XHRcdFx0dGhpcy5iZWdpbl9jb2xsaXNpb24oKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5zdGF0ZSA9PSB0aGlzLkVfQkVHSU5fQ09MTElTSU9OKSB7XHJcblx0XHRcdFx0aWYgKHRoaXMuZHVyYXRpb24gPiAwKSB7XHJcblx0XHRcdFx0XHR0aGlzLmR1cmF0aW9uIC09IHN0YW1wO1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuZHVyYXRpb24pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5lbmRfY29sbGlzaW9uKCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGlmICghd2luZG93LiRzdG9wKSB7Ly9kZWJ1Z1xyXG5cdFx0XHRcdHRoaXMueCArPSB0aGlzLl9zcGVlZF94ICogc3RhbXAgLyAxMDAwOy8vZGVidWdcclxuXHRcdFx0XHR0aGlzLnkgKz0gdGhpcy5fc3BlZWRfeSAqIHN0YW1wIC8gMTAwMDsvL2RlYnVnXHJcblx0XHRcdH1cclxuXHRcdFx0dGhpcy5yZW5kZXJlci51cGRhdGUoc3RhbXApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gZW5naW5lXHJcblx0ICovXHJcblx0cmVuZGVyKGVuZ2luZSkge1xyXG5cdFx0aWYgKHRoaXMuc3RhdGUgIT0gdGhpcy5FX0JFRk9SRV9DUkVBVEUpIHtcclxuXHRcdFx0Y29uc3QgZmxpcCA9IHRoaXMuZmxpcDtcclxuXHRcdFx0dGhpcy5yZW5kZXJlci5kcmF3KGVuZ2luZSwgdGhpcy54LCB0aGlzLnksIHRoaXMuYW5nbGUsIGZsaXApO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRnZXQgX0JhbGxEZWZpbml0aW9uKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNb2JTa2lsbEJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcsIF91cmwpIHtcclxuXHRcdHRoaXMuX3JhdyA9IF9yYXc7XHJcblx0XHR0aGlzLl91cmwgPSBfdXJsO1xyXG5cdFx0XHJcblx0XHR0aGlzLmxldmVsID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0dGhpcy5hbmltYXRpb25zID0ge307XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAcGFyYW0ge251bWJlcn0gbGV2ZWwgKi9cclxuXHRhc3luYyBsb2FkKGxldmVsKSB7XHJcblx0XHR0aGlzLmxldmVsID0gbGV2ZWw7XHJcblx0XHRcclxuXHRcdGlmICghdGhpcy5fcmF3ICYmICF0aGlzLl91cmwpIHtcclxuXHRcdFx0dGhpcy5fdXJsID0gW3RoaXMuX2Jhc2VfcGF0aCwgbGV2ZWxdLmpvaW4oXCIvXCIpO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5fcmF3ID0gYXdhaXQgJGdldC5kYXRhKHRoaXMuX3VybCk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZvciAobGV0IG5hbWUgb2YgdGhpcy5fYW5pbWFfbmFtZV9saXN0KSB7XHJcblx0XHRcdC8vbmFtZSA9IFwiYmFsbDBcIjtcclxuXHRcdFx0bGV0IGFuaW1hID0gbmV3IEFuaW1hdGlvbih0aGlzLl9yYXdbbmFtZV0sIFt0aGlzLl91cmwsIG5hbWVdLmpvaW4oXCIvXCIpKTtcclxuXHRcdFx0YW5pbWEuaXNfbG9vcCA9IHRydWU7XHJcblx0XHRcdGFuaW1hLmxvYWQoKTtcclxuXHRcdFx0dGhpcy5hbmltYXRpb25zW25hbWVdID0gYW5pbWE7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAcmV0dXJucyB7dm9pZH0gKi9cclxuXHRpbnZva2UoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHRcclxuXHQvKiogQHJldHVybnMge3N0cmluZ1tdfSAqL1xyXG5cdGdldCBfYW5pbWFfbmFtZV9saXN0KCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblx0XHJcblx0LyoqIEByZXR1cm5zIHtzdHJpbmd9ICovXHJcblx0Z2V0IF9iYXNlX3BhdGgoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxufVxyXG5cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/MobSkill/MobSkillBase.js\n");

/***/ }),

/***/ "./src/game/Physics/Foothold.js":
/*!**************************************!*\
  !*** ./src/game/Physics/Foothold.js ***!
  \**************************************/
/*! exports provided: FootholdChain, FootholdSingle, FootholdChainChild */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FootholdChain\", function() { return FootholdChain; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FootholdSingle\", function() { return FootholdSingle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FootholdChainChild\", function() { return FootholdChainChild; });\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass FootholdChain {\r\n\t/**\r\n\t * @param {number} id\r\n\t */\r\n\tconstructor(id) {\r\n\t\tthis.id = id;\r\n\r\n\t\t/** @type {FootholdSingle[]} */\r\n\t\tthis.footholds = [];\r\n\r\n\t\tthis.bound = new _math_js__WEBPACK_IMPORTED_MODULE_2__[\"Rectangle\"]();\r\n\r\n\t\tthis.loop = false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {FootholdSingle} head - foothold chain head\r\n\t * @param {FootholdSingle[]} map_footholds - map footholds\r\n\t * @param {function} type - foothold constructor\r\n\t */\r\n\tinit(head, map_footholds, type) {\r\n\t\tlet left, top, right, bottom;\r\n\r\n\t\tleft = head.x1;\r\n\t\ttop = head.y1;\r\n\t\tright = head.x2;\r\n\t\tbottom = head.y2;\r\n\r\n\t\tfor (let fh = head, childIndex = 0; fh != null; fh = map_footholds[fh.next], ++childIndex) {\r\n\t\t\tleft = Math.min(left, fh.x1, fh.x2);\r\n\t\t\ttop = Math.min(top, fh.y1, fh.y2);\r\n\t\t\tright = Math.max(right, fh.x1, fh.x2);\r\n\t\t\tbottom = Math.max(bottom, fh.y1, fh.y2);\r\n\r\n\t\t\tthis.footholds.push(fh);\r\n\r\n\t\t\tif (fh.next == head.id) {\r\n\t\t\t\tthis.loop = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.bound.parse(left, top, right, bottom);\r\n\r\n\t\tthis.FootholdType = type;\r\n\r\n\t\tif (type == FootholdSingle) {\r\n\t\t\tthis.footholds.forEach((fh, childIndex) => {\r\n\t\t\t\tfh.init(this, childIndex);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse if (type == FootholdChainChild) {\r\n\t\t\tlet center = this.bound.center;\r\n\t\t\tlet xf = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"]();\r\n\r\n\t\t\txf.SetPositionXY(center.x, center.y);\r\n\r\n\t\t\tthis.footholds.forEach((fh, childIndex) => {\r\n\t\t\t\tfh.init(this, childIndex, xf);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} childIndex\r\n\t * @returns {FootholdChainChild}\r\n\t */\r\n\tgetFootholdFromContact(childIndex) {\r\n\t\treturn this.footholds[childIndex];\r\n\t}\r\n}\r\n\r\nclass FootholdSingle {\r\n\t/**\r\n\t * @param {object} _raw\r\n\t * @param {number} index\r\n\t * @param {number} layerIndex\r\n\t * @param {number} groupIndex\r\n\t */\r\n\tconstructor(_raw, index, layerIndex, groupIndex) {\r\n\t\tthis._raw = _raw;\r\n\r\n\t\t// ground.footholds\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.layer = layerIndex | 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.group = groupIndex | 0;\r\n\r\n\t\t/** @type {number} - in ground.footholds */\r\n\t\tthis.id = index;\r\n\t\t\r\n\t\t/** @type {number} - prev id */\r\n\t\tthis.prev = _raw.prev ? (_raw.prev - 1) : null;\r\n\r\n\t\t/** @type {number} - next id */\r\n\t\tthis.next = _raw.next ? (_raw.next - 1) : null;\r\n\r\n\t\t// chain.footholds\r\n\r\n\t\t/** @type {FootholdChain} */\r\n\t\tthis.chain = null;\r\n\r\n\t\t/** @type {number} - in chain.footholds */\r\n\t\tthis.childIndex = null;\r\n\r\n\t\t// body\r\n\t\t\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.m_angle = 0;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.m_length = 0;\r\n\r\n\t\t// debug\r\n\r\n\t\t/** @type {number} - this和next_fh的夾角 */\r\n\t\tthis.next_a = undefined;\r\n\r\n\t\tthis.next_a_deg = undefined;\r\n\t\t\r\n\t\tthis.$showDebugInfo = false;\r\n\t}\r\n\t\r\n\tgetFootholdFromContact() {\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {FootholdChain} chain\r\n\t * @param {number} childIndex\r\n\t * @param {b2Transform} body_xf\r\n\t */\r\n\tinit(chain, childIndex, body_xf) {\r\n\t\tlet x1, y1, x2, y2;\r\n\t\t\r\n\t\tthis.chain = chain;\r\n\t\tthis.childIndex = childIndex;\r\n\r\n\t\tx1 = this.x1 / $gv.CANVAS_SCALE;\r\n\t\ty1 = this.y1 / $gv.CANVAS_SCALE;\r\n\t\tx2 = this.x2 / $gv.CANVAS_SCALE;\r\n\t\ty2 = this.y2 / $gv.CANVAS_SCALE;\r\n\r\n\t\tconst dx = x2 - x1;\r\n\t\tconst dy = y2 - y1;\r\n\r\n\t\tif (dy == 0) {\r\n\t\t\tthis.m_angle = dx < 0 ? Math.PI : 0;\r\n\t\t\tthis.m_length = dx;\r\n\t\t}\r\n\t\telse if (dx == 0) {\r\n\t\t\tthis.m_angle = dy < 0 ? (-Math.PI * 0.5) : (Math.PI * 0.5);\r\n\t\t\tthis.m_length = dy;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.m_angle = Math.atan2(dy, dx);\r\n\t\t\tthis.m_length = Math.sqrt(dy ** 2 + dx ** 2);\r\n\t\t}\r\n\t}\r\n\r\n\tGetVertex1() {\r\n\t\treturn new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](this.x1 / $gv.CANVAS_SCALE, this.y1 / $gv.CANVAS_SCALE);\r\n\t}\r\n\r\n\tGetVertex2() {\r\n\t\treturn new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](this.x2 / $gv.CANVAS_SCALE, this.y2 / $gv.CANVAS_SCALE);\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tGetWorldCenter() {\r\n\t\treturn this.body.GetWorldCenter();\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {b2Vec2} worldPoint\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLocalPoint(worldPoint, out) {\r\n\t\treturn this.body.GetLocalPoint(worldPoint, out);\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {b2Vec2} worldPoint\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLinearVelocityFromWorldPoint(worldPoint, out) {\r\n\t\treturn this.body.GetLinearVelocityFromWorldPoint(worldPoint, out);\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {b2Vec2} worldVector\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLocalVector(worldVector, out) {\r\n\t\treturn this.body.GetLocalVector(worldVector, out);\r\n\t}\r\n\r\n\t/** @type {FootholdSingle} */\r\n\tget next_fh() {\r\n\t\tconst footholds = this.body.m_world.ground.footholds;\r\n\t\treturn footholds[this.next];\r\n\t}\r\n\t/** @type {FootholdSingle} */\r\n\tget prev_fh() {\r\n\t\tconst footholds = this.body.m_world.ground.footholds;\r\n\t\treturn footholds[this.prev];\r\n\t}\r\n\r\n\t/** @type {number} */\r\n\tget x1() { return this._raw.x1; }\r\n\t/** @type {number} */\r\n\tget y1() { return this._raw.y1; }\r\n\t/** @type {number} */\r\n\tget x2() { return this._raw.x2; }\r\n\t/** @type {number} */\r\n\tget y2() { return this._raw.y2; }\r\n\r\n\tget is_empty() {\r\n\t\treturn this.is_first && this.is_last;\r\n\t}\r\n\tget is_first() {\r\n\t\treturn this._raw.prev == 0;\r\n\t}\r\n\tget is_last() {\r\n\t\treturn this._raw.next == 0;\r\n\t}\r\n\tget is_wall() {\r\n\t\treturn this.x1 == this.x2;\r\n\t}\r\n\tget _is_horizontal_floor() {\r\n\t\treturn this.y1 == this.y2;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CanvasRenderingContext2D} ctx\r\n\t */\r\n\t_drawLine(ctx) {\r\n\t\tctx.beginPath()\r\n\t\tctx.moveTo(this.x1, this.y1);\r\n\t\tctx.lineTo(this.x2, this.y2);\r\n\t\tctx.stroke();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CanvasRenderingContext2D} ctx\r\n\t */\r\n\t_drawLineV01(ctx) {\r\n\t\tif (this.m_hasVertex0) {\r\n\t\t\tctx.beginPath()\r\n\t\t\tctx.moveTo(this.x0, this.y0);\r\n\t\t\tctx.lineTo(this.x1, this.y1);\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CanvasRenderingContext2D} ctx\r\n\t */\r\n\t_drawLineV23(ctx) {\r\n\t\tif (this.m_hasVertex3) {\r\n\t\t\tctx.beginPath()\r\n\t\t\tctx.moveTo(this.x2, this.y2);\r\n\t\t\tctx.lineTo(this.x3, this.y3);\r\n\t\t\tctx.stroke();\r\n\t\t}\r\n\t}\r\n\r\n\t$_text_pos(x1, y1, x2, y2) {\r\n\t\treturn {\r\n\t\t\tx: (x2 + x1) / 2,\r\n\t\t\ty: Math.max(y2, y1),\r\n\t\t};\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t$drawDebugInfo(renderer) {\r\n\t\tconst ctx = renderer.ctx;\r\n\t\tconst fh = this;\r\n\t\tconst text = `[${fh.id}](${fh.x1}, ${fh.y1})[${fh.group}]{${fh._raw.piece}}∠${fh.next_a_deg}`;\r\n\r\n\t\tconst ta = ctx.textAlign, tb = ctx.textBaseline;\r\n\t\tconst tp = this.$_text_pos(fh.x1, fh.y1, fh.x2, fh.y2);\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.textBaseline = \"top\";\r\n\r\n\t\tctx.lineWidth = 5;\r\n\t\tctx.strokeStyle = \"#000\";\r\n\t\tfh._drawLine(ctx);\r\n\r\n\t\tctx.lineWidth = 2.5;\r\n\t\tctx.strokeStyle = \"#FF00FF\";\r\n\t\tfh._drawLine(ctx);\r\n\r\n\t\tctx.lineWidth = 2.5;\r\n\t\tctx.strokeStyle = \"#000\";\r\n\t\tctx.strokeText(text, tp.x, tp.y);\r\n\r\n\t\tctx.fillStyle = \"#FFF\";\r\n\t\tctx.fillText(text, tp.x, tp.y);\r\n\r\n\t\t//ctx.fillText(`[${fh.piece}][1](${fh.x2}, ${fh.y2})`, fh.x2, fh.y2);\r\n\r\n\t\tctx.textAlign = ta;\r\n\t\tctx.textBaseline = tb;\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} color\r\n\t */\r\n\t$drawDebugInfo2(renderer, color) {\r\n\t\tconst ctx = renderer.ctx;\r\n\t\tconst fh = this;\r\n\t\tconst text = `${fh.prev}<${fh.id}>${fh.next} C{${fh.chain.id}} (${fh.x1}, ${fh.y1})(${fh.x2}, ${fh.y2}) L[${fh.layer}] G[${fh.group}] P{${fh._raw.piece}}∠${fh.next_a_deg}`;\r\n\r\n\t\tlet ta = ctx.textAlign, tb = ctx.textBaseline;\r\n\t\tconst tp = this.$_text_pos(fh.x1, fh.y1, fh.x2, fh.y2);\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.textBaseline = \"top\";\r\n\r\n\t\tctx.lineWidth = 5;\r\n\t\tctx.strokeStyle = \"#000\";\r\n\t\tfh._drawLine(ctx);\r\n\r\n\t\tctx.lineWidth = 2.5;\r\n\t\tctx.strokeStyle = color || \"#FF00FF\";\r\n\t\tfh._drawLine(ctx);\r\n\t\t\r\n\t\t//ctx.strokeStyle = \"#FF0\";\r\n\t\t//fh._drawLineV01(ctx);\r\n\t\t//fh._drawLineV23(ctx);\r\n\r\n\t\tctx.lineWidth = 2.5;\r\n\t\tctx.strokeStyle = \"#000\";\r\n\t\tctx.strokeText(text, tp.x, tp.y);\r\n\r\n\t\tctx.fillStyle = \"#FFF\";\r\n\t\tctx.fillText(text, tp.x, tp.y);\r\n\r\n\t\t//ctx.fillText(`[${fh.piece}][1](${fh.x2}, ${fh.y2})`, fh.x2, fh.y2);\r\n\r\n\t\tctx.textAlign = ta;\r\n\t\tctx.textBaseline = tb;\r\n\t}\r\n}\r\n\r\nclass FootholdChainChild extends FootholdSingle {\r\n\tconstructor(_raw, index, layerIndex, groupIndex) {\r\n\t\tsuper(_raw, index, layerIndex, groupIndex);\r\n\r\n\t\t/** @type {b2Transform} - local */\r\n\t\tthis.m_xf = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"]();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {FootholdChain} chain\r\n\t * @param {number} childIndex\r\n\t * @param {b2Transform} body_xf\r\n\t */\r\n\tinit(chain, childIndex, body_xf) {\r\n\t\tsuper.init(chain, childIndex, body_xf);\r\n\t\t\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].AddVV(this.GetVertex1(), this.GetVertex2(), this.m_xf.p);\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].MulVS(this.m_xf.p, 0.5, this.m_xf.p);\r\n\t\tthis.m_xf.SetRotationAngle(this.m_angle);\r\n\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"].MulTXX(this.m_xf, body_xf, this.m_xf);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @override\r\n\t */\r\n\tGetWorldCenter() {\r\n\t\tconst xf = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"]();\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"].MulXX(this.m_xf, this.body.m_xf, xf);\r\n\t\treturn xf.p;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {b2Vec2} worldPoint\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLocalPoint(worldPoint, out) {\r\n\t\tconst xf = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"]();\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"].MulXX(this.m_xf, this.body.m_xf, xf);\r\n\t\treturn _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"].MulTXV(xf, worldPoint, out);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {b2Vec2} worldPoint\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLinearVelocityFromWorldPoint(worldPoint, out) {\r\n\t\tconst body = this.body;\r\n\t\treturn _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].AddVCrossSV(body.m_linearVelocity, body.m_angularVelocity, _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].SubVV(worldPoint, this.GetWorldCenter(), _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].s_t0), out);\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {b2Vec2} worldVector\r\n\t * @param {b2Vec2} out\r\n\t */\r\n\tGetLocalVector(worldVector, out) {\r\n\t\tconst xf = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"]();\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Transform\"].MulXX(this.m_xf, this.body.m_xf, xf);\r\n\t\treturn _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Rot\"].MulTRV(xf.q, worldVector, out);\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL0Zvb3Rob2xkLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUGh5c2ljcy9Gb290aG9sZC5qcz8zN2YzIl0sInNvdXJjZXNDb250ZW50IjpbIu+7v1xyXG5pbXBvcnQge1xyXG5cdGIyVmVjMiwgYjJUcmFuc2Zvcm0sIGIyUm90LFxyXG5cdGIyQm9keSwgYjJGaXh0dXJlLFxyXG5cdGIyQ29udGFjdCxcclxufSBmcm9tIFwiLi9QaHlzaWNzLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBJUmVuZGVyZXIgfSBmcm9tIFwiLi4vSVJlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IFJlY3RhbmdsZSB9IGZyb20gXCIuLi9tYXRoLmpzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEZvb3Rob2xkQ2hhaW4ge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBpZFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGlkKSB7XHJcblx0XHR0aGlzLmlkID0gaWQ7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtGb290aG9sZFNpbmdsZVtdfSAqL1xyXG5cdFx0dGhpcy5mb290aG9sZHMgPSBbXTtcclxuXHJcblx0XHR0aGlzLmJvdW5kID0gbmV3IFJlY3RhbmdsZSgpO1xyXG5cclxuXHRcdHRoaXMubG9vcCA9IGZhbHNlO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0Zvb3Rob2xkU2luZ2xlfSBoZWFkIC0gZm9vdGhvbGQgY2hhaW4gaGVhZFxyXG5cdCAqIEBwYXJhbSB7Rm9vdGhvbGRTaW5nbGVbXX0gbWFwX2Zvb3Rob2xkcyAtIG1hcCBmb290aG9sZHNcclxuXHQgKiBAcGFyYW0ge2Z1bmN0aW9ufSB0eXBlIC0gZm9vdGhvbGQgY29uc3RydWN0b3JcclxuXHQgKi9cclxuXHRpbml0KGhlYWQsIG1hcF9mb290aG9sZHMsIHR5cGUpIHtcclxuXHRcdGxldCBsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b207XHJcblxyXG5cdFx0bGVmdCA9IGhlYWQueDE7XHJcblx0XHR0b3AgPSBoZWFkLnkxO1xyXG5cdFx0cmlnaHQgPSBoZWFkLngyO1xyXG5cdFx0Ym90dG9tID0gaGVhZC55MjtcclxuXHJcblx0XHRmb3IgKGxldCBmaCA9IGhlYWQsIGNoaWxkSW5kZXggPSAwOyBmaCAhPSBudWxsOyBmaCA9IG1hcF9mb290aG9sZHNbZmgubmV4dF0sICsrY2hpbGRJbmRleCkge1xyXG5cdFx0XHRsZWZ0ID0gTWF0aC5taW4obGVmdCwgZmgueDEsIGZoLngyKTtcclxuXHRcdFx0dG9wID0gTWF0aC5taW4odG9wLCBmaC55MSwgZmgueTIpO1xyXG5cdFx0XHRyaWdodCA9IE1hdGgubWF4KHJpZ2h0LCBmaC54MSwgZmgueDIpO1xyXG5cdFx0XHRib3R0b20gPSBNYXRoLm1heChib3R0b20sIGZoLnkxLCBmaC55Mik7XHJcblxyXG5cdFx0XHR0aGlzLmZvb3Rob2xkcy5wdXNoKGZoKTtcclxuXHJcblx0XHRcdGlmIChmaC5uZXh0ID09IGhlYWQuaWQpIHtcclxuXHRcdFx0XHR0aGlzLmxvb3AgPSB0cnVlO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy5ib3VuZC5wYXJzZShsZWZ0LCB0b3AsIHJpZ2h0LCBib3R0b20pO1xyXG5cclxuXHRcdHRoaXMuRm9vdGhvbGRUeXBlID0gdHlwZTtcclxuXHJcblx0XHRpZiAodHlwZSA9PSBGb290aG9sZFNpbmdsZSkge1xyXG5cdFx0XHR0aGlzLmZvb3Rob2xkcy5mb3JFYWNoKChmaCwgY2hpbGRJbmRleCkgPT4ge1xyXG5cdFx0XHRcdGZoLmluaXQodGhpcywgY2hpbGRJbmRleCk7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodHlwZSA9PSBGb290aG9sZENoYWluQ2hpbGQpIHtcclxuXHRcdFx0bGV0IGNlbnRlciA9IHRoaXMuYm91bmQuY2VudGVyO1xyXG5cdFx0XHRsZXQgeGYgPSBuZXcgYjJUcmFuc2Zvcm0oKTtcclxuXHJcblx0XHRcdHhmLlNldFBvc2l0aW9uWFkoY2VudGVyLngsIGNlbnRlci55KTtcclxuXHJcblx0XHRcdHRoaXMuZm9vdGhvbGRzLmZvckVhY2goKGZoLCBjaGlsZEluZGV4KSA9PiB7XHJcblx0XHRcdFx0ZmguaW5pdCh0aGlzLCBjaGlsZEluZGV4LCB4Zik7XHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY2hpbGRJbmRleFxyXG5cdCAqIEByZXR1cm5zIHtGb290aG9sZENoYWluQ2hpbGR9XHJcblx0ICovXHJcblx0Z2V0Rm9vdGhvbGRGcm9tQ29udGFjdChjaGlsZEluZGV4KSB7XHJcblx0XHRyZXR1cm4gdGhpcy5mb290aG9sZHNbY2hpbGRJbmRleF07XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRm9vdGhvbGRTaW5nbGUge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBfcmF3XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGluZGV4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxheWVySW5kZXhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZ3JvdXBJbmRleFxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKF9yYXcsIGluZGV4LCBsYXllckluZGV4LCBncm91cEluZGV4KSB7XHJcblx0XHR0aGlzLl9yYXcgPSBfcmF3O1xyXG5cclxuXHRcdC8vIGdyb3VuZC5mb290aG9sZHNcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMubGF5ZXIgPSBsYXllckluZGV4IHwgMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuZ3JvdXAgPSBncm91cEluZGV4IHwgMDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBpbiBncm91bmQuZm9vdGhvbGRzICovXHJcblx0XHR0aGlzLmlkID0gaW5kZXg7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHByZXYgaWQgKi9cclxuXHRcdHRoaXMucHJldiA9IF9yYXcucHJldiA/IChfcmF3LnByZXYgLSAxKSA6IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gbmV4dCBpZCAqL1xyXG5cdFx0dGhpcy5uZXh0ID0gX3Jhdy5uZXh0ID8gKF9yYXcubmV4dCAtIDEpIDogbnVsbDtcclxuXHJcblx0XHQvLyBjaGFpbi5mb290aG9sZHNcclxuXHJcblx0XHQvKiogQHR5cGUge0Zvb3Rob2xkQ2hhaW59ICovXHJcblx0XHR0aGlzLmNoYWluID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBpbiBjaGFpbi5mb290aG9sZHMgKi9cclxuXHRcdHRoaXMuY2hpbGRJbmRleCA9IG51bGw7XHJcblxyXG5cdFx0Ly8gYm9keVxyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge2IyQm9keX0gKi9cclxuXHRcdHRoaXMuYm9keSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLm1fYW5nbGUgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5tX2xlbmd0aCA9IDA7XHJcblxyXG5cdFx0Ly8gZGVidWdcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSB0aGlz5ZKMbmV4dF9maOeahOWkvuinkiAqL1xyXG5cdFx0dGhpcy5uZXh0X2EgPSB1bmRlZmluZWQ7XHJcblxyXG5cdFx0dGhpcy5uZXh0X2FfZGVnID0gdW5kZWZpbmVkO1xyXG5cdFx0XHJcblx0XHR0aGlzLiRzaG93RGVidWdJbmZvID0gZmFsc2U7XHJcblx0fVxyXG5cdFxyXG5cdGdldEZvb3Rob2xkRnJvbUNvbnRhY3QoKSB7XHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Rm9vdGhvbGRDaGFpbn0gY2hhaW5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY2hpbGRJbmRleFxyXG5cdCAqIEBwYXJhbSB7YjJUcmFuc2Zvcm19IGJvZHlfeGZcclxuXHQgKi9cclxuXHRpbml0KGNoYWluLCBjaGlsZEluZGV4LCBib2R5X3hmKSB7XHJcblx0XHRsZXQgeDEsIHkxLCB4MiwgeTI7XHJcblx0XHRcclxuXHRcdHRoaXMuY2hhaW4gPSBjaGFpbjtcclxuXHRcdHRoaXMuY2hpbGRJbmRleCA9IGNoaWxkSW5kZXg7XHJcblxyXG5cdFx0eDEgPSB0aGlzLngxIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdHkxID0gdGhpcy55MSAvICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHR4MiA9IHRoaXMueDIgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0eTIgPSB0aGlzLnkyIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHJcblx0XHRjb25zdCBkeCA9IHgyIC0geDE7XHJcblx0XHRjb25zdCBkeSA9IHkyIC0geTE7XHJcblxyXG5cdFx0aWYgKGR5ID09IDApIHtcclxuXHRcdFx0dGhpcy5tX2FuZ2xlID0gZHggPCAwID8gTWF0aC5QSSA6IDA7XHJcblx0XHRcdHRoaXMubV9sZW5ndGggPSBkeDtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKGR4ID09IDApIHtcclxuXHRcdFx0dGhpcy5tX2FuZ2xlID0gZHkgPCAwID8gKC1NYXRoLlBJICogMC41KSA6IChNYXRoLlBJICogMC41KTtcclxuXHRcdFx0dGhpcy5tX2xlbmd0aCA9IGR5O1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMubV9hbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTtcclxuXHRcdFx0dGhpcy5tX2xlbmd0aCA9IE1hdGguc3FydChkeSAqKiAyICsgZHggKiogMik7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRHZXRWZXJ0ZXgxKCkge1xyXG5cdFx0cmV0dXJuIG5ldyBiMlZlYzIodGhpcy54MSAvICRndi5DQU5WQVNfU0NBTEUsIHRoaXMueTEgLyAkZ3YuQ0FOVkFTX1NDQUxFKTtcclxuXHR9XHJcblxyXG5cdEdldFZlcnRleDIoKSB7XHJcblx0XHRyZXR1cm4gbmV3IGIyVmVjMih0aGlzLngyIC8gJGd2LkNBTlZBU19TQ0FMRSwgdGhpcy55MiAvICRndi5DQU5WQVNfU0NBTEUpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHRHZXRXb3JsZENlbnRlcigpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvZHkuR2V0V29ybGRDZW50ZXIoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHBhcmFtIHtiMlZlYzJ9IHdvcmxkUG9pbnRcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gb3V0XHJcblx0ICovXHJcblx0R2V0TG9jYWxQb2ludCh3b3JsZFBvaW50LCBvdXQpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvZHkuR2V0TG9jYWxQb2ludCh3b3JsZFBvaW50LCBvdXQpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gd29ybGRQb2ludFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBvdXRcclxuXHQgKi9cclxuXHRHZXRMaW5lYXJWZWxvY2l0eUZyb21Xb3JsZFBvaW50KHdvcmxkUG9pbnQsIG91dCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuYm9keS5HZXRMaW5lYXJWZWxvY2l0eUZyb21Xb3JsZFBvaW50KHdvcmxkUG9pbnQsIG91dCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSB3b3JsZFZlY3RvclxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBvdXRcclxuXHQgKi9cclxuXHRHZXRMb2NhbFZlY3Rvcih3b3JsZFZlY3Rvciwgb3V0KSB7XHJcblx0XHRyZXR1cm4gdGhpcy5ib2R5LkdldExvY2FsVmVjdG9yKHdvcmxkVmVjdG9yLCBvdXQpO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtGb290aG9sZFNpbmdsZX0gKi9cclxuXHRnZXQgbmV4dF9maCgpIHtcclxuXHRcdGNvbnN0IGZvb3Rob2xkcyA9IHRoaXMuYm9keS5tX3dvcmxkLmdyb3VuZC5mb290aG9sZHM7XHJcblx0XHRyZXR1cm4gZm9vdGhvbGRzW3RoaXMubmV4dF07XHJcblx0fVxyXG5cdC8qKiBAdHlwZSB7Rm9vdGhvbGRTaW5nbGV9ICovXHJcblx0Z2V0IHByZXZfZmgoKSB7XHJcblx0XHRjb25zdCBmb290aG9sZHMgPSB0aGlzLmJvZHkubV93b3JsZC5ncm91bmQuZm9vdGhvbGRzO1xyXG5cdFx0cmV0dXJuIGZvb3Rob2xkc1t0aGlzLnByZXZdO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IHgxKCkgeyByZXR1cm4gdGhpcy5fcmF3LngxOyB9XHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IHkxKCkgeyByZXR1cm4gdGhpcy5fcmF3LnkxOyB9XHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IHgyKCkgeyByZXR1cm4gdGhpcy5fcmF3LngyOyB9XHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0Z2V0IHkyKCkgeyByZXR1cm4gdGhpcy5fcmF3LnkyOyB9XHJcblxyXG5cdGdldCBpc19lbXB0eSgpIHtcclxuXHRcdHJldHVybiB0aGlzLmlzX2ZpcnN0ICYmIHRoaXMuaXNfbGFzdDtcclxuXHR9XHJcblx0Z2V0IGlzX2ZpcnN0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jhdy5wcmV2ID09IDA7XHJcblx0fVxyXG5cdGdldCBpc19sYXN0KCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX3Jhdy5uZXh0ID09IDA7XHJcblx0fVxyXG5cdGdldCBpc193YWxsKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMueDEgPT0gdGhpcy54MjtcclxuXHR9XHJcblx0Z2V0IF9pc19ob3Jpem9udGFsX2Zsb29yKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMueTEgPT0gdGhpcy55MjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHhcclxuXHQgKi9cclxuXHRfZHJhd0xpbmUoY3R4KSB7XHJcblx0XHRjdHguYmVnaW5QYXRoKClcclxuXHRcdGN0eC5tb3ZlVG8odGhpcy54MSwgdGhpcy55MSk7XHJcblx0XHRjdHgubGluZVRvKHRoaXMueDIsIHRoaXMueTIpO1xyXG5cdFx0Y3R4LnN0cm9rZSgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eFxyXG5cdCAqL1xyXG5cdF9kcmF3TGluZVYwMShjdHgpIHtcclxuXHRcdGlmICh0aGlzLm1faGFzVmVydGV4MCkge1xyXG5cdFx0XHRjdHguYmVnaW5QYXRoKClcclxuXHRcdFx0Y3R4Lm1vdmVUbyh0aGlzLngwLCB0aGlzLnkwKTtcclxuXHRcdFx0Y3R4LmxpbmVUbyh0aGlzLngxLCB0aGlzLnkxKTtcclxuXHRcdFx0Y3R4LnN0cm9rZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eFxyXG5cdCAqL1xyXG5cdF9kcmF3TGluZVYyMyhjdHgpIHtcclxuXHRcdGlmICh0aGlzLm1faGFzVmVydGV4Mykge1xyXG5cdFx0XHRjdHguYmVnaW5QYXRoKClcclxuXHRcdFx0Y3R4Lm1vdmVUbyh0aGlzLngyLCB0aGlzLnkyKTtcclxuXHRcdFx0Y3R4LmxpbmVUbyh0aGlzLngzLCB0aGlzLnkzKTtcclxuXHRcdFx0Y3R4LnN0cm9rZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0JF90ZXh0X3Bvcyh4MSwgeTEsIHgyLCB5Mikge1xyXG5cdFx0cmV0dXJuIHtcclxuXHRcdFx0eDogKHgyICsgeDEpIC8gMixcclxuXHRcdFx0eTogTWF0aC5tYXgoeTIsIHkxKSxcclxuXHRcdH07XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdCRkcmF3RGVidWdJbmZvKHJlbmRlcmVyKSB7XHJcblx0XHRjb25zdCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHRjb25zdCBmaCA9IHRoaXM7XHJcblx0XHRjb25zdCB0ZXh0ID0gYFske2ZoLmlkfV0oJHtmaC54MX0sICR7ZmgueTF9KVske2ZoLmdyb3VwfV17JHtmaC5fcmF3LnBpZWNlfX3iiKAke2ZoLm5leHRfYV9kZWd9YDtcclxuXHJcblx0XHRjb25zdCB0YSA9IGN0eC50ZXh0QWxpZ24sIHRiID0gY3R4LnRleHRCYXNlbGluZTtcclxuXHRcdGNvbnN0IHRwID0gdGhpcy4kX3RleHRfcG9zKGZoLngxLCBmaC55MSwgZmgueDIsIGZoLnkyKTtcclxuXHRcdGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG5cdFx0Y3R4LnRleHRCYXNlbGluZSA9IFwidG9wXCI7XHJcblxyXG5cdFx0Y3R4LmxpbmVXaWR0aCA9IDU7XHJcblx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiMwMDBcIjtcclxuXHRcdGZoLl9kcmF3TGluZShjdHgpO1xyXG5cclxuXHRcdGN0eC5saW5lV2lkdGggPSAyLjU7XHJcblx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiNGRjAwRkZcIjtcclxuXHRcdGZoLl9kcmF3TGluZShjdHgpO1xyXG5cclxuXHRcdGN0eC5saW5lV2lkdGggPSAyLjU7XHJcblx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiMwMDBcIjtcclxuXHRcdGN0eC5zdHJva2VUZXh0KHRleHQsIHRwLngsIHRwLnkpO1xyXG5cclxuXHRcdGN0eC5maWxsU3R5bGUgPSBcIiNGRkZcIjtcclxuXHRcdGN0eC5maWxsVGV4dCh0ZXh0LCB0cC54LCB0cC55KTtcclxuXHJcblx0XHQvL2N0eC5maWxsVGV4dChgWyR7ZmgucGllY2V9XVsxXSgke2ZoLngyfSwgJHtmaC55Mn0pYCwgZmgueDIsIGZoLnkyKTtcclxuXHJcblx0XHRjdHgudGV4dEFsaWduID0gdGE7XHJcblx0XHRjdHgudGV4dEJhc2VsaW5lID0gdGI7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBjb2xvclxyXG5cdCAqL1xyXG5cdCRkcmF3RGVidWdJbmZvMihyZW5kZXJlciwgY29sb3IpIHtcclxuXHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHRcdGNvbnN0IGZoID0gdGhpcztcclxuXHRcdGNvbnN0IHRleHQgPSBgJHtmaC5wcmV2fTwke2ZoLmlkfT4ke2ZoLm5leHR9IEN7JHtmaC5jaGFpbi5pZH19ICgke2ZoLngxfSwgJHtmaC55MX0pKCR7ZmgueDJ9LCAke2ZoLnkyfSkgTFske2ZoLmxheWVyfV0gR1ske2ZoLmdyb3VwfV0gUHske2ZoLl9yYXcucGllY2V9feKIoCR7ZmgubmV4dF9hX2RlZ31gO1xyXG5cclxuXHRcdGxldCB0YSA9IGN0eC50ZXh0QWxpZ24sIHRiID0gY3R4LnRleHRCYXNlbGluZTtcclxuXHRcdGNvbnN0IHRwID0gdGhpcy4kX3RleHRfcG9zKGZoLngxLCBmaC55MSwgZmgueDIsIGZoLnkyKTtcclxuXHRcdGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG5cdFx0Y3R4LnRleHRCYXNlbGluZSA9IFwidG9wXCI7XHJcblxyXG5cdFx0Y3R4LmxpbmVXaWR0aCA9IDU7XHJcblx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiMwMDBcIjtcclxuXHRcdGZoLl9kcmF3TGluZShjdHgpO1xyXG5cclxuXHRcdGN0eC5saW5lV2lkdGggPSAyLjU7XHJcblx0XHRjdHguc3Ryb2tlU3R5bGUgPSBjb2xvciB8fCBcIiNGRjAwRkZcIjtcclxuXHRcdGZoLl9kcmF3TGluZShjdHgpO1xyXG5cdFx0XHJcblx0XHQvL2N0eC5zdHJva2VTdHlsZSA9IFwiI0ZGMFwiO1xyXG5cdFx0Ly9maC5fZHJhd0xpbmVWMDEoY3R4KTtcclxuXHRcdC8vZmguX2RyYXdMaW5lVjIzKGN0eCk7XHJcblxyXG5cdFx0Y3R4LmxpbmVXaWR0aCA9IDIuNTtcclxuXHRcdGN0eC5zdHJva2VTdHlsZSA9IFwiIzAwMFwiO1xyXG5cdFx0Y3R4LnN0cm9rZVRleHQodGV4dCwgdHAueCwgdHAueSk7XHJcblxyXG5cdFx0Y3R4LmZpbGxTdHlsZSA9IFwiI0ZGRlwiO1xyXG5cdFx0Y3R4LmZpbGxUZXh0KHRleHQsIHRwLngsIHRwLnkpO1xyXG5cclxuXHRcdC8vY3R4LmZpbGxUZXh0KGBbJHtmaC5waWVjZX1dWzFdKCR7ZmgueDJ9LCAke2ZoLnkyfSlgLCBmaC54MiwgZmgueTIpO1xyXG5cclxuXHRcdGN0eC50ZXh0QWxpZ24gPSB0YTtcclxuXHRcdGN0eC50ZXh0QmFzZWxpbmUgPSB0YjtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGb290aG9sZENoYWluQ2hpbGQgZXh0ZW5kcyBGb290aG9sZFNpbmdsZSB7XHJcblx0Y29uc3RydWN0b3IoX3JhdywgaW5kZXgsIGxheWVySW5kZXgsIGdyb3VwSW5kZXgpIHtcclxuXHRcdHN1cGVyKF9yYXcsIGluZGV4LCBsYXllckluZGV4LCBncm91cEluZGV4KTtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyVHJhbnNmb3JtfSAtIGxvY2FsICovXHJcblx0XHR0aGlzLm1feGYgPSBuZXcgYjJUcmFuc2Zvcm0oKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Rm9vdGhvbGRDaGFpbn0gY2hhaW5cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY2hpbGRJbmRleFxyXG5cdCAqIEBwYXJhbSB7YjJUcmFuc2Zvcm19IGJvZHlfeGZcclxuXHQgKi9cclxuXHRpbml0KGNoYWluLCBjaGlsZEluZGV4LCBib2R5X3hmKSB7XHJcblx0XHRzdXBlci5pbml0KGNoYWluLCBjaGlsZEluZGV4LCBib2R5X3hmKTtcclxuXHRcdFxyXG5cdFx0YjJWZWMyLkFkZFZWKHRoaXMuR2V0VmVydGV4MSgpLCB0aGlzLkdldFZlcnRleDIoKSwgdGhpcy5tX3hmLnApO1xyXG5cdFx0YjJWZWMyLk11bFZTKHRoaXMubV94Zi5wLCAwLjUsIHRoaXMubV94Zi5wKTtcclxuXHRcdHRoaXMubV94Zi5TZXRSb3RhdGlvbkFuZ2xlKHRoaXMubV9hbmdsZSk7XHJcblxyXG5cdFx0YjJUcmFuc2Zvcm0uTXVsVFhYKHRoaXMubV94ZiwgYm9keV94ZiwgdGhpcy5tX3hmKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICovXHJcblx0R2V0V29ybGRDZW50ZXIoKSB7XHJcblx0XHRjb25zdCB4ZiA9IG5ldyBiMlRyYW5zZm9ybSgpO1xyXG5cdFx0YjJUcmFuc2Zvcm0uTXVsWFgodGhpcy5tX3hmLCB0aGlzLmJvZHkubV94ZiwgeGYpO1xyXG5cdFx0cmV0dXJuIHhmLnA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gd29ybGRQb2ludFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBvdXRcclxuXHQgKi9cclxuXHRHZXRMb2NhbFBvaW50KHdvcmxkUG9pbnQsIG91dCkge1xyXG5cdFx0Y29uc3QgeGYgPSBuZXcgYjJUcmFuc2Zvcm0oKTtcclxuXHRcdGIyVHJhbnNmb3JtLk11bFhYKHRoaXMubV94ZiwgdGhpcy5ib2R5Lm1feGYsIHhmKTtcclxuXHRcdHJldHVybiBiMlRyYW5zZm9ybS5NdWxUWFYoeGYsIHdvcmxkUG9pbnQsIG91dCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gd29ybGRQb2ludFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBvdXRcclxuXHQgKi9cclxuXHRHZXRMaW5lYXJWZWxvY2l0eUZyb21Xb3JsZFBvaW50KHdvcmxkUG9pbnQsIG91dCkge1xyXG5cdFx0Y29uc3QgYm9keSA9IHRoaXMuYm9keTtcclxuXHRcdHJldHVybiBiMlZlYzIuQWRkVkNyb3NzU1YoYm9keS5tX2xpbmVhclZlbG9jaXR5LCBib2R5Lm1fYW5ndWxhclZlbG9jaXR5LCBiMlZlYzIuU3ViVlYod29ybGRQb2ludCwgdGhpcy5HZXRXb3JsZENlbnRlcigpLCBiMlZlYzIuc190MCksIG91dCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gd29ybGRWZWN0b3JcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gb3V0XHJcblx0ICovXHJcblx0R2V0TG9jYWxWZWN0b3Iod29ybGRWZWN0b3IsIG91dCkge1xyXG5cdFx0Y29uc3QgeGYgPSBuZXcgYjJUcmFuc2Zvcm0oKTtcclxuXHRcdGIyVHJhbnNmb3JtLk11bFhYKHRoaXMubV94ZiwgdGhpcy5ib2R5Lm1feGYsIHhmKTtcclxuXHRcdHJldHVybiBiMlJvdC5NdWxUUlYoeGYucSwgd29ybGRWZWN0b3IsIG91dCk7XHJcblx0fVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Physics/Foothold.js\n");

/***/ }),

/***/ "./src/game/Physics/Ground.js":
/*!************************************!*\
  !*** ./src/game/Physics/Ground.js ***!
  \************************************/
/*! exports provided: Foothold, Ground */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Foothold\", function() { return Foothold; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Ground\", function() { return Ground; });\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _World_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./World.js */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _Foothold_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Foothold.js */ \"./src/game/Physics/Foothold.js\");\n/* harmony import */ var _PPlayer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Filter_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Filter.js */ \"./src/game/Physics/Filter.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst Foothold = _Foothold_js__WEBPACK_IMPORTED_MODULE_3__[\"FootholdSingle\"];\r\n//export const Foothold = FootholdChainChild;\r\n\r\n\r\n/**\r\n * 可以防止player卡在foothold裡面\r\n */\r\nwindow.CREATE_SOLID_FOOTHOLD = false;\r\n/**\r\n * polygon + edge\r\n */\r\nwindow.CREATE_SOLID_AND_EDGE_FOOTHOLD = false;\r\n\r\n/**\r\n * b2EdgeShape ghost vertex\r\n */\r\nwindow.USE_GHOST_VERTEX = true;\r\n\r\nwindow.FOOTHOLD_IS_BULLET = true;\r\n\r\n/**\r\n * @param {number} left\r\n * @param {number} right\r\n * @param {number} interpolater - 0~1\r\n */\r\nfunction lerp(left, right, interpolater) {\r\n\treturn left + interpolater * (right - left);\r\n}\r\n\r\nclass Ground {\r\n\tconstructor() {\r\n\t\t/** @type {b2Body[]} */\r\n\t\tthis.bodies = null;\r\n\r\n\t\t/** @type {Foothold[]} */\r\n\t\tthis.footholds = null;\r\n\t\t\r\n\t\t/** @type {Rectangle[]} */\r\n\t\tthis.rectChains = null;\r\n\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.footholds = [];\r\n\t\tthis.bodies = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {object} data\r\n\t * @param {World} world\r\n\t */\r\n\tload(map_raw_data, world) {\r\n\t\tif (!(\"foothold\" in map_raw_data)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfor (let layerIndex in map_raw_data.foothold) {\r\n\t\t\tlet groups = map_raw_data.foothold[layerIndex];\r\n\r\n\t\t\t//foothold[5] maybe is Bounding-Box(loop line)\r\n\r\n\t\t\tfor (let groupIndex in groups) {\r\n\t\t\t\tlet segment = groups[groupIndex];\r\n\t\t\t\tfor (let k in segment) {\r\n\t\t\t\t\tconst index = k - 1;\r\n\r\n\t\t\t\t\tlet fh = new Foothold(segment[k], index, layerIndex, groupIndex);\r\n\r\n\t\t\t\t\tthis.footholds[index] = fh;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** @type {FootholdChain[]} */\r\n\t\tlet chains = [];\r\n\r\n\t\tlet chainId = 0;\r\n\t\tlet rectChains = this.rectChains = [];\r\n\r\n\t\tfor (let i = 0; i < this.footholds.length; ++i) {\r\n\t\t\tconst foothold = this.footholds[i];\r\n\t\t\t\r\n\t\t\tif (foothold.chain == null) {\r\n\t\t\t\t/** @type {foothold} */\r\n\t\t\t\tlet head;\r\n\r\n\t\t\t\t//find head\r\n\t\t\t\tfor (let fh = foothold; fh != null; fh = this.footholds[fh.prev]) {\r\n\t\t\t\t\tif (fh.prev != null && fh.prev == foothold.id) {\r\n\t\t\t\t\t\thead = fh;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!head) {\r\n\t\t\t\t\thead = foothold;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet chain = new _Foothold_js__WEBPACK_IMPORTED_MODULE_3__[\"FootholdChain\"](chainId);\r\n\r\n\t\t\t\tchain.init(head, this.footholds, Foothold);\r\n\r\n\t\t\t\tif (Foothold == _Foothold_js__WEBPACK_IMPORTED_MODULE_3__[\"FootholdSingle\"]) {\r\n\t\t\t\t\tif (window.CREATE_SOLID_AND_EDGE_FOOTHOLD) {\r\n\t\t\t\t\t\tthis._create_foothold(world, chain, false);//edge\r\n\t\t\t\t\t\tthis._create_foothold(world, chain, true);//polygon\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis._create_foothold(world, chain, window.CREATE_SOLID_FOOTHOLD);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (Foothold == _Foothold_js__WEBPACK_IMPORTED_MODULE_3__[\"FootholdChainChild\"]) {\r\n\t\t\t\t\tthis._create_chain(world, chain);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tchains.push(chain);\r\n\r\n\t\t\t\trectChains[chainId] = chain.bound;\r\n\t\t\t\t\r\n\t\t\t\tchainId++;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @param {FootholdChain} chain\r\n\t */\r\n\t_create_chain(world, chain) {\r\n\t\t/** @type {b2Body} */\r\n\t\tlet body;\r\n\r\n\t\t/** @type {b2ChainShape} */\r\n\t\tlet shape;\r\n\r\n\t\t{\r\n\t\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\r\n\t\t\tconst center = chain.bound.center;\r\n\r\n\t\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_kinematicBody;//可移動\r\n\t\t\tbdef.position.Set(center.x / $gv.CANVAS_SCALE, center.y / $gv.CANVAS_SCALE);\r\n\t\t\tbdef.angle = 0;\r\n\t\t\tbdef.gravityScale = 0;\r\n\t\t\tbdef.linearDamping = 1;\r\n\t\t\tbdef.bullet = true;\r\n\t\t\tbdef.userData = this;\r\n\r\n\t\t\tbody = world.CreateBody(bdef);\r\n\t\t\tbody.$type = \"ground\";\r\n\r\n\t\t\tthis.bodies.push(body);\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tshape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ChainShape\"]();\r\n\r\n\t\t\t/** @type {b2Vec2[]} */\r\n\t\t\tlet vertices = [body.GetLocalPoint(chain.footholds[0].GetVertex1(), new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]())];\r\n\r\n\t\t\tfor (let i = 0; i < chain.footholds.length; ++i) {\r\n\t\t\t\tconst fh = chain.footholds[i];\r\n\r\n\t\t\t\tvertices.push(body.GetLocalPoint(fh.GetVertex2(), new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]()));\r\n\r\n\t\t\t\tfh.body = body;\r\n\t\t\t\tfh._chain = chain;\r\n\t\t\t}\r\n\r\n\t\t\tif (chain.loop) {\r\n\t\t\t\tshape.CreateLoop(vertices);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tshape.CreateChain(vertices);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\t\t\tfdef.shape = shape;\r\n\t\t\tfdef.density = 1;\r\n\t\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_5__[\"FilterHelper\"].get(\"foothold\"));\r\n\t\t\tfdef.friction = 1;\r\n\t\t\tfdef.restitution = 0;\r\n\t\t\tfdef.userData = chain;\r\n\r\n\t\t\tlet fixture = body.CreateFixture(fdef);\r\n\r\n\t\t\t//fixture.beginContact = this.beginContact_bodyBase_oneway;\r\n\t\t\tfixture.endContact = this.endContact_bodyBase_oneway;\r\n\t\t\tfixture.preSolve = this.preSolveGround_bodyBase_oneway;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @param {FootholdChain} chain\r\n\t * @param {boolean} is_solid\r\n\t */\r\n\t_create_foothold(world, chain, is_solid) {\r\n\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\r\n\t\t/** @type {b2PolygonShape&b2EdgeShape} */\r\n\t\tlet shape;\r\n\r\n\r\n\t\tif (is_solid) {\r\n\t\t\tshape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PolygonShape\"]();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2EdgeShape\"]();\r\n\t\t}\r\n\r\n\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_kinematicBody;//可移動\r\n\t\tbdef.linearDamping = 1;\r\n\t\tbdef.gravityScale = 0;\r\n\t\tbdef.userData = this;\r\n\t\tbdef.bullet = window.FOOTHOLD_IS_BULLET;\r\n\r\n\t\tfdef.shape = shape;\r\n\t\tfdef.density = 1;\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_5__[\"FilterHelper\"].get(\"foothold\"));\r\n\t\tfdef.friction = 1;\r\n\t\tfdef.restitution = 0;\r\n\t\t//fdef.userData = chain;\r\n\r\n\t\tfor (let i = 0; i < chain.footholds.length; ++i) {\r\n\t\t\tconst fh = chain.footholds[i];\r\n\t\t\t//if (fh.is_wall) {\r\n\t\t\t//\tthis._create_wall(fh);\r\n\t\t\t//\tcontinue;\r\n\t\t\t//}\r\n\t\t\tlet x1, y1, x2, y2;\r\n\r\n\t\t\tx1 = fh.x1 / $gv.CANVAS_SCALE;\r\n\t\t\ty1 = fh.y1 / $gv.CANVAS_SCALE;\r\n\t\t\tx2 = fh.x2 / $gv.CANVAS_SCALE;\r\n\t\t\ty2 = fh.y2 / $gv.CANVAS_SCALE;\r\n\r\n\t\t\tcreate.call(this, fh);\r\n\t\t\t\r\n\t\t\tconst next = this.footholds[fh.next];\r\n\t\t\tif (next) {\r\n\t\t\t\tlet x1n, y1n, x2n, y2n;\r\n\t\t\t\tlet nx1, ny1, nx2, ny2;\r\n\r\n\t\t\t\tnx1 = next.x1 / $gv.CANVAS_SCALE;\r\n\t\t\t\tny1 = next.y1 / $gv.CANVAS_SCALE;\r\n\t\t\t\tnx2 = next.x2 / $gv.CANVAS_SCALE;\r\n\t\t\t\tny2 = next.y2 / $gv.CANVAS_SCALE;\r\n\r\n\t\t\t\tlet v1 = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](x1 - x2, y1 - y2);\r\n\t\t\t\tlet v2 = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](nx2 - nx1, ny2 - ny1);\r\n\t\t\t\tlet a = Math.atan2(_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].CrossVV(v1, v2), _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].DotVV(v1, v2));\r\n\r\n\t\t\t\tfh.next_a = a;\r\n\t\t\t\tfh.next_a_deg = Math.abs(Math.trunc(a * 180 / Math.PI)) % 180;\r\n\t\t\t}\r\n\t\t}\r\n\t\t/**\r\n\t\t * @param {Foothold} fh\r\n\t\t * @param {number} x1\r\n\t\t * @param {number} y1\r\n\t\t * @param {number} x2\r\n\t\t * @param {number} y2\r\n\t\t */\r\n\t\tfunction create(fh) {\r\n\t\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].AddVV(fh.GetVertex1(), fh.GetVertex2(), bdef.position);\r\n\t\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].MulVS(bdef.position, 0.5, bdef.position);\r\n\r\n\t\t\tlet hlen = fh.m_length * 0.5;\r\n\t\t\tbdef.angle = fh.m_angle;\r\n\r\n\t\t\tlet body = world.CreateBody(bdef);\r\n\t\t\tbody.$type = \"ground\";\r\n\r\n\t\t\tif (is_solid) {\r\n\t\t\t\tshape.SetAsBox(hlen, _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2_polygonRadius\"]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tshape.m_vertex1.Set(-hlen, 0)\r\n\t\t\t\tshape.m_vertex2.Set(hlen, 0);\r\n\r\n\t\t\t\tif (window.USE_GHOST_VERTEX) {\r\n\t\t\t\t\tif (fh.prev != null) {\r\n\t\t\t\t\t\tconst prev = this.footholds[fh.prev];\r\n\t\t\t\t\t\tshape.m_hasVertex0 = true;\r\n\t\t\t\t\t\tshape.m_vertex0.Copy(prev.GetVertex2());\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fh.next != null) {\r\n\t\t\t\t\t\tconst next = this.footholds[fh.next];\r\n\t\t\t\t\t\tshape.m_hasVertex3 = true;\r\n\t\t\t\t\t\tshape.m_vertex3.Copy(next.GetVertex1());\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfdef.userData = fh;\r\n\r\n\t\t\tlet fixture = body.CreateFixture(fdef);\r\n\r\n\t\t\t//fixture.beginContact = this.beginContact_bodyBase_oneway;\r\n\t\t\tfixture.endContact = this.endContact_bodyBase_oneway;\r\n\t\t\tfixture.preSolve = this.preSolveGround_bodyBase_oneway;\r\n\r\n\t\t\tfh.body = body;\r\n\t\t\tthis.bodies.push(body);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {{left: number, right: number}}\r\n\t */\r\n\t_compute_left_right_border() {\r\n\t\tlet left = null, right = null;\r\n\t\tfor (let i = 0; i < this.footholds.length; ++i) {\r\n\t\t\tlet fh = this.footholds[i];\r\n\t\t\t//if (fh.layer == 5) {\r\n\t\t\t\tlet x1, x2;\r\n\t\t\t\t\r\n\t\t\t\tif (fh.x1 < fh.x2) {\r\n\t\t\t\t\tx1 = fh.x1;\r\n\t\t\t\t\tx2 = fh.x2;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tx1 = fh.x2;\r\n\t\t\t\t\tx2 = fh.x1;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (left == null || x1 < left) {\r\n\t\t\t\t\tleft = x1;\r\n\t\t\t\t}\r\n\t\t\t\tif (right == null || x2 > right) {\r\n\t\t\t\t\tright = x2;\r\n\t\t\t\t}\r\n\t\t\t\t//if (left != null) {\r\n\t\t\t\t//\tleft = Math.min(left, fh.x1, fh.x2);\r\n\t\t\t\t//}\r\n\t\t\t\t//else {\r\n\t\t\t\t//\tleft = Math.min(fh.x1, fh.x2);\r\n\t\t\t\t//}\r\n\t\t\t\t//else {\r\n\t\t\t\t//\tright = Math.max(fh.x1, fh.x2);\r\n\t\t\t\t//}\r\n\t\t\t//}\r\n\t\t}\r\n\t\treturn { left, right };\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Fixture} fa\r\n\t * @param {b2Fixture} fb\r\n\t * @param {number} childIndexA\r\n\t * @param {number} childIndexB\r\n\t */\r\n\tbeginContact_bodyBase_oneway(contact, fa, fb, childIndexA, childIndexB) {\r\n\t\tif (fb.$type == \"player\") {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\tlet numPoints, worldManifold;\r\n\t\tconst playerBody = fb.GetBody();\r\n\r\n\t\t/** @type {Foothold} */\r\n\t\tconst fh = this.getFootholdFromContact(childIndexA);\r\n\t\t\r\n\t\t/** @type {PPlayer} */\r\n\t\tconst player = fb.GetUserData();\r\n\t\tif (!player || !player.body || player.body.$type != \"player\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (player.state.ladder) {\r\n\t\t\tcontact.SetEnabled(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst $fh = player.$foothold;\r\n\t\tconst player_pos = player.foot_walk.GetWorldCenter();//player.getPosition();\r\n\r\n\t\tif (fh.is_wall) {\r\n\t\t\tcontact.SetFriction(0);\r\n\r\n\t\t\tconst p$fh = player.prev_$fh;\r\n\r\n\t\t\tif ((!$fh || $fh.chain != fh.chain) &&\r\n\t\t\t\tp$fh &&\r\n\t\t\t\tp$fh.chain != fh.chain &&\r\n\t\t\t\tp$fh.layer != fh.layer\r\n\t\t\t) {\r\n\t\t\t\tcontact.SetEnabled(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (player.state.dropDown && player.leave_$fh != null) {\r\n\t\t\t//HACK: ?? foothold edge\r\n\t\t\tif (player.leave_$fh == $fh && $fh != fh) {\r\n\t\t\t\tcontact.SetEnabled(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (playerBody.$type == \"pl_ft_walk\" &&// player.leave_$fh &&\r\n\t\t\t\tplayer.leave_$fh.id != fh.id &&\r\n\t\t\t\tplayer.leave_$fh.chain.id != fh.chain.id &&\r\n\t\t\t\t(player.leave_$fh.prev == null || player.leave_$fh.prev != fh.id) &&\r\n\t\t\t\t(player.leave_$fh.next == null || player.leave_$fh.next != fh.id)\r\n\t\t\t) {\r\n\t\t\t\tconst foot = player.foot_walk.GetWorldCenter();\r\n\t\t\t\tnumPoints = contact.GetManifold().pointCount;\r\n\t\t\t\tworldManifold = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2WorldManifold\"]();\r\n\t\t\t\tcontact.GetWorldManifold(worldManifold);\r\n\r\n\t\t\t\t//check if contact points are moving into platform\r\n\t\t\t\tfor (let i = 0; i < numPoints; ++i) {\r\n\t\t\t\t\tconst cpoint = worldManifold.points[i];\r\n\t\t\t\t\tif (cpoint.y > foot.y) {\r\n\t\t\t\t\t\tplayer.leave_$fh = null;\r\n\t\t\t\t\t\tplayer.state.dropDown = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcontact.SetEnabled(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tplayer.state.dropDown = false;\r\n\t\t}\r\n\r\n\t\tif (player.leave_$fh && player.leave_$fh == fh) {\r\n\t\t\tcontact.SetEnabled(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet ccc = $fh && (\r\n\t\t\tfh.is_wall ||\r\n\t\t\t(fh == player._foothold && (fh.y1 < $fh.y1 || fh.y2 < $fh.y2)) ||\r\n\t\t\t(fh != player._foothold && (fh.y1 > $fh.y1 || fh.y2 > $fh.y2))\r\n\t\t);\r\n\t\tif (ccc && $fh != fh && (!player._$fallEdge || player._$fallEdge != $fh)) {\r\n\t\t\tif (fh.chain.id != $fh.chain.id &&\r\n\t\t\t\t(!$fh.prev || $fh.y1 != fh.y2) &&\r\n\t\t\t\t(!$fh.next || $fh.y2 != fh.y1)\r\n\t\t\t) {\r\n\t\t\t\tplayer.leave_$fh = fh;\r\n\t\t\t\tcontact.SetEnabled(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (player._$fallEdge && player._$fallEdge == fh) {\r\n\t\t\tcontact.SetEnabled(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst relative_position = fh.GetLocalPoint(player_pos, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]());\r\n\t\tconst platformFaceY = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2_polygonRadius\"];\r\n\r\n\t\tconst foot_width = player.chara_profile.foot_width;\r\n\r\n\t\tif (numPoints == null) {\r\n\t\t\tnumPoints = contact.GetManifold().pointCount;\r\n\t\t\tworldManifold = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2WorldManifold\"]();\r\n\t\t\tcontact.GetWorldManifold(worldManifold);\r\n\t\t}\r\n\r\n\t\t//check if contact points are moving into platform\r\n\t\tfor (let i = 0; i < numPoints; ++i) {\r\n\t\t\tconst cpoint = worldManifold.points[i];\r\n\t\t\tconst pointVelPlatform = fh.GetLinearVelocityFromWorldPoint(cpoint, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]());\r\n\t\t\tconst pointVelOther = playerBody.GetLinearVelocityFromWorldPoint(cpoint, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]());\r\n\t\t\tconst point = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](pointVelOther.x - pointVelPlatform.x, pointVelOther.y - pointVelPlatform.y);\r\n\t\t\tconst relativeVel = fh.GetLocalVector(point, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]());\r\n\t\t\tconst relativePosition = fh.GetLocalPoint(cpoint, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]());\r\n\r\n\t\t\tif (relative_position.y <= -(foot_width - platformFaceY) ||\r\n\t\t\t\t(cpoint.y > player_pos.y && relativePosition.y <= platformFaceY)\r\n\t\t\t) {\r\n\t\t\t\tif (relativeVel.y > 1) {//if moving down faster than 1 m/s, handle as before\r\n\t\t\t\t\t//player._foothold = fh;\r\n\t\t\t\t\tif (fh.is_wall || player._which_foothold_contact(fh, cpoint)) {\r\n\t\t\t\t\t\tnormal_contact(cpoint);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tnormal_contact(cpoint);\r\n\t\t\t\t\t//\treturn;//not primary, normal contact \r\n\t\t\t\t\t//}\r\n\t\t\t\t}\r\n\t\t\t\telse if (relativeVel.y > -1) { //if moving slower than 1 m/s\r\n\t\t\t\t\t//borderline case, moving only slightly out of platform\r\n\t\t\t\t\t//player._foothold = fh;\r\n\t\t\t\t\tif (fh.is_wall || player._which_foothold_contact(fh, cpoint)) {\r\n\t\t\t\t\t\tif ($fh && $fh.id != fh.id) {\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tnormal_contact(cpoint);\r\n\t\t\t\t\t\treturn;//contact point is less than 5cm inside front face of platfrom\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//else {\r\n\t\t\t\t\t//\tnormal_contact(cpoint);\r\n\t\t\t\t\t//\treturn;//not primary, normal contact\r\n\t\t\t\t\t//}\r\n\t\t\t\t}\r\n\t\t\t\telse if (fh.is_wall) {//contact wall's upper vertex\r\n\t\t\t\t\tconst py = player_pos.y * $gv.CANVAS_SCALE;\r\n\t\t\t\t\tif (fh.y2 >= fh.y1) {\r\n\t\t\t\t\t\tif (py <= fh.y1) {\r\n\t\t\t\t\t\t\tnormal_contact(cpoint);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (py <= fh.y2) {\r\n\t\t\t\t\t\t\tnormal_contact(cpoint);\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//no points are moving into platform, contact should not be solid\r\n\t\tcontact.SetEnabled(false);\r\n\r\n\t\t/**\r\n\t\t * @param {b2Vec2} cpoint\r\n\t\t */\r\n\t\tfunction normal_contact(cpoint) {\r\n\t\t\tif ((fh.prev == null && (cpoint.x * $gv.CANVAS_SCALE) < fh.x1) ||\r\n\t\t\t\t(fh.next == null && (cpoint.x * $gv.CANVAS_SCALE) > fh.x2)\r\n\t\t\t) {\r\n\t\t\t\tplayer.state.jump = true;\r\n\r\n\t\t\t\tplayer._$fallEdge = fh;\r\n\r\n\t\t\t\tplayer._foothold = null;\r\n\t\t\t\tplayer._foot_at = null;\r\n\t\t\t\t//\r\n\t\t\t\tplayer.$foothold = null;\r\n\r\n\t\t\t\tcontact.SetEnabled(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Fixture} fa\r\n\t * @param {b2Fixture} fb\r\n\t * @param {number} childIndexA\r\n\t * @param {number} childIndexB\r\n\t */\r\n\tendContact_bodyBase_oneway(contact, fa, fb, childIndexA, childIndexB) {\r\n\t\t/** @type {PPlayer} */\r\n\t\tconst player = fb.GetUserData();\r\n\t\tif (!player) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t/** @type {Foothold} */\r\n\t\tconst fh = this.getFootholdFromContact(childIndexA);\r\n\r\n\t\tplayer.prev_$fh = fh;\r\n\r\n\t\tif (player._foot_contact_list.length) {\r\n\t\t\tplayer._foot_contact_list.forEach((fc, i) => {\r\n\t\t\t\tif (fc.foothold == fh) {\r\n\t\t\t\t\tplayer._foot_contact_list.splice(i, 1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tif (player._$fallEdge && fh == player._$fallEdge) {\r\n\t\t\tplayer._$fallEdge = null;\r\n\t\t}\r\n\t\telse if (player._foothold && fh == player._foothold) {\r\n\t\t\tif (player._foot_contact_list.length) {\r\n\t\t\t\tplayer.prev_$fh = player.$foothold;\r\n\r\n\t\t\t\tlet max = player._foot_contact_list.pop();\r\n\t\t\t\tplayer.$foothold = max.foothold;\r\n\t\t\t\tplayer._foothold = max.foothold;\r\n\t\t\t\tplayer._foot_at = max.position;\r\n\t\t\t\tplayer._foothold_priority = max.priority;\r\n\t\t\t\t//console.log(\"end contact: contact old foothold: fh == player._foothold\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tplayer._foothold = null;//正常離開地面\r\n\t\t\t\tplayer._foot_at = null;\r\n\t\t\t\t//console.log(\"end contact: 正常離開地面: fh == player._foothold\");\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (player.$foothold && fh == player.$foothold) {\r\n\t\t\tif (player._foot_contact_list.length) {\r\n\t\t\t\tplayer.prev_$fh = player.$foothold;\r\n\r\n\t\t\t\tlet max = player._foot_contact_list.pop();\r\n\t\t\t\tplayer.$foothold = max.foothold;\r\n\t\t\t\tplayer._foothold = max.foothold;\r\n\t\t\t\tplayer._foot_at = max.position;\r\n\t\t\t\tplayer._foothold_priority = max.priority;\r\n\t\t\t\t//console.log(\"end contact: contact old foothold: fh == player.$foothold\");\r\n\t\t\t}\r\n\t\t\telse {//afterStep\r\n\t\t\t\tif (player._foothold) {\r\n\t\t\t\t\tplayer.prev_$fh = player.$foothold;\r\n\r\n\t\t\t\t\tplayer.$foothold = player._foothold;\r\n\t\t\t\t\t//console.log(\"end contact: contact other foothold\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tplayer.$foothold = null;//正常離開地面\r\n\t\t\t\t\tplayer._foot_at = null;\r\n\t\t\t\t\t//console.info(\"end contact: 正常離開地面: fh == player.$foothold\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (player.leave_$fh && player.leave_$fh == fh) {\r\n\t\t\tplayer.leave_$fh = null;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Manifold} oldManifold\r\n\t * @param {b2Fixture} fa\r\n\t * @param {b2Fixture} fb\r\n\t * @param {number} childIndexA\r\n\t * @param {number} childIndexB\r\n\t */\r\n\tpreSolveGround_bodyBase_oneway(contact, oldManifold, fa, fb, childIndexA, childIndexB) {\r\n\t\t/** @type {Ground} */\r\n\t\tlet that = fa.GetBody().GetUserData();\r\n\r\n\t\t/** @type {Foothold} */\r\n\t\tlet target = this;\r\n\r\n\t\tthat.beginContact_bodyBase_oneway.call(target, contact, fa, fb, childIndexA, childIndexB);\r\n\t\t\r\n\t\t//if (contact.IsEnabled() && contact.IsTouching()) {\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t */\r\n\tunload(world) {\r\n\t\tfor (let i = 0; i < this.bodies.length; ++i) {\r\n\t\t\tworld.DestroyBody(this.bodies[i]);\r\n\t\t}\r\n\t\tthis.init();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {object} data\r\n\t */\r\n\taddFoothold(data) {\r\n\t\tthis.footholds.push(new Foothold(data));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t$drawDebugInfo(renderer) {\r\n\t\tif ($gv.m_display_foothold) {\r\n\t\t\tconst ctx = renderer.ctx;\r\n\r\n\t\t\tctx.lineJoin = \"round\";\r\n\t\t\tctx.lineCap = \"round\";\r\n\t\t\tfor (let i = 0; i < this.footholds.length; ++i) {\r\n\t\t\t\tlet fh = this.footholds[i];\r\n\t\t\t\tif (fh == null) {//line end\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tif (fh.$showDebugInfo) {\r\n\t\t\t\t\tfh.$drawDebugInfo(renderer);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t$showDebugInfo(layer, group, isShow, isHide) {\r\n\t\tif (isShow == null) {\r\n\t\t\tisShow = true;\r\n\t\t}\r\n\t\tif (isHide == null) {\r\n\t\t\tisHide = false;\r\n\t\t}\r\n\t\tfor (let fh of this.footholds) {\r\n\t\t\tif (fh.layer == layer && fh.group == group) {\r\n\t\t\t\tfh.$showDebugInfo = isShow;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfh.$showDebugInfo = isHide;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t$showDebugInfoByLayer(layer, isShow, isHide) {\r\n\t\tif (isShow == null) {\r\n\t\t\tisShow = true;\r\n\t\t}\r\n\t\tif (isHide == null) {\r\n\t\t\tisHide = false;\r\n\t\t}\r\n\t\tfor (let fh of this.footholds) {\r\n\t\t\tif (fh.layer == layer) {\r\n\t\t\t\tfh.$showDebugInfo = isShow;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfh.$showDebugInfo = isHide;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//static $showDebugInfoByGroup() {\r\n\t//}\r\n\t$hideAllDebugInfo() {\r\n\t\tfor (let fh of this.footholds) {\r\n\t\t\tfh.$showDebugInfo = false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nGround.Foothold = Foothold;\r\n\r\n/*\r\nmap=100000000\r\n$$hhh = -1.5;\r\nclearInterval($$$si)\r\n$$$si = setInterval(() => {\r\n    chara.$physics.setPosition(113.96875, 7.84375 + $$hhh);\r\n\t$$hhh += 0.005;//1 / $gv.CANVAS_SCALE;\r\n\t$$hhh = $$hhh > 2 ? 0 : $$hhh;\r\n    chara.$physics.body.SetAwake(true);\r\n    setTimeout(() => {\r\n        chara.$physics.state.jump = true;\r\n        $gv.input_keyDown.f = 1;\r\n        setTimeout(() => {\r\n            $gv.input_keyDown.f = 0;\r\n            $gv.input_keyUp.f = 1;\r\n            setTimeout(() => {\r\n                $gv.input_keyUp.f = 0;\r\n            }, 50);\r\n        }, 50);\r\n    }, 140);\r\n}, 1000);\r\n\r\n*/\r\n\r\n/*\r\nmap=100000000\r\nchara.$physics.setPosition(4583/32+3,364/32-3)\r\nchara.$physics.body.m_linearVelocity.Set(-22,15)\r\n\r\n*/\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL0dyb3VuZC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1BoeXNpY3MvR3JvdW5kLmpzPzFhNzIiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7XHJcblx0YjJfcG9seWdvblJhZGl1cyxcclxuXHRiMlZlYzIsXHJcblx0YjJCb2R5VHlwZSwgYjJCb2R5RGVmLCBiMkZpeHR1cmVEZWYsXHJcblx0YjJQb2x5Z29uU2hhcGUsIGIyRWRnZVNoYXBlLCBiMkNoYWluU2hhcGUsXHJcblx0YjJCb2R5LCBiMkZpeHR1cmUsXHJcblx0YjJDb250YWN0LCBiMk1hbmlmb2xkLCBiMkNvbnRhY3RJbXB1bHNlLCBiMldvcmxkTWFuaWZvbGRcclxufSBmcm9tIFwiLi9QaHlzaWNzLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBWZWMyLCBSZWN0YW5nbGUgfSBmcm9tIFwiLi4vbWF0aC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgV29ybGQsIEdSQVZJVFkgfSBmcm9tIFwiLi9Xb3JsZC5qc1wiO1xyXG5pbXBvcnQgeyBGb290aG9sZENoYWluLCBGb290aG9sZFNpbmdsZSwgRm9vdGhvbGRDaGFpbkNoaWxkfSBmcm9tIFwiLi9Gb290aG9sZC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgUFBsYXllciB9IGZyb20gXCIuL1BQbGF5ZXIuanNcIjtcclxuaW1wb3J0IHsgRmlsdGVySGVscGVyIH0gZnJvbSBcIi4vRmlsdGVyLmpzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IEZvb3Rob2xkID0gRm9vdGhvbGRTaW5nbGU7XHJcbi8vZXhwb3J0IGNvbnN0IEZvb3Rob2xkID0gRm9vdGhvbGRDaGFpbkNoaWxkO1xyXG5cclxuXHJcbi8qKlxyXG4gKiDlj6/ku6XpmLLmraJwbGF5ZXLljaHlnKhmb290aG9sZOijoemdolxyXG4gKi9cclxud2luZG93LkNSRUFURV9TT0xJRF9GT09USE9MRCA9IGZhbHNlO1xyXG4vKipcclxuICogcG9seWdvbiArIGVkZ2VcclxuICovXHJcbndpbmRvdy5DUkVBVEVfU09MSURfQU5EX0VER0VfRk9PVEhPTEQgPSBmYWxzZTtcclxuXHJcbi8qKlxyXG4gKiBiMkVkZ2VTaGFwZSBnaG9zdCB2ZXJ0ZXhcclxuICovXHJcbndpbmRvdy5VU0VfR0hPU1RfVkVSVEVYID0gdHJ1ZTtcclxuXHJcbndpbmRvdy5GT09USE9MRF9JU19CVUxMRVQgPSB0cnVlO1xyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBsZWZ0XHJcbiAqIEBwYXJhbSB7bnVtYmVyfSByaWdodFxyXG4gKiBAcGFyYW0ge251bWJlcn0gaW50ZXJwb2xhdGVyIC0gMH4xXHJcbiAqL1xyXG5mdW5jdGlvbiBsZXJwKGxlZnQsIHJpZ2h0LCBpbnRlcnBvbGF0ZXIpIHtcclxuXHRyZXR1cm4gbGVmdCArIGludGVycG9sYXRlciAqIChyaWdodCAtIGxlZnQpO1xyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgR3JvdW5kIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7YjJCb2R5W119ICovXHJcblx0XHR0aGlzLmJvZGllcyA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtGb290aG9sZFtdfSAqL1xyXG5cdFx0dGhpcy5mb290aG9sZHMgPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge1JlY3RhbmdsZVtdfSAqL1xyXG5cdFx0dGhpcy5yZWN0Q2hhaW5zID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLmluaXQoKTtcclxuXHR9XHJcblxyXG5cdGluaXQoKSB7XHJcblx0XHR0aGlzLmZvb3Rob2xkcyA9IFtdO1xyXG5cdFx0dGhpcy5ib2RpZXMgPSBbXTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gd29ybGRcclxuXHQgKi9cclxuXHRsb2FkKG1hcF9yYXdfZGF0YSwgd29ybGQpIHtcclxuXHRcdGlmICghKFwiZm9vdGhvbGRcIiBpbiBtYXBfcmF3X2RhdGEpKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRmb3IgKGxldCBsYXllckluZGV4IGluIG1hcF9yYXdfZGF0YS5mb290aG9sZCkge1xyXG5cdFx0XHRsZXQgZ3JvdXBzID0gbWFwX3Jhd19kYXRhLmZvb3Rob2xkW2xheWVySW5kZXhdO1xyXG5cclxuXHRcdFx0Ly9mb290aG9sZFs1XSBtYXliZSBpcyBCb3VuZGluZy1Cb3gobG9vcCBsaW5lKVxyXG5cclxuXHRcdFx0Zm9yIChsZXQgZ3JvdXBJbmRleCBpbiBncm91cHMpIHtcclxuXHRcdFx0XHRsZXQgc2VnbWVudCA9IGdyb3Vwc1tncm91cEluZGV4XTtcclxuXHRcdFx0XHRmb3IgKGxldCBrIGluIHNlZ21lbnQpIHtcclxuXHRcdFx0XHRcdGNvbnN0IGluZGV4ID0gayAtIDE7XHJcblxyXG5cdFx0XHRcdFx0bGV0IGZoID0gbmV3IEZvb3Rob2xkKHNlZ21lbnRba10sIGluZGV4LCBsYXllckluZGV4LCBncm91cEluZGV4KTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLmZvb3Rob2xkc1tpbmRleF0gPSBmaDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHQvKiogQHR5cGUge0Zvb3Rob2xkQ2hhaW5bXX0gKi9cclxuXHRcdGxldCBjaGFpbnMgPSBbXTtcclxuXHJcblx0XHRsZXQgY2hhaW5JZCA9IDA7XHJcblx0XHRsZXQgcmVjdENoYWlucyA9IHRoaXMucmVjdENoYWlucyA9IFtdO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mb290aG9sZHMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0Y29uc3QgZm9vdGhvbGQgPSB0aGlzLmZvb3Rob2xkc1tpXTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChmb290aG9sZC5jaGFpbiA9PSBudWxsKSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtmb290aG9sZH0gKi9cclxuXHRcdFx0XHRsZXQgaGVhZDtcclxuXHJcblx0XHRcdFx0Ly9maW5kIGhlYWRcclxuXHRcdFx0XHRmb3IgKGxldCBmaCA9IGZvb3Rob2xkOyBmaCAhPSBudWxsOyBmaCA9IHRoaXMuZm9vdGhvbGRzW2ZoLnByZXZdKSB7XHJcblx0XHRcdFx0XHRpZiAoZmgucHJldiAhPSBudWxsICYmIGZoLnByZXYgPT0gZm9vdGhvbGQuaWQpIHtcclxuXHRcdFx0XHRcdFx0aGVhZCA9IGZoO1xyXG5cdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKCFoZWFkKSB7XHJcblx0XHRcdFx0XHRoZWFkID0gZm9vdGhvbGQ7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRsZXQgY2hhaW4gPSBuZXcgRm9vdGhvbGRDaGFpbihjaGFpbklkKTtcclxuXHJcblx0XHRcdFx0Y2hhaW4uaW5pdChoZWFkLCB0aGlzLmZvb3Rob2xkcywgRm9vdGhvbGQpO1xyXG5cclxuXHRcdFx0XHRpZiAoRm9vdGhvbGQgPT0gRm9vdGhvbGRTaW5nbGUpIHtcclxuXHRcdFx0XHRcdGlmICh3aW5kb3cuQ1JFQVRFX1NPTElEX0FORF9FREdFX0ZPT1RIT0xEKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMuX2NyZWF0ZV9mb290aG9sZCh3b3JsZCwgY2hhaW4sIGZhbHNlKTsvL2VkZ2VcclxuXHRcdFx0XHRcdFx0dGhpcy5fY3JlYXRlX2Zvb3Rob2xkKHdvcmxkLCBjaGFpbiwgdHJ1ZSk7Ly9wb2x5Z29uXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5fY3JlYXRlX2Zvb3Rob2xkKHdvcmxkLCBjaGFpbiwgd2luZG93LkNSRUFURV9TT0xJRF9GT09USE9MRCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKEZvb3Rob2xkID09IEZvb3Rob2xkQ2hhaW5DaGlsZCkge1xyXG5cdFx0XHRcdFx0dGhpcy5fY3JlYXRlX2NoYWluKHdvcmxkLCBjaGFpbik7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRjaGFpbnMucHVzaChjaGFpbik7XHJcblxyXG5cdFx0XHRcdHJlY3RDaGFpbnNbY2hhaW5JZF0gPSBjaGFpbi5ib3VuZDtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRjaGFpbklkKys7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7V29ybGR9IHdvcmxkXHJcblx0ICogQHBhcmFtIHtGb290aG9sZENoYWlufSBjaGFpblxyXG5cdCAqL1xyXG5cdF9jcmVhdGVfY2hhaW4od29ybGQsIGNoYWluKSB7XHJcblx0XHQvKiogQHR5cGUge2IyQm9keX0gKi9cclxuXHRcdGxldCBib2R5O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7YjJDaGFpblNoYXBlfSAqL1xyXG5cdFx0bGV0IHNoYXBlO1xyXG5cclxuXHRcdHtcclxuXHRcdFx0bGV0IGJkZWYgPSBuZXcgYjJCb2R5RGVmKCk7XHJcblxyXG5cdFx0XHRjb25zdCBjZW50ZXIgPSBjaGFpbi5ib3VuZC5jZW50ZXI7XHJcblxyXG5cdFx0XHRiZGVmLnR5cGUgPSBiMkJvZHlUeXBlLmIyX2tpbmVtYXRpY0JvZHk7Ly/lj6/np7vli5VcclxuXHRcdFx0YmRlZi5wb3NpdGlvbi5TZXQoY2VudGVyLnggLyAkZ3YuQ0FOVkFTX1NDQUxFLCBjZW50ZXIueSAvICRndi5DQU5WQVNfU0NBTEUpO1xyXG5cdFx0XHRiZGVmLmFuZ2xlID0gMDtcclxuXHRcdFx0YmRlZi5ncmF2aXR5U2NhbGUgPSAwO1xyXG5cdFx0XHRiZGVmLmxpbmVhckRhbXBpbmcgPSAxO1xyXG5cdFx0XHRiZGVmLmJ1bGxldCA9IHRydWU7XHJcblx0XHRcdGJkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cclxuXHRcdFx0Ym9keSA9IHdvcmxkLkNyZWF0ZUJvZHkoYmRlZik7XHJcblx0XHRcdGJvZHkuJHR5cGUgPSBcImdyb3VuZFwiO1xyXG5cclxuXHRcdFx0dGhpcy5ib2RpZXMucHVzaChib2R5KTtcclxuXHRcdH1cclxuXHJcblx0XHR7XHJcblx0XHRcdHNoYXBlID0gbmV3IGIyQ2hhaW5TaGFwZSgpO1xyXG5cclxuXHRcdFx0LyoqIEB0eXBlIHtiMlZlYzJbXX0gKi9cclxuXHRcdFx0bGV0IHZlcnRpY2VzID0gW2JvZHkuR2V0TG9jYWxQb2ludChjaGFpbi5mb290aG9sZHNbMF0uR2V0VmVydGV4MSgpLCBuZXcgYjJWZWMyKCkpXTtcclxuXHJcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgY2hhaW4uZm9vdGhvbGRzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdFx0Y29uc3QgZmggPSBjaGFpbi5mb290aG9sZHNbaV07XHJcblxyXG5cdFx0XHRcdHZlcnRpY2VzLnB1c2goYm9keS5HZXRMb2NhbFBvaW50KGZoLkdldFZlcnRleDIoKSwgbmV3IGIyVmVjMigpKSk7XHJcblxyXG5cdFx0XHRcdGZoLmJvZHkgPSBib2R5O1xyXG5cdFx0XHRcdGZoLl9jaGFpbiA9IGNoYWluO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoY2hhaW4ubG9vcCkge1xyXG5cdFx0XHRcdHNoYXBlLkNyZWF0ZUxvb3AodmVydGljZXMpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHNoYXBlLkNyZWF0ZUNoYWluKHZlcnRpY2VzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHtcclxuXHRcdFx0bGV0IGZkZWYgPSBuZXcgYjJGaXh0dXJlRGVmKCk7XHJcblx0XHRcdGZkZWYuc2hhcGUgPSBzaGFwZTtcclxuXHRcdFx0ZmRlZi5kZW5zaXR5ID0gMTtcclxuXHRcdFx0ZmRlZi5maWx0ZXIuQ29weShGaWx0ZXJIZWxwZXIuZ2V0KFwiZm9vdGhvbGRcIikpO1xyXG5cdFx0XHRmZGVmLmZyaWN0aW9uID0gMTtcclxuXHRcdFx0ZmRlZi5yZXN0aXR1dGlvbiA9IDA7XHJcblx0XHRcdGZkZWYudXNlckRhdGEgPSBjaGFpbjtcclxuXHJcblx0XHRcdGxldCBmaXh0dXJlID0gYm9keS5DcmVhdGVGaXh0dXJlKGZkZWYpO1xyXG5cclxuXHRcdFx0Ly9maXh0dXJlLmJlZ2luQ29udGFjdCA9IHRoaXMuYmVnaW5Db250YWN0X2JvZHlCYXNlX29uZXdheTtcclxuXHRcdFx0Zml4dHVyZS5lbmRDb250YWN0ID0gdGhpcy5lbmRDb250YWN0X2JvZHlCYXNlX29uZXdheTtcclxuXHRcdFx0Zml4dHVyZS5wcmVTb2x2ZSA9IHRoaXMucHJlU29sdmVHcm91bmRfYm9keUJhc2Vfb25ld2F5O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gd29ybGRcclxuXHQgKiBAcGFyYW0ge0Zvb3Rob2xkQ2hhaW59IGNoYWluXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBpc19zb2xpZFxyXG5cdCAqL1xyXG5cdF9jcmVhdGVfZm9vdGhvbGQod29ybGQsIGNoYWluLCBpc19zb2xpZCkge1xyXG5cdFx0bGV0IGJkZWYgPSBuZXcgYjJCb2R5RGVmKCk7XHJcblx0XHRsZXQgZmRlZiA9IG5ldyBiMkZpeHR1cmVEZWYoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyUG9seWdvblNoYXBlJmIyRWRnZVNoYXBlfSAqL1xyXG5cdFx0bGV0IHNoYXBlO1xyXG5cclxuXHJcblx0XHRpZiAoaXNfc29saWQpIHtcclxuXHRcdFx0c2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGUoKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRzaGFwZSA9IG5ldyBiMkVkZ2VTaGFwZSgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGJkZWYudHlwZSA9IGIyQm9keVR5cGUuYjJfa2luZW1hdGljQm9keTsvL+WPr+enu+WLlVxyXG5cdFx0YmRlZi5saW5lYXJEYW1waW5nID0gMTtcclxuXHRcdGJkZWYuZ3Jhdml0eVNjYWxlID0gMDtcclxuXHRcdGJkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cdFx0YmRlZi5idWxsZXQgPSB3aW5kb3cuRk9PVEhPTERfSVNfQlVMTEVUO1xyXG5cclxuXHRcdGZkZWYuc2hhcGUgPSBzaGFwZTtcclxuXHRcdGZkZWYuZGVuc2l0eSA9IDE7XHJcblx0XHRmZGVmLmZpbHRlci5Db3B5KEZpbHRlckhlbHBlci5nZXQoXCJmb290aG9sZFwiKSk7XHJcblx0XHRmZGVmLmZyaWN0aW9uID0gMTtcclxuXHRcdGZkZWYucmVzdGl0dXRpb24gPSAwO1xyXG5cdFx0Ly9mZGVmLnVzZXJEYXRhID0gY2hhaW47XHJcblxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBjaGFpbi5mb290aG9sZHMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0Y29uc3QgZmggPSBjaGFpbi5mb290aG9sZHNbaV07XHJcblx0XHRcdC8vaWYgKGZoLmlzX3dhbGwpIHtcclxuXHRcdFx0Ly9cdHRoaXMuX2NyZWF0ZV93YWxsKGZoKTtcclxuXHRcdFx0Ly9cdGNvbnRpbnVlO1xyXG5cdFx0XHQvL31cclxuXHRcdFx0bGV0IHgxLCB5MSwgeDIsIHkyO1xyXG5cclxuXHRcdFx0eDEgPSBmaC54MSAvICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRcdHkxID0gZmgueTEgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0XHR4MiA9IGZoLngyIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFx0eTIgPSBmaC55MiAvICRndi5DQU5WQVNfU0NBTEU7XHJcblxyXG5cdFx0XHRjcmVhdGUuY2FsbCh0aGlzLCBmaCk7XHJcblx0XHRcdFxyXG5cdFx0XHRjb25zdCBuZXh0ID0gdGhpcy5mb290aG9sZHNbZmgubmV4dF07XHJcblx0XHRcdGlmIChuZXh0KSB7XHJcblx0XHRcdFx0bGV0IHgxbiwgeTFuLCB4Mm4sIHkybjtcclxuXHRcdFx0XHRsZXQgbngxLCBueTEsIG54MiwgbnkyO1xyXG5cclxuXHRcdFx0XHRueDEgPSBuZXh0LngxIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFx0XHRueTEgPSBuZXh0LnkxIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFx0XHRueDIgPSBuZXh0LngyIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFx0XHRueTIgPSBuZXh0LnkyIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHJcblx0XHRcdFx0bGV0IHYxID0gbmV3IGIyVmVjMih4MSAtIHgyLCB5MSAtIHkyKTtcclxuXHRcdFx0XHRsZXQgdjIgPSBuZXcgYjJWZWMyKG54MiAtIG54MSwgbnkyIC0gbnkxKTtcclxuXHRcdFx0XHRsZXQgYSA9IE1hdGguYXRhbjIoYjJWZWMyLkNyb3NzVlYodjEsIHYyKSwgYjJWZWMyLkRvdFZWKHYxLCB2MikpO1xyXG5cclxuXHRcdFx0XHRmaC5uZXh0X2EgPSBhO1xyXG5cdFx0XHRcdGZoLm5leHRfYV9kZWcgPSBNYXRoLmFicyhNYXRoLnRydW5jKGEgKiAxODAgLyBNYXRoLlBJKSkgJSAxODA7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdC8qKlxyXG5cdFx0ICogQHBhcmFtIHtGb290aG9sZH0gZmhcclxuXHRcdCAqIEBwYXJhbSB7bnVtYmVyfSB4MVxyXG5cdFx0ICogQHBhcmFtIHtudW1iZXJ9IHkxXHJcblx0XHQgKiBAcGFyYW0ge251bWJlcn0geDJcclxuXHRcdCAqIEBwYXJhbSB7bnVtYmVyfSB5MlxyXG5cdFx0ICovXHJcblx0XHRmdW5jdGlvbiBjcmVhdGUoZmgpIHtcclxuXHRcdFx0YjJWZWMyLkFkZFZWKGZoLkdldFZlcnRleDEoKSwgZmguR2V0VmVydGV4MigpLCBiZGVmLnBvc2l0aW9uKTtcclxuXHRcdFx0YjJWZWMyLk11bFZTKGJkZWYucG9zaXRpb24sIDAuNSwgYmRlZi5wb3NpdGlvbik7XHJcblxyXG5cdFx0XHRsZXQgaGxlbiA9IGZoLm1fbGVuZ3RoICogMC41O1xyXG5cdFx0XHRiZGVmLmFuZ2xlID0gZmgubV9hbmdsZTtcclxuXHJcblx0XHRcdGxldCBib2R5ID0gd29ybGQuQ3JlYXRlQm9keShiZGVmKTtcclxuXHRcdFx0Ym9keS4kdHlwZSA9IFwiZ3JvdW5kXCI7XHJcblxyXG5cdFx0XHRpZiAoaXNfc29saWQpIHtcclxuXHRcdFx0XHRzaGFwZS5TZXRBc0JveChobGVuLCBiMl9wb2x5Z29uUmFkaXVzKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzaGFwZS5tX3ZlcnRleDEuU2V0KC1obGVuLCAwKVxyXG5cdFx0XHRcdHNoYXBlLm1fdmVydGV4Mi5TZXQoaGxlbiwgMCk7XHJcblxyXG5cdFx0XHRcdGlmICh3aW5kb3cuVVNFX0dIT1NUX1ZFUlRFWCkge1xyXG5cdFx0XHRcdFx0aWYgKGZoLnByZXYgIT0gbnVsbCkge1xyXG5cdFx0XHRcdFx0XHRjb25zdCBwcmV2ID0gdGhpcy5mb290aG9sZHNbZmgucHJldl07XHJcblx0XHRcdFx0XHRcdHNoYXBlLm1faGFzVmVydGV4MCA9IHRydWU7XHJcblx0XHRcdFx0XHRcdHNoYXBlLm1fdmVydGV4MC5Db3B5KHByZXYuR2V0VmVydGV4MigpKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGlmIChmaC5uZXh0ICE9IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0Y29uc3QgbmV4dCA9IHRoaXMuZm9vdGhvbGRzW2ZoLm5leHRdO1xyXG5cdFx0XHRcdFx0XHRzaGFwZS5tX2hhc1ZlcnRleDMgPSB0cnVlO1xyXG5cdFx0XHRcdFx0XHRzaGFwZS5tX3ZlcnRleDMuQ29weShuZXh0LkdldFZlcnRleDEoKSk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmZGVmLnVzZXJEYXRhID0gZmg7XHJcblxyXG5cdFx0XHRsZXQgZml4dHVyZSA9IGJvZHkuQ3JlYXRlRml4dHVyZShmZGVmKTtcclxuXHJcblx0XHRcdC8vZml4dHVyZS5iZWdpbkNvbnRhY3QgPSB0aGlzLmJlZ2luQ29udGFjdF9ib2R5QmFzZV9vbmV3YXk7XHJcblx0XHRcdGZpeHR1cmUuZW5kQ29udGFjdCA9IHRoaXMuZW5kQ29udGFjdF9ib2R5QmFzZV9vbmV3YXk7XHJcblx0XHRcdGZpeHR1cmUucHJlU29sdmUgPSB0aGlzLnByZVNvbHZlR3JvdW5kX2JvZHlCYXNlX29uZXdheTtcclxuXHJcblx0XHRcdGZoLmJvZHkgPSBib2R5O1xyXG5cdFx0XHR0aGlzLmJvZGllcy5wdXNoKGJvZHkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge3tsZWZ0OiBudW1iZXIsIHJpZ2h0OiBudW1iZXJ9fVxyXG5cdCAqL1xyXG5cdF9jb21wdXRlX2xlZnRfcmlnaHRfYm9yZGVyKCkge1xyXG5cdFx0bGV0IGxlZnQgPSBudWxsLCByaWdodCA9IG51bGw7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZm9vdGhvbGRzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGxldCBmaCA9IHRoaXMuZm9vdGhvbGRzW2ldO1xyXG5cdFx0XHQvL2lmIChmaC5sYXllciA9PSA1KSB7XHJcblx0XHRcdFx0bGV0IHgxLCB4MjtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRpZiAoZmgueDEgPCBmaC54Mikge1xyXG5cdFx0XHRcdFx0eDEgPSBmaC54MTtcclxuXHRcdFx0XHRcdHgyID0gZmgueDI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0eDEgPSBmaC54MjtcclxuXHRcdFx0XHRcdHgyID0gZmgueDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmIChsZWZ0ID09IG51bGwgfHwgeDEgPCBsZWZ0KSB7XHJcblx0XHRcdFx0XHRsZWZ0ID0geDE7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGlmIChyaWdodCA9PSBudWxsIHx8IHgyID4gcmlnaHQpIHtcclxuXHRcdFx0XHRcdHJpZ2h0ID0geDI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC8vaWYgKGxlZnQgIT0gbnVsbCkge1xyXG5cdFx0XHRcdC8vXHRsZWZ0ID0gTWF0aC5taW4obGVmdCwgZmgueDEsIGZoLngyKTtcclxuXHRcdFx0XHQvL31cclxuXHRcdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRcdC8vXHRsZWZ0ID0gTWF0aC5taW4oZmgueDEsIGZoLngyKTtcclxuXHRcdFx0XHQvL31cclxuXHRcdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRcdC8vXHRyaWdodCA9IE1hdGgubWF4KGZoLngxLCBmaC54Mik7XHJcblx0XHRcdFx0Ly99XHJcblx0XHRcdC8vfVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIHsgbGVmdCwgcmlnaHQgfTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YjJDb250YWN0fSBjb250YWN0XHJcblx0ICogQHBhcmFtIHtiMkZpeHR1cmV9IGZhXHJcblx0ICogQHBhcmFtIHtiMkZpeHR1cmV9IGZiXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGNoaWxkSW5kZXhBXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGNoaWxkSW5kZXhCXHJcblx0ICovXHJcblx0YmVnaW5Db250YWN0X2JvZHlCYXNlX29uZXdheShjb250YWN0LCBmYSwgZmIsIGNoaWxkSW5kZXhBLCBjaGlsZEluZGV4Qikge1xyXG5cdFx0aWYgKGZiLiR0eXBlID09IFwicGxheWVyXCIpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHRsZXQgbnVtUG9pbnRzLCB3b3JsZE1hbmlmb2xkO1xyXG5cdFx0Y29uc3QgcGxheWVyQm9keSA9IGZiLkdldEJvZHkoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge0Zvb3Rob2xkfSAqL1xyXG5cdFx0Y29uc3QgZmggPSB0aGlzLmdldEZvb3Rob2xkRnJvbUNvbnRhY3QoY2hpbGRJbmRleEEpO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge1BQbGF5ZXJ9ICovXHJcblx0XHRjb25zdCBwbGF5ZXIgPSBmYi5HZXRVc2VyRGF0YSgpO1xyXG5cdFx0aWYgKCFwbGF5ZXIgfHwgIXBsYXllci5ib2R5IHx8IHBsYXllci5ib2R5LiR0eXBlICE9IFwicGxheWVyXCIpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChwbGF5ZXIuc3RhdGUubGFkZGVyKSB7XHJcblx0XHRcdGNvbnRhY3QuU2V0RW5hYmxlZChmYWxzZSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCAkZmggPSBwbGF5ZXIuJGZvb3Rob2xkO1xyXG5cdFx0Y29uc3QgcGxheWVyX3BvcyA9IHBsYXllci5mb290X3dhbGsuR2V0V29ybGRDZW50ZXIoKTsvL3BsYXllci5nZXRQb3NpdGlvbigpO1xyXG5cclxuXHRcdGlmIChmaC5pc193YWxsKSB7XHJcblx0XHRcdGNvbnRhY3QuU2V0RnJpY3Rpb24oMCk7XHJcblxyXG5cdFx0XHRjb25zdCBwJGZoID0gcGxheWVyLnByZXZfJGZoO1xyXG5cclxuXHRcdFx0aWYgKCghJGZoIHx8ICRmaC5jaGFpbiAhPSBmaC5jaGFpbikgJiZcclxuXHRcdFx0XHRwJGZoICYmXHJcblx0XHRcdFx0cCRmaC5jaGFpbiAhPSBmaC5jaGFpbiAmJlxyXG5cdFx0XHRcdHAkZmgubGF5ZXIgIT0gZmgubGF5ZXJcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0Y29udGFjdC5TZXRFbmFibGVkKGZhbHNlKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZiAocGxheWVyLnN0YXRlLmRyb3BEb3duICYmIHBsYXllci5sZWF2ZV8kZmggIT0gbnVsbCkge1xyXG5cdFx0XHQvL0hBQ0s6ID8/IGZvb3Rob2xkIGVkZ2VcclxuXHRcdFx0aWYgKHBsYXllci5sZWF2ZV8kZmggPT0gJGZoICYmICRmaCAhPSBmaCkge1xyXG5cdFx0XHRcdGNvbnRhY3QuU2V0RW5hYmxlZChmYWxzZSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChwbGF5ZXJCb2R5LiR0eXBlID09IFwicGxfZnRfd2Fsa1wiICYmLy8gcGxheWVyLmxlYXZlXyRmaCAmJlxyXG5cdFx0XHRcdHBsYXllci5sZWF2ZV8kZmguaWQgIT0gZmguaWQgJiZcclxuXHRcdFx0XHRwbGF5ZXIubGVhdmVfJGZoLmNoYWluLmlkICE9IGZoLmNoYWluLmlkICYmXHJcblx0XHRcdFx0KHBsYXllci5sZWF2ZV8kZmgucHJldiA9PSBudWxsIHx8IHBsYXllci5sZWF2ZV8kZmgucHJldiAhPSBmaC5pZCkgJiZcclxuXHRcdFx0XHQocGxheWVyLmxlYXZlXyRmaC5uZXh0ID09IG51bGwgfHwgcGxheWVyLmxlYXZlXyRmaC5uZXh0ICE9IGZoLmlkKVxyXG5cdFx0XHQpIHtcclxuXHRcdFx0XHRjb25zdCBmb290ID0gcGxheWVyLmZvb3Rfd2Fsay5HZXRXb3JsZENlbnRlcigpO1xyXG5cdFx0XHRcdG51bVBvaW50cyA9IGNvbnRhY3QuR2V0TWFuaWZvbGQoKS5wb2ludENvdW50O1xyXG5cdFx0XHRcdHdvcmxkTWFuaWZvbGQgPSBuZXcgYjJXb3JsZE1hbmlmb2xkKCk7XHJcblx0XHRcdFx0Y29udGFjdC5HZXRXb3JsZE1hbmlmb2xkKHdvcmxkTWFuaWZvbGQpO1xyXG5cclxuXHRcdFx0XHQvL2NoZWNrIGlmIGNvbnRhY3QgcG9pbnRzIGFyZSBtb3ZpbmcgaW50byBwbGF0Zm9ybVxyXG5cdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUG9pbnRzOyArK2kpIHtcclxuXHRcdFx0XHRcdGNvbnN0IGNwb2ludCA9IHdvcmxkTWFuaWZvbGQucG9pbnRzW2ldO1xyXG5cdFx0XHRcdFx0aWYgKGNwb2ludC55ID4gZm9vdC55KSB7XHJcblx0XHRcdFx0XHRcdHBsYXllci5sZWF2ZV8kZmggPSBudWxsO1xyXG5cdFx0XHRcdFx0XHRwbGF5ZXIuc3RhdGUuZHJvcERvd24gPSBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29udGFjdC5TZXRFbmFibGVkKGZhbHNlKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRwbGF5ZXIuc3RhdGUuZHJvcERvd24gPSBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAocGxheWVyLmxlYXZlXyRmaCAmJiBwbGF5ZXIubGVhdmVfJGZoID09IGZoKSB7XHJcblx0XHRcdGNvbnRhY3QuU2V0RW5hYmxlZChmYWxzZSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgY2NjID0gJGZoICYmIChcclxuXHRcdFx0ZmguaXNfd2FsbCB8fFxyXG5cdFx0XHQoZmggPT0gcGxheWVyLl9mb290aG9sZCAmJiAoZmgueTEgPCAkZmgueTEgfHwgZmgueTIgPCAkZmgueTIpKSB8fFxyXG5cdFx0XHQoZmggIT0gcGxheWVyLl9mb290aG9sZCAmJiAoZmgueTEgPiAkZmgueTEgfHwgZmgueTIgPiAkZmgueTIpKVxyXG5cdFx0KTtcclxuXHRcdGlmIChjY2MgJiYgJGZoICE9IGZoICYmICghcGxheWVyLl8kZmFsbEVkZ2UgfHwgcGxheWVyLl8kZmFsbEVkZ2UgIT0gJGZoKSkge1xyXG5cdFx0XHRpZiAoZmguY2hhaW4uaWQgIT0gJGZoLmNoYWluLmlkICYmXHJcblx0XHRcdFx0KCEkZmgucHJldiB8fCAkZmgueTEgIT0gZmgueTIpICYmXHJcblx0XHRcdFx0KCEkZmgubmV4dCB8fCAkZmgueTIgIT0gZmgueTEpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdHBsYXllci5sZWF2ZV8kZmggPSBmaDtcclxuXHRcdFx0XHRjb250YWN0LlNldEVuYWJsZWQoZmFsc2UpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0aWYgKHBsYXllci5fJGZhbGxFZGdlICYmIHBsYXllci5fJGZhbGxFZGdlID09IGZoKSB7XHJcblx0XHRcdGNvbnRhY3QuU2V0RW5hYmxlZChmYWxzZSk7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCByZWxhdGl2ZV9wb3NpdGlvbiA9IGZoLkdldExvY2FsUG9pbnQocGxheWVyX3BvcywgbmV3IGIyVmVjMigpKTtcclxuXHRcdGNvbnN0IHBsYXRmb3JtRmFjZVkgPSBiMl9wb2x5Z29uUmFkaXVzO1xyXG5cclxuXHRcdGNvbnN0IGZvb3Rfd2lkdGggPSBwbGF5ZXIuY2hhcmFfcHJvZmlsZS5mb290X3dpZHRoO1xyXG5cclxuXHRcdGlmIChudW1Qb2ludHMgPT0gbnVsbCkge1xyXG5cdFx0XHRudW1Qb2ludHMgPSBjb250YWN0LkdldE1hbmlmb2xkKCkucG9pbnRDb3VudDtcclxuXHRcdFx0d29ybGRNYW5pZm9sZCA9IG5ldyBiMldvcmxkTWFuaWZvbGQoKTtcclxuXHRcdFx0Y29udGFjdC5HZXRXb3JsZE1hbmlmb2xkKHdvcmxkTWFuaWZvbGQpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vY2hlY2sgaWYgY29udGFjdCBwb2ludHMgYXJlIG1vdmluZyBpbnRvIHBsYXRmb3JtXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IG51bVBvaW50czsgKytpKSB7XHJcblx0XHRcdGNvbnN0IGNwb2ludCA9IHdvcmxkTWFuaWZvbGQucG9pbnRzW2ldO1xyXG5cdFx0XHRjb25zdCBwb2ludFZlbFBsYXRmb3JtID0gZmguR2V0TGluZWFyVmVsb2NpdHlGcm9tV29ybGRQb2ludChjcG9pbnQsIG5ldyBiMlZlYzIoKSk7XHJcblx0XHRcdGNvbnN0IHBvaW50VmVsT3RoZXIgPSBwbGF5ZXJCb2R5LkdldExpbmVhclZlbG9jaXR5RnJvbVdvcmxkUG9pbnQoY3BvaW50LCBuZXcgYjJWZWMyKCkpO1xyXG5cdFx0XHRjb25zdCBwb2ludCA9IG5ldyBiMlZlYzIocG9pbnRWZWxPdGhlci54IC0gcG9pbnRWZWxQbGF0Zm9ybS54LCBwb2ludFZlbE90aGVyLnkgLSBwb2ludFZlbFBsYXRmb3JtLnkpO1xyXG5cdFx0XHRjb25zdCByZWxhdGl2ZVZlbCA9IGZoLkdldExvY2FsVmVjdG9yKHBvaW50LCBuZXcgYjJWZWMyKCkpO1xyXG5cdFx0XHRjb25zdCByZWxhdGl2ZVBvc2l0aW9uID0gZmguR2V0TG9jYWxQb2ludChjcG9pbnQsIG5ldyBiMlZlYzIoKSk7XHJcblxyXG5cdFx0XHRpZiAocmVsYXRpdmVfcG9zaXRpb24ueSA8PSAtKGZvb3Rfd2lkdGggLSBwbGF0Zm9ybUZhY2VZKSB8fFxyXG5cdFx0XHRcdChjcG9pbnQueSA+IHBsYXllcl9wb3MueSAmJiByZWxhdGl2ZVBvc2l0aW9uLnkgPD0gcGxhdGZvcm1GYWNlWSlcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0aWYgKHJlbGF0aXZlVmVsLnkgPiAxKSB7Ly9pZiBtb3ZpbmcgZG93biBmYXN0ZXIgdGhhbiAxIG0vcywgaGFuZGxlIGFzIGJlZm9yZVxyXG5cdFx0XHRcdFx0Ly9wbGF5ZXIuX2Zvb3Rob2xkID0gZmg7XHJcblx0XHRcdFx0XHRpZiAoZmguaXNfd2FsbCB8fCBwbGF5ZXIuX3doaWNoX2Zvb3Rob2xkX2NvbnRhY3QoZmgsIGNwb2ludCkpIHtcclxuXHRcdFx0XHRcdFx0bm9ybWFsX2NvbnRhY3QoY3BvaW50KTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0Ly9lbHNlIHtcclxuXHRcdFx0XHRcdC8vXHRub3JtYWxfY29udGFjdChjcG9pbnQpO1xyXG5cdFx0XHRcdFx0Ly9cdHJldHVybjsvL25vdCBwcmltYXJ5LCBub3JtYWwgY29udGFjdCBcclxuXHRcdFx0XHRcdC8vfVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIGlmIChyZWxhdGl2ZVZlbC55ID4gLTEpIHsgLy9pZiBtb3Zpbmcgc2xvd2VyIHRoYW4gMSBtL3NcclxuXHRcdFx0XHRcdC8vYm9yZGVybGluZSBjYXNlLCBtb3Zpbmcgb25seSBzbGlnaHRseSBvdXQgb2YgcGxhdGZvcm1cclxuXHRcdFx0XHRcdC8vcGxheWVyLl9mb290aG9sZCA9IGZoO1xyXG5cdFx0XHRcdFx0aWYgKGZoLmlzX3dhbGwgfHwgcGxheWVyLl93aGljaF9mb290aG9sZF9jb250YWN0KGZoLCBjcG9pbnQpKSB7XHJcblx0XHRcdFx0XHRcdGlmICgkZmggJiYgJGZoLmlkICE9IGZoLmlkKSB7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdFx0bm9ybWFsX2NvbnRhY3QoY3BvaW50KTtcclxuXHRcdFx0XHRcdFx0cmV0dXJuOy8vY29udGFjdCBwb2ludCBpcyBsZXNzIHRoYW4gNWNtIGluc2lkZSBmcm9udCBmYWNlIG9mIHBsYXRmcm9tXHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRcdFx0Ly9cdG5vcm1hbF9jb250YWN0KGNwb2ludCk7XHJcblx0XHRcdFx0XHQvL1x0cmV0dXJuOy8vbm90IHByaW1hcnksIG5vcm1hbCBjb250YWN0XHJcblx0XHRcdFx0XHQvL31cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoZmguaXNfd2FsbCkgey8vY29udGFjdCB3YWxsJ3MgdXBwZXIgdmVydGV4XHJcblx0XHRcdFx0XHRjb25zdCBweSA9IHBsYXllcl9wb3MueSAqICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRcdFx0XHRpZiAoZmgueTIgPj0gZmgueTEpIHtcclxuXHRcdFx0XHRcdFx0aWYgKHB5IDw9IGZoLnkxKSB7XHJcblx0XHRcdFx0XHRcdFx0bm9ybWFsX2NvbnRhY3QoY3BvaW50KTtcclxuXHRcdFx0XHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRpZiAocHkgPD0gZmgueTIpIHtcclxuXHRcdFx0XHRcdFx0XHRub3JtYWxfY29udGFjdChjcG9pbnQpO1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8vbm8gcG9pbnRzIGFyZSBtb3ZpbmcgaW50byBwbGF0Zm9ybSwgY29udGFjdCBzaG91bGQgbm90IGJlIHNvbGlkXHJcblx0XHRjb250YWN0LlNldEVuYWJsZWQoZmFsc2UpO1xyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogQHBhcmFtIHtiMlZlYzJ9IGNwb2ludFxyXG5cdFx0ICovXHJcblx0XHRmdW5jdGlvbiBub3JtYWxfY29udGFjdChjcG9pbnQpIHtcclxuXHRcdFx0aWYgKChmaC5wcmV2ID09IG51bGwgJiYgKGNwb2ludC54ICogJGd2LkNBTlZBU19TQ0FMRSkgPCBmaC54MSkgfHxcclxuXHRcdFx0XHQoZmgubmV4dCA9PSBudWxsICYmIChjcG9pbnQueCAqICRndi5DQU5WQVNfU0NBTEUpID4gZmgueDIpXHJcblx0XHRcdCkge1xyXG5cdFx0XHRcdHBsYXllci5zdGF0ZS5qdW1wID0gdHJ1ZTtcclxuXHJcblx0XHRcdFx0cGxheWVyLl8kZmFsbEVkZ2UgPSBmaDtcclxuXHJcblx0XHRcdFx0cGxheWVyLl9mb290aG9sZCA9IG51bGw7XHJcblx0XHRcdFx0cGxheWVyLl9mb290X2F0ID0gbnVsbDtcclxuXHRcdFx0XHQvL1xyXG5cdFx0XHRcdHBsYXllci4kZm9vdGhvbGQgPSBudWxsO1xyXG5cclxuXHRcdFx0XHRjb250YWN0LlNldEVuYWJsZWQoZmFsc2UpO1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyQ29udGFjdH0gY29udGFjdFxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYVxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjaGlsZEluZGV4QVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjaGlsZEluZGV4QlxyXG5cdCAqL1xyXG5cdGVuZENvbnRhY3RfYm9keUJhc2Vfb25ld2F5KGNvbnRhY3QsIGZhLCBmYiwgY2hpbGRJbmRleEEsIGNoaWxkSW5kZXhCKSB7XHJcblx0XHQvKiogQHR5cGUge1BQbGF5ZXJ9ICovXHJcblx0XHRjb25zdCBwbGF5ZXIgPSBmYi5HZXRVc2VyRGF0YSgpO1xyXG5cdFx0aWYgKCFwbGF5ZXIpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7Rm9vdGhvbGR9ICovXHJcblx0XHRjb25zdCBmaCA9IHRoaXMuZ2V0Rm9vdGhvbGRGcm9tQ29udGFjdChjaGlsZEluZGV4QSk7XHJcblxyXG5cdFx0cGxheWVyLnByZXZfJGZoID0gZmg7XHJcblxyXG5cdFx0aWYgKHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QubGVuZ3RoKSB7XHJcblx0XHRcdHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QuZm9yRWFjaCgoZmMsIGkpID0+IHtcclxuXHRcdFx0XHRpZiAoZmMuZm9vdGhvbGQgPT0gZmgpIHtcclxuXHRcdFx0XHRcdHBsYXllci5fZm9vdF9jb250YWN0X2xpc3Quc3BsaWNlKGksIDEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmIChwbGF5ZXIuXyRmYWxsRWRnZSAmJiBmaCA9PSBwbGF5ZXIuXyRmYWxsRWRnZSkge1xyXG5cdFx0XHRwbGF5ZXIuXyRmYWxsRWRnZSA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChwbGF5ZXIuX2Zvb3Rob2xkICYmIGZoID09IHBsYXllci5fZm9vdGhvbGQpIHtcclxuXHRcdFx0aWYgKHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QubGVuZ3RoKSB7XHJcblx0XHRcdFx0cGxheWVyLnByZXZfJGZoID0gcGxheWVyLiRmb290aG9sZDtcclxuXHJcblx0XHRcdFx0bGV0IG1heCA9IHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QucG9wKCk7XHJcblx0XHRcdFx0cGxheWVyLiRmb290aG9sZCA9IG1heC5mb290aG9sZDtcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3Rob2xkID0gbWF4LmZvb3Rob2xkO1xyXG5cdFx0XHRcdHBsYXllci5fZm9vdF9hdCA9IG1heC5wb3NpdGlvbjtcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3Rob2xkX3ByaW9yaXR5ID0gbWF4LnByaW9yaXR5O1xyXG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJlbmQgY29udGFjdDogY29udGFjdCBvbGQgZm9vdGhvbGQ6IGZoID09IHBsYXllci5fZm9vdGhvbGRcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cGxheWVyLl9mb290aG9sZCA9IG51bGw7Ly/mraPluLjpm6LplovlnLDpnaJcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3RfYXQgPSBudWxsO1xyXG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJlbmQgY29udGFjdDog5q2j5bi46Zui6ZaL5Zyw6Z2iOiBmaCA9PSBwbGF5ZXIuX2Zvb3Rob2xkXCIpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmIChwbGF5ZXIuJGZvb3Rob2xkICYmIGZoID09IHBsYXllci4kZm9vdGhvbGQpIHtcclxuXHRcdFx0aWYgKHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QubGVuZ3RoKSB7XHJcblx0XHRcdFx0cGxheWVyLnByZXZfJGZoID0gcGxheWVyLiRmb290aG9sZDtcclxuXHJcblx0XHRcdFx0bGV0IG1heCA9IHBsYXllci5fZm9vdF9jb250YWN0X2xpc3QucG9wKCk7XHJcblx0XHRcdFx0cGxheWVyLiRmb290aG9sZCA9IG1heC5mb290aG9sZDtcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3Rob2xkID0gbWF4LmZvb3Rob2xkO1xyXG5cdFx0XHRcdHBsYXllci5fZm9vdF9hdCA9IG1heC5wb3NpdGlvbjtcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3Rob2xkX3ByaW9yaXR5ID0gbWF4LnByaW9yaXR5O1xyXG5cdFx0XHRcdC8vY29uc29sZS5sb2coXCJlbmQgY29udGFjdDogY29udGFjdCBvbGQgZm9vdGhvbGQ6IGZoID09IHBsYXllci4kZm9vdGhvbGRcIik7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7Ly9hZnRlclN0ZXBcclxuXHRcdFx0XHRpZiAocGxheWVyLl9mb290aG9sZCkge1xyXG5cdFx0XHRcdFx0cGxheWVyLnByZXZfJGZoID0gcGxheWVyLiRmb290aG9sZDtcclxuXHJcblx0XHRcdFx0XHRwbGF5ZXIuJGZvb3Rob2xkID0gcGxheWVyLl9mb290aG9sZDtcclxuXHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJlbmQgY29udGFjdDogY29udGFjdCBvdGhlciBmb290aG9sZFwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRwbGF5ZXIuJGZvb3Rob2xkID0gbnVsbDsvL+ato+W4uOmboumWi+WcsOmdolxyXG5cdFx0XHRcdFx0cGxheWVyLl9mb290X2F0ID0gbnVsbDtcclxuXHRcdFx0XHRcdC8vY29uc29sZS5pbmZvKFwiZW5kIGNvbnRhY3Q6IOato+W4uOmboumWi+WcsOmdojogZmggPT0gcGxheWVyLiRmb290aG9sZFwiKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGlmIChwbGF5ZXIubGVhdmVfJGZoICYmIHBsYXllci5sZWF2ZV8kZmggPT0gZmgpIHtcclxuXHRcdFx0cGxheWVyLmxlYXZlXyRmaCA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YjJDb250YWN0fSBjb250YWN0XHJcblx0ICogQHBhcmFtIHtiMk1hbmlmb2xkfSBvbGRNYW5pZm9sZFxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYVxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjaGlsZEluZGV4QVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjaGlsZEluZGV4QlxyXG5cdCAqL1xyXG5cdHByZVNvbHZlR3JvdW5kX2JvZHlCYXNlX29uZXdheShjb250YWN0LCBvbGRNYW5pZm9sZCwgZmEsIGZiLCBjaGlsZEluZGV4QSwgY2hpbGRJbmRleEIpIHtcclxuXHRcdC8qKiBAdHlwZSB7R3JvdW5kfSAqL1xyXG5cdFx0bGV0IHRoYXQgPSBmYS5HZXRCb2R5KCkuR2V0VXNlckRhdGEoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge0Zvb3Rob2xkfSAqL1xyXG5cdFx0bGV0IHRhcmdldCA9IHRoaXM7XHJcblxyXG5cdFx0dGhhdC5iZWdpbkNvbnRhY3RfYm9keUJhc2Vfb25ld2F5LmNhbGwodGFyZ2V0LCBjb250YWN0LCBmYSwgZmIsIGNoaWxkSW5kZXhBLCBjaGlsZEluZGV4Qik7XHJcblx0XHRcclxuXHRcdC8vaWYgKGNvbnRhY3QuSXNFbmFibGVkKCkgJiYgY29udGFjdC5Jc1RvdWNoaW5nKCkpIHtcclxuXHRcdC8vfVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gd29ybGRcclxuXHQgKi9cclxuXHR1bmxvYWQod29ybGQpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ib2RpZXMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0d29ybGQuRGVzdHJveUJvZHkodGhpcy5ib2RpZXNbaV0pO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5pbml0KCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge29iamVjdH0gZGF0YVxyXG5cdCAqL1xyXG5cdGFkZEZvb3Rob2xkKGRhdGEpIHtcclxuXHRcdHRoaXMuZm9vdGhvbGRzLnB1c2gobmV3IEZvb3Rob2xkKGRhdGEpKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0JGRyYXdEZWJ1Z0luZm8ocmVuZGVyZXIpIHtcclxuXHRcdGlmICgkZ3YubV9kaXNwbGF5X2Zvb3Rob2xkKSB7XHJcblx0XHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHJcblx0XHRcdGN0eC5saW5lSm9pbiA9IFwicm91bmRcIjtcclxuXHRcdFx0Y3R4LmxpbmVDYXAgPSBcInJvdW5kXCI7XHJcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mb290aG9sZHMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHRsZXQgZmggPSB0aGlzLmZvb3Rob2xkc1tpXTtcclxuXHRcdFx0XHRpZiAoZmggPT0gbnVsbCkgey8vbGluZSBlbmRcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRpZiAoZmguJHNob3dEZWJ1Z0luZm8pIHtcclxuXHRcdFx0XHRcdGZoLiRkcmF3RGVidWdJbmZvKHJlbmRlcmVyKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0JHNob3dEZWJ1Z0luZm8obGF5ZXIsIGdyb3VwLCBpc1Nob3csIGlzSGlkZSkge1xyXG5cdFx0aWYgKGlzU2hvdyA9PSBudWxsKSB7XHJcblx0XHRcdGlzU2hvdyA9IHRydWU7XHJcblx0XHR9XHJcblx0XHRpZiAoaXNIaWRlID09IG51bGwpIHtcclxuXHRcdFx0aXNIaWRlID0gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRmb3IgKGxldCBmaCBvZiB0aGlzLmZvb3Rob2xkcykge1xyXG5cdFx0XHRpZiAoZmgubGF5ZXIgPT0gbGF5ZXIgJiYgZmguZ3JvdXAgPT0gZ3JvdXApIHtcclxuXHRcdFx0XHRmaC4kc2hvd0RlYnVnSW5mbyA9IGlzU2hvdztcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRmaC4kc2hvd0RlYnVnSW5mbyA9IGlzSGlkZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHQkc2hvd0RlYnVnSW5mb0J5TGF5ZXIobGF5ZXIsIGlzU2hvdywgaXNIaWRlKSB7XHJcblx0XHRpZiAoaXNTaG93ID09IG51bGwpIHtcclxuXHRcdFx0aXNTaG93ID0gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdGlmIChpc0hpZGUgPT0gbnVsbCkge1xyXG5cdFx0XHRpc0hpZGUgPSBmYWxzZTtcclxuXHRcdH1cclxuXHRcdGZvciAobGV0IGZoIG9mIHRoaXMuZm9vdGhvbGRzKSB7XHJcblx0XHRcdGlmIChmaC5sYXllciA9PSBsYXllcikge1xyXG5cdFx0XHRcdGZoLiRzaG93RGVidWdJbmZvID0gaXNTaG93O1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGZoLiRzaG93RGVidWdJbmZvID0gaXNIaWRlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8vc3RhdGljICRzaG93RGVidWdJbmZvQnlHcm91cCgpIHtcclxuXHQvL31cclxuXHQkaGlkZUFsbERlYnVnSW5mbygpIHtcclxuXHRcdGZvciAobGV0IGZoIG9mIHRoaXMuZm9vdGhvbGRzKSB7XHJcblx0XHRcdGZoLiRzaG93RGVidWdJbmZvID0gZmFsc2U7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5Hcm91bmQuRm9vdGhvbGQgPSBGb290aG9sZDtcclxuXHJcbi8qXHJcbm1hcD0xMDAwMDAwMDBcclxuJCRoaGggPSAtMS41O1xyXG5jbGVhckludGVydmFsKCQkJHNpKVxyXG4kJCRzaSA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNoYXJhLiRwaHlzaWNzLnNldFBvc2l0aW9uKDExMy45Njg3NSwgNy44NDM3NSArICQkaGhoKTtcclxuXHQkJGhoaCArPSAwLjAwNTsvLzEgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdCQkaGhoID0gJCRoaGggPiAyID8gMCA6ICQkaGhoO1xyXG4gICAgY2hhcmEuJHBoeXNpY3MuYm9keS5TZXRBd2FrZSh0cnVlKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIGNoYXJhLiRwaHlzaWNzLnN0YXRlLmp1bXAgPSB0cnVlO1xyXG4gICAgICAgICRndi5pbnB1dF9rZXlEb3duLmYgPSAxO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAkZ3YuaW5wdXRfa2V5RG93bi5mID0gMDtcclxuICAgICAgICAgICAgJGd2LmlucHV0X2tleVVwLmYgPSAxO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICRndi5pbnB1dF9rZXlVcC5mID0gMDtcclxuICAgICAgICAgICAgfSwgNTApO1xyXG4gICAgICAgIH0sIDUwKTtcclxuICAgIH0sIDE0MCk7XHJcbn0sIDEwMDApO1xyXG5cclxuKi9cclxuXHJcbi8qXHJcbm1hcD0xMDAwMDAwMDBcclxuY2hhcmEuJHBoeXNpY3Muc2V0UG9zaXRpb24oNDU4My8zMiszLDM2NC8zMi0zKVxyXG5jaGFyYS4kcGh5c2ljcy5ib2R5Lm1fbGluZWFyVmVsb2NpdHkuU2V0KC0yMiwxNSlcclxuXHJcbiovXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Physics/Ground.js\n");

/***/ }),

/***/ "./src/game/Physics/LadderRope.js":
/*!****************************************!*\
  !*** ./src/game/Physics/LadderRope.js ***!
  \****************************************/
/*! exports provided: MapLadderRope, LadderRope, MapLadderRopeLoader */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MapLadderRope\", function() { return MapLadderRope; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LadderRope\", function() { return LadderRope; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MapLadderRopeLoader\", function() { return MapLadderRopeLoader; });\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _World__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./World */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _PPlayer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Filter_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Filter.js */ \"./src/game/Physics/Filter.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass MapLadderRope {\r\n\tconstructor(raw) {\r\n\t\t/** @type {number} - is ladder ? 1 : 0 */\r\n\t\tthis.l = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.uf = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.x = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.y1 = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.y2 = null;\r\n\r\n\t\t/** @type {number} - ?? */\r\n\t\tthis.page = null;\r\n\r\n\t\t/** @type {number} - select obj from layeredObject[layer] where obj.piece == piece */\r\n\t\tthis.piece = null;\r\n\r\n\t\tObject.assign(this, raw);\r\n\t}\r\n\r\n\tisLadder() {\r\n\t\treturn !!this.l;\r\n\t}\r\n}\r\n\r\n\r\nclass LadderRope extends MapLadderRope {\r\n\tconstructor(raw) {\r\n\t\tsuper(raw);\r\n\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.body = null;\r\n\t}\r\n\r\n\tcalcHeight() {\r\n\t\treturn (this.y2 - this.y1);\r\n\t}\r\n\tcalcHalfHeight() {\r\n\t\treturn (this.y2 - this.y1) * 0.5;\r\n\t}\r\n\tcalcWidth() {\r\n\t\treturn (this.isLadder() ? 16 : 4);\r\n\t}\r\n\tcalcHalfWidth() {\r\n\t\treturn (this.isLadder() ? 16 : 4) * 0.5;\r\n\t}\r\n\tcalcLength() {\r\n\t\treturn (this.y2 - this.y1) / $gv.CANVAS_SCALE;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t */\r\n\t_create(world) {\r\n\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\t\tlet shape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PolygonShape\"]();\r\n\r\n\t\tconst x = this.x / $gv.CANVAS_SCALE;\r\n\t\tconst y1 = this.y1 / $gv.CANVAS_SCALE;\r\n\t\tconst y2 = this.y2 / $gv.CANVAS_SCALE;\r\n\t\tconst hwidth = this.calcHalfWidth() / $gv.CANVAS_SCALE;\r\n\t\tconst hheight = (y2 - y1) * 0.5;\r\n\r\n\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_kinematicBody;//可移動\r\n\t\tbdef.position.Set(x, y1);\r\n\r\n\t\tbdef.angle = 0;\r\n\t\tbdef.gravityScale = 0;\r\n\t\t//bdef.allowSleep = true;\r\n\t\t//bdef.bullet = true;\r\n\t\tbdef.fixedRotation = true;\r\n\t\tbdef.userData = this;\r\n\r\n\t\tthis.body = world.CreateBody(bdef);\r\n\r\n\t\tshape.SetAsBox(hwidth, hheight + 0.5, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, hheight - 0.5), 0);\r\n\r\n\t\tfdef.shape = shape;\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_3__[\"FilterHelper\"].get(\"ladder\"));\r\n\r\n\t\tfdef.isSensor = true;\r\n\t\tfdef.userData = this;\r\n\r\n\t\tlet fixture = this.body.CreateFixture(fdef);\r\n\r\n\t\tfixture.beginContact = this.beginContact.bind(this);\r\n\t\tfixture.endContact = this.endContact.bind(this);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Fixture} fa\r\n\t * @param {b2Fixture} fb\r\n\t */\r\n\tbeginContact(contact, fa, fb) {\r\n\t\t/** @type {PPlayer} */\r\n\t\tconst targetPlayer = fb.m_userData;\r\n\t\tif (!targetPlayer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!targetPlayer.state.ladder) {\r\n\t\t\ttargetPlayer.contactLadder(this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Fixture} fa\r\n\t * @param {b2Fixture} fb\r\n\t */\r\n\tendContact(contact, fa, fb) {\r\n\t\t/** @type {PPlayer} */\r\n\t\tconst targetPlayer = fb.m_userData;\r\n\t\tif (!targetPlayer) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttargetPlayer.leaveLadder();\r\n\t}\r\n}\r\n\r\n\r\nclass MapLadderRopeLoader {\r\n\t/**\r\n\t * @param {{[prop:string]:any}} map_raw_data\r\n\t * @param {World} world\r\n\t * @returns {LadderRope[]}\r\n\t */\r\n\tstatic load(map_raw_data, world) {\r\n\t\t/** @type {LadderRope[]} */\r\n\t\tlet ladderRopes = [];\r\n\r\n\t\tfor (let i in map_raw_data.ladderRope) {\r\n\t\t\tlet raw = map_raw_data.ladderRope[i];\r\n\t\t\tlet idx = parseInt(i, 10) - 1;\r\n\t\t\tif (idx >= 0 && Number.isSafeInteger(idx)) {\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t//TODO: ?? ladderRope\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t\tlet ladderRope = new LadderRope(raw);\r\n\t\t\tladderRope._$index = i;\r\n\t\t\tladderRope._create(world);\r\n\t\t\tladderRopes.push(ladderRope);\r\n\t\t};\r\n\r\n\t\treturn ladderRopes;\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL0xhZGRlclJvcGUuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9QaHlzaWNzL0xhZGRlclJvcGUuanM/MzU5YyJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHtcclxuXHRiMl9saW5lYXJTbG9wLFxyXG5cdGIyVmVjMixcclxuXHRiMkJvZHlUeXBlLCBiMkJvZHlEZWYsIGIyRml4dHVyZURlZixcclxuXHRiMlBvbHlnb25TaGFwZSwgYjJFZGdlU2hhcGUsXHJcblx0YjJCb2R5LFxyXG5cdGIyQ29udGFjdCwgYjJNYW5pZm9sZCwgYjJDb250YWN0SW1wdWxzZSwgYjJXb3JsZE1hbmlmb2xkXHJcbn0gZnJvbSBcIi4vUGh5c2ljcy5qc1wiO1xyXG5cclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi9Xb3JsZFwiO1xyXG5pbXBvcnQgeyBQUGxheWVyIH0gZnJvbSBcIi4vUFBsYXllci5qc1wiO1xyXG5pbXBvcnQgeyBGaWx0ZXJIZWxwZXIgfSBmcm9tIFwiLi9GaWx0ZXIuanNcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgTWFwTGFkZGVyUm9wZSB7XHJcblx0Y29uc3RydWN0b3IocmF3KSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBpcyBsYWRkZXIgPyAxIDogMCAqL1xyXG5cdFx0dGhpcy5sID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMudWYgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy54ID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMueTEgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy55MiA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gPz8gKi9cclxuXHRcdHRoaXMucGFnZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gc2VsZWN0IG9iaiBmcm9tIGxheWVyZWRPYmplY3RbbGF5ZXJdIHdoZXJlIG9iai5waWVjZSA9PSBwaWVjZSAqL1xyXG5cdFx0dGhpcy5waWVjZSA9IG51bGw7XHJcblxyXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCByYXcpO1xyXG5cdH1cclxuXHJcblx0aXNMYWRkZXIoKSB7XHJcblx0XHRyZXR1cm4gISF0aGlzLmw7XHJcblx0fVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIExhZGRlclJvcGUgZXh0ZW5kcyBNYXBMYWRkZXJSb3BlIHtcclxuXHRjb25zdHJ1Y3RvcihyYXcpIHtcclxuXHRcdHN1cGVyKHJhdyk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtiMkJvZHl9ICovXHJcblx0XHR0aGlzLmJvZHkgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0Y2FsY0hlaWdodCgpIHtcclxuXHRcdHJldHVybiAodGhpcy55MiAtIHRoaXMueTEpO1xyXG5cdH1cclxuXHRjYWxjSGFsZkhlaWdodCgpIHtcclxuXHRcdHJldHVybiAodGhpcy55MiAtIHRoaXMueTEpICogMC41O1xyXG5cdH1cclxuXHRjYWxjV2lkdGgoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMuaXNMYWRkZXIoKSA/IDE2IDogNCk7XHJcblx0fVxyXG5cdGNhbGNIYWxmV2lkdGgoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMuaXNMYWRkZXIoKSA/IDE2IDogNCkgKiAwLjU7XHJcblx0fVxyXG5cdGNhbGNMZW5ndGgoKSB7XHJcblx0XHRyZXR1cm4gKHRoaXMueTIgLSB0aGlzLnkxKSAvICRndi5DQU5WQVNfU0NBTEU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1dvcmxkfSB3b3JsZFxyXG5cdCAqL1xyXG5cdF9jcmVhdGUod29ybGQpIHtcclxuXHRcdGxldCBiZGVmID0gbmV3IGIyQm9keURlZigpO1xyXG5cdFx0bGV0IGZkZWYgPSBuZXcgYjJGaXh0dXJlRGVmKCk7XHJcblx0XHRsZXQgc2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGUoKTtcclxuXHJcblx0XHRjb25zdCB4ID0gdGhpcy54IC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdGNvbnN0IHkxID0gdGhpcy55MSAvICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRjb25zdCB5MiA9IHRoaXMueTIgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0Y29uc3QgaHdpZHRoID0gdGhpcy5jYWxjSGFsZldpZHRoKCkgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0Y29uc3QgaGhlaWdodCA9ICh5MiAtIHkxKSAqIDAuNTtcclxuXHJcblx0XHRiZGVmLnR5cGUgPSBiMkJvZHlUeXBlLmIyX2tpbmVtYXRpY0JvZHk7Ly/lj6/np7vli5VcclxuXHRcdGJkZWYucG9zaXRpb24uU2V0KHgsIHkxKTtcclxuXHJcblx0XHRiZGVmLmFuZ2xlID0gMDtcclxuXHRcdGJkZWYuZ3Jhdml0eVNjYWxlID0gMDtcclxuXHRcdC8vYmRlZi5hbGxvd1NsZWVwID0gdHJ1ZTtcclxuXHRcdC8vYmRlZi5idWxsZXQgPSB0cnVlO1xyXG5cdFx0YmRlZi5maXhlZFJvdGF0aW9uID0gdHJ1ZTtcclxuXHRcdGJkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cclxuXHRcdHRoaXMuYm9keSA9IHdvcmxkLkNyZWF0ZUJvZHkoYmRlZik7XHJcblxyXG5cdFx0c2hhcGUuU2V0QXNCb3goaHdpZHRoLCBoaGVpZ2h0ICsgMC41LCBuZXcgYjJWZWMyKDAsIGhoZWlnaHQgLSAwLjUpLCAwKTtcclxuXHJcblx0XHRmZGVmLnNoYXBlID0gc2hhcGU7XHJcblx0XHRmZGVmLmZpbHRlci5Db3B5KEZpbHRlckhlbHBlci5nZXQoXCJsYWRkZXJcIikpO1xyXG5cclxuXHRcdGZkZWYuaXNTZW5zb3IgPSB0cnVlO1xyXG5cdFx0ZmRlZi51c2VyRGF0YSA9IHRoaXM7XHJcblxyXG5cdFx0bGV0IGZpeHR1cmUgPSB0aGlzLmJvZHkuQ3JlYXRlRml4dHVyZShmZGVmKTtcclxuXHJcblx0XHRmaXh0dXJlLmJlZ2luQ29udGFjdCA9IHRoaXMuYmVnaW5Db250YWN0LmJpbmQodGhpcyk7XHJcblx0XHRmaXh0dXJlLmVuZENvbnRhY3QgPSB0aGlzLmVuZENvbnRhY3QuYmluZCh0aGlzKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YjJDb250YWN0fSBjb250YWN0XHJcblx0ICogQHBhcmFtIHtiMkZpeHR1cmV9IGZhXHJcblx0ICogQHBhcmFtIHtiMkZpeHR1cmV9IGZiXHJcblx0ICovXHJcblx0YmVnaW5Db250YWN0KGNvbnRhY3QsIGZhLCBmYikge1xyXG5cdFx0LyoqIEB0eXBlIHtQUGxheWVyfSAqL1xyXG5cdFx0Y29uc3QgdGFyZ2V0UGxheWVyID0gZmIubV91c2VyRGF0YTtcclxuXHRcdGlmICghdGFyZ2V0UGxheWVyKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIXRhcmdldFBsYXllci5zdGF0ZS5sYWRkZXIpIHtcclxuXHRcdFx0dGFyZ2V0UGxheWVyLmNvbnRhY3RMYWRkZXIodGhpcyk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyQ29udGFjdH0gY29udGFjdFxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYVxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYlxyXG5cdCAqL1xyXG5cdGVuZENvbnRhY3QoY29udGFjdCwgZmEsIGZiKSB7XHJcblx0XHQvKiogQHR5cGUge1BQbGF5ZXJ9ICovXHJcblx0XHRjb25zdCB0YXJnZXRQbGF5ZXIgPSBmYi5tX3VzZXJEYXRhO1xyXG5cdFx0aWYgKCF0YXJnZXRQbGF5ZXIpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRhcmdldFBsYXllci5sZWF2ZUxhZGRlcigpO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBNYXBMYWRkZXJSb3BlTG9hZGVyIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3tbcHJvcDpzdHJpbmddOmFueX19IG1hcF9yYXdfZGF0YVxyXG5cdCAqIEBwYXJhbSB7V29ybGR9IHdvcmxkXHJcblx0ICogQHJldHVybnMge0xhZGRlclJvcGVbXX1cclxuXHQgKi9cclxuXHRzdGF0aWMgbG9hZChtYXBfcmF3X2RhdGEsIHdvcmxkKSB7XHJcblx0XHQvKiogQHR5cGUge0xhZGRlclJvcGVbXX0gKi9cclxuXHRcdGxldCBsYWRkZXJSb3BlcyA9IFtdO1xyXG5cclxuXHRcdGZvciAobGV0IGkgaW4gbWFwX3Jhd19kYXRhLmxhZGRlclJvcGUpIHtcclxuXHRcdFx0bGV0IHJhdyA9IG1hcF9yYXdfZGF0YS5sYWRkZXJSb3BlW2ldO1xyXG5cdFx0XHRsZXQgaWR4ID0gcGFyc2VJbnQoaSwgMTApIC0gMTtcclxuXHRcdFx0aWYgKGlkeCA+PSAwICYmIE51bWJlci5pc1NhZmVJbnRlZ2VyKGlkeCkpIHtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHQvL1RPRE86ID8/IGxhZGRlclJvcGVcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0fVxyXG5cdFx0XHRsZXQgbGFkZGVyUm9wZSA9IG5ldyBMYWRkZXJSb3BlKHJhdyk7XHJcblx0XHRcdGxhZGRlclJvcGUuXyRpbmRleCA9IGk7XHJcblx0XHRcdGxhZGRlclJvcGUuX2NyZWF0ZSh3b3JsZCk7XHJcblx0XHRcdGxhZGRlclJvcGVzLnB1c2gobGFkZGVyUm9wZSk7XHJcblx0XHR9O1xyXG5cclxuXHRcdHJldHVybiBsYWRkZXJSb3BlcztcclxuXHR9XHJcbn1cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Physics/LadderRope.js\n");

/***/ }),

/***/ "./src/game/Physics/PBullet.js":
/*!*************************************!*\
  !*** ./src/game/Physics/PBullet.js ***!
  \*************************************/
/*! exports provided: PBullet, BaseBulletMoveFunc */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PBullet\", function() { return PBullet; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BaseBulletMoveFunc\", function() { return BaseBulletMoveFunc; });\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _World_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./World.js */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _PPlayer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Skill_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../Skill.js */ \"./src/game/Skill.js\");\n/* harmony import */ var _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../Common/AttackInfo.js */ \"./src/Common/AttackInfo.js\");\n/* harmony import */ var _SceneCharacter_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../SceneCharacter.js */ \"./src/game/SceneCharacter.js\");\n/* harmony import */ var _Filter_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Filter.js */ \"./src/game/Physics/Filter.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//?? SceneCharacter, SceneRemoteCharacter\r\n\r\n\r\n\r\nclass PBullet {\r\n\t/**\r\n\t * @param {PPlayer} owner\r\n\t * @param {SceneSkill} skill\r\n\t * @param {SkillEffectAnimation} bulletRenderer\r\n\t */\r\n\tconstructor(owner, skill, bulletRenderer) {\r\n\t\tif (false) {}\r\n\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis.owner = owner;\r\n\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {SceneSkill} */\r\n\t\tthis.skill = skill;\r\n\r\n\t\t/** @type {SkillEffectAnimation} */\r\n\t\tthis.bulletRenderer = bulletRenderer;\r\n\r\n\t\t/** @type {BaseBulletMoveFunc} */\r\n\t\tthis.bulletMoveFunc = null;\r\n\r\n\t\t/** @type {-1|1} */\r\n\t\tthis.front = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Partial<FixtureContactListener>=} listener\r\n\t */\r\n\t_create(listener) {\r\n\t\tconst world = this.owner.body.GetWorld();\r\n\r\n\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_1__[\"b2BodyDef\"]();\r\n\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_1__[\"b2FixtureDef\"]();\r\n\t\tlet shape = new _Physics_js__WEBPACK_IMPORTED_MODULE_1__[\"b2PolygonShape\"]();\r\n\r\n\t\tconst cx = (this.bulletRenderer.textures[0]._raw.__w * 0.5) / $gv.CANVAS_SCALE;\r\n\t\tconst cy = (this.bulletRenderer.textures[0]._raw.__h * 0.5) / $gv.CANVAS_SCALE;\r\n\r\n\t\tlet { x, y } = this.owner.body.GetWorldCenter();\r\n\t\tconst front = this.owner.state.front;\r\n\r\n\t\t//TODO: set bullet position, front, angle\r\n\r\n\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_1__[\"b2BodyType\"].b2_kinematicBody;\r\n\t\tif (front > 0) {\r\n\t\t\tbdef.position.Set(x + cx, y);\r\n\t\t}\r\n\t\telse if (front < 0) {\r\n\t\t\tbdef.position.Set(x - cx, y);\r\n\t\t}\r\n\t\telse {//?? center position\r\n\t\t\tbdef.position.Set(x, y);\r\n\t\t}\r\n\t\tbdef.angle = 0;//???\r\n\t\tbdef.gravityScale = 0;\r\n\t\tbdef.allowSleep = false;\r\n\t\tbdef.bullet = true;\r\n\t\tbdef.fixedRotation = true;\r\n\t\tbdef.userData = this;\r\n\r\n\t\tthis.body = world.CreateBody(bdef);\r\n\r\n\t\tshape.SetAsBox(cx, cy);//renderer origin is center\r\n\t\t\r\n\t\t//TODO: implement filter: player_bullet\r\n\t\tfdef.shape = shape;\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_7__[\"FilterHelper\"].get(\"bullet\"));\r\n\t\t//fdef.filter.Copy(FilterHelper.get(\"pvp_bullet\"));\r\n\t\t\r\n\t\tfdef.userData = this;\r\n\r\n\t\tlet fixture = this.body.CreateFixture(fdef);\r\n\r\n\t\tif (listener) {\r\n\t\t\tObject.keys(_Physics_js__WEBPACK_IMPORTED_MODULE_1__[\"FixtureContactListener\"].prototype).forEach(key => fixture[key] = listener[key]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfixture.preSolve = bullet_default_preSolve;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tgetPosition() {\r\n\t\treturn this.body.GetPosition();\r\n\t}\r\n\r\n\t/**\r\n\t * default is horizontal move front\r\n\t * @param {BaseBulletMoveFunc=} bulletMoveFunc\r\n\t * @param {number=} linearVelocityX - unit is meter\r\n\t * @param {number=} linearVelocityY - unit is meter\r\n\t */\r\n\tlaunch(bulletMoveFunc, linearVelocityX, linearVelocityY) {\r\n\t\tif (bulletMoveFunc) {\r\n\t\t\tdebugger;\r\n\r\n\t\t\tthis.bulletMoveFunc = bulletMoveFunc;\r\n\t\t\t//TODO: this.bulletMoveFunc.Step\r\n\t\t\t//TODO: this.bulletMoveFunc.AfterStep\r\n\r\n\t\t\tthis.body.addStep(bulletMoveFunc.Step.bind(bulletMoveFunc, this));\r\n\t\t\tthis.body.addAfterStep(bulletMoveFunc.AfterStep.bind(bulletMoveFunc, this));\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.body.m_linearVelocity.Set(linearVelocityX, linearVelocityY);\r\n\r\n\t\t\t//TODO: time to live, range limit\r\n\t\t\tif (true) {\r\n\t\t\t\tthis.body.AfterStep = () => {\r\n\t\t\t\t\tthis.$tick = (this.$tick | 0) + 1;\r\n\t\t\t\t\tif (this.$tick > (window.$FIRE_BULLET_TIME_TO_LIVE || 60)) {\r\n\t\t\t\t\t\tthis.bulletRenderer.destroy();\r\n\t\t\t\t\t\tthis.destroy();\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tif (this.body) {\r\n\t\t\tthis.body.m_world.DestroyBody(this.body);\r\n\t\t\tthis.body = null;\r\n\r\n\t\t\t//this.bulletRenderer.destroy();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {b2Contact} contact\r\n * @param {b2Manifold} oldManifold\r\n * @param {b2Fixture} fa\r\n * @param {b2Fixture} fb\r\n */\r\nfunction bullet_default_preSolve(contact, oldManifold, fa, fb) {\r\n\t/** @type {PPlayer} */\r\n\tconst targetPlayer = fb.m_userData;\r\n\tif (!targetPlayer) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/** @type {BaseSceneCharacter} */\r\n\tconst targetChara = targetPlayer.chara;//not implement yet\r\n\tif (!targetChara) {\r\n\t\treturn;\r\n\t}\r\n\r\n\t/** @type {PBullet} */\r\n\tconst that = fa.m_userData;\r\n\r\n\t/** @type {PPlayer} */\r\n\tconst ownerPlayer = that.owner;\r\n\t\r\n\t//not from self\r\n\tif (ownerPlayer == targetPlayer) {\r\n\t\treturn;\r\n\t}\r\n\tthat.skill.addAttack(targetChara);\r\n\r\n\tcontact.SetEnabled(false);\r\n\r\n\tthat.bulletRenderer.destroy();\r\n\tthat.destroy();\r\n}\r\n\r\n\r\n/**\r\n * 子彈的移動方式\r\n */\r\nclass BaseBulletMoveFunc {\r\n\tconstructor() {\r\n\t}\r\n\r\n\t//TODO: base bullet move function\r\n\r\n\t/**\r\n\t * @param {PBullet} bullet\r\n\t */\r\n\tinit(bullet) {\r\n\t}\r\n\r\n\t/**\r\n\t * before update\r\n\t * @param {PBullet} bullet\r\n\t */\r\n\tStep(bullet) {\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PBullet} bullet\r\n\t */\r\n\tAfterStep(bullet) {\r\n\t}\r\n}\r\n\r\n\r\n\t///**\r\n\t// * b2Vec2(meter) to Vec2 (pixel)\r\n\t// * @returns {Vec2}\r\n\t// */\r\n\t//getPosition() { }//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL1BCdWxsZXQuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9QaHlzaWNzL1BCdWxsZXQuanM/ZGI0YyJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgUmVjdGFuZ2xlLCBWZWMyIH0gZnJvbSBcIi4uL21hdGguanNcIjtcclxuXHJcbmltcG9ydCB7XHJcblx0YjJWZWMyLFxyXG5cdGIyQm9keVR5cGUsIGIyQm9keURlZiwgYjJGaXh0dXJlRGVmLFxyXG5cdGIyQm9keSwgYjJGaXh0dXJlLFxyXG5cdGIyUG9seWdvblNoYXBlLCBiMkNpcmNsZVNoYXBlLFxyXG5cdGIyQ29udGFjdCwgYjJNYW5pZm9sZCxcclxuXHRGaXh0dXJlQ29udGFjdExpc3RlbmVyLFxyXG59IGZyb20gXCIuL1BoeXNpY3MuanNcIjtcclxuXHJcbmltcG9ydCB7IFdvcmxkIH0gZnJvbSBcIi4vV29ybGQuanNcIjtcclxuXHJcbmltcG9ydCB7IFBQbGF5ZXIgfSBmcm9tIFwiLi9QUGxheWVyLmpzXCI7XHJcbmltcG9ydCB7IFNjZW5lU2tpbGwsIFNraWxsRWZmZWN0QW5pbWF0aW9uIH0gZnJvbSBcIi4uL1NraWxsLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBBdHRhY2tJbmZvIH0gZnJvbSBcIi4uLy4uL0NvbW1vbi9BdHRhY2tJbmZvLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBCYXNlU2NlbmVDaGFyYWN0ZXIgfSBmcm9tIFwiLi4vU2NlbmVDaGFyYWN0ZXIuanNcIjsvLz8/IFNjZW5lQ2hhcmFjdGVyLCBTY2VuZVJlbW90ZUNoYXJhY3RlclxyXG5pbXBvcnQgeyBGaWx0ZXJIZWxwZXIgfSBmcm9tIFwiLi9GaWx0ZXIuanNcIjtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUEJ1bGxldCB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQUGxheWVyfSBvd25lclxyXG5cdCAqIEBwYXJhbSB7U2NlbmVTa2lsbH0gc2tpbGxcclxuXHQgKiBAcGFyYW0ge1NraWxsRWZmZWN0QW5pbWF0aW9ufSBidWxsZXRSZW5kZXJlclxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKG93bmVyLCBza2lsbCwgYnVsbGV0UmVuZGVyZXIpIHtcclxuXHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdGlmICghb3duZXIgfHwgIXNraWxsIHx8ICFidWxsZXRSZW5kZXJlcikge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdGFsZXJ0KFwibmV3IFBCdWxsZXQob3duZXIsIHNraWxsKVwiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7UFBsYXllcn0gKi9cclxuXHRcdHRoaXMub3duZXIgPSBvd25lcjtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyQm9keX0gKi9cclxuXHRcdHRoaXMuYm9keSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTY2VuZVNraWxsfSAqL1xyXG5cdFx0dGhpcy5za2lsbCA9IHNraWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7U2tpbGxFZmZlY3RBbmltYXRpb259ICovXHJcblx0XHR0aGlzLmJ1bGxldFJlbmRlcmVyID0gYnVsbGV0UmVuZGVyZXI7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtCYXNlQnVsbGV0TW92ZUZ1bmN9ICovXHJcblx0XHR0aGlzLmJ1bGxldE1vdmVGdW5jID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUgey0xfDF9ICovXHJcblx0XHR0aGlzLmZyb250ID0gMTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UGFydGlhbDxGaXh0dXJlQ29udGFjdExpc3RlbmVyPj19IGxpc3RlbmVyXHJcblx0ICovXHJcblx0X2NyZWF0ZShsaXN0ZW5lcikge1xyXG5cdFx0Y29uc3Qgd29ybGQgPSB0aGlzLm93bmVyLmJvZHkuR2V0V29ybGQoKTtcclxuXHJcblx0XHRsZXQgYmRlZiA9IG5ldyBiMkJvZHlEZWYoKTtcclxuXHRcdGxldCBmZGVmID0gbmV3IGIyRml4dHVyZURlZigpO1xyXG5cdFx0bGV0IHNoYXBlID0gbmV3IGIyUG9seWdvblNoYXBlKCk7XHJcblxyXG5cdFx0Y29uc3QgY3ggPSAodGhpcy5idWxsZXRSZW5kZXJlci50ZXh0dXJlc1swXS5fcmF3Ll9fdyAqIDAuNSkgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0Y29uc3QgY3kgPSAodGhpcy5idWxsZXRSZW5kZXJlci50ZXh0dXJlc1swXS5fcmF3Ll9faCAqIDAuNSkgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cclxuXHRcdGxldCB7IHgsIHkgfSA9IHRoaXMub3duZXIuYm9keS5HZXRXb3JsZENlbnRlcigpO1xyXG5cdFx0Y29uc3QgZnJvbnQgPSB0aGlzLm93bmVyLnN0YXRlLmZyb250O1xyXG5cclxuXHRcdC8vVE9ETzogc2V0IGJ1bGxldCBwb3NpdGlvbiwgZnJvbnQsIGFuZ2xlXHJcblxyXG5cdFx0YmRlZi50eXBlID0gYjJCb2R5VHlwZS5iMl9raW5lbWF0aWNCb2R5O1xyXG5cdFx0aWYgKGZyb250ID4gMCkge1xyXG5cdFx0XHRiZGVmLnBvc2l0aW9uLlNldCh4ICsgY3gsIHkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAoZnJvbnQgPCAwKSB7XHJcblx0XHRcdGJkZWYucG9zaXRpb24uU2V0KHggLSBjeCwgeSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHsvLz8/IGNlbnRlciBwb3NpdGlvblxyXG5cdFx0XHRiZGVmLnBvc2l0aW9uLlNldCh4LCB5KTtcclxuXHRcdH1cclxuXHRcdGJkZWYuYW5nbGUgPSAwOy8vPz8/XHJcblx0XHRiZGVmLmdyYXZpdHlTY2FsZSA9IDA7XHJcblx0XHRiZGVmLmFsbG93U2xlZXAgPSBmYWxzZTtcclxuXHRcdGJkZWYuYnVsbGV0ID0gdHJ1ZTtcclxuXHRcdGJkZWYuZml4ZWRSb3RhdGlvbiA9IHRydWU7XHJcblx0XHRiZGVmLnVzZXJEYXRhID0gdGhpcztcclxuXHJcblx0XHR0aGlzLmJvZHkgPSB3b3JsZC5DcmVhdGVCb2R5KGJkZWYpO1xyXG5cclxuXHRcdHNoYXBlLlNldEFzQm94KGN4LCBjeSk7Ly9yZW5kZXJlciBvcmlnaW4gaXMgY2VudGVyXHJcblx0XHRcclxuXHRcdC8vVE9ETzogaW1wbGVtZW50IGZpbHRlcjogcGxheWVyX2J1bGxldFxyXG5cdFx0ZmRlZi5zaGFwZSA9IHNoYXBlO1xyXG5cdFx0ZmRlZi5maWx0ZXIuQ29weShGaWx0ZXJIZWxwZXIuZ2V0KFwiYnVsbGV0XCIpKTtcclxuXHRcdC8vZmRlZi5maWx0ZXIuQ29weShGaWx0ZXJIZWxwZXIuZ2V0KFwicHZwX2J1bGxldFwiKSk7XHJcblx0XHRcclxuXHRcdGZkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cclxuXHRcdGxldCBmaXh0dXJlID0gdGhpcy5ib2R5LkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblxyXG5cdFx0aWYgKGxpc3RlbmVyKSB7XHJcblx0XHRcdE9iamVjdC5rZXlzKEZpeHR1cmVDb250YWN0TGlzdGVuZXIucHJvdG90eXBlKS5mb3JFYWNoKGtleSA9PiBmaXh0dXJlW2tleV0gPSBsaXN0ZW5lcltrZXldKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRmaXh0dXJlLnByZVNvbHZlID0gYnVsbGV0X2RlZmF1bHRfcHJlU29sdmU7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRoaXM7XHJcblx0fVxyXG5cclxuXHRnZXRQb3NpdGlvbigpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvZHkuR2V0UG9zaXRpb24oKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGRlZmF1bHQgaXMgaG9yaXpvbnRhbCBtb3ZlIGZyb250XHJcblx0ICogQHBhcmFtIHtCYXNlQnVsbGV0TW92ZUZ1bmM9fSBidWxsZXRNb3ZlRnVuY1xyXG5cdCAqIEBwYXJhbSB7bnVtYmVyPX0gbGluZWFyVmVsb2NpdHlYIC0gdW5pdCBpcyBtZXRlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyPX0gbGluZWFyVmVsb2NpdHlZIC0gdW5pdCBpcyBtZXRlclxyXG5cdCAqL1xyXG5cdGxhdW5jaChidWxsZXRNb3ZlRnVuYywgbGluZWFyVmVsb2NpdHlYLCBsaW5lYXJWZWxvY2l0eVkpIHtcclxuXHRcdGlmIChidWxsZXRNb3ZlRnVuYykge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHJcblx0XHRcdHRoaXMuYnVsbGV0TW92ZUZ1bmMgPSBidWxsZXRNb3ZlRnVuYztcclxuXHRcdFx0Ly9UT0RPOiB0aGlzLmJ1bGxldE1vdmVGdW5jLlN0ZXBcclxuXHRcdFx0Ly9UT0RPOiB0aGlzLmJ1bGxldE1vdmVGdW5jLkFmdGVyU3RlcFxyXG5cclxuXHRcdFx0dGhpcy5ib2R5LmFkZFN0ZXAoYnVsbGV0TW92ZUZ1bmMuU3RlcC5iaW5kKGJ1bGxldE1vdmVGdW5jLCB0aGlzKSk7XHJcblx0XHRcdHRoaXMuYm9keS5hZGRBZnRlclN0ZXAoYnVsbGV0TW92ZUZ1bmMuQWZ0ZXJTdGVwLmJpbmQoYnVsbGV0TW92ZUZ1bmMsIHRoaXMpKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLmJvZHkubV9saW5lYXJWZWxvY2l0eS5TZXQobGluZWFyVmVsb2NpdHlYLCBsaW5lYXJWZWxvY2l0eVkpO1xyXG5cclxuXHRcdFx0Ly9UT0RPOiB0aW1lIHRvIGxpdmUsIHJhbmdlIGxpbWl0XHJcblx0XHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdFx0dGhpcy5ib2R5LkFmdGVyU3RlcCA9ICgpID0+IHtcclxuXHRcdFx0XHRcdHRoaXMuJHRpY2sgPSAodGhpcy4kdGljayB8IDApICsgMTtcclxuXHRcdFx0XHRcdGlmICh0aGlzLiR0aWNrID4gKHdpbmRvdy4kRklSRV9CVUxMRVRfVElNRV9UT19MSVZFIHx8IDYwKSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLmJ1bGxldFJlbmRlcmVyLmRlc3Ryb3koKTtcclxuXHRcdFx0XHRcdFx0dGhpcy5kZXN0cm95KCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0ZGVzdHJveSgpIHtcclxuXHRcdGlmICh0aGlzLmJvZHkpIHtcclxuXHRcdFx0dGhpcy5ib2R5Lm1fd29ybGQuRGVzdHJveUJvZHkodGhpcy5ib2R5KTtcclxuXHRcdFx0dGhpcy5ib2R5ID0gbnVsbDtcclxuXHJcblx0XHRcdC8vdGhpcy5idWxsZXRSZW5kZXJlci5kZXN0cm95KCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtiMkNvbnRhY3R9IGNvbnRhY3RcclxuICogQHBhcmFtIHtiMk1hbmlmb2xkfSBvbGRNYW5pZm9sZFxyXG4gKiBAcGFyYW0ge2IyRml4dHVyZX0gZmFcclxuICogQHBhcmFtIHtiMkZpeHR1cmV9IGZiXHJcbiAqL1xyXG5mdW5jdGlvbiBidWxsZXRfZGVmYXVsdF9wcmVTb2x2ZShjb250YWN0LCBvbGRNYW5pZm9sZCwgZmEsIGZiKSB7XHJcblx0LyoqIEB0eXBlIHtQUGxheWVyfSAqL1xyXG5cdGNvbnN0IHRhcmdldFBsYXllciA9IGZiLm1fdXNlckRhdGE7XHJcblx0aWYgKCF0YXJnZXRQbGF5ZXIpIHtcclxuXHRcdHJldHVybjtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7QmFzZVNjZW5lQ2hhcmFjdGVyfSAqL1xyXG5cdGNvbnN0IHRhcmdldENoYXJhID0gdGFyZ2V0UGxheWVyLmNoYXJhOy8vbm90IGltcGxlbWVudCB5ZXRcclxuXHRpZiAoIXRhcmdldENoYXJhKSB7XHJcblx0XHRyZXR1cm47XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge1BCdWxsZXR9ICovXHJcblx0Y29uc3QgdGhhdCA9IGZhLm1fdXNlckRhdGE7XHJcblxyXG5cdC8qKiBAdHlwZSB7UFBsYXllcn0gKi9cclxuXHRjb25zdCBvd25lclBsYXllciA9IHRoYXQub3duZXI7XHJcblx0XHJcblx0Ly9ub3QgZnJvbSBzZWxmXHJcblx0aWYgKG93bmVyUGxheWVyID09IHRhcmdldFBsYXllcikge1xyXG5cdFx0cmV0dXJuO1xyXG5cdH1cclxuXHR0aGF0LnNraWxsLmFkZEF0dGFjayh0YXJnZXRDaGFyYSk7XHJcblxyXG5cdGNvbnRhY3QuU2V0RW5hYmxlZChmYWxzZSk7XHJcblxyXG5cdHRoYXQuYnVsbGV0UmVuZGVyZXIuZGVzdHJveSgpO1xyXG5cdHRoYXQuZGVzdHJveSgpO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIOWtkOW9iOeahOenu+WLleaWueW8j1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEJhc2VCdWxsZXRNb3ZlRnVuYyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0fVxyXG5cclxuXHQvL1RPRE86IGJhc2UgYnVsbGV0IG1vdmUgZnVuY3Rpb25cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQQnVsbGV0fSBidWxsZXRcclxuXHQgKi9cclxuXHRpbml0KGJ1bGxldCkge1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogYmVmb3JlIHVwZGF0ZVxyXG5cdCAqIEBwYXJhbSB7UEJ1bGxldH0gYnVsbGV0XHJcblx0ICovXHJcblx0U3RlcChidWxsZXQpIHtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UEJ1bGxldH0gYnVsbGV0XHJcblx0ICovXHJcblx0QWZ0ZXJTdGVwKGJ1bGxldCkge1xyXG5cdH1cclxufVxyXG5cclxuXHJcblx0Ly8vKipcclxuXHQvLyAqIGIyVmVjMihtZXRlcikgdG8gVmVjMiAocGl4ZWwpXHJcblx0Ly8gKiBAcmV0dXJucyB7VmVjMn1cclxuXHQvLyAqL1xyXG5cdC8vZ2V0UG9zaXRpb24oKSB7IH0iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxlQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Physics/PBullet.js\n");

/***/ }),

/***/ "./src/game/Physics/PMob.js":
/*!**********************************!*\
  !*** ./src/game/Physics/PMob.js ***!
  \**********************************/
/*! exports provided: MobActionController, MobAction_Stand, _MobAction_Move, MobAction_MoveLeft, MobAction_MoveRight, MobAction_Jump, MobAction_Attack, PMob */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobActionController\", function() { return MobActionController; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobAction_Stand\", function() { return MobAction_Stand; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_MobAction_Move\", function() { return _MobAction_Move; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobAction_MoveLeft\", function() { return MobAction_MoveLeft; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobAction_MoveRight\", function() { return MobAction_MoveRight; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobAction_Jump\", function() { return MobAction_Jump; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobAction_Attack\", function() { return MobAction_Attack; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PMob\", function() { return PMob; });\n/* harmony import */ var _PPlayer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\nwindow.$MobAction_Move_Priority = 2;\r\nwindow.$MobAction_Jump_Priority = 1;\r\n\r\n\r\nclass MobActionController {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\t/** @type {string} - ?? */\r\n\t\tthis._name = null;\r\n\r\n\t\t/** @type {Animation} */\r\n\t\tthis._ani = animation;\r\n\t}\r\n\r\n\t/** @type {number} - int */\r\n\tget priority() {\r\n\t\treturn 1;\r\n\t}\r\n\r\n\tinit() {\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tisEnd(pMob) {\r\n\t\tlet end = this._ani.isEnd();\r\n\t\tif (end) {\r\n\t\t\tthis.onEnd(pMob);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tonEnd(pMob) {\r\n\t}\r\n}\r\n\r\nclass MobAction_Stand extends MobActionController {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis._name = \"stand\";\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t\t//保持停止。\r\n\t\tpMob.ikey[\"left\"] = 0;\r\n\t\tpMob.ikey[\"right\"] = 0;\r\n\t}\r\n}\r\n\r\nclass _MobAction_Move extends MobActionController {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis._name = \"move\";\r\n\t\tthis.front = 0;\r\n\t}\r\n\r\n\t/** @type {number} - int */\r\n\tget priority() {\r\n\t\treturn window.$MobAction_Move_Priority;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\tlet name = pMob.action._name;\r\n\r\n\t\t//switch (pMob.action._name) {\r\n\t\t//\tcase \"attack\":\r\n\t\t//\t\treturn false;\r\n\t\t//\tdefault:\r\n\t\t\t\tif (name.startsWith(\"attack\")) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t//\t\tbreak;\r\n\t\t//}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\nclass MobAction_MoveLeft extends _MobAction_Move {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis.front = -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\treturn super.isValid(pMob) && (!pMob.state.jump || this.front == pMob.state.front);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t\tpMob.ikey[\"left\"] = 1;\r\n\t\tpMob.ikey[\"right\"] = 0;\r\n\t}\r\n\t\r\n\t///**\r\n\t// * @param {PMob} pMob\r\n\t// */\r\n\t//onEnd(pMob) {\r\n\t//\tpMob.ikey[\"left\"] = 0;//不停止移動，下個動作在處理。\r\n\t//}\r\n}\r\n\r\nclass MobAction_MoveRight extends _MobAction_Move {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis.front = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\treturn super.isValid(pMob) && (!pMob.state.jump || this.front == pMob.state.front);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t\tpMob.ikey[\"left\"] = 0;\r\n\t\tpMob.ikey[\"right\"] = 1;\r\n\t}\r\n\t\r\n\t///**\r\n\t// * @param {PMob} pMob\r\n\t// */\r\n\t//onEnd(pMob) {\r\n\t//\tpMob.ikey[\"right\"] = 0;//不停止移動，下個動作在處理。\r\n\t//}\r\n}\r\n\r\nclass MobAction_Jump extends MobActionController {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis._name = \"jump\";\r\n\t\t//this.move = false;\r\n\t}\r\n\r\n\t/** @type {number} - int */\r\n\tget priority() {\r\n\t\treturn window.$MobAction_Jump_Priority;\r\n\t}\r\n\r\n\tinit() {\r\n\t\t//this.move = 1 || Math.random() > 0.5;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\tlet name = pMob.action._name;\r\n\r\n\t\tswitch (pMob.action._name) {\r\n\t\t\tcase \"attack\":\r\n\t\t\t\treturn false;\r\n\t\t\tdefault:\r\n\t\t\t\tif (name.startsWith(\"attack\")) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn !pMob.state.jump;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t\tif (pMob.state.walk) {\r\n\t\t\tif (pMob.state.front < 0) {\r\n\t\t\t\tpMob.ikey[\"left\"] = 1;\r\n\t\t\t}\r\n\t\t\telse if (pMob.state.front > 0) {\r\n\t\t\t\tpMob.ikey[\"right\"] = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\tpMob.ikey[\"jump\"] = 1;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tonEnd(pMob) {\r\n\t\t//if (this.move) {\r\n\t\t//\tif (pMob.state.front < 0) {\r\n\t\t//\t\tpMob.ikey[\"left\"] = 0;\r\n\t\t//\t}\r\n\t\t//\telse if (pMob.state.front > 0) {\r\n\t\t//\t\tpMob.ikey[\"right\"] = 0;\r\n\t\t//\t}\r\n\t\t//}\r\n\t\tpMob.ikey[\"jump\"] = 0;\r\n\t}\r\n}\r\n\r\nclass MobAction_Attack extends MobActionController {\r\n\t/**\r\n\t * @param {Animation} animation\r\n\t */\r\n\tconstructor(animation) {\r\n\t\tsuper(animation);\r\n\t\tthis._name = \"attack\";\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t * @returns {boolean}\r\n\t */\r\n\tisValid(pMob) {\r\n\t\treturn pMob.action.isEnd();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {PMob} pMob\r\n\t */\r\n\tupdate(pMob) {\r\n\t}\r\n}\r\n\r\nclass PMob extends _PPlayer_js__WEBPACK_IMPORTED_MODULE_0__[\"PRemoteCharacter\"] {\r\n\t/**\r\n\t * @param {MapMob} mapMob\r\n\t */\r\n\tconstructor(mapMob) {\r\n\t\tsuper();\r\n\t\t\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis.attackTarget = true;\r\n\t\t\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis._enable_rx = false;\r\n\t\t\r\n\t\t/** @type {MapMob} */\r\n\t\tthis.chara = mapMob;\r\n\r\n\t\t//TODO: move this code to ??\r\n\t\tif (mapMob) {\r\n\t\t\tif (mapMob.renderer.isFlyMob()) {\r\n\t\t\t\tthis.setMovementSpeed(this._info.flySpeed);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setMovementSpeed(this._info.speed);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t/** @type {Rectangle} */\r\n\t\tthis.activityRegion = null;\r\n\t\t\r\n\t\tthis.$debugControl = false;\r\n\r\n\t\t/** @type {{[action:string]:number}} */\r\n\t\tthis.ikey = {};\r\n\r\n\t\t/** @type {MobActionController[]} */\r\n\t\tthis.actions = [];\r\n\r\n\t\t/** @type {MobActionController} */\r\n\t\tthis.action = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {} param - ??\r\n\t */\r\n\t_registerAction(param) {\r\n\t\tthis.actions.push(param);\r\n\t}\r\n\r\n\t/**\r\n\t * {[action:string]:{ controller:MobActionController, renderer:Animation }}\r\n\t * @param {{[action:string]:Animation}} actions\r\n\t * @param {{[action:string]:MobActionController[]} =act_map\r\n\t */\r\n\t_loadAction(actions, act_map) {\r\n\t\tact_map = act_map || {\r\n\t\t\tstand: [MobAction_Stand],\r\n\t\t\tmove: [MobAction_MoveLeft, MobAction_MoveRight],\r\n\t\t\tjump: [MobAction_Jump],\r\n\t\t};\r\n\t\t\r\n\t\tObject.keys(actions).forEach(key => {\r\n\t\t\tif (actions[key] && act_map[key]) {\r\n\t\t\t\tconst list = act_map[key];\r\n\t\t\t\tfor (let type of list) {\r\n\t\t\t\t\tlet controller = new type(actions[key]);\r\n\t\t\t\t\tlet priority = controller.priority;\r\n\r\n\t\t\t\t\tif (true) {\r\n\t\t\t\t\t\tif (!(Number.isSafeInteger(priority) && priority > 0)) {\r\n\t\t\t\t\t\t\tdebugger;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let i = 0; i < priority; ++i) {\r\n\t\t\t\t\t\tthis._registerAction(controller);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn(\"未完成 MobActionController: \" + key);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.action = this.actions[0];\r\n\t\tif (!this.action) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t}\r\n\t\r\n\tget _info() {\r\n\t\treturn this.chara.renderer._raw.info;\r\n\t}\r\n\tget hasBodyDamage() {\r\n\t\tif (this._info.bodyAttack != 0 && this._info.bodyAttack != 1) {\r\n\t\t\talert(\"bodyAttack:\" + this._info.bodyAttack);\r\n\t\t}\r\n\t\treturn this._info.bodyAttack != 0;\r\n\t}\r\n\tget _speed() {\r\n\t\treturn this._info.speed;\r\n\t}\r\n\tget _pushed() {\r\n\t\treturn this._info.pushed;\r\n\t}\r\n\tget _fs() {\r\n\t\treturn this._info.fs;\r\n\t}\r\n\tget _category() {\r\n\t\treturn this._info.category;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @returns {string}\r\n\t */\r\n\tget _body_category() {\r\n\t\treturn \"mob\";\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @returns {void}\r\n\t */\r\n\t_create(world) {\r\n\t\tsuper._create(world);\r\n\t\t\r\n\t\tthis.setPosition(this.chara.x / $gv.CANVAS_SCALE, this.chara.y / $gv.CANVAS_SCALE, true);\r\n\t\t\r\n\t\tthis._appleMobCategory(this._category);\r\n\t}\r\n\t_appleMobCategory(category) {\r\n\t\tswitch (category) {\r\n\t\t\tcase 1:\r\n\t\t\tcase 6:\r\n\t\t\t\tthis.__setAsWalkOnlyMob();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 8:\r\n\t\t\t\tthis.__setAsJumpDropMob();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis.__setAsWalkOnlyMob();\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tthis.chara.front = this.chara.spawn.f ? 1:-1;\r\n\t}\r\n\t__setAsWalkOnlyMob() {\r\n\t\tconst ground = this.body.GetWorld().ground;\r\n\t\t\r\n\t\tconst fhId = this.chara.spawn.fh;\r\n\t\t\r\n\t\tif (fhId >= 0) {\r\n\t\t\tlet fh = ground.footholds[fhId];\r\n\r\n\t\t\tthis.activityRegion = ground.rectChains[fh.chain];\r\n\t\t}\r\n\t}\r\n\t__setAsJumpDropMob() {\r\n\t}\r\n\t\r\n\tisCanMove() {\r\n\t\treturn !(this._info.ignoreMoveImpact || this._walker_omega == 0 || this._info.noFlip);\r\n\t}\r\n\t\r\n\t/** @override */\r\n\tcontrol() {\r\n\t\tif (this.isCanMove()) {\r\n\t\t\tswitch (this._category) {\r\n\t\t\t\tcase 1:\r\n\t\t\t\tcase 6:\r\n\t\t\t\t\tthis._control_basic(false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\tthis._control_basic(true);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._control_basic(false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t//this.ikey[\"jump\"] = 0;\r\n\t\t\t//this.ikey[\"left\"] = 0;\r\n\t\t\t//this.ikey[\"right\"] = 0;\r\n\r\n\t\t\tsuper.control(this.ikey);\r\n\t\t}\r\n\t}\r\n\t_control_basic(isAllowJump) {\r\n\t\tif (this.action) {\r\n\t\t\tif (this.action.isEnd(this)) {\r\n\t\t\t\tlet actions = this.actions.filter(act => act.isValid(this));\r\n\t\t\t\tlet next = Math.trunc(Math.random() * 100) % actions.length;\r\n\r\n\t\t\t\tthis.action = actions[next];\r\n\r\n\t\t\t\tif (!this.action) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.action.init();\r\n\r\n\t\t\t\t//console.log(\"mob: \" + this.action.name);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t}\r\n\r\n\t\t\tthis.action.update(this);\r\n\t\t}\r\n\t}\r\n\r\n\tstop() {\r\n\t\tconst empty = {};\r\n\t\tthis.ikey = empty;\r\n\t\tsuper.control(empty);\r\n\t}\r\n\t\r\n\tStep() {\t\t\r\n\t\tsuper.Step();\r\n\t\t\r\n\t\tthis.control();\r\n\t\t\r\n\t\tlet rx0, rx1, limit_action;\r\n\t\t\r\n\t\tif (this.attackTarget && this.activityRegion) {\r\n\t\t\trx0 = this.activityRegion.left;\r\n\t\t\trx1 = this.activityRegion.right;\r\n\t\t\tlimit_action = true;\r\n\t\t}\r\n\t\telse if (!this._enable_rx) {\r\n\t\t\trx0 = this.chara.spawn.rx0;\r\n\t\t\trx1 = this.chara.spawn.rx1;\r\n\t\t\tlimit_action = false;\r\n\t\t}\r\n\t\t\r\n\t\tif (limit_action) {\r\n\t\t\tconst cbpos = this.body.GetPosition();\r\n\t\t\tconst x = cbpos.x * $gv.CANVAS_SCALE;\r\n\t\t\tconst y = cbpos.y * $gv.CANVAS_SCALE;\r\n\t\t\tconst dx0 = rx0 - x;\r\n\t\t\tconst dx1 = x - rx1;\r\n\t\t\t\r\n\t\t\tif (dx0 > 0) {\r\n\t\t\t\tconst fwpos = this.foot_walk.GetPosition();\r\n\t\t\t\tthis.body.SetPositionXY(rx0 / $gv.CANVAS_SCALE, cbpos.y);\r\n\t\t\t\tthis.foot_walk.SetPositionXY(rx0 / $gv.CANVAS_SCALE, fwpos.y);\r\n\t\t\t}\r\n\t\t\telse if (dx1 > 0) {\r\n\t\t\t\tconst fwpos = this.foot_walk.GetPosition();\r\n\t\t\t\tthis.body.SetPositionXY(rx1 / $gv.CANVAS_SCALE, cbpos.y);\r\n\t\t\t\tthis.foot_walk.SetPositionXY(rx1 / $gv.CANVAS_SCALE, fwpos.y);\r\n\r\n\t\t\t\tif (!this.attackTarget) {\r\n\t\t\t\t\tthis.state.front *= -1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tAfterStep() {\r\n\t\tsuper.AfterStep();\r\n\t\t\r\n\t\tconst pos = this.getPosition();\r\n\t\tconst x = pos.x * $gv.CANVAS_SCALE;\r\n\t\tconst y = pos.y * $gv.CANVAS_SCALE;\r\n\t\t\r\n\t\tthis.chara.x = x;\r\n\t\tthis.chara.y = y;\r\n\t\t\r\n\t\tif (!this._info.noFlip) {\r\n\t\t\tthis.chara.front = -this.state.front;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL1BNb2IuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9QaHlzaWNzL1BNb2IuanM/NzU1ZiJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgUFJlbW90ZUNoYXJhY3RlciB9IGZyb20gXCIuL1BQbGF5ZXIuanNcIjtcclxuXHJcbmltcG9ydCB7IEFuaW1hdGlvbiB9IGZyb20gXCIuLi9BbmltYXRpb24uanNcIjtcclxuXHJcblxyXG53aW5kb3cuJE1vYkFjdGlvbl9Nb3ZlX1ByaW9yaXR5ID0gMjtcclxud2luZG93LiRNb2JBY3Rpb25fSnVtcF9Qcmlvcml0eSA9IDE7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE1vYkFjdGlvbkNvbnRyb2xsZXIge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7QW5pbWF0aW9ufSBhbmltYXRpb25cclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihhbmltYXRpb24pIHtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAtID8/ICovXHJcblx0XHR0aGlzLl9uYW1lID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0FuaW1hdGlvbn0gKi9cclxuXHRcdHRoaXMuX2FuaSA9IGFuaW1hdGlvbjtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7bnVtYmVyfSAtIGludCAqL1xyXG5cdGdldCBwcmlvcml0eSgpIHtcclxuXHRcdHJldHVybiAxO1xyXG5cdH1cclxuXHJcblx0aW5pdCgpIHtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdGlzVmFsaWQocE1vYikge1xyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1BNb2J9IHBNb2JcclxuXHQgKi9cclxuXHR1cGRhdGUocE1vYikge1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQTW9ifSBwTW9iXHJcblx0ICovXHJcblx0aXNFbmQocE1vYikge1xyXG5cdFx0bGV0IGVuZCA9IHRoaXMuX2FuaS5pc0VuZCgpO1xyXG5cdFx0aWYgKGVuZCkge1xyXG5cdFx0XHR0aGlzLm9uRW5kKHBNb2IpO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqL1xyXG5cdG9uRW5kKHBNb2IpIHtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNb2JBY3Rpb25fU3RhbmQgZXh0ZW5kcyBNb2JBY3Rpb25Db250cm9sbGVyIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0FuaW1hdGlvbn0gYW5pbWF0aW9uXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0aW9uKSB7XHJcblx0XHRzdXBlcihhbmltYXRpb24pO1xyXG5cdFx0dGhpcy5fbmFtZSA9IFwic3RhbmRcIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqL1xyXG5cdHVwZGF0ZShwTW9iKSB7XHJcblx0XHQvL+S/neaMgeWBnOatouOAglxyXG5cdFx0cE1vYi5pa2V5W1wibGVmdFwiXSA9IDA7XHJcblx0XHRwTW9iLmlrZXlbXCJyaWdodFwiXSA9IDA7XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgX01vYkFjdGlvbl9Nb3ZlIGV4dGVuZHMgTW9iQWN0aW9uQ29udHJvbGxlciB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtBbmltYXRpb259IGFuaW1hdGlvblxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGFuaW1hdGlvbikge1xyXG5cdFx0c3VwZXIoYW5pbWF0aW9uKTtcclxuXHRcdHRoaXMuX25hbWUgPSBcIm1vdmVcIjtcclxuXHRcdHRoaXMuZnJvbnQgPSAwO1xyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gaW50ICovXHJcblx0Z2V0IHByaW9yaXR5KCkge1xyXG5cdFx0cmV0dXJuIHdpbmRvdy4kTW9iQWN0aW9uX01vdmVfUHJpb3JpdHk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdGlzVmFsaWQocE1vYikge1xyXG5cdFx0bGV0IG5hbWUgPSBwTW9iLmFjdGlvbi5fbmFtZTtcclxuXHJcblx0XHQvL3N3aXRjaCAocE1vYi5hY3Rpb24uX25hbWUpIHtcclxuXHRcdC8vXHRjYXNlIFwiYXR0YWNrXCI6XHJcblx0XHQvL1x0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHQvL1x0ZGVmYXVsdDpcclxuXHRcdFx0XHRpZiAobmFtZS5zdGFydHNXaXRoKFwiYXR0YWNrXCIpKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0Ly9cdFx0YnJlYWs7XHJcblx0XHQvL31cclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE1vYkFjdGlvbl9Nb3ZlTGVmdCBleHRlbmRzIF9Nb2JBY3Rpb25fTW92ZSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtBbmltYXRpb259IGFuaW1hdGlvblxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGFuaW1hdGlvbikge1xyXG5cdFx0c3VwZXIoYW5pbWF0aW9uKTtcclxuXHRcdHRoaXMuZnJvbnQgPSAtMTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdGlzVmFsaWQocE1vYikge1xyXG5cdFx0cmV0dXJuIHN1cGVyLmlzVmFsaWQocE1vYikgJiYgKCFwTW9iLnN0YXRlLmp1bXAgfHwgdGhpcy5mcm9udCA9PSBwTW9iLnN0YXRlLmZyb250KTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqL1xyXG5cdHVwZGF0ZShwTW9iKSB7XHJcblx0XHRwTW9iLmlrZXlbXCJsZWZ0XCJdID0gMTtcclxuXHRcdHBNb2IuaWtleVtcInJpZ2h0XCJdID0gMDtcclxuXHR9XHJcblx0XHJcblx0Ly8vKipcclxuXHQvLyAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdC8vICovXHJcblx0Ly9vbkVuZChwTW9iKSB7XHJcblx0Ly9cdHBNb2IuaWtleVtcImxlZnRcIl0gPSAwOy8v5LiN5YGc5q2i56e75YuV77yM5LiL5YCL5YuV5L2c5Zyo6JmV55CG44CCXHJcblx0Ly99XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBNb2JBY3Rpb25fTW92ZVJpZ2h0IGV4dGVuZHMgX01vYkFjdGlvbl9Nb3ZlIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0FuaW1hdGlvbn0gYW5pbWF0aW9uXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0aW9uKSB7XHJcblx0XHRzdXBlcihhbmltYXRpb24pO1xyXG5cdFx0dGhpcy5mcm9udCA9IDE7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1BNb2J9IHBNb2JcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRpc1ZhbGlkKHBNb2IpIHtcclxuXHRcdHJldHVybiBzdXBlci5pc1ZhbGlkKHBNb2IpICYmICghcE1vYi5zdGF0ZS5qdW1wIHx8IHRoaXMuZnJvbnQgPT0gcE1vYi5zdGF0ZS5mcm9udCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1BNb2J9IHBNb2JcclxuXHQgKi9cclxuXHR1cGRhdGUocE1vYikge1xyXG5cdFx0cE1vYi5pa2V5W1wibGVmdFwiXSA9IDA7XHJcblx0XHRwTW9iLmlrZXlbXCJyaWdodFwiXSA9IDE7XHJcblx0fVxyXG5cdFxyXG5cdC8vLyoqXHJcblx0Ly8gKiBAcGFyYW0ge1BNb2J9IHBNb2JcclxuXHQvLyAqL1xyXG5cdC8vb25FbmQocE1vYikge1xyXG5cdC8vXHRwTW9iLmlrZXlbXCJyaWdodFwiXSA9IDA7Ly/kuI3lgZzmraLnp7vli5XvvIzkuIvlgIvli5XkvZzlnKjomZXnkIbjgIJcclxuXHQvL31cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE1vYkFjdGlvbl9KdW1wIGV4dGVuZHMgTW9iQWN0aW9uQ29udHJvbGxlciB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtBbmltYXRpb259IGFuaW1hdGlvblxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKGFuaW1hdGlvbikge1xyXG5cdFx0c3VwZXIoYW5pbWF0aW9uKTtcclxuXHRcdHRoaXMuX25hbWUgPSBcImp1bXBcIjtcclxuXHRcdC8vdGhpcy5tb3ZlID0gZmFsc2U7XHJcblx0fVxyXG5cclxuXHQvKiogQHR5cGUge251bWJlcn0gLSBpbnQgKi9cclxuXHRnZXQgcHJpb3JpdHkoKSB7XHJcblx0XHRyZXR1cm4gd2luZG93LiRNb2JBY3Rpb25fSnVtcF9Qcmlvcml0eTtcclxuXHR9XHJcblxyXG5cdGluaXQoKSB7XHJcblx0XHQvL3RoaXMubW92ZSA9IDEgfHwgTWF0aC5yYW5kb20oKSA+IDAuNTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UE1vYn0gcE1vYlxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdGlzVmFsaWQocE1vYikge1xyXG5cdFx0bGV0IG5hbWUgPSBwTW9iLmFjdGlvbi5fbmFtZTtcclxuXHJcblx0XHRzd2l0Y2ggKHBNb2IuYWN0aW9uLl9uYW1lKSB7XHJcblx0XHRcdGNhc2UgXCJhdHRhY2tcIjpcclxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0aWYgKG5hbWUuc3RhcnRzV2l0aChcImF0dGFja1wiKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHRcdHJldHVybiAhcE1vYi5zdGF0ZS5qdW1wO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQTW9ifSBwTW9iXHJcblx0ICovXHJcblx0dXBkYXRlKHBNb2IpIHtcclxuXHRcdGlmIChwTW9iLnN0YXRlLndhbGspIHtcclxuXHRcdFx0aWYgKHBNb2Iuc3RhdGUuZnJvbnQgPCAwKSB7XHJcblx0XHRcdFx0cE1vYi5pa2V5W1wibGVmdFwiXSA9IDE7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAocE1vYi5zdGF0ZS5mcm9udCA+IDApIHtcclxuXHRcdFx0XHRwTW9iLmlrZXlbXCJyaWdodFwiXSA9IDE7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHBNb2IuaWtleVtcImp1bXBcIl0gPSAxO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQTW9ifSBwTW9iXHJcblx0ICovXHJcblx0b25FbmQocE1vYikge1xyXG5cdFx0Ly9pZiAodGhpcy5tb3ZlKSB7XHJcblx0XHQvL1x0aWYgKHBNb2Iuc3RhdGUuZnJvbnQgPCAwKSB7XHJcblx0XHQvL1x0XHRwTW9iLmlrZXlbXCJsZWZ0XCJdID0gMDtcclxuXHRcdC8vXHR9XHJcblx0XHQvL1x0ZWxzZSBpZiAocE1vYi5zdGF0ZS5mcm9udCA+IDApIHtcclxuXHRcdC8vXHRcdHBNb2IuaWtleVtcInJpZ2h0XCJdID0gMDtcclxuXHRcdC8vXHR9XHJcblx0XHQvL31cclxuXHRcdHBNb2IuaWtleVtcImp1bXBcIl0gPSAwO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIE1vYkFjdGlvbl9BdHRhY2sgZXh0ZW5kcyBNb2JBY3Rpb25Db250cm9sbGVyIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0FuaW1hdGlvbn0gYW5pbWF0aW9uXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoYW5pbWF0aW9uKSB7XHJcblx0XHRzdXBlcihhbmltYXRpb24pO1xyXG5cdFx0dGhpcy5fbmFtZSA9IFwiYXR0YWNrXCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1BNb2J9IHBNb2JcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRpc1ZhbGlkKHBNb2IpIHtcclxuXHRcdHJldHVybiBwTW9iLmFjdGlvbi5pc0VuZCgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtQTW9ifSBwTW9iXHJcblx0ICovXHJcblx0dXBkYXRlKHBNb2IpIHtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQTW9iIGV4dGVuZHMgUFJlbW90ZUNoYXJhY3RlciB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtNYXBNb2J9IG1hcE1vYlxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKG1hcE1vYikge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtQUGxheWVyfSAqL1xyXG5cdFx0dGhpcy5hdHRhY2tUYXJnZXQgPSB0cnVlO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge1BQbGF5ZXJ9ICovXHJcblx0XHR0aGlzLl9lbmFibGVfcnggPSBmYWxzZTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtNYXBNb2J9ICovXHJcblx0XHR0aGlzLmNoYXJhID0gbWFwTW9iO1xyXG5cclxuXHRcdC8vVE9ETzogbW92ZSB0aGlzIGNvZGUgdG8gPz9cclxuXHRcdGlmIChtYXBNb2IpIHtcclxuXHRcdFx0aWYgKG1hcE1vYi5yZW5kZXJlci5pc0ZseU1vYigpKSB7XHJcblx0XHRcdFx0dGhpcy5zZXRNb3ZlbWVudFNwZWVkKHRoaXMuX2luZm8uZmx5U3BlZWQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuc2V0TW92ZW1lbnRTcGVlZCh0aGlzLl9pbmZvLnNwZWVkKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge1JlY3RhbmdsZX0gKi9cclxuXHRcdHRoaXMuYWN0aXZpdHlSZWdpb24gPSBudWxsO1xyXG5cdFx0XHJcblx0XHR0aGlzLiRkZWJ1Z0NvbnRyb2wgPSBmYWxzZTtcclxuXHJcblx0XHQvKiogQHR5cGUge3tbYWN0aW9uOnN0cmluZ106bnVtYmVyfX0gKi9cclxuXHRcdHRoaXMuaWtleSA9IHt9O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7TW9iQWN0aW9uQ29udHJvbGxlcltdfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb25zID0gW107XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtNb2JBY3Rpb25Db250cm9sbGVyfSAqL1xyXG5cdFx0dGhpcy5hY3Rpb24gPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHt9IHBhcmFtIC0gPz9cclxuXHQgKi9cclxuXHRfcmVnaXN0ZXJBY3Rpb24ocGFyYW0pIHtcclxuXHRcdHRoaXMuYWN0aW9ucy5wdXNoKHBhcmFtKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHtbYWN0aW9uOnN0cmluZ106eyBjb250cm9sbGVyOk1vYkFjdGlvbkNvbnRyb2xsZXIsIHJlbmRlcmVyOkFuaW1hdGlvbiB9fVxyXG5cdCAqIEBwYXJhbSB7e1thY3Rpb246c3RyaW5nXTpBbmltYXRpb259fSBhY3Rpb25zXHJcblx0ICogQHBhcmFtIHt7W2FjdGlvbjpzdHJpbmddOk1vYkFjdGlvbkNvbnRyb2xsZXJbXX0gPWFjdF9tYXBcclxuXHQgKi9cclxuXHRfbG9hZEFjdGlvbihhY3Rpb25zLCBhY3RfbWFwKSB7XHJcblx0XHRhY3RfbWFwID0gYWN0X21hcCB8fCB7XHJcblx0XHRcdHN0YW5kOiBbTW9iQWN0aW9uX1N0YW5kXSxcclxuXHRcdFx0bW92ZTogW01vYkFjdGlvbl9Nb3ZlTGVmdCwgTW9iQWN0aW9uX01vdmVSaWdodF0sXHJcblx0XHRcdGp1bXA6IFtNb2JBY3Rpb25fSnVtcF0sXHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRPYmplY3Qua2V5cyhhY3Rpb25zKS5mb3JFYWNoKGtleSA9PiB7XHJcblx0XHRcdGlmIChhY3Rpb25zW2tleV0gJiYgYWN0X21hcFtrZXldKSB7XHJcblx0XHRcdFx0Y29uc3QgbGlzdCA9IGFjdF9tYXBba2V5XTtcclxuXHRcdFx0XHRmb3IgKGxldCB0eXBlIG9mIGxpc3QpIHtcclxuXHRcdFx0XHRcdGxldCBjb250cm9sbGVyID0gbmV3IHR5cGUoYWN0aW9uc1trZXldKTtcclxuXHRcdFx0XHRcdGxldCBwcmlvcml0eSA9IGNvbnRyb2xsZXIucHJpb3JpdHk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuXHRcdFx0XHRcdFx0aWYgKCEoTnVtYmVyLmlzU2FmZUludGVnZXIocHJpb3JpdHkpICYmIHByaW9yaXR5ID4gMCkpIHtcclxuXHRcdFx0XHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgcHJpb3JpdHk7ICsraSkge1xyXG5cdFx0XHRcdFx0XHR0aGlzLl9yZWdpc3RlckFjdGlvbihjb250cm9sbGVyKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS53YXJuKFwi5pyq5a6M5oiQIE1vYkFjdGlvbkNvbnRyb2xsZXI6IFwiICsga2V5KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0dGhpcy5hY3Rpb24gPSB0aGlzLmFjdGlvbnNbMF07XHJcblx0XHRpZiAoIXRoaXMuYWN0aW9uKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRnZXQgX2luZm8oKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5jaGFyYS5yZW5kZXJlci5fcmF3LmluZm87XHJcblx0fVxyXG5cdGdldCBoYXNCb2R5RGFtYWdlKCkge1xyXG5cdFx0aWYgKHRoaXMuX2luZm8uYm9keUF0dGFjayAhPSAwICYmIHRoaXMuX2luZm8uYm9keUF0dGFjayAhPSAxKSB7XHJcblx0XHRcdGFsZXJ0KFwiYm9keUF0dGFjazpcIiArIHRoaXMuX2luZm8uYm9keUF0dGFjayk7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gdGhpcy5faW5mby5ib2R5QXR0YWNrICE9IDA7XHJcblx0fVxyXG5cdGdldCBfc3BlZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faW5mby5zcGVlZDtcclxuXHR9XHJcblx0Z2V0IF9wdXNoZWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faW5mby5wdXNoZWQ7XHJcblx0fVxyXG5cdGdldCBfZnMoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faW5mby5mcztcclxuXHR9XHJcblx0Z2V0IF9jYXRlZ29yeSgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9pbmZvLmNhdGVnb3J5O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHJldHVybnMge3N0cmluZ31cclxuXHQgKi9cclxuXHRnZXQgX2JvZHlfY2F0ZWdvcnkoKSB7XHJcblx0XHRyZXR1cm4gXCJtb2JcIjtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7V29ybGR9IHdvcmxkXHJcblx0ICogQHJldHVybnMge3ZvaWR9XHJcblx0ICovXHJcblx0X2NyZWF0ZSh3b3JsZCkge1xyXG5cdFx0c3VwZXIuX2NyZWF0ZSh3b3JsZCk7XHJcblx0XHRcclxuXHRcdHRoaXMuc2V0UG9zaXRpb24odGhpcy5jaGFyYS54IC8gJGd2LkNBTlZBU19TQ0FMRSwgdGhpcy5jaGFyYS55IC8gJGd2LkNBTlZBU19TQ0FMRSwgdHJ1ZSk7XHJcblx0XHRcclxuXHRcdHRoaXMuX2FwcGxlTW9iQ2F0ZWdvcnkodGhpcy5fY2F0ZWdvcnkpO1xyXG5cdH1cclxuXHRfYXBwbGVNb2JDYXRlZ29yeShjYXRlZ29yeSkge1xyXG5cdFx0c3dpdGNoIChjYXRlZ29yeSkge1xyXG5cdFx0XHRjYXNlIDE6XHJcblx0XHRcdGNhc2UgNjpcclxuXHRcdFx0XHR0aGlzLl9fc2V0QXNXYWxrT25seU1vYigpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIDg6XHJcblx0XHRcdFx0dGhpcy5fX3NldEFzSnVtcERyb3BNb2IoKTtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdFx0ZGVmYXVsdDpcclxuXHRcdFx0XHR0aGlzLl9fc2V0QXNXYWxrT25seU1vYigpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5jaGFyYS5mcm9udCA9IHRoaXMuY2hhcmEuc3Bhd24uZiA/IDE6LTE7XHJcblx0fVxyXG5cdF9fc2V0QXNXYWxrT25seU1vYigpIHtcclxuXHRcdGNvbnN0IGdyb3VuZCA9IHRoaXMuYm9keS5HZXRXb3JsZCgpLmdyb3VuZDtcclxuXHRcdFxyXG5cdFx0Y29uc3QgZmhJZCA9IHRoaXMuY2hhcmEuc3Bhd24uZmg7XHJcblx0XHRcclxuXHRcdGlmIChmaElkID49IDApIHtcclxuXHRcdFx0bGV0IGZoID0gZ3JvdW5kLmZvb3Rob2xkc1tmaElkXTtcclxuXHJcblx0XHRcdHRoaXMuYWN0aXZpdHlSZWdpb24gPSBncm91bmQucmVjdENoYWluc1tmaC5jaGFpbl07XHJcblx0XHR9XHJcblx0fVxyXG5cdF9fc2V0QXNKdW1wRHJvcE1vYigpIHtcclxuXHR9XHJcblx0XHJcblx0aXNDYW5Nb3ZlKCkge1xyXG5cdFx0cmV0dXJuICEodGhpcy5faW5mby5pZ25vcmVNb3ZlSW1wYWN0IHx8IHRoaXMuX3dhbGtlcl9vbWVnYSA9PSAwIHx8IHRoaXMuX2luZm8ubm9GbGlwKTtcclxuXHR9XHJcblx0XHJcblx0LyoqIEBvdmVycmlkZSAqL1xyXG5cdGNvbnRyb2woKSB7XHJcblx0XHRpZiAodGhpcy5pc0Nhbk1vdmUoKSkge1xyXG5cdFx0XHRzd2l0Y2ggKHRoaXMuX2NhdGVnb3J5KSB7XHJcblx0XHRcdFx0Y2FzZSAxOlxyXG5cdFx0XHRcdGNhc2UgNjpcclxuXHRcdFx0XHRcdHRoaXMuX2NvbnRyb2xfYmFzaWMoZmFsc2UpO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0Y2FzZSA4OlxyXG5cdFx0XHRcdFx0dGhpcy5fY29udHJvbF9iYXNpYyh0cnVlKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGRlZmF1bHQ6XHJcblx0XHRcdFx0XHR0aGlzLl9jb250cm9sX2Jhc2ljKGZhbHNlKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHQvL3RoaXMuaWtleVtcImp1bXBcIl0gPSAwO1xyXG5cdFx0XHQvL3RoaXMuaWtleVtcImxlZnRcIl0gPSAwO1xyXG5cdFx0XHQvL3RoaXMuaWtleVtcInJpZ2h0XCJdID0gMDtcclxuXHJcblx0XHRcdHN1cGVyLmNvbnRyb2wodGhpcy5pa2V5KTtcclxuXHRcdH1cclxuXHR9XHJcblx0X2NvbnRyb2xfYmFzaWMoaXNBbGxvd0p1bXApIHtcclxuXHRcdGlmICh0aGlzLmFjdGlvbikge1xyXG5cdFx0XHRpZiAodGhpcy5hY3Rpb24uaXNFbmQodGhpcykpIHtcclxuXHRcdFx0XHRsZXQgYWN0aW9ucyA9IHRoaXMuYWN0aW9ucy5maWx0ZXIoYWN0ID0+IGFjdC5pc1ZhbGlkKHRoaXMpKTtcclxuXHRcdFx0XHRsZXQgbmV4dCA9IE1hdGgudHJ1bmMoTWF0aC5yYW5kb20oKSAqIDEwMCkgJSBhY3Rpb25zLmxlbmd0aDtcclxuXHJcblx0XHRcdFx0dGhpcy5hY3Rpb24gPSBhY3Rpb25zW25leHRdO1xyXG5cclxuXHRcdFx0XHRpZiAoIXRoaXMuYWN0aW9uKSB7XHJcblx0XHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdHRoaXMuYWN0aW9uLmluaXQoKTtcclxuXHJcblx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcIm1vYjogXCIgKyB0aGlzLmFjdGlvbi5uYW1lKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0dGhpcy5hY3Rpb24udXBkYXRlKHRoaXMpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0c3RvcCgpIHtcclxuXHRcdGNvbnN0IGVtcHR5ID0ge307XHJcblx0XHR0aGlzLmlrZXkgPSBlbXB0eTtcclxuXHRcdHN1cGVyLmNvbnRyb2woZW1wdHkpO1xyXG5cdH1cclxuXHRcclxuXHRTdGVwKCkge1x0XHRcclxuXHRcdHN1cGVyLlN0ZXAoKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5jb250cm9sKCk7XHJcblx0XHRcclxuXHRcdGxldCByeDAsIHJ4MSwgbGltaXRfYWN0aW9uO1xyXG5cdFx0XHJcblx0XHRpZiAodGhpcy5hdHRhY2tUYXJnZXQgJiYgdGhpcy5hY3Rpdml0eVJlZ2lvbikge1xyXG5cdFx0XHRyeDAgPSB0aGlzLmFjdGl2aXR5UmVnaW9uLmxlZnQ7XHJcblx0XHRcdHJ4MSA9IHRoaXMuYWN0aXZpdHlSZWdpb24ucmlnaHQ7XHJcblx0XHRcdGxpbWl0X2FjdGlvbiA9IHRydWU7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICghdGhpcy5fZW5hYmxlX3J4KSB7XHJcblx0XHRcdHJ4MCA9IHRoaXMuY2hhcmEuc3Bhd24ucngwO1xyXG5cdFx0XHRyeDEgPSB0aGlzLmNoYXJhLnNwYXduLnJ4MTtcclxuXHRcdFx0bGltaXRfYWN0aW9uID0gZmFsc2U7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmIChsaW1pdF9hY3Rpb24pIHtcclxuXHRcdFx0Y29uc3QgY2Jwb3MgPSB0aGlzLmJvZHkuR2V0UG9zaXRpb24oKTtcclxuXHRcdFx0Y29uc3QgeCA9IGNicG9zLnggKiAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0XHRjb25zdCB5ID0gY2Jwb3MueSAqICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRcdGNvbnN0IGR4MCA9IHJ4MCAtIHg7XHJcblx0XHRcdGNvbnN0IGR4MSA9IHggLSByeDE7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoZHgwID4gMCkge1xyXG5cdFx0XHRcdGNvbnN0IGZ3cG9zID0gdGhpcy5mb290X3dhbGsuR2V0UG9zaXRpb24oKTtcclxuXHRcdFx0XHR0aGlzLmJvZHkuU2V0UG9zaXRpb25YWShyeDAgLyAkZ3YuQ0FOVkFTX1NDQUxFLCBjYnBvcy55KTtcclxuXHRcdFx0XHR0aGlzLmZvb3Rfd2Fsay5TZXRQb3NpdGlvblhZKHJ4MCAvICRndi5DQU5WQVNfU0NBTEUsIGZ3cG9zLnkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGR4MSA+IDApIHtcclxuXHRcdFx0XHRjb25zdCBmd3BvcyA9IHRoaXMuZm9vdF93YWxrLkdldFBvc2l0aW9uKCk7XHJcblx0XHRcdFx0dGhpcy5ib2R5LlNldFBvc2l0aW9uWFkocngxIC8gJGd2LkNBTlZBU19TQ0FMRSwgY2Jwb3MueSk7XHJcblx0XHRcdFx0dGhpcy5mb290X3dhbGsuU2V0UG9zaXRpb25YWShyeDEgLyAkZ3YuQ0FOVkFTX1NDQUxFLCBmd3Bvcy55KTtcclxuXHJcblx0XHRcdFx0aWYgKCF0aGlzLmF0dGFja1RhcmdldCkge1xyXG5cdFx0XHRcdFx0dGhpcy5zdGF0ZS5mcm9udCAqPSAtMTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0QWZ0ZXJTdGVwKCkge1xyXG5cdFx0c3VwZXIuQWZ0ZXJTdGVwKCk7XHJcblx0XHRcclxuXHRcdGNvbnN0IHBvcyA9IHRoaXMuZ2V0UG9zaXRpb24oKTtcclxuXHRcdGNvbnN0IHggPSBwb3MueCAqICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRjb25zdCB5ID0gcG9zLnkgKiAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0XHJcblx0XHR0aGlzLmNoYXJhLnggPSB4O1xyXG5cdFx0dGhpcy5jaGFyYS55ID0geTtcclxuXHRcdFxyXG5cdFx0aWYgKCF0aGlzLl9pbmZvLm5vRmxpcCkge1xyXG5cdFx0XHR0aGlzLmNoYXJhLmZyb250ID0gLXRoaXMuc3RhdGUuZnJvbnQ7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Physics/PMob.js\n");

/***/ }),

/***/ "./src/game/Physics/PPlayer.js":
/*!*************************************!*\
  !*** ./src/game/Physics/PPlayer.js ***!
  \*************************************/
/*! exports provided: PPlayerState, FootContact, PPlayer, PRemoteCharacter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PPlayerState\", function() { return PPlayerState; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FootContact\", function() { return FootContact; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PPlayer\", function() { return PPlayer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PRemoteCharacter\", function() { return PRemoteCharacter; });\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Ground_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Ground.js */ \"./src/game/Physics/Ground.js\");\n/* harmony import */ var _World_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./World.js */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _Client_PMovePath_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../Client/PMovePath.js */ \"./src/Client/PMovePath.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../SceneObject.js */ \"./src/game/SceneObject.js\");\n/* harmony import */ var _Map_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../Map.js */ \"./src/game/Map.js\");\n/* harmony import */ var _LadderRope_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./LadderRope.js */ \"./src/game/Physics/LadderRope.js\");\n/* harmony import */ var _Filter_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Filter.js */ \"./src/game/Physics/Filter.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst DEGTORAD = Math.PI / 180;\r\n\r\nlet b2Vec2_temp = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]();\r\n\r\n/**\r\n * physics profile\r\n */\r\nconst chara_profile = {\r\n\twidth: 25 / $gv.CANVAS_SCALE,\r\n\theight: 48 / $gv.CANVAS_SCALE,\r\n\tdensity: 1,\r\n\t/** radius */\r\n\tget foot_width() {\r\n\t\treturn (chara_profile.width * 0.5);\r\n\t},\r\n\t/** radius */\r\n\tget foot_j_width() {\r\n\t\treturn (chara_profile.width * 0.4);\r\n\t},\r\n};\r\n\r\n(function () {\r\n\tconst jumpSpeed = 555;//??\r\n\tconst fallSpeed = 670;//px/s\r\n\tconst walkSpeed = 125;//px/s\r\n\t\r\n\twindow.JUMP_FORCE = jumpSpeed;\r\n\r\n\twindow.MOVEMENT_VELOCITY = walkSpeed / $gv.CANVAS_SCALE;\r\n\twindow.$LADDER_SPEED = walkSpeed / $gv.CANVAS_SCALE;\r\n\r\n\twindow.PLAYER_USE_WHEEL_WALKER = false;\r\n\r\n\twindow.FOOT_FRICTION = 1;\r\n\r\n\twindow.MOVEMENT_POWER = 140000;\r\n\twindow.MOVEMENT_STOP_POWER = 140000;\r\n\r\n\twindow.PORTAL_COOLDOWN = 1000;\r\n})();\r\n\r\n\r\nclass PPlayerState {\r\n\tconstructor() {\r\n\t\t/** @type {boolean} - ApplyForce(jump_force) until leave foothold */\r\n\t\tthis._begin_jump = false;\r\n\r\n\t\t/** jump_count = jump ? jump_count : 0 */\r\n\t\tthis.jump = true;\r\n\r\n\t\t/** jump_count = jump ? jump_count : 0 */\r\n\t\tthis.jump_count = 0;\r\n\r\n\t\t/** ?? */\r\n\t\tthis._drop = true;\r\n\r\n\t\tthis.walk = false;\r\n\r\n\t\tthis.prone = false;\r\n\r\n\t\t/** TODO: fallDown */\r\n\t\tthis.dropDown = false;\r\n\r\n\t\tthis._fly = false;//not jump \r\n\t\t\r\n\t\tthis.brake = true;//??\r\n\t\t\r\n\t\t/** @type {-1|1} */\r\n\t\tthis.front = -1;\r\n\r\n\t\t/** @type {boolean} - is use ladder */\r\n\t\tthis.ladder = false;\r\n\r\n\t\t/**\r\n\t\t * action animation\r\n\t\t * @type {-1|0|1} - up: -1, down: 1, stop: 0\r\n\t\t */\r\n\t\tthis.ladder_move_dir = 0;\r\n\r\n\t\t/** @type {number} - 無敵時間，unit is millisecond */\r\n\t\tthis.invincible = 0;\r\n\t\t\r\n\t\t/** @type {boolean} - can not move or jump */\r\n\t\tthis.freeze = false;\r\n\r\n\t\t/** @type {boolean} - can not move or jump */\r\n\t\tthis.invokeSkill = false;\r\n\r\n\t\t/** @type {number} - use portal cooldown time，unit is millisecond */\r\n\t\tthis.portal_cooldown = 0;\r\n\t\t\r\n\t\t//\r\n\r\n\t\t/** @type {number} - knockback time，unit is millisecond */\r\n\t\tthis.knockback = 0;\r\n\r\n\t\t/** @type {boolean} - off walker power */\r\n\t\tthis.outOfControl = false;\r\n\t}\r\n}\r\n\r\n/**\r\n * @param {number} jump_height\r\n * @param {b2Vec2} gravity\r\n */\r\nfunction _CalcJumpImpulse(jump_height, gravity) {\r\n\tlet impulse = Math.sqrt(jump_height * 2.0 * Math.abs(gravity.y));\r\n\t//(impulse = m * v) => (F = ∫ Mass * dVel)\r\n\treturn impulse;\r\n}\r\n\r\n\r\nclass ControlKeys {\r\n\tconstructor() {\r\n\t\tthis.up = 0;\r\n\t\tthis.left = 0;\r\n\t\tthis.down = 0;\r\n\t\tthis.right = 0;\r\n\t\tthis.jump = 0;\r\n\t\tthis.enterPortal = 0;//TODO: key: enterPortal\r\n\t}\r\n}\r\n\r\nclass FootContact {\r\n\t/**\r\n\t * @param {Foothold} foothold\r\n\t * @param {b2Vec2} position\r\n\t * @param {number} priority\r\n\t */\r\n\tconstructor(foothold, position, priority) {\r\n\t\t/** @type {Foothold} */\r\n\t\tthis.foothold = foothold;\r\n\r\n\t\t/** @type {b2Vec2} */\r\n\t\tthis.position = position;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.priority = priority;\r\n\t}\r\n}\r\n\r\nclass PCharacterBase {\r\n\tconstructor() {\r\n\t\t/** @type {boolean} */\r\n\t\tthis.enable = true;\r\n\r\n\t\tthis.chara_profile = Object.assign({}, chara_profile);\r\n\t\t\r\n\t\tthis.setMovementSpeed(100);\r\n\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.body = null;\r\n\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.foot_walk = null;\r\n\r\n\t\t/** @type {b2Joint|b2RevoluteJoint} */\r\n\t\tthis.walker = null;\r\n\r\n\t\t/** @type {Foothold} */\r\n\t\tthis.$foothold = null;\r\n\r\n\t\t/**\r\n\t\t * this.$foothold old value\r\n\t\t * @type {Foothold}\r\n\t\t */\r\n\t\tthis.prev_$fh = null;\r\n\r\n\t\t/**\r\n\t\t * no contact leave_$fh\r\n\t\t * where foothold chara dropDown\r\n\t\t * @type {Foothold}\r\n\t\t */\r\n\t\tthis.leave_$fh = null;\r\n\r\n\r\n\t\t/** @type {Foothold} - in World::Setp */\r\n\t\tthis._foothold = null;\r\n\r\n\t\t/** @type {b2Vec2} - contact foothold point */\r\n\t\tthis._foot_at = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]();\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._foothold_priority = 0;\r\n\t\t\r\n\t\t/** @type {FootContact[]} */\r\n\t\tthis._foot_contact_list = [];\r\n\r\n\r\n\t\t/** @type {MapPortal} */\r\n\t\tthis.portal = null;\r\n\r\n\r\n\t\t/** @type {LadderRope} */\r\n\t\tthis.ladder = null;\r\n\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis._walker_omega = 1;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.jump_force = JUMP_FORCE;\r\n\r\n\t\tthis.state = new PPlayerState();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {boolean} clearForce\r\n\t */\r\n\tsetPosition(x, y, clearForce) {\r\n\t\tconst by = y - this.chara_profile.foot_width - this.chara_profile.height * 0.75 * 0.5;\r\n\t\tconst fy = y - this.chara_profile.foot_width;\r\n\r\n\t\tthis.body.SetPositionXY(x, by);\r\n\r\n\t\ttry {\r\n\t\t\tif (this.foot_walk)\r\n\t\t\t\tthis.foot_walk.SetPositionXY(x, fy);\r\n\r\n\t\t\tif (clearForce) {\r\n\t\t\t\tconst speed = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, 0);\r\n\t\t\t\tthis.body.ConstantVelocity(speed);\r\n\t\t\t\tif (this.foot_walk)\r\n\t\t\t\t\tthis.foot_walk.ConstantVelocity(speed);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * get bottom position\r\n\t * @returns {{x: number, y: number}}\r\n\t */\r\n\tgetPosition() {\r\n\t\tconst pos = this.foot_walk.GetPosition();\r\n\t\treturn new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](pos.x, pos.y + this.chara_profile.foot_width);\r\n\t}\r\n\r\n\t/**\r\n\t * from.tn(hp00_1) == to.pn(hp00_1) && from.pn(hp00) == to.tn(hp00)\r\n\t * @param {MapPortal} portal\r\n\t * @returns {boolean} true if enter portal\r\n\t */\r\n\t_usePortal(portal) {\r\n\t\tif (!portal.enable || this.state.portal_cooldown > 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t/** @type {SceneMap} */\r\n\t\tconst mapRenderer = portal.mapRenderer;\r\n\r\n\t\tconst mapController = mapRenderer.controller;\r\n\t\t\r\n\t\tconst map_id = portal.getMap();\r\n\t\t\r\n\t\tif (portal.exeScript) {//TODO: portal script\r\n\t\t\tportal.exeScript(this);\r\n\t\t}\r\n\t\telse if (map_id) {\r\n\t\t\tif (map_id == mapRenderer.map_id) {\r\n\t\t\t\tconst reg = portal.tn.match(/(^[a-z_]+)(\\d+$)/) || portal.tn.match(/(^[a-z]+)\\d+_\\d+$/);//pn?tn?\r\n\t\t\t\tconst cmd = reg[1];\r\n\r\n\t\t\t\tif (cmd == \"hp\") {\r\n\t\t\t\t\tlet fromTn = portal.tn;\r\n\t\t\t\t\tlet toPortal = mapRenderer.portalMgr.portals.find(function (toPortal) {\r\n\t\t\t\t\t\treturn fromTn == toPortal.pn;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis._gotoPortal(toPortal);\r\n\t\t\t\t}\r\n\t\t\t\telse if (cmd == \"pt_go\") {\r\n\t\t\t\t\tdebugger;//??\r\n\r\n\t\t\t\t\tconst tpid = parseInt(reg[2], 10);\r\n\t\t\t\t\tconst tp = mapRenderer.portalMgr.portals[tpid];\r\n\r\n\t\t\t\t\tthis._gotoPortal(tp);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.log(`portal.pn: ${portal.pn}, portal.tn: ${portal.tn}, %o`, portal);\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tmapController.doAfterStep(function () {\r\n\t\t\t\t\tmapRenderer.unload();\r\n\t\t\t\t\tmapRenderer.load(map_id);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"portal: $o\", portal);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.state.portal_cooldown = PORTAL_COOLDOWN;//防止重複\r\n\t\treturn true;\r\n\t}\r\n\t/**\r\n\t * @param {MapPortal} portal\r\n\t */\r\n\t_gotoPortal(portal) {\r\n\t\t/** @type {SceneMap} */\r\n\t\tconst mapRenderer = portal.mapRenderer;\r\n\t\tconst mapController = mapRenderer.controller;\r\n\r\n\t\t//not in world.Step\r\n\t\tmapController.doAfterStep(() => {\r\n\t\t\tconst x = portal.x / $gv.CANVAS_SCALE;\r\n\t\t\tconst y = (portal.y - 3) / $gv.CANVAS_SCALE;//adj portal pos\r\n\t\t\tthis.setPosition(x, y, true);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * set ladder, not use\r\n\t * @param {LadderRope} ladder\r\n\t */\r\n\tcontactLadder(ladder) {\r\n\t\tif (ladder) {\r\n\t\t\tthis.ladder = ladder;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.ladder = null;\r\n\t\t}\r\n\t}\r\n\tleaveLadder() {\r\n\t\t/** @type {World} */\r\n\t\tconst world = this.body.m_world;\r\n\r\n\t\tworld.onceUnlock(() => {\r\n\t\t\tthis._useLadder(false);\r\n\t\t\tthis.contactLadder(null, null);//set no contact\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @param {boolean} flag - true: use, false: no use\r\n\t */\r\n\tuseLadder(flag) {\r\n\t\t/** @type {World} */\r\n\t\tconst world = this.body.m_world;\r\n\r\n\t\tworld.onceUnlock(() => {\r\n\t\t\tthis._useLadder(flag);\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @param {boolean} flag - true: use, false: no use\r\n\t */\r\n\t_useLadder(flag) {\r\n\t\t/** @type {World} */\r\n\t\tconst world = this.body.m_world;\r\n\r\n\t\tif (flag) {\r\n\t\t\tif (this.ladder && !this.$ladder_pj) {\r\n\t\t\t\tconst ladderBody = this.ladder.body;\r\n\r\n\t\t\t\tif (ladderBody.GetAngle() || ladderBody.GetAngularVelocity()) {\r\n\t\t\t\t\tthis.body.SetAngle(ladderBody.GetAngle());\r\n\t\t\t\t\tthis.body.SetFixedRotation(false);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.state.ladder = true;\r\n\t\t\t\tthis.state.jump = false;\r\n\t\t\t\tthis.state.jump_count = 0;\r\n\r\n\t\t\t\tthis.body.SetAwake(true);\r\n\t\t\t\tthis.body.SetLinearVelocity2(0, 0);\r\n\t\t\t\tthis.body.m_type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_kinematicBody;\r\n\t\t\t\t//\r\n\t\t\t\tthis.foot_walk.SetAwake(true);\r\n\t\t\t\tthis.foot_walk.SetLinearVelocity2(0, 0);\r\n\t\t\t\tthis.foot_walk.m_type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_kinematicBody;\r\n\r\n\t\t\t\tthis.walker.SetMotorSpeed(0);\r\n\r\n\t\t\t\t// create joint\r\n\r\n\t\t\t\tlet height = this.ladder.calcHeight() / $gv.CANVAS_SCALE;\r\n\r\n\t\t\t\t//let ground = world.ground.bodies[0];\r\n\r\n\t\t\t\tthis.setPosition(ladderBody.GetPosition().x, this.getPosition().y);\r\n\r\n\t\t\t\tlet pjd = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PrismaticJointDef\"]();\r\n\t\t\t\t//pjd.Initialize(ladderBody, this.body, anchor, new b2Vec2(0, 1));\r\n\t\t\t\t{\r\n\t\t\t\t\tpjd.bodyA = ladderBody;\r\n\t\t\t\t\tpjd.bodyB = this.foot_walk;//this.body;\r\n\t\t\t\t\t//pjd.localAnchorA.Set(0, 0);\r\n\t\t\t\t\t//pjd.localAnchorB.Set(0, 0);\r\n\t\t\t\t\tpjd.localAxisA.Set(0, 1);\r\n\t\t\t\t\t//pjd.referenceAngle = 0;\r\n\t\t\t\t}\r\n\t\t\t\tpjd.lowerTranslation = -this.chara_profile.foot_width;\r\n\t\t\t\tpjd.upperTranslation = height + this.chara_profile.foot_width;\r\n\t\t\t\tpjd.enableLimit = true;\r\n\t\t\t\tpjd.maxMotorForce = this._getMass() * 1000;\r\n\r\n\t\t\t\t/** @type {b2PrismaticJoint} */\r\n\t\t\t\tlet pj = world.CreateJoint(pjd);\r\n\r\n\t\t\t\tthis.$ladder_pj = pj;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.ladder) {\r\n\t\t\t\t//this.ladder = null;\r\n\r\n\t\t\t\tif (this.state.ladder) {\r\n\t\t\t\t\tthis.state.ladder = false;\r\n\r\n\t\t\t\t\tthis.body.SetAwake(true);\r\n\t\t\t\t\tthis.body.SetLinearVelocity2(0, 0);\r\n\t\t\t\t\tthis.body.m_type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_dynamicBody;\r\n\t\t\t\t\t//\r\n\t\t\t\t\tthis.foot_walk.SetAwake(true);\r\n\t\t\t\t\tthis.foot_walk.SetLinearVelocity2(0, 0);\r\n\t\t\t\t\tthis.foot_walk.m_type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_dynamicBody;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.$ladder_pj) {\r\n\t\t\t\tworld.DestroyJoint(this.$ladder_pj);\r\n\t\t\t\tdelete this.$ladder_pj;\r\n\r\n\t\t\t\tthis.body.SetAngle(0);\r\n\t\t\t\tthis.body.SetFixedRotation(true);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tremove_sticky() {\r\n\t\tif (this.$sticky_pj) {\r\n\t\t\tthis.body.m_world.DestroyJoint(this.$sticky_pj);\r\n\t\t\tthis.$sticky_pj = null;\r\n\t\t}\r\n\t}\r\n\r\n\tactionJump() {\r\n\t\tthis.state._begin_jump = true;\r\n\t\t++this.state.jump_count;\r\n\t}\r\n\t//actionWalk(front) {\r\n\t//}\r\n\tactionDropdown() {\r\n\t\tthis.leave_$fh = this.$foothold;\r\n\t\tthis.$foothold = null;\r\n\t\tthis.state.dropDown = true;\r\n\t\tthis.body.SetAwake(true);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Partial<ControlKeys>} keys\r\n\t */\r\n\tcontrol(keys) {\r\n\t\tif (!this._isCanMove()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.state.ladder && this.$ladder_pj) {\r\n\t\t\tconst ladderBody = this.ladder.body;\r\n\t\t\tconst speed = (window.$LADDER_SPEED || 1);\r\n\r\n\t\t\tif (ladderBody) {\r\n\t\t\t\tif (ladderBody.GetAngle() || ladderBody.GetAngularVelocity()) {\r\n\t\t\t\t\tthis.body.SetAngle(ladderBody.GetAngle());\r\n\t\t\t\t\tthis.body.SetFixedRotation(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//else {\r\n\t\t\t//\tdebugger;\r\n\t\t\t//}\r\n\r\n\t\t\tif (keys.up && !keys.down) {\r\n\t\t\t\tthis.state.ladder_move_dir = -1;//action animation\r\n\r\n\t\t\t\tthis.$ladder_pj.EnableMotor(true);\r\n\t\t\t\tthis.$ladder_pj.SetMotorSpeed(-speed);\r\n\t\t\t}\r\n\t\t\telse if (keys.down && !keys.up) {\r\n\t\t\t\tthis.state.ladder_move_dir = 1;//action animation\r\n\r\n\t\t\t\tthis.$ladder_pj.EnableMotor(true);\r\n\t\t\t\tthis.$ladder_pj.SetMotorSpeed(speed);\r\n\t\t\t}\r\n\t\t\telse {//stop\r\n\t\t\t\tthis.state.ladder_move_dir = 0;//action animation\r\n\r\n\t\t\t\tthis.$ladder_pj.EnableMotor(false);\r\n\r\n\t\t\t\tthis.body.SetLinearVelocity2(0, 0);\r\n\t\t\t\t//\r\n\t\t\t\tthis.foot_walk.SetLinearVelocity2(0, 0);\r\n\t\t\t}\r\n\t\t\tif (keys.jump) {\r\n\t\t\t\tconst world = this.body.m_world;\r\n\t\t\t\tconst mass = this._getMass();\r\n\r\n\t\t\t\tif (keys.left && keys.right) {\r\n\t\t\t\t\tthis.useLadder(false);\r\n\t\t\t\t}\r\n\t\t\t\telse if (keys.left) {\r\n\t\t\t\t\tthis.useLadder(false);\r\n\t\t\t\t\tworld.doAfterStep(() => {\r\n\t\t\t\t\t\t//const f = new b2Vec2(0, -world.m_gravity.y * mass);\r\n\t\t\t\t\t\t//this.body.ApplyForceToCenter(f, true);\r\n\t\t\t\t\t\tthis.body.ApplyLinearImpulseToCenter2(-speed * mass, 0);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\telse if (keys.right) {\r\n\t\t\t\t\tthis.useLadder(false);\r\n\t\t\t\t\tworld.doAfterStep(() => {\r\n\t\t\t\t\t\t//const f = new b2Vec2(0, -world.m_gravity.y * mass);\r\n\t\t\t\t\t\t//this.body.ApplyForceToCenter(f, true);\r\n\t\t\t\t\t\tthis.body.ApplyLinearImpulseToCenter2(speed * mass, 0);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.$ladder_pj) {\r\n\t\t\tdebugger\r\n\t\t\tthis.useLadder(false);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.state.outOfControl) {\r\n\t\t\t\tthis.walker.EnableMotor(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.walker.EnableMotor(true);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.portal && keys.up) {\r\n\t\t\t\t//TODO: enter portal key: keys.enterPortal\r\n\t\t\t\tlet portal = this.portal;\r\n\t\t\t\tif (this._usePortal(portal)) {\r\n\t\t\t\t\tthis.portal = null;//使用完畢\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.ladder && (\r\n\t\t\t\t(keys.down && this.$foothold && this.ladder.body.GetLocalPoint(this.getPosition(), b2Vec2_temp).y <= 0) ||\r\n\t\t\t\t(keys.up && !this.$foothold && this.ladder.body.GetLocalPoint(this.getPosition(), b2Vec2_temp).y > 0))\r\n\t\t\t) {\r\n\t\t\t\tthis.state.ladder_move_dir = 0;//reset\r\n\t\t\t\tthis.useLadder(true);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst wheel_sp = this._walker_omega;\r\n\t\t\tconst velocity = this.body.GetLinearVelocity();//foot_walk\r\n\r\n\t\t\tif (!this.state.jump && !this.state.dropDown) {\r\n\t\t\t\t//dropDown\r\n\t\t\t\tif (keys.down && keys.jump) {\r\n\t\t\t\t\tthis.actionDropdown();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//趴下\r\n\t\t\t\tif (keys.down) {\r\n\t\t\t\t\tthis.state.prone = true;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.state.prone = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.state.prone = false;\r\n\t\t\t}\r\n\r\n\t\t\tif (keys.left && !keys.right) {\r\n\t\t\t\tthis.state.walk = true;\r\n\t\t\t\tthis.state.front = -1;\r\n\t\t\t\tthis.walker.SetMotorSpeed(-wheel_sp);\r\n\t\t\t\tthis.walker.SetMaxMotorTorque(MOVEMENT_POWER);\r\n\t\t\t\t//this.walker.EnableMotor(true);//power on\r\n\r\n\t\t\t\tthis.remove_sticky();\r\n\t\t\t}\r\n\t\t\telse if (keys.right && !keys.left) {\r\n\t\t\t\tthis.state.walk = true;\r\n\t\t\t\tthis.state.front = 1;\r\n\t\t\t\tthis.walker.SetMotorSpeed(wheel_sp);\r\n\t\t\t\tthis.walker.SetMaxMotorTorque(MOVEMENT_POWER);\r\n\t\t\t\t//this.walker.EnableMotor(true);//power on\r\n\r\n\t\t\t\tthis.remove_sticky();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.state.walk = false;\r\n\r\n\t\t\t\tif (!this.state.jump) {\r\n\t\t\t\t\tlet vx = velocity.x;\r\n\t\t\t\t\tif (vx > 50 * _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2_linearSlop\"]) {\r\n\t\t\t\t\t\tthis.walker.SetMotorSpeed(-vx * Math.PI / 2 / Math.PI / this.chara_profile.width / 2);//煞車但無法止滑\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (vx < -50 * _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2_linearSlop\"]) {\r\n\t\t\t\t\t\tthis.walker.SetMotorSpeed(-vx * Math.PI / 2 / Math.PI / this.chara_profile.width / 2);//煞車但無法止滑\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.walker.SetMotorSpeed(0);//stop motor\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.walker.SetMotorSpeed(0);//stop motor\r\n\t\t\t\t}\r\n\t\t\t\tthis.walker.SetMaxMotorTorque(MOVEMENT_STOP_POWER);\r\n\t\t\t\t//this.walker.EnableMotor(false);//power off\r\n\r\n\t\t\t\tif (this.state.止滑) {\r\n\t\t\t\t\tthis.sticky(this.getPosition());\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (keys.jump && this._isCanJump()) {\r\n\t\t\t\tthis.remove_sticky();\r\n\t\t\t\tthis.actionJump();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t_isCanJump() {\r\n\t\treturn !this.state.jump && !this.isDrop();\r\n\t}\r\n\r\n\t_isCanMove() {\r\n\t\treturn !this.state.freeze && !this.state.knockback;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} increment_percent - increment_percent >= -100\r\n\t */\r\n\tsetMovementSpeed(increment_percent) {\r\n\t\tif (!(Number.isSafeInteger(increment_percent) || (!Number.isNaN(increment_percent) && Number.isFinite(increment_percent)))) {\r\n\t\t\tdebugger\r\n\t\t\tif (true) {\r\n\t\t\t\tthrow new TypeError(\"increment_percent must is number\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet scale = (100 + increment_percent) / 100;\r\n\t\tif (scale > 0) {\r\n\t\t\tthis._setWalkerOmegaFromVelocity(MOVEMENT_VELOCITY * scale);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._setWalkerOmegaFromVelocity(0);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} speed - speed = pixel / second\r\n\t */\r\n\tsetMovementSpeedPixel(speed) {\r\n\t\tlet v = speed / $gv.CANVAS_SCALE;\r\n\t\tif (v > 0) {\r\n\t\t\tthis._walker_omega = v;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._walker_omega = 0;\r\n\t\t}\r\n\t}\r\n\t_setWalkerOmegaFromVelocity(movement_velocity) {\r\n\t\tthis._walker_omega = movement_velocity / (Math.PI * this.chara_profile.width) * Math.PI;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} increment_percent - increment_percent >= -100\r\n\t */\r\n\tsetjumpForce(increment_percent) {\r\n\t\tif (!(Number.isSafeInteger(increment_percent) || (!Number.isNaN(increment_percent) && Number.isFinite(increment_percent)))) {\r\n\t\t\tdebugger\r\n\t\t\tthrow new TypeError(\"increment_percent must is number\");\r\n\t\t}\r\n\r\n\t\tlet scale = (100 + increment_percent) / 100;\r\n\t\tif (scale <= 0) {\r\n\t\t\tthis.jump_force = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst gravity = this.body.GetWorld().GetGravity();\r\n\t\t\tthis.jump_force = JUMP_FORCE * scale;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\t_getMass() {\r\n\t\treturn this.body.GetMass() + this.foot_walk.GetMass();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} s\r\n\t */\r\n\tsetGravityScale(s) {\r\n\t\tthis.body.SetGravityScale(s);\r\n\t\tthis.foot_walk.SetGravityScale(s);\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @returns {string}\r\n\t */\r\n\tget _body_category() {\r\n\t\treturn \"body\";\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @returns {void}\r\n\t */\r\n\t_create(world) {\r\n\t\tlet first_pos = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](1 / $gv.CANVAS_SCALE, -2 / $gv.CANVAS_SCALE);\r\n\t\tlet jmp_body_pos_y = first_pos.y + this.chara_profile.height * 0.75 * 0.5;\r\n\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\t\tlet shape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PolygonShape\"]();\r\n\r\n\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_dynamicBody;\r\n\t\tbdef.bullet = true;//get real contact point\r\n\t\tbdef.position.Set(first_pos.x, first_pos.y);\r\n\t\tbdef.userData = this;\r\n\r\n\t\tfdef.userData = this;\r\n\r\n\t\t//create body\r\n\t\t{\r\n\t\t\tthis.body = world.CreateBody(bdef);\r\n\t\t\tthis.body.SetFixedRotation(true);\r\n\t\t}\r\n\t\tthis.body.$type = \"player\";\r\n\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_7__[\"FilterHelper\"].get(this._body_category));\r\n\r\n\t\t//head\r\n\t\t{\r\n\t\t\tshape.SetAsBox(\r\n\t\t\t\tthis.chara_profile.width * 0.5,\r\n\t\t\t\tthis.chara_profile.height * 0.75 * 0.5,\r\n\t\t\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].ZERO,//new b2Vec2(0, 0),//\r\n\t\t\t\t0);\r\n\r\n\t\t\tfdef.density = this.chara_profile.density;\r\n\t\t\tfdef.friction = 0;\r\n\t\t\tfdef.restitution = 0;\r\n\t\t\tfdef.shape = shape;\r\n\t\t\t//\r\n\t\t\tthis.fixture = this.body.CreateFixture(fdef);\r\n\t\t\tthis.fixture.$type = \"player\";\r\n\t\t}\r\n\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_7__[\"FilterHelper\"].get(\"foot\"));\r\n\t\t//\r\n\t\t//create walker\r\n\t\t{\r\n\t\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_dynamicBody;\r\n\t\t\tbdef.position.Set(first_pos.x, jmp_body_pos_y);\r\n\t\t\tthis.foot_walk = world.CreateBody(bdef);\r\n\r\n\t\t\tlet circle = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2CircleShape\"]();\r\n\t\t\tcircle.m_p.Set(0, 0);\r\n\t\t\tcircle.m_radius = this.chara_profile.foot_width;\r\n\t\t\tfdef.shape = circle;\r\n\t\t\tfdef.density = this.chara_profile.density;\r\n\t\t\t//fdef.filter = world.getFilterDefine(\"pl_ft_walk\");\r\n\t\t\tfdef.friction = FOOT_FRICTION;//walk\r\n\t\t\tfdef.restitution = 0;\r\n\t\t\tlet fixture = this.foot_walk.CreateFixture(fdef);\r\n\t\t\tfixture.$type = \"pl_ft_walk\";\r\n\r\n\t\t\tthis._set_foot_listener(fixture);\r\n\t\t}\r\n\t\tthis.foot_walk.$type = \"pl_ft_walk\";\r\n\r\n\t\t//j2\r\n\t\t{\r\n\t\t\tlet jd;\r\n\r\n\t\t\tif (PLAYER_USE_WHEEL_WALKER) {\r\n\t\t\t\tjd = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2WheelJointDef\"]();//b2WheelJointDef//b2RevoluteJointDef\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tjd = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2RevoluteJointDef\"]();//b2WheelJointDef//b2RevoluteJointDef\r\n\t\t\t}\r\n\r\n\t\t\tif (jd instanceof _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2RevoluteJointDef\"]) {\r\n\t\t\t\tjd.Initialize(this.body, this.foot_walk, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](first_pos.x, jmp_body_pos_y));\r\n\t\t\t}\r\n\t\t\tif (jd instanceof _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2WheelJointDef\"]) {\r\n\t\t\t\tjd.Initialize(this.body, this.foot_walk, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](first_pos.x, jmp_body_pos_y), new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, -1));\r\n\t\t\t}\r\n\t\t\tjd.enableMotor = true;\r\n\t\t\tjd.maxMotorTorque = MOVEMENT_POWER;\r\n\t\t\t//jd.motorSpeed = 40;\r\n\t\t\tif (jd instanceof _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2RevoluteJointDef\"]) {\r\n\t\t\t\tjd.enableLimit = false;\r\n\t\t\t\tjd.lowerAngle = 0 * DEGTORAD;\r\n\t\t\t\tjd.upperAngle = -0 * DEGTORAD;\r\n\t\t\t\tjd.referenceAngle = 0;\r\n\t\t\t}\r\n\t\t\tif (jd instanceof _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2WheelJointDef\"]) {\r\n\t\t\t\tjd.frequencyHz = 10;//springs\r\n\t\t\t\tjd.dampingRatio = 1;//springs\r\n\t\t\t}\r\n\t\t\tthis.walker = world.CreateJoint(jd);\r\n\t\t}\r\n\t\t\r\n\t\tthis.body.addStep(this.Step.bind(this));\r\n\t\tthis.body.addAfterStep(this.AfterStep.bind(this));\r\n\t\t\r\n\t\tthis.setMovementSpeed(0);\r\n\t\tthis.setjumpForce(0);\r\n\t}\r\n\t\r\n\t/**\r\n\t * destroy this\r\n\t * @returns {void}\r\n\t */\r\n\t_destroy() {\r\n\t\t/** @type {World} world */\r\n\t\tconst world = this.body.m_world;\r\n\r\n\t\tif (this.body) {\r\n\t\t\tworld.DestroyBody(this.body);\r\n\t\t\tthis.body = null;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"this already dead\");\r\n\t\t}\r\n\t\tif (this.foot_walk) {\r\n\t\t\tworld.DestroyBody(this.foot_walk);\r\n\t\t\tthis.foot_walk = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Fixture} fa - self\r\n\t * @param {b2Fixture} fb - other\r\n\t * @returns {boolean}\r\n\t */\r\n\t_isFromSelfContact(fa, fb) {\r\n\t\tlet a = fa.GetBody().GetUserData();\t// A data\r\n\t\tlet b = fb.GetBody().GetUserData();\t// B data\r\n\r\n\t\tif (a && b && a.body && b.body && a.body == b.body) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Fixture} fa - self\r\n\t * @param {b2Fixture} fb - other\r\n\t * @returns {boolean} - return true if from self and disable this contact\r\n\t */\r\n\t_ignoreSelfContact(contact, fa, fb) {\r\n\t\tif (this._isFromSelfContact(fa, fb)) {\r\n\t\t\tcontact.SetEnabled(false);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t_set_foot_listener(foot_fixture) {\r\n\t\tfoot_fixture.beginContact = this.__beginContact_walker;\r\n\t\tfoot_fixture.endContact = this.__endContact_walker;\r\n\t\tfoot_fixture.preSolve = this.__preSolve_walker;\r\n\t}\r\n\t\r\n\t__beginContact_walker(contact, fa, fb) {\r\n\t\tif (this._ignoreSelfContact(contact, fa, fb)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet targetBody = fb.m_body;\r\n\t\tif (targetBody) {\r\n\t\t\tswitch (targetBody.$type) {\r\n\t\t\t\tcase \"portal\":\r\n\t\t\t\t\tthis._beginContactPortal(fb.m_userData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__endContact_walker(contact, fa, fb) {\r\n\t\tif (this._ignoreSelfContact(contact, fa, fb)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet targetBody = fb.m_body;\r\n\t\tif (targetBody) {\r\n\t\t\tswitch (targetBody.$type) {\r\n\t\t\t\tcase \"portal\":\r\n\t\t\t\t\tthis._endContactPortal(fb.m_userData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t__preSolve_walker(contact, oldManifold, fa, fb) {\r\n\t\tif (this._ignoreSelfContact(contact, fa, fb)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (fa.$type == \"pl_ft_walk\" && fb.$type == \"pl_ft_walk\") {\r\n\t\t\tcontact.SetEnabled(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @param {MapPortal} portal */\r\n\t_beginContactPortal(portal) {\r\n\t\tthis.portal = portal;\r\n\r\n\t\tif (portal.enable) {\r\n\t\t\tif (portal.script) {\r\n\t\t\t\tconsole.log(\"goto map: \" + portal.getMap() + \"; \" + portal.script);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(\"goto map: \" + portal.getMap());\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"contact portal: %o\", portal);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @param {MapPortal} portal */\r\n\t_endContactPortal(portal) {\r\n\t\tif (this.portal == portal) {\r\n\t\t\tthis.portal = null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 決定接觸哪一個foothold，忽略牆壁\r\n\t * @param {Foothold} foothold\r\n\t * @param {b2Vec2} foot_at\r\n\t * @returns {number}\r\n\t */\r\n\t__priority_foothold_contact(foothold, foot_at) {\r\n\t\tif (foothold.is_wall) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (this.$foothold && this.$foothold.chain != foothold.chain) {\r\n\t\t\tif (this.$foothold != foothold && !this.state.dropDown) {\r\n\t\t\t\t// 接觸多個 foothold 以 \"下面\" 的為主，上坡時以 \"下(上)一個\" 為主\r\n\t\t\t\t// 忽略連續 foothold 重疊的點\r\n\t\t\t\tif (this._foot_at && foot_at.y < this._foot_at.y) {\r\n\t\t\t\t\tif ((!this.$foothold.prev || (this.$foothold.prev == foothold.id && foothold.y1 < this.$foothold.y1)) ||\r\n\t\t\t\t\t\t(!this.$foothold.next || (this.$foothold.next == foothold.id && foothold.y2 < this.$foothold.y2))\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//新的接觸\r\n\t\treturn 2;\r\n\t}\r\n\r\n\t/**\r\n\t * 決定接觸哪一個foothold，忽略牆壁\r\n\t * if foothold is wall then return true\r\n\t * @param {Foothold} foothold\r\n\t * @param {b2Vec2} foot_at\r\n\t */\r\n\t_which_foothold_contact(foothold, foot_at) {\r\n\t\tif (foothold.is_wall) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tlet priority = this.__priority_foothold_contact(foothold, foot_at);\r\n\t\tif (priority > 0) {\r\n\t\t\tif (!this._foothold_priority || priority >= this._foothold_priority) {\r\n\t\t\t\tthis._foothold = foothold;\r\n\t\t\t\tthis._foot_at = foot_at.Clone();\r\n\t\t\t\tthis._foothold_priority = priority;\r\n\t\t\t\t//this.sticky(foot_at);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let fc of this._foot_contact_list) {\r\n\t\t\t\t\tif (foothold == fc.foothold) {\r\n\t\t\t\t\t\tfc.priority = priority;\r\n\t\t\t\t\t\tfc.position = foot_at;\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet foot_contact = new FootContact(foothold, foot_at, priority);\r\n\t\t\t\tthis._foot_contact_list.push(foot_contact);\r\n\t\t\t\tthis._foot_contact_list.sort((a, b) => a.priority - b.priority);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {b2Vec2} anchor\r\n\t */\r\n\tsticky(anchor) {\r\n\t\t/** @type {World} */\r\n\t\tconst world = this.body.m_world;\r\n\r\n\t\tworld.onceUnlock(() => {\r\n\t\t\tif (this.$sticky_pj) {\r\n\t\t\t\treturn;\r\n\r\n\t\t\t\tworld.DestroyJoint(this.$sticky_pj);\r\n\t\t\t}\r\n\r\n\t\t\t//this.setPosition(anchor.x, anchor.y);\r\n\r\n\t\t\tlet pjd = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PrismaticJointDef\"]();\r\n\t\t\tpjd.Initialize(world.mapBound_body, this.body, anchor, new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, 1));\r\n\t\t\tif (0) {}\r\n\t\t\tpjd.lowerTranslation = 0;\r\n\t\t\tpjd.upperTranslation = 0;\r\n\t\t\tpjd.enableLimit = true;\r\n\t\t\tpjd.maxMotorForce = this._getMass() * 1000;\r\n\r\n\t\t\t/** @type {b2PrismaticJoint} */\r\n\t\t\tlet pj = world.CreateJoint(pjd);\r\n\r\n\t\t\tthis.$sticky_pj = pj;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {boolean}\r\n\t */\r\n\tisDrop() {\r\n\t\treturn this.state.dropDown || this.state._drop;\r\n\t}\r\n\r\n\t_endContactFoothold() {\r\n\t\tfor (let i = 0; i < this._endContactFootholdList.length; ++i) {\r\n\t\t\tlet fh = this._endContactFootholdList[i];\r\n\r\n\t\t\tif (fh == this._$fallEdge) {\r\n\t\t\t\tthis._$fallEdge = null;\r\n\t\t\t}\r\n\t\t\telse if (fh == this._foothold) {\r\n\t\t\t\tthis._foothold = null;\r\n\t\t\t\tthis._foot_at = null;\r\n\t\t\t}\r\n\t\t\t//else if (fh.id == this._foothold.id) {\r\n\t\t\t//\tthis._foothold = null;\r\n\t\t\t//\tthis._foot_at = null;\r\n\t\t\t//}\r\n\r\n\t\t\tif (this.$foothold && fh == this.$foothold) {\r\n\t\t\t\tthis.prev_$fh = this.$foothold;\r\n\t\t\t\tthis.$foothold = null;\r\n\t\t\t}\r\n\t\t\tif (this.leave_$fh && this.leave_$fh == fh) {\r\n\t\t\t\tthis.leave_$fh = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._endContactFootholdList.length = 0;//clear\r\n\t}\r\n\r\n\t/**\r\n\t * before world::step\r\n\t * @param {number} stamp\r\n\t */\r\n\tStep(stamp) {\r\n\t\t// prepare contact\r\n\t\tthis.state._drop = false;\r\n\t\tthis._foothold = null;\r\n\t\tthis._foot_at = null;\r\n\r\n\t\t// apply state\r\n\t\tif (this.state.ladder) {\r\n\t\t\tthis.state.jump = false;\r\n\t\t\tthis.state.jump_count = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (this.state._begin_jump) {\r\n\t\t\t\tconst mass = this._getMass();\r\n\t\t\t\tconst force = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, -mass * this.jump_force);\r\n\t\t\t\tthis.body.ApplyForceToCenter(force);\r\n\t\t\t}\r\n\r\n\t\t\tif (this.state.knockback > 0) {\r\n\t\t\t\tthis.state.knockback -= stamp;\r\n\r\n\t\t\t\tif (this.state.knockback > 0) {\r\n\t\t\t\t\tthis.state.outOfControl = true;\r\n\t\t\t\t\tthis.walker.EnableMotor(false);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.state.knockback = 0;\r\n\t\t\t\t\tthis.state.outOfControl = false;\r\n\t\t\t\t\tthis.walker.EnableMotor(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.state.invincible > 0) {\r\n\t\t\t\tthis.state.invincible -= stamp;\r\n\t\t\t\tif (this.state.invincible > 0) {\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.state.invincible = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.state.portal_cooldown) {\r\n\t\t\t\tthis.state.portal_cooldown -= stamp;\r\n\t\t\t\tif (this.state.portal_cooldown > 0) {\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.state.portal_cooldown = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * after world::step\r\n\t */\r\n\tAfterStep() {\r\n\t\t//this._endContactFoothold();\r\n\r\n\t\tif (this.state.ladder) {\r\n\t\t\tif (this.$ladder_pj) {\r\n\t\t\t\tconst upper = this.$ladder_pj.GetUpperLimit();\r\n\t\t\t\tconst lower =this.$ladder_pj.GetLowerLimit();\r\n\t\t\t\tconst translation = this.$ladder_pj.GetJointTranslation();\r\n\r\n\t\t\t\tif (this.state.ladder_move_dir > 0 && translation > upper) {//down\r\n\t\t\t\t\tthis.useLadder(false);\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.state.ladder_move_dir < 0 && translation < lower) {//up\r\n\t\t\t\t\tthis.useLadder(false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!this.state.dropDown) {\r\n\t\t\t\tif (this.body.m_awakeFlag && this.foot_walk.m_awakeFlag) {\r\n\t\t\t\t\tthis.$foothold = this._foothold;//set or clear\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._foothold && this._foot_contact_list.length) {//目前沒用，永遠不會被執行 ??\r\n\t\t\t\t\tlet max = this._foot_contact_list.pop();\r\n\t\t\t\t\tthis.$foothold = max.foothold;\r\n\t\t\t\t\tthis._foothold = max.foothold;\r\n\t\t\t\t\tthis._foot_at = max.position;\r\n\t\t\t\t\tthis._foothold_priority = max.priority;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.$foothold) {\r\n\t\t\t\t//this.body.SetAwake(false);\r\n\t\t\t\t//this.foot_walk.SetAwake(false);\r\n\r\n\t\t\t\tthis.state.jump = false;\r\n\t\t\t\tthis.state.jump_count = 0;\r\n\t\t\t\tif (this.$foothold == this._foothold) {\r\n\t\t\t\t\t//console.log(\"stable contact\");\r\n\t\t\t\t\t//debugger;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._foot_contact_list.length = 0;\r\n\r\n\t\t\t\tthis.state.jump = true;\r\n\t\t\t\tthis.state._begin_jump = false;\r\n\t\t\t\t\r\n\t\t\t\tif (!this._foothold) {\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t//console.log(\"no stable contact\");\r\n\t\t\t\t\t//debugger;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {number}\r\n\t */\r\n\tgetLayer() {\r\n\t\tlet layer = this.$foothold ? this.$foothold.layer : (this.prev_$fh ? this.prev_$fh.layer : (this.leave_$fh ? this.leave_$fh.layer : 5));\r\n\t\treturn this.state.ladder ? (layer + 1) : layer;\r\n\t}\r\n}\r\n\r\nclass PCharacter extends PCharacterBase {\r\n\tconstructor() {\r\n\t\tsuper(...arguments);\r\n\r\n\t\t/** @type {SceneCharacter} */\r\n\t\tthis.chara = null;\r\n\t}\r\n\r\n\t/**\r\n\t * need set this.state.outOfControl = true\r\n\t * @param {number} moveX - unit is pixel\r\n\t * @param {number} moveY - unit is pixel\r\n\t */\r\n\tforceMove(moveX, moveY) {\r\n\t\t//TODO: calc move\r\n\t\tconst mass = this._getMass();\r\n\t\tconst move = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](moveX * mass, moveY * mass);\r\n\t\tthis.body.ApplyLinearImpulseToCenter(move);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} moveX - unit is pixel\r\n\t * @param {number} moveY - unit is pixel\r\n\t * @param {number} [kbTime=1000] - knockback time, unit is millisecond\r\n\t */\r\n\tknockback(moveX, moveY, kbTime = 1000) {\r\n\t\tconst front = this.state.front;\r\n\t\tlet fx, fy;\r\n\t\t\r\n\t\tfx = -moveX * front;\r\n\t\t//fy = this.state.jump ? moveY : -moveY;\r\n\t\tfy = -moveY;\r\n\r\n\t\tthis.forceMove(fx, fy);\r\n\t\tthis.state.knockback = kbTime;\r\n\t\tthis.state.outOfControl = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t */\r\n\t_create_anchor(world) {\r\n\t\tlet md = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2MouseJointDef\"]();\r\n\t\tmd.bodyA = world.ground.bodies[0];\r\n\t\tmd.bodyB = this.body;\r\n\t\tmd.target.Copy(this.getPosition());\r\n\t\tmd.maxForce = 1000 * this._getMass();\r\n\t\treturn world.CreateJoint(md);\r\n\t}\r\n\r\n\t/**\r\n\t * no anchor\r\n\t * experimental\r\n\t * @param {CharacterMoveElem} moveElem\r\n\t */\r\n\tmoveTo(moveElem) {\r\n\t\tconst body = this.body;\r\n\t\t\r\n\t\tthis.body.SetAwake(true);\r\n\t\tthis.foot_walk.SetAwake(true);\r\n\r\n\t\tif (moveElem.elapsed == 0) {\r\n\t\t\tbody.ConstantVelocityWorldCenter2(vx, vy);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst ALPHA = 0.7;\r\n\t\t\tconst ONE_MINUS_ALPHA = 1 - ALPHA;\r\n\t\t\tlet dx = moveElem.x - pos.x;\r\n\t\t\tlet dy = moveElem.y - pos.y;\r\n\t\t\tlet sx = dx / (moveElem.elapsed / $gv.FRAME_ELAPSED);//speed = pixel / second\r\n\t\t\tlet sy = dy / (moveElem.elapsed / $gv.FRAME_ELAPSED);\r\n\t\t\tlet oldVel = body.GetLinearVelocity();\r\n\r\n\t\t\tlet vx, vy;\r\n\r\n\t\t\tif (moveElem.pState.jump) {\r\n\t\t\t\tthis.setGravityScale(0);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.setGravityScale(1);\r\n\t\t\t\t\r\n\t\t\t\tif (moveElem.pState.walk || sx) {\r\n\t\t\t\t\tthis.walker.EnableMotor(false);//this.$physics.walker.IsMotorEnabled() == true\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.walker.EnableMotor(true);//keep stop\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (sx) {\r\n\t\t\t\tif (moveElem.vx) {\r\n\t\t\t\t\tif (Math.sign(moveElem.vx) == Math.sign(sx)) {\r\n\t\t\t\t\t\tvx = oldVel.x * ONE_MINUS_ALPHA + moveElem.vx * ALPHA;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvx = oldVel.x * ONE_MINUS_ALPHA + sx * ALPHA;//修正座標\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvx = sx;//修正座標\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvx = 0;\r\n\t\t\t}\r\n\r\n\t\t\tif (sy) {\r\n\t\t\t\tif (moveElem.vy) {\r\n\t\t\t\t\tif (Math.sign(moveElem.vy) == Math.sign(sy)) {\r\n\t\t\t\t\t\tvy = oldVel.y * ONE_MINUS_ALPHA + moveElem.vy * ALPHA;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tvy = oldVel.y * ONE_MINUS_ALPHA + sy * ALPHA;//修正座標\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tvy = sy;//修正座標\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvy = 0;\r\n\t\t\t}\r\n\r\n\t\t\tbody.ConstantVelocityWorldCenter2(vx, vy);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nif (true) {\r\n\t/** @type {PPlayer[]} */\r\n\tvar PPlayer_instance_list = window.PPlayer_instance_list || [];\r\n\r\n\tif (PPlayer_instance_list) {\r\n\t\tfor (let pl of PPlayer_instance_list) {\r\n\t\t\tpl.__proto__ = PPlayer.prototype;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass PPlayer extends PCharacter {\r\n\tconstructor() {\r\n\t\tsuper(...arguments);\r\n\r\n\t\tif (true) {\r\n\t\t\tPPlayer_instance_list.push(this);\r\n\r\n\t\t\tconst super_destroy = super._destroy;\r\n\r\n\t\t\tthis._destroy = function () {\r\n\t\t\t\tsuper_destroy.call(this);\r\n\t\t\t\tPPlayer_instance_list.splice(PPlayer_instance_list.indexOf(this), 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @returns {void}\r\n\t */\r\n\t_create(world) {\r\n\t\tsuper._create(world);\r\n\r\n\t\twindow.SCREEN_PRINTLN(() => \"x\", () => this.getPosition().x.toFixed(3) + \" * \" + $gv.CANVAS_SCALE + \" = \" + (this.getPosition().x * $gv.CANVAS_SCALE).toFixed(0));\r\n\t\twindow.SCREEN_PRINTLN(() => \"y\", () => this.getPosition().y.toFixed(3) + \" * \" + $gv.CANVAS_SCALE + \" = \" + (this.getPosition().y * $gv.CANVAS_SCALE).toFixed(0));\r\n\t\twindow.SCREEN_PRINTLN(() => \"jump\", () => this.state.jump);\r\n\t\twindow.SCREEN_PRINTLN(() => \"_drop\", () => this.state._drop);\r\n\t\twindow.SCREEN_PRINTLN(() => \"ddrop\", () => this.state.dropDown);\r\n\t\twindow.SCREEN_PRINTLN(() => \"$fh\", () => this.$foothold ? this.$foothold.id : null);\r\n\t\twindow.SCREEN_PRINTLN(() => \"$fh->c\", () => this.$foothold ? this.$foothold.chain.id : null);\r\n\t\twindow.SCREEN_PRINTLN(() => \"_fh\", () => this._foothold ? this._foothold.id : null);\r\n\t\twindow.SCREEN_PRINTLN(() => \"p$fh\", () => this.prev_$fh ? this.prev_$fh.id : null);\r\n\t\twindow.SCREEN_PRINTLN(() => \"leave_$fh\", () => this.leave_$fh ? this.leave_$fh.id : null);\r\n\r\n\t\twindow.SCREEN_PRINTLN(() => \"(jump && !$fh)\", () => this.state.jump && !this.$foothold);\r\n\r\n\t\twindow.SCREEN_PRINTLN(() => \"vel.x\", () => (this.body.m_linearVelocity.x * $gv.CANVAS_SCALE).toFixed(0));\r\n\t\twindow.SCREEN_PRINTLN(() => \"vel.y\", () => (this.body.m_linearVelocity.y * $gv.CANVAS_SCALE).toFixed(0));\r\n\t}\r\n\r\n\t/**\r\n\t * before world::step\r\n\t * @param {number} stamp\r\n\t */\r\n\tStep(stamp) {\r\n\t\tsuper.Step(stamp);\r\n\t\t\r\n\t\tif ($gv.input_keyDown['B'] == 1 && !$gv.mouse_dl) {\r\n\t\t\tconst px = $gv.m_viewRect.left + $gv.mouse_x;\r\n\t\t\tconst py = $gv.m_viewRect.top + $gv.mouse_y;\r\n\r\n\t\t\tthis.setPosition(px / $gv.CANVAS_SCALE, py / $gv.CANVAS_SCALE, true);\r\n\t\t}\r\n\t\telse if ($gv.input_keyDown['B'] > 0 && $gv.mouse_dl) {\r\n\t\t\tconst center = $gv.m_viewRect.center;\r\n\t\t\tconst px = $gv.m_viewRect.left + $gv.mouse_x - center.x;\r\n\t\t\tconst py = $gv.m_viewRect.top + $gv.mouse_y - center.y;\r\n\r\n\t\t\tthis.body.SetLinearVelocity(new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](px / $gv.CANVAS_SCALE, py / $gv.CANVAS_SCALE));\r\n\t\t\tthis.foot_walk.SetLinearVelocity(new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](px / $gv.CANVAS_SCALE, py / $gv.CANVAS_SCALE));\r\n\t\t}\r\n\t\telse if ($gv.mouse_dm && $gv.mouse_dm % 12 == 1) {\r\n\t\t\tconst px = $gv.m_viewRect.left + $gv.mouse_x;\r\n\t\t\tconst py = $gv.m_viewRect.top + $gv.mouse_y;\r\n\t\t\tthis.setPosition(px / $gv.CANVAS_SCALE, py / $gv.CANVAS_SCALE, true);\r\n\t\t}\r\n\t}\r\n\r\n\tget renderer() {\r\n\t\tdebugger\r\n\t\treturn this._$renderer;\r\n\t}\r\n\tset renderer(value) {\r\n\t\tthis._$renderer = value;\r\n\t}\r\n}\r\n\r\nif (true) {\r\n\t/** @type {PRemoteCharacter[]} */\r\n\tvar PRemoteCharacter_instance_list = window.PRemoteCharacter_instance_list || [];\r\n\r\n\tif (PRemoteCharacter_instance_list) {\r\n\t\tfor (let pl of PRemoteCharacter_instance_list) {\r\n\t\t\tpl.__proto__ = PRemoteCharacter.prototype;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass PRemoteCharacter extends PCharacter {\r\n\tconstructor() {\r\n\t\tsuper(...arguments);\r\n\r\n\t\t/** @type {b2MouseJoint} */\r\n\t\tthis._anchor = null;\r\n\r\n\t\tif (true) {\r\n\t\t\tPRemoteCharacter_instance_list.push(this);\r\n\r\n\t\t\tconst super_destroy = super._destroy;\r\n\r\n\t\t\tthis._destroy = function () {\r\n\t\t\t\tsuper_destroy.call(this);\r\n\t\t\t\tPRemoteCharacter_instance_list.splice(PRemoteCharacter_instance_list.indexOf(this), 1);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {World} world\r\n\t * @returns {void}\r\n\t */\r\n\t_create(world) {\r\n\t\tsuper._create(world);\r\n\r\n\t\tif (window.$io) {\r\n\t\t\tthis._anchor = this._create_anchor(world);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.moveTo = super.moveTo;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {CharacterMoveElem} moveElem\r\n\t */\r\n\tmoveTo(moveElem) {\r\n\t\tthis.body.SetAwake(true);\r\n\t\tthis.foot_walk.SetAwake(true);\r\n\t\t\r\n\t\t//if (this._anchor) {\r\n\t\t\tthis._anchor.m_targetA.x = moveElem.x;\r\n\t\t\tthis._anchor.m_targetA.y = moveElem.y;\r\n\t\t//}\r\n\t\t//else {\r\n\t\t//\tsuper.moveTo(moveElem);\r\n\t\t//}\r\n\t}\r\n}\r\n\r\nif (true) {\r\n\tmodule.hot.accept();\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL1BQbGF5ZXIuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9QaHlzaWNzL1BQbGF5ZXIuanM/ZTdmNCJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHtcclxuXHRiMl9saW5lYXJTbG9wLFxyXG5cdGIyVmVjMixcclxuXHRiMkJvZHlUeXBlLCBiMkJvZHlEZWYsIGIyRml4dHVyZURlZixcclxuXHRiMkJvZHksIGIyRml4dHVyZSxcclxuXHRiMlBvbHlnb25TaGFwZSwgYjJDaXJjbGVTaGFwZSxcclxuXHRiMldoZWVsSm9pbnREZWYsIGIyUmV2b2x1dGVKb2ludERlZiwgYjJQcmlzbWF0aWNKb2ludERlZiwgYjJNb3VzZUpvaW50RGVmLFxyXG5cdGIySm9pbnQsIGIyUmV2b2x1dGVKb2ludCwgYjJQcmlzbWF0aWNKb2ludCwgYjJNb3VzZUpvaW50LFxyXG5cdGIyQ29udGFjdCxcclxufSBmcm9tIFwiLi9QaHlzaWNzLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBGb290aG9sZCB9IGZyb20gXCIuL0dyb3VuZC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgV29ybGQgfSBmcm9tIFwiLi9Xb3JsZC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgQ2hhcmFjdGVyTW92ZUVsZW0gfSBmcm9tIFwiLi4vLi4vQ2xpZW50L1BNb3ZlUGF0aC5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZU9iamVjdCB9IGZyb20gXCIuLi9TY2VuZU9iamVjdC5qc1wiO1xyXG5cclxuaW1wb3J0IHsgU2NlbmVNYXAgfSBmcm9tIFwiLi4vTWFwLmpzXCI7XHJcbmltcG9ydCB7IExhZGRlclJvcGUgfSBmcm9tIFwiLi9MYWRkZXJSb3BlLmpzXCI7XHJcbmltcG9ydCB7IEZpbHRlckhlbHBlciB9IGZyb20gXCIuL0ZpbHRlci5qc1wiO1xyXG5cclxuXHJcbmNvbnN0IERFR1RPUkFEID0gTWF0aC5QSSAvIDE4MDtcclxuXHJcbmxldCBiMlZlYzJfdGVtcCA9IG5ldyBiMlZlYzIoKTtcclxuXHJcbi8qKlxyXG4gKiBwaHlzaWNzIHByb2ZpbGVcclxuICovXHJcbmNvbnN0IGNoYXJhX3Byb2ZpbGUgPSB7XHJcblx0d2lkdGg6IDI1IC8gJGd2LkNBTlZBU19TQ0FMRSxcclxuXHRoZWlnaHQ6IDQ4IC8gJGd2LkNBTlZBU19TQ0FMRSxcclxuXHRkZW5zaXR5OiAxLFxyXG5cdC8qKiByYWRpdXMgKi9cclxuXHRnZXQgZm9vdF93aWR0aCgpIHtcclxuXHRcdHJldHVybiAoY2hhcmFfcHJvZmlsZS53aWR0aCAqIDAuNSk7XHJcblx0fSxcclxuXHQvKiogcmFkaXVzICovXHJcblx0Z2V0IGZvb3Rfal93aWR0aCgpIHtcclxuXHRcdHJldHVybiAoY2hhcmFfcHJvZmlsZS53aWR0aCAqIDAuNCk7XHJcblx0fSxcclxufTtcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcblx0Y29uc3QganVtcFNwZWVkID0gNTU1Oy8vPz9cclxuXHRjb25zdCBmYWxsU3BlZWQgPSA2NzA7Ly9weC9zXHJcblx0Y29uc3Qgd2Fsa1NwZWVkID0gMTI1Oy8vcHgvc1xyXG5cdFxyXG5cdHdpbmRvdy5KVU1QX0ZPUkNFID0ganVtcFNwZWVkO1xyXG5cclxuXHR3aW5kb3cuTU9WRU1FTlRfVkVMT0NJVFkgPSB3YWxrU3BlZWQgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdHdpbmRvdy4kTEFEREVSX1NQRUVEID0gd2Fsa1NwZWVkIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHJcblx0d2luZG93LlBMQVlFUl9VU0VfV0hFRUxfV0FMS0VSID0gZmFsc2U7XHJcblxyXG5cdHdpbmRvdy5GT09UX0ZSSUNUSU9OID0gMTtcclxuXHJcblx0d2luZG93Lk1PVkVNRU5UX1BPV0VSID0gMTQwMDAwO1xyXG5cdHdpbmRvdy5NT1ZFTUVOVF9TVE9QX1BPV0VSID0gMTQwMDAwO1xyXG5cclxuXHR3aW5kb3cuUE9SVEFMX0NPT0xET1dOID0gMTAwMDtcclxufSkoKTtcclxuXHJcblxyXG5leHBvcnQgY2xhc3MgUFBsYXllclN0YXRlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gLSBBcHBseUZvcmNlKGp1bXBfZm9yY2UpIHVudGlsIGxlYXZlIGZvb3Rob2xkICovXHJcblx0XHR0aGlzLl9iZWdpbl9qdW1wID0gZmFsc2U7XHJcblxyXG5cdFx0LyoqIGp1bXBfY291bnQgPSBqdW1wID8ganVtcF9jb3VudCA6IDAgKi9cclxuXHRcdHRoaXMuanVtcCA9IHRydWU7XHJcblxyXG5cdFx0LyoqIGp1bXBfY291bnQgPSBqdW1wID8ganVtcF9jb3VudCA6IDAgKi9cclxuXHRcdHRoaXMuanVtcF9jb3VudCA9IDA7XHJcblxyXG5cdFx0LyoqID8/ICovXHJcblx0XHR0aGlzLl9kcm9wID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLndhbGsgPSBmYWxzZTtcclxuXHJcblx0XHR0aGlzLnByb25lID0gZmFsc2U7XHJcblxyXG5cdFx0LyoqIFRPRE86IGZhbGxEb3duICovXHJcblx0XHR0aGlzLmRyb3BEb3duID0gZmFsc2U7XHJcblxyXG5cdFx0dGhpcy5fZmx5ID0gZmFsc2U7Ly9ub3QganVtcCBcclxuXHRcdFxyXG5cdFx0dGhpcy5icmFrZSA9IHRydWU7Ly8/P1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUgey0xfDF9ICovXHJcblx0XHR0aGlzLmZyb250ID0gLTE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAtIGlzIHVzZSBsYWRkZXIgKi9cclxuXHRcdHRoaXMubGFkZGVyID0gZmFsc2U7XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBhY3Rpb24gYW5pbWF0aW9uXHJcblx0XHQgKiBAdHlwZSB7LTF8MHwxfSAtIHVwOiAtMSwgZG93bjogMSwgc3RvcDogMFxyXG5cdFx0ICovXHJcblx0XHR0aGlzLmxhZGRlcl9tb3ZlX2RpciA9IDA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0g54Sh5pW15pmC6ZaT77yMdW5pdCBpcyBtaWxsaXNlY29uZCAqL1xyXG5cdFx0dGhpcy5pbnZpbmNpYmxlID0gMDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAtIGNhbiBub3QgbW92ZSBvciBqdW1wICovXHJcblx0XHR0aGlzLmZyZWV6ZSA9IGZhbHNlO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gLSBjYW4gbm90IG1vdmUgb3IganVtcCAqL1xyXG5cdFx0dGhpcy5pbnZva2VTa2lsbCA9IGZhbHNlO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAtIHVzZSBwb3J0YWwgY29vbGRvd24gdGltZe+8jHVuaXQgaXMgbWlsbGlzZWNvbmQgKi9cclxuXHRcdHRoaXMucG9ydGFsX2Nvb2xkb3duID0gMDtcclxuXHRcdFxyXG5cdFx0Ly9cclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBrbm9ja2JhY2sgdGltZe+8jHVuaXQgaXMgbWlsbGlzZWNvbmQgKi9cclxuXHRcdHRoaXMua25vY2tiYWNrID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59IC0gb2ZmIHdhbGtlciBwb3dlciAqL1xyXG5cdFx0dGhpcy5vdXRPZkNvbnRyb2wgPSBmYWxzZTtcclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBAcGFyYW0ge251bWJlcn0ganVtcF9oZWlnaHRcclxuICogQHBhcmFtIHtiMlZlYzJ9IGdyYXZpdHlcclxuICovXHJcbmZ1bmN0aW9uIF9DYWxjSnVtcEltcHVsc2UoanVtcF9oZWlnaHQsIGdyYXZpdHkpIHtcclxuXHRsZXQgaW1wdWxzZSA9IE1hdGguc3FydChqdW1wX2hlaWdodCAqIDIuMCAqIE1hdGguYWJzKGdyYXZpdHkueSkpO1xyXG5cdC8vKGltcHVsc2UgPSBtICogdikgPT4gKEYgPSDiiKsgTWFzcyAqIGRWZWwpXHJcblx0cmV0dXJuIGltcHVsc2U7XHJcbn1cclxuXHJcblxyXG5jbGFzcyBDb250cm9sS2V5cyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHR0aGlzLnVwID0gMDtcclxuXHRcdHRoaXMubGVmdCA9IDA7XHJcblx0XHR0aGlzLmRvd24gPSAwO1xyXG5cdFx0dGhpcy5yaWdodCA9IDA7XHJcblx0XHR0aGlzLmp1bXAgPSAwO1xyXG5cdFx0dGhpcy5lbnRlclBvcnRhbCA9IDA7Ly9UT0RPOiBrZXk6IGVudGVyUG9ydGFsXHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgRm9vdENvbnRhY3Qge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7Rm9vdGhvbGR9IGZvb3Rob2xkXHJcblx0ICogQHBhcmFtIHtiMlZlYzJ9IHBvc2l0aW9uXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHByaW9yaXR5XHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoZm9vdGhvbGQsIHBvc2l0aW9uLCBwcmlvcml0eSkge1xyXG5cdFx0LyoqIEB0eXBlIHtGb290aG9sZH0gKi9cclxuXHRcdHRoaXMuZm9vdGhvbGQgPSBmb290aG9sZDtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyVmVjMn0gKi9cclxuXHRcdHRoaXMucG9zaXRpb24gPSBwb3NpdGlvbjtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMucHJpb3JpdHkgPSBwcmlvcml0eTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFBDaGFyYWN0ZXJCYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuZW5hYmxlID0gdHJ1ZTtcclxuXHJcblx0XHR0aGlzLmNoYXJhX3Byb2ZpbGUgPSBPYmplY3QuYXNzaWduKHt9LCBjaGFyYV9wcm9maWxlKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5zZXRNb3ZlbWVudFNwZWVkKDEwMCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtiMkJvZHl9ICovXHJcblx0XHR0aGlzLmJvZHkgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7YjJCb2R5fSAqL1xyXG5cdFx0dGhpcy5mb290X3dhbGsgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7YjJKb2ludHxiMlJldm9sdXRlSm9pbnR9ICovXHJcblx0XHR0aGlzLndhbGtlciA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtGb290aG9sZH0gKi9cclxuXHRcdHRoaXMuJGZvb3Rob2xkID0gbnVsbDtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIHRoaXMuJGZvb3Rob2xkIG9sZCB2YWx1ZVxyXG5cdFx0ICogQHR5cGUge0Zvb3Rob2xkfVxyXG5cdFx0ICovXHJcblx0XHR0aGlzLnByZXZfJGZoID0gbnVsbDtcclxuXHJcblx0XHQvKipcclxuXHRcdCAqIG5vIGNvbnRhY3QgbGVhdmVfJGZoXHJcblx0XHQgKiB3aGVyZSBmb290aG9sZCBjaGFyYSBkcm9wRG93blxyXG5cdFx0ICogQHR5cGUge0Zvb3Rob2xkfVxyXG5cdFx0ICovXHJcblx0XHR0aGlzLmxlYXZlXyRmaCA9IG51bGw7XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7Rm9vdGhvbGR9IC0gaW4gV29ybGQ6OlNldHAgKi9cclxuXHRcdHRoaXMuX2Zvb3Rob2xkID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyVmVjMn0gLSBjb250YWN0IGZvb3Rob2xkIHBvaW50ICovXHJcblx0XHR0aGlzLl9mb290X2F0ID0gbmV3IGIyVmVjMigpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5fZm9vdGhvbGRfcHJpb3JpdHkgPSAwO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge0Zvb3RDb250YWN0W119ICovXHJcblx0XHR0aGlzLl9mb290X2NvbnRhY3RfbGlzdCA9IFtdO1xyXG5cclxuXHJcblx0XHQvKiogQHR5cGUge01hcFBvcnRhbH0gKi9cclxuXHRcdHRoaXMucG9ydGFsID0gbnVsbDtcclxuXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtMYWRkZXJSb3BlfSAqL1xyXG5cdFx0dGhpcy5sYWRkZXIgPSBudWxsO1xyXG5cclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuX3dhbGtlcl9vbWVnYSA9IDE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmp1bXBfZm9yY2UgPSBKVU1QX0ZPUkNFO1xyXG5cclxuXHRcdHRoaXMuc3RhdGUgPSBuZXcgUFBsYXllclN0YXRlKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5XHJcblx0ICogQHBhcmFtIHtib29sZWFufSBjbGVhckZvcmNlXHJcblx0ICovXHJcblx0c2V0UG9zaXRpb24oeCwgeSwgY2xlYXJGb3JjZSkge1xyXG5cdFx0Y29uc3QgYnkgPSB5IC0gdGhpcy5jaGFyYV9wcm9maWxlLmZvb3Rfd2lkdGggLSB0aGlzLmNoYXJhX3Byb2ZpbGUuaGVpZ2h0ICogMC43NSAqIDAuNTtcclxuXHRcdGNvbnN0IGZ5ID0geSAtIHRoaXMuY2hhcmFfcHJvZmlsZS5mb290X3dpZHRoO1xyXG5cclxuXHRcdHRoaXMuYm9keS5TZXRQb3NpdGlvblhZKHgsIGJ5KTtcclxuXHJcblx0XHR0cnkge1xyXG5cdFx0XHRpZiAodGhpcy5mb290X3dhbGspXHJcblx0XHRcdFx0dGhpcy5mb290X3dhbGsuU2V0UG9zaXRpb25YWSh4LCBmeSk7XHJcblxyXG5cdFx0XHRpZiAoY2xlYXJGb3JjZSkge1xyXG5cdFx0XHRcdGNvbnN0IHNwZWVkID0gbmV3IGIyVmVjMigwLCAwKTtcclxuXHRcdFx0XHR0aGlzLmJvZHkuQ29uc3RhbnRWZWxvY2l0eShzcGVlZCk7XHJcblx0XHRcdFx0aWYgKHRoaXMuZm9vdF93YWxrKVxyXG5cdFx0XHRcdFx0dGhpcy5mb290X3dhbGsuQ29uc3RhbnRWZWxvY2l0eShzcGVlZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBnZXQgYm90dG9tIHBvc2l0aW9uXHJcblx0ICogQHJldHVybnMge3t4OiBudW1iZXIsIHk6IG51bWJlcn19XHJcblx0ICovXHJcblx0Z2V0UG9zaXRpb24oKSB7XHJcblx0XHRjb25zdCBwb3MgPSB0aGlzLmZvb3Rfd2Fsay5HZXRQb3NpdGlvbigpO1xyXG5cdFx0cmV0dXJuIG5ldyBiMlZlYzIocG9zLngsIHBvcy55ICsgdGhpcy5jaGFyYV9wcm9maWxlLmZvb3Rfd2lkdGgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogZnJvbS50bihocDAwXzEpID09IHRvLnBuKGhwMDBfMSkgJiYgZnJvbS5wbihocDAwKSA9PSB0by50bihocDAwKVxyXG5cdCAqIEBwYXJhbSB7TWFwUG9ydGFsfSBwb3J0YWxcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiBlbnRlciBwb3J0YWxcclxuXHQgKi9cclxuXHRfdXNlUG9ydGFsKHBvcnRhbCkge1xyXG5cdFx0aWYgKCFwb3J0YWwuZW5hYmxlIHx8IHRoaXMuc3RhdGUucG9ydGFsX2Nvb2xkb3duID4gMCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblx0XHQvKiogQHR5cGUge1NjZW5lTWFwfSAqL1xyXG5cdFx0Y29uc3QgbWFwUmVuZGVyZXIgPSBwb3J0YWwubWFwUmVuZGVyZXI7XHJcblxyXG5cdFx0Y29uc3QgbWFwQ29udHJvbGxlciA9IG1hcFJlbmRlcmVyLmNvbnRyb2xsZXI7XHJcblx0XHRcclxuXHRcdGNvbnN0IG1hcF9pZCA9IHBvcnRhbC5nZXRNYXAoKTtcclxuXHRcdFxyXG5cdFx0aWYgKHBvcnRhbC5leGVTY3JpcHQpIHsvL1RPRE86IHBvcnRhbCBzY3JpcHRcclxuXHRcdFx0cG9ydGFsLmV4ZVNjcmlwdCh0aGlzKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKG1hcF9pZCkge1xyXG5cdFx0XHRpZiAobWFwX2lkID09IG1hcFJlbmRlcmVyLm1hcF9pZCkge1xyXG5cdFx0XHRcdGNvbnN0IHJlZyA9IHBvcnRhbC50bi5tYXRjaCgvKF5bYS16X10rKShcXGQrJCkvKSB8fCBwb3J0YWwudG4ubWF0Y2goLyheW2Etel0rKVxcZCtfXFxkKyQvKTsvL3BuP3RuP1xyXG5cdFx0XHRcdGNvbnN0IGNtZCA9IHJlZ1sxXTtcclxuXHJcblx0XHRcdFx0aWYgKGNtZCA9PSBcImhwXCIpIHtcclxuXHRcdFx0XHRcdGxldCBmcm9tVG4gPSBwb3J0YWwudG47XHJcblx0XHRcdFx0XHRsZXQgdG9Qb3J0YWwgPSBtYXBSZW5kZXJlci5wb3J0YWxNZ3IucG9ydGFscy5maW5kKGZ1bmN0aW9uICh0b1BvcnRhbCkge1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gZnJvbVRuID09IHRvUG9ydGFsLnBuO1xyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHRcdFx0XHR0aGlzLl9nb3RvUG9ydGFsKHRvUG9ydGFsKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoY21kID09IFwicHRfZ29cIikge1xyXG5cdFx0XHRcdFx0ZGVidWdnZXI7Ly8/P1xyXG5cclxuXHRcdFx0XHRcdGNvbnN0IHRwaWQgPSBwYXJzZUludChyZWdbMl0sIDEwKTtcclxuXHRcdFx0XHRcdGNvbnN0IHRwID0gbWFwUmVuZGVyZXIucG9ydGFsTWdyLnBvcnRhbHNbdHBpZF07XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5fZ290b1BvcnRhbCh0cCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0Y29uc29sZS5sb2coYHBvcnRhbC5wbjogJHtwb3J0YWwucG59LCBwb3J0YWwudG46ICR7cG9ydGFsLnRufSwgJW9gLCBwb3J0YWwpO1xyXG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRtYXBDb250cm9sbGVyLmRvQWZ0ZXJTdGVwKGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRcdG1hcFJlbmRlcmVyLnVubG9hZCgpO1xyXG5cdFx0XHRcdFx0bWFwUmVuZGVyZXIubG9hZChtYXBfaWQpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJwb3J0YWw6ICRvXCIsIHBvcnRhbCk7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHRcdHRoaXMuc3RhdGUucG9ydGFsX2Nvb2xkb3duID0gUE9SVEFMX0NPT0xET1dOOy8v6Ziy5q2i6YeN6KSHXHJcblx0XHRyZXR1cm4gdHJ1ZTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtNYXBQb3J0YWx9IHBvcnRhbFxyXG5cdCAqL1xyXG5cdF9nb3RvUG9ydGFsKHBvcnRhbCkge1xyXG5cdFx0LyoqIEB0eXBlIHtTY2VuZU1hcH0gKi9cclxuXHRcdGNvbnN0IG1hcFJlbmRlcmVyID0gcG9ydGFsLm1hcFJlbmRlcmVyO1xyXG5cdFx0Y29uc3QgbWFwQ29udHJvbGxlciA9IG1hcFJlbmRlcmVyLmNvbnRyb2xsZXI7XHJcblxyXG5cdFx0Ly9ub3QgaW4gd29ybGQuU3RlcFxyXG5cdFx0bWFwQ29udHJvbGxlci5kb0FmdGVyU3RlcCgoKSA9PiB7XHJcblx0XHRcdGNvbnN0IHggPSBwb3J0YWwueCAvICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRcdGNvbnN0IHkgPSAocG9ydGFsLnkgLSAzKSAvICRndi5DQU5WQVNfU0NBTEU7Ly9hZGogcG9ydGFsIHBvc1xyXG5cdFx0XHR0aGlzLnNldFBvc2l0aW9uKHgsIHksIHRydWUpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBzZXQgbGFkZGVyLCBub3QgdXNlXHJcblx0ICogQHBhcmFtIHtMYWRkZXJSb3BlfSBsYWRkZXJcclxuXHQgKi9cclxuXHRjb250YWN0TGFkZGVyKGxhZGRlcikge1xyXG5cdFx0aWYgKGxhZGRlcikge1xyXG5cdFx0XHR0aGlzLmxhZGRlciA9IGxhZGRlcjtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLmxhZGRlciA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cdGxlYXZlTGFkZGVyKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtXb3JsZH0gKi9cclxuXHRcdGNvbnN0IHdvcmxkID0gdGhpcy5ib2R5Lm1fd29ybGQ7XHJcblxyXG5cdFx0d29ybGQub25jZVVubG9jaygoKSA9PiB7XHJcblx0XHRcdHRoaXMuX3VzZUxhZGRlcihmYWxzZSk7XHJcblx0XHRcdHRoaXMuY29udGFjdExhZGRlcihudWxsLCBudWxsKTsvL3NldCBubyBjb250YWN0XHJcblx0XHR9KTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBmbGFnIC0gdHJ1ZTogdXNlLCBmYWxzZTogbm8gdXNlXHJcblx0ICovXHJcblx0dXNlTGFkZGVyKGZsYWcpIHtcclxuXHRcdC8qKiBAdHlwZSB7V29ybGR9ICovXHJcblx0XHRjb25zdCB3b3JsZCA9IHRoaXMuYm9keS5tX3dvcmxkO1xyXG5cclxuXHRcdHdvcmxkLm9uY2VVbmxvY2soKCkgPT4ge1xyXG5cdFx0XHR0aGlzLl91c2VMYWRkZXIoZmxhZyk7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBmbGFnIC0gdHJ1ZTogdXNlLCBmYWxzZTogbm8gdXNlXHJcblx0ICovXHJcblx0X3VzZUxhZGRlcihmbGFnKSB7XHJcblx0XHQvKiogQHR5cGUge1dvcmxkfSAqL1xyXG5cdFx0Y29uc3Qgd29ybGQgPSB0aGlzLmJvZHkubV93b3JsZDtcclxuXHJcblx0XHRpZiAoZmxhZykge1xyXG5cdFx0XHRpZiAodGhpcy5sYWRkZXIgJiYgIXRoaXMuJGxhZGRlcl9waikge1xyXG5cdFx0XHRcdGNvbnN0IGxhZGRlckJvZHkgPSB0aGlzLmxhZGRlci5ib2R5O1xyXG5cclxuXHRcdFx0XHRpZiAobGFkZGVyQm9keS5HZXRBbmdsZSgpIHx8IGxhZGRlckJvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuYm9keS5TZXRBbmdsZShsYWRkZXJCb2R5LkdldEFuZ2xlKCkpO1xyXG5cdFx0XHRcdFx0dGhpcy5ib2R5LlNldEZpeGVkUm90YXRpb24oZmFsc2UpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dGhpcy5zdGF0ZS5sYWRkZXIgPSB0cnVlO1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUuanVtcCA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUuanVtcF9jb3VudCA9IDA7XHJcblxyXG5cdFx0XHRcdHRoaXMuYm9keS5TZXRBd2FrZSh0cnVlKTtcclxuXHRcdFx0XHR0aGlzLmJvZHkuU2V0TGluZWFyVmVsb2NpdHkyKDAsIDApO1xyXG5cdFx0XHRcdHRoaXMuYm9keS5tX3R5cGUgPSBiMkJvZHlUeXBlLmIyX2tpbmVtYXRpY0JvZHk7XHJcblx0XHRcdFx0Ly9cclxuXHRcdFx0XHR0aGlzLmZvb3Rfd2Fsay5TZXRBd2FrZSh0cnVlKTtcclxuXHRcdFx0XHR0aGlzLmZvb3Rfd2Fsay5TZXRMaW5lYXJWZWxvY2l0eTIoMCwgMCk7XHJcblx0XHRcdFx0dGhpcy5mb290X3dhbGsubV90eXBlID0gYjJCb2R5VHlwZS5iMl9raW5lbWF0aWNCb2R5O1xyXG5cclxuXHRcdFx0XHR0aGlzLndhbGtlci5TZXRNb3RvclNwZWVkKDApO1xyXG5cclxuXHRcdFx0XHQvLyBjcmVhdGUgam9pbnRcclxuXHJcblx0XHRcdFx0bGV0IGhlaWdodCA9IHRoaXMubGFkZGVyLmNhbGNIZWlnaHQoKSAvICRndi5DQU5WQVNfU0NBTEU7XHJcblxyXG5cdFx0XHRcdC8vbGV0IGdyb3VuZCA9IHdvcmxkLmdyb3VuZC5ib2RpZXNbMF07XHJcblxyXG5cdFx0XHRcdHRoaXMuc2V0UG9zaXRpb24obGFkZGVyQm9keS5HZXRQb3NpdGlvbigpLngsIHRoaXMuZ2V0UG9zaXRpb24oKS55KTtcclxuXHJcblx0XHRcdFx0bGV0IHBqZCA9IG5ldyBiMlByaXNtYXRpY0pvaW50RGVmKCk7XHJcblx0XHRcdFx0Ly9wamQuSW5pdGlhbGl6ZShsYWRkZXJCb2R5LCB0aGlzLmJvZHksIGFuY2hvciwgbmV3IGIyVmVjMigwLCAxKSk7XHJcblx0XHRcdFx0e1xyXG5cdFx0XHRcdFx0cGpkLmJvZHlBID0gbGFkZGVyQm9keTtcclxuXHRcdFx0XHRcdHBqZC5ib2R5QiA9IHRoaXMuZm9vdF93YWxrOy8vdGhpcy5ib2R5O1xyXG5cdFx0XHRcdFx0Ly9wamQubG9jYWxBbmNob3JBLlNldCgwLCAwKTtcclxuXHRcdFx0XHRcdC8vcGpkLmxvY2FsQW5jaG9yQi5TZXQoMCwgMCk7XHJcblx0XHRcdFx0XHRwamQubG9jYWxBeGlzQS5TZXQoMCwgMSk7XHJcblx0XHRcdFx0XHQvL3BqZC5yZWZlcmVuY2VBbmdsZSA9IDA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHBqZC5sb3dlclRyYW5zbGF0aW9uID0gLXRoaXMuY2hhcmFfcHJvZmlsZS5mb290X3dpZHRoO1xyXG5cdFx0XHRcdHBqZC51cHBlclRyYW5zbGF0aW9uID0gaGVpZ2h0ICsgdGhpcy5jaGFyYV9wcm9maWxlLmZvb3Rfd2lkdGg7XHJcblx0XHRcdFx0cGpkLmVuYWJsZUxpbWl0ID0gdHJ1ZTtcclxuXHRcdFx0XHRwamQubWF4TW90b3JGb3JjZSA9IHRoaXMuX2dldE1hc3MoKSAqIDEwMDA7XHJcblxyXG5cdFx0XHRcdC8qKiBAdHlwZSB7YjJQcmlzbWF0aWNKb2ludH0gKi9cclxuXHRcdFx0XHRsZXQgcGogPSB3b3JsZC5DcmVhdGVKb2ludChwamQpO1xyXG5cclxuXHRcdFx0XHR0aGlzLiRsYWRkZXJfcGogPSBwajtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmICh0aGlzLmxhZGRlcikge1xyXG5cdFx0XHRcdC8vdGhpcy5sYWRkZXIgPSBudWxsO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy5zdGF0ZS5sYWRkZXIpIHtcclxuXHRcdFx0XHRcdHRoaXMuc3RhdGUubGFkZGVyID0gZmFsc2U7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5ib2R5LlNldEF3YWtlKHRydWUpO1xyXG5cdFx0XHRcdFx0dGhpcy5ib2R5LlNldExpbmVhclZlbG9jaXR5MigwLCAwKTtcclxuXHRcdFx0XHRcdHRoaXMuYm9keS5tX3R5cGUgPSBiMkJvZHlUeXBlLmIyX2R5bmFtaWNCb2R5O1xyXG5cdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdHRoaXMuZm9vdF93YWxrLlNldEF3YWtlKHRydWUpO1xyXG5cdFx0XHRcdFx0dGhpcy5mb290X3dhbGsuU2V0TGluZWFyVmVsb2NpdHkyKDAsIDApO1xyXG5cdFx0XHRcdFx0dGhpcy5mb290X3dhbGsubV90eXBlID0gYjJCb2R5VHlwZS5iMl9keW5hbWljQm9keTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuJGxhZGRlcl9waikge1xyXG5cdFx0XHRcdHdvcmxkLkRlc3Ryb3lKb2ludCh0aGlzLiRsYWRkZXJfcGopO1xyXG5cdFx0XHRcdGRlbGV0ZSB0aGlzLiRsYWRkZXJfcGo7XHJcblxyXG5cdFx0XHRcdHRoaXMuYm9keS5TZXRBbmdsZSgwKTtcclxuXHRcdFx0XHR0aGlzLmJvZHkuU2V0Rml4ZWRSb3RhdGlvbih0cnVlKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cmVtb3ZlX3N0aWNreSgpIHtcclxuXHRcdGlmICh0aGlzLiRzdGlja3lfcGopIHtcclxuXHRcdFx0dGhpcy5ib2R5Lm1fd29ybGQuRGVzdHJveUpvaW50KHRoaXMuJHN0aWNreV9waik7XHJcblx0XHRcdHRoaXMuJHN0aWNreV9waiA9IG51bGw7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRhY3Rpb25KdW1wKCkge1xyXG5cdFx0dGhpcy5zdGF0ZS5fYmVnaW5fanVtcCA9IHRydWU7XHJcblx0XHQrK3RoaXMuc3RhdGUuanVtcF9jb3VudDtcclxuXHR9XHJcblx0Ly9hY3Rpb25XYWxrKGZyb250KSB7XHJcblx0Ly99XHJcblx0YWN0aW9uRHJvcGRvd24oKSB7XHJcblx0XHR0aGlzLmxlYXZlXyRmaCA9IHRoaXMuJGZvb3Rob2xkO1xyXG5cdFx0dGhpcy4kZm9vdGhvbGQgPSBudWxsO1xyXG5cdFx0dGhpcy5zdGF0ZS5kcm9wRG93biA9IHRydWU7XHJcblx0XHR0aGlzLmJvZHkuU2V0QXdha2UodHJ1ZSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UGFydGlhbDxDb250cm9sS2V5cz59IGtleXNcclxuXHQgKi9cclxuXHRjb250cm9sKGtleXMpIHtcclxuXHRcdGlmICghdGhpcy5faXNDYW5Nb3ZlKCkpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLnN0YXRlLmxhZGRlciAmJiB0aGlzLiRsYWRkZXJfcGopIHtcclxuXHRcdFx0Y29uc3QgbGFkZGVyQm9keSA9IHRoaXMubGFkZGVyLmJvZHk7XHJcblx0XHRcdGNvbnN0IHNwZWVkID0gKHdpbmRvdy4kTEFEREVSX1NQRUVEIHx8IDEpO1xyXG5cclxuXHRcdFx0aWYgKGxhZGRlckJvZHkpIHtcclxuXHRcdFx0XHRpZiAobGFkZGVyQm9keS5HZXRBbmdsZSgpIHx8IGxhZGRlckJvZHkuR2V0QW5ndWxhclZlbG9jaXR5KCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuYm9keS5TZXRBbmdsZShsYWRkZXJCb2R5LkdldEFuZ2xlKCkpO1xyXG5cdFx0XHRcdFx0dGhpcy5ib2R5LlNldEZpeGVkUm90YXRpb24oZmFsc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHQvL1x0ZGVidWdnZXI7XHJcblx0XHRcdC8vfVxyXG5cclxuXHRcdFx0aWYgKGtleXMudXAgJiYgIWtleXMuZG93bikge1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUubGFkZGVyX21vdmVfZGlyID0gLTE7Ly9hY3Rpb24gYW5pbWF0aW9uXHJcblxyXG5cdFx0XHRcdHRoaXMuJGxhZGRlcl9wai5FbmFibGVNb3Rvcih0cnVlKTtcclxuXHRcdFx0XHR0aGlzLiRsYWRkZXJfcGouU2V0TW90b3JTcGVlZCgtc3BlZWQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGtleXMuZG93biAmJiAha2V5cy51cCkge1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUubGFkZGVyX21vdmVfZGlyID0gMTsvL2FjdGlvbiBhbmltYXRpb25cclxuXHJcblx0XHRcdFx0dGhpcy4kbGFkZGVyX3BqLkVuYWJsZU1vdG9yKHRydWUpO1xyXG5cdFx0XHRcdHRoaXMuJGxhZGRlcl9wai5TZXRNb3RvclNwZWVkKHNwZWVkKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHsvL3N0b3BcclxuXHRcdFx0XHR0aGlzLnN0YXRlLmxhZGRlcl9tb3ZlX2RpciA9IDA7Ly9hY3Rpb24gYW5pbWF0aW9uXHJcblxyXG5cdFx0XHRcdHRoaXMuJGxhZGRlcl9wai5FbmFibGVNb3RvcihmYWxzZSk7XHJcblxyXG5cdFx0XHRcdHRoaXMuYm9keS5TZXRMaW5lYXJWZWxvY2l0eTIoMCwgMCk7XHJcblx0XHRcdFx0Ly9cclxuXHRcdFx0XHR0aGlzLmZvb3Rfd2Fsay5TZXRMaW5lYXJWZWxvY2l0eTIoMCwgMCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGtleXMuanVtcCkge1xyXG5cdFx0XHRcdGNvbnN0IHdvcmxkID0gdGhpcy5ib2R5Lm1fd29ybGQ7XHJcblx0XHRcdFx0Y29uc3QgbWFzcyA9IHRoaXMuX2dldE1hc3MoKTtcclxuXHJcblx0XHRcdFx0aWYgKGtleXMubGVmdCAmJiBrZXlzLnJpZ2h0KSB7XHJcblx0XHRcdFx0XHR0aGlzLnVzZUxhZGRlcihmYWxzZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKGtleXMubGVmdCkge1xyXG5cdFx0XHRcdFx0dGhpcy51c2VMYWRkZXIoZmFsc2UpO1xyXG5cdFx0XHRcdFx0d29ybGQuZG9BZnRlclN0ZXAoKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHQvL2NvbnN0IGYgPSBuZXcgYjJWZWMyKDAsIC13b3JsZC5tX2dyYXZpdHkueSAqIG1hc3MpO1xyXG5cdFx0XHRcdFx0XHQvL3RoaXMuYm9keS5BcHBseUZvcmNlVG9DZW50ZXIoZiwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdHRoaXMuYm9keS5BcHBseUxpbmVhckltcHVsc2VUb0NlbnRlcjIoLXNwZWVkICogbWFzcywgMCk7XHJcblx0XHRcdFx0XHR9KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAoa2V5cy5yaWdodCkge1xyXG5cdFx0XHRcdFx0dGhpcy51c2VMYWRkZXIoZmFsc2UpO1xyXG5cdFx0XHRcdFx0d29ybGQuZG9BZnRlclN0ZXAoKCkgPT4ge1xyXG5cdFx0XHRcdFx0XHQvL2NvbnN0IGYgPSBuZXcgYjJWZWMyKDAsIC13b3JsZC5tX2dyYXZpdHkueSAqIG1hc3MpO1xyXG5cdFx0XHRcdFx0XHQvL3RoaXMuYm9keS5BcHBseUZvcmNlVG9DZW50ZXIoZiwgdHJ1ZSk7XHJcblx0XHRcdFx0XHRcdHRoaXMuYm9keS5BcHBseUxpbmVhckltcHVsc2VUb0NlbnRlcjIoc3BlZWQgKiBtYXNzLCAwKTtcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy4kbGFkZGVyX3BqKSB7XHJcblx0XHRcdGRlYnVnZ2VyXHJcblx0XHRcdHRoaXMudXNlTGFkZGVyKGZhbHNlKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRpZiAodGhpcy5zdGF0ZS5vdXRPZkNvbnRyb2wpIHtcclxuXHRcdFx0XHR0aGlzLndhbGtlci5FbmFibGVNb3RvcihmYWxzZSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMud2Fsa2VyLkVuYWJsZU1vdG9yKHRydWUpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAodGhpcy5wb3J0YWwgJiYga2V5cy51cCkge1xyXG5cdFx0XHRcdC8vVE9ETzogZW50ZXIgcG9ydGFsIGtleToga2V5cy5lbnRlclBvcnRhbFxyXG5cdFx0XHRcdGxldCBwb3J0YWwgPSB0aGlzLnBvcnRhbDtcclxuXHRcdFx0XHRpZiAodGhpcy5fdXNlUG9ydGFsKHBvcnRhbCkpIHtcclxuXHRcdFx0XHRcdHRoaXMucG9ydGFsID0gbnVsbDsvL+S9v+eUqOWujOeVolxyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5sYWRkZXIgJiYgKFxyXG5cdFx0XHRcdChrZXlzLmRvd24gJiYgdGhpcy4kZm9vdGhvbGQgJiYgdGhpcy5sYWRkZXIuYm9keS5HZXRMb2NhbFBvaW50KHRoaXMuZ2V0UG9zaXRpb24oKSwgYjJWZWMyX3RlbXApLnkgPD0gMCkgfHxcclxuXHRcdFx0XHQoa2V5cy51cCAmJiAhdGhpcy4kZm9vdGhvbGQgJiYgdGhpcy5sYWRkZXIuYm9keS5HZXRMb2NhbFBvaW50KHRoaXMuZ2V0UG9zaXRpb24oKSwgYjJWZWMyX3RlbXApLnkgPiAwKSlcclxuXHRcdFx0KSB7XHJcblx0XHRcdFx0dGhpcy5zdGF0ZS5sYWRkZXJfbW92ZV9kaXIgPSAwOy8vcmVzZXRcclxuXHRcdFx0XHR0aGlzLnVzZUxhZGRlcih0cnVlKTtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0IHdoZWVsX3NwID0gdGhpcy5fd2Fsa2VyX29tZWdhO1xyXG5cdFx0XHRjb25zdCB2ZWxvY2l0eSA9IHRoaXMuYm9keS5HZXRMaW5lYXJWZWxvY2l0eSgpOy8vZm9vdF93YWxrXHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuc3RhdGUuanVtcCAmJiAhdGhpcy5zdGF0ZS5kcm9wRG93bikge1xyXG5cdFx0XHRcdC8vZHJvcERvd25cclxuXHRcdFx0XHRpZiAoa2V5cy5kb3duICYmIGtleXMuanVtcCkge1xyXG5cdFx0XHRcdFx0dGhpcy5hY3Rpb25Ecm9wZG93bigpO1xyXG5cdFx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Ly/otrTkuItcclxuXHRcdFx0XHRpZiAoa2V5cy5kb3duKSB7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlLnByb25lID0gdHJ1ZTtcclxuXHRcdFx0XHRcdHJldHVybjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlLnByb25lID0gZmFsc2U7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUucHJvbmUgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0aWYgKGtleXMubGVmdCAmJiAha2V5cy5yaWdodCkge1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUud2FsayA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy5zdGF0ZS5mcm9udCA9IC0xO1xyXG5cdFx0XHRcdHRoaXMud2Fsa2VyLlNldE1vdG9yU3BlZWQoLXdoZWVsX3NwKTtcclxuXHRcdFx0XHR0aGlzLndhbGtlci5TZXRNYXhNb3RvclRvcnF1ZShNT1ZFTUVOVF9QT1dFUik7XHJcblx0XHRcdFx0Ly90aGlzLndhbGtlci5FbmFibGVNb3Rvcih0cnVlKTsvL3Bvd2VyIG9uXHJcblxyXG5cdFx0XHRcdHRoaXMucmVtb3ZlX3N0aWNreSgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGtleXMucmlnaHQgJiYgIWtleXMubGVmdCkge1xyXG5cdFx0XHRcdHRoaXMuc3RhdGUud2FsayA9IHRydWU7XHJcblx0XHRcdFx0dGhpcy5zdGF0ZS5mcm9udCA9IDE7XHJcblx0XHRcdFx0dGhpcy53YWxrZXIuU2V0TW90b3JTcGVlZCh3aGVlbF9zcCk7XHJcblx0XHRcdFx0dGhpcy53YWxrZXIuU2V0TWF4TW90b3JUb3JxdWUoTU9WRU1FTlRfUE9XRVIpO1xyXG5cdFx0XHRcdC8vdGhpcy53YWxrZXIuRW5hYmxlTW90b3IodHJ1ZSk7Ly9wb3dlciBvblxyXG5cclxuXHRcdFx0XHR0aGlzLnJlbW92ZV9zdGlja3koKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLndhbGsgPSBmYWxzZTtcclxuXHJcblx0XHRcdFx0aWYgKCF0aGlzLnN0YXRlLmp1bXApIHtcclxuXHRcdFx0XHRcdGxldCB2eCA9IHZlbG9jaXR5Lng7XHJcblx0XHRcdFx0XHRpZiAodnggPiA1MCAqIGIyX2xpbmVhclNsb3ApIHtcclxuXHRcdFx0XHRcdFx0dGhpcy53YWxrZXIuU2V0TW90b3JTcGVlZCgtdnggKiBNYXRoLlBJIC8gMiAvIE1hdGguUEkgLyB0aGlzLmNoYXJhX3Byb2ZpbGUud2lkdGggLyAyKTsvL+eFnui7iuS9hueEoeazleatoua7kVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSBpZiAodnggPCAtNTAgKiBiMl9saW5lYXJTbG9wKSB7XHJcblx0XHRcdFx0XHRcdHRoaXMud2Fsa2VyLlNldE1vdG9yU3BlZWQoLXZ4ICogTWF0aC5QSSAvIDIgLyBNYXRoLlBJIC8gdGhpcy5jaGFyYV9wcm9maWxlLndpZHRoIC8gMik7Ly/nhZ7ou4rkvYbnhKHms5XmraLmu5FcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR0aGlzLndhbGtlci5TZXRNb3RvclNwZWVkKDApOy8vc3RvcCBtb3RvclxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMud2Fsa2VyLlNldE1vdG9yU3BlZWQoMCk7Ly9zdG9wIG1vdG9yXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdHRoaXMud2Fsa2VyLlNldE1heE1vdG9yVG9ycXVlKE1PVkVNRU5UX1NUT1BfUE9XRVIpO1xyXG5cdFx0XHRcdC8vdGhpcy53YWxrZXIuRW5hYmxlTW90b3IoZmFsc2UpOy8vcG93ZXIgb2ZmXHJcblxyXG5cdFx0XHRcdGlmICh0aGlzLnN0YXRlLuatoua7kSkge1xyXG5cdFx0XHRcdFx0dGhpcy5zdGlja3kodGhpcy5nZXRQb3NpdGlvbigpKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChrZXlzLmp1bXAgJiYgdGhpcy5faXNDYW5KdW1wKCkpIHtcclxuXHRcdFx0XHR0aGlzLnJlbW92ZV9zdGlja3koKTtcclxuXHRcdFx0XHR0aGlzLmFjdGlvbkp1bXAoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0X2lzQ2FuSnVtcCgpIHtcclxuXHRcdHJldHVybiAhdGhpcy5zdGF0ZS5qdW1wICYmICF0aGlzLmlzRHJvcCgpO1xyXG5cdH1cclxuXHJcblx0X2lzQ2FuTW92ZSgpIHtcclxuXHRcdHJldHVybiAhdGhpcy5zdGF0ZS5mcmVlemUgJiYgIXRoaXMuc3RhdGUua25vY2tiYWNrO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGluY3JlbWVudF9wZXJjZW50IC0gaW5jcmVtZW50X3BlcmNlbnQgPj0gLTEwMFxyXG5cdCAqL1xyXG5cdHNldE1vdmVtZW50U3BlZWQoaW5jcmVtZW50X3BlcmNlbnQpIHtcclxuXHRcdGlmICghKE51bWJlci5pc1NhZmVJbnRlZ2VyKGluY3JlbWVudF9wZXJjZW50KSB8fCAoIU51bWJlci5pc05hTihpbmNyZW1lbnRfcGVyY2VudCkgJiYgTnVtYmVyLmlzRmluaXRlKGluY3JlbWVudF9wZXJjZW50KSkpKSB7XHJcblx0XHRcdGRlYnVnZ2VyXHJcblx0XHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJycpIHtcclxuXHRcdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFwiaW5jcmVtZW50X3BlcmNlbnQgbXVzdCBpcyBudW1iZXJcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0bGV0IHNjYWxlID0gKDEwMCArIGluY3JlbWVudF9wZXJjZW50KSAvIDEwMDtcclxuXHRcdGlmIChzY2FsZSA+IDApIHtcclxuXHRcdFx0dGhpcy5fc2V0V2Fsa2VyT21lZ2FGcm9tVmVsb2NpdHkoTU9WRU1FTlRfVkVMT0NJVFkgKiBzY2FsZSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fc2V0V2Fsa2VyT21lZ2FGcm9tVmVsb2NpdHkoMCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzcGVlZCAtIHNwZWVkID0gcGl4ZWwgLyBzZWNvbmRcclxuXHQgKi9cclxuXHRzZXRNb3ZlbWVudFNwZWVkUGl4ZWwoc3BlZWQpIHtcclxuXHRcdGxldCB2ID0gc3BlZWQgLyAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0aWYgKHYgPiAwKSB7XHJcblx0XHRcdHRoaXMuX3dhbGtlcl9vbWVnYSA9IHY7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fd2Fsa2VyX29tZWdhID0gMDtcclxuXHRcdH1cclxuXHR9XHJcblx0X3NldFdhbGtlck9tZWdhRnJvbVZlbG9jaXR5KG1vdmVtZW50X3ZlbG9jaXR5KSB7XHJcblx0XHR0aGlzLl93YWxrZXJfb21lZ2EgPSBtb3ZlbWVudF92ZWxvY2l0eSAvIChNYXRoLlBJICogdGhpcy5jaGFyYV9wcm9maWxlLndpZHRoKSAqIE1hdGguUEk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaW5jcmVtZW50X3BlcmNlbnQgLSBpbmNyZW1lbnRfcGVyY2VudCA+PSAtMTAwXHJcblx0ICovXHJcblx0c2V0anVtcEZvcmNlKGluY3JlbWVudF9wZXJjZW50KSB7XHJcblx0XHRpZiAoIShOdW1iZXIuaXNTYWZlSW50ZWdlcihpbmNyZW1lbnRfcGVyY2VudCkgfHwgKCFOdW1iZXIuaXNOYU4oaW5jcmVtZW50X3BlcmNlbnQpICYmIE51bWJlci5pc0Zpbml0ZShpbmNyZW1lbnRfcGVyY2VudCkpKSkge1xyXG5cdFx0XHRkZWJ1Z2dlclxyXG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKFwiaW5jcmVtZW50X3BlcmNlbnQgbXVzdCBpcyBudW1iZXJcIik7XHJcblx0XHR9XHJcblxyXG5cdFx0bGV0IHNjYWxlID0gKDEwMCArIGluY3JlbWVudF9wZXJjZW50KSAvIDEwMDtcclxuXHRcdGlmIChzY2FsZSA8PSAwKSB7XHJcblx0XHRcdHRoaXMuanVtcF9mb3JjZSA9IDA7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc3QgZ3Jhdml0eSA9IHRoaXMuYm9keS5HZXRXb3JsZCgpLkdldEdyYXZpdHkoKTtcclxuXHRcdFx0dGhpcy5qdW1wX2ZvcmNlID0gSlVNUF9GT1JDRSAqIHNjYWxlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRfZ2V0TWFzcygpIHtcclxuXHRcdHJldHVybiB0aGlzLmJvZHkuR2V0TWFzcygpICsgdGhpcy5mb290X3dhbGsuR2V0TWFzcygpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHNcclxuXHQgKi9cclxuXHRzZXRHcmF2aXR5U2NhbGUocykge1xyXG5cdFx0dGhpcy5ib2R5LlNldEdyYXZpdHlTY2FsZShzKTtcclxuXHRcdHRoaXMuZm9vdF93YWxrLlNldEdyYXZpdHlTY2FsZShzKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogQHJldHVybnMge3N0cmluZ31cclxuXHQgKi9cclxuXHRnZXQgX2JvZHlfY2F0ZWdvcnkoKSB7XHJcblx0XHRyZXR1cm4gXCJib2R5XCI7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1dvcmxkfSB3b3JsZFxyXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxyXG5cdCAqL1xyXG5cdF9jcmVhdGUod29ybGQpIHtcclxuXHRcdGxldCBmaXJzdF9wb3MgPSBuZXcgYjJWZWMyKDEgLyAkZ3YuQ0FOVkFTX1NDQUxFLCAtMiAvICRndi5DQU5WQVNfU0NBTEUpO1xyXG5cdFx0bGV0IGptcF9ib2R5X3Bvc195ID0gZmlyc3RfcG9zLnkgKyB0aGlzLmNoYXJhX3Byb2ZpbGUuaGVpZ2h0ICogMC43NSAqIDAuNTtcclxuXHRcdGxldCBiZGVmID0gbmV3IGIyQm9keURlZigpO1xyXG5cdFx0bGV0IGZkZWYgPSBuZXcgYjJGaXh0dXJlRGVmKCk7XHJcblx0XHRsZXQgc2hhcGUgPSBuZXcgYjJQb2x5Z29uU2hhcGUoKTtcclxuXHJcblx0XHRiZGVmLnR5cGUgPSBiMkJvZHlUeXBlLmIyX2R5bmFtaWNCb2R5O1xyXG5cdFx0YmRlZi5idWxsZXQgPSB0cnVlOy8vZ2V0IHJlYWwgY29udGFjdCBwb2ludFxyXG5cdFx0YmRlZi5wb3NpdGlvbi5TZXQoZmlyc3RfcG9zLngsIGZpcnN0X3Bvcy55KTtcclxuXHRcdGJkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cclxuXHRcdGZkZWYudXNlckRhdGEgPSB0aGlzO1xyXG5cclxuXHRcdC8vY3JlYXRlIGJvZHlcclxuXHRcdHtcclxuXHRcdFx0dGhpcy5ib2R5ID0gd29ybGQuQ3JlYXRlQm9keShiZGVmKTtcclxuXHRcdFx0dGhpcy5ib2R5LlNldEZpeGVkUm90YXRpb24odHJ1ZSk7XHJcblx0XHR9XHJcblx0XHR0aGlzLmJvZHkuJHR5cGUgPSBcInBsYXllclwiO1xyXG5cclxuXHRcdGZkZWYuZmlsdGVyLkNvcHkoRmlsdGVySGVscGVyLmdldCh0aGlzLl9ib2R5X2NhdGVnb3J5KSk7XHJcblxyXG5cdFx0Ly9oZWFkXHJcblx0XHR7XHJcblx0XHRcdHNoYXBlLlNldEFzQm94KFxyXG5cdFx0XHRcdHRoaXMuY2hhcmFfcHJvZmlsZS53aWR0aCAqIDAuNSxcclxuXHRcdFx0XHR0aGlzLmNoYXJhX3Byb2ZpbGUuaGVpZ2h0ICogMC43NSAqIDAuNSxcclxuXHRcdFx0XHRiMlZlYzIuWkVSTywvL25ldyBiMlZlYzIoMCwgMCksLy9cclxuXHRcdFx0XHQwKTtcclxuXHJcblx0XHRcdGZkZWYuZGVuc2l0eSA9IHRoaXMuY2hhcmFfcHJvZmlsZS5kZW5zaXR5O1xyXG5cdFx0XHRmZGVmLmZyaWN0aW9uID0gMDtcclxuXHRcdFx0ZmRlZi5yZXN0aXR1dGlvbiA9IDA7XHJcblx0XHRcdGZkZWYuc2hhcGUgPSBzaGFwZTtcclxuXHRcdFx0Ly9cclxuXHRcdFx0dGhpcy5maXh0dXJlID0gdGhpcy5ib2R5LkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblx0XHRcdHRoaXMuZml4dHVyZS4kdHlwZSA9IFwicGxheWVyXCI7XHJcblx0XHR9XHJcblxyXG5cdFx0ZmRlZi5maWx0ZXIuQ29weShGaWx0ZXJIZWxwZXIuZ2V0KFwiZm9vdFwiKSk7XHJcblx0XHQvL1xyXG5cdFx0Ly9jcmVhdGUgd2Fsa2VyXHJcblx0XHR7XHJcblx0XHRcdGJkZWYudHlwZSA9IGIyQm9keVR5cGUuYjJfZHluYW1pY0JvZHk7XHJcblx0XHRcdGJkZWYucG9zaXRpb24uU2V0KGZpcnN0X3Bvcy54LCBqbXBfYm9keV9wb3NfeSk7XHJcblx0XHRcdHRoaXMuZm9vdF93YWxrID0gd29ybGQuQ3JlYXRlQm9keShiZGVmKTtcclxuXHJcblx0XHRcdGxldCBjaXJjbGUgPSBuZXcgYjJDaXJjbGVTaGFwZSgpO1xyXG5cdFx0XHRjaXJjbGUubV9wLlNldCgwLCAwKTtcclxuXHRcdFx0Y2lyY2xlLm1fcmFkaXVzID0gdGhpcy5jaGFyYV9wcm9maWxlLmZvb3Rfd2lkdGg7XHJcblx0XHRcdGZkZWYuc2hhcGUgPSBjaXJjbGU7XHJcblx0XHRcdGZkZWYuZGVuc2l0eSA9IHRoaXMuY2hhcmFfcHJvZmlsZS5kZW5zaXR5O1xyXG5cdFx0XHQvL2ZkZWYuZmlsdGVyID0gd29ybGQuZ2V0RmlsdGVyRGVmaW5lKFwicGxfZnRfd2Fsa1wiKTtcclxuXHRcdFx0ZmRlZi5mcmljdGlvbiA9IEZPT1RfRlJJQ1RJT047Ly93YWxrXHJcblx0XHRcdGZkZWYucmVzdGl0dXRpb24gPSAwO1xyXG5cdFx0XHRsZXQgZml4dHVyZSA9IHRoaXMuZm9vdF93YWxrLkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblx0XHRcdGZpeHR1cmUuJHR5cGUgPSBcInBsX2Z0X3dhbGtcIjtcclxuXHJcblx0XHRcdHRoaXMuX3NldF9mb290X2xpc3RlbmVyKGZpeHR1cmUpO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5mb290X3dhbGsuJHR5cGUgPSBcInBsX2Z0X3dhbGtcIjtcclxuXHJcblx0XHQvL2oyXHJcblx0XHR7XHJcblx0XHRcdGxldCBqZDtcclxuXHJcblx0XHRcdGlmIChQTEFZRVJfVVNFX1dIRUVMX1dBTEtFUikge1xyXG5cdFx0XHRcdGpkID0gbmV3IGIyV2hlZWxKb2ludERlZigpOy8vYjJXaGVlbEpvaW50RGVmLy9iMlJldm9sdXRlSm9pbnREZWZcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRqZCA9IG5ldyBiMlJldm9sdXRlSm9pbnREZWYoKTsvL2IyV2hlZWxKb2ludERlZi8vYjJSZXZvbHV0ZUpvaW50RGVmXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChqZCBpbnN0YW5jZW9mIGIyUmV2b2x1dGVKb2ludERlZikge1xyXG5cdFx0XHRcdGpkLkluaXRpYWxpemUodGhpcy5ib2R5LCB0aGlzLmZvb3Rfd2FsaywgbmV3IGIyVmVjMihmaXJzdF9wb3MueCwgam1wX2JvZHlfcG9zX3kpKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAoamQgaW5zdGFuY2VvZiBiMldoZWVsSm9pbnREZWYpIHtcclxuXHRcdFx0XHRqZC5Jbml0aWFsaXplKHRoaXMuYm9keSwgdGhpcy5mb290X3dhbGssIG5ldyBiMlZlYzIoZmlyc3RfcG9zLngsIGptcF9ib2R5X3Bvc195KSwgbmV3IGIyVmVjMigwLCAtMSkpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGpkLmVuYWJsZU1vdG9yID0gdHJ1ZTtcclxuXHRcdFx0amQubWF4TW90b3JUb3JxdWUgPSBNT1ZFTUVOVF9QT1dFUjtcclxuXHRcdFx0Ly9qZC5tb3RvclNwZWVkID0gNDA7XHJcblx0XHRcdGlmIChqZCBpbnN0YW5jZW9mIGIyUmV2b2x1dGVKb2ludERlZikge1xyXG5cdFx0XHRcdGpkLmVuYWJsZUxpbWl0ID0gZmFsc2U7XHJcblx0XHRcdFx0amQubG93ZXJBbmdsZSA9IDAgKiBERUdUT1JBRDtcclxuXHRcdFx0XHRqZC51cHBlckFuZ2xlID0gLTAgKiBERUdUT1JBRDtcclxuXHRcdFx0XHRqZC5yZWZlcmVuY2VBbmdsZSA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKGpkIGluc3RhbmNlb2YgYjJXaGVlbEpvaW50RGVmKSB7XHJcblx0XHRcdFx0amQuZnJlcXVlbmN5SHogPSAxMDsvL3NwcmluZ3NcclxuXHRcdFx0XHRqZC5kYW1waW5nUmF0aW8gPSAxOy8vc3ByaW5nc1xyXG5cdFx0XHR9XHJcblx0XHRcdHRoaXMud2Fsa2VyID0gd29ybGQuQ3JlYXRlSm9pbnQoamQpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0aGlzLmJvZHkuYWRkU3RlcCh0aGlzLlN0ZXAuYmluZCh0aGlzKSk7XHJcblx0XHR0aGlzLmJvZHkuYWRkQWZ0ZXJTdGVwKHRoaXMuQWZ0ZXJTdGVwLmJpbmQodGhpcykpO1xyXG5cdFx0XHJcblx0XHR0aGlzLnNldE1vdmVtZW50U3BlZWQoMCk7XHJcblx0XHR0aGlzLnNldGp1bXBGb3JjZSgwKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogZGVzdHJveSB0aGlzXHJcblx0ICogQHJldHVybnMge3ZvaWR9XHJcblx0ICovXHJcblx0X2Rlc3Ryb3koKSB7XHJcblx0XHQvKiogQHR5cGUge1dvcmxkfSB3b3JsZCAqL1xyXG5cdFx0Y29uc3Qgd29ybGQgPSB0aGlzLmJvZHkubV93b3JsZDtcclxuXHJcblx0XHRpZiAodGhpcy5ib2R5KSB7XHJcblx0XHRcdHdvcmxkLkRlc3Ryb3lCb2R5KHRoaXMuYm9keSk7XHJcblx0XHRcdHRoaXMuYm9keSA9IG51bGw7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJ0aGlzIGFscmVhZHkgZGVhZFwiKTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLmZvb3Rfd2Fsaykge1xyXG5cdFx0XHR3b3JsZC5EZXN0cm95Qm9keSh0aGlzLmZvb3Rfd2Fsayk7XHJcblx0XHRcdHRoaXMuZm9vdF93YWxrID0gbnVsbDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYSAtIHNlbGZcclxuXHQgKiBAcGFyYW0ge2IyRml4dHVyZX0gZmIgLSBvdGhlclxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdF9pc0Zyb21TZWxmQ29udGFjdChmYSwgZmIpIHtcclxuXHRcdGxldCBhID0gZmEuR2V0Qm9keSgpLkdldFVzZXJEYXRhKCk7XHQvLyBBIGRhdGFcclxuXHRcdGxldCBiID0gZmIuR2V0Qm9keSgpLkdldFVzZXJEYXRhKCk7XHQvLyBCIGRhdGFcclxuXHJcblx0XHRpZiAoYSAmJiBiICYmIGEuYm9keSAmJiBiLmJvZHkgJiYgYS5ib2R5ID09IGIuYm9keSkge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyQ29udGFjdH0gY29udGFjdFxyXG5cdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmYSAtIHNlbGZcclxuXHQgKiBAcGFyYW0ge2IyRml4dHVyZX0gZmIgLSBvdGhlclxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufSAtIHJldHVybiB0cnVlIGlmIGZyb20gc2VsZiBhbmQgZGlzYWJsZSB0aGlzIGNvbnRhY3RcclxuXHQgKi9cclxuXHRfaWdub3JlU2VsZkNvbnRhY3QoY29udGFjdCwgZmEsIGZiKSB7XHJcblx0XHRpZiAodGhpcy5faXNGcm9tU2VsZkNvbnRhY3QoZmEsIGZiKSkge1xyXG5cdFx0XHRjb250YWN0LlNldEVuYWJsZWQoZmFsc2UpO1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblx0XHJcblx0X3NldF9mb290X2xpc3RlbmVyKGZvb3RfZml4dHVyZSkge1xyXG5cdFx0Zm9vdF9maXh0dXJlLmJlZ2luQ29udGFjdCA9IHRoaXMuX19iZWdpbkNvbnRhY3Rfd2Fsa2VyO1xyXG5cdFx0Zm9vdF9maXh0dXJlLmVuZENvbnRhY3QgPSB0aGlzLl9fZW5kQ29udGFjdF93YWxrZXI7XHJcblx0XHRmb290X2ZpeHR1cmUucHJlU29sdmUgPSB0aGlzLl9fcHJlU29sdmVfd2Fsa2VyO1xyXG5cdH1cclxuXHRcclxuXHRfX2JlZ2luQ29udGFjdF93YWxrZXIoY29udGFjdCwgZmEsIGZiKSB7XHJcblx0XHRpZiAodGhpcy5faWdub3JlU2VsZkNvbnRhY3QoY29udGFjdCwgZmEsIGZiKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRsZXQgdGFyZ2V0Qm9keSA9IGZiLm1fYm9keTtcclxuXHRcdGlmICh0YXJnZXRCb2R5KSB7XHJcblx0XHRcdHN3aXRjaCAodGFyZ2V0Qm9keS4kdHlwZSkge1xyXG5cdFx0XHRcdGNhc2UgXCJwb3J0YWxcIjpcclxuXHRcdFx0XHRcdHRoaXMuX2JlZ2luQ29udGFjdFBvcnRhbChmYi5tX3VzZXJEYXRhKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdF9fZW5kQ29udGFjdF93YWxrZXIoY29udGFjdCwgZmEsIGZiKSB7XHJcblx0XHRpZiAodGhpcy5faWdub3JlU2VsZkNvbnRhY3QoY29udGFjdCwgZmEsIGZiKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRsZXQgdGFyZ2V0Qm9keSA9IGZiLm1fYm9keTtcclxuXHRcdGlmICh0YXJnZXRCb2R5KSB7XHJcblx0XHRcdHN3aXRjaCAodGFyZ2V0Qm9keS4kdHlwZSkge1xyXG5cdFx0XHRcdGNhc2UgXCJwb3J0YWxcIjpcclxuXHRcdFx0XHRcdHRoaXMuX2VuZENvbnRhY3RQb3J0YWwoZmIubV91c2VyRGF0YSk7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHRfX3ByZVNvbHZlX3dhbGtlcihjb250YWN0LCBvbGRNYW5pZm9sZCwgZmEsIGZiKSB7XHJcblx0XHRpZiAodGhpcy5faWdub3JlU2VsZkNvbnRhY3QoY29udGFjdCwgZmEsIGZiKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAoZmEuJHR5cGUgPT0gXCJwbF9mdF93YWxrXCIgJiYgZmIuJHR5cGUgPT0gXCJwbF9mdF93YWxrXCIpIHtcclxuXHRcdFx0Y29udGFjdC5TZXRFbmFibGVkKGZhbHNlKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKiogQHBhcmFtIHtNYXBQb3J0YWx9IHBvcnRhbCAqL1xyXG5cdF9iZWdpbkNvbnRhY3RQb3J0YWwocG9ydGFsKSB7XHJcblx0XHR0aGlzLnBvcnRhbCA9IHBvcnRhbDtcclxuXHJcblx0XHRpZiAocG9ydGFsLmVuYWJsZSkge1xyXG5cdFx0XHRpZiAocG9ydGFsLnNjcmlwdCkge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFwiZ290byBtYXA6IFwiICsgcG9ydGFsLmdldE1hcCgpICsgXCI7IFwiICsgcG9ydGFsLnNjcmlwdCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coXCJnb3RvIG1hcDogXCIgKyBwb3J0YWwuZ2V0TWFwKCkpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc29sZS5sb2coXCJjb250YWN0IHBvcnRhbDogJW9cIiwgcG9ydGFsKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqIEBwYXJhbSB7TWFwUG9ydGFsfSBwb3J0YWwgKi9cclxuXHRfZW5kQ29udGFjdFBvcnRhbChwb3J0YWwpIHtcclxuXHRcdGlmICh0aGlzLnBvcnRhbCA9PSBwb3J0YWwpIHtcclxuXHRcdFx0dGhpcy5wb3J0YWwgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICog5rG65a6a5o6l6Ke45ZOq5LiA5YCLZm9vdGhvbGTvvIzlv73nlaXniYblo4FcclxuXHQgKiBAcGFyYW0ge0Zvb3Rob2xkfSBmb290aG9sZFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBmb290X2F0XHJcblx0ICogQHJldHVybnMge251bWJlcn1cclxuXHQgKi9cclxuXHRfX3ByaW9yaXR5X2Zvb3Rob2xkX2NvbnRhY3QoZm9vdGhvbGQsIGZvb3RfYXQpIHtcclxuXHRcdGlmIChmb290aG9sZC5pc193YWxsKSB7XHJcblx0XHRcdHJldHVybiAwO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuJGZvb3Rob2xkICYmIHRoaXMuJGZvb3Rob2xkLmNoYWluICE9IGZvb3Rob2xkLmNoYWluKSB7XHJcblx0XHRcdGlmICh0aGlzLiRmb290aG9sZCAhPSBmb290aG9sZCAmJiAhdGhpcy5zdGF0ZS5kcm9wRG93bikge1xyXG5cdFx0XHRcdC8vIOaOpeinuOWkmuWAiyBmb290aG9sZCDku6UgXCLkuIvpnaJcIiDnmoTngrrkuLvvvIzkuIrlnaHmmYLku6UgXCLkuIso5LiKKeS4gOWAi1wiIOeCuuS4u1xyXG5cdFx0XHRcdC8vIOW/veeVpemAo+e6jCBmb290aG9sZCDph43nlornmoTpu55cclxuXHRcdFx0XHRpZiAodGhpcy5fZm9vdF9hdCAmJiBmb290X2F0LnkgPCB0aGlzLl9mb290X2F0LnkpIHtcclxuXHRcdFx0XHRcdGlmICgoIXRoaXMuJGZvb3Rob2xkLnByZXYgfHwgKHRoaXMuJGZvb3Rob2xkLnByZXYgPT0gZm9vdGhvbGQuaWQgJiYgZm9vdGhvbGQueTEgPCB0aGlzLiRmb290aG9sZC55MSkpIHx8XHJcblx0XHRcdFx0XHRcdCghdGhpcy4kZm9vdGhvbGQubmV4dCB8fCAodGhpcy4kZm9vdGhvbGQubmV4dCA9PSBmb290aG9sZC5pZCAmJiBmb290aG9sZC55MiA8IHRoaXMuJGZvb3Rob2xkLnkyKSlcclxuXHRcdFx0XHRcdCkge1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdHJldHVybiAxO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0Ly/mlrDnmoTmjqXop7hcclxuXHRcdHJldHVybiAyO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICog5rG65a6a5o6l6Ke45ZOq5LiA5YCLZm9vdGhvbGTvvIzlv73nlaXniYblo4FcclxuXHQgKiBpZiBmb290aG9sZCBpcyB3YWxsIHRoZW4gcmV0dXJuIHRydWVcclxuXHQgKiBAcGFyYW0ge0Zvb3Rob2xkfSBmb290aG9sZFxyXG5cdCAqIEBwYXJhbSB7YjJWZWMyfSBmb290X2F0XHJcblx0ICovXHJcblx0X3doaWNoX2Zvb3Rob2xkX2NvbnRhY3QoZm9vdGhvbGQsIGZvb3RfYXQpIHtcclxuXHRcdGlmIChmb290aG9sZC5pc193YWxsKSB7XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0bGV0IHByaW9yaXR5ID0gdGhpcy5fX3ByaW9yaXR5X2Zvb3Rob2xkX2NvbnRhY3QoZm9vdGhvbGQsIGZvb3RfYXQpO1xyXG5cdFx0aWYgKHByaW9yaXR5ID4gMCkge1xyXG5cdFx0XHRpZiAoIXRoaXMuX2Zvb3Rob2xkX3ByaW9yaXR5IHx8IHByaW9yaXR5ID49IHRoaXMuX2Zvb3Rob2xkX3ByaW9yaXR5KSB7XHJcblx0XHRcdFx0dGhpcy5fZm9vdGhvbGQgPSBmb290aG9sZDtcclxuXHRcdFx0XHR0aGlzLl9mb290X2F0ID0gZm9vdF9hdC5DbG9uZSgpO1xyXG5cdFx0XHRcdHRoaXMuX2Zvb3Rob2xkX3ByaW9yaXR5ID0gcHJpb3JpdHk7XHJcblx0XHRcdFx0Ly90aGlzLnN0aWNreShmb290X2F0KTtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRmb3IgKGxldCBmYyBvZiB0aGlzLl9mb290X2NvbnRhY3RfbGlzdCkge1xyXG5cdFx0XHRcdFx0aWYgKGZvb3Rob2xkID09IGZjLmZvb3Rob2xkKSB7XHJcblx0XHRcdFx0XHRcdGZjLnByaW9yaXR5ID0gcHJpb3JpdHk7XHJcblx0XHRcdFx0XHRcdGZjLnBvc2l0aW9uID0gZm9vdF9hdDtcclxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRsZXQgZm9vdF9jb250YWN0ID0gbmV3IEZvb3RDb250YWN0KGZvb3Rob2xkLCBmb290X2F0LCBwcmlvcml0eSk7XHJcblx0XHRcdFx0dGhpcy5fZm9vdF9jb250YWN0X2xpc3QucHVzaChmb290X2NvbnRhY3QpO1xyXG5cdFx0XHRcdHRoaXMuX2Zvb3RfY29udGFjdF9saXN0LnNvcnQoKGEsIGIpID0+IGEucHJpb3JpdHkgLSBiLnByaW9yaXR5KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtiMlZlYzJ9IGFuY2hvclxyXG5cdCAqL1xyXG5cdHN0aWNreShhbmNob3IpIHtcclxuXHRcdC8qKiBAdHlwZSB7V29ybGR9ICovXHJcblx0XHRjb25zdCB3b3JsZCA9IHRoaXMuYm9keS5tX3dvcmxkO1xyXG5cclxuXHRcdHdvcmxkLm9uY2VVbmxvY2soKCkgPT4ge1xyXG5cdFx0XHRpZiAodGhpcy4kc3RpY2t5X3BqKSB7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cclxuXHRcdFx0XHR3b3JsZC5EZXN0cm95Sm9pbnQodGhpcy4kc3RpY2t5X3BqKTtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly90aGlzLnNldFBvc2l0aW9uKGFuY2hvci54LCBhbmNob3IueSk7XHJcblxyXG5cdFx0XHRsZXQgcGpkID0gbmV3IGIyUHJpc21hdGljSm9pbnREZWYoKTtcclxuXHRcdFx0cGpkLkluaXRpYWxpemUod29ybGQubWFwQm91bmRfYm9keSwgdGhpcy5ib2R5LCBhbmNob3IsIG5ldyBiMlZlYzIoMCwgMSkpO1xyXG5cdFx0XHRpZiAoMCkge1xyXG5cdFx0XHRcdHBqZC5ib2R5QSA9IHdvcmxkLm1hcEJvdW5kX2JvZHk7XHJcblx0XHRcdFx0cGpkLmJvZHlCID0gdGhpcy5mb290X3dhbGs7Ly90aGlzLmJvZHk7XHJcblx0XHRcdFx0Ly9wamQubG9jYWxBbmNob3JBLlNldCgwLCAwKTtcclxuXHRcdFx0XHQvL3BqZC5sb2NhbEFuY2hvckIuU2V0KDAsIDApO1xyXG5cdFx0XHRcdHBqZC5sb2NhbEF4aXNBLlNldCgwLCAxKTtcclxuXHRcdFx0XHQvL3BqZC5yZWZlcmVuY2VBbmdsZSA9IDA7XHJcblx0XHRcdH1cclxuXHRcdFx0cGpkLmxvd2VyVHJhbnNsYXRpb24gPSAwO1xyXG5cdFx0XHRwamQudXBwZXJUcmFuc2xhdGlvbiA9IDA7XHJcblx0XHRcdHBqZC5lbmFibGVMaW1pdCA9IHRydWU7XHJcblx0XHRcdHBqZC5tYXhNb3RvckZvcmNlID0gdGhpcy5fZ2V0TWFzcygpICogMTAwMDtcclxuXHJcblx0XHRcdC8qKiBAdHlwZSB7YjJQcmlzbWF0aWNKb2ludH0gKi9cclxuXHRcdFx0bGV0IHBqID0gd29ybGQuQ3JlYXRlSm9pbnQocGpkKTtcclxuXHJcblx0XHRcdHRoaXMuJHN0aWNreV9waiA9IHBqO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cclxuXHQgKi9cclxuXHRpc0Ryb3AoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5zdGF0ZS5kcm9wRG93biB8fCB0aGlzLnN0YXRlLl9kcm9wO1xyXG5cdH1cclxuXHJcblx0X2VuZENvbnRhY3RGb290aG9sZCgpIHtcclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fZW5kQ29udGFjdEZvb3Rob2xkTGlzdC5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRsZXQgZmggPSB0aGlzLl9lbmRDb250YWN0Rm9vdGhvbGRMaXN0W2ldO1xyXG5cclxuXHRcdFx0aWYgKGZoID09IHRoaXMuXyRmYWxsRWRnZSkge1xyXG5cdFx0XHRcdHRoaXMuXyRmYWxsRWRnZSA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoZmggPT0gdGhpcy5fZm9vdGhvbGQpIHtcclxuXHRcdFx0XHR0aGlzLl9mb290aG9sZCA9IG51bGw7XHJcblx0XHRcdFx0dGhpcy5fZm9vdF9hdCA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdFx0Ly9lbHNlIGlmIChmaC5pZCA9PSB0aGlzLl9mb290aG9sZC5pZCkge1xyXG5cdFx0XHQvL1x0dGhpcy5fZm9vdGhvbGQgPSBudWxsO1xyXG5cdFx0XHQvL1x0dGhpcy5fZm9vdF9hdCA9IG51bGw7XHJcblx0XHRcdC8vfVxyXG5cclxuXHRcdFx0aWYgKHRoaXMuJGZvb3Rob2xkICYmIGZoID09IHRoaXMuJGZvb3Rob2xkKSB7XHJcblx0XHRcdFx0dGhpcy5wcmV2XyRmaCA9IHRoaXMuJGZvb3Rob2xkO1xyXG5cdFx0XHRcdHRoaXMuJGZvb3Rob2xkID0gbnVsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5sZWF2ZV8kZmggJiYgdGhpcy5sZWF2ZV8kZmggPT0gZmgpIHtcclxuXHRcdFx0XHR0aGlzLmxlYXZlXyRmaCA9IG51bGw7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHRoaXMuX2VuZENvbnRhY3RGb290aG9sZExpc3QubGVuZ3RoID0gMDsvL2NsZWFyXHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBiZWZvcmUgd29ybGQ6OnN0ZXBcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHRTdGVwKHN0YW1wKSB7XHJcblx0XHQvLyBwcmVwYXJlIGNvbnRhY3RcclxuXHRcdHRoaXMuc3RhdGUuX2Ryb3AgPSBmYWxzZTtcclxuXHRcdHRoaXMuX2Zvb3Rob2xkID0gbnVsbDtcclxuXHRcdHRoaXMuX2Zvb3RfYXQgPSBudWxsO1xyXG5cclxuXHRcdC8vIGFwcGx5IHN0YXRlXHJcblx0XHRpZiAodGhpcy5zdGF0ZS5sYWRkZXIpIHtcclxuXHRcdFx0dGhpcy5zdGF0ZS5qdW1wID0gZmFsc2U7XHJcblx0XHRcdHRoaXMuc3RhdGUuanVtcF9jb3VudCA9IDA7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKHRoaXMuc3RhdGUuX2JlZ2luX2p1bXApIHtcclxuXHRcdFx0XHRjb25zdCBtYXNzID0gdGhpcy5fZ2V0TWFzcygpO1xyXG5cdFx0XHRcdGNvbnN0IGZvcmNlID0gbmV3IGIyVmVjMigwLCAtbWFzcyAqIHRoaXMuanVtcF9mb3JjZSk7XHJcblx0XHRcdFx0dGhpcy5ib2R5LkFwcGx5Rm9yY2VUb0NlbnRlcihmb3JjZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmICh0aGlzLnN0YXRlLmtub2NrYmFjayA+IDApIHtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLmtub2NrYmFjayAtPSBzdGFtcDtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuc3RhdGUua25vY2tiYWNrID4gMCkge1xyXG5cdFx0XHRcdFx0dGhpcy5zdGF0ZS5vdXRPZkNvbnRyb2wgPSB0cnVlO1xyXG5cdFx0XHRcdFx0dGhpcy53YWxrZXIuRW5hYmxlTW90b3IoZmFsc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHRoaXMuc3RhdGUua25vY2tiYWNrID0gMDtcclxuXHRcdFx0XHRcdHRoaXMuc3RhdGUub3V0T2ZDb250cm9sID0gZmFsc2U7XHJcblx0XHRcdFx0XHR0aGlzLndhbGtlci5FbmFibGVNb3Rvcih0cnVlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuc3RhdGUuaW52aW5jaWJsZSA+IDApIHtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLmludmluY2libGUgLT0gc3RhbXA7XHJcblx0XHRcdFx0aWYgKHRoaXMuc3RhdGUuaW52aW5jaWJsZSA+IDApIHtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlLmludmluY2libGUgPSAwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAodGhpcy5zdGF0ZS5wb3J0YWxfY29vbGRvd24pIHtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLnBvcnRhbF9jb29sZG93biAtPSBzdGFtcDtcclxuXHRcdFx0XHRpZiAodGhpcy5zdGF0ZS5wb3J0YWxfY29vbGRvd24gPiAwKSB7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5zdGF0ZS5wb3J0YWxfY29vbGRvd24gPSAwO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogYWZ0ZXIgd29ybGQ6OnN0ZXBcclxuXHQgKi9cclxuXHRBZnRlclN0ZXAoKSB7XHJcblx0XHQvL3RoaXMuX2VuZENvbnRhY3RGb290aG9sZCgpO1xyXG5cclxuXHRcdGlmICh0aGlzLnN0YXRlLmxhZGRlcikge1xyXG5cdFx0XHRpZiAodGhpcy4kbGFkZGVyX3BqKSB7XHJcblx0XHRcdFx0Y29uc3QgdXBwZXIgPSB0aGlzLiRsYWRkZXJfcGouR2V0VXBwZXJMaW1pdCgpO1xyXG5cdFx0XHRcdGNvbnN0IGxvd2VyID10aGlzLiRsYWRkZXJfcGouR2V0TG93ZXJMaW1pdCgpO1xyXG5cdFx0XHRcdGNvbnN0IHRyYW5zbGF0aW9uID0gdGhpcy4kbGFkZGVyX3BqLkdldEpvaW50VHJhbnNsYXRpb24oKTtcclxuXHJcblx0XHRcdFx0aWYgKHRoaXMuc3RhdGUubGFkZGVyX21vdmVfZGlyID4gMCAmJiB0cmFuc2xhdGlvbiA+IHVwcGVyKSB7Ly9kb3duXHJcblx0XHRcdFx0XHR0aGlzLnVzZUxhZGRlcihmYWxzZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2UgaWYgKHRoaXMuc3RhdGUubGFkZGVyX21vdmVfZGlyIDwgMCAmJiB0cmFuc2xhdGlvbiA8IGxvd2VyKSB7Ly91cFxyXG5cdFx0XHRcdFx0dGhpcy51c2VMYWRkZXIoZmFsc2UpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmICghdGhpcy5zdGF0ZS5kcm9wRG93bikge1xyXG5cdFx0XHRcdGlmICh0aGlzLmJvZHkubV9hd2FrZUZsYWcgJiYgdGhpcy5mb290X3dhbGsubV9hd2FrZUZsYWcpIHtcclxuXHRcdFx0XHRcdHRoaXMuJGZvb3Rob2xkID0gdGhpcy5fZm9vdGhvbGQ7Ly9zZXQgb3IgY2xlYXJcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aWYgKCF0aGlzLl9mb290aG9sZCAmJiB0aGlzLl9mb290X2NvbnRhY3RfbGlzdC5sZW5ndGgpIHsvL+ebruWJjeaykueUqO+8jOawuOmBoOS4jeacg+iiq+Wft+ihjCA/P1xyXG5cdFx0XHRcdFx0bGV0IG1heCA9IHRoaXMuX2Zvb3RfY29udGFjdF9saXN0LnBvcCgpO1xyXG5cdFx0XHRcdFx0dGhpcy4kZm9vdGhvbGQgPSBtYXguZm9vdGhvbGQ7XHJcblx0XHRcdFx0XHR0aGlzLl9mb290aG9sZCA9IG1heC5mb290aG9sZDtcclxuXHRcdFx0XHRcdHRoaXMuX2Zvb3RfYXQgPSBtYXgucG9zaXRpb247XHJcblx0XHRcdFx0XHR0aGlzLl9mb290aG9sZF9wcmlvcml0eSA9IG1heC5wcmlvcml0eTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKHRoaXMuJGZvb3Rob2xkKSB7XHJcblx0XHRcdFx0Ly90aGlzLmJvZHkuU2V0QXdha2UoZmFsc2UpO1xyXG5cdFx0XHRcdC8vdGhpcy5mb290X3dhbGsuU2V0QXdha2UoZmFsc2UpO1xyXG5cclxuXHRcdFx0XHR0aGlzLnN0YXRlLmp1bXAgPSBmYWxzZTtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLmp1bXBfY291bnQgPSAwO1xyXG5cdFx0XHRcdGlmICh0aGlzLiRmb290aG9sZCA9PSB0aGlzLl9mb290aG9sZCkge1xyXG5cdFx0XHRcdFx0Ly9jb25zb2xlLmxvZyhcInN0YWJsZSBjb250YWN0XCIpO1xyXG5cdFx0XHRcdFx0Ly9kZWJ1Z2dlcjtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dGhpcy5fZm9vdF9jb250YWN0X2xpc3QubGVuZ3RoID0gMDtcclxuXHJcblx0XHRcdFx0dGhpcy5zdGF0ZS5qdW1wID0gdHJ1ZTtcclxuXHRcdFx0XHR0aGlzLnN0YXRlLl9iZWdpbl9qdW1wID0gZmFsc2U7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKCF0aGlzLl9mb290aG9sZCkge1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdC8vY29uc29sZS5sb2coXCJubyBzdGFibGUgY29udGFjdFwiKTtcclxuXHRcdFx0XHRcdC8vZGVidWdnZXI7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcmV0dXJucyB7bnVtYmVyfVxyXG5cdCAqL1xyXG5cdGdldExheWVyKCkge1xyXG5cdFx0bGV0IGxheWVyID0gdGhpcy4kZm9vdGhvbGQgPyB0aGlzLiRmb290aG9sZC5sYXllciA6ICh0aGlzLnByZXZfJGZoID8gdGhpcy5wcmV2XyRmaC5sYXllciA6ICh0aGlzLmxlYXZlXyRmaCA/IHRoaXMubGVhdmVfJGZoLmxheWVyIDogNSkpO1xyXG5cdFx0cmV0dXJuIHRoaXMuc3RhdGUubGFkZGVyID8gKGxheWVyICsgMSkgOiBsYXllcjtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFBDaGFyYWN0ZXIgZXh0ZW5kcyBQQ2hhcmFjdGVyQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlciguLi5hcmd1bWVudHMpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7U2NlbmVDaGFyYWN0ZXJ9ICovXHJcblx0XHR0aGlzLmNoYXJhID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIG5lZWQgc2V0IHRoaXMuc3RhdGUub3V0T2ZDb250cm9sID0gdHJ1ZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBtb3ZlWCAtIHVuaXQgaXMgcGl4ZWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbW92ZVkgLSB1bml0IGlzIHBpeGVsXHJcblx0ICovXHJcblx0Zm9yY2VNb3ZlKG1vdmVYLCBtb3ZlWSkge1xyXG5cdFx0Ly9UT0RPOiBjYWxjIG1vdmVcclxuXHRcdGNvbnN0IG1hc3MgPSB0aGlzLl9nZXRNYXNzKCk7XHJcblx0XHRjb25zdCBtb3ZlID0gbmV3IGIyVmVjMihtb3ZlWCAqIG1hc3MsIG1vdmVZICogbWFzcyk7XHJcblx0XHR0aGlzLmJvZHkuQXBwbHlMaW5lYXJJbXB1bHNlVG9DZW50ZXIobW92ZSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbW92ZVggLSB1bml0IGlzIHBpeGVsXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG1vdmVZIC0gdW5pdCBpcyBwaXhlbFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBba2JUaW1lPTEwMDBdIC0ga25vY2tiYWNrIHRpbWUsIHVuaXQgaXMgbWlsbGlzZWNvbmRcclxuXHQgKi9cclxuXHRrbm9ja2JhY2sobW92ZVgsIG1vdmVZLCBrYlRpbWUgPSAxMDAwKSB7XHJcblx0XHRjb25zdCBmcm9udCA9IHRoaXMuc3RhdGUuZnJvbnQ7XHJcblx0XHRsZXQgZngsIGZ5O1xyXG5cdFx0XHJcblx0XHRmeCA9IC1tb3ZlWCAqIGZyb250O1xyXG5cdFx0Ly9meSA9IHRoaXMuc3RhdGUuanVtcCA/IG1vdmVZIDogLW1vdmVZO1xyXG5cdFx0ZnkgPSAtbW92ZVk7XHJcblxyXG5cdFx0dGhpcy5mb3JjZU1vdmUoZngsIGZ5KTtcclxuXHRcdHRoaXMuc3RhdGUua25vY2tiYWNrID0ga2JUaW1lO1xyXG5cdFx0dGhpcy5zdGF0ZS5vdXRPZkNvbnRyb2wgPSB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtXb3JsZH0gd29ybGRcclxuXHQgKi9cclxuXHRfY3JlYXRlX2FuY2hvcih3b3JsZCkge1xyXG5cdFx0bGV0IG1kID0gbmV3IGIyTW91c2VKb2ludERlZigpO1xyXG5cdFx0bWQuYm9keUEgPSB3b3JsZC5ncm91bmQuYm9kaWVzWzBdO1xyXG5cdFx0bWQuYm9keUIgPSB0aGlzLmJvZHk7XHJcblx0XHRtZC50YXJnZXQuQ29weSh0aGlzLmdldFBvc2l0aW9uKCkpO1xyXG5cdFx0bWQubWF4Rm9yY2UgPSAxMDAwICogdGhpcy5fZ2V0TWFzcygpO1xyXG5cdFx0cmV0dXJuIHdvcmxkLkNyZWF0ZUpvaW50KG1kKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIG5vIGFuY2hvclxyXG5cdCAqIGV4cGVyaW1lbnRhbFxyXG5cdCAqIEBwYXJhbSB7Q2hhcmFjdGVyTW92ZUVsZW19IG1vdmVFbGVtXHJcblx0ICovXHJcblx0bW92ZVRvKG1vdmVFbGVtKSB7XHJcblx0XHRjb25zdCBib2R5ID0gdGhpcy5ib2R5O1xyXG5cdFx0XHJcblx0XHR0aGlzLmJvZHkuU2V0QXdha2UodHJ1ZSk7XHJcblx0XHR0aGlzLmZvb3Rfd2Fsay5TZXRBd2FrZSh0cnVlKTtcclxuXHJcblx0XHRpZiAobW92ZUVsZW0uZWxhcHNlZCA9PSAwKSB7XHJcblx0XHRcdGJvZHkuQ29uc3RhbnRWZWxvY2l0eVdvcmxkQ2VudGVyMih2eCwgdnkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGNvbnN0IEFMUEhBID0gMC43O1xyXG5cdFx0XHRjb25zdCBPTkVfTUlOVVNfQUxQSEEgPSAxIC0gQUxQSEE7XHJcblx0XHRcdGxldCBkeCA9IG1vdmVFbGVtLnggLSBwb3MueDtcclxuXHRcdFx0bGV0IGR5ID0gbW92ZUVsZW0ueSAtIHBvcy55O1xyXG5cdFx0XHRsZXQgc3ggPSBkeCAvIChtb3ZlRWxlbS5lbGFwc2VkIC8gJGd2LkZSQU1FX0VMQVBTRUQpOy8vc3BlZWQgPSBwaXhlbCAvIHNlY29uZFxyXG5cdFx0XHRsZXQgc3kgPSBkeSAvIChtb3ZlRWxlbS5lbGFwc2VkIC8gJGd2LkZSQU1FX0VMQVBTRUQpO1xyXG5cdFx0XHRsZXQgb2xkVmVsID0gYm9keS5HZXRMaW5lYXJWZWxvY2l0eSgpO1xyXG5cclxuXHRcdFx0bGV0IHZ4LCB2eTtcclxuXHJcblx0XHRcdGlmIChtb3ZlRWxlbS5wU3RhdGUuanVtcCkge1xyXG5cdFx0XHRcdHRoaXMuc2V0R3Jhdml0eVNjYWxlKDApO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMuc2V0R3Jhdml0eVNjYWxlKDEpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdGlmIChtb3ZlRWxlbS5wU3RhdGUud2FsayB8fCBzeCkge1xyXG5cdFx0XHRcdFx0dGhpcy53YWxrZXIuRW5hYmxlTW90b3IoZmFsc2UpOy8vdGhpcy4kcGh5c2ljcy53YWxrZXIuSXNNb3RvckVuYWJsZWQoKSA9PSB0cnVlXHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy53YWxrZXIuRW5hYmxlTW90b3IodHJ1ZSk7Ly9rZWVwIHN0b3BcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChzeCkge1xyXG5cdFx0XHRcdGlmIChtb3ZlRWxlbS52eCkge1xyXG5cdFx0XHRcdFx0aWYgKE1hdGguc2lnbihtb3ZlRWxlbS52eCkgPT0gTWF0aC5zaWduKHN4KSkge1xyXG5cdFx0XHRcdFx0XHR2eCA9IG9sZFZlbC54ICogT05FX01JTlVTX0FMUEhBICsgbW92ZUVsZW0udnggKiBBTFBIQTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHR2eCA9IG9sZFZlbC54ICogT05FX01JTlVTX0FMUEhBICsgc3ggKiBBTFBIQTsvL+S/ruato+W6p+aomVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdHZ4ID0gc3g7Ly/kv67mraPluqfmqJlcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0dnggPSAwO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoc3kpIHtcclxuXHRcdFx0XHRpZiAobW92ZUVsZW0udnkpIHtcclxuXHRcdFx0XHRcdGlmIChNYXRoLnNpZ24obW92ZUVsZW0udnkpID09IE1hdGguc2lnbihzeSkpIHtcclxuXHRcdFx0XHRcdFx0dnkgPSBvbGRWZWwueSAqIE9ORV9NSU5VU19BTFBIQSArIG1vdmVFbGVtLnZ5ICogQUxQSEE7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dnkgPSBvbGRWZWwueSAqIE9ORV9NSU5VU19BTFBIQSArIHN5ICogQUxQSEE7Ly/kv67mraPluqfmqJlcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHR2eSA9IHN5Oy8v5L+u5q2j5bqn5qiZXHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHZ5ID0gMDtcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ym9keS5Db25zdGFudFZlbG9jaXR5V29ybGRDZW50ZXIyKHZ4LCB2eSk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5pZiAobW9kdWxlLmhvdCkge1xyXG5cdC8qKiBAdHlwZSB7UFBsYXllcltdfSAqL1xyXG5cdHZhciBQUGxheWVyX2luc3RhbmNlX2xpc3QgPSB3aW5kb3cuUFBsYXllcl9pbnN0YW5jZV9saXN0IHx8IFtdO1xyXG5cclxuXHRpZiAoUFBsYXllcl9pbnN0YW5jZV9saXN0KSB7XHJcblx0XHRmb3IgKGxldCBwbCBvZiBQUGxheWVyX2luc3RhbmNlX2xpc3QpIHtcclxuXHRcdFx0cGwuX19wcm90b19fID0gUFBsYXllci5wcm90b3R5cGU7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgUFBsYXllciBleHRlbmRzIFBDaGFyYWN0ZXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoLi4uYXJndW1lbnRzKTtcclxuXHJcblx0XHRpZiAobW9kdWxlLmhvdCkge1xyXG5cdFx0XHRQUGxheWVyX2luc3RhbmNlX2xpc3QucHVzaCh0aGlzKTtcclxuXHJcblx0XHRcdGNvbnN0IHN1cGVyX2Rlc3Ryb3kgPSBzdXBlci5fZGVzdHJveTtcclxuXHJcblx0XHRcdHRoaXMuX2Rlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0c3VwZXJfZGVzdHJveS5jYWxsKHRoaXMpO1xyXG5cdFx0XHRcdFBQbGF5ZXJfaW5zdGFuY2VfbGlzdC5zcGxpY2UoUFBsYXllcl9pbnN0YW5jZV9saXN0LmluZGV4T2YodGhpcyksIDEpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1dvcmxkfSB3b3JsZFxyXG5cdCAqIEByZXR1cm5zIHt2b2lkfVxyXG5cdCAqL1xyXG5cdF9jcmVhdGUod29ybGQpIHtcclxuXHRcdHN1cGVyLl9jcmVhdGUod29ybGQpO1xyXG5cclxuXHRcdHdpbmRvdy5TQ1JFRU5fUFJJTlRMTigoKSA9PiBcInhcIiwgKCkgPT4gdGhpcy5nZXRQb3NpdGlvbigpLngudG9GaXhlZCgzKSArIFwiICogXCIgKyAkZ3YuQ0FOVkFTX1NDQUxFICsgXCIgPSBcIiArICh0aGlzLmdldFBvc2l0aW9uKCkueCAqICRndi5DQU5WQVNfU0NBTEUpLnRvRml4ZWQoMCkpO1xyXG5cdFx0d2luZG93LlNDUkVFTl9QUklOVExOKCgpID0+IFwieVwiLCAoKSA9PiB0aGlzLmdldFBvc2l0aW9uKCkueS50b0ZpeGVkKDMpICsgXCIgKiBcIiArICRndi5DQU5WQVNfU0NBTEUgKyBcIiA9IFwiICsgKHRoaXMuZ2V0UG9zaXRpb24oKS55ICogJGd2LkNBTlZBU19TQ0FMRSkudG9GaXhlZCgwKSk7XHJcblx0XHR3aW5kb3cuU0NSRUVOX1BSSU5UTE4oKCkgPT4gXCJqdW1wXCIsICgpID0+IHRoaXMuc3RhdGUuanVtcCk7XHJcblx0XHR3aW5kb3cuU0NSRUVOX1BSSU5UTE4oKCkgPT4gXCJfZHJvcFwiLCAoKSA9PiB0aGlzLnN0YXRlLl9kcm9wKTtcclxuXHRcdHdpbmRvdy5TQ1JFRU5fUFJJTlRMTigoKSA9PiBcImRkcm9wXCIsICgpID0+IHRoaXMuc3RhdGUuZHJvcERvd24pO1xyXG5cdFx0d2luZG93LlNDUkVFTl9QUklOVExOKCgpID0+IFwiJGZoXCIsICgpID0+IHRoaXMuJGZvb3Rob2xkID8gdGhpcy4kZm9vdGhvbGQuaWQgOiBudWxsKTtcclxuXHRcdHdpbmRvdy5TQ1JFRU5fUFJJTlRMTigoKSA9PiBcIiRmaC0+Y1wiLCAoKSA9PiB0aGlzLiRmb290aG9sZCA/IHRoaXMuJGZvb3Rob2xkLmNoYWluLmlkIDogbnVsbCk7XHJcblx0XHR3aW5kb3cuU0NSRUVOX1BSSU5UTE4oKCkgPT4gXCJfZmhcIiwgKCkgPT4gdGhpcy5fZm9vdGhvbGQgPyB0aGlzLl9mb290aG9sZC5pZCA6IG51bGwpO1xyXG5cdFx0d2luZG93LlNDUkVFTl9QUklOVExOKCgpID0+IFwicCRmaFwiLCAoKSA9PiB0aGlzLnByZXZfJGZoID8gdGhpcy5wcmV2XyRmaC5pZCA6IG51bGwpO1xyXG5cdFx0d2luZG93LlNDUkVFTl9QUklOVExOKCgpID0+IFwibGVhdmVfJGZoXCIsICgpID0+IHRoaXMubGVhdmVfJGZoID8gdGhpcy5sZWF2ZV8kZmguaWQgOiBudWxsKTtcclxuXHJcblx0XHR3aW5kb3cuU0NSRUVOX1BSSU5UTE4oKCkgPT4gXCIoanVtcCAmJiAhJGZoKVwiLCAoKSA9PiB0aGlzLnN0YXRlLmp1bXAgJiYgIXRoaXMuJGZvb3Rob2xkKTtcclxuXHJcblx0XHR3aW5kb3cuU0NSRUVOX1BSSU5UTE4oKCkgPT4gXCJ2ZWwueFwiLCAoKSA9PiAodGhpcy5ib2R5Lm1fbGluZWFyVmVsb2NpdHkueCAqICRndi5DQU5WQVNfU0NBTEUpLnRvRml4ZWQoMCkpO1xyXG5cdFx0d2luZG93LlNDUkVFTl9QUklOVExOKCgpID0+IFwidmVsLnlcIiwgKCkgPT4gKHRoaXMuYm9keS5tX2xpbmVhclZlbG9jaXR5LnkgKiAkZ3YuQ0FOVkFTX1NDQUxFKS50b0ZpeGVkKDApKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGJlZm9yZSB3b3JsZDo6c3RlcFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdFN0ZXAoc3RhbXApIHtcclxuXHRcdHN1cGVyLlN0ZXAoc3RhbXApO1xyXG5cdFx0XHJcblx0XHRpZiAoJGd2LmlucHV0X2tleURvd25bJ0InXSA9PSAxICYmICEkZ3YubW91c2VfZGwpIHtcclxuXHRcdFx0Y29uc3QgcHggPSAkZ3YubV92aWV3UmVjdC5sZWZ0ICsgJGd2Lm1vdXNlX3g7XHJcblx0XHRcdGNvbnN0IHB5ID0gJGd2Lm1fdmlld1JlY3QudG9wICsgJGd2Lm1vdXNlX3k7XHJcblxyXG5cdFx0XHR0aGlzLnNldFBvc2l0aW9uKHB4IC8gJGd2LkNBTlZBU19TQ0FMRSwgcHkgLyAkZ3YuQ0FOVkFTX1NDQUxFLCB0cnVlKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKCRndi5pbnB1dF9rZXlEb3duWydCJ10gPiAwICYmICRndi5tb3VzZV9kbCkge1xyXG5cdFx0XHRjb25zdCBjZW50ZXIgPSAkZ3YubV92aWV3UmVjdC5jZW50ZXI7XHJcblx0XHRcdGNvbnN0IHB4ID0gJGd2Lm1fdmlld1JlY3QubGVmdCArICRndi5tb3VzZV94IC0gY2VudGVyLng7XHJcblx0XHRcdGNvbnN0IHB5ID0gJGd2Lm1fdmlld1JlY3QudG9wICsgJGd2Lm1vdXNlX3kgLSBjZW50ZXIueTtcclxuXHJcblx0XHRcdHRoaXMuYm9keS5TZXRMaW5lYXJWZWxvY2l0eShuZXcgYjJWZWMyKHB4IC8gJGd2LkNBTlZBU19TQ0FMRSwgcHkgLyAkZ3YuQ0FOVkFTX1NDQUxFKSk7XHJcblx0XHRcdHRoaXMuZm9vdF93YWxrLlNldExpbmVhclZlbG9jaXR5KG5ldyBiMlZlYzIocHggLyAkZ3YuQ0FOVkFTX1NDQUxFLCBweSAvICRndi5DQU5WQVNfU0NBTEUpKTtcclxuXHRcdH1cclxuXHRcdGVsc2UgaWYgKCRndi5tb3VzZV9kbSAmJiAkZ3YubW91c2VfZG0gJSAxMiA9PSAxKSB7XHJcblx0XHRcdGNvbnN0IHB4ID0gJGd2Lm1fdmlld1JlY3QubGVmdCArICRndi5tb3VzZV94O1xyXG5cdFx0XHRjb25zdCBweSA9ICRndi5tX3ZpZXdSZWN0LnRvcCArICRndi5tb3VzZV95O1xyXG5cdFx0XHR0aGlzLnNldFBvc2l0aW9uKHB4IC8gJGd2LkNBTlZBU19TQ0FMRSwgcHkgLyAkZ3YuQ0FOVkFTX1NDQUxFLCB0cnVlKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCByZW5kZXJlcigpIHtcclxuXHRcdGRlYnVnZ2VyXHJcblx0XHRyZXR1cm4gdGhpcy5fJHJlbmRlcmVyO1xyXG5cdH1cclxuXHRzZXQgcmVuZGVyZXIodmFsdWUpIHtcclxuXHRcdHRoaXMuXyRyZW5kZXJlciA9IHZhbHVlO1xyXG5cdH1cclxufVxyXG5cclxuaWYgKG1vZHVsZS5ob3QpIHtcclxuXHQvKiogQHR5cGUge1BSZW1vdGVDaGFyYWN0ZXJbXX0gKi9cclxuXHR2YXIgUFJlbW90ZUNoYXJhY3Rlcl9pbnN0YW5jZV9saXN0ID0gd2luZG93LlBSZW1vdGVDaGFyYWN0ZXJfaW5zdGFuY2VfbGlzdCB8fCBbXTtcclxuXHJcblx0aWYgKFBSZW1vdGVDaGFyYWN0ZXJfaW5zdGFuY2VfbGlzdCkge1xyXG5cdFx0Zm9yIChsZXQgcGwgb2YgUFJlbW90ZUNoYXJhY3Rlcl9pbnN0YW5jZV9saXN0KSB7XHJcblx0XHRcdHBsLl9fcHJvdG9fXyA9IFBSZW1vdGVDaGFyYWN0ZXIucHJvdG90eXBlO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBSZW1vdGVDaGFyYWN0ZXIgZXh0ZW5kcyBQQ2hhcmFjdGVyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKC4uLmFyZ3VtZW50cyk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtiMk1vdXNlSm9pbnR9ICovXHJcblx0XHR0aGlzLl9hbmNob3IgPSBudWxsO1xyXG5cclxuXHRcdGlmIChtb2R1bGUuaG90KSB7XHJcblx0XHRcdFBSZW1vdGVDaGFyYWN0ZXJfaW5zdGFuY2VfbGlzdC5wdXNoKHRoaXMpO1xyXG5cclxuXHRcdFx0Y29uc3Qgc3VwZXJfZGVzdHJveSA9IHN1cGVyLl9kZXN0cm95O1xyXG5cclxuXHRcdFx0dGhpcy5fZGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcclxuXHRcdFx0XHRzdXBlcl9kZXN0cm95LmNhbGwodGhpcyk7XHJcblx0XHRcdFx0UFJlbW90ZUNoYXJhY3Rlcl9pbnN0YW5jZV9saXN0LnNwbGljZShQUmVtb3RlQ2hhcmFjdGVyX2luc3RhbmNlX2xpc3QuaW5kZXhPZih0aGlzKSwgMSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7V29ybGR9IHdvcmxkXHJcblx0ICogQHJldHVybnMge3ZvaWR9XHJcblx0ICovXHJcblx0X2NyZWF0ZSh3b3JsZCkge1xyXG5cdFx0c3VwZXIuX2NyZWF0ZSh3b3JsZCk7XHJcblxyXG5cdFx0aWYgKHdpbmRvdy4kaW8pIHtcclxuXHRcdFx0dGhpcy5fYW5jaG9yID0gdGhpcy5fY3JlYXRlX2FuY2hvcih3b3JsZCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5tb3ZlVG8gPSBzdXBlci5tb3ZlVG87XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3Rlck1vdmVFbGVtfSBtb3ZlRWxlbVxyXG5cdCAqL1xyXG5cdG1vdmVUbyhtb3ZlRWxlbSkge1xyXG5cdFx0dGhpcy5ib2R5LlNldEF3YWtlKHRydWUpO1xyXG5cdFx0dGhpcy5mb290X3dhbGsuU2V0QXdha2UodHJ1ZSk7XHJcblx0XHRcclxuXHRcdC8vaWYgKHRoaXMuX2FuY2hvcikge1xyXG5cdFx0XHR0aGlzLl9hbmNob3IubV90YXJnZXRBLnggPSBtb3ZlRWxlbS54O1xyXG5cdFx0XHR0aGlzLl9hbmNob3IubV90YXJnZXRBLnkgPSBtb3ZlRWxlbS55O1xyXG5cdFx0Ly99XHJcblx0XHQvL2Vsc2Uge1xyXG5cdFx0Ly9cdHN1cGVyLm1vdmVUbyhtb3ZlRWxlbSk7XHJcblx0XHQvL31cclxuXHR9XHJcbn1cclxuXHJcbmlmIChtb2R1bGUuaG90KSB7XHJcblx0bW9kdWxlLmhvdC5hY2NlcHQoKTtcclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Physics/PPlayer.js\n");

/***/ }),

/***/ "./src/game/Physics/World.js":
/*!***********************************!*\
  !*** ./src/game/Physics/World.js ***!
  \***********************************/
/*! exports provided: GRAVITY, World */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"GRAVITY\", function() { return GRAVITY; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"World\", function() { return World; });\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Physics.js */ \"./src/game/Physics/Physics.js\");\n/* harmony import */ var _Physics_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_Physics_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _DebugDraw_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./DebugDraw.js */ \"./src/game/Physics/DebugDraw.js\");\n/* harmony import */ var _Ground_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Ground.js */ \"./src/game/Physics/Ground.js\");\n/* harmony import */ var _LadderRope_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./LadderRope.js */ \"./src/game/Physics/LadderRope.js\");\n/* harmony import */ var _PPlayer_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _PMob_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./PMob.js */ \"./src/game/Physics/PMob.js\");\n/* harmony import */ var _Renderer_CharacterRenderer__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../Renderer/CharacterRenderer */ \"./src/game/Renderer/CharacterRenderer.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Filter_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Filter.js */ \"./src/game/Physics/Filter.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nwindow.$gravityAcc = 2000;\r\n\r\nwindow.$positionIterations = 3;\r\nwindow.$velocityIterations = 8;\r\nwindow.$particleIterations = 1;\r\n\r\nwindow.$particleRadius = 10;//unit is pixel\r\n\r\nconst GRAVITY = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, window.$gravityAcc / $gv.CANVAS_SCALE);\r\n\r\n\r\nclass ContactListener extends _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ContactListener\"] {\r\n\t/** @param {b2Contact} contact */\r\n\tBeginContact(contact) {\r\n\t\tconst fa = contact.m_fixtureA;\r\n\t\tconst fb = contact.m_fixtureB;\r\n\t\tconst childIndexA = contact.m_indexA;\r\n\t\tconst childIndexB = contact.m_indexB;\r\n\r\n\t\tfa.beginContact.call(fa.m_userData, contact, fa, fb, childIndexA, childIndexB);\r\n\t\tfb.beginContact.call(fb.m_userData, contact, fb, fa, childIndexB, childIndexA);\r\n\t}\r\n\t/** @param {b2Contact} contact */\r\n\tEndContact(contact) {\r\n\t\tconst fa = contact.m_fixtureA;\r\n\t\tconst fb = contact.m_fixtureB;\r\n\t\tconst childIndexA = contact.m_indexA;\r\n\t\tconst childIndexB = contact.m_indexB;\r\n\r\n\t\tfa.endContact.call(fa.m_userData, contact, fa, fb, childIndexA, childIndexB);\r\n\t\tfb.endContact.call(fb.m_userData, contact, fb, fa, childIndexB, childIndexA);\r\n\t}\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2Manifold} oldManifold\r\n\t */\r\n\tPreSolve(contact, oldManifold) {\r\n\t\tconst fa = contact.m_fixtureA;\r\n\t\tconst fb = contact.m_fixtureB;\r\n\t\tconst childIndexA = contact.m_indexA;\r\n\t\tconst childIndexB = contact.m_indexB;\r\n\r\n\t\tfa.preSolve.call(fa.m_userData, contact, oldManifold, fa, fb, childIndexA, childIndexB);\r\n\t\tfb.preSolve.call(fb.m_userData, contact, oldManifold, fb, fa, childIndexB, childIndexA);\r\n\t}\r\n\t/**\r\n\t * @param {b2Contact} contact\r\n\t * @param {b2ContactImpulse} impulse\r\n\t */\r\n\tPostSolve(contact, impulse) {\r\n\t\tconst fa = contact.m_fixtureA;\r\n\t\tconst fb = contact.m_fixtureB;\r\n\t\tconst childIndexA = contact.m_indexA;\r\n\t\tconst childIndexB = contact.m_indexB;\r\n\r\n\t\tfa.postSolve.call(fa.m_userData, contact, impulse, fa, fb, childIndexA, childIndexB);\r\n\t\tfb.postSolve.call(fb.m_userData, contact, impulse, fb, fa, childIndexB, childIndexA);\r\n\t}\r\n}\r\n\r\nclass World extends _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2World\"] {\r\n\tconstructor() {\r\n\t\tsuper(GRAVITY);\r\n\r\n\t\t/** @type {DebugDraw} */\r\n\t\tthis.m_debugDraw = $gv.m_debugDraw;\r\n\t\tthis.SetDebugDraw(this.m_debugDraw);\r\n\r\n\t\tthis.SetContactListener(new ContactListener());\r\n\r\n\t\t//if (!window.$io) {\r\n\t\t//\tthis.player = null;\r\n\t\t//\tthis._player_rebirth();\r\n\t\t//\tthis.player.setPosition(0, 0, true);\r\n\t\t//}\r\n\r\n\t\tthis.ground = new _Ground_js__WEBPACK_IMPORTED_MODULE_2__[\"Ground\"]();\r\n\r\n\t\t/** @type {LadderRope[]} */\r\n\t\tthis.ladderRope = [];\r\n\t\t\r\n\t\t/** @type {b2Body} */\r\n\t\tthis.mapBound_body = null;\r\n\t\t\r\n\t\tthis.stop = false;\r\n\t\t\r\n\t\tthis.$_mouseJoint = null;\r\n\r\n\t\t/** @type {(function():void)[]} */\r\n\t\tthis._onceAfterStep = [];\r\n\r\n\t\t/** @type {b2Body[]} */\r\n\t\tthis._destryBodyList = [];\r\n\r\n\t\tthis._DestroyBody = this.DestroyBody;\r\n\r\n\t\t/**\r\n\t\t * @param {b2Body} b\r\n\t\t */\r\n\t\tthis.DestroyBody = b => {\r\n\t\t\tif (this.m_locked) {\r\n\t\t\t\tthis._destryBodyList.push(b);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._DestroyBody(b);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.draw_foothold_path_count = 1;\r\n\t}\r\n\r\n\t$test_b2ParticleSystem() {\r\n\t\tconst particleType = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ParticleFlag\"].b2_elasticParticle;//b2_waterParticle;\r\n\t\tconst particleSystemDef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ParticleSystemDef\"]();\r\n\t\t\r\n\t\t/** @type {b2ParticleSystem} */\r\n\t\tthis.m_particleSystem = this.CreateParticleSystem(particleSystemDef);\r\n\t\t\r\n\t\tthis.m_particleSystem.SetGravityScale(0);\r\n\t\tthis.m_particleSystem.SetRadius(10 / $gv.CANVAS_SCALE);\r\n\t\tthis.m_particleSystem.SetDamping(0.2);\r\n\t\t{\r\n\t\t\tconst shape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2CircleShape\"]();\r\n\t\t\tshape.m_p.Set(0, 2);\r\n\t\t\tshape.m_radius = 3;\r\n\t\t\tconst pd = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ParticleGroupDef\"]();\r\n\t\t\tpd.flags = particleType;\r\n\t\t\tpd.shape = shape;\r\n\t\t\tconst group = this.m_particleSystem.CreateParticleGroup(pd);\r\n\t\t\tif (pd.flags & _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2ParticleFlag\"].b2_colorMixingParticle) {\r\n\t\t\t\tthis.ColorParticleGroup(group, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.m_particleSystem = this.m_particleSystem;\r\n\t\t\r\n\t\tthis.$vbo_ps = null;\r\n\t}\r\n\r\n\t/**\r\n\t * after load map\r\n\t */\r\n\tasync load(map_raw_data) {\r\n\t\tthis.ground.load(map_raw_data, this);\r\n\t\tthis.ladderRope = _LadderRope_js__WEBPACK_IMPORTED_MODULE_3__[\"MapLadderRopeLoader\"].load(map_raw_data, this);\r\n\t}\r\n\tunload() {\r\n\t\tif (this.IsLocked()) {\r\n\t\t\tdebugger;\r\n\t\t\tconsole.error(\"world is locked, world can not unload\");\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.ground.unload(this);\r\n\t\t\tthis.ladderRope.length = 0;\r\n\t\t\tthis.DestroyBody(this.mapBound_body);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {MapMob} mapMob\r\n\t */\r\n\tcreateMob(mapMob) {\r\n\t\tlet mob = new _PMob_js__WEBPACK_IMPORTED_MODULE_5__[\"PMob\"](mapMob);\r\n\t\tmob._create(this);\r\n\t\treturn mob;\r\n\t}\r\n\tdestroyMob(mapMob) {\r\n\t\t//if (this != mapMob.$physics) {\r\n\t\t//\tdebugger;\r\n\t\t//\treturn false;\r\n\t\t//}\r\n\t\t\r\n\t\tmapMob.$physics._destroy(this);\r\n\t\tmapMob.$physics = null;\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tcreateNpc(mapNpc) {\r\n\t\treturn null;\r\n\t}\r\n\tdestroyNpc(mapNpc) {\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\tcreatePortal(portal) {\r\n\t\tconst rect = portal.compute_rectangle(0);\r\n\t\tif (rect) {\r\n\t\t\tconst width = rect.width / 2 / $gv.CANVAS_SCALE * 0.4;\r\n\t\t\tconst height = rect.height / 2 / $gv.CANVAS_SCALE * 0.2;\r\n\r\n\t\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\t\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\t\t\tlet shape;\r\n\r\n\t\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_8__[\"FilterHelper\"].get(\"portal\"));\r\n\r\n\t\t\tbdef.userData = portal;\r\n\t\t\tbdef.type = _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_staticBody;//b2_staticBody//b2_kinematicBody//b2_dynamicBody\r\n\t\t\tbdef.position.Set(\r\n\t\t\t\tportal.x / $gv.CANVAS_SCALE,\r\n\t\t\t\tportal.y / $gv.CANVAS_SCALE);\r\n\r\n\t\t\tlet body = this.CreateBody(bdef);\r\n\t\t\tbody.$type = \"portal\";\r\n\r\n\t\t\tshape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2PolygonShape\"]();\r\n\r\n\t\t\tif (window.MAP_PORTAL_FULL_SIZE) {\r\n\t\t\t\tshape.SetAsBox(\r\n\t\t\t\t\trect.width / 2 / $gv.CANVAS_SCALE,\r\n\t\t\t\t\trect.height / 2 / $gv.CANVAS_SCALE,\r\n\t\t\t\t\tnew _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](-portal.textures[0].x / $gv.CANVAS_SCALE, -portal.textures[0].y / $gv.CANVAS_SCALE),\r\n\t\t\t\t\t0);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tshape.SetAsBox(\r\n\t\t\t\t\twidth,\r\n\t\t\t\t\theight,\r\n\t\t\t\t\tnew _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](0, -height),\r\n\t\t\t\t\t0);\r\n\t\t\t}\r\n\r\n\t\t\tfdef.isSensor = true;\r\n\t\t\tfdef.shape = shape;\r\n\t\t\tfdef.filter = _Filter_js__WEBPACK_IMPORTED_MODULE_8__[\"FilterHelper\"].get(\"portal\");\r\n\t\t\tfdef.userData = portal;\r\n\t\t\tfdef.$type = \"portal\";\r\n\r\n\t\t\tlet fixture = body.CreateFixture(fdef);\r\n\r\n\t\t\tportal.body = body;\r\n\r\n\t\t\treturn body;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Rectangle} rect\r\n\t */\r\n\t_createMapBound(rect) {\r\n\t\tlet { left, top, right, bottom } = rect;\r\n\t\t\r\n\t\tleft /= $gv.CANVAS_SCALE;\r\n\t\tright /= $gv.CANVAS_SCALE;\r\n\t\ttop /= $gv.CANVAS_SCALE;\r\n\t\tbottom /= $gv.CANVAS_SCALE;\r\n\t\t\r\n\t\tlet bdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyDef\"]();\r\n\t\t//bdef.type = b2BodyType.b2_dynamicBody;\r\n\t\tlet fdef = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2FixtureDef\"]();\r\n\t\tlet shape = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2EdgeShape\"]();\r\n\r\n\t\tfdef.$type = \"MapBorder\";\r\n\t\tfdef.shape = shape;\r\n\t\tfdef.filter.Copy(_Filter_js__WEBPACK_IMPORTED_MODULE_8__[\"FilterHelper\"].get(\"map_border\"));\r\n\r\n\t\tlet bb = this.CreateBody(bdef);\r\n\t\tbb.$type = \"MapBorder\";\r\n\t\t\r\n\t\tshape.m_vertex1.Set(left, top);\r\n\t\tshape.m_vertex2.Set(right, top);\r\n\t\tbb.CreateFixture(fdef);\r\n\t\t\r\n\t\tshape.m_vertex1.Set(left, bottom);\r\n\t\tshape.m_vertex2.Set(right, bottom);\r\n\t\tbb.CreateFixture(fdef);\r\n\t\t\r\n\t\tshape.m_vertex1.Set(left, top);\r\n\t\tshape.m_vertex2.Set(left, bottom);\r\n\t\tbb.CreateFixture(fdef);\r\n\r\n\t\tshape.m_vertex1.Set(right, top);\r\n\t\tshape.m_vertex2.Set(right, bottom);\r\n\t\tbb.CreateFixture(fdef);\r\n\t\t\r\n\t\tif (this.player) {\r\n\t\t\tthis.player.setPosition((right + left) * 0.5, (bottom + top) * 0.5, true);\r\n\t\t}\r\n\r\n\t\tthis.mapBound_body = bb;\r\n\t}\r\n\r\n\t//_player_rebirth() {\r\n\t//\twindow.$player = this.player = new PPlayer(window.chara ? window.chara.renderer:null);\r\n\t//\tthis.player._create(this);\r\n\t//\r\n\t//\tdelete this.player.renderer;\r\n\t//\tObject.defineProperty(this.player, \"renderer\", {\r\n\t//\t\tget: function () {\r\n\t//\t\t\treturn window.chara ? window.chara.renderer : null;\r\n\t//\t\t}\r\n\t//\t});\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {SceneObject} sceneObject\r\n\t * @param {CharacterAnimationBase} renderer\r\n\t */\r\n\t$createPlayer(sceneObject, renderer) {\r\n\t\tif (!sceneObject || !renderer) {\r\n\t\t\tdebugger;\r\n\t\t\talert(\"$createPlayer(sceneObject, renderer)\");\r\n\t\t}\r\n\t\tlet player = new _PPlayer_js__WEBPACK_IMPORTED_MODULE_4__[\"PPlayer\"]();\r\n\r\n\t\tplayer._create(this);\r\n\r\n\t\t//init ?\r\n\t\tplayer.chara = sceneObject;\r\n\t\tplayer.renderer = renderer;//??\r\n\r\n\t\tthis.player = player;\r\n\r\n\t\treturn player;\r\n\t}\r\n\t/**\r\n\t * @param {SceneObject} sceneObject\r\n\t * @param {CharacterAnimationBase} renderer\r\n\t */\r\n\t$createRemotePlayer(sceneObject, renderer) {\r\n\t\tif (!sceneObject || !renderer) {\r\n\t\t\tdebugger;\r\n\t\t\talert(\"$createRemotePlayer(sceneObject, renderer)\");\r\n\t\t}\r\n\t\tlet player = new _PPlayer_js__WEBPACK_IMPORTED_MODULE_4__[\"PRemoteCharacter\"]();\r\n\r\n\t\tplayer._create(this);\r\n\r\n\t\t//init ?\r\n\t\tplayer.renderer = renderer;\r\n\r\n\t\treturn player;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {function():void} func\r\n\t */\r\n\tonceUnlock(func) {\r\n\t\tif (this.m_locked) {\r\n\t\t\tthis._onceAfterStep.push(func);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfunc();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * do once AfterStep\r\n\t * @param {function():void} func\r\n\t */\r\n\tdoAfterStep(func) {\r\n\t\tthis._onceAfterStep.push(func);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {b2Vec2} p\r\n\t */\r\n\t$_mouseDown(p) {\r\n\t\tif (this.$_mouseJoint != null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Make a small box.\r\n\t\tlet aabb = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2AABB\"]();\r\n\t\tlet d = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"]();\r\n\t\td.Set(0.001, 0.001);\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].SubVV(p, d, aabb.lowerBound);\r\n\t\t_Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"].AddVV(p, d, aabb.upperBound);\r\n\r\n\t\tlet that = this;\r\n\t\tlet hit_fixture = null;\r\n\t\t\r\n\t\t// Query the world for overlapping shapes.\r\n\t\tthis.QueryAABB({\r\n\t\t\t/**\r\n\t\t\t * Called for each fixture found in the query AABB.\r\n\t\t\t * @param {b2Fixture} fixture\r\n\t\t\t * @returns false to terminate the query.\r\n\t\t\t */\r\n\t\t\tReportFixture(fixture) {\r\n\t\t\t\tlet body = fixture.GetBody();\r\n\t\t\t\tif (body.GetType() != _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2BodyType\"].b2_staticBody) {\r\n\t\t\t\t\tlet inside = fixture.TestPoint(p);\r\n\t\t\t\t\tif (inside) {\r\n\t\t\t\t\t\thit_fixture = fixture;\r\n\r\n\t\t\t\t\t\t// We are done, terminate the query.\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Continue the query.\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Called for each fixture found in the query AABB.\r\n\t\t\t * @param {b2ParticleSystem} system\r\n\t\t\t * @param {number} index\r\n\t\t\t * @returns false to terminate the query.\r\n\t\t\t */\r\n\t\t\tReportParticle(system, index) {\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * Called for each fixture found in the query AABB.\r\n\t\t\t * @param {b2ParticleSystem} system\r\n\t\t\t * @returns false to terminate the query.\r\n\t\t\t */\r\n\t\t\tShouldQueryParticleSystem(system) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}, aabb);\r\n\r\n\t\tif (hit_fixture) {\r\n\t\t\tlet body = hit_fixture.GetBody();\r\n\t\t\tlet md = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2MouseJointDef\"]();\r\n\t\t\tmd.bodyA = this.ground.bodies[0];\r\n\t\t\tmd.bodyB = body;\r\n\t\t\tmd.target.Copy(p);\r\n\t\t\tmd.maxForce = 1000 * body.GetMass();\r\n\t\t\tthis.$_mouseJoint = this.CreateJoint(md);\r\n\t\t\tbody.SetAwake(true);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {b2Vec2} p\r\n\t */\r\n\t$_mouseUp(p) {\r\n\t\tif (this.$_mouseJoint) {\r\n\t\t\tthis.DestroyJoint(this.$_mouseJoint);\r\n\t\t\tthis.$_mouseJoint = null;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {b2Vec2} p\r\n\t */\r\n\t$_mouseMove(p) {\r\n\t\tif (this.$_mouseJoint) {\r\n\t\t\tthis.$_mouseJoint.SetTarget(p);\r\n\t\t}\r\n\t}\r\n\t\r\n\t$_onMouseEvent() {\r\n\t\tconst x = ($gv.m_viewRect.left + $gv.mouse_x) / $gv.CANVAS_SCALE;\r\n\t\tconst y = ($gv.m_viewRect.top + $gv.mouse_y) / $gv.CANVAS_SCALE;\r\n\t\tconst p = new _Physics_js__WEBPACK_IMPORTED_MODULE_0__[\"b2Vec2\"](x, y);\r\n\t\t\r\n\t\tif ($gv.mouse_dl) {\r\n\t\t\tthis.$_mouseDown(p);\r\n\t\t}\r\n\t\tif ($gv.mouse_ul) {\r\n\t\t\t$gv.mouse_ul = 0;\r\n\t\t\tthis.$_mouseUp(p);\r\n\t\t}\r\n\t\tif ($gv.mouse_move) {\r\n\t\t\t$gv.mouse_move = 0;\r\n\t\t\tthis.$_mouseMove(p);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.stop) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tthis.$_onMouseEvent();\r\n\t\t\r\n\t\tfor (let body = this.GetBodyList(); body; body = body.m_next) {\r\n\t\t\tbody.Step(stamp);\r\n\t\t}\r\n\r\n\t\tsuper.Step(1 / $gv.MAX_FPS, window.$velocityIterations, window.$positionIterations, window.$particleIterations);\r\n\t\tfor (let body = this.GetBodyList(); body; body = body.m_next) {\r\n\t\t\tbody.AfterStep(stamp);\r\n\t\t}\r\n\t\tif (this._onceAfterStep) {\r\n\t\t\tthis._onceAfterStep.forEach(f => f());\r\n\t\t\tthis._onceAfterStep.length = 0;\r\n\t\t}\r\n\t\tif (this._destryBodyList) {\r\n\t\t\tthis._destryBodyList.forEach(b => this._DestroyBody(b));\r\n\t\t\tthis._destryBodyList.length = 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trender(renderer) {\r\n\t\t/** @type {CanvasRenderingContext2D} */\r\n\t\tconst ctx = renderer.ctx;\r\n\r\n\t\t/** @type {PPlayer} */\r\n\t\tconst player = window.chara ? window.chara.$physics : this.player;\r\n\r\n\t\tif ($gv.m_display_physics_debug) {\r\n\t\t\tconst debugDraw = this.m_debugDraw;\r\n\t\t\tthis.m_debugDraw.m_ctx = ctx;\r\n\r\n\t\t\tconst w = ctx.canvas.width;\r\n\t\t\tconst h = ctx.canvas.height;\r\n\r\n\t\t\tctx.save();\r\n\t\t\t\r\n\t\t\tctx.scale(debugDraw.canvasScale, debugDraw.canvasScale);\r\n\t\t\tctx.lineWidth /= debugDraw.canvasScale;\r\n\r\n\t\t\t// apply camera\r\n\t\t\tctx.scale(debugDraw.viewZoom, debugDraw.viewZoom);\r\n\t\t\tctx.lineWidth /= debugDraw.viewZoom;\r\n\r\n\t\t\tthis.DrawDebugData();\r\n\r\n\t\t\t//display player's front\r\n\t\t\tif (player && player.body) {\r\n\t\t\t\tconst pos = player.getPosition();\r\n\t\t\t\tctx.fillStyle = \"#F00A\";\r\n\t\t\t\t\r\n\t\t\t\t//test debugDraw.canvasScale\r\n\t\t\t\tif (player.state.front > 0) {\r\n\t\t\t\t\tctx.fillRect(pos.x, pos.y, 1, 1);\r\n\t\t\t\t}\r\n\t\t\t\telse if (player.state.front < 0) {\r\n\t\t\t\t\tctx.fillRect(pos.x - 1, pos.y, 1, 1);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tctx.fillRect(pos.x - 0.5, pos.y, 1, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\r\n\t\tif ($gv.m_display_particleSystem) {\r\n\t\t\tif (renderer.gl) {\r\n\t\t\t\t/** @type {WebGLRenderingContext} */\r\n\t\t\t\tconst gl = this.gl;\r\n\r\n\t\t\t\tif (!this.$vbo_ps) {\r\n\t\t\t\t\tlet vbo = gl.createBuffer();\r\n\r\n\t\t\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, vbo);\r\n\r\n\t\t\t\t\tconst count = this.m_particleSystem.GetParticleCount();\r\n\t\t\t\t\tconst buf = this.m_particleSystem.GetPositionBuffer();\r\n\r\n\t\t\t\t\tlet vertices = new Float32Array(count * 2);\r\n\r\n\t\t\t\t\tfor (let i = 0; i < count; i += 2) {\r\n\t\t\t\t\t\tvertices[i + 0] = buf[i].x;\r\n\t\t\t\t\t\tvertices[i + 1] = buf[i].y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\r\n\t\t\t\t\tthis.$vbo_ps = vbo;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconst count = this.m_particleSystem.GetParticleCount();\r\n\t\t\t\t\tconst buf = this.m_particleSystem.GetPositionBuffer();\r\n\r\n\t\t\t\t\tlet vertices = new Float32Array(count * 2);\r\n\r\n\t\t\t\t\tfor (let i = 0; i < count; i += 2) {\r\n\t\t\t\t\t\tvertices[i + 0] = buf[i].x;\r\n\t\t\t\t\t\tvertices[i + 1] = buf[i].y;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tgl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let group = this.m_particleSystem.m_groupList; group; group = group.m_next) {\r\n\t\t\t\t\tlet particleCount = group.GetParticleCount();\r\n\t\t\t\t\tlet instanceOffset = group.GetBufferIndex();\r\n\t\t\t\t\tgl.drawArrays(gl.POINTS, instanceOffset, particleCount);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (ctx) {\r\n\t\t\t\tif ($gv.func) {\r\n\t\t\t\t\t$gv.func.call(this, ctx, renderer);\r\n\t\t\t\t\t//$gv.func = function (ctx) {\r\n\t\t\t\t\t//\tctx = ctx || $engine.ctx;\r\n\t\t\t\t\t//\tconst vertices = this.m_particleSystem.m_positionBuffer.data;\r\n\t\t\t\t\t//\tconst colorBuffer = this.m_particleSystem.m_colorBuffer.data;\r\n\t\t\t\t\t//\tconst weightBuffer = this.m_particleSystem.m_weightBuffer;\r\n\t\t\t\t\t//\r\n\t\t\t\t\t//\tlet minWeight = Math.min.apply(this, weightBuffer.slice(0, 128));\r\n\t\t\t\t\t//\tlet maxWeight = Math.max.apply(this, weightBuffer.slice(0, 128)) - minWeight;\r\n\t\t\t\t\t//\r\n\t\t\t\t\t//\tif (vertices.length > 2) {\r\n\t\t\t\t\t//\t\tlet length = vertices.length / 2;\r\n\t\t\t\t\t//\r\n\t\t\t\t\t//\t\tctx.fillStyle = \"#0747\";\r\n\t\t\t\t\t//\r\n\t\t\t\t\t//\t\tfor (let i = 0; i < length - 2; i += 1) {\r\n\t\t\t\t\t//\t\t\tctx.beginPath();\r\n\t\t\t\t\t//\t\t\tctx.moveTo(vertices[i + 0].x * $gv.CANVAS_SCALE, vertices[i + 0].y * $gv.CANVAS_SCALE);\r\n\t\t\t\t\t//\t\t\tctx.lineTo(vertices[i + 1].x * $gv.CANVAS_SCALE, vertices[i + 1].y * $gv.CANVAS_SCALE);\r\n\t\t\t\t\t//\t\t\tctx.lineTo(vertices[i + 2].x * $gv.CANVAS_SCALE, vertices[i + 2].y * $gv.CANVAS_SCALE);\r\n\t\t\t\t\t//\t\t\tctx.fillStyle = `hsla(87deg,${(weightBuffer[i] / maxWeight * 100).toFixed(0)}%,${(weightBuffer[i] / maxWeight * 50).toFixed(0)}%,${(weightBuffer[i] / maxWeight / 2).toFixed(2)})`\r\n\t\t\t\t\t//\t\t\t//ctx.fillStyle = colorBuffer[i].MakeStyleString();\r\n\t\t\t\t\t//\t\t\tctx.fill();\r\n\t\t\t\t\t//\t\t}\r\n\t\t\t\t\t//\t}\r\n\t\t\t\t\t//}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconst vertices = this.m_particleSystem.m_positionBuffer.data;\r\n\t\t\t\t\tconst colorBuffer = this.m_particleSystem.m_colorBuffer.data;\r\n\t\t\t\t\tconst weightBuffer = this.m_particleSystem.m_weightBuffer.data;\r\n\r\n\t\t\t\t\trenderer.pushMatrix();\r\n\r\n\t\t\t\t\tconst r = window.$particleRadius;\r\n\t\t\t\t\tconst r2 = r * 2;\r\n\r\n\t\t\t\t\tif (!this.$particle_grd) {\r\n\t\t\t\t\t\tlet grd = ctx.createRadialGradient(r, r, 0, r, r, r2);\r\n\t\t\t\t\t\tgrd.addColorStop(0, \"#0744\");\r\n\t\t\t\t\t\tgrd.addColorStop(1, \"#07440\");\r\n\t\t\t\t\t\tthis.$particle_grd = grd;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor (let group = this.m_particleSystem.m_groupList; group; group = group.m_next) {\r\n\t\t\t\t\t\tfor (let i = group.m_firstIndex; i < group.m_lastIndex; ++i) {\r\n\t\t\t\t\t\t\tlet x1 = vertices[i].x * $gv.CANVAS_SCALE - r;\r\n\t\t\t\t\t\t\tlet y1 = vertices[i].y * $gv.CANVAS_SCALE - r;\r\n\r\n\t\t\t\t\t\t\trenderer.setTransform(1, 0, 0, 1, $gv.m_viewRect.left + x1, $gv.m_viewRect.top + y1);\r\n\r\n\t\t\t\t\t\t\tctx.beginPath();\r\n\r\n\t\t\t\t\t\t\t//texture\r\n\r\n\t\t\t\t\t\t\t//ctx.arc(0, 0, r2, 0, 2 * Math.PI);\r\n\t\t\t\t\t\t\t//ctx.fillStyle = this.$particle_grd;\r\n\t\t\t\t\t\t\t//ctx.fill();\r\n\r\n\t\t\t\t\t\t\tctx.fillStyle = this.$particle_grd;\r\n\t\t\t\t\t\t\tctx.fillRect(r, r, r2 * 2, r2 * 2);\r\n\r\n\t\t\t\t\t\t\t//center\r\n\t\t\t\t\t\t\t//ctx.fillStyle = \"red\";\r\n\t\t\t\t\t\t\t//ctx.fillRect(0, 0, 1, 1);\r\n\r\n\t\t\t\t\t\t\t//border\r\n\t\t\t\t\t\t\t//ctx.strokeRect(-r, -r, r2, r2);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\trenderer.popMatrix();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tif ($gv.m_display_foothold) {\r\n\t\t\tctx.save();\r\n\t\t\tthis.ground.$drawDebugInfo(renderer);\r\n\t\t\tif (player && player._foothold) {\r\n\t\t\t\tplayer._foothold.$drawDebugInfo2(renderer, \"#FF0\");\r\n\t\t\t}\r\n\r\n\t\t\tlet $foothold, $ladderRope;\r\n\t\t\tif (player) {\r\n\t\t\t\t$foothold = player.$foothold;\r\n\t\t\t\t$ladderRope = player.ladder;\r\n\t\t\t}\r\n\t\t\tif ($foothold && this.draw_foothold_path_count) {\r\n\t\t\t\t$foothold.$drawDebugInfo2(renderer, \"#F00\");\r\n\r\n\t\t\t\t//draw path\r\n\t\t\t\tlet count = this.draw_foothold_path_count;\r\n\t\t\t\tctx.lineWidth = 2.5;\r\n\t\t\t\tctx.strokeStyle = \"#00FE\";\r\n\t\t\t\tif (player.state.front > 0) {\r\n\t\t\t\t\t$foothold = this.ground.footholds[$foothold.next];\r\n\t\t\t\t\tfor (; $foothold; $foothold = this.ground.footholds[$foothold.next]) {\r\n\t\t\t\t\t\t$foothold._drawLine(ctx);\r\n\t\t\t\t\t\tif ((--count) <= 0) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if (player.state.front < 0) {\r\n\t\t\t\t\t$foothold = this.ground.footholds[$foothold.prev];\r\n\t\t\t\t\tfor (; $foothold; $foothold = this.ground.footholds[$foothold.prev]) {\r\n\t\t\t\t\t\t$foothold._drawLine(ctx);\r\n\t\t\t\t\t\tif ((--count) <= 0) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.ladderRope.forEach(lr => {\r\n\t\t\t\tconst width = lr.calcWidth();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.rect(lr.x - width * 0.5, lr.y1, width, lr.y2 - lr.y1);\r\n\t\t\t\tctx.fillStyle = lr == $ladderRope ? \"#E117\":\"#EB17\";\r\n\t\t\t\tctx.fill();\r\n\t\t\t});\r\n\r\n\t\t\tctx.restore();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * https://github.com/google/LiquidFunPaint/blob/develop/src/com/google/fpl/liquidfunpaint/ParticleRenderer.java#L43\r\n * Renderer to draw particle water, objects, and wall. It draws particles as\r\n * fluid (or objects) by following three steps:\r\n * 1) Draws particles to a texture\r\n * 2) Blurs it out\r\n * 3) Applies threshold.\r\n */\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9QaHlzaWNzL1dvcmxkLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUGh5c2ljcy9Xb3JsZC5qcz8xOTg3Il0sInNvdXJjZXNDb250ZW50IjpbIu+7v1xyXG5pbXBvcnQge1xyXG5cdGIyVmVjMiwgYjJBQUJCLFxyXG5cdGIyV29ybGQsXHJcblx0YjJCb2R5LFxyXG5cdGIyQm9keVR5cGUsIGIyQm9keURlZiwgYjJGaXh0dXJlRGVmLFxyXG5cdGIyRWRnZVNoYXBlLCBiMlBvbHlnb25TaGFwZSwgYjJDaXJjbGVTaGFwZSxcclxuXHRiMk1vdXNlSm9pbnREZWYsXHJcblx0YjJDb250YWN0TGlzdGVuZXIsIGIyQ29udGFjdCxcclxuXHRiMlBhcnRpY2xlU3lzdGVtRGVmLCBiMlBhcnRpY2xlU3lzdGVtLCBiMlBhcnRpY2xlRmxhZywgYjJQYXJ0aWNsZUdyb3VwRGVmXHJcbn0gZnJvbSBcIi4vUGh5c2ljcy5qc1wiO1xyXG5cclxuaW1wb3J0IERlYnVnRHJhdyBmcm9tIFwiLi9EZWJ1Z0RyYXcuanNcIjtcclxuaW1wb3J0IHsgR3JvdW5kIH0gZnJvbSBcIi4vR3JvdW5kLmpzXCI7XHJcbmltcG9ydCB7IExhZGRlclJvcGUsIE1hcExhZGRlclJvcGVMb2FkZXIgfSBmcm9tIFwiLi9MYWRkZXJSb3BlLmpzXCI7XHJcbmltcG9ydCB7IFBQbGF5ZXIsIFBSZW1vdGVDaGFyYWN0ZXIgfSBmcm9tIFwiLi9QUGxheWVyLmpzXCI7XHJcbmltcG9ydCB7IFBNb2IgfSBmcm9tIFwiLi9QTW9iLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBDaGFyYWN0ZXJBbmltYXRpb25CYXNlIH0gZnJvbSBcIi4uL1JlbmRlcmVyL0NoYXJhY3RlclJlbmRlcmVyXCI7XHJcblxyXG5pbXBvcnQgeyBJUmVuZGVyZXIgfSBmcm9tIFwiLi4vSVJlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IEZpbHRlckhlbHBlciB9IGZyb20gXCIuL0ZpbHRlci5qc1wiO1xyXG5cclxuXHJcbndpbmRvdy4kZ3Jhdml0eUFjYyA9IDIwMDA7XHJcblxyXG53aW5kb3cuJHBvc2l0aW9uSXRlcmF0aW9ucyA9IDM7XHJcbndpbmRvdy4kdmVsb2NpdHlJdGVyYXRpb25zID0gODtcclxud2luZG93LiRwYXJ0aWNsZUl0ZXJhdGlvbnMgPSAxO1xyXG5cclxud2luZG93LiRwYXJ0aWNsZVJhZGl1cyA9IDEwOy8vdW5pdCBpcyBwaXhlbFxyXG5cclxuZXhwb3J0IGNvbnN0IEdSQVZJVFkgPSBuZXcgYjJWZWMyKDAsIHdpbmRvdy4kZ3Jhdml0eUFjYyAvICRndi5DQU5WQVNfU0NBTEUpO1xyXG5cclxuXHJcbmNsYXNzIENvbnRhY3RMaXN0ZW5lciBleHRlbmRzIGIyQ29udGFjdExpc3RlbmVyIHtcclxuXHQvKiogQHBhcmFtIHtiMkNvbnRhY3R9IGNvbnRhY3QgKi9cclxuXHRCZWdpbkNvbnRhY3QoY29udGFjdCkge1xyXG5cdFx0Y29uc3QgZmEgPSBjb250YWN0Lm1fZml4dHVyZUE7XHJcblx0XHRjb25zdCBmYiA9IGNvbnRhY3QubV9maXh0dXJlQjtcclxuXHRcdGNvbnN0IGNoaWxkSW5kZXhBID0gY29udGFjdC5tX2luZGV4QTtcclxuXHRcdGNvbnN0IGNoaWxkSW5kZXhCID0gY29udGFjdC5tX2luZGV4QjtcclxuXHJcblx0XHRmYS5iZWdpbkNvbnRhY3QuY2FsbChmYS5tX3VzZXJEYXRhLCBjb250YWN0LCBmYSwgZmIsIGNoaWxkSW5kZXhBLCBjaGlsZEluZGV4Qik7XHJcblx0XHRmYi5iZWdpbkNvbnRhY3QuY2FsbChmYi5tX3VzZXJEYXRhLCBjb250YWN0LCBmYiwgZmEsIGNoaWxkSW5kZXhCLCBjaGlsZEluZGV4QSk7XHJcblx0fVxyXG5cdC8qKiBAcGFyYW0ge2IyQ29udGFjdH0gY29udGFjdCAqL1xyXG5cdEVuZENvbnRhY3QoY29udGFjdCkge1xyXG5cdFx0Y29uc3QgZmEgPSBjb250YWN0Lm1fZml4dHVyZUE7XHJcblx0XHRjb25zdCBmYiA9IGNvbnRhY3QubV9maXh0dXJlQjtcclxuXHRcdGNvbnN0IGNoaWxkSW5kZXhBID0gY29udGFjdC5tX2luZGV4QTtcclxuXHRcdGNvbnN0IGNoaWxkSW5kZXhCID0gY29udGFjdC5tX2luZGV4QjtcclxuXHJcblx0XHRmYS5lbmRDb250YWN0LmNhbGwoZmEubV91c2VyRGF0YSwgY29udGFjdCwgZmEsIGZiLCBjaGlsZEluZGV4QSwgY2hpbGRJbmRleEIpO1xyXG5cdFx0ZmIuZW5kQ29udGFjdC5jYWxsKGZiLm1fdXNlckRhdGEsIGNvbnRhY3QsIGZiLCBmYSwgY2hpbGRJbmRleEIsIGNoaWxkSW5kZXhBKTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtiMkNvbnRhY3R9IGNvbnRhY3RcclxuXHQgKiBAcGFyYW0ge2IyTWFuaWZvbGR9IG9sZE1hbmlmb2xkXHJcblx0ICovXHJcblx0UHJlU29sdmUoY29udGFjdCwgb2xkTWFuaWZvbGQpIHtcclxuXHRcdGNvbnN0IGZhID0gY29udGFjdC5tX2ZpeHR1cmVBO1xyXG5cdFx0Y29uc3QgZmIgPSBjb250YWN0Lm1fZml4dHVyZUI7XHJcblx0XHRjb25zdCBjaGlsZEluZGV4QSA9IGNvbnRhY3QubV9pbmRleEE7XHJcblx0XHRjb25zdCBjaGlsZEluZGV4QiA9IGNvbnRhY3QubV9pbmRleEI7XHJcblxyXG5cdFx0ZmEucHJlU29sdmUuY2FsbChmYS5tX3VzZXJEYXRhLCBjb250YWN0LCBvbGRNYW5pZm9sZCwgZmEsIGZiLCBjaGlsZEluZGV4QSwgY2hpbGRJbmRleEIpO1xyXG5cdFx0ZmIucHJlU29sdmUuY2FsbChmYi5tX3VzZXJEYXRhLCBjb250YWN0LCBvbGRNYW5pZm9sZCwgZmIsIGZhLCBjaGlsZEluZGV4QiwgY2hpbGRJbmRleEEpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyQ29udGFjdH0gY29udGFjdFxyXG5cdCAqIEBwYXJhbSB7YjJDb250YWN0SW1wdWxzZX0gaW1wdWxzZVxyXG5cdCAqL1xyXG5cdFBvc3RTb2x2ZShjb250YWN0LCBpbXB1bHNlKSB7XHJcblx0XHRjb25zdCBmYSA9IGNvbnRhY3QubV9maXh0dXJlQTtcclxuXHRcdGNvbnN0IGZiID0gY29udGFjdC5tX2ZpeHR1cmVCO1xyXG5cdFx0Y29uc3QgY2hpbGRJbmRleEEgPSBjb250YWN0Lm1faW5kZXhBO1xyXG5cdFx0Y29uc3QgY2hpbGRJbmRleEIgPSBjb250YWN0Lm1faW5kZXhCO1xyXG5cclxuXHRcdGZhLnBvc3RTb2x2ZS5jYWxsKGZhLm1fdXNlckRhdGEsIGNvbnRhY3QsIGltcHVsc2UsIGZhLCBmYiwgY2hpbGRJbmRleEEsIGNoaWxkSW5kZXhCKTtcclxuXHRcdGZiLnBvc3RTb2x2ZS5jYWxsKGZiLm1fdXNlckRhdGEsIGNvbnRhY3QsIGltcHVsc2UsIGZiLCBmYSwgY2hpbGRJbmRleEIsIGNoaWxkSW5kZXhBKTtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBXb3JsZCBleHRlbmRzIGIyV29ybGQge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoR1JBVklUWSk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtEZWJ1Z0RyYXd9ICovXHJcblx0XHR0aGlzLm1fZGVidWdEcmF3ID0gJGd2Lm1fZGVidWdEcmF3O1xyXG5cdFx0dGhpcy5TZXREZWJ1Z0RyYXcodGhpcy5tX2RlYnVnRHJhdyk7XHJcblxyXG5cdFx0dGhpcy5TZXRDb250YWN0TGlzdGVuZXIobmV3IENvbnRhY3RMaXN0ZW5lcigpKTtcclxuXHJcblx0XHQvL2lmICghd2luZG93LiRpbykge1xyXG5cdFx0Ly9cdHRoaXMucGxheWVyID0gbnVsbDtcclxuXHRcdC8vXHR0aGlzLl9wbGF5ZXJfcmViaXJ0aCgpO1xyXG5cdFx0Ly9cdHRoaXMucGxheWVyLnNldFBvc2l0aW9uKDAsIDAsIHRydWUpO1xyXG5cdFx0Ly99XHJcblxyXG5cdFx0dGhpcy5ncm91bmQgPSBuZXcgR3JvdW5kKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtMYWRkZXJSb3BlW119ICovXHJcblx0XHR0aGlzLmxhZGRlclJvcGUgPSBbXTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtiMkJvZHl9ICovXHJcblx0XHR0aGlzLm1hcEJvdW5kX2JvZHkgPSBudWxsO1xyXG5cdFx0XHJcblx0XHR0aGlzLnN0b3AgPSBmYWxzZTtcclxuXHRcdFxyXG5cdFx0dGhpcy4kX21vdXNlSm9pbnQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7KGZ1bmN0aW9uKCk6dm9pZClbXX0gKi9cclxuXHRcdHRoaXMuX29uY2VBZnRlclN0ZXAgPSBbXTtcclxuXHJcblx0XHQvKiogQHR5cGUge2IyQm9keVtdfSAqL1xyXG5cdFx0dGhpcy5fZGVzdHJ5Qm9keUxpc3QgPSBbXTtcclxuXHJcblx0XHR0aGlzLl9EZXN0cm95Qm9keSA9IHRoaXMuRGVzdHJveUJvZHk7XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBAcGFyYW0ge2IyQm9keX0gYlxyXG5cdFx0ICovXHJcblx0XHR0aGlzLkRlc3Ryb3lCb2R5ID0gYiA9PiB7XHJcblx0XHRcdGlmICh0aGlzLm1fbG9ja2VkKSB7XHJcblx0XHRcdFx0dGhpcy5fZGVzdHJ5Qm9keUxpc3QucHVzaChiKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9EZXN0cm95Qm9keShiKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuZHJhd19mb290aG9sZF9wYXRoX2NvdW50ID0gMTtcclxuXHR9XHJcblxyXG5cdCR0ZXN0X2IyUGFydGljbGVTeXN0ZW0oKSB7XHJcblx0XHRjb25zdCBwYXJ0aWNsZVR5cGUgPSBiMlBhcnRpY2xlRmxhZy5iMl9lbGFzdGljUGFydGljbGU7Ly9iMl93YXRlclBhcnRpY2xlO1xyXG5cdFx0Y29uc3QgcGFydGljbGVTeXN0ZW1EZWYgPSBuZXcgYjJQYXJ0aWNsZVN5c3RlbURlZigpO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge2IyUGFydGljbGVTeXN0ZW19ICovXHJcblx0XHR0aGlzLm1fcGFydGljbGVTeXN0ZW0gPSB0aGlzLkNyZWF0ZVBhcnRpY2xlU3lzdGVtKHBhcnRpY2xlU3lzdGVtRGVmKTtcclxuXHRcdFxyXG5cdFx0dGhpcy5tX3BhcnRpY2xlU3lzdGVtLlNldEdyYXZpdHlTY2FsZSgwKTtcclxuXHRcdHRoaXMubV9wYXJ0aWNsZVN5c3RlbS5TZXRSYWRpdXMoMTAgLyAkZ3YuQ0FOVkFTX1NDQUxFKTtcclxuXHRcdHRoaXMubV9wYXJ0aWNsZVN5c3RlbS5TZXREYW1waW5nKDAuMik7XHJcblx0XHR7XHJcblx0XHRcdGNvbnN0IHNoYXBlID0gbmV3IGIyQ2lyY2xlU2hhcGUoKTtcclxuXHRcdFx0c2hhcGUubV9wLlNldCgwLCAyKTtcclxuXHRcdFx0c2hhcGUubV9yYWRpdXMgPSAzO1xyXG5cdFx0XHRjb25zdCBwZCA9IG5ldyBiMlBhcnRpY2xlR3JvdXBEZWYoKTtcclxuXHRcdFx0cGQuZmxhZ3MgPSBwYXJ0aWNsZVR5cGU7XHJcblx0XHRcdHBkLnNoYXBlID0gc2hhcGU7XHJcblx0XHRcdGNvbnN0IGdyb3VwID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLkNyZWF0ZVBhcnRpY2xlR3JvdXAocGQpO1xyXG5cdFx0XHRpZiAocGQuZmxhZ3MgJiBiMlBhcnRpY2xlRmxhZy5iMl9jb2xvck1peGluZ1BhcnRpY2xlKSB7XHJcblx0XHRcdFx0dGhpcy5Db2xvclBhcnRpY2xlR3JvdXAoZ3JvdXAsIDApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR3aW5kb3cubV9wYXJ0aWNsZVN5c3RlbSA9IHRoaXMubV9wYXJ0aWNsZVN5c3RlbTtcclxuXHRcdFxyXG5cdFx0dGhpcy4kdmJvX3BzID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGFmdGVyIGxvYWQgbWFwXHJcblx0ICovXHJcblx0YXN5bmMgbG9hZChtYXBfcmF3X2RhdGEpIHtcclxuXHRcdHRoaXMuZ3JvdW5kLmxvYWQobWFwX3Jhd19kYXRhLCB0aGlzKTtcclxuXHRcdHRoaXMubGFkZGVyUm9wZSA9IE1hcExhZGRlclJvcGVMb2FkZXIubG9hZChtYXBfcmF3X2RhdGEsIHRoaXMpO1xyXG5cdH1cclxuXHR1bmxvYWQoKSB7XHJcblx0XHRpZiAodGhpcy5Jc0xvY2tlZCgpKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKFwid29ybGQgaXMgbG9ja2VkLCB3b3JsZCBjYW4gbm90IHVubG9hZFwiKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLmdyb3VuZC51bmxvYWQodGhpcyk7XHJcblx0XHRcdHRoaXMubGFkZGVyUm9wZS5sZW5ndGggPSAwO1xyXG5cdFx0XHR0aGlzLkRlc3Ryb3lCb2R5KHRoaXMubWFwQm91bmRfYm9keSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7TWFwTW9ifSBtYXBNb2JcclxuXHQgKi9cclxuXHRjcmVhdGVNb2IobWFwTW9iKSB7XHJcblx0XHRsZXQgbW9iID0gbmV3IFBNb2IobWFwTW9iKTtcclxuXHRcdG1vYi5fY3JlYXRlKHRoaXMpO1xyXG5cdFx0cmV0dXJuIG1vYjtcclxuXHR9XHJcblx0ZGVzdHJveU1vYihtYXBNb2IpIHtcclxuXHRcdC8vaWYgKHRoaXMgIT0gbWFwTW9iLiRwaHlzaWNzKSB7XHJcblx0XHQvL1x0ZGVidWdnZXI7XHJcblx0XHQvL1x0cmV0dXJuIGZhbHNlO1xyXG5cdFx0Ly99XHJcblx0XHRcclxuXHRcdG1hcE1vYi4kcGh5c2ljcy5fZGVzdHJveSh0aGlzKTtcclxuXHRcdG1hcE1vYi4kcGh5c2ljcyA9IG51bGw7XHJcblx0XHRcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHRcclxuXHRjcmVhdGVOcGMobWFwTnBjKSB7XHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9XHJcblx0ZGVzdHJveU5wYyhtYXBOcGMpIHtcclxuXHRcdHJldHVybiBmYWxzZTtcclxuXHR9XHJcblx0XHJcblx0Y3JlYXRlUG9ydGFsKHBvcnRhbCkge1xyXG5cdFx0Y29uc3QgcmVjdCA9IHBvcnRhbC5jb21wdXRlX3JlY3RhbmdsZSgwKTtcclxuXHRcdGlmIChyZWN0KSB7XHJcblx0XHRcdGNvbnN0IHdpZHRoID0gcmVjdC53aWR0aCAvIDIgLyAkZ3YuQ0FOVkFTX1NDQUxFICogMC40O1xyXG5cdFx0XHRjb25zdCBoZWlnaHQgPSByZWN0LmhlaWdodCAvIDIgLyAkZ3YuQ0FOVkFTX1NDQUxFICogMC4yO1xyXG5cclxuXHRcdFx0bGV0IGJkZWYgPSBuZXcgYjJCb2R5RGVmKCk7XHJcblx0XHRcdGxldCBmZGVmID0gbmV3IGIyRml4dHVyZURlZigpO1xyXG5cdFx0XHRsZXQgc2hhcGU7XHJcblxyXG5cdFx0XHRmZGVmLmZpbHRlci5Db3B5KEZpbHRlckhlbHBlci5nZXQoXCJwb3J0YWxcIikpO1xyXG5cclxuXHRcdFx0YmRlZi51c2VyRGF0YSA9IHBvcnRhbDtcclxuXHRcdFx0YmRlZi50eXBlID0gYjJCb2R5VHlwZS5iMl9zdGF0aWNCb2R5Oy8vYjJfc3RhdGljQm9keS8vYjJfa2luZW1hdGljQm9keS8vYjJfZHluYW1pY0JvZHlcclxuXHRcdFx0YmRlZi5wb3NpdGlvbi5TZXQoXHJcblx0XHRcdFx0cG9ydGFsLnggLyAkZ3YuQ0FOVkFTX1NDQUxFLFxyXG5cdFx0XHRcdHBvcnRhbC55IC8gJGd2LkNBTlZBU19TQ0FMRSk7XHJcblxyXG5cdFx0XHRsZXQgYm9keSA9IHRoaXMuQ3JlYXRlQm9keShiZGVmKTtcclxuXHRcdFx0Ym9keS4kdHlwZSA9IFwicG9ydGFsXCI7XHJcblxyXG5cdFx0XHRzaGFwZSA9IG5ldyBiMlBvbHlnb25TaGFwZSgpO1xyXG5cclxuXHRcdFx0aWYgKHdpbmRvdy5NQVBfUE9SVEFMX0ZVTExfU0laRSkge1xyXG5cdFx0XHRcdHNoYXBlLlNldEFzQm94KFxyXG5cdFx0XHRcdFx0cmVjdC53aWR0aCAvIDIgLyAkZ3YuQ0FOVkFTX1NDQUxFLFxyXG5cdFx0XHRcdFx0cmVjdC5oZWlnaHQgLyAyIC8gJGd2LkNBTlZBU19TQ0FMRSxcclxuXHRcdFx0XHRcdG5ldyBiMlZlYzIoLXBvcnRhbC50ZXh0dXJlc1swXS54IC8gJGd2LkNBTlZBU19TQ0FMRSwgLXBvcnRhbC50ZXh0dXJlc1swXS55IC8gJGd2LkNBTlZBU19TQ0FMRSksXHJcblx0XHRcdFx0XHQwKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRzaGFwZS5TZXRBc0JveChcclxuXHRcdFx0XHRcdHdpZHRoLFxyXG5cdFx0XHRcdFx0aGVpZ2h0LFxyXG5cdFx0XHRcdFx0bmV3IGIyVmVjMigwLCAtaGVpZ2h0KSxcclxuXHRcdFx0XHRcdDApO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRmZGVmLmlzU2Vuc29yID0gdHJ1ZTtcclxuXHRcdFx0ZmRlZi5zaGFwZSA9IHNoYXBlO1xyXG5cdFx0XHRmZGVmLmZpbHRlciA9IEZpbHRlckhlbHBlci5nZXQoXCJwb3J0YWxcIik7XHJcblx0XHRcdGZkZWYudXNlckRhdGEgPSBwb3J0YWw7XHJcblx0XHRcdGZkZWYuJHR5cGUgPSBcInBvcnRhbFwiO1xyXG5cclxuXHRcdFx0bGV0IGZpeHR1cmUgPSBib2R5LkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblxyXG5cdFx0XHRwb3J0YWwuYm9keSA9IGJvZHk7XHJcblxyXG5cdFx0XHRyZXR1cm4gYm9keTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtSZWN0YW5nbGV9IHJlY3RcclxuXHQgKi9cclxuXHRfY3JlYXRlTWFwQm91bmQocmVjdCkge1xyXG5cdFx0bGV0IHsgbGVmdCwgdG9wLCByaWdodCwgYm90dG9tIH0gPSByZWN0O1xyXG5cdFx0XHJcblx0XHRsZWZ0IC89ICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRyaWdodCAvPSAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0dG9wIC89ICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRib3R0b20gLz0gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdFxyXG5cdFx0bGV0IGJkZWYgPSBuZXcgYjJCb2R5RGVmKCk7XHJcblx0XHQvL2JkZWYudHlwZSA9IGIyQm9keVR5cGUuYjJfZHluYW1pY0JvZHk7XHJcblx0XHRsZXQgZmRlZiA9IG5ldyBiMkZpeHR1cmVEZWYoKTtcclxuXHRcdGxldCBzaGFwZSA9IG5ldyBiMkVkZ2VTaGFwZSgpO1xyXG5cclxuXHRcdGZkZWYuJHR5cGUgPSBcIk1hcEJvcmRlclwiO1xyXG5cdFx0ZmRlZi5zaGFwZSA9IHNoYXBlO1xyXG5cdFx0ZmRlZi5maWx0ZXIuQ29weShGaWx0ZXJIZWxwZXIuZ2V0KFwibWFwX2JvcmRlclwiKSk7XHJcblxyXG5cdFx0bGV0IGJiID0gdGhpcy5DcmVhdGVCb2R5KGJkZWYpO1xyXG5cdFx0YmIuJHR5cGUgPSBcIk1hcEJvcmRlclwiO1xyXG5cdFx0XHJcblx0XHRzaGFwZS5tX3ZlcnRleDEuU2V0KGxlZnQsIHRvcCk7XHJcblx0XHRzaGFwZS5tX3ZlcnRleDIuU2V0KHJpZ2h0LCB0b3ApO1xyXG5cdFx0YmIuQ3JlYXRlRml4dHVyZShmZGVmKTtcclxuXHRcdFxyXG5cdFx0c2hhcGUubV92ZXJ0ZXgxLlNldChsZWZ0LCBib3R0b20pO1xyXG5cdFx0c2hhcGUubV92ZXJ0ZXgyLlNldChyaWdodCwgYm90dG9tKTtcclxuXHRcdGJiLkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblx0XHRcclxuXHRcdHNoYXBlLm1fdmVydGV4MS5TZXQobGVmdCwgdG9wKTtcclxuXHRcdHNoYXBlLm1fdmVydGV4Mi5TZXQobGVmdCwgYm90dG9tKTtcclxuXHRcdGJiLkNyZWF0ZUZpeHR1cmUoZmRlZik7XHJcblxyXG5cdFx0c2hhcGUubV92ZXJ0ZXgxLlNldChyaWdodCwgdG9wKTtcclxuXHRcdHNoYXBlLm1fdmVydGV4Mi5TZXQocmlnaHQsIGJvdHRvbSk7XHJcblx0XHRiYi5DcmVhdGVGaXh0dXJlKGZkZWYpO1xyXG5cdFx0XHJcblx0XHRpZiAodGhpcy5wbGF5ZXIpIHtcclxuXHRcdFx0dGhpcy5wbGF5ZXIuc2V0UG9zaXRpb24oKHJpZ2h0ICsgbGVmdCkgKiAwLjUsIChib3R0b20gKyB0b3ApICogMC41LCB0cnVlKTtcclxuXHRcdH1cclxuXHJcblx0XHR0aGlzLm1hcEJvdW5kX2JvZHkgPSBiYjtcclxuXHR9XHJcblxyXG5cdC8vX3BsYXllcl9yZWJpcnRoKCkge1xyXG5cdC8vXHR3aW5kb3cuJHBsYXllciA9IHRoaXMucGxheWVyID0gbmV3IFBQbGF5ZXIod2luZG93LmNoYXJhID8gd2luZG93LmNoYXJhLnJlbmRlcmVyOm51bGwpO1xyXG5cdC8vXHR0aGlzLnBsYXllci5fY3JlYXRlKHRoaXMpO1xyXG5cdC8vXHJcblx0Ly9cdGRlbGV0ZSB0aGlzLnBsYXllci5yZW5kZXJlcjtcclxuXHQvL1x0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMucGxheWVyLCBcInJlbmRlcmVyXCIsIHtcclxuXHQvL1x0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHQvL1x0XHRcdHJldHVybiB3aW5kb3cuY2hhcmEgPyB3aW5kb3cuY2hhcmEucmVuZGVyZXIgOiBudWxsO1xyXG5cdC8vXHRcdH1cclxuXHQvL1x0fSk7XHJcblx0Ly99XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7U2NlbmVPYmplY3R9IHNjZW5lT2JqZWN0XHJcblx0ICogQHBhcmFtIHtDaGFyYWN0ZXJBbmltYXRpb25CYXNlfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdCRjcmVhdGVQbGF5ZXIoc2NlbmVPYmplY3QsIHJlbmRlcmVyKSB7XHJcblx0XHRpZiAoIXNjZW5lT2JqZWN0IHx8ICFyZW5kZXJlcikge1xyXG5cdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0YWxlcnQoXCIkY3JlYXRlUGxheWVyKHNjZW5lT2JqZWN0LCByZW5kZXJlcilcIik7XHJcblx0XHR9XHJcblx0XHRsZXQgcGxheWVyID0gbmV3IFBQbGF5ZXIoKTtcclxuXHJcblx0XHRwbGF5ZXIuX2NyZWF0ZSh0aGlzKTtcclxuXHJcblx0XHQvL2luaXQgP1xyXG5cdFx0cGxheWVyLmNoYXJhID0gc2NlbmVPYmplY3Q7XHJcblx0XHRwbGF5ZXIucmVuZGVyZXIgPSByZW5kZXJlcjsvLz8/XHJcblxyXG5cdFx0dGhpcy5wbGF5ZXIgPSBwbGF5ZXI7XHJcblxyXG5cdFx0cmV0dXJuIHBsYXllcjtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtTY2VuZU9iamVjdH0gc2NlbmVPYmplY3RcclxuXHQgKiBAcGFyYW0ge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0JGNyZWF0ZVJlbW90ZVBsYXllcihzY2VuZU9iamVjdCwgcmVuZGVyZXIpIHtcclxuXHRcdGlmICghc2NlbmVPYmplY3QgfHwgIXJlbmRlcmVyKSB7XHJcblx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRhbGVydChcIiRjcmVhdGVSZW1vdGVQbGF5ZXIoc2NlbmVPYmplY3QsIHJlbmRlcmVyKVwiKTtcclxuXHRcdH1cclxuXHRcdGxldCBwbGF5ZXIgPSBuZXcgUFJlbW90ZUNoYXJhY3RlcigpO1xyXG5cclxuXHRcdHBsYXllci5fY3JlYXRlKHRoaXMpO1xyXG5cclxuXHRcdC8vaW5pdCA/XHJcblx0XHRwbGF5ZXIucmVuZGVyZXIgPSByZW5kZXJlcjtcclxuXHJcblx0XHRyZXR1cm4gcGxheWVyO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtmdW5jdGlvbigpOnZvaWR9IGZ1bmNcclxuXHQgKi9cclxuXHRvbmNlVW5sb2NrKGZ1bmMpIHtcclxuXHRcdGlmICh0aGlzLm1fbG9ja2VkKSB7XHJcblx0XHRcdHRoaXMuX29uY2VBZnRlclN0ZXAucHVzaChmdW5jKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRmdW5jKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBkbyBvbmNlIEFmdGVyU3RlcFxyXG5cdCAqIEBwYXJhbSB7ZnVuY3Rpb24oKTp2b2lkfSBmdW5jXHJcblx0ICovXHJcblx0ZG9BZnRlclN0ZXAoZnVuYykge1xyXG5cdFx0dGhpcy5fb25jZUFmdGVyU3RlcC5wdXNoKGZ1bmMpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gcFxyXG5cdCAqL1xyXG5cdCRfbW91c2VEb3duKHApIHtcclxuXHRcdGlmICh0aGlzLiRfbW91c2VKb2ludCAhPSBudWxsKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBNYWtlIGEgc21hbGwgYm94LlxyXG5cdFx0bGV0IGFhYmIgPSBuZXcgYjJBQUJCKCk7XHJcblx0XHRsZXQgZCA9IG5ldyBiMlZlYzIoKTtcclxuXHRcdGQuU2V0KDAuMDAxLCAwLjAwMSk7XHJcblx0XHRiMlZlYzIuU3ViVlYocCwgZCwgYWFiYi5sb3dlckJvdW5kKTtcclxuXHRcdGIyVmVjMi5BZGRWVihwLCBkLCBhYWJiLnVwcGVyQm91bmQpO1xyXG5cclxuXHRcdGxldCB0aGF0ID0gdGhpcztcclxuXHRcdGxldCBoaXRfZml4dHVyZSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8vIFF1ZXJ5IHRoZSB3b3JsZCBmb3Igb3ZlcmxhcHBpbmcgc2hhcGVzLlxyXG5cdFx0dGhpcy5RdWVyeUFBQkIoe1xyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogQ2FsbGVkIGZvciBlYWNoIGZpeHR1cmUgZm91bmQgaW4gdGhlIHF1ZXJ5IEFBQkIuXHJcblx0XHRcdCAqIEBwYXJhbSB7YjJGaXh0dXJlfSBmaXh0dXJlXHJcblx0XHRcdCAqIEByZXR1cm5zIGZhbHNlIHRvIHRlcm1pbmF0ZSB0aGUgcXVlcnkuXHJcblx0XHRcdCAqL1xyXG5cdFx0XHRSZXBvcnRGaXh0dXJlKGZpeHR1cmUpIHtcclxuXHRcdFx0XHRsZXQgYm9keSA9IGZpeHR1cmUuR2V0Qm9keSgpO1xyXG5cdFx0XHRcdGlmIChib2R5LkdldFR5cGUoKSAhPSBiMkJvZHlUeXBlLmIyX3N0YXRpY0JvZHkpIHtcclxuXHRcdFx0XHRcdGxldCBpbnNpZGUgPSBmaXh0dXJlLlRlc3RQb2ludChwKTtcclxuXHRcdFx0XHRcdGlmIChpbnNpZGUpIHtcclxuXHRcdFx0XHRcdFx0aGl0X2ZpeHR1cmUgPSBmaXh0dXJlO1xyXG5cclxuXHRcdFx0XHRcdFx0Ly8gV2UgYXJlIGRvbmUsIHRlcm1pbmF0ZSB0aGUgcXVlcnkuXHJcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Ly8gQ29udGludWUgdGhlIHF1ZXJ5LlxyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9LFxyXG5cdFx0XHQvKipcclxuXHRcdFx0ICogQ2FsbGVkIGZvciBlYWNoIGZpeHR1cmUgZm91bmQgaW4gdGhlIHF1ZXJ5IEFBQkIuXHJcblx0XHRcdCAqIEBwYXJhbSB7YjJQYXJ0aWNsZVN5c3RlbX0gc3lzdGVtXHJcblx0XHRcdCAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleFxyXG5cdFx0XHQgKiBAcmV0dXJucyBmYWxzZSB0byB0ZXJtaW5hdGUgdGhlIHF1ZXJ5LlxyXG5cdFx0XHQgKi9cclxuXHRcdFx0UmVwb3J0UGFydGljbGUoc3lzdGVtLCBpbmRleCkge1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fSxcclxuXHRcdFx0LyoqXHJcblx0XHRcdCAqIENhbGxlZCBmb3IgZWFjaCBmaXh0dXJlIGZvdW5kIGluIHRoZSBxdWVyeSBBQUJCLlxyXG5cdFx0XHQgKiBAcGFyYW0ge2IyUGFydGljbGVTeXN0ZW19IHN5c3RlbVxyXG5cdFx0XHQgKiBAcmV0dXJucyBmYWxzZSB0byB0ZXJtaW5hdGUgdGhlIHF1ZXJ5LlxyXG5cdFx0XHQgKi9cclxuXHRcdFx0U2hvdWxkUXVlcnlQYXJ0aWNsZVN5c3RlbShzeXN0ZW0pIHtcclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fSwgYWFiYik7XHJcblxyXG5cdFx0aWYgKGhpdF9maXh0dXJlKSB7XHJcblx0XHRcdGxldCBib2R5ID0gaGl0X2ZpeHR1cmUuR2V0Qm9keSgpO1xyXG5cdFx0XHRsZXQgbWQgPSBuZXcgYjJNb3VzZUpvaW50RGVmKCk7XHJcblx0XHRcdG1kLmJvZHlBID0gdGhpcy5ncm91bmQuYm9kaWVzWzBdO1xyXG5cdFx0XHRtZC5ib2R5QiA9IGJvZHk7XHJcblx0XHRcdG1kLnRhcmdldC5Db3B5KHApO1xyXG5cdFx0XHRtZC5tYXhGb3JjZSA9IDEwMDAgKiBib2R5LkdldE1hc3MoKTtcclxuXHRcdFx0dGhpcy4kX21vdXNlSm9pbnQgPSB0aGlzLkNyZWF0ZUpvaW50KG1kKTtcclxuXHRcdFx0Ym9keS5TZXRBd2FrZSh0cnVlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtiMlZlYzJ9IHBcclxuXHQgKi9cclxuXHQkX21vdXNlVXAocCkge1xyXG5cdFx0aWYgKHRoaXMuJF9tb3VzZUpvaW50KSB7XHJcblx0XHRcdHRoaXMuRGVzdHJveUpvaW50KHRoaXMuJF9tb3VzZUpvaW50KTtcclxuXHRcdFx0dGhpcy4kX21vdXNlSm9pbnQgPSBudWxsO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2IyVmVjMn0gcFxyXG5cdCAqL1xyXG5cdCRfbW91c2VNb3ZlKHApIHtcclxuXHRcdGlmICh0aGlzLiRfbW91c2VKb2ludCkge1xyXG5cdFx0XHR0aGlzLiRfbW91c2VKb2ludC5TZXRUYXJnZXQocCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdCRfb25Nb3VzZUV2ZW50KCkge1xyXG5cdFx0Y29uc3QgeCA9ICgkZ3YubV92aWV3UmVjdC5sZWZ0ICsgJGd2Lm1vdXNlX3gpIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdGNvbnN0IHkgPSAoJGd2Lm1fdmlld1JlY3QudG9wICsgJGd2Lm1vdXNlX3kpIC8gJGd2LkNBTlZBU19TQ0FMRTtcclxuXHRcdGNvbnN0IHAgPSBuZXcgYjJWZWMyKHgsIHkpO1xyXG5cdFx0XHJcblx0XHRpZiAoJGd2Lm1vdXNlX2RsKSB7XHJcblx0XHRcdHRoaXMuJF9tb3VzZURvd24ocCk7XHJcblx0XHR9XHJcblx0XHRpZiAoJGd2Lm1vdXNlX3VsKSB7XHJcblx0XHRcdCRndi5tb3VzZV91bCA9IDA7XHJcblx0XHRcdHRoaXMuJF9tb3VzZVVwKHApO1xyXG5cdFx0fVxyXG5cdFx0aWYgKCRndi5tb3VzZV9tb3ZlKSB7XHJcblx0XHRcdCRndi5tb3VzZV9tb3ZlID0gMDtcclxuXHRcdFx0dGhpcy4kX21vdXNlTW92ZShwKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0aWYgKHRoaXMuc3RvcCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdHRoaXMuJF9vbk1vdXNlRXZlbnQoKTtcclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgYm9keSA9IHRoaXMuR2V0Qm9keUxpc3QoKTsgYm9keTsgYm9keSA9IGJvZHkubV9uZXh0KSB7XHJcblx0XHRcdGJvZHkuU3RlcChzdGFtcCk7XHJcblx0XHR9XHJcblxyXG5cdFx0c3VwZXIuU3RlcCgxIC8gJGd2Lk1BWF9GUFMsIHdpbmRvdy4kdmVsb2NpdHlJdGVyYXRpb25zLCB3aW5kb3cuJHBvc2l0aW9uSXRlcmF0aW9ucywgd2luZG93LiRwYXJ0aWNsZUl0ZXJhdGlvbnMpO1xyXG5cdFx0Zm9yIChsZXQgYm9keSA9IHRoaXMuR2V0Qm9keUxpc3QoKTsgYm9keTsgYm9keSA9IGJvZHkubV9uZXh0KSB7XHJcblx0XHRcdGJvZHkuQWZ0ZXJTdGVwKHN0YW1wKTtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLl9vbmNlQWZ0ZXJTdGVwKSB7XHJcblx0XHRcdHRoaXMuX29uY2VBZnRlclN0ZXAuZm9yRWFjaChmID0+IGYoKSk7XHJcblx0XHRcdHRoaXMuX29uY2VBZnRlclN0ZXAubGVuZ3RoID0gMDtcclxuXHRcdH1cclxuXHRcdGlmICh0aGlzLl9kZXN0cnlCb2R5TGlzdCkge1xyXG5cdFx0XHR0aGlzLl9kZXN0cnlCb2R5TGlzdC5mb3JFYWNoKGIgPT4gdGhpcy5fRGVzdHJveUJvZHkoYikpO1xyXG5cdFx0XHR0aGlzLl9kZXN0cnlCb2R5TGlzdC5sZW5ndGggPSAwO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyKSB7XHJcblx0XHQvKiogQHR5cGUge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gKi9cclxuXHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHJcblx0XHQvKiogQHR5cGUge1BQbGF5ZXJ9ICovXHJcblx0XHRjb25zdCBwbGF5ZXIgPSB3aW5kb3cuY2hhcmEgPyB3aW5kb3cuY2hhcmEuJHBoeXNpY3MgOiB0aGlzLnBsYXllcjtcclxuXHJcblx0XHRpZiAoJGd2Lm1fZGlzcGxheV9waHlzaWNzX2RlYnVnKSB7XHJcblx0XHRcdGNvbnN0IGRlYnVnRHJhdyA9IHRoaXMubV9kZWJ1Z0RyYXc7XHJcblx0XHRcdHRoaXMubV9kZWJ1Z0RyYXcubV9jdHggPSBjdHg7XHJcblxyXG5cdFx0XHRjb25zdCB3ID0gY3R4LmNhbnZhcy53aWR0aDtcclxuXHRcdFx0Y29uc3QgaCA9IGN0eC5jYW52YXMuaGVpZ2h0O1xyXG5cclxuXHRcdFx0Y3R4LnNhdmUoKTtcclxuXHRcdFx0XHJcblx0XHRcdGN0eC5zY2FsZShkZWJ1Z0RyYXcuY2FudmFzU2NhbGUsIGRlYnVnRHJhdy5jYW52YXNTY2FsZSk7XHJcblx0XHRcdGN0eC5saW5lV2lkdGggLz0gZGVidWdEcmF3LmNhbnZhc1NjYWxlO1xyXG5cclxuXHRcdFx0Ly8gYXBwbHkgY2FtZXJhXHJcblx0XHRcdGN0eC5zY2FsZShkZWJ1Z0RyYXcudmlld1pvb20sIGRlYnVnRHJhdy52aWV3Wm9vbSk7XHJcblx0XHRcdGN0eC5saW5lV2lkdGggLz0gZGVidWdEcmF3LnZpZXdab29tO1xyXG5cclxuXHRcdFx0dGhpcy5EcmF3RGVidWdEYXRhKCk7XHJcblxyXG5cdFx0XHQvL2Rpc3BsYXkgcGxheWVyJ3MgZnJvbnRcclxuXHRcdFx0aWYgKHBsYXllciAmJiBwbGF5ZXIuYm9keSkge1xyXG5cdFx0XHRcdGNvbnN0IHBvcyA9IHBsYXllci5nZXRQb3NpdGlvbigpO1xyXG5cdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBcIiNGMDBBXCI7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0Ly90ZXN0IGRlYnVnRHJhdy5jYW52YXNTY2FsZVxyXG5cdFx0XHRcdGlmIChwbGF5ZXIuc3RhdGUuZnJvbnQgPiAwKSB7XHJcblx0XHRcdFx0XHRjdHguZmlsbFJlY3QocG9zLngsIHBvcy55LCAxLCAxKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAocGxheWVyLnN0YXRlLmZyb250IDwgMCkge1xyXG5cdFx0XHRcdFx0Y3R4LmZpbGxSZWN0KHBvcy54IC0gMSwgcG9zLnksIDEsIDEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGN0eC5maWxsUmVjdChwb3MueCAtIDAuNSwgcG9zLnksIDEsIDEpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Y3R4LnJlc3RvcmUoKTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoJGd2Lm1fZGlzcGxheV9wYXJ0aWNsZVN5c3RlbSkge1xyXG5cdFx0XHRpZiAocmVuZGVyZXIuZ2wpIHtcclxuXHRcdFx0XHQvKiogQHR5cGUge1dlYkdMUmVuZGVyaW5nQ29udGV4dH0gKi9cclxuXHRcdFx0XHRjb25zdCBnbCA9IHRoaXMuZ2w7XHJcblxyXG5cdFx0XHRcdGlmICghdGhpcy4kdmJvX3BzKSB7XHJcblx0XHRcdFx0XHRsZXQgdmJvID0gZ2wuY3JlYXRlQnVmZmVyKCk7XHJcblxyXG5cdFx0XHRcdFx0Z2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHZibyk7XHJcblxyXG5cdFx0XHRcdFx0Y29uc3QgY291bnQgPSB0aGlzLm1fcGFydGljbGVTeXN0ZW0uR2V0UGFydGljbGVDb3VudCgpO1xyXG5cdFx0XHRcdFx0Y29uc3QgYnVmID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLkdldFBvc2l0aW9uQnVmZmVyKCk7XHJcblxyXG5cdFx0XHRcdFx0bGV0IHZlcnRpY2VzID0gbmV3IEZsb2F0MzJBcnJheShjb3VudCAqIDIpO1xyXG5cclxuXHRcdFx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKz0gMikge1xyXG5cdFx0XHRcdFx0XHR2ZXJ0aWNlc1tpICsgMF0gPSBidWZbaV0ueDtcclxuXHRcdFx0XHRcdFx0dmVydGljZXNbaSArIDFdID0gYnVmW2ldLnk7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Z2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIHZlcnRpY2VzLCBnbC5TVEFUSUNfRFJBVyk7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy4kdmJvX3BzID0gdmJvO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGNvbnN0IGNvdW50ID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLkdldFBhcnRpY2xlQ291bnQoKTtcclxuXHRcdFx0XHRcdGNvbnN0IGJ1ZiA9IHRoaXMubV9wYXJ0aWNsZVN5c3RlbS5HZXRQb3NpdGlvbkJ1ZmZlcigpO1xyXG5cclxuXHRcdFx0XHRcdGxldCB2ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoY291bnQgKiAyKTtcclxuXHJcblx0XHRcdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpICs9IDIpIHtcclxuXHRcdFx0XHRcdFx0dmVydGljZXNbaSArIDBdID0gYnVmW2ldLng7XHJcblx0XHRcdFx0XHRcdHZlcnRpY2VzW2kgKyAxXSA9IGJ1ZltpXS55O1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB2ZXJ0aWNlcywgZ2wuU1RBVElDX0RSQVcpO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0Zm9yIChsZXQgZ3JvdXAgPSB0aGlzLm1fcGFydGljbGVTeXN0ZW0ubV9ncm91cExpc3Q7IGdyb3VwOyBncm91cCA9IGdyb3VwLm1fbmV4dCkge1xyXG5cdFx0XHRcdFx0bGV0IHBhcnRpY2xlQ291bnQgPSBncm91cC5HZXRQYXJ0aWNsZUNvdW50KCk7XHJcblx0XHRcdFx0XHRsZXQgaW5zdGFuY2VPZmZzZXQgPSBncm91cC5HZXRCdWZmZXJJbmRleCgpO1xyXG5cdFx0XHRcdFx0Z2wuZHJhd0FycmF5cyhnbC5QT0lOVFMsIGluc3RhbmNlT2Zmc2V0LCBwYXJ0aWNsZUNvdW50KTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoY3R4KSB7XHJcblx0XHRcdFx0aWYgKCRndi5mdW5jKSB7XHJcblx0XHRcdFx0XHQkZ3YuZnVuYy5jYWxsKHRoaXMsIGN0eCwgcmVuZGVyZXIpO1xyXG5cdFx0XHRcdFx0Ly8kZ3YuZnVuYyA9IGZ1bmN0aW9uIChjdHgpIHtcclxuXHRcdFx0XHRcdC8vXHRjdHggPSBjdHggfHwgJGVuZ2luZS5jdHg7XHJcblx0XHRcdFx0XHQvL1x0Y29uc3QgdmVydGljZXMgPSB0aGlzLm1fcGFydGljbGVTeXN0ZW0ubV9wb3NpdGlvbkJ1ZmZlci5kYXRhO1xyXG5cdFx0XHRcdFx0Ly9cdGNvbnN0IGNvbG9yQnVmZmVyID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLm1fY29sb3JCdWZmZXIuZGF0YTtcclxuXHRcdFx0XHRcdC8vXHRjb25zdCB3ZWlnaHRCdWZmZXIgPSB0aGlzLm1fcGFydGljbGVTeXN0ZW0ubV93ZWlnaHRCdWZmZXI7XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0Ly9cdGxldCBtaW5XZWlnaHQgPSBNYXRoLm1pbi5hcHBseSh0aGlzLCB3ZWlnaHRCdWZmZXIuc2xpY2UoMCwgMTI4KSk7XHJcblx0XHRcdFx0XHQvL1x0bGV0IG1heFdlaWdodCA9IE1hdGgubWF4LmFwcGx5KHRoaXMsIHdlaWdodEJ1ZmZlci5zbGljZSgwLCAxMjgpKSAtIG1pbldlaWdodDtcclxuXHRcdFx0XHRcdC8vXHJcblx0XHRcdFx0XHQvL1x0aWYgKHZlcnRpY2VzLmxlbmd0aCA+IDIpIHtcclxuXHRcdFx0XHRcdC8vXHRcdGxldCBsZW5ndGggPSB2ZXJ0aWNlcy5sZW5ndGggLyAyO1xyXG5cdFx0XHRcdFx0Ly9cclxuXHRcdFx0XHRcdC8vXHRcdGN0eC5maWxsU3R5bGUgPSBcIiMwNzQ3XCI7XHJcblx0XHRcdFx0XHQvL1xyXG5cdFx0XHRcdFx0Ly9cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGggLSAyOyBpICs9IDEpIHtcclxuXHRcdFx0XHRcdC8vXHRcdFx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0XHRcdFx0Ly9cdFx0XHRjdHgubW92ZVRvKHZlcnRpY2VzW2kgKyAwXS54ICogJGd2LkNBTlZBU19TQ0FMRSwgdmVydGljZXNbaSArIDBdLnkgKiAkZ3YuQ0FOVkFTX1NDQUxFKTtcclxuXHRcdFx0XHRcdC8vXHRcdFx0Y3R4LmxpbmVUbyh2ZXJ0aWNlc1tpICsgMV0ueCAqICRndi5DQU5WQVNfU0NBTEUsIHZlcnRpY2VzW2kgKyAxXS55ICogJGd2LkNBTlZBU19TQ0FMRSk7XHJcblx0XHRcdFx0XHQvL1x0XHRcdGN0eC5saW5lVG8odmVydGljZXNbaSArIDJdLnggKiAkZ3YuQ0FOVkFTX1NDQUxFLCB2ZXJ0aWNlc1tpICsgMl0ueSAqICRndi5DQU5WQVNfU0NBTEUpO1xyXG5cdFx0XHRcdFx0Ly9cdFx0XHRjdHguZmlsbFN0eWxlID0gYGhzbGEoODdkZWcsJHsod2VpZ2h0QnVmZmVyW2ldIC8gbWF4V2VpZ2h0ICogMTAwKS50b0ZpeGVkKDApfSUsJHsod2VpZ2h0QnVmZmVyW2ldIC8gbWF4V2VpZ2h0ICogNTApLnRvRml4ZWQoMCl9JSwkeyh3ZWlnaHRCdWZmZXJbaV0gLyBtYXhXZWlnaHQgLyAyKS50b0ZpeGVkKDIpfSlgXHJcblx0XHRcdFx0XHQvL1x0XHRcdC8vY3R4LmZpbGxTdHlsZSA9IGNvbG9yQnVmZmVyW2ldLk1ha2VTdHlsZVN0cmluZygpO1xyXG5cdFx0XHRcdFx0Ly9cdFx0XHRjdHguZmlsbCgpO1xyXG5cdFx0XHRcdFx0Ly9cdFx0fVxyXG5cdFx0XHRcdFx0Ly9cdH1cclxuXHRcdFx0XHRcdC8vfVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdGNvbnN0IHZlcnRpY2VzID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLm1fcG9zaXRpb25CdWZmZXIuZGF0YTtcclxuXHRcdFx0XHRcdGNvbnN0IGNvbG9yQnVmZmVyID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLm1fY29sb3JCdWZmZXIuZGF0YTtcclxuXHRcdFx0XHRcdGNvbnN0IHdlaWdodEJ1ZmZlciA9IHRoaXMubV9wYXJ0aWNsZVN5c3RlbS5tX3dlaWdodEJ1ZmZlci5kYXRhO1xyXG5cclxuXHRcdFx0XHRcdHJlbmRlcmVyLnB1c2hNYXRyaXgoKTtcclxuXHJcblx0XHRcdFx0XHRjb25zdCByID0gd2luZG93LiRwYXJ0aWNsZVJhZGl1cztcclxuXHRcdFx0XHRcdGNvbnN0IHIyID0gciAqIDI7XHJcblxyXG5cdFx0XHRcdFx0aWYgKCF0aGlzLiRwYXJ0aWNsZV9ncmQpIHtcclxuXHRcdFx0XHRcdFx0bGV0IGdyZCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudChyLCByLCAwLCByLCByLCByMik7XHJcblx0XHRcdFx0XHRcdGdyZC5hZGRDb2xvclN0b3AoMCwgXCIjMDc0NFwiKTtcclxuXHRcdFx0XHRcdFx0Z3JkLmFkZENvbG9yU3RvcCgxLCBcIiMwNzQ0MFwiKTtcclxuXHRcdFx0XHRcdFx0dGhpcy4kcGFydGljbGVfZ3JkID0gZ3JkO1xyXG5cdFx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRcdGZvciAobGV0IGdyb3VwID0gdGhpcy5tX3BhcnRpY2xlU3lzdGVtLm1fZ3JvdXBMaXN0OyBncm91cDsgZ3JvdXAgPSBncm91cC5tX25leHQpIHtcclxuXHRcdFx0XHRcdFx0Zm9yIChsZXQgaSA9IGdyb3VwLm1fZmlyc3RJbmRleDsgaSA8IGdyb3VwLm1fbGFzdEluZGV4OyArK2kpIHtcclxuXHRcdFx0XHRcdFx0XHRsZXQgeDEgPSB2ZXJ0aWNlc1tpXS54ICogJGd2LkNBTlZBU19TQ0FMRSAtIHI7XHJcblx0XHRcdFx0XHRcdFx0bGV0IHkxID0gdmVydGljZXNbaV0ueSAqICRndi5DQU5WQVNfU0NBTEUgLSByO1xyXG5cclxuXHRcdFx0XHRcdFx0XHRyZW5kZXJlci5zZXRUcmFuc2Zvcm0oMSwgMCwgMCwgMSwgJGd2Lm1fdmlld1JlY3QubGVmdCArIHgxLCAkZ3YubV92aWV3UmVjdC50b3AgKyB5MSk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGN0eC5iZWdpblBhdGgoKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly90ZXh0dXJlXHJcblxyXG5cdFx0XHRcdFx0XHRcdC8vY3R4LmFyYygwLCAwLCByMiwgMCwgMiAqIE1hdGguUEkpO1xyXG5cdFx0XHRcdFx0XHRcdC8vY3R4LmZpbGxTdHlsZSA9IHRoaXMuJHBhcnRpY2xlX2dyZDtcclxuXHRcdFx0XHRcdFx0XHQvL2N0eC5maWxsKCk7XHJcblxyXG5cdFx0XHRcdFx0XHRcdGN0eC5maWxsU3R5bGUgPSB0aGlzLiRwYXJ0aWNsZV9ncmQ7XHJcblx0XHRcdFx0XHRcdFx0Y3R4LmZpbGxSZWN0KHIsIHIsIHIyICogMiwgcjIgKiAyKTtcclxuXHJcblx0XHRcdFx0XHRcdFx0Ly9jZW50ZXJcclxuXHRcdFx0XHRcdFx0XHQvL2N0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG5cdFx0XHRcdFx0XHRcdC8vY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpO1xyXG5cclxuXHRcdFx0XHRcdFx0XHQvL2JvcmRlclxyXG5cdFx0XHRcdFx0XHRcdC8vY3R4LnN0cm9rZVJlY3QoLXIsIC1yLCByMiwgcjIpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRyZW5kZXJlci5wb3BNYXRyaXgoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0aWYgKCRndi5tX2Rpc3BsYXlfZm9vdGhvbGQpIHtcclxuXHRcdFx0Y3R4LnNhdmUoKTtcclxuXHRcdFx0dGhpcy5ncm91bmQuJGRyYXdEZWJ1Z0luZm8ocmVuZGVyZXIpO1xyXG5cdFx0XHRpZiAocGxheWVyICYmIHBsYXllci5fZm9vdGhvbGQpIHtcclxuXHRcdFx0XHRwbGF5ZXIuX2Zvb3Rob2xkLiRkcmF3RGVidWdJbmZvMihyZW5kZXJlciwgXCIjRkYwXCIpO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRsZXQgJGZvb3Rob2xkLCAkbGFkZGVyUm9wZTtcclxuXHRcdFx0aWYgKHBsYXllcikge1xyXG5cdFx0XHRcdCRmb290aG9sZCA9IHBsYXllci4kZm9vdGhvbGQ7XHJcblx0XHRcdFx0JGxhZGRlclJvcGUgPSBwbGF5ZXIubGFkZGVyO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICgkZm9vdGhvbGQgJiYgdGhpcy5kcmF3X2Zvb3Rob2xkX3BhdGhfY291bnQpIHtcclxuXHRcdFx0XHQkZm9vdGhvbGQuJGRyYXdEZWJ1Z0luZm8yKHJlbmRlcmVyLCBcIiNGMDBcIik7XHJcblxyXG5cdFx0XHRcdC8vZHJhdyBwYXRoXHJcblx0XHRcdFx0bGV0IGNvdW50ID0gdGhpcy5kcmF3X2Zvb3Rob2xkX3BhdGhfY291bnQ7XHJcblx0XHRcdFx0Y3R4LmxpbmVXaWR0aCA9IDIuNTtcclxuXHRcdFx0XHRjdHguc3Ryb2tlU3R5bGUgPSBcIiMwMEZFXCI7XHJcblx0XHRcdFx0aWYgKHBsYXllci5zdGF0ZS5mcm9udCA+IDApIHtcclxuXHRcdFx0XHRcdCRmb290aG9sZCA9IHRoaXMuZ3JvdW5kLmZvb3Rob2xkc1skZm9vdGhvbGQubmV4dF07XHJcblx0XHRcdFx0XHRmb3IgKDsgJGZvb3Rob2xkOyAkZm9vdGhvbGQgPSB0aGlzLmdyb3VuZC5mb290aG9sZHNbJGZvb3Rob2xkLm5leHRdKSB7XHJcblx0XHRcdFx0XHRcdCRmb290aG9sZC5fZHJhd0xpbmUoY3R4KTtcclxuXHRcdFx0XHRcdFx0aWYgKCgtLWNvdW50KSA8PSAwKSB7XHJcblx0XHRcdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSBpZiAocGxheWVyLnN0YXRlLmZyb250IDwgMCkge1xyXG5cdFx0XHRcdFx0JGZvb3Rob2xkID0gdGhpcy5ncm91bmQuZm9vdGhvbGRzWyRmb290aG9sZC5wcmV2XTtcclxuXHRcdFx0XHRcdGZvciAoOyAkZm9vdGhvbGQ7ICRmb290aG9sZCA9IHRoaXMuZ3JvdW5kLmZvb3Rob2xkc1skZm9vdGhvbGQucHJldl0pIHtcclxuXHRcdFx0XHRcdFx0JGZvb3Rob2xkLl9kcmF3TGluZShjdHgpO1xyXG5cdFx0XHRcdFx0XHRpZiAoKC0tY291bnQpIDw9IDApIHtcclxuXHRcdFx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHR0aGlzLmxhZGRlclJvcGUuZm9yRWFjaChsciA9PiB7XHJcblx0XHRcdFx0Y29uc3Qgd2lkdGggPSBsci5jYWxjV2lkdGgoKTtcclxuXHRcdFx0XHRjdHguYmVnaW5QYXRoKCk7XHJcblx0XHRcdFx0Y3R4LnJlY3QobHIueCAtIHdpZHRoICogMC41LCBsci55MSwgd2lkdGgsIGxyLnkyIC0gbHIueTEpO1xyXG5cdFx0XHRcdGN0eC5maWxsU3R5bGUgPSBsciA9PSAkbGFkZGVyUm9wZSA/IFwiI0UxMTdcIjpcIiNFQjE3XCI7XHJcblx0XHRcdFx0Y3R4LmZpbGwoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRjdHgucmVzdG9yZSgpO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL0xpcXVpZEZ1blBhaW50L2Jsb2IvZGV2ZWxvcC9zcmMvY29tL2dvb2dsZS9mcGwvbGlxdWlkZnVucGFpbnQvUGFydGljbGVSZW5kZXJlci5qYXZhI0w0M1xyXG4gKiBSZW5kZXJlciB0byBkcmF3IHBhcnRpY2xlIHdhdGVyLCBvYmplY3RzLCBhbmQgd2FsbC4gSXQgZHJhd3MgcGFydGljbGVzIGFzXHJcbiAqIGZsdWlkIChvciBvYmplY3RzKSBieSBmb2xsb3dpbmcgdGhyZWUgc3RlcHM6XHJcbiAqIDEpIERyYXdzIHBhcnRpY2xlcyB0byBhIHRleHR1cmVcclxuICogMikgQmx1cnMgaXQgb3V0XHJcbiAqIDMpIEFwcGxpZXMgdGhyZXNob2xkLlxyXG4gKi9cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Physics/World.js\n");

/***/ }),

/***/ "./src/game/Renderer/Chair.js":
/*!************************************!*\
  !*** ./src/game/Renderer/Chair.js ***!
  \************************************/
/*! exports provided: Chair */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Chair\", function() { return Chair; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n/* harmony import */ var _Layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Layer.js */ \"./src/game/Renderer/Layer.js\");\n/* harmony import */ var _SceneRenderer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./SceneRenderer.js */ \"./src/game/Renderer/SceneRenderer.js\");\n/* harmony import */ var _RenderingOption_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./RenderingOption.js */ \"./src/game/Renderer/RenderingOption.js\");\n/* harmony import */ var _CharacterRenderer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./CharacterRenderer.js */ \"./src/game/Renderer/CharacterRenderer.js\");\n/* harmony import */ var _SceneCharacter_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../SceneCharacter.js */ \"./src/game/SceneCharacter.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../public/javascripts/resource.js */ \"./public/javascripts/resource.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass _ChairInfo {\r\n\tconstructor() {\r\n\t\t/** @param {{x:number,y:number}} */\r\n\t\tthis.bodyRelMove = null;\r\n\t\tthis.price = 1;\r\n\t\tthis.slotMax = 1;\r\n\t\tthis.recoveryHP = 100;\r\n\t\tthis.recoveryMP = 60;\r\n\t\tthis.sitEmotion = 10;\r\n\t\tthis.tradeBlock = 1;\r\n\t\tthis.invisibleWeapon = 1;\r\n\t}\r\n}\r\n\r\nclass _ChairEffect extends Array {\r\n\tconstructor() {\r\n\t\tthis.z = -1;\r\n\t\tthis.pos = 1;\r\n\t\t\r\n\t\t///** @type {_SpriteData} */\r\n\t\t//this[0..N] = null;\r\n\t}\r\n}\r\n\r\nclass _ChairData {\r\n\tconstructor() {\r\n\t\t/** @type {_ChairInfo} */\r\n\t\tthis.info = null;\r\n\t\t/** @type {_ChairEffect} */\r\n\t\tthis.effect = null;\r\n\t\t/** @type {_ChairEffect} */\r\n\t\tthis.effect2 = null;\r\n\t}\r\n}\r\n\r\n/**\r\n * @implements {LayerObject}\r\n */\r\nclass ChairEffect extends _Animation_js__WEBPACK_IMPORTED_MODULE_1__[\"Animation\"] {\r\n\tconstructor(raw) {\r\n\t\tsuper(raw);\r\n\t\t\r\n\t\tthis.is_loop = true;\r\n\t\t\r\n\t\tthis.z = raw.z;\r\n\t\tthis.pos = raw.pos;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis._offset = null;\r\n\t\t\r\n\t\t/** @type {Chair} */\r\n\t\tthis._host = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {Chair} host\r\n\t * @param {Vec2} offset\r\n\t */\r\n\tinit(host, offset) {\r\n\t\tthis._host = host;\r\n\t\tthis._offset = offset;\r\n\t}\r\n\t\r\n\t/** @override */\r\n\tisEnd() {\r\n\t\tconst player = this._host._player;\r\n\t\treturn !player.chair;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {SceneRenderer} sceneRenderer\r\n\t */\r\n\t_addToScene(sceneRenderer) {\r\n\t\tconst player = this._host._player;\r\n\t\tlet layerIndex = player.$layer + this.z;\r\n\t\tlayerIndex = layerIndex >= 0 ? layerIndex : 0;\r\n\t\tconst layer = sceneRenderer.layers[layerIndex];\r\n\t\tlayer.add(this);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {RenderingOption} option\r\n\t */\r\n\trender(renderer, option) {\r\n\t\tconst crr = this._host._player.renderer;\r\n\t\tconst x = crr.x;\r\n\t\tconst y = crr.y;\r\n\t\tconst angle = crr.angle;\r\n\t\tconst flip = crr.front > 0;\r\n\t\t\r\n\t\t//renderer.globalAlpha = this.opacity * option.opacity;\r\n\t\trenderer.globalAlpha = option.opacity;\r\n\r\n\t\tif (this._offset) {\r\n\t\t\tconst offset = this._offset;\r\n\t\t\tthis.draw(renderer, x + offset.x, y + offset.y, 0, flip);\r\n\t\t}\r\n\t\telse if (this.pos == 1) {\r\n\t\t\tconst oy = -this.texture.height * 0.5;\r\n\t\t\tthis.draw(renderer, x, y + oy, 0, flip);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.draw(renderer, x, y, angle, flip);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass Chair {\r\n\tconstructor() {\r\n\t\t/** @type {_ChairData} */\r\n\t\tthis._raw = null;\r\n\t\t\r\n\t\t/** @type {SceneCharacter} - owner */\r\n\t\tthis._player = null;\r\n\t\t\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.bodyRelMove = null;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\t\t\r\n\t\t/** @type {ChairEffect[]} */\r\n\t\tthis.effects = [];\r\n\t\t\r\n\t\tthis.$promise = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {SceneCharacter} player\r\n\t */\r\n\tinit(player) {\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t_player: {\r\n\t\t\t\tvalue: player,\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tasync load(id) {//\"03010377\"\r\n\t\tif (!id.startsWith(\"0301\")) {\r\n\t\t\tthrow new TypeError(\"Not chair\");\r\n\t\t}\r\n\t\tthis.id = id;\r\n\t\t\r\n\t\tthis.$promise = _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_8__[\"ItemCategoryInfo\"].getItem(id);\r\n\t\tconst raw = await this.$promise;\r\n\t\tdelete this.$promise;\r\n\r\n\t\tdelete this._raw;\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t_raw: {\r\n\t\t\t\tconfigurable: false,\r\n\t\t\t\twritable: false,\r\n\t\t\t\tvalue: raw,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tlet offset;\r\n\r\n\t\tif (this._raw.info.bodyRelMove) {\r\n\t\t\tthis.bodyRelMove = new _math_js__WEBPACK_IMPORTED_MODULE_7__[\"Vec2\"](this._raw.info.bodyRelMove.x, this._raw.info.bodyRelMove.y);\r\n\t\t}\r\n\t\telse if (raw.effect && raw.effect[0].origin.y < 0) {\r\n\t\t\t//let w = raw.effect[0].__w;\r\n\t\t\tlet h = raw.effect[0].__h;\r\n\t\t\toffset = new _math_js__WEBPACK_IMPORTED_MODULE_7__[\"Vec2\"](0, -h * 1.5);\r\n\t\t}\r\n\t\tif (raw.effect[0].origin.y == 0) {\r\n\t\t\tdebugger;\r\n\t\t}\r\n\t\t\r\n\t\tfor (let key in raw) {\r\n\t\t\tif (key.startsWith(\"effect\")) {\r\n\t\t\t\tconst eff = new ChairEffect(raw[key]);\r\n\t\t\t\teff.init(this, offset);\r\n\t\t\t\teff.load();//Animation#load => load texture\r\n\t\t\t\tthis.effects.push(eff);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {SceneRenderer} sceneRenderer\r\n\t */\r\n\taddToScene(sceneRenderer) {\r\n\t\tfor (let eff of this.effects) {\r\n\t\t\teff._addToScene(sceneRenderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\tgetIconUrl() {\r\n\t\treturn this._raw.info.icon[\"\"];\r\n\t}\r\n\tgetIconRawUrl() {\r\n\t\treturn this._raw.info.iconRaw[\"\"];\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9DaGFpci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL0NoYWlyLmpzP2ZmMWUiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IElSZW5kZXJlciB9IGZyb20gXCIuLi9JUmVuZGVyZXIuanNcIjtcclxuaW1wb3J0IHsgQW5pbWF0aW9uIH0gZnJvbSBcIi4uL0FuaW1hdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBMYXllck9iamVjdCwgTGF5ZXIgfSBmcm9tIFwiLi9MYXllci5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZVJlbmRlcmVyIH0gZnJvbSBcIi4vU2NlbmVSZW5kZXJlci5qc1wiO1xyXG5pbXBvcnQgeyBSZW5kZXJpbmdPcHRpb24gfSBmcm9tIFwiLi9SZW5kZXJpbmdPcHRpb24uanNcIjtcclxuXHJcbmltcG9ydCB7IENoYXJhY3RlclJlbmRlcmVyIH0gZnJvbSBcIi4vQ2hhcmFjdGVyUmVuZGVyZXIuanNcIjtcclxuaW1wb3J0IHsgU2NlbmVDaGFyYWN0ZXIgfSBmcm9tIFwiLi4vU2NlbmVDaGFyYWN0ZXIuanNcIjtcclxuaW1wb3J0IHsgVmVjMiB9IGZyb20gXCIuLi9tYXRoLmpzXCI7XHJcbmltcG9ydCB7IEl0ZW1DYXRlZ29yeUluZm8gfSBmcm9tIFwiLi4vLi4vLi4vcHVibGljL2phdmFzY3JpcHRzL3Jlc291cmNlLmpzXCI7XHJcblxyXG5cclxuY2xhc3MgX0NoYWlySW5mbyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHBhcmFtIHt7eDpudW1iZXIseTpudW1iZXJ9fSAqL1xyXG5cdFx0dGhpcy5ib2R5UmVsTW92ZSA9IG51bGw7XHJcblx0XHR0aGlzLnByaWNlID0gMTtcclxuXHRcdHRoaXMuc2xvdE1heCA9IDE7XHJcblx0XHR0aGlzLnJlY292ZXJ5SFAgPSAxMDA7XHJcblx0XHR0aGlzLnJlY292ZXJ5TVAgPSA2MDtcclxuXHRcdHRoaXMuc2l0RW1vdGlvbiA9IDEwO1xyXG5cdFx0dGhpcy50cmFkZUJsb2NrID0gMTtcclxuXHRcdHRoaXMuaW52aXNpYmxlV2VhcG9uID0gMTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIF9DaGFpckVmZmVjdCBleHRlbmRzIEFycmF5IHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMueiA9IC0xO1xyXG5cdFx0dGhpcy5wb3MgPSAxO1xyXG5cdFx0XHJcblx0XHQvLy8qKiBAdHlwZSB7X1Nwcml0ZURhdGF9ICovXHJcblx0XHQvL3RoaXNbMC4uTl0gPSBudWxsO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgX0NoYWlyRGF0YSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge19DaGFpckluZm99ICovXHJcblx0XHR0aGlzLmluZm8gPSBudWxsO1xyXG5cdFx0LyoqIEB0eXBlIHtfQ2hhaXJFZmZlY3R9ICovXHJcblx0XHR0aGlzLmVmZmVjdCA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge19DaGFpckVmZmVjdH0gKi9cclxuXHRcdHRoaXMuZWZmZWN0MiA9IG51bGw7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogQGltcGxlbWVudHMge0xheWVyT2JqZWN0fVxyXG4gKi9cclxuY2xhc3MgQ2hhaXJFZmZlY3QgZXh0ZW5kcyBBbmltYXRpb24ge1xyXG5cdGNvbnN0cnVjdG9yKHJhdykge1xyXG5cdFx0c3VwZXIocmF3KTtcclxuXHRcdFxyXG5cdFx0dGhpcy5pc19sb29wID0gdHJ1ZTtcclxuXHRcdFxyXG5cdFx0dGhpcy56ID0gcmF3Lno7XHJcblx0XHR0aGlzLnBvcyA9IHJhdy5wb3M7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtWZWMyfSAqL1xyXG5cdFx0dGhpcy5fb2Zmc2V0ID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtDaGFpcn0gKi9cclxuXHRcdHRoaXMuX2hvc3QgPSBudWxsO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0NoYWlyfSBob3N0XHJcblx0ICogQHBhcmFtIHtWZWMyfSBvZmZzZXRcclxuXHQgKi9cclxuXHRpbml0KGhvc3QsIG9mZnNldCkge1xyXG5cdFx0dGhpcy5faG9zdCA9IGhvc3Q7XHJcblx0XHR0aGlzLl9vZmZzZXQgPSBvZmZzZXQ7XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAb3ZlcnJpZGUgKi9cclxuXHRpc0VuZCgpIHtcclxuXHRcdGNvbnN0IHBsYXllciA9IHRoaXMuX2hvc3QuX3BsYXllcjtcclxuXHRcdHJldHVybiAhcGxheWVyLmNoYWlyO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1NjZW5lUmVuZGVyZXJ9IHNjZW5lUmVuZGVyZXJcclxuXHQgKi9cclxuXHRfYWRkVG9TY2VuZShzY2VuZVJlbmRlcmVyKSB7XHJcblx0XHRjb25zdCBwbGF5ZXIgPSB0aGlzLl9ob3N0Ll9wbGF5ZXI7XHJcblx0XHRsZXQgbGF5ZXJJbmRleCA9IHBsYXllci4kbGF5ZXIgKyB0aGlzLno7XHJcblx0XHRsYXllckluZGV4ID0gbGF5ZXJJbmRleCA+PSAwID8gbGF5ZXJJbmRleCA6IDA7XHJcblx0XHRjb25zdCBsYXllciA9IHNjZW5lUmVuZGVyZXIubGF5ZXJzW2xheWVySW5kZXhdO1xyXG5cdFx0bGF5ZXIuYWRkKHRoaXMpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1JlbmRlcmluZ09wdGlvbn0gb3B0aW9uXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyLCBvcHRpb24pIHtcclxuXHRcdGNvbnN0IGNyciA9IHRoaXMuX2hvc3QuX3BsYXllci5yZW5kZXJlcjtcclxuXHRcdGNvbnN0IHggPSBjcnIueDtcclxuXHRcdGNvbnN0IHkgPSBjcnIueTtcclxuXHRcdGNvbnN0IGFuZ2xlID0gY3JyLmFuZ2xlO1xyXG5cdFx0Y29uc3QgZmxpcCA9IGNyci5mcm9udCA+IDA7XHJcblx0XHRcclxuXHRcdC8vcmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLm9wYWNpdHkgKiBvcHRpb24ub3BhY2l0eTtcclxuXHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gb3B0aW9uLm9wYWNpdHk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX29mZnNldCkge1xyXG5cdFx0XHRjb25zdCBvZmZzZXQgPSB0aGlzLl9vZmZzZXQ7XHJcblx0XHRcdHRoaXMuZHJhdyhyZW5kZXJlciwgeCArIG9mZnNldC54LCB5ICsgb2Zmc2V0LnksIDAsIGZsaXApO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy5wb3MgPT0gMSkge1xyXG5cdFx0XHRjb25zdCBveSA9IC10aGlzLnRleHR1cmUuaGVpZ2h0ICogMC41O1xyXG5cdFx0XHR0aGlzLmRyYXcocmVuZGVyZXIsIHgsIHkgKyBveSwgMCwgZmxpcCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5kcmF3KHJlbmRlcmVyLCB4LCB5LCBhbmdsZSwgZmxpcCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQ2hhaXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtfQ2hhaXJEYXRhfSAqL1xyXG5cdFx0dGhpcy5fcmF3ID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtTY2VuZUNoYXJhY3Rlcn0gLSBvd25lciAqL1xyXG5cdFx0dGhpcy5fcGxheWVyID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtWZWMyfSAqL1xyXG5cdFx0dGhpcy5ib2R5UmVsTW92ZSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5pZCA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7Q2hhaXJFZmZlY3RbXX0gKi9cclxuXHRcdHRoaXMuZWZmZWN0cyA9IFtdO1xyXG5cdFx0XHJcblx0XHR0aGlzLiRwcm9taXNlID0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtTY2VuZUNoYXJhY3Rlcn0gcGxheWVyXHJcblx0ICovXHJcblx0aW5pdChwbGF5ZXIpIHtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcclxuXHRcdFx0X3BsYXllcjoge1xyXG5cdFx0XHRcdHZhbHVlOiBwbGF5ZXIsXHJcblx0XHRcdH0sXHJcblx0XHR9KTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICovXHJcblx0YXN5bmMgbG9hZChpZCkgey8vXCIwMzAxMDM3N1wiXHJcblx0XHRpZiAoIWlkLnN0YXJ0c1dpdGgoXCIwMzAxXCIpKSB7XHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJOb3QgY2hhaXJcIik7XHJcblx0XHR9XHJcblx0XHR0aGlzLmlkID0gaWQ7XHJcblx0XHRcclxuXHRcdHRoaXMuJHByb21pc2UgPSBJdGVtQ2F0ZWdvcnlJbmZvLmdldEl0ZW0oaWQpO1xyXG5cdFx0Y29uc3QgcmF3ID0gYXdhaXQgdGhpcy4kcHJvbWlzZTtcclxuXHRcdGRlbGV0ZSB0aGlzLiRwcm9taXNlO1xyXG5cclxuXHRcdGRlbGV0ZSB0aGlzLl9yYXc7XHJcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XHJcblx0XHRcdF9yYXc6IHtcclxuXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdHdyaXRhYmxlOiBmYWxzZSxcclxuXHRcdFx0XHR2YWx1ZTogcmF3LFxyXG5cdFx0XHR9LFxyXG5cdFx0fSk7XHJcblxyXG5cdFx0bGV0IG9mZnNldDtcclxuXHJcblx0XHRpZiAodGhpcy5fcmF3LmluZm8uYm9keVJlbE1vdmUpIHtcclxuXHRcdFx0dGhpcy5ib2R5UmVsTW92ZSA9IG5ldyBWZWMyKHRoaXMuX3Jhdy5pbmZvLmJvZHlSZWxNb3ZlLngsIHRoaXMuX3Jhdy5pbmZvLmJvZHlSZWxNb3ZlLnkpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAocmF3LmVmZmVjdCAmJiByYXcuZWZmZWN0WzBdLm9yaWdpbi55IDwgMCkge1xyXG5cdFx0XHQvL2xldCB3ID0gcmF3LmVmZmVjdFswXS5fX3c7XHJcblx0XHRcdGxldCBoID0gcmF3LmVmZmVjdFswXS5fX2g7XHJcblx0XHRcdG9mZnNldCA9IG5ldyBWZWMyKDAsIC1oICogMS41KTtcclxuXHRcdH1cclxuXHRcdGlmIChyYXcuZWZmZWN0WzBdLm9yaWdpbi55ID09IDApIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGZvciAobGV0IGtleSBpbiByYXcpIHtcclxuXHRcdFx0aWYgKGtleS5zdGFydHNXaXRoKFwiZWZmZWN0XCIpKSB7XHJcblx0XHRcdFx0Y29uc3QgZWZmID0gbmV3IENoYWlyRWZmZWN0KHJhd1trZXldKTtcclxuXHRcdFx0XHRlZmYuaW5pdCh0aGlzLCBvZmZzZXQpO1xyXG5cdFx0XHRcdGVmZi5sb2FkKCk7Ly9BbmltYXRpb24jbG9hZCA9PiBsb2FkIHRleHR1cmVcclxuXHRcdFx0XHR0aGlzLmVmZmVjdHMucHVzaChlZmYpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7U2NlbmVSZW5kZXJlcn0gc2NlbmVSZW5kZXJlclxyXG5cdCAqL1xyXG5cdGFkZFRvU2NlbmUoc2NlbmVSZW5kZXJlcikge1xyXG5cdFx0Zm9yIChsZXQgZWZmIG9mIHRoaXMuZWZmZWN0cykge1xyXG5cdFx0XHRlZmYuX2FkZFRvU2NlbmUoc2NlbmVSZW5kZXJlcik7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdGdldEljb25VcmwoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fcmF3LmluZm8uaWNvbltcIlwiXTtcclxuXHR9XHJcblx0Z2V0SWNvblJhd1VybCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl9yYXcuaW5mby5pY29uUmF3W1wiXCJdO1xyXG5cdH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Renderer/Chair.js\n");

/***/ }),

/***/ "./src/game/Renderer/ChatBalloon.js":
/*!******************************************!*\
  !*** ./src/game/Renderer/ChatBalloon.js ***!
  \******************************************/
/*! exports provided: ChatBalloon */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ChatBalloon\", function() { return ChatBalloon; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n﻿\r\n\r\n\r\n\r\n\r\nclass ChatBalloon {\r\n\tconstructor() {\r\n\t\tthis._raw = null;\r\n\t\tthis.style = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {any} style\r\n\t */\r\n\tasync load(style) {\r\n\t\tif (style == null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tif (ChatBalloon.cache[style]) {\r\n\t\t\tlet cb = ChatBalloon.cache[style];\r\n\t\t\tObject.assign(this, cb);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst path = [this._base_path, style].join(\"/\");\r\n\r\n\t\t\tthis.style = style;\r\n\t\t\t\r\n\t\t\tlet promise = $get.data(path);\r\n\t\t\tChatBalloon.cache[style] = this;\r\n\t\t\tthis.$promise = promise;\r\n\t\t\t\r\n\t\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\t\tvalue: await promise,\r\n\t\t\t});\r\n\t\t\tdelete this.$promise;\r\n\r\n\t\t\tconst argb = Number(\"clr\" in this._raw ? this._raw.clr : defCol);\r\n\t\t\tconst rgba = (((argb & 0xFF000000) >>> 24) | ((argb & 0x00FFFFFF) << 8)) >>> 0;\r\n\t\t\tconst str_rgba = rgba.toString(16).padStart(8, \"0\");\r\n\t\t\tthis.color = (this._raw.clr == -1 || !this._raw.clr) ? (\"white\") : (\"#\" + str_rgba);\r\n\r\n\t\t\tthis.nw = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.nw);\r\n\t\t\t//this.nw._url = path + \"/nw\";\r\n\r\n\t\t\tthis.n = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.n);\r\n\t\t\t//this.n._url = path + \"/n\";\r\n\r\n\t\t\tthis.ne = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.ne);\r\n\t\t\t//this.ne._url = path + \"/ne\";\r\n\r\n\t\t\tthis.w = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.w);\r\n\t\t\t//this.w._url = path + \"/w\";\r\n\r\n\t\t\tthis.c = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.c);\r\n\t\t\t//this.c._url = path + \"/c\";\r\n\r\n\t\t\tthis.e = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.e);\r\n\t\t\t//this.e._url = path + \"/e\";\r\n\r\n\t\t\tthis.sw = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.sw);\r\n\t\t\t//this.sw._url = path + \"/sw\";\r\n\r\n\t\t\tthis.s = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.s);\r\n\t\t\t//this.s._url = path + \"/s\";\r\n\r\n\t\t\tthis.se = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.se);\r\n\t\t\t//this.se._url = path + \"/se\";\r\n\r\n\t\t\tthis.arrow = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.arrow);\r\n\t\t\t//this.arrow._url = path + \"/arrow\";\r\n\r\n\t\t\t//this._pat_c = ctx.createPattern(this.c, \"repeat\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/*\r\n\t1 12345 12345 1 : 5\r\n\t2 12345 12345 12345\r\n\t3 12345 12345 12345\r\n\t4 12345 12345 12345\r\n\t5 12345 12345 12345\r\n\t6 xxx12 34512 34\r\n\t */\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} text - length = chat.value.length + \" : \".length + name.length = 70 + 3 + name.length\r\n\t * @param {number} x - chat balloon arrow bottom pos.x\r\n\t * @param {number} y - chat balloon arrow bottom pos.y\r\n\t */\r\n\tdraw(renderer, text, x, y) {\r\n\t\tlet lines = text.match(/(.{1,12})/g);\r\n\t\tif (!lines.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst ctx = renderer.ctx;\r\n\t\tconst LINE_HEIGHT = this.c.height;// = fontSize(12) + PADDING_TOP(2)\r\n\t\tconst PADDING_LEFT = 0, PADDING_TOP = 0, PADDING_RIGHT = 0, PADDING_BOTTOM = 0;\r\n\r\n\t\tctx.fillStyle = this.color;\r\n\t\tctx.font = \"12px 微軟正黑體\";//新細明體\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.textBaseline = \"hanging\";//top\r\n\t\t\r\n\t\tconst min_width = this.n.width * 3;\r\n\t\tlet _tw = Math.max.apply(null, lines.map(line => ctx.measureText(line).width + PADDING_LEFT + PADDING_RIGHT));\r\n\t\tif (_tw < min_width) {\r\n\t\t\t_tw = min_width;\r\n\t\t}\r\n\t\tconst hw = Math.trunc((_tw / 2) / this.n.width) * this.n.width;\r\n\t\tconst tw = hw * 2;\r\n\t\tconst th = lines.length * LINE_HEIGHT + PADDING_TOP + PADDING_BOTTOM;\r\n\t\r\n\t\tx = (x - hw);\r\n\t\ty = (y - th) - this.arrow.height;\r\n\r\n\t\t{//top\r\n\t\t\tthis.nw.draw2(x, y);\r\n\t\t\tthis.n._drawPattern(x, y, tw, this.n.height);\r\n\t\t\tthis.ne.draw2(x + tw, y);\r\n\t\t}\r\n\t\t{//center\r\n\t\t\tconst xw = this.w.width - this.w.x;\r\n\r\n\t\t\tthis.w._drawPattern(x + xw, y, this.w.width, th);\r\n\t\t\tthis.c._drawPattern(x + xw, y, tw, th);\r\n\t\t\tthis.e._drawPattern(x + xw + tw, y, this.e.width, th);\r\n\t\t}\r\n\t\t{//bottom\r\n\t\t\tconst r_adj = this.arrow.width & 1;\r\n\t\t\tconst arrow_hw = Math.trunc(this.arrow.width / 2);\r\n\t\t\tconst hw_arrow_hw = hw - arrow_hw;\r\n\t\t\r\n\t\t\tthis.sw.draw2(x, y + th);\r\n\t\t\tthis.s._drawPattern(x, y + th, hw_arrow_hw, this.s.height);//clip\r\n\t\t\tthis.s._drawPattern(x + hw + arrow_hw + r_adj, y + th, hw_arrow_hw - r_adj, this.s.height);//clip\r\n\t\t\tthis.se.draw2(x + tw, y + th);\r\n\r\n\t\t\tthis.arrow.draw2(x - arrow_hw + hw, y + th);\r\n\t\t}\r\n\r\n\t\tfor (let i = 0, cy = y; i < lines.length; ++i, cy += LINE_HEIGHT) {\r\n\t\t\tlet line = lines[i];\r\n\r\n\t\t\t//if (this.constructor.DEBUG) {\r\n\t\t\t//\tctx.beginPath();\r\n\t\t\t//\tctx.strokeStyle = \"red\";\r\n\t\t\t//\tctx.strokeRect(x + PADDING_LEFT, cy + PADDING_TOP, tw, LINE_HEIGHT);\r\n\t\t\t//}\r\n\t\t\t//ctx.fillStyle = \"black\";\r\n\r\n\t\t\tctx.fillText(line, x + hw + PADDING_LEFT, cy + PADDING_TOP);\r\n\t\t}\r\n\t}\r\n\r\n\tget _base_path() {\r\n\t\treturn \"/UI/ChatBalloon\";\r\n\t}\r\n\r\n\t//static get DEBUG() {\r\n\t//\treturn false;\r\n\t//}\r\n}\r\n\r\n/** @type {{[style:number]:ChatBalloon}} */\r\nChatBalloon.cache = window.$images_ChatBalloon || {};\r\n\r\nwindow.$images_ChatBalloon = ChatBalloon.cache;\r\n\r\nif (true) {\r\n\tObject.values(ChatBalloon.cache).forEach(a => {\r\n\t\ta.__proto__ = ChatBalloon.prototype;\r\n\t\t//a.load(a.style);\r\n\t});\r\n\tmodule.hot.accept();\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9DaGF0QmFsbG9vbi5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL0NoYXRCYWxsb29uLmpzPzk4MDgiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IElSZW5kZXJlciB9IGZyb20gJy4uL0lSZW5kZXJlci5qcyc7XHJcbmltcG9ydCB7IFNwcml0ZSB9IGZyb20gJy4uL1Nwcml0ZS5qcyc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIENoYXRCYWxsb29uIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuX3JhdyA9IG51bGw7XHJcblx0XHR0aGlzLnN0eWxlID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7YW55fSBzdHlsZVxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQoc3R5bGUpIHtcclxuXHRcdGlmIChzdHlsZSA9PSBudWxsKSB7XHJcblx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoKTtcclxuXHRcdH1cclxuXHRcdGlmIChDaGF0QmFsbG9vbi5jYWNoZVtzdHlsZV0pIHtcclxuXHRcdFx0bGV0IGNiID0gQ2hhdEJhbGxvb24uY2FjaGVbc3R5bGVdO1xyXG5cdFx0XHRPYmplY3QuYXNzaWduKHRoaXMsIGNiKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjb25zdCBwYXRoID0gW3RoaXMuX2Jhc2VfcGF0aCwgc3R5bGVdLmpvaW4oXCIvXCIpO1xyXG5cclxuXHRcdFx0dGhpcy5zdHlsZSA9IHN0eWxlO1xyXG5cdFx0XHRcclxuXHRcdFx0bGV0IHByb21pc2UgPSAkZ2V0LmRhdGEocGF0aCk7XHJcblx0XHRcdENoYXRCYWxsb29uLmNhY2hlW3N0eWxlXSA9IHRoaXM7XHJcblx0XHRcdHRoaXMuJHByb21pc2UgPSBwcm9taXNlO1xyXG5cdFx0XHRcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiX3Jhd1wiLCB7XHJcblx0XHRcdFx0dmFsdWU6IGF3YWl0IHByb21pc2UsXHJcblx0XHRcdH0pO1xyXG5cdFx0XHRkZWxldGUgdGhpcy4kcHJvbWlzZTtcclxuXHJcblx0XHRcdGNvbnN0IGFyZ2IgPSBOdW1iZXIoXCJjbHJcIiBpbiB0aGlzLl9yYXcgPyB0aGlzLl9yYXcuY2xyIDogZGVmQ29sKTtcclxuXHRcdFx0Y29uc3QgcmdiYSA9ICgoKGFyZ2IgJiAweEZGMDAwMDAwKSA+Pj4gMjQpIHwgKChhcmdiICYgMHgwMEZGRkZGRikgPDwgOCkpID4+PiAwO1xyXG5cdFx0XHRjb25zdCBzdHJfcmdiYSA9IHJnYmEudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsIFwiMFwiKTtcclxuXHRcdFx0dGhpcy5jb2xvciA9ICh0aGlzLl9yYXcuY2xyID09IC0xIHx8ICF0aGlzLl9yYXcuY2xyKSA/IChcIndoaXRlXCIpIDogKFwiI1wiICsgc3RyX3JnYmEpO1xyXG5cclxuXHRcdFx0dGhpcy5udyA9IG5ldyBTcHJpdGUodGhpcy5fcmF3Lm53KTtcclxuXHRcdFx0Ly90aGlzLm53Ll91cmwgPSBwYXRoICsgXCIvbndcIjtcclxuXHJcblx0XHRcdHRoaXMubiA9IG5ldyBTcHJpdGUodGhpcy5fcmF3Lm4pO1xyXG5cdFx0XHQvL3RoaXMubi5fdXJsID0gcGF0aCArIFwiL25cIjtcclxuXHJcblx0XHRcdHRoaXMubmUgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5uZSk7XHJcblx0XHRcdC8vdGhpcy5uZS5fdXJsID0gcGF0aCArIFwiL25lXCI7XHJcblxyXG5cdFx0XHR0aGlzLncgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy53KTtcclxuXHRcdFx0Ly90aGlzLncuX3VybCA9IHBhdGggKyBcIi93XCI7XHJcblxyXG5cdFx0XHR0aGlzLmMgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5jKTtcclxuXHRcdFx0Ly90aGlzLmMuX3VybCA9IHBhdGggKyBcIi9jXCI7XHJcblxyXG5cdFx0XHR0aGlzLmUgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5lKTtcclxuXHRcdFx0Ly90aGlzLmUuX3VybCA9IHBhdGggKyBcIi9lXCI7XHJcblxyXG5cdFx0XHR0aGlzLnN3ID0gbmV3IFNwcml0ZSh0aGlzLl9yYXcuc3cpO1xyXG5cdFx0XHQvL3RoaXMuc3cuX3VybCA9IHBhdGggKyBcIi9zd1wiO1xyXG5cclxuXHRcdFx0dGhpcy5zID0gbmV3IFNwcml0ZSh0aGlzLl9yYXcucyk7XHJcblx0XHRcdC8vdGhpcy5zLl91cmwgPSBwYXRoICsgXCIvc1wiO1xyXG5cclxuXHRcdFx0dGhpcy5zZSA9IG5ldyBTcHJpdGUodGhpcy5fcmF3LnNlKTtcclxuXHRcdFx0Ly90aGlzLnNlLl91cmwgPSBwYXRoICsgXCIvc2VcIjtcclxuXHJcblx0XHRcdHRoaXMuYXJyb3cgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5hcnJvdyk7XHJcblx0XHRcdC8vdGhpcy5hcnJvdy5fdXJsID0gcGF0aCArIFwiL2Fycm93XCI7XHJcblxyXG5cdFx0XHQvL3RoaXMuX3BhdF9jID0gY3R4LmNyZWF0ZVBhdHRlcm4odGhpcy5jLCBcInJlcGVhdFwiKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LypcclxuXHQxIDEyMzQ1IDEyMzQ1IDEgOiA1XHJcblx0MiAxMjM0NSAxMjM0NSAxMjM0NVxyXG5cdDMgMTIzNDUgMTIzNDUgMTIzNDVcclxuXHQ0IDEyMzQ1IDEyMzQ1IDEyMzQ1XHJcblx0NSAxMjM0NSAxMjM0NSAxMjM0NVxyXG5cdDYgeHh4MTIgMzQ1MTIgMzRcclxuXHQgKi9cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHRleHQgLSBsZW5ndGggPSBjaGF0LnZhbHVlLmxlbmd0aCArIFwiIDogXCIubGVuZ3RoICsgbmFtZS5sZW5ndGggPSA3MCArIDMgKyBuYW1lLmxlbmd0aFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gY2hhdCBiYWxsb29uIGFycm93IGJvdHRvbSBwb3MueFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB5IC0gY2hhdCBiYWxsb29uIGFycm93IGJvdHRvbSBwb3MueVxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIsIHRleHQsIHgsIHkpIHtcclxuXHRcdGxldCBsaW5lcyA9IHRleHQubWF0Y2goLyguezEsMTJ9KS9nKTtcclxuXHRcdGlmICghbGluZXMubGVuZ3RoKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHJcblx0XHRjb25zdCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHRjb25zdCBMSU5FX0hFSUdIVCA9IHRoaXMuYy5oZWlnaHQ7Ly8gPSBmb250U2l6ZSgxMikgKyBQQURESU5HX1RPUCgyKVxyXG5cdFx0Y29uc3QgUEFERElOR19MRUZUID0gMCwgUEFERElOR19UT1AgPSAwLCBQQURESU5HX1JJR0hUID0gMCwgUEFERElOR19CT1RUT00gPSAwO1xyXG5cclxuXHRcdGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xyXG5cdFx0Y3R4LmZvbnQgPSBcIjEycHgg5b6u6Luf5q2j6buR6auUXCI7Ly/mlrDntLDmmI7pq5RcclxuXHRcdGN0eC50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xyXG5cdFx0Y3R4LnRleHRCYXNlbGluZSA9IFwiaGFuZ2luZ1wiOy8vdG9wXHJcblx0XHRcclxuXHRcdGNvbnN0IG1pbl93aWR0aCA9IHRoaXMubi53aWR0aCAqIDM7XHJcblx0XHRsZXQgX3R3ID0gTWF0aC5tYXguYXBwbHkobnVsbCwgbGluZXMubWFwKGxpbmUgPT4gY3R4Lm1lYXN1cmVUZXh0KGxpbmUpLndpZHRoICsgUEFERElOR19MRUZUICsgUEFERElOR19SSUdIVCkpO1xyXG5cdFx0aWYgKF90dyA8IG1pbl93aWR0aCkge1xyXG5cdFx0XHRfdHcgPSBtaW5fd2lkdGg7XHJcblx0XHR9XHJcblx0XHRjb25zdCBodyA9IE1hdGgudHJ1bmMoKF90dyAvIDIpIC8gdGhpcy5uLndpZHRoKSAqIHRoaXMubi53aWR0aDtcclxuXHRcdGNvbnN0IHR3ID0gaHcgKiAyO1xyXG5cdFx0Y29uc3QgdGggPSBsaW5lcy5sZW5ndGggKiBMSU5FX0hFSUdIVCArIFBBRERJTkdfVE9QICsgUEFERElOR19CT1RUT007XHJcblx0XHJcblx0XHR4ID0gKHggLSBodyk7XHJcblx0XHR5ID0gKHkgLSB0aCkgLSB0aGlzLmFycm93LmhlaWdodDtcclxuXHJcblx0XHR7Ly90b3BcclxuXHRcdFx0dGhpcy5udy5kcmF3Mih4LCB5KTtcclxuXHRcdFx0dGhpcy5uLl9kcmF3UGF0dGVybih4LCB5LCB0dywgdGhpcy5uLmhlaWdodCk7XHJcblx0XHRcdHRoaXMubmUuZHJhdzIoeCArIHR3LCB5KTtcclxuXHRcdH1cclxuXHRcdHsvL2NlbnRlclxyXG5cdFx0XHRjb25zdCB4dyA9IHRoaXMudy53aWR0aCAtIHRoaXMudy54O1xyXG5cclxuXHRcdFx0dGhpcy53Ll9kcmF3UGF0dGVybih4ICsgeHcsIHksIHRoaXMudy53aWR0aCwgdGgpO1xyXG5cdFx0XHR0aGlzLmMuX2RyYXdQYXR0ZXJuKHggKyB4dywgeSwgdHcsIHRoKTtcclxuXHRcdFx0dGhpcy5lLl9kcmF3UGF0dGVybih4ICsgeHcgKyB0dywgeSwgdGhpcy5lLndpZHRoLCB0aCk7XHJcblx0XHR9XHJcblx0XHR7Ly9ib3R0b21cclxuXHRcdFx0Y29uc3Qgcl9hZGogPSB0aGlzLmFycm93LndpZHRoICYgMTtcclxuXHRcdFx0Y29uc3QgYXJyb3dfaHcgPSBNYXRoLnRydW5jKHRoaXMuYXJyb3cud2lkdGggLyAyKTtcclxuXHRcdFx0Y29uc3QgaHdfYXJyb3dfaHcgPSBodyAtIGFycm93X2h3O1xyXG5cdFx0XHJcblx0XHRcdHRoaXMuc3cuZHJhdzIoeCwgeSArIHRoKTtcclxuXHRcdFx0dGhpcy5zLl9kcmF3UGF0dGVybih4LCB5ICsgdGgsIGh3X2Fycm93X2h3LCB0aGlzLnMuaGVpZ2h0KTsvL2NsaXBcclxuXHRcdFx0dGhpcy5zLl9kcmF3UGF0dGVybih4ICsgaHcgKyBhcnJvd19odyArIHJfYWRqLCB5ICsgdGgsIGh3X2Fycm93X2h3IC0gcl9hZGosIHRoaXMucy5oZWlnaHQpOy8vY2xpcFxyXG5cdFx0XHR0aGlzLnNlLmRyYXcyKHggKyB0dywgeSArIHRoKTtcclxuXHJcblx0XHRcdHRoaXMuYXJyb3cuZHJhdzIoeCAtIGFycm93X2h3ICsgaHcsIHkgKyB0aCk7XHJcblx0XHR9XHJcblxyXG5cdFx0Zm9yIChsZXQgaSA9IDAsIGN5ID0geTsgaSA8IGxpbmVzLmxlbmd0aDsgKytpLCBjeSArPSBMSU5FX0hFSUdIVCkge1xyXG5cdFx0XHRsZXQgbGluZSA9IGxpbmVzW2ldO1xyXG5cclxuXHRcdFx0Ly9pZiAodGhpcy5jb25zdHJ1Y3Rvci5ERUJVRykge1xyXG5cdFx0XHQvL1x0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0XHQvL1x0Y3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcclxuXHRcdFx0Ly9cdGN0eC5zdHJva2VSZWN0KHggKyBQQURESU5HX0xFRlQsIGN5ICsgUEFERElOR19UT1AsIHR3LCBMSU5FX0hFSUdIVCk7XHJcblx0XHRcdC8vfVxyXG5cdFx0XHQvL2N0eC5maWxsU3R5bGUgPSBcImJsYWNrXCI7XHJcblxyXG5cdFx0XHRjdHguZmlsbFRleHQobGluZSwgeCArIGh3ICsgUEFERElOR19MRUZULCBjeSArIFBBRERJTkdfVE9QKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL1VJL0NoYXRCYWxsb29uXCI7XHJcblx0fVxyXG5cclxuXHQvL3N0YXRpYyBnZXQgREVCVUcoKSB7XHJcblx0Ly9cdHJldHVybiBmYWxzZTtcclxuXHQvL31cclxufVxyXG5cclxuLyoqIEB0eXBlIHt7W3N0eWxlOm51bWJlcl06Q2hhdEJhbGxvb259fSAqL1xyXG5DaGF0QmFsbG9vbi5jYWNoZSA9IHdpbmRvdy4kaW1hZ2VzX0NoYXRCYWxsb29uIHx8IHt9O1xyXG5cclxud2luZG93LiRpbWFnZXNfQ2hhdEJhbGxvb24gPSBDaGF0QmFsbG9vbi5jYWNoZTtcclxuXHJcbmlmIChtb2R1bGUuaG90KSB7XHJcblx0T2JqZWN0LnZhbHVlcyhDaGF0QmFsbG9vbi5jYWNoZSkuZm9yRWFjaChhID0+IHtcclxuXHRcdGEuX19wcm90b19fID0gQ2hhdEJhbGxvb24ucHJvdG90eXBlO1xyXG5cdFx0Ly9hLmxvYWQoYS5zdHlsZSk7XHJcblx0fSk7XHJcblx0bW9kdWxlLmhvdC5hY2NlcHQoKTtcclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Renderer/ChatBalloon.js\n");

/***/ }),

/***/ "./src/game/Renderer/DamageNumber.js":
/*!*******************************************!*\
  !*** ./src/game/Renderer/DamageNumber.js ***!
  \*******************************************/
/*! exports provided: DamageNumber, DamageNumberTest, DamageNumberLayer, damageNumberLayer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DamageNumber\", function() { return DamageNumber; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DamageNumberTest\", function() { return DamageNumberTest; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"DamageNumberLayer\", function() { return DamageNumberLayer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"damageNumberLayer\", function() { return damageNumberLayer; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _Layer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Layer.js */ \"./src/game/Renderer/Layer.js\");\n/* harmony import */ var _RenderingOption_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./RenderingOption.js */ \"./src/game/Renderer/RenderingOption.js\");\n/* harmony import */ var _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../Common/AttackInfo.js */ \"./src/Common/AttackInfo.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n// 123\r\n// NoRed[1][1], NoRed[0][2], NoRed[0][3], ...\r\n\r\nclass _DamageSkin {\r\n\tconstructor() {\r\n\t\t/** @type {DamageNumberTextures} */\r\n\t\tthis.NoRed = null;\r\n\t\t/** @type {DamageNumberTextures} */\r\n\t\tthis.NoCri = null;\r\n\t}\r\n}\r\nclass _DamageSkinDefault extends _DamageSkin {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tthis.NoBlue = null;\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tthis.NoViolet = null;\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tthis.NoProduction = null;\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tthis.NoKite = null;\r\n\t}\r\n}\r\n\r\n\r\n/** @type {{default:_DamageSkinDefault,[skin:string]:_DamageSkin}} */\r\nconst loaded_skin = {};\r\n\r\nclass DamageNumberTextures {\r\n\tconstructor() {\r\n\t\t/** @type {Sprite} */\r\n\t\tfor (let i = 0; i <= 9; ++i) {\r\n\t\t\tthis[i] = null;\r\n\t\t}\r\n\t\tthis.addedCanvasH = 0;\r\n\t}\r\n\t/**\r\n\t * @param {string} path\r\n\t */\r\n\tasync _load(path) {\r\n\t\tconst _raw = await $get.data(path);\r\n\t\t\r\n\t\tObject.keys(_raw).forEach(key => {\r\n\t\t\tlet texture = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](_raw[key]);\r\n\r\n\t\t\ttexture._url = [path, key].join(\"/\");\r\n\r\n\t\t\tthis[key] = texture;\r\n\t\t});\r\n\r\n\t\tthis.addedCanvasH = _raw.addedCanvasH | 0;\r\n\t}\r\n}\r\n/** @type {Sprite} */\r\nDamageNumberTextures.prototype.Miss = null;\r\n/** @type {Sprite} */\r\nDamageNumberTextures.prototype.guard = null;\r\n/** @type {Sprite} */\r\nDamageNumberTextures.prototype.shot = null;\r\n/** @type {Sprite} */\r\nDamageNumberTextures.prototype.effect = null;\r\n\r\n\r\nfunction font_adv(texture) {\r\n\treturn texture.width * 3 / 4;\r\n}\r\n\r\nfunction draw_axis(ctx, x, y) {\r\n\tctx.strokeStyle = \"#F00\";\r\n\tctx.beginPath();\r\n\tctx.moveTo(x, y);\r\n\tctx.lineTo(x, y + 10);\r\n\tctx.stroke();\r\n\r\n\tctx.strokeStyle = \"#0F0\";\r\n\tctx.beginPath();\r\n\tctx.moveTo(x, y);\r\n\tctx.lineTo(x + 10, y);\r\n\tctx.stroke();\r\n}\r\n\r\nclass DamageNumberRenderer {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis._url = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.style = null;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.skin = null;\r\n\r\n\t\t/** @type {DamageNumberTextures[]} - this.textures[is_first_num ? 1:0][num] */\r\n\t\tthis.textures = [];\r\n\r\n\t\t/** @type {number[]} */\r\n\t\tthis.rand_y = [0];\r\n\t\tfor (let i = 1, sign = Math.random() > 0.5 ? -1:1; i < DamageNumberRenderer.max_display_digit; ++i) {\r\n\t\t\tthis.rand_y[i] = Math.random() * DamageNumberRenderer.max_rand_y * sign;\r\n\t\t\tsign *= -1;\r\n\t\t}\r\n\r\n\t\t///** @type {Promise<void>} */\r\n\t\t//this._$promise = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {DamageNumberRenderer} other\r\n\t */\r\n\t_copy(other) {\r\n\t\tthis._url = other._url;\r\n\t\tthis.skin = other.skin;\r\n\t\tthis.style = other.style;\r\n\t\tthis.textures = other.textures;\r\n\r\n\t\t//loading\r\n\t\tif (this._$promise) {\r\n\t\t\tthis._$promise = other._$promise;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t * @returns {Promise<DamageNumberRenderer>}\r\n\t */\r\n\tasync _load(skin, style) {\r\n\t\tlet tasks = [];\r\n\t\tlet url;\r\n\r\n\t\tif (skin == \"default\") {\r\n\t\t\turl = this._default_base_path + style;\r\n\t\t}\r\n\t\telse {\r\n\t\t\turl = this._skin_base_path + [skin, style].join(\"/\");\r\n\t\t}\r\n\r\n\t\tif (!loaded_skin[skin]) {\r\n\t\t\tloaded_skin[skin] = {};\r\n\t\t}\r\n\t\tloaded_skin[skin][style] = this;\r\n\r\n\t\tthis._url = url;\r\n\t\tthis.skin = skin;\r\n\t\tthis.style = style;\r\n\r\n\t\tfor (let i = 0; i <= 1; ++i) {\r\n\t\t\tconst sPath = url + i;\r\n\t\t\t\r\n\t\t\tthis.textures[i] = new DamageNumberTextures();\r\n\r\n\t\t\ttasks[i] = this.textures[i]._load(sPath);\r\n\t\t}\r\n\r\n\t\tawait Promise.all(tasks);\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t * @returns {Promise<DamageNumberRenderer>}\r\n\t */\r\n\tasync load(skin, style) {\r\n\t\tlet loaded;\r\n\r\n\t\tif (loaded_skin[skin]) {\r\n\t\t\tloaded = loaded_skin[skin][style];\r\n\t\t}\r\n\r\n\t\tif (loaded) {\r\n\t\t\tthis._copy(skin, loaded);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._$promise = this._load(skin, style);\r\n\r\n\t\t\tawait this._$promise;\r\n\r\n\t\t\tdelete this._$promise;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} damage\r\n\t * @param {boolean} critical\r\n\t * @param {number} cx\r\n\t * @param {number} cy\r\n\t */\r\n\tdraw(renderer, damage, critical, cx, cy) {\r\n\t\tlet str_damage = damage.toFixed(0);\r\n\r\n\t\t/** @type {Sprite} */\r\n\t\tlet texture;\r\n\t\tlet text_width = 0;\r\n\r\n\t\t{\r\n\t\t\ttexture = this.textures[1][str_damage[0]];\r\n\t\t\ttext_width += -texture.x;\r\n\t\t\ttext_width += font_adv(texture);\r\n\r\n\t\t\tfor (let i = 1; i < str_damage.length - 1; ++i) {\r\n\t\t\t\ttexture = this.textures[0][str_damage[i]];\r\n\r\n\t\t\t\ttext_width += font_adv(texture);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t{\r\n\t\t\tlet x = cx - text_width / 2;\r\n\r\n\t\t\ttexture = this.textures[1][str_damage[0]];\r\n\t\t\ttexture.draw2(x, cy);\r\n\t\t\tx += font_adv(texture);\r\n\r\n\t\t\tfor (let i = 1; i < str_damage.length; ++i) {\r\n\t\t\t\ttexture = this.textures[0][str_damage[i]];\r\n\r\n\t\t\t\ttexture.draw2(x, cy + this.rand_y[i]);\r\n\r\n\t\t\t\tx += font_adv(texture);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._display_axis) {\r\n\t\t\tconst ctx = renderer.ctx;\r\n\t\t\tlet x = cx - text_width / 2;\r\n\r\n\t\t\ttexture = this.textures[1][str_damage[0]];\r\n\t\t\tdraw_axis(ctx, x, cy);\r\n\t\t\tx += font_adv(texture);\r\n\r\n\t\t\tfor (let i = 1; i < str_damage.length; ++i) {\r\n\t\t\t\ttexture = this.textures[0][str_damage[i]];\r\n\r\n\t\t\t\tdraw_axis(ctx, x, cy + this.rand_y[i]);\r\n\r\n\t\t\t\tx += font_adv(texture);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tget _default_base_path() {\r\n\t\treturn \"/Effect/BasicEff/\";\r\n\t}\r\n\tget _skin_base_path() {\r\n\t\treturn \"/Effect/BasicEff/damageSkin/\";\r\n\t}\r\n}\r\nDamageNumberRenderer.loaded_skin = loaded_skin;\r\nDamageNumberRenderer.max_display_digit = Math.trunc(Math.log10(Number.MAX_SAFE_INTEGER) + 1);\r\nDamageNumberRenderer.max_rand_y = 5;\r\n\r\n\r\nclass DamageNumber extends _Layer_js__WEBPACK_IMPORTED_MODULE_2__[\"LayerObject\"] {\r\n\t/**\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t * @param {DamagePair} damagePair\r\n\t * @param {number} x - center_x\r\n\t * @param {number} y - bottom_y\r\n\t * @param {number} delay\r\n\t */\r\n\tconstructor(skin, style, damagePair, x, y, delay) {\r\n\t\tsuper();\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\tthis.vy = DamageNumber.move_y / DamageNumber.time_tt;\r\n\r\n\t\tthis.delay = delay;\r\n\t\tthis.time = 0;\r\n\t\tthis.state = 0;\r\n\r\n\t\tthis.damagePair = damagePair;\r\n\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tthis.renderer;\r\n\r\n\t\tthis._load(skin, style);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t * @param {number} recursive\r\n\t */\r\n\t_load(skin, style, recursive) {\r\n\t\t/** @type {DamageNumberRenderer} */\r\n\t\tlet loaded;\r\n\t\t\r\n\t\tif (loaded_skin[skin]) {\r\n\t\t\tloaded = loaded_skin[skin][style];\r\n\t\t}\r\n\r\n\t\tif (loaded) {\r\n\t\t\tthis.renderer = loaded;\r\n\r\n\t\t\tthis._$promise = this.renderer._$promise;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.renderer = new DamageNumberRenderer();\r\n\t\t\tthis._$promise = this.renderer.load(skin, style);\r\n\t\t}\r\n\t\tif (this._$promise) {\r\n\t\t\tthis.render = this.$noRender;\r\n\r\n\t\t\tthis._$promise\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\tdelete this.render;\r\n\t\t\t\t\tdelete this._$promise;\r\n\t\t\t\t}).catch(() => {\r\n\t\t\t\t\tdelete this._$promise;\r\n\t\t\t\t\tconsole.error(`Can't load damageSkin[${skin}][${style}]`);\r\n\r\n\t\t\t\t\tif (recursive) {\r\n\t\t\t\t\t\tthrow Error();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tconsole.log(`try load damageSkin[\"default\"][${style}]`);\r\n\t\t\t\t\t\tthis._load(\"default\", style, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t$noRender() {\r\n\t\t// nothing\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.state = 2;\r\n\t}\r\n\r\n\tisEnd() {\r\n\t\treturn this.state >= 1 && this.time > 1000;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.time += stamp;\r\n\r\n\t\tif (this.delay && this.time >= this.delay) {\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.delay = 0;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.y += this.vy * stamp;\r\n\r\n\t\t\tif (this.state == 0) {\r\n\t\t\t\tthis.vy = this.vy * DamageNumber.move_avy;\r\n\r\n\t\t\t\tif (this.time > DamageNumber.time_d1) {\r\n\t\t\t\t\tthis.time = 0;\r\n\t\t\t\t\tthis.state = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (this.state == 1) {\r\n\t\t\t\tthis.vy = this.vy * DamageNumber.move_avy2;\r\n\r\n\t\t\t\tif (this.time < DamageNumber.time_d2) {\r\n\t\t\t\t\tthis.opacity = 1 - (this.time / DamageNumber.time_d2);\r\n\t\t\t\t\t//this.opacity = Math.clamp(this.opacity, 0, 1);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.opacity = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {RenderingOption} option\r\n\t */\r\n\trender(renderer, option) {\r\n\t\trenderer.globalAlpha = this.opacity * option.opacity;\r\n\t\tthis.renderer.draw(renderer, this.damagePair.realDamage, this.damagePair.critical, this.x, this.y);\r\n\t}\r\n}\r\nDamageNumber.time_d1 = 1000;\r\nDamageNumber.time_d2 = 1000;\r\nDamageNumber.time_tt = DamageNumber.time_d1 + DamageNumber.time_d2;\r\nDamageNumber.move_y = -300;\r\nDamageNumber.move_avy = 1.001;\r\nDamageNumber.move_avy2 = 0.99;\r\n\r\nclass DamageNumberTest extends DamageNumber {\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t}\r\n\tisEnd() {\r\n\t\treturn this.is_end;\r\n\t}\r\n}\r\n\r\nclass DamageNumberLayer extends _Layer_js__WEBPACK_IMPORTED_MODULE_2__[\"Layer\"] {\r\n\t//constructor() {\r\n\t//\tsuper();\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {number} realDamage\r\n\t * @param {number} critical\r\n\t * @param {number} x - center_x\r\n\t * @param {number} y - bottom_y\r\n\t * @param {number} delay\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t */\r\n\t_addTest(realDamage = 9876543210, critical = false, x = 0, y = 0, delay = 0, skin = null, style = \"NoRed\") {\r\n\t\tthis.objects.push(new DamageNumber(skin, style, new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_4__[\"DamagePair\"](realDamage, critical), x, y, delay));\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} realDamage\r\n\t * @param {number} critical\r\n\t * @param {number} x - center_x\r\n\t * @param {number} y - bottom_y\r\n\t * @param {number} delay\r\n\t * @param {string} skin\r\n\t * @param {string} style\r\n\t */\r\n\t_addTest2(realDamage = 9876543210, critical = false, x = 0, y = 0, delay = 0, skin = null, style = \"NoRed\") {\r\n\t\tthis.objects.push(new DamageNumberTest(skin, style, new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_4__[\"DamagePair\"](realDamage, critical), x, y, delay));\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} style\r\n\t * @param {AttackInfo} attackInfo\r\n\t */\r\n\t_addAttack(skin, style, attackInfo) {\r\n\t\tattackInfo.allAttack.forEach(attack => {\r\n\t\t\tlet target = attack.getTargetObject();\r\n\t\t\tif (target) {\r\n\t\t\t\tconst pos = target.$physics.getPosition();\r\n\t\t\t\tlet x, y;\r\n\r\n\t\t\t\tx = pos.x * $gv.CANVAS_SCALE;\r\n\t\t\t\ty = pos.y * $gv.CANVAS_SCALE - 70;\r\n\r\n\t\t\t\tattack.allDamage.forEach(damage => {\r\n\t\t\t\t\tthis.addDamagePair(skin, style, damage, x, y);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @template K\r\n\t * @param {string} skin\r\n\t * @param {K extends keyof loaded_skin[skin] ? K:never} style\r\n\t * @param {DamagePair} damagePair\r\n\t * @param {number} x - center_x\r\n\t * @param {number} y - bottom_y\r\n\t * @param {number} delay\r\n\t */\r\n\taddDamagePair(skin, style, damagePair, x, y, delay = 0) {\r\n\t\tthis.objects.push(new DamageNumber(skin, style, damagePair, x, y, delay));\r\n\t}\r\n}\r\n\r\n\r\nconst damageNumberLayer = new DamageNumberLayer();\r\n\r\nwindow.$damageNumberLayer = damageNumberLayer;\r\nwindow.$DamageNumber = DamageNumber\r\nwindow.$DamageNumberTest = DamageNumberTest;\r\nwindow.$DamageNumberRenderer = DamageNumberRenderer;\r\n//DamageNumberRenderer.prototype._display_axis = true;\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9EYW1hZ2VOdW1iZXIuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9SZW5kZXJlci9EYW1hZ2VOdW1iZXIuanM/MDVjZiJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgSVJlbmRlcmVyIH0gZnJvbSBcIi4uL0lSZW5kZXJlci5qc1wiO1xyXG5pbXBvcnQgeyBTcHJpdGUgfSBmcm9tIFwiLi4vU3ByaXRlLmpzXCI7XHJcbmltcG9ydCB7IExheWVyT2JqZWN0LCBMYXllciB9IGZyb20gXCIuL0xheWVyLmpzXCI7XHJcbmltcG9ydCB7IFJlbmRlcmluZ09wdGlvbiB9IGZyb20gXCIuL1JlbmRlcmluZ09wdGlvbi5qc1wiO1xyXG5pbXBvcnQgeyBEYW1hZ2VQYWlyLCBBdHRhY2tJbmZvIH0gZnJvbSBcIi4uLy4uL0NvbW1vbi9BdHRhY2tJbmZvLmpzXCI7XHJcblxyXG4vLyAxMjNcclxuLy8gTm9SZWRbMV1bMV0sIE5vUmVkWzBdWzJdLCBOb1JlZFswXVszXSwgLi4uXHJcblxyXG5jbGFzcyBfRGFtYWdlU2tpbiB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge0RhbWFnZU51bWJlclRleHR1cmVzfSAqL1xyXG5cdFx0dGhpcy5Ob1JlZCA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0RhbWFnZU51bWJlclRleHR1cmVzfSAqL1xyXG5cdFx0dGhpcy5Ob0NyaSA9IG51bGw7XHJcblx0fVxyXG59XHJcbmNsYXNzIF9EYW1hZ2VTa2luRGVmYXVsdCBleHRlbmRzIF9EYW1hZ2VTa2luIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtEYW1hZ2VOdW1iZXJSZW5kZXJlcn0gKi9cclxuXHRcdHRoaXMuTm9CbHVlID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7RGFtYWdlTnVtYmVyUmVuZGVyZXJ9ICovXHJcblx0XHR0aGlzLk5vVmlvbGV0ID0gbnVsbDtcclxuXHRcdC8qKiBAdHlwZSB7RGFtYWdlTnVtYmVyUmVuZGVyZXJ9ICovXHJcblx0XHR0aGlzLk5vUHJvZHVjdGlvbiA9IG51bGw7XHJcblx0XHQvKiogQHR5cGUge0RhbWFnZU51bWJlclJlbmRlcmVyfSAqL1xyXG5cdFx0dGhpcy5Ob0tpdGUgPSBudWxsO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbi8qKiBAdHlwZSB7e2RlZmF1bHQ6X0RhbWFnZVNraW5EZWZhdWx0LFtza2luOnN0cmluZ106X0RhbWFnZVNraW59fSAqL1xyXG5jb25zdCBsb2FkZWRfc2tpbiA9IHt9O1xyXG5cclxuY2xhc3MgRGFtYWdlTnVtYmVyVGV4dHVyZXMge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtTcHJpdGV9ICovXHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8PSA5OyArK2kpIHtcclxuXHRcdFx0dGhpc1tpXSA9IG51bGw7XHJcblx0XHR9XHJcblx0XHR0aGlzLmFkZGVkQ2FudmFzSCA9IDA7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoXHJcblx0ICovXHJcblx0YXN5bmMgX2xvYWQocGF0aCkge1xyXG5cdFx0Y29uc3QgX3JhdyA9IGF3YWl0ICRnZXQuZGF0YShwYXRoKTtcclxuXHRcdFxyXG5cdFx0T2JqZWN0LmtleXMoX3JhdykuZm9yRWFjaChrZXkgPT4ge1xyXG5cdFx0XHRsZXQgdGV4dHVyZSA9IG5ldyBTcHJpdGUoX3Jhd1trZXldKTtcclxuXHJcblx0XHRcdHRleHR1cmUuX3VybCA9IFtwYXRoLCBrZXldLmpvaW4oXCIvXCIpO1xyXG5cclxuXHRcdFx0dGhpc1trZXldID0gdGV4dHVyZTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRoaXMuYWRkZWRDYW52YXNIID0gX3Jhdy5hZGRlZENhbnZhc0ggfCAwO1xyXG5cdH1cclxufVxyXG4vKiogQHR5cGUge1Nwcml0ZX0gKi9cclxuRGFtYWdlTnVtYmVyVGV4dHVyZXMucHJvdG90eXBlLk1pc3MgPSBudWxsO1xyXG4vKiogQHR5cGUge1Nwcml0ZX0gKi9cclxuRGFtYWdlTnVtYmVyVGV4dHVyZXMucHJvdG90eXBlLmd1YXJkID0gbnVsbDtcclxuLyoqIEB0eXBlIHtTcHJpdGV9ICovXHJcbkRhbWFnZU51bWJlclRleHR1cmVzLnByb3RvdHlwZS5zaG90ID0gbnVsbDtcclxuLyoqIEB0eXBlIHtTcHJpdGV9ICovXHJcbkRhbWFnZU51bWJlclRleHR1cmVzLnByb3RvdHlwZS5lZmZlY3QgPSBudWxsO1xyXG5cclxuXHJcbmZ1bmN0aW9uIGZvbnRfYWR2KHRleHR1cmUpIHtcclxuXHRyZXR1cm4gdGV4dHVyZS53aWR0aCAqIDMgLyA0O1xyXG59XHJcblxyXG5mdW5jdGlvbiBkcmF3X2F4aXMoY3R4LCB4LCB5KSB7XHJcblx0Y3R4LnN0cm9rZVN0eWxlID0gXCIjRjAwXCI7XHJcblx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdGN0eC5tb3ZlVG8oeCwgeSk7XHJcblx0Y3R4LmxpbmVUbyh4LCB5ICsgMTApO1xyXG5cdGN0eC5zdHJva2UoKTtcclxuXHJcblx0Y3R4LnN0cm9rZVN0eWxlID0gXCIjMEYwXCI7XHJcblx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdGN0eC5tb3ZlVG8oeCwgeSk7XHJcblx0Y3R4LmxpbmVUbyh4ICsgMTAsIHkpO1xyXG5cdGN0eC5zdHJva2UoKTtcclxufVxyXG5cclxuY2xhc3MgRGFtYWdlTnVtYmVyUmVuZGVyZXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl91cmwgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5zdHlsZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLnNraW4gPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7RGFtYWdlTnVtYmVyVGV4dHVyZXNbXX0gLSB0aGlzLnRleHR1cmVzW2lzX2ZpcnN0X251bSA/IDE6MF1bbnVtXSAqL1xyXG5cdFx0dGhpcy50ZXh0dXJlcyA9IFtdO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyW119ICovXHJcblx0XHR0aGlzLnJhbmRfeSA9IFswXTtcclxuXHRcdGZvciAobGV0IGkgPSAxLCBzaWduID0gTWF0aC5yYW5kb20oKSA+IDAuNSA/IC0xOjE7IGkgPCBEYW1hZ2VOdW1iZXJSZW5kZXJlci5tYXhfZGlzcGxheV9kaWdpdDsgKytpKSB7XHJcblx0XHRcdHRoaXMucmFuZF95W2ldID0gTWF0aC5yYW5kb20oKSAqIERhbWFnZU51bWJlclJlbmRlcmVyLm1heF9yYW5kX3kgKiBzaWduO1xyXG5cdFx0XHRzaWduICo9IC0xO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vLyoqIEB0eXBlIHtQcm9taXNlPHZvaWQ+fSAqL1xyXG5cdFx0Ly90aGlzLl8kcHJvbWlzZSA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0RhbWFnZU51bWJlclJlbmRlcmVyfSBvdGhlclxyXG5cdCAqL1xyXG5cdF9jb3B5KG90aGVyKSB7XHJcblx0XHR0aGlzLl91cmwgPSBvdGhlci5fdXJsO1xyXG5cdFx0dGhpcy5za2luID0gb3RoZXIuc2tpbjtcclxuXHRcdHRoaXMuc3R5bGUgPSBvdGhlci5zdHlsZTtcclxuXHRcdHRoaXMudGV4dHVyZXMgPSBvdGhlci50ZXh0dXJlcztcclxuXHJcblx0XHQvL2xvYWRpbmdcclxuXHRcdGlmICh0aGlzLl8kcHJvbWlzZSkge1xyXG5cdFx0XHR0aGlzLl8kcHJvbWlzZSA9IG90aGVyLl8kcHJvbWlzZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2luXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlXHJcblx0ICogQHJldHVybnMge1Byb21pc2U8RGFtYWdlTnVtYmVyUmVuZGVyZXI+fVxyXG5cdCAqL1xyXG5cdGFzeW5jIF9sb2FkKHNraW4sIHN0eWxlKSB7XHJcblx0XHRsZXQgdGFza3MgPSBbXTtcclxuXHRcdGxldCB1cmw7XHJcblxyXG5cdFx0aWYgKHNraW4gPT0gXCJkZWZhdWx0XCIpIHtcclxuXHRcdFx0dXJsID0gdGhpcy5fZGVmYXVsdF9iYXNlX3BhdGggKyBzdHlsZTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR1cmwgPSB0aGlzLl9za2luX2Jhc2VfcGF0aCArIFtza2luLCBzdHlsZV0uam9pbihcIi9cIik7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCFsb2FkZWRfc2tpbltza2luXSkge1xyXG5cdFx0XHRsb2FkZWRfc2tpbltza2luXSA9IHt9O1xyXG5cdFx0fVxyXG5cdFx0bG9hZGVkX3NraW5bc2tpbl1bc3R5bGVdID0gdGhpcztcclxuXHJcblx0XHR0aGlzLl91cmwgPSB1cmw7XHJcblx0XHR0aGlzLnNraW4gPSBza2luO1xyXG5cdFx0dGhpcy5zdHlsZSA9IHN0eWxlO1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDw9IDE7ICsraSkge1xyXG5cdFx0XHRjb25zdCBzUGF0aCA9IHVybCArIGk7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLnRleHR1cmVzW2ldID0gbmV3IERhbWFnZU51bWJlclRleHR1cmVzKCk7XHJcblxyXG5cdFx0XHR0YXNrc1tpXSA9IHRoaXMudGV4dHVyZXNbaV0uX2xvYWQoc1BhdGgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGF3YWl0IFByb21pc2UuYWxsKHRhc2tzKTtcclxuXHJcblx0XHRyZXR1cm4gdGhpcztcclxuXHR9XHJcblx0XHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpblxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZVxyXG5cdCAqIEByZXR1cm5zIHtQcm9taXNlPERhbWFnZU51bWJlclJlbmRlcmVyPn1cclxuXHQgKi9cclxuXHRhc3luYyBsb2FkKHNraW4sIHN0eWxlKSB7XHJcblx0XHRsZXQgbG9hZGVkO1xyXG5cclxuXHRcdGlmIChsb2FkZWRfc2tpbltza2luXSkge1xyXG5cdFx0XHRsb2FkZWQgPSBsb2FkZWRfc2tpbltza2luXVtzdHlsZV07XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKGxvYWRlZCkge1xyXG5cdFx0XHR0aGlzLl9jb3B5KHNraW4sIGxvYWRlZCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fJHByb21pc2UgPSB0aGlzLl9sb2FkKHNraW4sIHN0eWxlKTtcclxuXHJcblx0XHRcdGF3YWl0IHRoaXMuXyRwcm9taXNlO1xyXG5cclxuXHRcdFx0ZGVsZXRlIHRoaXMuXyRwcm9taXNlO1xyXG5cdFx0fVxyXG5cclxuXHRcdHJldHVybiB0aGlzO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGRhbWFnZVxyXG5cdCAqIEBwYXJhbSB7Ym9vbGVhbn0gY3JpdGljYWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY3hcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY3lcclxuXHQgKi9cclxuXHRkcmF3KHJlbmRlcmVyLCBkYW1hZ2UsIGNyaXRpY2FsLCBjeCwgY3kpIHtcclxuXHRcdGxldCBzdHJfZGFtYWdlID0gZGFtYWdlLnRvRml4ZWQoMCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTcHJpdGV9ICovXHJcblx0XHRsZXQgdGV4dHVyZTtcclxuXHRcdGxldCB0ZXh0X3dpZHRoID0gMDtcclxuXHJcblx0XHR7XHJcblx0XHRcdHRleHR1cmUgPSB0aGlzLnRleHR1cmVzWzFdW3N0cl9kYW1hZ2VbMF1dO1xyXG5cdFx0XHR0ZXh0X3dpZHRoICs9IC10ZXh0dXJlLng7XHJcblx0XHRcdHRleHRfd2lkdGggKz0gZm9udF9hZHYodGV4dHVyZSk7XHJcblxyXG5cdFx0XHRmb3IgKGxldCBpID0gMTsgaSA8IHN0cl9kYW1hZ2UubGVuZ3RoIC0gMTsgKytpKSB7XHJcblx0XHRcdFx0dGV4dHVyZSA9IHRoaXMudGV4dHVyZXNbMF1bc3RyX2RhbWFnZVtpXV07XHJcblxyXG5cdFx0XHRcdHRleHRfd2lkdGggKz0gZm9udF9hZHYodGV4dHVyZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR7XHJcblx0XHRcdGxldCB4ID0gY3ggLSB0ZXh0X3dpZHRoIC8gMjtcclxuXHJcblx0XHRcdHRleHR1cmUgPSB0aGlzLnRleHR1cmVzWzFdW3N0cl9kYW1hZ2VbMF1dO1xyXG5cdFx0XHR0ZXh0dXJlLmRyYXcyKHgsIGN5KTtcclxuXHRcdFx0eCArPSBmb250X2Fkdih0ZXh0dXJlKTtcclxuXHJcblx0XHRcdGZvciAobGV0IGkgPSAxOyBpIDwgc3RyX2RhbWFnZS5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdHRleHR1cmUgPSB0aGlzLnRleHR1cmVzWzBdW3N0cl9kYW1hZ2VbaV1dO1xyXG5cclxuXHRcdFx0XHR0ZXh0dXJlLmRyYXcyKHgsIGN5ICsgdGhpcy5yYW5kX3lbaV0pO1xyXG5cclxuXHRcdFx0XHR4ICs9IGZvbnRfYWR2KHRleHR1cmUpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuX2Rpc3BsYXlfYXhpcykge1xyXG5cdFx0XHRjb25zdCBjdHggPSByZW5kZXJlci5jdHg7XHJcblx0XHRcdGxldCB4ID0gY3ggLSB0ZXh0X3dpZHRoIC8gMjtcclxuXHJcblx0XHRcdHRleHR1cmUgPSB0aGlzLnRleHR1cmVzWzFdW3N0cl9kYW1hZ2VbMF1dO1xyXG5cdFx0XHRkcmF3X2F4aXMoY3R4LCB4LCBjeSk7XHJcblx0XHRcdHggKz0gZm9udF9hZHYodGV4dHVyZSk7XHJcblxyXG5cdFx0XHRmb3IgKGxldCBpID0gMTsgaSA8IHN0cl9kYW1hZ2UubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0XHR0ZXh0dXJlID0gdGhpcy50ZXh0dXJlc1swXVtzdHJfZGFtYWdlW2ldXTtcclxuXHJcblx0XHRcdFx0ZHJhd19heGlzKGN0eCwgeCwgY3kgKyB0aGlzLnJhbmRfeVtpXSk7XHJcblxyXG5cdFx0XHRcdHggKz0gZm9udF9hZHYodGV4dHVyZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBfZGVmYXVsdF9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gXCIvRWZmZWN0L0Jhc2ljRWZmL1wiO1xyXG5cdH1cclxuXHRnZXQgX3NraW5fYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL0VmZmVjdC9CYXNpY0VmZi9kYW1hZ2VTa2luL1wiO1xyXG5cdH1cclxufVxyXG5EYW1hZ2VOdW1iZXJSZW5kZXJlci5sb2FkZWRfc2tpbiA9IGxvYWRlZF9za2luO1xyXG5EYW1hZ2VOdW1iZXJSZW5kZXJlci5tYXhfZGlzcGxheV9kaWdpdCA9IE1hdGgudHJ1bmMoTWF0aC5sb2cxMChOdW1iZXIuTUFYX1NBRkVfSU5URUdFUikgKyAxKTtcclxuRGFtYWdlTnVtYmVyUmVuZGVyZXIubWF4X3JhbmRfeSA9IDU7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIERhbWFnZU51bWJlciBleHRlbmRzIExheWVyT2JqZWN0IHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpblxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZVxyXG5cdCAqIEBwYXJhbSB7RGFtYWdlUGFpcn0gZGFtYWdlUGFpclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gY2VudGVyX3hcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSAtIGJvdHRvbV95XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGRlbGF5XHJcblx0ICovXHJcblx0Y29uc3RydWN0b3Ioc2tpbiwgc3R5bGUsIGRhbWFnZVBhaXIsIHgsIHksIGRlbGF5KSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdHRoaXMueCA9IHg7XHJcblx0XHR0aGlzLnkgPSB5O1xyXG5cclxuXHRcdHRoaXMudnkgPSBEYW1hZ2VOdW1iZXIubW92ZV95IC8gRGFtYWdlTnVtYmVyLnRpbWVfdHQ7XHJcblxyXG5cdFx0dGhpcy5kZWxheSA9IGRlbGF5O1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHRcdHRoaXMuc3RhdGUgPSAwO1xyXG5cclxuXHRcdHRoaXMuZGFtYWdlUGFpciA9IGRhbWFnZVBhaXI7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtEYW1hZ2VOdW1iZXJSZW5kZXJlcn0gKi9cclxuXHRcdHRoaXMucmVuZGVyZXI7XHJcblxyXG5cdFx0dGhpcy5fbG9hZChza2luLCBzdHlsZSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpblxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBzdHlsZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSByZWN1cnNpdmVcclxuXHQgKi9cclxuXHRfbG9hZChza2luLCBzdHlsZSwgcmVjdXJzaXZlKSB7XHJcblx0XHQvKiogQHR5cGUge0RhbWFnZU51bWJlclJlbmRlcmVyfSAqL1xyXG5cdFx0bGV0IGxvYWRlZDtcclxuXHRcdFxyXG5cdFx0aWYgKGxvYWRlZF9za2luW3NraW5dKSB7XHJcblx0XHRcdGxvYWRlZCA9IGxvYWRlZF9za2luW3NraW5dW3N0eWxlXTtcclxuXHRcdH1cclxuXHJcblx0XHRpZiAobG9hZGVkKSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIgPSBsb2FkZWQ7XHJcblxyXG5cdFx0XHR0aGlzLl8kcHJvbWlzZSA9IHRoaXMucmVuZGVyZXIuXyRwcm9taXNlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIgPSBuZXcgRGFtYWdlTnVtYmVyUmVuZGVyZXIoKTtcclxuXHRcdFx0dGhpcy5fJHByb21pc2UgPSB0aGlzLnJlbmRlcmVyLmxvYWQoc2tpbiwgc3R5bGUpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKHRoaXMuXyRwcm9taXNlKSB7XHJcblx0XHRcdHRoaXMucmVuZGVyID0gdGhpcy4kbm9SZW5kZXI7XHJcblxyXG5cdFx0XHR0aGlzLl8kcHJvbWlzZVxyXG5cdFx0XHRcdC50aGVuKCgpID0+IHtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLnJlbmRlcjtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLl8kcHJvbWlzZTtcclxuXHRcdFx0XHR9KS5jYXRjaCgoKSA9PiB7XHJcblx0XHRcdFx0XHRkZWxldGUgdGhpcy5fJHByb21pc2U7XHJcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGBDYW4ndCBsb2FkIGRhbWFnZVNraW5bJHtza2lufV1bJHtzdHlsZX1dYCk7XHJcblxyXG5cdFx0XHRcdFx0aWYgKHJlY3Vyc2l2ZSkge1xyXG5cdFx0XHRcdFx0XHR0aHJvdyBFcnJvcigpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGB0cnkgbG9hZCBkYW1hZ2VTa2luW1wiZGVmYXVsdFwiXVske3N0eWxlfV1gKTtcclxuXHRcdFx0XHRcdFx0dGhpcy5fbG9hZChcImRlZmF1bHRcIiwgc3R5bGUsIDEpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0JG5vUmVuZGVyKCkge1xyXG5cdFx0Ly8gbm90aGluZ1xyXG5cdH1cclxuXHJcblx0ZGVzdHJveSgpIHtcclxuXHRcdHRoaXMuc3RhdGUgPSAyO1xyXG5cdH1cclxuXHJcblx0aXNFbmQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5zdGF0ZSA+PSAxICYmIHRoaXMudGltZSA+IDEwMDA7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMudGltZSArPSBzdGFtcDtcclxuXHJcblx0XHRpZiAodGhpcy5kZWxheSAmJiB0aGlzLnRpbWUgPj0gdGhpcy5kZWxheSkge1xyXG5cdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0XHR0aGlzLmRlbGF5ID0gMDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLnkgKz0gdGhpcy52eSAqIHN0YW1wO1xyXG5cclxuXHRcdFx0aWYgKHRoaXMuc3RhdGUgPT0gMCkge1xyXG5cdFx0XHRcdHRoaXMudnkgPSB0aGlzLnZ5ICogRGFtYWdlTnVtYmVyLm1vdmVfYXZ5O1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy50aW1lID4gRGFtYWdlTnVtYmVyLnRpbWVfZDEpIHtcclxuXHRcdFx0XHRcdHRoaXMudGltZSA9IDA7XHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlID0gMTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAodGhpcy5zdGF0ZSA9PSAxKSB7XHJcblx0XHRcdFx0dGhpcy52eSA9IHRoaXMudnkgKiBEYW1hZ2VOdW1iZXIubW92ZV9hdnkyO1xyXG5cclxuXHRcdFx0XHRpZiAodGhpcy50aW1lIDwgRGFtYWdlTnVtYmVyLnRpbWVfZDIpIHtcclxuXHRcdFx0XHRcdHRoaXMub3BhY2l0eSA9IDEgLSAodGhpcy50aW1lIC8gRGFtYWdlTnVtYmVyLnRpbWVfZDIpO1xyXG5cdFx0XHRcdFx0Ly90aGlzLm9wYWNpdHkgPSBNYXRoLmNsYW1wKHRoaXMub3BhY2l0eSwgMCwgMSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dGhpcy5vcGFjaXR5ID0gMDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7UmVuZGVyaW5nT3B0aW9ufSBvcHRpb25cclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIG9wdGlvbikge1xyXG5cdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLm9wYWNpdHkgKiBvcHRpb24ub3BhY2l0eTtcclxuXHRcdHRoaXMucmVuZGVyZXIuZHJhdyhyZW5kZXJlciwgdGhpcy5kYW1hZ2VQYWlyLnJlYWxEYW1hZ2UsIHRoaXMuZGFtYWdlUGFpci5jcml0aWNhbCwgdGhpcy54LCB0aGlzLnkpO1xyXG5cdH1cclxufVxyXG5EYW1hZ2VOdW1iZXIudGltZV9kMSA9IDEwMDA7XHJcbkRhbWFnZU51bWJlci50aW1lX2QyID0gMTAwMDtcclxuRGFtYWdlTnVtYmVyLnRpbWVfdHQgPSBEYW1hZ2VOdW1iZXIudGltZV9kMSArIERhbWFnZU51bWJlci50aW1lX2QyO1xyXG5EYW1hZ2VOdW1iZXIubW92ZV95ID0gLTMwMDtcclxuRGFtYWdlTnVtYmVyLm1vdmVfYXZ5ID0gMS4wMDE7XHJcbkRhbWFnZU51bWJlci5tb3ZlX2F2eTIgPSAwLjk5O1xyXG5cclxuZXhwb3J0IGNsYXNzIERhbWFnZU51bWJlclRlc3QgZXh0ZW5kcyBEYW1hZ2VOdW1iZXIge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdH1cclxuXHRpc0VuZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmlzX2VuZDtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBEYW1hZ2VOdW1iZXJMYXllciBleHRlbmRzIExheWVyIHtcclxuXHQvL2NvbnN0cnVjdG9yKCkge1xyXG5cdC8vXHRzdXBlcigpO1xyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gcmVhbERhbWFnZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjcml0aWNhbFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gY2VudGVyX3hcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSAtIGJvdHRvbV95XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGRlbGF5XHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHNraW5cclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc3R5bGVcclxuXHQgKi9cclxuXHRfYWRkVGVzdChyZWFsRGFtYWdlID0gOTg3NjU0MzIxMCwgY3JpdGljYWwgPSBmYWxzZSwgeCA9IDAsIHkgPSAwLCBkZWxheSA9IDAsIHNraW4gPSBudWxsLCBzdHlsZSA9IFwiTm9SZWRcIikge1xyXG5cdFx0dGhpcy5vYmplY3RzLnB1c2gobmV3IERhbWFnZU51bWJlcihza2luLCBzdHlsZSwgbmV3IERhbWFnZVBhaXIocmVhbERhbWFnZSwgY3JpdGljYWwpLCB4LCB5LCBkZWxheSkpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHJlYWxEYW1hZ2VcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gY3JpdGljYWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geCAtIGNlbnRlcl94XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHkgLSBib3R0b21feVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBkZWxheVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2luXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlXHJcblx0ICovXHJcblx0X2FkZFRlc3QyKHJlYWxEYW1hZ2UgPSA5ODc2NTQzMjEwLCBjcml0aWNhbCA9IGZhbHNlLCB4ID0gMCwgeSA9IDAsIGRlbGF5ID0gMCwgc2tpbiA9IG51bGwsIHN0eWxlID0gXCJOb1JlZFwiKSB7XHJcblx0XHR0aGlzLm9iamVjdHMucHVzaChuZXcgRGFtYWdlTnVtYmVyVGVzdChza2luLCBzdHlsZSwgbmV3IERhbWFnZVBhaXIocmVhbERhbWFnZSwgY3JpdGljYWwpLCB4LCB5LCBkZWxheSkpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHN0eWxlXHJcblx0ICogQHBhcmFtIHtBdHRhY2tJbmZvfSBhdHRhY2tJbmZvXHJcblx0ICovXHJcblx0X2FkZEF0dGFjayhza2luLCBzdHlsZSwgYXR0YWNrSW5mbykge1xyXG5cdFx0YXR0YWNrSW5mby5hbGxBdHRhY2suZm9yRWFjaChhdHRhY2sgPT4ge1xyXG5cdFx0XHRsZXQgdGFyZ2V0ID0gYXR0YWNrLmdldFRhcmdldE9iamVjdCgpO1xyXG5cdFx0XHRpZiAodGFyZ2V0KSB7XHJcblx0XHRcdFx0Y29uc3QgcG9zID0gdGFyZ2V0LiRwaHlzaWNzLmdldFBvc2l0aW9uKCk7XHJcblx0XHRcdFx0bGV0IHgsIHk7XHJcblxyXG5cdFx0XHRcdHggPSBwb3MueCAqICRndi5DQU5WQVNfU0NBTEU7XHJcblx0XHRcdFx0eSA9IHBvcy55ICogJGd2LkNBTlZBU19TQ0FMRSAtIDcwO1xyXG5cclxuXHRcdFx0XHRhdHRhY2suYWxsRGFtYWdlLmZvckVhY2goZGFtYWdlID0+IHtcclxuXHRcdFx0XHRcdHRoaXMuYWRkRGFtYWdlUGFpcihza2luLCBzdHlsZSwgZGFtYWdlLCB4LCB5KTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdGVtcGxhdGUgS1xyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2luXHJcblx0ICogQHBhcmFtIHtLIGV4dGVuZHMga2V5b2YgbG9hZGVkX3NraW5bc2tpbl0gPyBLOm5ldmVyfSBzdHlsZVxyXG5cdCAqIEBwYXJhbSB7RGFtYWdlUGFpcn0gZGFtYWdlUGFpclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4IC0gY2VudGVyX3hcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geSAtIGJvdHRvbV95XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGRlbGF5XHJcblx0ICovXHJcblx0YWRkRGFtYWdlUGFpcihza2luLCBzdHlsZSwgZGFtYWdlUGFpciwgeCwgeSwgZGVsYXkgPSAwKSB7XHJcblx0XHR0aGlzLm9iamVjdHMucHVzaChuZXcgRGFtYWdlTnVtYmVyKHNraW4sIHN0eWxlLCBkYW1hZ2VQYWlyLCB4LCB5LCBkZWxheSkpO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBkYW1hZ2VOdW1iZXJMYXllciA9IG5ldyBEYW1hZ2VOdW1iZXJMYXllcigpO1xyXG5cclxud2luZG93LiRkYW1hZ2VOdW1iZXJMYXllciA9IGRhbWFnZU51bWJlckxheWVyO1xyXG53aW5kb3cuJERhbWFnZU51bWJlciA9IERhbWFnZU51bWJlclxyXG53aW5kb3cuJERhbWFnZU51bWJlclRlc3QgPSBEYW1hZ2VOdW1iZXJUZXN0O1xyXG53aW5kb3cuJERhbWFnZU51bWJlclJlbmRlcmVyID0gRGFtYWdlTnVtYmVyUmVuZGVyZXI7XHJcbi8vRGFtYWdlTnVtYmVyUmVuZGVyZXIucHJvdG90eXBlLl9kaXNwbGF5X2F4aXMgPSB0cnVlO1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Renderer/DamageNumber.js\n");

/***/ }),

/***/ "./src/game/Renderer/Layer.js":
/*!************************************!*\
  !*** ./src/game/Renderer/Layer.js ***!
  \************************************/
/*! exports provided: LayerObject, Layer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LayerObject\", function() { return LayerObject; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Layer\", function() { return Layer; });\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _RenderingOption__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./RenderingOption */ \"./src/game/Renderer/RenderingOption.js\");\n﻿\r\n\r\n\r\n\r\n\r\n/**\r\n * @interface\r\n */\r\nclass LayerObject {\r\n\tconstructor() {\r\n\t\t/** @type {number} = 0~1 */\r\n\t\tthis.opacity = 1;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t}\r\n\r\n\tisEnd() {\r\n\t\tconsole.error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthrow new Error();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {RenderingOption} option\r\n\t */\r\n\trender(renderer, option) {\r\n\t\tthrow new Error();\r\n\t}\r\n}\r\n\r\n/**\r\n * @implements {LayerObject}\r\n */\r\nclass Layer {\r\n\tconstructor() {\r\n\t\t/** @type {LayerObject[]} */\r\n\t\tthis.objects = [];\r\n\t\t\r\n\t\tthis.rendering_option = new _RenderingOption__WEBPACK_IMPORTED_MODULE_2__[\"RenderingOption\"]();\r\n\t}\r\n\t\r\n\tadd(obj) {\r\n\t\tthis.objects.push(obj);\r\n\t}\r\n\t\r\n\tclear() {\r\n\t\tthis.objects.length = 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.objects = this.objects.filter(function (obj) {\r\n\t\t\tif (!obj.isEnd || !obj.destroy) {\r\n\t\t\t\tconsole.error(\"%o: %o\", obj.constructor ? obj.constructor.name : (typeof obj), obj);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (obj.isEnd()) {\r\n\t\t\t\tobj.destroy();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tobj.update(stamp);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {RenderingOption} option\r\n\t */\r\n\trender(renderer, option) {\r\n\t\tconst opt = this.rendering_option.mul(option);\r\n\t\t\r\n\t\tif (opt.opacity > 0) {\r\n\t\t\trenderer.pushGlobalAlpha();\r\n\r\n\t\t\tthis.objects.forEach(function (obj) {\r\n\t\t\t\tobj.render(renderer, opt);\r\n\t\t\t});\r\n\r\n\t\t\trenderer.popGlobalAlpha();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9MYXllci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL0xheWVyLmpzPzAyOGEiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IEFuaW1hdGlvbiB9IGZyb20gXCIuLi9BbmltYXRpb24uanNcIlxyXG5pbXBvcnQgeyBJUmVuZGVyZXIgfSBmcm9tIFwiLi4vSVJlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IFJlbmRlcmluZ09wdGlvbiB9IGZyb20gXCIuL1JlbmRlcmluZ09wdGlvblwiO1xyXG5cclxuLyoqXHJcbiAqIEBpbnRlcmZhY2VcclxuICovXHJcbmV4cG9ydCBjbGFzcyBMYXllck9iamVjdCB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gPSAwfjEgKi9cclxuXHRcdHRoaXMub3BhY2l0eSA9IDE7XHJcblx0fVxyXG5cclxuXHRkZXN0cm95KCkge1xyXG5cdH1cclxuXHJcblx0aXNFbmQoKSB7XHJcblx0XHRjb25zb2xlLmVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1JlbmRlcmluZ09wdGlvbn0gb3B0aW9uXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyLCBvcHRpb24pIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcigpO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEBpbXBsZW1lbnRzIHtMYXllck9iamVjdH1cclxuICovXHJcbmV4cG9ydCBjbGFzcyBMYXllciB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge0xheWVyT2JqZWN0W119ICovXHJcblx0XHR0aGlzLm9iamVjdHMgPSBbXTtcclxuXHRcdFxyXG5cdFx0dGhpcy5yZW5kZXJpbmdfb3B0aW9uID0gbmV3IFJlbmRlcmluZ09wdGlvbigpO1xyXG5cdH1cclxuXHRcclxuXHRhZGQob2JqKSB7XHJcblx0XHR0aGlzLm9iamVjdHMucHVzaChvYmopO1xyXG5cdH1cclxuXHRcclxuXHRjbGVhcigpIHtcclxuXHRcdHRoaXMub2JqZWN0cy5sZW5ndGggPSAwO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMub2JqZWN0cyA9IHRoaXMub2JqZWN0cy5maWx0ZXIoZnVuY3Rpb24gKG9iaikge1xyXG5cdFx0XHRpZiAoIW9iai5pc0VuZCB8fCAhb2JqLmRlc3Ryb3kpIHtcclxuXHRcdFx0XHRjb25zb2xlLmVycm9yKFwiJW86ICVvXCIsIG9iai5jb25zdHJ1Y3RvciA/IG9iai5jb25zdHJ1Y3Rvci5uYW1lIDogKHR5cGVvZiBvYmopLCBvYmopO1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZiAob2JqLmlzRW5kKCkpIHtcclxuXHRcdFx0XHRvYmouZGVzdHJveSgpO1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRvYmoudXBkYXRlKHN0YW1wKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH0pO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKiBAcGFyYW0ge1JlbmRlcmluZ09wdGlvbn0gb3B0aW9uXHJcblx0ICovXHJcblx0cmVuZGVyKHJlbmRlcmVyLCBvcHRpb24pIHtcclxuXHRcdGNvbnN0IG9wdCA9IHRoaXMucmVuZGVyaW5nX29wdGlvbi5tdWwob3B0aW9uKTtcclxuXHRcdFxyXG5cdFx0aWYgKG9wdC5vcGFjaXR5ID4gMCkge1xyXG5cdFx0XHRyZW5kZXJlci5wdXNoR2xvYmFsQWxwaGEoKTtcclxuXHJcblx0XHRcdHRoaXMub2JqZWN0cy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcclxuXHRcdFx0XHRvYmoucmVuZGVyKHJlbmRlcmVyLCBvcHQpO1xyXG5cdFx0XHR9KTtcclxuXHJcblx0XHRcdHJlbmRlcmVyLnBvcEdsb2JhbEFscGhhKCk7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Renderer/Layer.js\n");

/***/ }),

/***/ "./src/game/Renderer/LifeRenderer.js":
/*!*******************************************!*\
  !*** ./src/game/Renderer/LifeRenderer.js ***!
  \*******************************************/
/*! exports provided: LifeRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"LifeRenderer\", function() { return LifeRenderer; });\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _Animation_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Animation.js */ \"./src/game/Animation.js\");\n﻿\r\n\r\n\r\n\r\n\r\nclass LifeRenderer /*extends SceneObject*/ {\r\n\tconstructor() {\r\n\t\t//super();\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._url = \"\";\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\r\n\t\t/** @type {{[action:string]:Animation}} */\r\n\t\tthis.actions = {};\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis._action = \"stand\";//static default\r\n\t\t\r\n\t\tthis._raw = null;\r\n\t}\r\n\t\r\n\tget name() {\r\n\t\treturn this.constructor._desc[this.id].name;\r\n\t}\r\n\t\r\n\tgetDefaultAction() {\r\n\t\tif (this.actions.stand) {\r\n\t\t\treturn \"stand\";\r\n\t\t}\r\n\t\telse if(this.actions.fly) {\r\n\t\t\treturn \"fly\";\r\n\t\t}\r\n\t\talert(this.constructor.name + \" (\" + this.id + \") default must is 'stand' or 'fly'\");\r\n\t\treturn new Error(this.constructor.name + \" (\" + this.id + \") default must is 'stand' or 'fly'\");\r\n\t}\r\n\t\r\n\t/** @type {string} */\r\n\tget action() {\r\n\t\treturn this._action;\r\n\t}\r\n\tset action(act) {\r\n\t\tif (this._action != act) {\r\n\t\t\tthis._action = act;\r\n\t\t\tif (this.actions[act]) {\r\n\t\t\t\tthis.actions[act].reset();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t///**\r\n\t// * @param {string} act\r\n\t// */\r\n\t//setAction(act) {\r\n\t//\tthrow new Error(\"Not implement\");\r\n\t//}\r\n\t\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tasync load(id) {\r\n\t\tlet tasks = [];\r\n\t\tlet that = this;\r\n\t\tthis.id = id;//\"8880140\";//\"8880141\";//\"8880150\";//\"8880151\";\r\n\t\tthis._url = [this.constructor._base_path, this.id].join(\"/\");\r\n\t\t\r\n\t\tif (!this.constructor._desc[id]) {\r\n\t\t\tlet task = this.constructor.loadDescription(id);\r\n\t\t\ttasks.push(task);\r\n\t\t}\r\n\r\n\t\tlet task = $get.data(this._url).then(async function (raw) {\r\n\t\t\tthat._raw = raw;\r\n\t\t\tif (that._raw) {\r\n\t\t\t\tawait that._construct_actions();\r\n\t\t\t\t\r\n\t\t\t\tthat._action = that.getDefaultAction();//set default action; is fly mob ?\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t});\r\n\t\ttasks.push(task);\r\n\r\n\t\treturn Promise.all(tasks);\r\n\t}\r\n\tasync _construct_actions() {\r\n\t\tvar tasks = [];\r\n\r\n\t\tfor (var i = 0; i < this.constructor._animations.length; ++i) {\r\n\t\t\tvar t = this.constructor._animations[i];\r\n\r\n\t\t\tfor (var $index = 1; ; ++$index) {\r\n\t\t\t\tlet action;\r\n\t\t\t\tvar name = eval(t);\r\n\r\n\t\t\t\tif (!(name in this._raw)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\taction = new _Animation_js__WEBPACK_IMPORTED_MODULE_1__[\"Animation\"](this._raw[name], [this._url, name].join(\"/\"));\r\n\t\t\t\taction.is_loop = false;\r\n\t\t\t\t\r\n\t\t\t\ttasks.push(action.load());\r\n\t\t\t\t\r\n\t\t\t\tthis.actions[name] = action;\r\n\r\n\t\t\t\tif (!name.endsWith($index)) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tawait Promise.all(tasks);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.actions[this.action]) {\r\n\t\t\tconst ani = this.actions[this.action];\r\n\t\t\t\r\n\t\t\tani.update(stamp);\r\n\t\t\t\t\r\n\t\t\t//TODO: move this code to: MapLifeEntity.prototype._applyState\r\n\t\t\t//if (ani.isEnd()) {\r\n\t\t\t//\tthis.action = this.getDefaultAction();//default loop action: stand\r\n\t\t\t//\tthis.actions[this.action].update(stamp);\r\n\t\t\t//}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * paint\r\n\t * @param {Engine} engine\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {number} angle\r\n\t * @param {boolean} flip\r\n\t */\r\n\tdraw(engine, x, y, angle, flip) {\r\n\t\tif (this.actions[this.action]) {\r\n\t\t\t/** @type {Animation} */\r\n\t\t\tconst act = this.actions[this.action];\r\n\t\t\tact.draw(engine, x, y, angle, flip);\r\n\t\t}\r\n\t}\r\n\tpaint(engine) {\r\n\t\tdebugger;\r\n\t\talert(\"Not Implement\");\r\n\t\trender(engine);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tstatic async loadDescription(id) {\r\n\t\talert(\"Not Implement\");\r\n\t}\r\n\r\n\tstatic get _animations() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\t\r\n\tstatic _get_desc_base_path() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9MaWZlUmVuZGVyZXIuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9SZW5kZXJlci9MaWZlUmVuZGVyZXIuanM/YzY4NyJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSBcIi4uL1Nwcml0ZS5qc1wiO1xyXG5pbXBvcnQgeyBBbmltYXRpb24gfSBmcm9tIFwiLi4vQW5pbWF0aW9uLmpzXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIExpZmVSZW5kZXJlciAvKmV4dGVuZHMgU2NlbmVPYmplY3QqLyB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvL3N1cGVyKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl91cmwgPSBcIlwiO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuaWQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e1thY3Rpb246c3RyaW5nXTpBbmltYXRpb259fSAqL1xyXG5cdFx0dGhpcy5hY3Rpb25zID0ge307XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLl9hY3Rpb24gPSBcInN0YW5kXCI7Ly9zdGF0aWMgZGVmYXVsdFxyXG5cdFx0XHJcblx0XHR0aGlzLl9yYXcgPSBudWxsO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgbmFtZSgpIHtcclxuXHRcdHJldHVybiB0aGlzLmNvbnN0cnVjdG9yLl9kZXNjW3RoaXMuaWRdLm5hbWU7XHJcblx0fVxyXG5cdFxyXG5cdGdldERlZmF1bHRBY3Rpb24oKSB7XHJcblx0XHRpZiAodGhpcy5hY3Rpb25zLnN0YW5kKSB7XHJcblx0XHRcdHJldHVybiBcInN0YW5kXCI7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmKHRoaXMuYWN0aW9ucy5mbHkpIHtcclxuXHRcdFx0cmV0dXJuIFwiZmx5XCI7XHJcblx0XHR9XHJcblx0XHRhbGVydCh0aGlzLmNvbnN0cnVjdG9yLm5hbWUgKyBcIiAoXCIgKyB0aGlzLmlkICsgXCIpIGRlZmF1bHQgbXVzdCBpcyAnc3RhbmQnIG9yICdmbHknXCIpO1xyXG5cdFx0cmV0dXJuIG5ldyBFcnJvcih0aGlzLmNvbnN0cnVjdG9yLm5hbWUgKyBcIiAoXCIgKyB0aGlzLmlkICsgXCIpIGRlZmF1bHQgbXVzdCBpcyAnc3RhbmQnIG9yICdmbHknXCIpO1xyXG5cdH1cclxuXHRcclxuXHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRnZXQgYWN0aW9uKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMuX2FjdGlvbjtcclxuXHR9XHJcblx0c2V0IGFjdGlvbihhY3QpIHtcclxuXHRcdGlmICh0aGlzLl9hY3Rpb24gIT0gYWN0KSB7XHJcblx0XHRcdHRoaXMuX2FjdGlvbiA9IGFjdDtcclxuXHRcdFx0aWYgKHRoaXMuYWN0aW9uc1thY3RdKSB7XHJcblx0XHRcdFx0dGhpcy5hY3Rpb25zW2FjdF0ucmVzZXQoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0Ly8vKipcclxuXHQvLyAqIEBwYXJhbSB7c3RyaW5nfSBhY3RcclxuXHQvLyAqL1xyXG5cdC8vc2V0QWN0aW9uKGFjdCkge1xyXG5cdC8vXHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdC8vfVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQoaWQpIHtcclxuXHRcdGxldCB0YXNrcyA9IFtdO1xyXG5cdFx0bGV0IHRoYXQgPSB0aGlzO1xyXG5cdFx0dGhpcy5pZCA9IGlkOy8vXCI4ODgwMTQwXCI7Ly9cIjg4ODAxNDFcIjsvL1wiODg4MDE1MFwiOy8vXCI4ODgwMTUxXCI7XHJcblx0XHR0aGlzLl91cmwgPSBbdGhpcy5jb25zdHJ1Y3Rvci5fYmFzZV9wYXRoLCB0aGlzLmlkXS5qb2luKFwiL1wiKTtcclxuXHRcdFxyXG5cdFx0aWYgKCF0aGlzLmNvbnN0cnVjdG9yLl9kZXNjW2lkXSkge1xyXG5cdFx0XHRsZXQgdGFzayA9IHRoaXMuY29uc3RydWN0b3IubG9hZERlc2NyaXB0aW9uKGlkKTtcclxuXHRcdFx0dGFza3MucHVzaCh0YXNrKTtcclxuXHRcdH1cclxuXHJcblx0XHRsZXQgdGFzayA9ICRnZXQuZGF0YSh0aGlzLl91cmwpLnRoZW4oYXN5bmMgZnVuY3Rpb24gKHJhdykge1xyXG5cdFx0XHR0aGF0Ll9yYXcgPSByYXc7XHJcblx0XHRcdGlmICh0aGF0Ll9yYXcpIHtcclxuXHRcdFx0XHRhd2FpdCB0aGF0Ll9jb25zdHJ1Y3RfYWN0aW9ucygpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHRoYXQuX2FjdGlvbiA9IHRoYXQuZ2V0RGVmYXVsdEFjdGlvbigpOy8vc2V0IGRlZmF1bHQgYWN0aW9uOyBpcyBmbHkgbW9iID9cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0fVxyXG5cdFx0fSk7XHJcblx0XHR0YXNrcy5wdXNoKHRhc2spO1xyXG5cclxuXHRcdHJldHVybiBQcm9taXNlLmFsbCh0YXNrcyk7XHJcblx0fVxyXG5cdGFzeW5jIF9jb25zdHJ1Y3RfYWN0aW9ucygpIHtcclxuXHRcdHZhciB0YXNrcyA9IFtdO1xyXG5cclxuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb25zdHJ1Y3Rvci5fYW5pbWF0aW9ucy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHR2YXIgdCA9IHRoaXMuY29uc3RydWN0b3IuX2FuaW1hdGlvbnNbaV07XHJcblxyXG5cdFx0XHRmb3IgKHZhciAkaW5kZXggPSAxOyA7ICsrJGluZGV4KSB7XHJcblx0XHRcdFx0bGV0IGFjdGlvbjtcclxuXHRcdFx0XHR2YXIgbmFtZSA9IGV2YWwodCk7XHJcblxyXG5cdFx0XHRcdGlmICghKG5hbWUgaW4gdGhpcy5fcmF3KSkge1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHRhY3Rpb24gPSBuZXcgQW5pbWF0aW9uKHRoaXMuX3Jhd1tuYW1lXSwgW3RoaXMuX3VybCwgbmFtZV0uam9pbihcIi9cIikpO1xyXG5cdFx0XHRcdGFjdGlvbi5pc19sb29wID0gZmFsc2U7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0dGFza3MucHVzaChhY3Rpb24ubG9hZCgpKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHR0aGlzLmFjdGlvbnNbbmFtZV0gPSBhY3Rpb247XHJcblxyXG5cdFx0XHRcdGlmICghbmFtZS5lbmRzV2l0aCgkaW5kZXgpKSB7XHJcblx0XHRcdFx0XHRicmVhaztcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRhd2FpdCBQcm9taXNlLmFsbCh0YXNrcyk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGlmICh0aGlzLmFjdGlvbnNbdGhpcy5hY3Rpb25dKSB7XHJcblx0XHRcdGNvbnN0IGFuaSA9IHRoaXMuYWN0aW9uc1t0aGlzLmFjdGlvbl07XHJcblx0XHRcdFxyXG5cdFx0XHRhbmkudXBkYXRlKHN0YW1wKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0Ly9UT0RPOiBtb3ZlIHRoaXMgY29kZSB0bzogTWFwTGlmZUVudGl0eS5wcm90b3R5cGUuX2FwcGx5U3RhdGVcclxuXHRcdFx0Ly9pZiAoYW5pLmlzRW5kKCkpIHtcclxuXHRcdFx0Ly9cdHRoaXMuYWN0aW9uID0gdGhpcy5nZXREZWZhdWx0QWN0aW9uKCk7Ly9kZWZhdWx0IGxvb3AgYWN0aW9uOiBzdGFuZFxyXG5cdFx0XHQvL1x0dGhpcy5hY3Rpb25zW3RoaXMuYWN0aW9uXS51cGRhdGUoc3RhbXApO1xyXG5cdFx0XHQvL31cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHBhaW50XHJcblx0ICogQHBhcmFtIHtFbmdpbmV9IGVuZ2luZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHlcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW5nbGVcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IGZsaXBcclxuXHQgKi9cclxuXHRkcmF3KGVuZ2luZSwgeCwgeSwgYW5nbGUsIGZsaXApIHtcclxuXHRcdGlmICh0aGlzLmFjdGlvbnNbdGhpcy5hY3Rpb25dKSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7QW5pbWF0aW9ufSAqL1xyXG5cdFx0XHRjb25zdCBhY3QgPSB0aGlzLmFjdGlvbnNbdGhpcy5hY3Rpb25dO1xyXG5cdFx0XHRhY3QuZHJhdyhlbmdpbmUsIHgsIHksIGFuZ2xlLCBmbGlwKTtcclxuXHRcdH1cclxuXHR9XHJcblx0cGFpbnQoZW5naW5lKSB7XHJcblx0XHRkZWJ1Z2dlcjtcclxuXHRcdGFsZXJ0KFwiTm90IEltcGxlbWVudFwiKTtcclxuXHRcdHJlbmRlcihlbmdpbmUpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWRcclxuXHQgKi9cclxuXHRzdGF0aWMgYXN5bmMgbG9hZERlc2NyaXB0aW9uKGlkKSB7XHJcblx0XHRhbGVydChcIk5vdCBJbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IF9hbmltYXRpb25zKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcblx0XHJcblx0c3RhdGljIF9nZXRfZGVzY19iYXNlX3BhdGgoKSB7XHJcblx0XHR0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50XCIpO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0dGhyb3cgbmV3IEVycm9yKFwiTm90IGltcGxlbWVudFwiKTtcclxuXHR9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Renderer/LifeRenderer.js\n");

/***/ }),

/***/ "./src/game/Renderer/MobRenderer.js":
/*!******************************************!*\
  !*** ./src/game/Renderer/MobRenderer.js ***!
  \******************************************/
/*! exports provided: MobRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"MobRenderer\", function() { return MobRenderer; });\n/* harmony import */ var _LifeRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./LifeRenderer.js */ \"./src/game/Renderer/LifeRenderer.js\");\n﻿\r\n\r\n\r\n\r\nwindow.MobAnimationSpeed = 1;\r\n\r\nwindow.$mob_name = {};\r\n\r\n/**\r\n * Mob basic infomation\r\n * Mob antion(animation) collection\r\n */\r\nclass MobRenderer extends _LifeRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"LifeRenderer\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t//[\"info\",\"stand\",\"hit1\",\"die1\",\"skill1\",\"skill2\",\"skill3\",\"skill4\",\"skill5\",\"attack1\",\"attack2\",\"attack3\",\"attack4\",\"attack5\"]\r\n\t}\r\n\r\n\tstatic get __info() {\r\n\t\treturn {\r\n\t\t\t\"noFlip\": 1,\r\n\t\t\t\"level\": 230,\r\n\t\t\t\"maxHP\": \"??????\",\r\n\t\t\t\"maxMP\": 100000,\r\n\t\t\t\"speed\": 0,\r\n\t\t\t\"PADamage\": 22000,\r\n\t\t\t\"PDRate\": 300,\r\n\t\t\t\"MADamage\": 24000,\r\n\t\t\t\"MDRate\": 30,\r\n\t\t\t\"acc\": 9999,\r\n\t\t\t\"eva\": 750,\r\n\t\t\t\"pushed\": 1000000000,\r\n\t\t\t\"fs\": 10,\r\n\t\t\t\"summonType\": 1,\r\n\t\t\t\"category\": 1,\r\n\t\t\t\"elemAttr\": \"P2H2F2I2S2L2D2\",\r\n\t\t\t\"mobType\": \"3N\",\r\n\t\t\t\"firstAttack\": 1,\r\n\t\t\t\"hideHP\": 1,\r\n\t\t\t\"boss\": 1,\r\n\t\t\t\"hpTagColor\": 1,\r\n\t\t\t\"hpTagBgcolor\": 5,\r\n\t\t\t\"showNotRemoteDam\": 1,\r\n\t\t\t\"defaultHP\": \"측정불가\",\r\n\t\t\t\"defaultMP\": \"측정불가\",\r\n\t\t\t\"ignoreMoveImpact\": 1\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tstatic async loadDescription(id) {\r\n\t\tif (!MobRenderer._desc[id]) {\r\n\t\t\tlet base = MobRenderer._get_desc_base_path();\r\n\t\t\tlet url = [base, Number(id)].join(\"/\");\r\n\t\t\tlet desc = await $get.data(url);\r\n\t\t\tMobRenderer._desc[id] = desc;\r\n\t\t\treturn desc;\r\n\t\t}\r\n\t\treturn MobRenderer._desc[id];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @override\r\n\t * @param {!string} id\r\n\t */\r\n\tasync load(id) {\r\n\t\tlet result = await super.load.apply(this, arguments);\r\n\t\treturn result;\r\n\t}\r\n\r\n\tisFlyMob() {\r\n\t\treturn !!this._raw.flySpeed;\r\n\t}\r\n\t//get info() {\r\n\t//\treturn this._raw.info;\r\n\t//}\r\n\t\r\n\t_getFirstAttackName() {\r\n\t\tconst firstAttack = this._raw.info.firstAttack;\r\n\t\treturn \"skill\" + firstAttack;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tstamp *= window.MobAnimationSpeed;\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\t\r\n\tstatic get _animations() {\r\n\t\treturn ['\"stand\"', '\"fly\"', '\"move\"', '\"jump\"', \"`hit${$index}`\", \"`die${$index}`\", \"`skill${$index}`\"/*, \"`attack${$index}`\"*/];\r\n\t}\r\n\t\r\n\tstatic _get_desc_base_path() {\r\n\t\treturn \"/String/Mob\";\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\treturn \"/Mob\";\r\n\t}\r\n}\r\nMobRenderer._desc = {};\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9Nb2JSZW5kZXJlci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL01vYlJlbmRlcmVyLmpzP2NlMjciXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IExpZmVSZW5kZXJlciB9IGZyb20gXCIuL0xpZmVSZW5kZXJlci5qc1wiO1xyXG5cclxuXHJcbndpbmRvdy5Nb2JBbmltYXRpb25TcGVlZCA9IDE7XHJcblxyXG53aW5kb3cuJG1vYl9uYW1lID0ge307XHJcblxyXG4vKipcclxuICogTW9iIGJhc2ljIGluZm9tYXRpb25cclxuICogTW9iIGFudGlvbihhbmltYXRpb24pIGNvbGxlY3Rpb25cclxuICovXHJcbmV4cG9ydCBjbGFzcyBNb2JSZW5kZXJlciBleHRlbmRzIExpZmVSZW5kZXJlciB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdC8vW1wiaW5mb1wiLFwic3RhbmRcIixcImhpdDFcIixcImRpZTFcIixcInNraWxsMVwiLFwic2tpbGwyXCIsXCJza2lsbDNcIixcInNraWxsNFwiLFwic2tpbGw1XCIsXCJhdHRhY2sxXCIsXCJhdHRhY2syXCIsXCJhdHRhY2szXCIsXCJhdHRhY2s0XCIsXCJhdHRhY2s1XCJdXHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IF9faW5mbygpIHtcclxuXHRcdHJldHVybiB7XHJcblx0XHRcdFwibm9GbGlwXCI6IDEsXHJcblx0XHRcdFwibGV2ZWxcIjogMjMwLFxyXG5cdFx0XHRcIm1heEhQXCI6IFwiPz8/Pz8/XCIsXHJcblx0XHRcdFwibWF4TVBcIjogMTAwMDAwLFxyXG5cdFx0XHRcInNwZWVkXCI6IDAsXHJcblx0XHRcdFwiUEFEYW1hZ2VcIjogMjIwMDAsXHJcblx0XHRcdFwiUERSYXRlXCI6IDMwMCxcclxuXHRcdFx0XCJNQURhbWFnZVwiOiAyNDAwMCxcclxuXHRcdFx0XCJNRFJhdGVcIjogMzAsXHJcblx0XHRcdFwiYWNjXCI6IDk5OTksXHJcblx0XHRcdFwiZXZhXCI6IDc1MCxcclxuXHRcdFx0XCJwdXNoZWRcIjogMTAwMDAwMDAwMCxcclxuXHRcdFx0XCJmc1wiOiAxMCxcclxuXHRcdFx0XCJzdW1tb25UeXBlXCI6IDEsXHJcblx0XHRcdFwiY2F0ZWdvcnlcIjogMSxcclxuXHRcdFx0XCJlbGVtQXR0clwiOiBcIlAySDJGMkkyUzJMMkQyXCIsXHJcblx0XHRcdFwibW9iVHlwZVwiOiBcIjNOXCIsXHJcblx0XHRcdFwiZmlyc3RBdHRhY2tcIjogMSxcclxuXHRcdFx0XCJoaWRlSFBcIjogMSxcclxuXHRcdFx0XCJib3NzXCI6IDEsXHJcblx0XHRcdFwiaHBUYWdDb2xvclwiOiAxLFxyXG5cdFx0XHRcImhwVGFnQmdjb2xvclwiOiA1LFxyXG5cdFx0XHRcInNob3dOb3RSZW1vdGVEYW1cIjogMSxcclxuXHRcdFx0XCJkZWZhdWx0SFBcIjogXCLsuKHsoJXrtojqsIBcIixcclxuXHRcdFx0XCJkZWZhdWx0TVBcIjogXCLsuKHsoJXrtojqsIBcIixcclxuXHRcdFx0XCJpZ25vcmVNb3ZlSW1wYWN0XCI6IDFcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGlkXHJcblx0ICovXHJcblx0c3RhdGljIGFzeW5jIGxvYWREZXNjcmlwdGlvbihpZCkge1xyXG5cdFx0aWYgKCFNb2JSZW5kZXJlci5fZGVzY1tpZF0pIHtcclxuXHRcdFx0bGV0IGJhc2UgPSBNb2JSZW5kZXJlci5fZ2V0X2Rlc2NfYmFzZV9wYXRoKCk7XHJcblx0XHRcdGxldCB1cmwgPSBbYmFzZSwgTnVtYmVyKGlkKV0uam9pbihcIi9cIik7XHJcblx0XHRcdGxldCBkZXNjID0gYXdhaXQgJGdldC5kYXRhKHVybCk7XHJcblx0XHRcdE1vYlJlbmRlcmVyLl9kZXNjW2lkXSA9IGRlc2M7XHJcblx0XHRcdHJldHVybiBkZXNjO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIE1vYlJlbmRlcmVyLl9kZXNjW2lkXTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHshc3RyaW5nfSBpZFxyXG5cdCAqL1xyXG5cdGFzeW5jIGxvYWQoaWQpIHtcclxuXHRcdGxldCByZXN1bHQgPSBhd2FpdCBzdXBlci5sb2FkLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcblx0XHRyZXR1cm4gcmVzdWx0O1xyXG5cdH1cclxuXHJcblx0aXNGbHlNb2IoKSB7XHJcblx0XHRyZXR1cm4gISF0aGlzLl9yYXcuZmx5U3BlZWQ7XHJcblx0fVxyXG5cdC8vZ2V0IGluZm8oKSB7XHJcblx0Ly9cdHJldHVybiB0aGlzLl9yYXcuaW5mbztcclxuXHQvL31cclxuXHRcclxuXHRfZ2V0Rmlyc3RBdHRhY2tOYW1lKCkge1xyXG5cdFx0Y29uc3QgZmlyc3RBdHRhY2sgPSB0aGlzLl9yYXcuaW5mby5maXJzdEF0dGFjaztcclxuXHRcdHJldHVybiBcInNraWxsXCIgKyBmaXJzdEF0dGFjaztcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0c3RhbXAgKj0gd2luZG93Lk1vYkFuaW1hdGlvblNwZWVkO1xyXG5cdFx0c3VwZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblx0XHJcblx0c3RhdGljIGdldCBfYW5pbWF0aW9ucygpIHtcclxuXHRcdHJldHVybiBbJ1wic3RhbmRcIicsICdcImZseVwiJywgJ1wibW92ZVwiJywgJ1wianVtcFwiJywgXCJgaGl0JHskaW5kZXh9YFwiLCBcImBkaWUkeyRpbmRleH1gXCIsIFwiYHNraWxsJHskaW5kZXh9YFwiLyosIFwiYGF0dGFjayR7JGluZGV4fWBcIiovXTtcclxuXHR9XHJcblx0XHJcblx0c3RhdGljIF9nZXRfZGVzY19iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gXCIvU3RyaW5nL01vYlwiO1xyXG5cdH1cclxuXHJcblx0c3RhdGljIGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL01vYlwiO1xyXG5cdH1cclxufVxyXG5Nb2JSZW5kZXJlci5fZGVzYyA9IHt9O1xyXG5cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Renderer/MobRenderer.js\n");

/***/ }),

/***/ "./src/game/Renderer/NameLabel.js":
/*!****************************************!*\
  !*** ./src/game/Renderer/NameLabel.js ***!
  \****************************************/
/*! exports provided: NameLabel */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NameLabel\", function() { return NameLabel; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _PanelRenderer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./PanelRenderer.js */ \"./src/game/Renderer/PanelRenderer.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass NameLabel extends _PanelRenderer_js__WEBPACK_IMPORTED_MODULE_2__[\"PanelRenderer\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.style = null;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.color = null;\r\n\t\t\r\n\t\t/** @type {Sprite} */\r\n\t\tthis.w = null;\r\n\t\t\r\n\t\t/** @type {Sprite} */\r\n\t\tthis.c = null;\r\n\t\t\r\n\t\t/** @type {Sprite} */\r\n\t\tthis.e = null;\r\n\t}\r\n\t\r\n\tasync load(style) {\r\n\t\tif (style == null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tif (NameLabel.cache[style]) {\r\n\t\t\tlet label = NameLabel.cache[style];\r\n\t\t\tObject.assign(this, label);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconst path = [this._base_path, style].join(\"/\");\r\n\t\t\t\r\n\t\t\tthis.style = style;\r\n\t\t\t\r\n\t\t\tlet promise = this._load(path);\r\n\t\t\tNameLabel.cache[style] = this;\r\n\t\t\tthis.$promise = promise;\r\n\t\t\t\r\n\t\t\tawait promise;\r\n\t\t\tdelete this.$promise;\r\n\t\t\t\r\n\t\t\tthis._load_center();\r\n\t\t\tthis._load_color(\"white\");\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} text\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t */\r\n\tdraw(renderer, text, x, y) {\r\n\t\tconst ctx = renderer.ctx;\r\n\t\t\r\n\t\tctx.fillStyle = this.color;\r\n\t\tctx.font = \"12px 微軟正黑體\";//新細明體\r\n\t\tctx.textAlign = \"center\";\r\n\t\tctx.textBaseline = \"hanging\";//top\r\n\t\t\r\n\t\tlet height = this.c.height;\r\n\t\tlet width = ctx.measureText(text).width;\r\n\t\twidth = Math.max(this.c.width * 2, width);\r\n\t\t\r\n\t\tconst hw = width / 2;\r\n\t\t\r\n\t\tconst cx = x - hw;\r\n\t\tconst cy = y + Math.min(this.w.y, this.e.y);\r\n\t\t\r\n\t\tthis.w.draw2(cx, cy);\r\n\t\tthis.c._drawPattern(cx, cy, width - this.e.x, height);\r\n\t\tthis.e.draw2(cx + width, cy);\r\n\t\t\r\n\t\tctx.fillText(text, x, cy);\r\n\t}\r\n\t\r\n\tget _base_path() {\r\n\t\treturn \"/UI/NameTag\";\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} NameLabel\r\n\t * @returns {NameLabel}\r\n\t */\r\n\tstatic get(labelStyle) {\r\n\t\tlet label = NameLabel.cache[labelStyle];\r\n\t\tif (!label) {\r\n\t\t\tlabel = new NameLabel();\r\n\t\t\tlabel.load(labelStyle);\r\n\t\t}\r\n\t\treturn label;\r\n\t}\r\n}\r\n\r\n/** @type {{[style:number]:NameLabel}} */\r\nNameLabel.cache = window.$images_NameLabel || {};\r\n\r\nwindow.$images_NameLabel = NameLabel.cache;\r\n\r\nif (true) {\r\n\tObject.values(NameLabel.cache).forEach(a => {\r\n\t\ta.__proto__ = NameLabel.prototype;\r\n\t\t//a.load(a.style);\r\n\t});\r\n\tmodule.hot.accept();\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9OYW1lTGFiZWwuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9SZW5kZXJlci9OYW1lTGFiZWwuanM/MjYxMCJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgSVJlbmRlcmVyIH0gZnJvbSAnLi4vSVJlbmRlcmVyLmpzJztcclxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSAnLi4vU3ByaXRlLmpzJztcclxuaW1wb3J0IHsgUGFuZWxSZW5kZXJlciB9IGZyb20gJy4vUGFuZWxSZW5kZXJlci5qcyc7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIE5hbWVMYWJlbCBleHRlbmRzIFBhbmVsUmVuZGVyZXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLnN0eWxlID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd9ICovXHJcblx0XHR0aGlzLmNvbG9yID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtTcHJpdGV9ICovXHJcblx0XHR0aGlzLncgPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge1Nwcml0ZX0gKi9cclxuXHRcdHRoaXMuYyA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7U3ByaXRlfSAqL1xyXG5cdFx0dGhpcy5lID0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0YXN5bmMgbG9hZChzdHlsZSkge1xyXG5cdFx0aWYgKHN0eWxlID09IG51bGwpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcigpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKE5hbWVMYWJlbC5jYWNoZVtzdHlsZV0pIHtcclxuXHRcdFx0bGV0IGxhYmVsID0gTmFtZUxhYmVsLmNhY2hlW3N0eWxlXTtcclxuXHRcdFx0T2JqZWN0LmFzc2lnbih0aGlzLCBsYWJlbCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0Y29uc3QgcGF0aCA9IFt0aGlzLl9iYXNlX3BhdGgsIHN0eWxlXS5qb2luKFwiL1wiKTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMuc3R5bGUgPSBzdHlsZTtcclxuXHRcdFx0XHJcblx0XHRcdGxldCBwcm9taXNlID0gdGhpcy5fbG9hZChwYXRoKTtcclxuXHRcdFx0TmFtZUxhYmVsLmNhY2hlW3N0eWxlXSA9IHRoaXM7XHJcblx0XHRcdHRoaXMuJHByb21pc2UgPSBwcm9taXNlO1xyXG5cdFx0XHRcclxuXHRcdFx0YXdhaXQgcHJvbWlzZTtcclxuXHRcdFx0ZGVsZXRlIHRoaXMuJHByb21pc2U7XHJcblx0XHRcdFxyXG5cdFx0XHR0aGlzLl9sb2FkX2NlbnRlcigpO1xyXG5cdFx0XHR0aGlzLl9sb2FkX2NvbG9yKFwid2hpdGVcIik7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqL1xyXG5cdGRyYXcocmVuZGVyZXIsIHRleHQsIHgsIHkpIHtcclxuXHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHRcdFxyXG5cdFx0Y3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XHJcblx0XHRjdHguZm9udCA9IFwiMTJweCDlvq7ou5/mraPpu5Hpq5RcIjsvL+aWsOe0sOaYjumrlFxyXG5cdFx0Y3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcblx0XHRjdHgudGV4dEJhc2VsaW5lID0gXCJoYW5naW5nXCI7Ly90b3BcclxuXHRcdFxyXG5cdFx0bGV0IGhlaWdodCA9IHRoaXMuYy5oZWlnaHQ7XHJcblx0XHRsZXQgd2lkdGggPSBjdHgubWVhc3VyZVRleHQodGV4dCkud2lkdGg7XHJcblx0XHR3aWR0aCA9IE1hdGgubWF4KHRoaXMuYy53aWR0aCAqIDIsIHdpZHRoKTtcclxuXHRcdFxyXG5cdFx0Y29uc3QgaHcgPSB3aWR0aCAvIDI7XHJcblx0XHRcclxuXHRcdGNvbnN0IGN4ID0geCAtIGh3O1xyXG5cdFx0Y29uc3QgY3kgPSB5ICsgTWF0aC5taW4odGhpcy53LnksIHRoaXMuZS55KTtcclxuXHRcdFxyXG5cdFx0dGhpcy53LmRyYXcyKGN4LCBjeSk7XHJcblx0XHR0aGlzLmMuX2RyYXdQYXR0ZXJuKGN4LCBjeSwgd2lkdGggLSB0aGlzLmUueCwgaGVpZ2h0KTtcclxuXHRcdHRoaXMuZS5kcmF3MihjeCArIHdpZHRoLCBjeSk7XHJcblx0XHRcclxuXHRcdGN0eC5maWxsVGV4dCh0ZXh0LCB4LCBjeSk7XHJcblx0fVxyXG5cdFxyXG5cdGdldCBfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL1VJL05hbWVUYWdcIjtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IE5hbWVMYWJlbFxyXG5cdCAqIEByZXR1cm5zIHtOYW1lTGFiZWx9XHJcblx0ICovXHJcblx0c3RhdGljIGdldChsYWJlbFN0eWxlKSB7XHJcblx0XHRsZXQgbGFiZWwgPSBOYW1lTGFiZWwuY2FjaGVbbGFiZWxTdHlsZV07XHJcblx0XHRpZiAoIWxhYmVsKSB7XHJcblx0XHRcdGxhYmVsID0gbmV3IE5hbWVMYWJlbCgpO1xyXG5cdFx0XHRsYWJlbC5sb2FkKGxhYmVsU3R5bGUpO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIGxhYmVsO1xyXG5cdH1cclxufVxyXG5cclxuLyoqIEB0eXBlIHt7W3N0eWxlOm51bWJlcl06TmFtZUxhYmVsfX0gKi9cclxuTmFtZUxhYmVsLmNhY2hlID0gd2luZG93LiRpbWFnZXNfTmFtZUxhYmVsIHx8IHt9O1xyXG5cclxud2luZG93LiRpbWFnZXNfTmFtZUxhYmVsID0gTmFtZUxhYmVsLmNhY2hlO1xyXG5cclxuaWYgKG1vZHVsZS5ob3QpIHtcclxuXHRPYmplY3QudmFsdWVzKE5hbWVMYWJlbC5jYWNoZSkuZm9yRWFjaChhID0+IHtcclxuXHRcdGEuX19wcm90b19fID0gTmFtZUxhYmVsLnByb3RvdHlwZTtcclxuXHRcdC8vYS5sb2FkKGEuc3R5bGUpO1xyXG5cdH0pO1xyXG5cdG1vZHVsZS5ob3QuYWNjZXB0KCk7XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Renderer/NameLabel.js\n");

/***/ }),

/***/ "./src/game/Renderer/NpcRenderer.js":
/*!******************************************!*\
  !*** ./src/game/Renderer/NpcRenderer.js ***!
  \******************************************/
/*! exports provided: NpcRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NpcRenderer\", function() { return NpcRenderer; });\n/* harmony import */ var _LifeRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./LifeRenderer.js */ \"./src/game/Renderer/LifeRenderer.js\");\n﻿\r\n\r\n\r\nwindow.NpcAnimationSpeed = 1;\r\n\r\n//Npc: 9090004 => ad-tv\r\n\r\nclass NpcRenderer extends _LifeRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"LifeRenderer\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} id\r\n\t */\r\n\tstatic async loadDescription(id) {\r\n\t\tif (!NpcRenderer._desc[id]) {\r\n\t\t\tlet base = NpcRenderer._get_desc_base_path();\r\n\t\t\tlet url = [base, Number(id)].join(\"/\");\r\n\t\t\tlet desc = await $get.data(url);\r\n\t\t\tNpcRenderer._desc[id] = desc;\r\n\t\t\treturn desc;\r\n\t\t}\r\n\t\treturn NpcRenderer._desc[id];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tstamp *= window.NpcAnimationSpeed;\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\r\n\tstatic get _animations() {\r\n\t\treturn ['\"stand\"'/*, \"`condition${$index}`\"*/];\r\n\t}\r\n\t\r\n\tstatic _get_desc_base_path() {\r\n\t\treturn \"/String/Npc\";\r\n\t}\r\n\r\n\tstatic get _base_path() {\r\n\t\treturn \"/Npc\";\r\n\t}\r\n};\r\nNpcRenderer._desc = {};\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9OcGNSZW5kZXJlci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL05wY1JlbmRlcmVyLmpzP2ZjOWIiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IExpZmVSZW5kZXJlciB9IGZyb20gJy4vTGlmZVJlbmRlcmVyLmpzJztcclxuXHJcbndpbmRvdy5OcGNBbmltYXRpb25TcGVlZCA9IDE7XHJcblxyXG4vL05wYzogOTA5MDAwNCA9PiBhZC10dlxyXG5cclxuZXhwb3J0IGNsYXNzIE5wY1JlbmRlcmVyIGV4dGVuZHMgTGlmZVJlbmRlcmVyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpZFxyXG5cdCAqL1xyXG5cdHN0YXRpYyBhc3luYyBsb2FkRGVzY3JpcHRpb24oaWQpIHtcclxuXHRcdGlmICghTnBjUmVuZGVyZXIuX2Rlc2NbaWRdKSB7XHJcblx0XHRcdGxldCBiYXNlID0gTnBjUmVuZGVyZXIuX2dldF9kZXNjX2Jhc2VfcGF0aCgpO1xyXG5cdFx0XHRsZXQgdXJsID0gW2Jhc2UsIE51bWJlcihpZCldLmpvaW4oXCIvXCIpO1xyXG5cdFx0XHRsZXQgZGVzYyA9IGF3YWl0ICRnZXQuZGF0YSh1cmwpO1xyXG5cdFx0XHROcGNSZW5kZXJlci5fZGVzY1tpZF0gPSBkZXNjO1xyXG5cdFx0XHRyZXR1cm4gZGVzYztcclxuXHRcdH1cclxuXHRcdHJldHVybiBOcGNSZW5kZXJlci5fZGVzY1tpZF07XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHN0YW1wICo9IHdpbmRvdy5OcGNBbmltYXRpb25TcGVlZDtcclxuXHRcdHN1cGVyLnVwZGF0ZShzdGFtcCk7XHJcblx0fVxyXG5cclxuXHRzdGF0aWMgZ2V0IF9hbmltYXRpb25zKCkge1xyXG5cdFx0cmV0dXJuIFsnXCJzdGFuZFwiJy8qLCBcImBjb25kaXRpb24keyRpbmRleH1gXCIqL107XHJcblx0fVxyXG5cdFxyXG5cdHN0YXRpYyBfZ2V0X2Rlc2NfYmFzZV9wYXRoKCkge1xyXG5cdFx0cmV0dXJuIFwiL1N0cmluZy9OcGNcIjtcclxuXHR9XHJcblxyXG5cdHN0YXRpYyBnZXQgX2Jhc2VfcGF0aCgpIHtcclxuXHRcdHJldHVybiBcIi9OcGNcIjtcclxuXHR9XHJcbn07XHJcbk5wY1JlbmRlcmVyLl9kZXNjID0ge307XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Renderer/NpcRenderer.js\n");

/***/ }),

/***/ "./src/game/Renderer/PanelRenderer.js":
/*!********************************************!*\
  !*** ./src/game/Renderer/PanelRenderer.js ***!
  \********************************************/
/*! exports provided: PanelRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PanelRenderer\", function() { return PanelRenderer; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n\r\n\r\n\r\n\r\n\r\nclass PanelRenderer {\r\n\tconstructor() {\r\n\t\tthis._raw = null;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} url\r\n\t */\r\n\tasync _load(url) {\r\n\t\tObject.defineProperty(this, \"_raw\", {\r\n\t\t\tvalue: await $get.data(url),\r\n\t\t});\r\n\t}\r\n\t\r\n\t_load_top() {\r\n\t\tthis.nw = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.nw);\r\n\t\t//this.nw._url = url + \"/nw\";\r\n\r\n\t\tthis.n = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.n);\r\n\t\t//this.n._url = url + \"/n\";\r\n\r\n\t\tthis.ne = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.ne);\r\n\t\t//this.ne._url = url + \"/ne\";\r\n\t}\r\n\t\r\n\t_load_center() {\r\n\t\tthis.w = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.w);\r\n\t\t//this.w._url = url + \"/w\";\r\n\r\n\t\tthis.c = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.c);\r\n\t\t//this.c._url = url + \"/c\";\r\n\r\n\t\tthis.e = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.e);\r\n\t\t//this.e._url = url + \"/e\";\r\n\t}\r\n\t\r\n\t_load_bottom() {\r\n\t\tthis.sw = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.sw);\r\n\t\t//this.sw._url = url + \"/sw\";\r\n\r\n\t\tthis.s = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.s);\r\n\t\t//this.s._url = url + \"/s\";\r\n\r\n\t\tthis.se = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.se);\r\n\t\t//this.se._url = url + \"/se\";\r\n\t}\r\n\t\r\n\t_load_arrow() {\r\n\t\tthis.arrow = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](this._raw.arrow);\r\n\t\t//this.arrow._url = url + \"/arrow\";\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} defCol\r\n\t */\r\n\t_load_color(defCol) {\r\n\t\tconst argb = Number(\"clr\" in this._raw ? this._raw.clr : defCol);\r\n\t\tconst rgba = (((argb & 0xFF000000) >>> 24) | ((argb & 0x00FFFFFF) << 8)) >>> 0;\r\n\t\tconst str_rgba = rgba.toString(16).padStart(8, \"0\");\r\n\t\tthis.color = (this._raw.clr == -1 || !this._raw.clr) ? (\"white\") : (\"#\" + str_rgba);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} cx\r\n\t * @param {number} bottom\r\n\t * @param {number} hwidth\r\n\t * @param {number} height\r\n\t */\r\n\t_draw_top(renderer, cx, bottom, hwidth, height) {\r\n\t\tconst tw = hwidth * 2;\r\n\t\tthis.nw.draw2(cx, bottom);\r\n\t\tthis.n._drawPatterncx(x, bottom, tw, this.n.height);\r\n\t\tthis.ne.draw2(cx + tw, bottom);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} cx\r\n\t * @param {number} bottom\r\n\t * @param {number} hwidth\r\n\t * @param {number} height\r\n\t */\r\n\t_draw_center(renderer, cx, bottom, hwidth, height) {\r\n\t\tconst tw = hwidth * 2;\r\n\t\tconst xw = this.w.width - this.w.x;\r\n\r\n\t\tthis.w._drawPattern(cx + xw, bottom, this.w.width, height);\r\n\t\tthis.c._drawPattern(cx + xw, bottom, tw, height);\r\n\t\tthis.e._drawPattern(cx + xw + tw, bottom, this.e.width, height);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} cx\r\n\t * @param {number} bottom\r\n\t * @param {number} hwidth\r\n\t * @param {number} height\r\n\t */\r\n\t_draw_bottom(renderer, cx, bottom, hwidth, height) {\r\n\t\tconst tw = hwidth * 2;\r\n\t\tthis.sw.draw2(cx, bottom + height);\r\n\t\tthis.s._drawPattern(cx, bottom + height, hwidth, this.s.height);\r\n\t\tthis.se.draw2(cx + tw, bottom + height);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} cx\r\n\t * @param {number} bottom\r\n\t * @param {number} hwidth\r\n\t * @param {number} height\r\n\t */\r\n\t_draw_bottom_and_arrow(renderer, cx, bottom, hwidth, height) {\r\n\t\tconst tw = hwidth * 2;\r\n\t\tconst r_adj = this.arrow.width & 1;\r\n\t\tconst arrow_hw = Math.trunc(this.arrow.width / 2);\r\n\t\tconst hw_arrow_hw = hwidth - arrow_hw;\r\n\t\r\n\t\tthis.sw.draw2(cx, bottom + height);\r\n\t\tthis.s._drawPattern(cx, bottom + height, hw_arrow_hw, this.s.height);\r\n\t\tthis.s._drawPattern(cx + hwidth + arrow_hw + r_adj, bottom + height, hw_arrow_hw - r_adj, this.s.height);\r\n\t\tthis.se.draw2(cx + tw, bottom + height);\r\n\r\n\t\tthis.arrow.draw2(cx - arrow_hw + hwidth, bottom + height);\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9QYW5lbFJlbmRlcmVyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUmVuZGVyZXIvUGFuZWxSZW5kZXJlci5qcz81ZDdhIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBJUmVuZGVyZXIgfSBmcm9tICcuLi9JUmVuZGVyZXIuanMnO1xyXG5pbXBvcnQgeyBTcHJpdGUgfSBmcm9tICcuLi9TcHJpdGUuanMnO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBQYW5lbFJlbmRlcmVyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMuX3JhdyA9IG51bGw7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmxcclxuXHQgKi9cclxuXHRhc3luYyBfbG9hZCh1cmwpIHtcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIl9yYXdcIiwge1xyXG5cdFx0XHR2YWx1ZTogYXdhaXQgJGdldC5kYXRhKHVybCksXHJcblx0XHR9KTtcclxuXHR9XHJcblx0XHJcblx0X2xvYWRfdG9wKCkge1xyXG5cdFx0dGhpcy5udyA9IG5ldyBTcHJpdGUodGhpcy5fcmF3Lm53KTtcclxuXHRcdC8vdGhpcy5udy5fdXJsID0gdXJsICsgXCIvbndcIjtcclxuXHJcblx0XHR0aGlzLm4gPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5uKTtcclxuXHRcdC8vdGhpcy5uLl91cmwgPSB1cmwgKyBcIi9uXCI7XHJcblxyXG5cdFx0dGhpcy5uZSA9IG5ldyBTcHJpdGUodGhpcy5fcmF3Lm5lKTtcclxuXHRcdC8vdGhpcy5uZS5fdXJsID0gdXJsICsgXCIvbmVcIjtcclxuXHR9XHJcblx0XHJcblx0X2xvYWRfY2VudGVyKCkge1xyXG5cdFx0dGhpcy53ID0gbmV3IFNwcml0ZSh0aGlzLl9yYXcudyk7XHJcblx0XHQvL3RoaXMudy5fdXJsID0gdXJsICsgXCIvd1wiO1xyXG5cclxuXHRcdHRoaXMuYyA9IG5ldyBTcHJpdGUodGhpcy5fcmF3LmMpO1xyXG5cdFx0Ly90aGlzLmMuX3VybCA9IHVybCArIFwiL2NcIjtcclxuXHJcblx0XHR0aGlzLmUgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5lKTtcclxuXHRcdC8vdGhpcy5lLl91cmwgPSB1cmwgKyBcIi9lXCI7XHJcblx0fVxyXG5cdFxyXG5cdF9sb2FkX2JvdHRvbSgpIHtcclxuXHRcdHRoaXMuc3cgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5zdyk7XHJcblx0XHQvL3RoaXMuc3cuX3VybCA9IHVybCArIFwiL3N3XCI7XHJcblxyXG5cdFx0dGhpcy5zID0gbmV3IFNwcml0ZSh0aGlzLl9yYXcucyk7XHJcblx0XHQvL3RoaXMucy5fdXJsID0gdXJsICsgXCIvc1wiO1xyXG5cclxuXHRcdHRoaXMuc2UgPSBuZXcgU3ByaXRlKHRoaXMuX3Jhdy5zZSk7XHJcblx0XHQvL3RoaXMuc2UuX3VybCA9IHVybCArIFwiL3NlXCI7XHJcblx0fVxyXG5cdFxyXG5cdF9sb2FkX2Fycm93KCkge1xyXG5cdFx0dGhpcy5hcnJvdyA9IG5ldyBTcHJpdGUodGhpcy5fcmF3LmFycm93KTtcclxuXHRcdC8vdGhpcy5hcnJvdy5fdXJsID0gdXJsICsgXCIvYXJyb3dcIjtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGRlZkNvbFxyXG5cdCAqL1xyXG5cdF9sb2FkX2NvbG9yKGRlZkNvbCkge1xyXG5cdFx0Y29uc3QgYXJnYiA9IE51bWJlcihcImNsclwiIGluIHRoaXMuX3JhdyA/IHRoaXMuX3Jhdy5jbHIgOiBkZWZDb2wpO1xyXG5cdFx0Y29uc3QgcmdiYSA9ICgoKGFyZ2IgJiAweEZGMDAwMDAwKSA+Pj4gMjQpIHwgKChhcmdiICYgMHgwMEZGRkZGRikgPDwgOCkpID4+PiAwO1xyXG5cdFx0Y29uc3Qgc3RyX3JnYmEgPSByZ2JhLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg4LCBcIjBcIik7XHJcblx0XHR0aGlzLmNvbG9yID0gKHRoaXMuX3Jhdy5jbHIgPT0gLTEgfHwgIXRoaXMuX3Jhdy5jbHIpID8gKFwid2hpdGVcIikgOiAoXCIjXCIgKyBzdHJfcmdiYSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjeFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBib3R0b21cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaHdpZHRoXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodFxyXG5cdCAqL1xyXG5cdF9kcmF3X3RvcChyZW5kZXJlciwgY3gsIGJvdHRvbSwgaHdpZHRoLCBoZWlnaHQpIHtcclxuXHRcdGNvbnN0IHR3ID0gaHdpZHRoICogMjtcclxuXHRcdHRoaXMubncuZHJhdzIoY3gsIGJvdHRvbSk7XHJcblx0XHR0aGlzLm4uX2RyYXdQYXR0ZXJuY3goeCwgYm90dG9tLCB0dywgdGhpcy5uLmhlaWdodCk7XHJcblx0XHR0aGlzLm5lLmRyYXcyKGN4ICsgdHcsIGJvdHRvbSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBjeFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBib3R0b21cclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaHdpZHRoXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGhlaWdodFxyXG5cdCAqL1xyXG5cdF9kcmF3X2NlbnRlcihyZW5kZXJlciwgY3gsIGJvdHRvbSwgaHdpZHRoLCBoZWlnaHQpIHtcclxuXHRcdGNvbnN0IHR3ID0gaHdpZHRoICogMjtcclxuXHRcdGNvbnN0IHh3ID0gdGhpcy53LndpZHRoIC0gdGhpcy53Lng7XHJcblxyXG5cdFx0dGhpcy53Ll9kcmF3UGF0dGVybihjeCArIHh3LCBib3R0b20sIHRoaXMudy53aWR0aCwgaGVpZ2h0KTtcclxuXHRcdHRoaXMuYy5fZHJhd1BhdHRlcm4oY3ggKyB4dywgYm90dG9tLCB0dywgaGVpZ2h0KTtcclxuXHRcdHRoaXMuZS5fZHJhd1BhdHRlcm4oY3ggKyB4dyArIHR3LCBib3R0b20sIHRoaXMuZS53aWR0aCwgaGVpZ2h0KTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGN4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBod2lkdGhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0XHJcblx0ICovXHJcblx0X2RyYXdfYm90dG9tKHJlbmRlcmVyLCBjeCwgYm90dG9tLCBod2lkdGgsIGhlaWdodCkge1xyXG5cdFx0Y29uc3QgdHcgPSBod2lkdGggKiAyO1xyXG5cdFx0dGhpcy5zdy5kcmF3MihjeCwgYm90dG9tICsgaGVpZ2h0KTtcclxuXHRcdHRoaXMucy5fZHJhd1BhdHRlcm4oY3gsIGJvdHRvbSArIGhlaWdodCwgaHdpZHRoLCB0aGlzLnMuaGVpZ2h0KTtcclxuXHRcdHRoaXMuc2UuZHJhdzIoY3ggKyB0dywgYm90dG9tICsgaGVpZ2h0KTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGN4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGJvdHRvbVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBod2lkdGhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0XHJcblx0ICovXHJcblx0X2RyYXdfYm90dG9tX2FuZF9hcnJvdyhyZW5kZXJlciwgY3gsIGJvdHRvbSwgaHdpZHRoLCBoZWlnaHQpIHtcclxuXHRcdGNvbnN0IHR3ID0gaHdpZHRoICogMjtcclxuXHRcdGNvbnN0IHJfYWRqID0gdGhpcy5hcnJvdy53aWR0aCAmIDE7XHJcblx0XHRjb25zdCBhcnJvd19odyA9IE1hdGgudHJ1bmModGhpcy5hcnJvdy53aWR0aCAvIDIpO1xyXG5cdFx0Y29uc3QgaHdfYXJyb3dfaHcgPSBod2lkdGggLSBhcnJvd19odztcclxuXHRcclxuXHRcdHRoaXMuc3cuZHJhdzIoY3gsIGJvdHRvbSArIGhlaWdodCk7XHJcblx0XHR0aGlzLnMuX2RyYXdQYXR0ZXJuKGN4LCBib3R0b20gKyBoZWlnaHQsIGh3X2Fycm93X2h3LCB0aGlzLnMuaGVpZ2h0KTtcclxuXHRcdHRoaXMucy5fZHJhd1BhdHRlcm4oY3ggKyBod2lkdGggKyBhcnJvd19odyArIHJfYWRqLCBib3R0b20gKyBoZWlnaHQsIGh3X2Fycm93X2h3IC0gcl9hZGosIHRoaXMucy5oZWlnaHQpO1xyXG5cdFx0dGhpcy5zZS5kcmF3MihjeCArIHR3LCBib3R0b20gKyBoZWlnaHQpO1xyXG5cclxuXHRcdHRoaXMuYXJyb3cuZHJhdzIoY3ggLSBhcnJvd19odyArIGh3aWR0aCwgYm90dG9tICsgaGVpZ2h0KTtcclxuXHR9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Renderer/PanelRenderer.js\n");

/***/ }),

/***/ "./src/game/Renderer/ParticleSystem.js":
/*!*********************************************!*\
  !*** ./src/game/Renderer/ParticleSystem.js ***!
  \*********************************************/
/*! exports provided: Particle, ParticleGroup */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Particle\", function() { return Particle; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ParticleGroup\", function() { return ParticleGroup; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../math.js */ \"./src/game/math.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../Sprite.js */ \"./src/game/Sprite.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @param {HTMLImageElement} image\r\n */\r\nfunction whiteToRed(image) {\r\n\tlet helper = new _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ImageDataHelper\"]();\r\n\tlet imagedata = helper.imageToImagedata(image);\r\n\r\n\tfor (let y = 0; y < imagedata.height; ++y) {\r\n\t\tfor (let x = 0; x < imagedata.width * 4; ++x) {\r\n\t\t\t//imagedata.data[y * imagedata.width * 4 + x * 4 + 0] = 0;\r\n\t\t\timagedata.data[y * imagedata.width * 4 + x * 4 + 1] = 0;\r\n\t\t\timagedata.data[y * imagedata.width * 4 + x * 4 + 2] = 0;\r\n\t\t\t//imagedata.data[y * imagedata.width * 4 + x * 4 + 3] = 0;\r\n\t\t}\r\n\t}\r\n\r\n\treturn helper.imagedataToDataURL(imagedata);\r\n}\r\n\r\n/**\r\n * @param {number} min\r\n * @param {number} range\r\n * @returns {number} min + Random(-1, 1) * range\r\n */\r\nfunction rand_r(min, range) {\r\n\treturn min - range + Math.random() * range * 2;\r\n}\r\n\r\n/**\r\n * @param {ColorRGB} color\r\n * @param {ColorRGB} colorVar\r\n * @returns {ColorRGB}\r\n */\r\nfunction rand_color2i(color, colorVar) {\r\n\tconst col = _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"].fromInt24(color);\r\n\tconst cv = _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"].fromInt24(colorVar);\r\n\tconst r = Math.max(0, Math.min(rand_r(col.r, cv.r), 255));\r\n\tconst g = Math.max(0, Math.min(rand_r(col.g, cv.g), 255));\r\n\tconst b = Math.max(0, Math.min(rand_r(col.b, cv.b), 255));\r\n\t\r\n\treturn new _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"](r, g, b);\r\n}\r\nfunction _rand_color2i(color, colorVar) {\r\n\treturn _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"].fromInt24(Math.max(0, Math.min(rand_r(color, colorVar), 255)));\r\n}\r\n\r\nclass Particle {\r\n\t/** @param {ParticleSystem} ps */\r\n\tconstructor(ps) {\r\n\t\tthis._initParam(ps);\r\n\r\n\t\tthis.life = 0;\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.pos = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"](0, 0);\r\n\t\t\r\n\t\tthis.opacity = 1;\r\n\t\tthis.scale = this.startScale;\r\n\t\tthis.color = new _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"](255, 255, 255);\r\n\t}\r\n\t\r\n\t/** @param {ParticleSystem} ps */\r\n\t_initParam(ps) {\r\n\t\tthis.lifeMax = rand_r(ps.life, ps.lifeVar);\r\n\r\n\t\tconst angle = rand_r(ps.angle, ps.angleVar) * Math.PI / 180;//?rand_r\r\n\r\n\t\tif (1) {\r\n\t\t\tthis.startColor = rand_color2i(ps.startColor, ps.startColorVar);\r\n\t\t\tthis.color_d = rand_color2i(ps.endColor, ps.endColorVar).selfSub(this.startColor);\r\n\t\t}\r\n\t\telse {}\r\n\r\n\t\t//unit: px\r\n\t\tconst sizeX = Math.max(1, ps.texture.width);\r\n\t\tconst sizeY = Math.max(1, ps.texture.height);\r\n\t\t//const size = Math.sqrt(sizeX ** 2 + sizeY ** 2);\r\n\t\tconst size = sizeX == 1 ? sizeY:(sizeY == 1 ? 1 : Math.min(sizeX, sizeY));\r\n\r\n\t\tthis.startScale = rand_r(ps.startSize, ps.startSizeVar) / size;\r\n\t\tconst endScale = rand_r(ps.endSize, ps.endSizeVar) / size;\r\n\t\tthis.scale_d = endScale - this.startScale;\r\n\r\n\t\tthis.startX = rand_r(ps.posX, ps.posVarX);\r\n\t\tthis.startY = rand_r(ps.posY, ps.posVarY);\r\n\r\n\t\tthis.emitterMode = ps.emitterType ? 1 : 0;\r\n\r\n\t\t// Mode A: Gravity + tangential accel + radial accel\r\n\t\tif (!this.emitterMode) {//Particle.EMITTER_MODE.GRAVITY\r\n\t\t\t// gravity\r\n\t\t\tthis.gravity = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"](ps.GRAVITY.x, ps.GRAVITY.y);\r\n\r\n\t\t\t// speed\r\n\t\t\tconst speed = rand_r(ps.GRAVITY.speed, ps.GRAVITY.speedVar);\r\n\t\t\t\r\n\t\t\t/** @type {Vec2} - velocity */\r\n\t\t\tthis.dir = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"](Math.cos(angle) * speed, -Math.sin(angle) * speed);\r\n\r\n\t\t\t// radial acceleration\r\n\t\t\tthis.radialAccel = rand_r(ps.GRAVITY.radialAccel || 0, ps.GRAVITY.radialAccelVar || 0);\r\n\r\n\t\t\t// tangential acceleration\r\n\t\t\tthis.tangentialAccel = rand_r(ps.GRAVITY.tangentialAccel || 0, ps.GRAVITY.tangentialAccelVar || 0);\r\n\r\n\t\t\t// rotation is dir\r\n\t\t\tthis.rotationIsDir = ps.GRAVITY.rotationIsDir ? true : false;\r\n\t\t}\r\n\t\telse if (this.emitterMode == 1) {\r\n\t\t\talert(\"Particle.EMITTER_MODE.RADIUS\");\r\n\t\t}\r\n\t}\r\n\r\n\t/** @param {number} stamp - time in millisecond */\r\n\tupdate(stamp) {\r\n\t\tconst dt = stamp / 1000;\r\n\t\tconst tp = Math.max(0, Math.min(this.life / this.lifeMax, 1));\r\n\r\n\t\t// update position\r\n\t\t{\r\n\t\t\tlet radial;\r\n\r\n\t\t\t// radial acceleration\r\n\t\t\tif (this.pos.x || this.pos.y) {\r\n\t\t\t\tradial = (new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"](this.pos.x, this.pos.y)).normalize();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tradial = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"](0, 0);\r\n\t\t\t}\r\n\r\n\t\t\tlet tangential = radial.clone();\r\n\t\t\tradial = radial.mul(this.radialAccel);\r\n\r\n\t\t\t// tangential acceleration\r\n\t\t\tlet newy = tangential.x;\r\n\t\t\ttangential.x = -tangential.y;\r\n\t\t\ttangential.y = newy;\r\n\r\n\t\t\ttangential = tangential.mul(this.tangentialAccel);\r\n\r\n\t\t\tlet _radial = radial.add(tangential);\r\n\t\t\t_radial = _radial.add(this.gravity);\r\n\t\t\t_radial = _radial.mul(dt);\r\n\t\t\t\r\n\t\t\tthis.dir = this.dir.add(_radial);\r\n\r\n\t\t\tlet _dir = this.dir.mul(dt);\r\n\t\t\tthis.pos = this.pos.add(_dir);\r\n\t\t}\r\n\r\n\t\tthis.scale = Math.max(0, this.startScale + this.scale_d * tp);\r\n\t\tthis.color = _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"].add(this.startColor, _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__[\"ColorRGB\"].scale(this.color_d, tp));\r\n\t\tthis.opacity = 1 - tp;\r\n\t\t\r\n\t\tthis.life += stamp;\r\n\t}\r\n\tisEnd() {\r\n\t\treturn this.life >= this.lifeMax;\r\n\t}\r\n\tdraw(renderer, texture, mx, my) {\r\n\t\tconst scale = this.scale;\r\n\t\tconst x = (this.startX + this.pos.x + mx);\r\n\t\tconst y = (this.startY + this.pos.y + my);\r\n\t\t\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\r\n\t\tlet color = this.color.toHSV();\r\n\t\trenderer.drawColoredGraph2(texture, x, y, scale, scale, color);\r\n\t}\r\n}\r\n\r\nclass _ParticleGroupData {\r\n\tconstructor() {\r\n\t\tthis.GRAVITY = new _math_js__WEBPACK_IMPORTED_MODULE_1__[\"Vec2\"]();\r\n\t\tthis.life = 0;\r\n\t\tthis.lifeVar = 0;\r\n\t\tthis.duration = 0;\r\n\t\tthis.totalParticle = 0;\r\n\t}\r\n}\r\n\r\nclass ParticleGroup extends _ParticleGroupData {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\r\n\t\t/** @type {Particle[]} */\r\n\t\tthis.particles = [];\r\n\r\n\t\t/** @type {number} time_in_ms:float */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** @type {number} timeElapsed_in_ms:float */\r\n\t\tthis.delta = 0;\r\n\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis.delay = Infinity;\r\n\t\t\r\n\t\tthis.duration = -1;//Infinity\r\n\t}\r\n\t\r\n\tclone() {\r\n\t\tlet pg = new ParticleGroup();\r\n\t\tObject.assign(pg, this);\r\n\t\tpg.particles = [];\r\n\t\tpg.time = 0;\r\n\t\tpg.delta = 0;\r\n\t\treturn pg;\r\n\t}\r\n\r\n\tevaluate() {\r\n\t\tlet totalTime = this.totalParticle * this.delay;\r\n\r\n\t\tfor (let i = 0; i < this.totalParticle; ++i) {\r\n\t\t\tconst particle = new Particle(this);\r\n\t\t\tconst t = totalTime - i * this.delay;\r\n\t\t\tparticle.life += t;\r\n\t\t\tparticle.update(t);\r\n\t\t\tparticle.life = t;\r\n\t\t\tthis.particles.push(particle);\r\n\t\t}\r\n\t}\r\n\t\r\n\tasync load(particle_name) {\r\n\t\tthis.particleName = particle_name;\r\n\r\n\t\t/** @type ParticleGroupData */\r\n\t\tlet data = await $get.data(this._particle_path);\r\n\t\t\r\n\t\tObject.assign(this, data);\r\n\r\n\t\tthis.GRAVITY.x = data.GRAVITY.x;\r\n\t\tthis.GRAVITY.y = data.GRAVITY.y;\r\n\r\n\t\tthis.life = data.life * 1000;\r\n\t\tthis.lifeVar = data.lifeVar * 1000;\r\n\t\tthis.duration = data.duration * 1000;\r\n\r\n\t\t//this.totalParticle = 2;//debug\r\n\t\tthis.delay = this.life / this.totalParticle;\r\n\r\n\t\tif (_experimental_particle) {\r\n\t\t\tconst that = this;\r\n\t\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\t\tlet image = new Image();\r\n\t\t\t\timage.onload = function () {\r\n\t\t\t\t\tlet texture = new _Sprite_js__WEBPACK_IMPORTED_MODULE_2__[\"Sprite\"](data.texture);\r\n\t\t\t\t\tif (_experimental_particle === true) {\r\n\t\t\t\t\t\ttexture._url = whiteToRed(this);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttexture._url = \"data:image/svg+xml;utf-8,\" + encodeURIComponent(`\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${this.naturalWidth}\" height=\"${this.naturalHeight}\">\r\n\t<defs>\r\n\t\t<mask id=\"Mask\">\r\n\t\t\t<image xlink:href=\"${new URL(\"images\" + that._texture_base_path, window.location).href}\"/>\r\n\t\t</mask>\r\n\t</defs>\r\n\t<g>\r\n\t\t<rect width=\"${this.naturalWidth}\" height=\"${this.naturalHeight}\" fill=\"red\" mask=\"url(#Mask)\"/>\r\n\t</g>\r\n</svg>`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthat.texture = texture;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t}\r\n\t\t\t\timage.src = \"images\" + that._texture_base_path;\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.texture = new _Sprite_js__WEBPACK_IMPORTED_MODULE_2__[\"Sprite\"](data.texture);\r\n\t\t\tthis.texture._url = \"images\" + this._texture_base_path;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/** @param {number} stamp - time in millisecond */\r\n\tupdate(stamp) {\r\n\t\tif (this.particles.length < this.totalParticle && (!this.time || this.time > this.delay)) {\r\n\t\t\tthis.particles.push(new Particle(this));\r\n\t\t\tthis.time = 0;\r\n\t\t}\r\n\t\t\r\n\t\tthis.particles = this.particles.filter(particle => {\r\n\t\t\tif (particle.isEnd()) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tparticle.update(stamp);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tthis.time += stamp;\r\n\t\tthis.delta += stamp;\r\n\t}\r\n\t\r\n\tisEnd() {\r\n\t\treturn (this.delta > this.duration && this.duration != -1);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {Rectangle} viewRect\r\n\t * @param {number} mx - translate x\r\n\t * @param {number} my - translate y\r\n\t */\r\n\trender(renderer, viewRect, mx, my) {\r\n\t\tconst ctx = renderer.ctx;\r\n\r\n\t\trenderer.ctx.setTransform(1, 0, 0, 1, Math.trunc(-$gv.m_viewRect.x), Math.trunc(-$gv.m_viewRect.y));\r\n\t\tif (this.blendFuncDst != 6 || this.blendFuncSrc != 5) {\r\n\t\t\tctx.globalCompositeOperation = \"lighter\";\r\n\t\t}\r\n\t\t\r\n\t\tfor (let i = 0; i < this.particles.length; ++i) {\r\n\t\t\tconst particle = this.particles[i];\r\n\t\t\tif (!particle.isEnd()) {\r\n\t\t\t\tconst x = this.x + mx;\r\n\t\t\t\tconst y = this.y + my;\r\n\t\t\t\tconst hw = this.texture.width * particle.scale;\r\n\t\t\t\tconst hh = this.texture.height * particle.scale;\r\n\t\t\t\t\r\n\t\t\t\tif (!viewRect || viewRect.collide4f2(x + particle.startX + particle.pos.x, y + particle.startY + particle.pos.y, hw, hh)) {\r\n\t\t\t\t\tparticle.draw(renderer, this.texture, x, y);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t//reset\r\n\t\tctx.globalCompositeOperation = \"source-over\";\r\n\t\trenderer.globalAlpha = 1;\r\n\t}\r\n\t\r\n\tget _particle_path() {\r\n\t\treturn [\"/Effect/particle\", this.particleName].join(\"/\");\r\n\t}\r\n\tget _texture_base_path() {\r\n\t\treturn [this._particle_path, \"texture\"].join(\"/\");\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9QYXJ0aWNsZVN5c3RlbS5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1JlbmRlcmVyL1BhcnRpY2xlU3lzdGVtLmpzPzZiNDEiXSwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IENvbG9yUkdCLCBJbWFnZURhdGFIZWxwZXIgfSBmcm9tIFwiLi4vSVJlbmRlcmVyLmpzXCI7XHJcbmltcG9ydCB7IFZlYzIsIFJlY3RhbmdsZSB9IGZyb20gXCIuLi9tYXRoLmpzXCI7XHJcbmltcG9ydCB7IFNwcml0ZSB9IGZyb20gXCIuLi9TcHJpdGUuanNcIjtcclxuXHJcblxyXG4vKipcclxuICogQHBhcmFtIHtIVE1MSW1hZ2VFbGVtZW50fSBpbWFnZVxyXG4gKi9cclxuZnVuY3Rpb24gd2hpdGVUb1JlZChpbWFnZSkge1xyXG5cdGxldCBoZWxwZXIgPSBuZXcgSW1hZ2VEYXRhSGVscGVyKCk7XHJcblx0bGV0IGltYWdlZGF0YSA9IGhlbHBlci5pbWFnZVRvSW1hZ2VkYXRhKGltYWdlKTtcclxuXHJcblx0Zm9yIChsZXQgeSA9IDA7IHkgPCBpbWFnZWRhdGEuaGVpZ2h0OyArK3kpIHtcclxuXHRcdGZvciAobGV0IHggPSAwOyB4IDwgaW1hZ2VkYXRhLndpZHRoICogNDsgKyt4KSB7XHJcblx0XHRcdC8vaW1hZ2VkYXRhLmRhdGFbeSAqIGltYWdlZGF0YS53aWR0aCAqIDQgKyB4ICogNCArIDBdID0gMDtcclxuXHRcdFx0aW1hZ2VkYXRhLmRhdGFbeSAqIGltYWdlZGF0YS53aWR0aCAqIDQgKyB4ICogNCArIDFdID0gMDtcclxuXHRcdFx0aW1hZ2VkYXRhLmRhdGFbeSAqIGltYWdlZGF0YS53aWR0aCAqIDQgKyB4ICogNCArIDJdID0gMDtcclxuXHRcdFx0Ly9pbWFnZWRhdGEuZGF0YVt5ICogaW1hZ2VkYXRhLndpZHRoICogNCArIHggKiA0ICsgM10gPSAwO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0cmV0dXJuIGhlbHBlci5pbWFnZWRhdGFUb0RhdGFVUkwoaW1hZ2VkYXRhKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEBwYXJhbSB7bnVtYmVyfSBtaW5cclxuICogQHBhcmFtIHtudW1iZXJ9IHJhbmdlXHJcbiAqIEByZXR1cm5zIHtudW1iZXJ9IG1pbiArIFJhbmRvbSgtMSwgMSkgKiByYW5nZVxyXG4gKi9cclxuZnVuY3Rpb24gcmFuZF9yKG1pbiwgcmFuZ2UpIHtcclxuXHRyZXR1cm4gbWluIC0gcmFuZ2UgKyBNYXRoLnJhbmRvbSgpICogcmFuZ2UgKiAyO1xyXG59XHJcblxyXG4vKipcclxuICogQHBhcmFtIHtDb2xvclJHQn0gY29sb3JcclxuICogQHBhcmFtIHtDb2xvclJHQn0gY29sb3JWYXJcclxuICogQHJldHVybnMge0NvbG9yUkdCfVxyXG4gKi9cclxuZnVuY3Rpb24gcmFuZF9jb2xvcjJpKGNvbG9yLCBjb2xvclZhcikge1xyXG5cdGNvbnN0IGNvbCA9IENvbG9yUkdCLmZyb21JbnQyNChjb2xvcik7XHJcblx0Y29uc3QgY3YgPSBDb2xvclJHQi5mcm9tSW50MjQoY29sb3JWYXIpO1xyXG5cdGNvbnN0IHIgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihyYW5kX3IoY29sLnIsIGN2LnIpLCAyNTUpKTtcclxuXHRjb25zdCBnID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ocmFuZF9yKGNvbC5nLCBjdi5nKSwgMjU1KSk7XHJcblx0Y29uc3QgYiA9IE1hdGgubWF4KDAsIE1hdGgubWluKHJhbmRfcihjb2wuYiwgY3YuYiksIDI1NSkpO1xyXG5cdFxyXG5cdHJldHVybiBuZXcgQ29sb3JSR0IociwgZywgYik7XHJcbn1cclxuZnVuY3Rpb24gX3JhbmRfY29sb3IyaShjb2xvciwgY29sb3JWYXIpIHtcclxuXHRyZXR1cm4gQ29sb3JSR0IuZnJvbUludDI0KE1hdGgubWF4KDAsIE1hdGgubWluKHJhbmRfcihjb2xvciwgY29sb3JWYXIpLCAyNTUpKSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBQYXJ0aWNsZSB7XHJcblx0LyoqIEBwYXJhbSB7UGFydGljbGVTeXN0ZW19IHBzICovXHJcblx0Y29uc3RydWN0b3IocHMpIHtcclxuXHRcdHRoaXMuX2luaXRQYXJhbShwcyk7XHJcblxyXG5cdFx0dGhpcy5saWZlID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge1ZlYzJ9ICovXHJcblx0XHR0aGlzLnBvcyA9IG5ldyBWZWMyKDAsIDApO1xyXG5cdFx0XHJcblx0XHR0aGlzLm9wYWNpdHkgPSAxO1xyXG5cdFx0dGhpcy5zY2FsZSA9IHRoaXMuc3RhcnRTY2FsZTtcclxuXHRcdHRoaXMuY29sb3IgPSBuZXcgQ29sb3JSR0IoMjU1LCAyNTUsIDI1NSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKiBAcGFyYW0ge1BhcnRpY2xlU3lzdGVtfSBwcyAqL1xyXG5cdF9pbml0UGFyYW0ocHMpIHtcclxuXHRcdHRoaXMubGlmZU1heCA9IHJhbmRfcihwcy5saWZlLCBwcy5saWZlVmFyKTtcclxuXHJcblx0XHRjb25zdCBhbmdsZSA9IHJhbmRfcihwcy5hbmdsZSwgcHMuYW5nbGVWYXIpICogTWF0aC5QSSAvIDE4MDsvLz9yYW5kX3JcclxuXHJcblx0XHRpZiAoMSkge1xyXG5cdFx0XHR0aGlzLnN0YXJ0Q29sb3IgPSByYW5kX2NvbG9yMmkocHMuc3RhcnRDb2xvciwgcHMuc3RhcnRDb2xvclZhcik7XHJcblx0XHRcdHRoaXMuY29sb3JfZCA9IHJhbmRfY29sb3IyaShwcy5lbmRDb2xvciwgcHMuZW5kQ29sb3JWYXIpLnNlbGZTdWIodGhpcy5zdGFydENvbG9yKTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHR0aGlzLnN0YXJ0Q29sb3IgPSBfcmFuZF9jb2xvcjJpKHBzLnN0YXJ0Q29sb3IsIHBzLnN0YXJ0Q29sb3JWYXIpO1xyXG5cdFx0XHR0aGlzLmNvbG9yX2QgPSBfcmFuZF9jb2xvcjJpKHBzLmVuZENvbG9yLCBwcy5lbmRDb2xvclZhcikuc2VsZlN1Yih0aGlzLnN0YXJ0Q29sb3IpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vdW5pdDogcHhcclxuXHRcdGNvbnN0IHNpemVYID0gTWF0aC5tYXgoMSwgcHMudGV4dHVyZS53aWR0aCk7XHJcblx0XHRjb25zdCBzaXplWSA9IE1hdGgubWF4KDEsIHBzLnRleHR1cmUuaGVpZ2h0KTtcclxuXHRcdC8vY29uc3Qgc2l6ZSA9IE1hdGguc3FydChzaXplWCAqKiAyICsgc2l6ZVkgKiogMik7XHJcblx0XHRjb25zdCBzaXplID0gc2l6ZVggPT0gMSA/IHNpemVZOihzaXplWSA9PSAxID8gMSA6IE1hdGgubWluKHNpemVYLCBzaXplWSkpO1xyXG5cclxuXHRcdHRoaXMuc3RhcnRTY2FsZSA9IHJhbmRfcihwcy5zdGFydFNpemUsIHBzLnN0YXJ0U2l6ZVZhcikgLyBzaXplO1xyXG5cdFx0Y29uc3QgZW5kU2NhbGUgPSByYW5kX3IocHMuZW5kU2l6ZSwgcHMuZW5kU2l6ZVZhcikgLyBzaXplO1xyXG5cdFx0dGhpcy5zY2FsZV9kID0gZW5kU2NhbGUgLSB0aGlzLnN0YXJ0U2NhbGU7XHJcblxyXG5cdFx0dGhpcy5zdGFydFggPSByYW5kX3IocHMucG9zWCwgcHMucG9zVmFyWCk7XHJcblx0XHR0aGlzLnN0YXJ0WSA9IHJhbmRfcihwcy5wb3NZLCBwcy5wb3NWYXJZKTtcclxuXHJcblx0XHR0aGlzLmVtaXR0ZXJNb2RlID0gcHMuZW1pdHRlclR5cGUgPyAxIDogMDtcclxuXHJcblx0XHQvLyBNb2RlIEE6IEdyYXZpdHkgKyB0YW5nZW50aWFsIGFjY2VsICsgcmFkaWFsIGFjY2VsXHJcblx0XHRpZiAoIXRoaXMuZW1pdHRlck1vZGUpIHsvL1BhcnRpY2xlLkVNSVRURVJfTU9ERS5HUkFWSVRZXHJcblx0XHRcdC8vIGdyYXZpdHlcclxuXHRcdFx0dGhpcy5ncmF2aXR5ID0gbmV3IFZlYzIocHMuR1JBVklUWS54LCBwcy5HUkFWSVRZLnkpO1xyXG5cclxuXHRcdFx0Ly8gc3BlZWRcclxuXHRcdFx0Y29uc3Qgc3BlZWQgPSByYW5kX3IocHMuR1JBVklUWS5zcGVlZCwgcHMuR1JBVklUWS5zcGVlZFZhcik7XHJcblx0XHRcdFxyXG5cdFx0XHQvKiogQHR5cGUge1ZlYzJ9IC0gdmVsb2NpdHkgKi9cclxuXHRcdFx0dGhpcy5kaXIgPSBuZXcgVmVjMihNYXRoLmNvcyhhbmdsZSkgKiBzcGVlZCwgLU1hdGguc2luKGFuZ2xlKSAqIHNwZWVkKTtcclxuXHJcblx0XHRcdC8vIHJhZGlhbCBhY2NlbGVyYXRpb25cclxuXHRcdFx0dGhpcy5yYWRpYWxBY2NlbCA9IHJhbmRfcihwcy5HUkFWSVRZLnJhZGlhbEFjY2VsIHx8IDAsIHBzLkdSQVZJVFkucmFkaWFsQWNjZWxWYXIgfHwgMCk7XHJcblxyXG5cdFx0XHQvLyB0YW5nZW50aWFsIGFjY2VsZXJhdGlvblxyXG5cdFx0XHR0aGlzLnRhbmdlbnRpYWxBY2NlbCA9IHJhbmRfcihwcy5HUkFWSVRZLnRhbmdlbnRpYWxBY2NlbCB8fCAwLCBwcy5HUkFWSVRZLnRhbmdlbnRpYWxBY2NlbFZhciB8fCAwKTtcclxuXHJcblx0XHRcdC8vIHJvdGF0aW9uIGlzIGRpclxyXG5cdFx0XHR0aGlzLnJvdGF0aW9uSXNEaXIgPSBwcy5HUkFWSVRZLnJvdGF0aW9uSXNEaXIgPyB0cnVlIDogZmFsc2U7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0aGlzLmVtaXR0ZXJNb2RlID09IDEpIHtcclxuXHRcdFx0YWxlcnQoXCJQYXJ0aWNsZS5FTUlUVEVSX01PREUuUkFESVVTXCIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcCAtIHRpbWUgaW4gbWlsbGlzZWNvbmQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGNvbnN0IGR0ID0gc3RhbXAgLyAxMDAwO1xyXG5cdFx0Y29uc3QgdHAgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih0aGlzLmxpZmUgLyB0aGlzLmxpZmVNYXgsIDEpKTtcclxuXHJcblx0XHQvLyB1cGRhdGUgcG9zaXRpb25cclxuXHRcdHtcclxuXHRcdFx0bGV0IHJhZGlhbDtcclxuXHJcblx0XHRcdC8vIHJhZGlhbCBhY2NlbGVyYXRpb25cclxuXHRcdFx0aWYgKHRoaXMucG9zLnggfHwgdGhpcy5wb3MueSkge1xyXG5cdFx0XHRcdHJhZGlhbCA9IChuZXcgVmVjMih0aGlzLnBvcy54LCB0aGlzLnBvcy55KSkubm9ybWFsaXplKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmFkaWFsID0gbmV3IFZlYzIoMCwgMCk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGxldCB0YW5nZW50aWFsID0gcmFkaWFsLmNsb25lKCk7XHJcblx0XHRcdHJhZGlhbCA9IHJhZGlhbC5tdWwodGhpcy5yYWRpYWxBY2NlbCk7XHJcblxyXG5cdFx0XHQvLyB0YW5nZW50aWFsIGFjY2VsZXJhdGlvblxyXG5cdFx0XHRsZXQgbmV3eSA9IHRhbmdlbnRpYWwueDtcclxuXHRcdFx0dGFuZ2VudGlhbC54ID0gLXRhbmdlbnRpYWwueTtcclxuXHRcdFx0dGFuZ2VudGlhbC55ID0gbmV3eTtcclxuXHJcblx0XHRcdHRhbmdlbnRpYWwgPSB0YW5nZW50aWFsLm11bCh0aGlzLnRhbmdlbnRpYWxBY2NlbCk7XHJcblxyXG5cdFx0XHRsZXQgX3JhZGlhbCA9IHJhZGlhbC5hZGQodGFuZ2VudGlhbCk7XHJcblx0XHRcdF9yYWRpYWwgPSBfcmFkaWFsLmFkZCh0aGlzLmdyYXZpdHkpO1xyXG5cdFx0XHRfcmFkaWFsID0gX3JhZGlhbC5tdWwoZHQpO1xyXG5cdFx0XHRcclxuXHRcdFx0dGhpcy5kaXIgPSB0aGlzLmRpci5hZGQoX3JhZGlhbCk7XHJcblxyXG5cdFx0XHRsZXQgX2RpciA9IHRoaXMuZGlyLm11bChkdCk7XHJcblx0XHRcdHRoaXMucG9zID0gdGhpcy5wb3MuYWRkKF9kaXIpO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc2NhbGUgPSBNYXRoLm1heCgwLCB0aGlzLnN0YXJ0U2NhbGUgKyB0aGlzLnNjYWxlX2QgKiB0cCk7XHJcblx0XHR0aGlzLmNvbG9yID0gQ29sb3JSR0IuYWRkKHRoaXMuc3RhcnRDb2xvciwgQ29sb3JSR0Iuc2NhbGUodGhpcy5jb2xvcl9kLCB0cCkpO1xyXG5cdFx0dGhpcy5vcGFjaXR5ID0gMSAtIHRwO1xyXG5cdFx0XHJcblx0XHR0aGlzLmxpZmUgKz0gc3RhbXA7XHJcblx0fVxyXG5cdGlzRW5kKCkge1xyXG5cdFx0cmV0dXJuIHRoaXMubGlmZSA+PSB0aGlzLmxpZmVNYXg7XHJcblx0fVxyXG5cdGRyYXcocmVuZGVyZXIsIHRleHR1cmUsIG14LCBteSkge1xyXG5cdFx0Y29uc3Qgc2NhbGUgPSB0aGlzLnNjYWxlO1xyXG5cdFx0Y29uc3QgeCA9ICh0aGlzLnN0YXJ0WCArIHRoaXMucG9zLnggKyBteCk7XHJcblx0XHRjb25zdCB5ID0gKHRoaXMuc3RhcnRZICsgdGhpcy5wb3MueSArIG15KTtcclxuXHRcdFxyXG5cdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSB0aGlzLm9wYWNpdHk7XHJcblxyXG5cdFx0bGV0IGNvbG9yID0gdGhpcy5jb2xvci50b0hTVigpO1xyXG5cdFx0cmVuZGVyZXIuZHJhd0NvbG9yZWRHcmFwaDIodGV4dHVyZSwgeCwgeSwgc2NhbGUsIHNjYWxlLCBjb2xvcik7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBfUGFydGljbGVHcm91cERhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5HUkFWSVRZID0gbmV3IFZlYzIoKTtcclxuXHRcdHRoaXMubGlmZSA9IDA7XHJcblx0XHR0aGlzLmxpZmVWYXIgPSAwO1xyXG5cdFx0dGhpcy5kdXJhdGlvbiA9IDA7XHJcblx0XHR0aGlzLnRvdGFsUGFydGljbGUgPSAwO1xyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIFBhcnRpY2xlR3JvdXAgZXh0ZW5kcyBfUGFydGljbGVHcm91cERhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHR0aGlzLnggPSAwO1xyXG5cdFx0dGhpcy55ID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge1BhcnRpY2xlW119ICovXHJcblx0XHR0aGlzLnBhcnRpY2xlcyA9IFtdO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSB0aW1lX2luX21zOmZsb2F0ICovXHJcblx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSB0aW1lRWxhcHNlZF9pbl9tczpmbG9hdCAqL1xyXG5cdFx0dGhpcy5kZWx0YSA9IDA7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5kZWxheSA9IEluZmluaXR5O1xyXG5cdFx0XHJcblx0XHR0aGlzLmR1cmF0aW9uID0gLTE7Ly9JbmZpbml0eVxyXG5cdH1cclxuXHRcclxuXHRjbG9uZSgpIHtcclxuXHRcdGxldCBwZyA9IG5ldyBQYXJ0aWNsZUdyb3VwKCk7XHJcblx0XHRPYmplY3QuYXNzaWduKHBnLCB0aGlzKTtcclxuXHRcdHBnLnBhcnRpY2xlcyA9IFtdO1xyXG5cdFx0cGcudGltZSA9IDA7XHJcblx0XHRwZy5kZWx0YSA9IDA7XHJcblx0XHRyZXR1cm4gcGc7XHJcblx0fVxyXG5cclxuXHRldmFsdWF0ZSgpIHtcclxuXHRcdGxldCB0b3RhbFRpbWUgPSB0aGlzLnRvdGFsUGFydGljbGUgKiB0aGlzLmRlbGF5O1xyXG5cclxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy50b3RhbFBhcnRpY2xlOyArK2kpIHtcclxuXHRcdFx0Y29uc3QgcGFydGljbGUgPSBuZXcgUGFydGljbGUodGhpcyk7XHJcblx0XHRcdGNvbnN0IHQgPSB0b3RhbFRpbWUgLSBpICogdGhpcy5kZWxheTtcclxuXHRcdFx0cGFydGljbGUubGlmZSArPSB0O1xyXG5cdFx0XHRwYXJ0aWNsZS51cGRhdGUodCk7XHJcblx0XHRcdHBhcnRpY2xlLmxpZmUgPSB0O1xyXG5cdFx0XHR0aGlzLnBhcnRpY2xlcy5wdXNoKHBhcnRpY2xlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0YXN5bmMgbG9hZChwYXJ0aWNsZV9uYW1lKSB7XHJcblx0XHR0aGlzLnBhcnRpY2xlTmFtZSA9IHBhcnRpY2xlX25hbWU7XHJcblxyXG5cdFx0LyoqIEB0eXBlIFBhcnRpY2xlR3JvdXBEYXRhICovXHJcblx0XHRsZXQgZGF0YSA9IGF3YWl0ICRnZXQuZGF0YSh0aGlzLl9wYXJ0aWNsZV9wYXRoKTtcclxuXHRcdFxyXG5cdFx0T2JqZWN0LmFzc2lnbih0aGlzLCBkYXRhKTtcclxuXHJcblx0XHR0aGlzLkdSQVZJVFkueCA9IGRhdGEuR1JBVklUWS54O1xyXG5cdFx0dGhpcy5HUkFWSVRZLnkgPSBkYXRhLkdSQVZJVFkueTtcclxuXHJcblx0XHR0aGlzLmxpZmUgPSBkYXRhLmxpZmUgKiAxMDAwO1xyXG5cdFx0dGhpcy5saWZlVmFyID0gZGF0YS5saWZlVmFyICogMTAwMDtcclxuXHRcdHRoaXMuZHVyYXRpb24gPSBkYXRhLmR1cmF0aW9uICogMTAwMDtcclxuXHJcblx0XHQvL3RoaXMudG90YWxQYXJ0aWNsZSA9IDI7Ly9kZWJ1Z1xyXG5cdFx0dGhpcy5kZWxheSA9IHRoaXMubGlmZSAvIHRoaXMudG90YWxQYXJ0aWNsZTtcclxuXHJcblx0XHRpZiAoX2V4cGVyaW1lbnRhbF9wYXJ0aWNsZSkge1xyXG5cdFx0XHRjb25zdCB0aGF0ID0gdGhpcztcclxuXHRcdFx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuXHRcdFx0XHRsZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcclxuXHRcdFx0XHRpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRsZXQgdGV4dHVyZSA9IG5ldyBTcHJpdGUoZGF0YS50ZXh0dXJlKTtcclxuXHRcdFx0XHRcdGlmIChfZXhwZXJpbWVudGFsX3BhcnRpY2xlID09PSB0cnVlKSB7XHJcblx0XHRcdFx0XHRcdHRleHR1cmUuX3VybCA9IHdoaXRlVG9SZWQodGhpcyk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGV4dHVyZS5fdXJsID0gXCJkYXRhOmltYWdlL3N2Zyt4bWw7dXRmLTgsXCIgKyBlbmNvZGVVUklDb21wb25lbnQoYFxyXG48c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIiB3aWR0aD1cIiR7dGhpcy5uYXR1cmFsV2lkdGh9XCIgaGVpZ2h0PVwiJHt0aGlzLm5hdHVyYWxIZWlnaHR9XCI+XHJcblx0PGRlZnM+XHJcblx0XHQ8bWFzayBpZD1cIk1hc2tcIj5cclxuXHRcdFx0PGltYWdlIHhsaW5rOmhyZWY9XCIke25ldyBVUkwoXCJpbWFnZXNcIiArIHRoYXQuX3RleHR1cmVfYmFzZV9wYXRoLCB3aW5kb3cubG9jYXRpb24pLmhyZWZ9XCIvPlxyXG5cdFx0PC9tYXNrPlxyXG5cdDwvZGVmcz5cclxuXHQ8Zz5cclxuXHRcdDxyZWN0IHdpZHRoPVwiJHt0aGlzLm5hdHVyYWxXaWR0aH1cIiBoZWlnaHQ9XCIke3RoaXMubmF0dXJhbEhlaWdodH1cIiBmaWxsPVwicmVkXCIgbWFzaz1cInVybCgjTWFzaylcIi8+XHJcblx0PC9nPlxyXG48L3N2Zz5gKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoYXQudGV4dHVyZSA9IHRleHR1cmU7XHJcblx0XHRcdFx0XHRyZXNvbHZlKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGltYWdlLnNyYyA9IFwiaW1hZ2VzXCIgKyB0aGF0Ll90ZXh0dXJlX2Jhc2VfcGF0aDtcclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy50ZXh0dXJlID0gbmV3IFNwcml0ZShkYXRhLnRleHR1cmUpO1xyXG5cdFx0XHR0aGlzLnRleHR1cmUuX3VybCA9IFwiaW1hZ2VzXCIgKyB0aGlzLl90ZXh0dXJlX2Jhc2VfcGF0aDtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcCAtIHRpbWUgaW4gbWlsbGlzZWNvbmQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGlmICh0aGlzLnBhcnRpY2xlcy5sZW5ndGggPCB0aGlzLnRvdGFsUGFydGljbGUgJiYgKCF0aGlzLnRpbWUgfHwgdGhpcy50aW1lID4gdGhpcy5kZWxheSkpIHtcclxuXHRcdFx0dGhpcy5wYXJ0aWNsZXMucHVzaChuZXcgUGFydGljbGUodGhpcykpO1xyXG5cdFx0XHR0aGlzLnRpbWUgPSAwO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHR0aGlzLnBhcnRpY2xlcyA9IHRoaXMucGFydGljbGVzLmZpbHRlcihwYXJ0aWNsZSA9PiB7XHJcblx0XHRcdGlmIChwYXJ0aWNsZS5pc0VuZCgpKSB7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHBhcnRpY2xlLnVwZGF0ZShzdGFtcCk7XHJcblx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdFx0XHJcblx0XHR0aGlzLnRpbWUgKz0gc3RhbXA7XHJcblx0XHR0aGlzLmRlbHRhICs9IHN0YW1wO1xyXG5cdH1cclxuXHRcclxuXHRpc0VuZCgpIHtcclxuXHRcdHJldHVybiAodGhpcy5kZWx0YSA+IHRoaXMuZHVyYXRpb24gJiYgdGhpcy5kdXJhdGlvbiAhPSAtMSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7UmVjdGFuZ2xlfSB2aWV3UmVjdFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBteCAtIHRyYW5zbGF0ZSB4XHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG15IC0gdHJhbnNsYXRlIHlcclxuXHQgKi9cclxuXHRyZW5kZXIocmVuZGVyZXIsIHZpZXdSZWN0LCBteCwgbXkpIHtcclxuXHRcdGNvbnN0IGN0eCA9IHJlbmRlcmVyLmN0eDtcclxuXHJcblx0XHRyZW5kZXJlci5jdHguc2V0VHJhbnNmb3JtKDEsIDAsIDAsIDEsIE1hdGgudHJ1bmMoLSRndi5tX3ZpZXdSZWN0LngpLCBNYXRoLnRydW5jKC0kZ3YubV92aWV3UmVjdC55KSk7XHJcblx0XHRpZiAodGhpcy5ibGVuZEZ1bmNEc3QgIT0gNiB8fCB0aGlzLmJsZW5kRnVuY1NyYyAhPSA1KSB7XHJcblx0XHRcdGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcImxpZ2h0ZXJcIjtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBhcnRpY2xlcy5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRjb25zdCBwYXJ0aWNsZSA9IHRoaXMucGFydGljbGVzW2ldO1xyXG5cdFx0XHRpZiAoIXBhcnRpY2xlLmlzRW5kKCkpIHtcclxuXHRcdFx0XHRjb25zdCB4ID0gdGhpcy54ICsgbXg7XHJcblx0XHRcdFx0Y29uc3QgeSA9IHRoaXMueSArIG15O1xyXG5cdFx0XHRcdGNvbnN0IGh3ID0gdGhpcy50ZXh0dXJlLndpZHRoICogcGFydGljbGUuc2NhbGU7XHJcblx0XHRcdFx0Y29uc3QgaGggPSB0aGlzLnRleHR1cmUuaGVpZ2h0ICogcGFydGljbGUuc2NhbGU7XHJcblx0XHRcdFx0XHJcblx0XHRcdFx0aWYgKCF2aWV3UmVjdCB8fCB2aWV3UmVjdC5jb2xsaWRlNGYyKHggKyBwYXJ0aWNsZS5zdGFydFggKyBwYXJ0aWNsZS5wb3MueCwgeSArIHBhcnRpY2xlLnN0YXJ0WSArIHBhcnRpY2xlLnBvcy55LCBodywgaGgpKSB7XHJcblx0XHRcdFx0XHRwYXJ0aWNsZS5kcmF3KHJlbmRlcmVyLCB0aGlzLnRleHR1cmUsIHgsIHkpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHQvL3Jlc2V0XHJcblx0XHRjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xyXG5cdFx0cmVuZGVyZXIuZ2xvYmFsQWxwaGEgPSAxO1xyXG5cdH1cclxuXHRcclxuXHRnZXQgX3BhcnRpY2xlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gW1wiL0VmZmVjdC9wYXJ0aWNsZVwiLCB0aGlzLnBhcnRpY2xlTmFtZV0uam9pbihcIi9cIik7XHJcblx0fVxyXG5cdGdldCBfdGV4dHVyZV9iYXNlX3BhdGgoKSB7XHJcblx0XHRyZXR1cm4gW3RoaXMuX3BhcnRpY2xlX3BhdGgsIFwidGV4dHVyZVwiXS5qb2luKFwiL1wiKTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Renderer/ParticleSystem.js\n");

/***/ }),

/***/ "./src/game/Renderer/RenderingOption.js":
/*!**********************************************!*\
  !*** ./src/game/Renderer/RenderingOption.js ***!
  \**********************************************/
/*! exports provided: RenderingOption */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RenderingOption\", function() { return RenderingOption; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../IRenderer.js */ \"./src/game/IRenderer.js\");\n\r\n\r\n\r\n\r\nclass RenderingOption {\r\n\t/**\r\n\t * @param {Partial<RenderingOption>} [option]\r\n\t */\r\n\tconstructor(option) {\r\n\t\tif (option) {\r\n\t\t\tthis.opacity = option.opacity || 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.opacity = 1;\r\n\t\t}\r\n\t}\r\n\tclone() {\r\n\t\treturn new RenderingOption(this);\r\n\t}\r\n\t/**\r\n\t * multiply property, return new RenderingOption\r\n\t * @param {RenderingOption} other\r\n\t * @returns {RenderingOption}\r\n\t */\r\n\tmul(other) {\r\n\t\tif (other) {\r\n\t\t\treturn new RenderingOption({\r\n\t\t\t\topacity: this.opacity * other.opacity,\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.clone();\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * multiply property\r\n\t * @param {RenderingOption} other\r\n\t * @returns {void}\r\n\t */\r\n\tselfMultiply(other) {\r\n\t\tif (other) {\r\n\t\t\tthis.opacity * other.opacity;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9SZW5kZXJpbmdPcHRpb24uanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS9SZW5kZXJlci9SZW5kZXJpbmdPcHRpb24uanM/MjM1YSJdLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgSVJlbmRlcmVyIH0gZnJvbSBcIi4uL0lSZW5kZXJlci5qc1wiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBSZW5kZXJpbmdPcHRpb24ge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7UGFydGlhbDxSZW5kZXJpbmdPcHRpb24+fSBbb3B0aW9uXVxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKG9wdGlvbikge1xyXG5cdFx0aWYgKG9wdGlvbikge1xyXG5cdFx0XHR0aGlzLm9wYWNpdHkgPSBvcHRpb24ub3BhY2l0eSB8fCAxO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMub3BhY2l0eSA9IDE7XHJcblx0XHR9XHJcblx0fVxyXG5cdGNsb25lKCkge1xyXG5cdFx0cmV0dXJuIG5ldyBSZW5kZXJpbmdPcHRpb24odGhpcyk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIG11bHRpcGx5IHByb3BlcnR5LCByZXR1cm4gbmV3IFJlbmRlcmluZ09wdGlvblxyXG5cdCAqIEBwYXJhbSB7UmVuZGVyaW5nT3B0aW9ufSBvdGhlclxyXG5cdCAqIEByZXR1cm5zIHtSZW5kZXJpbmdPcHRpb259XHJcblx0ICovXHJcblx0bXVsKG90aGVyKSB7XHJcblx0XHRpZiAob3RoZXIpIHtcclxuXHRcdFx0cmV0dXJuIG5ldyBSZW5kZXJpbmdPcHRpb24oe1xyXG5cdFx0XHRcdG9wYWNpdHk6IHRoaXMub3BhY2l0eSAqIG90aGVyLm9wYWNpdHksXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHJldHVybiB0aGlzLmNsb25lKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIG11bHRpcGx5IHByb3BlcnR5XHJcblx0ICogQHBhcmFtIHtSZW5kZXJpbmdPcHRpb259IG90aGVyXHJcblx0ICogQHJldHVybnMge3ZvaWR9XHJcblx0ICovXHJcblx0c2VsZk11bHRpcGx5KG90aGVyKSB7XHJcblx0XHRpZiAob3RoZXIpIHtcclxuXHRcdFx0dGhpcy5vcGFjaXR5ICogb3RoZXIub3BhY2l0eTtcclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/Renderer/RenderingOption.js\n");

/***/ }),

/***/ "./src/game/Renderer/SceneRenderer.js":
/*!********************************************!*\
  !*** ./src/game/Renderer/SceneRenderer.js ***!
  \********************************************/
/*! exports provided: sceneRenderer */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"sceneRenderer\", function() { return sceneRenderer; });\n/* harmony import */ var _Layer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Layer.js */ \"./src/game/Renderer/Layer.js\");\n/* harmony import */ var _RenderingOption__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./RenderingOption */ \"./src/game/Renderer/RenderingOption.js\");\n\r\n\r\n\r\n\r\n\r\n/**\r\n * @implements {LayerObject}\r\n */\r\nclass SceneRenderer {\r\n\tconstructor() {\r\n\t\t/** @type {Layer[]} */\r\n\t\tthis.layers = [];\r\n\t\t\r\n\t\t/** @type {RenderingOption} */\r\n\t\tthis.rendering_option = new _RenderingOption__WEBPACK_IMPORTED_MODULE_1__[\"RenderingOption\"]();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} amount\r\n\t */\r\n\taddLayerBack(amount) {\r\n\t\tfor (let i = 0; i < amount; ++i) {\r\n\t\t\tthis.layers.push(new _Layer_js__WEBPACK_IMPORTED_MODULE_0__[\"Layer\"]()); \r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tfor (let layer of this.layers) {\r\n\t\t\tlayer.update(stamp);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {number} layerIndex\r\n\t */\r\n\trenderLayer(renderer, layerIndex) {\r\n\t\tconst layer = this.layers[layerIndex];\r\n\t\tlayer.render(renderer, this.rendering_option);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_renderAll(renderer) {\r\n\t\tfor (let layer of this.layers) {\r\n\t\t\tlayer.render(renderer, this.rendering_option);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst sceneRenderer = new SceneRenderer();\r\n\r\nwindow.$sceneRenderer = sceneRenderer;\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9SZW5kZXJlci9TY2VuZVJlbmRlcmVyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2dhbWUvUmVuZGVyZXIvU2NlbmVSZW5kZXJlci5qcz84YjEzIl0sInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgeyBMYXllck9iamVjdCwgTGF5ZXIgfSBmcm9tIFwiLi9MYXllci5qc1wiXHJcbmltcG9ydCB7IFJlbmRlcmluZ09wdGlvbiB9IGZyb20gXCIuL1JlbmRlcmluZ09wdGlvblwiO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBAaW1wbGVtZW50cyB7TGF5ZXJPYmplY3R9XHJcbiAqL1xyXG5jbGFzcyBTY2VuZVJlbmRlcmVyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7TGF5ZXJbXX0gKi9cclxuXHRcdHRoaXMubGF5ZXJzID0gW107XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7UmVuZGVyaW5nT3B0aW9ufSAqL1xyXG5cdFx0dGhpcy5yZW5kZXJpbmdfb3B0aW9uID0gbmV3IFJlbmRlcmluZ09wdGlvbigpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW1vdW50XHJcblx0ICovXHJcblx0YWRkTGF5ZXJCYWNrKGFtb3VudCkge1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhbW91bnQ7ICsraSkge1xyXG5cdFx0XHR0aGlzLmxheWVycy5wdXNoKG5ldyBMYXllcigpKTsgXHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0Zm9yIChsZXQgbGF5ZXIgb2YgdGhpcy5sYXllcnMpIHtcclxuXHRcdFx0bGF5ZXIudXBkYXRlKHN0YW1wKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGxheWVySW5kZXhcclxuXHQgKi9cclxuXHRyZW5kZXJMYXllcihyZW5kZXJlciwgbGF5ZXJJbmRleCkge1xyXG5cdFx0Y29uc3QgbGF5ZXIgPSB0aGlzLmxheWVyc1tsYXllckluZGV4XTtcclxuXHRcdGxheWVyLnJlbmRlcihyZW5kZXJlciwgdGhpcy5yZW5kZXJpbmdfb3B0aW9uKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0X3JlbmRlckFsbChyZW5kZXJlcikge1xyXG5cdFx0Zm9yIChsZXQgbGF5ZXIgb2YgdGhpcy5sYXllcnMpIHtcclxuXHRcdFx0bGF5ZXIucmVuZGVyKHJlbmRlcmVyLCB0aGlzLnJlbmRlcmluZ19vcHRpb24pO1xyXG5cdFx0fVxyXG5cdH1cclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHNjZW5lUmVuZGVyZXIgPSBuZXcgU2NlbmVSZW5kZXJlcigpO1xyXG5cclxud2luZG93LiRzY2VuZVJlbmRlcmVyID0gc2NlbmVSZW5kZXJlcjtcclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/Renderer/SceneRenderer.js\n");

/***/ }),

/***/ "./src/game/SceneCharacter.js":
/*!************************************!*\
  !*** ./src/game/SceneCharacter.js ***!
  \************************************/
/*! exports provided: BaseSceneCharacter, SceneCharacter, SceneRemoteCharacter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BaseSceneCharacter\", function() { return BaseSceneCharacter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SceneCharacter\", function() { return SceneCharacter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SceneRemoteCharacter\", function() { return SceneRemoteCharacter; });\n/* harmony import */ var _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../public/javascripts/resource.js */ \"./public/javascripts/resource.js\");\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./SceneObject.js */ \"./src/game/SceneObject.js\");\n/* harmony import */ var _Renderer_CharacterRenderer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Renderer/CharacterRenderer.js */ \"./src/game/Renderer/CharacterRenderer.js\");\n/* harmony import */ var _Renderer_ChatBalloon_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Renderer/ChatBalloon.js */ \"./src/game/Renderer/ChatBalloon.js\");\n/* harmony import */ var _Physics_PPlayer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Physics/PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Item_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Item.js */ \"./src/game/Item.js\");\n/* harmony import */ var _Skill_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./Skill.js */ \"./src/game/Skill.js\");\n/* harmony import */ var _Common_PlayerData_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../Common/PlayerData.js */ \"./src/Common/PlayerData.js\");\n/* harmony import */ var _Common_PlayerData_js__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(_Common_PlayerData_js__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var _Client_PMovePath_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../Client/PMovePath.js */ \"./src/Client/PMovePath.js\");\n/* harmony import */ var _Common_Packet__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../Common/Packet */ \"./src/Common/Packet/index.js\");\n/* harmony import */ var _Common_Packet__WEBPACK_IMPORTED_MODULE_10___default = /*#__PURE__*/__webpack_require__.n(_Common_Packet__WEBPACK_IMPORTED_MODULE_10__);\n/* harmony import */ var _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../Common/AttackInfo.js */ \"./src/Common/AttackInfo.js\");\n/* harmony import */ var _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../ui/Basic/KeySlot.js */ \"./src/ui/Basic/KeySlot.js\");\n/* harmony import */ var _InputKey_js__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./InputKey.js */ \"./src/game/InputKey.js\");\n/* harmony import */ var _Map_js__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./Map.js */ \"./src/game/Map.js\");\n/* harmony import */ var _Renderer_DamageNumber_js__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./Renderer/DamageNumber.js */ \"./src/game/Renderer/DamageNumber.js\");\n/* harmony import */ var _Renderer_Chair_js__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./Renderer/Chair.js */ \"./src/game/Renderer/Chair.js\");\n/* harmony import */ var _Renderer_SceneRenderer_js__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./Renderer/SceneRenderer.js */ \"./src/game/Renderer/SceneRenderer.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// SceneCharacter的更新流程\r\n//\r\n// chatCtrl.update (順序無關)\r\n//\r\n// <...controller>\r\n// control\r\n// activeSkills.forEach(skill => skill.update)\r\n// chara._handleAttack\r\n// chara._player_control => { inputKey.forEach(key => key ? activeSkills.forEach(skill => skill.control)); ... }\r\n// chara._applyState\r\n//\r\n// <renderer>\r\n// set chara.renderer.position\r\n// chara.renderer.update\r\n\r\n\r\nwindow.$addItem_repeatEquip = false;\r\n\r\n\r\nclass TimeElapsed {\r\n\tconstructor() {\r\n\t\t/** @type {Date} */\r\n\t\tthis._date = new Date();\r\n\t}\r\n\treset() {\r\n\t\tthis._date = new Date();\r\n\t}\r\n\tget elapsed() {\r\n\t\tconst elapsed = (new Date()).getMilliseconds() - this._date.getMilliseconds();\r\n\t\treturn elapsed;\r\n\t}\r\n}\r\n\r\n\r\nclass ChatController {\r\n\tconstructor() {\r\n\t\t/** @type {string} */\r\n\t\tthis.text = \"\";\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.$outputText = null;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.elapsed = 0;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis._isDisplay = false;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} text\r\n\t */\r\n\tenter(text) {\r\n\t\tthis.text = String(text);\r\n\t\tthis.$outputText = null;\r\n\t\tthis.isDisplay = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst $displayDuration = this.displayDuration;\r\n\r\n\t\tif (this.elapsed > $displayDuration) {\r\n\t\t\tthis.isDisplay = false;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.elapsed += stamp;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {BaseSceneCharacter} chara\r\n\t */\r\n\tasync draw(renderer, chara) {\r\n\t\tif (this._isDisplay) {\r\n\t\t\tconst style = chara.chatBalloonStyle || $gv.ChatBalloon_default_style;\r\n\r\n\t\t\t/** @type {ChatBalloon} */\r\n\t\t\tlet cb = _Renderer_ChatBalloon_js__WEBPACK_IMPORTED_MODULE_4__[\"ChatBalloon\"].cache[style];\r\n\t\t\tif (!cb) {\r\n\t\t\t\tcb = new _Renderer_ChatBalloon_js__WEBPACK_IMPORTED_MODULE_4__[\"ChatBalloon\"]();\r\n\t\t\t\tawait cb.load(style);\r\n\t\t\t}\r\n\r\n\t\t\tconst $colon = this.colon;\r\n\t\t\tconst crr = chara.renderer;\r\n\t\t\tconst boundBox = crr._boundBox;\r\n\r\n\t\t\tif (!this.$outputText) {\r\n\t\t\t\tthis.$outputText = chara.id + $colon + this.text;\r\n\t\t\t}\r\n\t\t\tcb.draw(renderer, this.$outputText, crr.x, crr.y - boundBox.height);\r\n\t\t}\r\n\t}\r\n\r\n\tget isDisplay() {\r\n\t\treturn this._isDisplay;\r\n\t}\r\n\tset isDisplay(value) {\r\n\t\tthis._isDisplay = !!value;\r\n\t\tthis.elapsed = 0;\r\n\t}\r\n\r\n\t/** @type {\" : \"} */\r\n\tget colon() {\r\n\t\treturn \" : \";\r\n\t}\r\n\tget $maxLength() {\r\n\t\treturn 70;\r\n\t}\r\n\tget displayDuration() {\r\n\t\treturn $gv.ChatBalloon_display_duration;\r\n\t}\r\n}\r\n\r\n\r\nconst keyboard_map = [\r\n\t{\r\n\t\tArrowUp: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"up\")),\r\n\t\tArrowLeft: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"left\")),\r\n\t\tArrowDown: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"down\")),\r\n\t\tArrowRight: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"right\")),\r\n\t\tz: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"jump\")),\r\n\t\t//z: new KeySlot(\"Skill\", new SkillSlot(\"23001002\")),\r\n\t\tx: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"attack\")),\r\n\t\tc: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"1001005\")),\r\n\t\tv: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"64120000\")),\r\n\t\tb: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"23121000\")),//152001001\r\n\t},\r\n\t{//editor mode\r\n\t\tw: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"up\")),\r\n\t\ta: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"left\")),\r\n\t\ts: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"down\")),\r\n\t\td: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"right\")),\r\n\t\tq: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"jump\")),\r\n\t\tf: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"23001002\")),//debug\r\n\t\tx: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Action\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"ActionSlot\"](\"attack\")),\r\n\t\tc: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"1001005\")),\r\n\t\tv: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"64120000\")),\r\n\t\tb: new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"KeySlot\"](\"Skill\", new _ui_Basic_KeySlot_js__WEBPACK_IMPORTED_MODULE_12__[\"SkillSlot\"](\"23121000\")),//152001001\r\n\t}\r\n];\r\n\r\n\r\nclass PlayerJob {\r\n\tconstructor() {\r\n\t\t/** @type {InputKey} */\r\n\t\tthis.inputKey = new _InputKey_js__WEBPACK_IMPORTED_MODULE_13__[\"InputKey\"]();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {BaseSceneCharacter} owner\r\n\t * @param {number} stamp\r\n\t * @param {InputKey} inputKey\r\n\t */\r\n\tupdate(owner, stamp, inputKey) {\r\n\t\tlet r = this._update_command_skill(owner, stamp, inputKey);\r\n\t\tif (r) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this._update(owner, stamp, inputKey);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {BaseSceneCharacter} owner\r\n\t * @param {number} stamp\r\n\t * @param {InputKey} inputKey\r\n\t */\r\n\t_update(owner, stamp, inputKey) {\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {BaseSceneCharacter} owner\r\n\t * @param {number} stamp\r\n\t * @param {InputKey} inputKey\r\n\t * @returns {boolean} is match\r\n\t */\r\n\t_update_command_skill(owner, stamp, inputKey) {\r\n\t\tconst frontKey = owner.$physics.state.front > 0 ? \"right\" : \"left\";\r\n\t\t\r\n\t\t//this.inputKey.update(stamp, ikey);\r\n\t\t\r\n\t\tif (this.inputKey.match([[\"down\"], [frontKey]], -1) ||\r\n\t\t\tthis.inputKey.match([[\"down\"], [\"down\", frontKey], [frontKey]], -1)\r\n\t\t) {\r\n\t\t\tif (inputKey.attack == 1) {\r\n\t\t\t\tconsole.log(\"invoke skill: 波動拳\");\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nclass PlayerJob_2300 extends PlayerJob {\r\n\t/**\r\n\t * @param {BaseSceneCharacter} owner\r\n\t * @param {number} stamp\r\n\t * @param {InputKey} inputKey\r\n\t */\r\n\t_update(owner, stamp, inputKey) {\r\n\t\tif (inputKey.jump) {\r\n\t\t\tconst skill_id = \"23001002\";\r\n\t\t\tlet skill = owner.activeSkills.get(skill_id);\r\n\t\t\t//if (keyDown && can_use_skill) {\r\n\t\t\t\tskill = skill || _Skill_js__WEBPACK_IMPORTED_MODULE_7__[\"SceneSkill\"].preload(skill_id);\r\n\t\t\t\tif (!skill.$promise && skill.test(owner)) {\r\n\t\t\t\t\tskill = skill || owner.invokeSkill(skill_id);\r\n\t\t\t\t\tif (skill) {\r\n\t\t\t\t\t\tskill.control(inputKey, inputKey.jump, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t//}\r\n\t\t\t//if (skill) {\r\n\t\t\t//\tskill.control(ikey, keyDown, keyUp);\r\n\t\t\t//}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass BaseSceneCharacter extends _SceneObject_js__WEBPACK_IMPORTED_MODULE_2__[\"SceneObject\"] {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t///** @type {PPlayer} */\r\n\t\t//this.$physics = null;//new PPlayer();\r\n\r\n\t\t/** @type {CharacterRenderer} */\r\n\t\tthis.renderer = null;\r\n\t\tthis.$layer = 5;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.name = null;\r\n\r\n\t\tthis.stat = new _Common_PlayerData_js__WEBPACK_IMPORTED_MODULE_8__[\"CharacterStat\"]();\r\n\t\t\r\n\t\t// begin PlayerData\r\n\t\t//TODO: move player data to PlayerData\r\n\t\t\r\n\t\t/** @type {number} */\r\n\t\tthis.chatBalloonStyle = 0;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.labelStyle = 0;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.damageSkin = \"default\";\r\n\t\t\r\n\t\t// end PlayerData\r\n\r\n\t\t/** @type {PlayerJob} */\r\n\t\tthis.jobController = new PlayerJob_2300();\r\n\r\n\t\t/** @type {Map<string,SceneSkill>} */\r\n\t\tthis.activeSkills = new Map();\r\n\t\t\r\n\t\t/** @type {Map<string,SceneSkill>} */\r\n\t\tthis.skillControllers = new Map();\r\n\t\t\r\n\t\t/** @type {Chair} */\r\n\t\tthis.chair = null;\r\n\t\t\r\n\t\t/** @type {ChatController} */\r\n\t\tthis.chatCtrl = new ChatController();\r\n\t\t\r\n\t\tObject.defineProperties(this, {\r\n\t\t\t$inPacket: {\r\n\t\t\t\twritable: true,\r\n\t\t\t},\r\n\t\t\t$outPacket: {\r\n\t\t\t\twritable: true,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t/** @type {{move:$Packet_CharacterMove}} */\r\n\t\tthis.$inPacket = {};\r\n\t\tthis.$inPacket.move = null;\r\n\r\n\t\t/** @type {{move:$Packet_CharacterMove}} */\r\n\t\tthis.$outPacket = {};\r\n\t\tthis.$outPacket.move = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @alias name\r\n\t * @type {string}\r\n\t */\r\n\tget id() {\r\n\t\treturn this.name;\r\n\t}\r\n\tset id(value) {\r\n\t\tthis.name = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @alias name\r\n\t * @type {string}\r\n\t */\r\n\tget $objectid() {\r\n\t\treturn this.name;\r\n\t}\r\n\tset $objectid(value) {\r\n\t\tthis.name = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BaseSceneCharacter|null} chara - 被 chara 攻擊\r\n\t * @param {number} damage - 傷害\r\n\t */\r\n\tdamage(chara, damage) {\r\n\t\tconsole.log(\"Player(\" + this.$objectid + \") 被 \" + chara.$objectid + \" 攻擊，減少 \" + damage + \" HP\");\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BaseSceneCharacter|null} chara - 被 chara 攻擊\r\n\t * @param {number} moveX - unit is pixel\r\n\t * @param {number} moveY - unit is pixel\r\n\t */\r\n\tknockback(chara, moveX, moveY) {\r\n\t\tthis.$physics.knockback(moveX, moveY, 1000);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {$Packet_CharacterMove} _move\r\n\t */\r\n\t$move(_move) {\r\n\t\tlet move = _move || this.$inPacket.move;\r\n\t\tthis.$inPacket.move = move;\r\n\t}\r\n\r\n\t_remote_control() {\r\n\t\tlet move = this.$inPacket.move;\r\n\r\n\t\tif (move && move.path && move.path.length) {\r\n\t\t\tconst crr = this.renderer;\r\n\t\t\tlet elem = move.path.shift();\r\n\r\n\t\t\tif (elem.isAwake) {\r\n\t\t\t\tthis.$physics.moveTo(elem);\r\n\t\t\t\tthis.$physics.state = elem.pState;//??\r\n\r\n\t\t\t\tcrr.front = elem.pState.front;\r\n\t\t\t}\r\n\t\t\t//else {\r\n\t\t\t//\t//non physics state: chara.renderer...\r\n\t\t\t//}\r\n\t\t\r\n\t\t\tif (elem.action) {\r\n\t\t\t\tcrr.action = elem.action;\r\n\t\t\t\t//crr.action_frame = elem.action_frame;\r\n\t\t\t}\r\n\t\t\tif (elem.emotion) {\r\n\t\t\t\tcrr.emotion = elem.emotion;\r\n\t\t\t\t//crr.emotion_frame = elem.emotion_frame;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} equipId\r\n\t * @param {number} from\r\n\t * @param {number} to\r\n\t */\r\n\t$moveItem(equipId, from, to) {\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} chairId\r\n\t */\r\n\tsitChair(chairId) {\r\n\t\tif (!this.chair) {\r\n\t\t\tthis.chair = new _Renderer_Chair_js__WEBPACK_IMPORTED_MODULE_16__[\"Chair\"]();\r\n\t\t\tthis.chair.init(this);\r\n\t\t\tthis.chair.load(chairId).then(() => {\r\n\t\t\t\tthis.chair.addToScene(_Renderer_SceneRenderer_js__WEBPACK_IMPORTED_MODULE_17__[\"sceneRenderer\"]);\r\n\t\t\t\t{// Chair#update\r\n\t\t\t\t\tconst bodyRelMove = this.chair.bodyRelMove;\r\n\t\t\t\t\tif (bodyRelMove) {\r\n\t\t\t\t\t\t//this.renderer.tx = bodyRelMove.x;\r\n\t\t\t\t\t\t//this.renderer.ty = bodyRelMove.y;\r\n\t\t\t\t\t\tthis.renderer.x += bodyRelMove.x;\r\n\t\t\t\t\t\tthis.renderer.y += bodyRelMove.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.chair._raw.info.sitAction) {\r\n\t\t\t\t\t\tthis.renderer.action = this.chair._raw.info.sitAction;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.renderer.action = \"sit\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.chair._raw.info.sitEmotion) {\r\n\t\t\t\t\t\tthis.renderer.emotion = window.character_emotion_list[this.chair._raw.info.sitEmotion];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.enablePhysics = false;\r\n\t\t\t\tthis.$physics.body.SetAwake(false);\r\n\t\t\t\tthis.$physics.foot_walk.SetAwake(false);\r\n\t\t\t});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"already sit\");\r\n\t\t}\r\n\t}\r\n\tnoSit() {\r\n\t\tthis.enablePhysics = true;\r\n\t\tthis.$physics.body.SetAwake(true);\r\n\t\tthis.$physics.foot_walk.SetAwake(true);\r\n\t\t\r\n\t\t{// Chair#update\r\n\t\t\t//this.renderer.tx = 0;\r\n\t\t\t//this.renderer.ty = 0;\r\n\t\t\tconst bodyRelMove = this.chair.bodyRelMove;\r\n\t\t\tif (bodyRelMove) {\r\n\t\t\t\tthis.renderer.x -= bodyRelMove.x;\r\n\t\t\t\tthis.renderer.y -= bodyRelMove.y;\r\n\t\t\t}\r\n\r\n\t\t\tthis.renderer.action = \"stand1\";\r\n\t\t\tthis.renderer.emotion = \"blink\";\r\n\t\t}\r\n\t\t\r\n\t\tthis.chair = null;//TODO: remove chair\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} skillId\r\n\t * @param {function(SceneSkill):void} [cbfunc]\r\n\t * @returns {SceneSkill}\r\n\t */\r\n\tinvokeSkill(skillId, cbfunc) {\r\n\t\tif (window.$io) {\r\n\t\t\tthis.__invokeSkill_client(skillId).then(cbfunc);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn this.__invokeSkill_offline(skillId);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {string} skillId\r\n\t * @returns {SceneSkill}\r\n\t */\r\n\tasync __invokeSkill_client(skillId) {\r\n\t\tlet isValid;\r\n\t\ttry {\r\n\t\t\tisValid = await window.$io.emit(\"skill\", {\r\n\t\t\t\tskillId: skillId\r\n\t\t\t});\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(ex);\r\n\t\t}\r\n\t\tif (isValid) {\r\n\t\t\treturn this.__invokeSkill_offline(skillId);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {string} skillId\r\n\t * @returns {SceneSkill}\r\n\t */\r\n\t__invokeSkill_offline(skillId) {\r\n\t\tlet skill = new _Skill_js__WEBPACK_IMPORTED_MODULE_7__[\"SceneSkill\"]();\r\n\t\tskill.load(skillId, this);\r\n\t\tthis.activeSkills.set(skillId, skill);\r\n\t\treturn skill;\r\n\t}\r\n\r\n\t/**\r\n\t * after step, before rendering\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst renderer = this.renderer;\r\n\r\n\t\tthis.chatCtrl.update(stamp);\r\n\r\n\t\tthis._handleSkill(stamp);\r\n\r\n\t\tthis._player_control();\r\n\r\n\t\tif ($gv.m_editor_mode) {\r\n\t\t\tif (renderer.speed > 0 && this.$physics && this.enablePhysics) {\r\n\t\t\t\tthis._applyState({\r\n\t\t\t\t\tfront: this.$physics.state.front,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.$physics) {\r\n\t\t\tthis._applyState(this.$physics.state);\r\n\t\t}\r\n\r\n\t\tif (this.$physics) {\r\n\t\t\tif (renderer && this.enablePhysics) {\r\n\t\t\t\tconst pos = this.$physics.getPosition();\r\n\t\t\t\tconst px = Math.trunc(pos.x * $gv.CANVAS_SCALE + 0.5);\r\n\t\t\t\tconst py = Math.trunc(pos.y * $gv.CANVAS_SCALE + 0.5);\r\n\r\n\t\t\t\t//position\r\n\t\t\t\trenderer.x = px;\r\n\t\t\t\trenderer.y = py;\r\n\t\t\t\t\r\n\t\t\t\t//rotate\r\n\t\t\t\tif (this.$physics.body.GetAngle() || this.$physics.body.GetAngularVelocity()) {\r\n\t\t\t\t\trenderer.angle = this.$physics.body.GetAngle();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\trenderer.angle = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//layer\r\n\t\t\t\tthis.$layer = this.$physics.getLayer();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trenderer.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_$drawName(renderer) {\r\n\t\tconst name = this.id;\r\n\t\tthis.__drawName(renderer, name, this.labelStyle || $gv.NameLabel_default_style);\r\n\t}\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\t_$drawChatBalloon(renderer) {\r\n\t\tthis.chatCtrl.draw(renderer, this);//this.chatText || \"123451234512345123451234512345123451234512345123451234512345123451234512345123451234\", 84\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\t_player_control() {\r\n\t}\r\n\r\n\t/**\r\n\t * 'character physics state' to 'character renderer state'\r\n\t * @param {PPlayerState} player_state\r\n\t */\r\n\t_applyState(player_state) {\r\n\t\tconst renderer = this.renderer;\r\n\t\tconst pState = this.$physics.state;\r\n\r\n\t\t// renderer: apply default action\r\n\t\tif (!pState.invokeSkill) {\r\n\t\t\tconst { front, jump, walk, prone, fly, ladder } = player_state;\r\n\t\t\tconst enablePhysics = chara.enablePhysics;\r\n\r\n\t\t\tif (front != null) {\r\n\t\t\t\trenderer.front = front;\r\n\t\t\t}\r\n\r\n\t\t\tif (ladder) {\r\n\t\t\t\tif (enablePhysics && this.$physics.ladder) {\r\n\t\t\t\t\tif (this.$physics.ladder.isLadder()) {\r\n\t\t\t\t\t\trenderer.action = \"ladder\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\trenderer.action = \"rope\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (pState.ladder_move_dir) {\r\n\t\t\t\t\t\tif (chara.renderer.actani.isEnd()) {\r\n\t\t\t\t\t\t\tchara.renderer.actani.reset();\r\n\t\t\t\t\t\t\trenderer.actani.loop = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\trenderer.actani._is_end = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (jump) {\r\n\t\t\t\trenderer.action = \"jump\";\r\n\t\t\t\trenderer.actani.loop = false;\r\n\t\t\t}\r\n\t\t\telse if (walk) {\r\n\t\t\t\trenderer.action = \"walk1\";\r\n\t\t\t\trenderer.actani.loop = true;\r\n\t\t\t}\r\n\t\t\telse if (prone) {\r\n\t\t\t\trenderer.action = \"prone\";\r\n\t\t\t\trenderer.actani.loop = false;\r\n\t\t\t}\r\n\t\t\telse if (fly) {\r\n\t\t\t\trenderer.action = \"fly\";\r\n\t\t\t\trenderer.actani.loop = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\trenderer.action = \"stand1\";\r\n\t\t\t\trenderer.actani.loop = true;\r\n\t\t\t}\r\n\r\n\t\t\t//TODO: keyboard: emotion key\r\n\t\t\tfor (let i = 0; i <= 9; ++i) {\r\n\t\t\t\tif ($gv.input_keyDown[i]) {\r\n\t\t\t\t\tlet a = [\r\n\t\t\t\t\t\t\"blink\", \"hit\", \"smile\",\r\n\t\t\t\t\t\t\"troubled\", \"cry\", \"angry\",\r\n\t\t\t\t\t\t\"bewildered\", \"stunned\", \"vomit\",\r\n\t\t\t\t\t\t\"oops\"\r\n\t\t\t\t\t];\r\n\t\t\t\t\tlet e = a[i % a.length];\r\n\t\t\t\t\trenderer.emotion = e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * route\r\n\t * 結算攻擊傷害\r\n\t */\r\n\t_handleSkill(stamp) {\r\n\t\t/** @type {AttackInfo[]} */\r\n\t\tlet attackInfoList = [];\r\n\t\t\r\n\t\tthis.activeSkills.forEach(skill => {\r\n\t\t\tif (skill) {\r\n\t\t\t\tif (skill.isEnd()) {\r\n\t\t\t\t\tthis.activeSkills.delete(skill.skillId);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tskill.update(stamp, this);\r\n\t\t\t\t}\r\n\t\t\t\t//clear all attack\r\n\t\t\t\tlet allAttack = skill.attackInfo.shiftAllAttack();\r\n\t\t\t\tif (allAttack.length) {\r\n\t\t\t\t\tlet attackInfo = new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_11__[\"AttackInfo\"]();\r\n\t\t\t\t\tattackInfo.allAttack = allAttack;\r\n\t\t\t\t\tattackInfoList.push(attackInfo);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tif (attackInfoList.length) {\r\n\t\t\tif (window.$io) {\r\n\t\t\t\tthis.__handleAttack_client(attackInfoList);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.__handleAttack_offline(attackInfoList);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 結算攻擊傷害\r\n\t * @param {AttackInfo[]} attackInfoList\r\n\t */\r\n\tasync __handleAttack_client(attackInfoList) {\r\n\t\tlet isValid = await window.$io.emit(\"attack\", {\r\n\t\t\t//TODO: online mode: packet_attack\r\n\t\t\tattack: attackInfoList\r\n\t\t});\r\n\t\t\r\n\t\tif (isValid) {\r\n\t\t\t//TODO: online mode: attack ??\r\n\t\t\tthis.__handleAttack_offline(attackInfoList);//show attack\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * 結算攻擊傷害\r\n\t * @param {AttackInfo[]} attackInfoList\r\n\t */\r\n\t__handleAttack_offline(attackInfoList) {\r\n\t\tfor (let attackInfo of attackInfoList) {\r\n\t\t\tfor (let i = 0; i < attackInfo.allAttack.length; ++i) {\r\n\t\t\t\tconst attack = attackInfo.allAttack[i];\r\n\r\n\t\t\t\tconst targetObject = attack.getTargetObject();\r\n\r\n\t\t\t\tfor (let j = 0; j < attack.allDamage.length; ++j) {\r\n\t\t\t\t\tlet damVar = this.stat.getCurrentMaxBaseDamage() - this.stat.getCurrentMinBaseDamage();\r\n\t\t\t\t\tlet realDamage = this.stat.getCurrentMinBaseDamage() + Math.random() * damVar;\r\n\t\t\t\t\tlet damage = attack.allDamage[j] = new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_11__[\"DamagePair\"]();\r\n\t\t\t\t\tlet style;\r\n\r\n\t\t\t\t\tif (Math.trunc(Math.random() * 100) < this.stat.critRate) {\r\n\t\t\t\t\t\trealDamage = realDamage * (1 + this.stat.critDamage / 100);\r\n\t\t\t\t\t\tdamage.critical = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\trealDamage = Math.trunc(realDamage);\r\n\t\t\t\t\tdamage.realDamage = realDamage;\r\n\r\n\t\t\t\t\ttargetObject.damage(this, realDamage);\r\n\r\n\t\t\t\t\tif (damage.critical) {\r\n\t\t\t\t\t\tstyle = \"NoCri\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tstyle = \"NoRed\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//TODO: ?? target position\r\n\t\t\t\t\t_Renderer_DamageNumber_js__WEBPACK_IMPORTED_MODULE_15__[\"damageNumberLayer\"].addDamagePair(this.damageSkin || \"default\", style, damage, targetObject.x + (attack.allDamage.length > 1 ? (25 - (1 - j & 1) * 25) : 0), targetObject.y, j * 100);\r\n\t\t\t\t}\r\n\t\t\t\t//\r\n\t\t\t\ttargetObject.knockback(this, 16, 16);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * client player\r\n */\r\nclass SceneCharacter extends BaseSceneCharacter {\r\n\t/**\r\n\t * @param {SceneMap} scene\r\n\t */\r\n\tconstructor(scene) {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {CharacterRenderer} */\r\n\t\tthis.renderer = new _Renderer_CharacterRenderer_js__WEBPACK_IMPORTED_MODULE_3__[\"CharacterRenderer\"]();\r\n\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis.$physics = scene.controller.$createPlayer(this, this.renderer);//new PPlayer();\r\n\r\n\t\tthis.$layer = 5;\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.id = null;\r\n\r\n\t\t/** @type {ItemSlot[][]} - item inventory */\r\n\t\tthis.items = new Array(5);\r\n\t\tfor (let i = 0; i < 5; ++i) {\r\n\t\t\tthis.items[i] = new Array(128);\r\n\t\t\tfor (let j = 0; j < 128; ++j) {\r\n\t\t\t\tthis.items[i][j] = new _Item_js__WEBPACK_IMPORTED_MODULE_6__[\"ItemSlot\"](j, null, null, 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//this.addItem(\"01005177\", 1);\r\n\t\t//this.addItem(\"01053322\", 1);\r\n\t\t//this.addItem(\"01073284\", 1);\r\n\r\n\t\tthis.stat.onJobChange(this._onJobChange.bind(this));\r\n\t}\r\n\r\n\t_onJobChange() {\r\n\t\t//TODO: register buf, debuf, autofire skill\r\n\t\t//TODO: 二段跳取代跳躍鍵\r\n\t\tconst newJob = this.stat.job;\r\n\r\n\t\tconsole.log(\"Player(\" + this.$objectid + \") change job: \" + newJob);\r\n\t}\r\n\r\n\t/**\r\n\t * 'character physics state' to 'character renderer state'\r\n\t * @param {PPlayerState} player_state\r\n\t */\r\n\t_applyState(player_state) {\r\n\t\tsuper._applyState(player_state);\r\n\r\n\t\tthis.$recMove();\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_player_control() {\r\n\t\tif (!this.$physics) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//if (!this.$physics.state.jump && this.$$jump_state) {\r\n\t\t//\tdelete this.$$jump_state;\r\n\t\t//}\r\n\t\tconst key_map = keyboard_map[$gv.m_editor_mode ? 1 : 0];\r\n\r\n\t\t/** @type {{[key:string]:number}} */\r\n\t\tlet ikey = {};\r\n\r\n\t\tlet can_use_skill = this.activeSkills.size == 0;//TODO: 以查表法檢查不同技能是否可以同時使用\r\n\r\n\t\tfor (let keyName in key_map) {\r\n\t\t\t/** @type {KeySlot} */\r\n\t\t\tconst keySlot = key_map[keyName];\r\n\t\t\tif (!keySlot) {\r\n\t\t\t\tdebugger;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tconst keyDown = $gv.input_keyDown[keyName];\r\n\t\t\tconst keyUp = $gv.input_keyUp[keyName];\r\n\r\n\t\t\tswitch (keySlot.type) {\r\n\t\t\t\tcase \"Command\"://open or close UI, ...\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Action\":\r\n\t\t\t\t\tif (keyDown) {\r\n\t\t\t\t\t\t/** @type {ActionSlot} */\r\n\t\t\t\t\t\tconst ck = keySlot.data;\r\n\t\t\t\t\t\tif (this.chair) {\r\n\t\t\t\t\t\t\tif (ck.action == \"left\" ||\r\n\t\t\t\t\t\t\t\tck.action == \"right\" ||\r\n\t\t\t\t\t\t\t\tck.action == \"jump\"\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tthis.noSit();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tikey[ck.action] = keyDown;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"Item\":\r\n\t\t\t\t\tif (keyDown) {\r\n\t\t\t\t\t\t/** @type {ItemSlot} */\r\n\t\t\t\t\t\tconst itemSlot = keySlot.data;\r\n\t\t\t\t\t\tthis.useItem(itemSlot.data.id);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this.chair) {\r\n\t\t\t//TODO: stamp\r\n\t\t\tconst stamp = 0;\r\n\t\t\tif (this.jobController.update(this, stamp, ikey)) {\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let keyName in key_map) {\r\n\t\t\t\t\t/** @type {KeySlot} */\r\n\t\t\t\t\tconst keySlot = key_map[keyName];\r\n\t\t\t\t\tif (!keySlot) {\r\n\t\t\t\t\t\tdebugger;\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst keyDown = $gv.input_keyDown[keyName];\r\n\t\t\t\t\tconst keyUp = $gv.input_keyUp[keyName];\r\n\r\n\t\t\t\t\tif (keySlot.type == \"Skill\") {\r\n\t\t\t\t\t\t/** @type {SkillSlot} */\r\n\t\t\t\t\t\tconst ks = keySlot.data;\r\n\t\t\t\t\t\tconst skill_id = ks.skill_id;\r\n\t\t\t\t\t\tlet skill = this.activeSkills.get(skill_id);\r\n\t\t\t\t\t\tif (keyDown && can_use_skill) {\r\n\t\t\t\t\t\t\tskill = skill || this.invokeSkill(skill_id);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (skill) {\r\n\t\t\t\t\t\t\tskill.control(ikey, keyDown, keyUp);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.$physics.control(ikey);//apply action control\r\n\t}\r\n\r\n\t/**\r\n\t * route addItem\r\n\t * @param {string} itemId\r\n\t * @param {number} amount\r\n\t */\r\n\taddItem(itemId, amount) {\r\n\t\tif (window.$io) {\r\n\t\t\t//TODO: online mode: addItem\r\n\t\t\tconsole.warn(\"未完成: __addItem_client\");\r\n\t\t\t//this.__addItem_client(itemId, amount);\r\n\t\t}\r\n\t\t//else {\r\n\t\t\tthis.__addItem_offline(itemId, amount);\r\n\t\t//}\r\n\t}\r\n\t/**\r\n\t * @param {string} itemId\r\n\t * @param {number} amount\r\n\t */\r\n\tasync __addItem_client(itemId, amount) {\r\n\t\t//TODO: online mode: addItem\r\n\t\tconsole.warn(\"未完成: __addItem_client\");\r\n\t\t\r\n\t\tlet result = await window.$io.emit(\"addItem\", {\r\n\t\t\ttype: type,\r\n\t\t\tslot: slot,\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @param {string} itemId\r\n\t * @param {number} amount\r\n\t */\r\n\t__addItem_offline(itemId, amount) {\r\n\t\t/** @type {Partial<ItemEquip>} */\r\n\t\tlet props = {//test attr\r\n\t\t\tincDEXr: Math.trunc(Math.random() * 3),\r\n\t\t\ttimeLimited: Date(),\r\n\t\t};\r\n\r\n\t\tObject(_Item_js__WEBPACK_IMPORTED_MODULE_6__[\"$createItem\"])(itemId, props).then(item => {\r\n\t\t\tthis._addItem(item, amount);\r\n\t\t}, function (err) {\r\n\t\t\tconsole.warn(err);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @template T\r\n\t * @param {T extends ItemBase ? T : never} itemData\r\n\t * @param {number} amount\r\n\t */\r\n\t_addItem(itemData, amount) {\r\n\t\tlet SN = 123;\r\n\t\tlet itemId = itemData.id;\r\n\t\tlet slotType = itemData.getSlot();\r\n\t\tfor (let i = 0; i < this.items[slotType].length; ++i) {\r\n\t\t\tif (this.items[slotType][i].isEmpty()) {\r\n\t\t\t\tif (window.$addItem_repeatEquip) {\r\n\t\t\t\t\tthis.items[slotType][i].assign(i, SN, itemData, slotType ? amount : 1);\r\n\t\t\t\t\tconsole.info(`give ${this.id}: ${itemId} * ${amount}`);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (slotType == 0) {\r\n\t\t\t\t\t\tthis.items[slotType][i].assign(i, SN, itemData, 1);\r\n\t\t\t\t\t\tamount--;\r\n\t\t\t\t\t\tif (amount == 0) {\r\n\t\t\t\t\t\t\tconsole.info(`repeat give ${this.id}: ${itemId}`);\r\n\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.items[slotType][i].assign(i, SN, itemData, amount);\r\n\t\t\t\t\t\tconsole.info(`give ${this.id}: ${itemId} * ${amount}`);\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;//item inventory was full\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} type - item type\r\n\t * @param {number} slot\r\n\t */\r\n\tremoveItem(type, slot) {\r\n\t\tif (window.$io) {\r\n\t\t\t//TODO: online mode: removeItem\r\n\t\t\tconsole.warn(\"未完成: removeItem\");\r\n\t\t}\r\n\t\t//if (window.$io) {//TODO: online mode: removeItem\r\n\t\t//\tconsole.warn(\"未完成: removeItem\");\r\n\t\t//\t\r\n\t\t//\twindow.$io.emit(\"removeItem\", {\r\n\t\t//\t\ttype: type,\r\n\t\t//\t\tslot: slot,\r\n\t\t//\t}).then(results => {\r\n\t\t//\t\tif (result) {\r\n\t\t//\t\t\tthis._removeItem(type, slot);\r\n\t\t//\t\t}\r\n\t\t//\t\treturn result;\r\n\t\t//\t}, err => {\r\n\t\t//\t\tconsole.error(err);\r\n\t\t//\t});\r\n\t\t//}\r\n\t\t//else {\r\n\t\t\treturn this._removeItem(type, slot);\r\n\t\t//}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} type - item type\r\n\t * @param {number} slot\r\n\t */\r\n\t_removeItem(type, slot) {\r\n\t\tthis.items[type][slot]._clear();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} from\r\n\t * @param {number} to\r\n\t */\r\n\tmoveItemToSlot(from, to) {\r\n\t\t//TODO: (\"./ui/Basic/UISlotItem.vue\").methods.drop\r\n\t\tdebugger;\r\n\t}\r\n\r\n\t///**\r\n\t// * @param {any} id\r\n\t// */\r\n\t//$getItem(id) {\r\n\t//\tthis.itemSlot\r\n\t//}\r\n\r\n\t/**\r\n\t * @param {number} itemId\r\n\t */\r\n\tfindItem(itemId) {\r\n\t\tfor (let i = 0; i < this.items.length; ++i) {\r\n\t\t\tfor (let j = 0; j < this.items[i].length; ++j) {\r\n\t\t\t\tlet itemSlot = this.items[i][j];\r\n\r\n\t\t\t\tif (itemSlot && itemSlot.data && (itemSlot.data.id == itemId)) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\ttypeName: _public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].typeName[i],\r\n\t\t\t\t\t\titemSlot: itemSlot,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttypeName: null,\r\n\t\t\titemSlot: null,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * route\r\n\t * @param {number} itemId\r\n\t */\r\n\tuseItem(itemId, category, itemInfo) {\r\n\t\tif (window.$io) {\r\n\t\t\tthis.__useItem_client(itemId);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.__useItem_offline(itemId);\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @param {number} itemId\r\n\t * @returns {Promise<{}>}\r\n\t */\r\n\t__useItem_client(itemId) {\r\n\t\treturn window.$io.emit(\"useItem\", {\r\n\t\t\titemId: itemId\r\n\t\t}).then(results => {\r\n\t\t\tif (results) {\r\n\t\t\t\tthis.__useItem_offline(itemId);\r\n\t\t\t}\r\n\t\t\treturn results;\r\n\t\t}, err => {\r\n\t\t\tconsole.log();\r\n\t\t\tconsole.error(\"can't use item: %o\\nerror: %o\", id, err);\r\n\t\t});\r\n\t}\r\n\t/**\r\n\t * @param {number} itemId\r\n\t */\r\n\t__useItem_offline(itemId) {\r\n\t\tconst args = arguments;\r\n\t\tlet existItem = this.findItem(itemId).itemSlot;\r\n\r\n\t\tif (existItem) {\r\n\t\t\tif (!$gv.m_editor_mode) {\r\n\t\t\t\tconsole.log(`消耗道具：${itemId}。未完成`);\r\n\t\t\t\tthis._consume(itemId, 1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(`使用道具：${itemId}。`);\r\n\t\t\t}\r\n\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].isChair(itemId)) {\r\n\t\t\t\tthis.sitChair(itemId);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tupdate_renderer.call(this);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif ($gv.m_editor_mode) {\r\n\t\t\t\tthis.addItem(itemId, 1);\r\n\t\t\t\tif (_public_javascripts_resource_js__WEBPACK_IMPORTED_MODULE_0__[\"ItemCategoryInfo\"].isChair(itemId)) {\r\n\t\t\t\t\tthis.sitChair(itemId);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tupdate_renderer.call(this);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(\"無法使用不存在的道具。you can try add item editor mode\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction update_renderer() {\r\n\t\t\t//TODO: implement job\r\n\t\t\tif (true) {\r\n\t\t\t\tconst category = args[1], equipInfo = args[2];\r\n\t\t\t\tthis.renderer.use(itemId, category, equipInfo);\r\n\t\t\t}\r\n\t\t\telse {}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} text\r\n\t * @returns {Promise<boolean>}\r\n\t */\r\n\tasync say(text) {\r\n\t\tif (window.$io) {\r\n\t\t\tlet result = await window.$io.emit(\"chat\", {\r\n\t\t\t\t$style: this.chatCtrl.style,\r\n\t\t\t\ttext: text,\r\n\t\t\t});\r\n\t\t\tif (result) {\r\n\t\t\t\tthis.chatCtrl.enter(text);\r\n\t\t\t}\r\n\t\t\treturn result;//boolean\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.chatCtrl.enter(text);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\t\r\n\t$emit(socket) {\r\n\t\tif (this.$outPacket.move) {\r\n\t\t\tsocket.emit(\"charaMove\", this.$outPacket.move);\r\n\t\t\tthis.$outPacket.move = null;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet charaMove = new _Common_Packet__WEBPACK_IMPORTED_MODULE_10__[\"$Packet_CharacterMove\"]();\r\n\r\n\t\t\tcharaMove.capture(this);\r\n\r\n\t\t\tsocket.emit(\"charaMove\", charaMove);\r\n\t\t}\r\n\r\n\t\tthis.$outPacket.move = null;\r\n\t}\r\n\t\r\n\t$recMove() {\r\n\t\tlet move = this.$outPacket.move || new _Common_Packet__WEBPACK_IMPORTED_MODULE_10__[\"$Packet_CharacterMove\"]();\r\n\t\tmove.capture(this);\r\n\t\tthis.$outPacket.move = move;\r\n\t}\r\n}\r\n\r\n/**\r\n * remote player\r\n */\r\nclass SceneRemoteCharacter extends BaseSceneCharacter {\r\n\t/**\r\n\t * @param {SceneMap} scene\r\n\t */\r\n\tconstructor(scene) {\r\n\t\tsuper();\r\n\r\n\t\tif (true) {\r\n\t\t\tdelete this.$physics;\r\n\t\t\tObject.defineProperty(this, \"$physics\", {\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tconfigurable: false,\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn this.$$physics;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (value) {\r\n\t\t\t\t\tif (value == null) {\r\n\t\t\t\t\t\tconsole.error(\"can not set SceneRemoteCharacter.$physics = null;\");\r\n\t\t\t\t\t\talert(\"can not set SceneRemoteCharacter.$physics = null;\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$$physics = value;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\r\n\t\t\tdelete this.renderer;\r\n\t\t\tObject.defineProperty(this, \"renderer\", {\r\n\t\t\t\tenumerable: false,\r\n\t\t\t\tconfigurable: false,\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn this.$$renderer;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (value) {\r\n\t\t\t\t\tif (value == null) {\r\n\t\t\t\t\t\tconsole.error(\"can not set SceneRemoteCharacter.renderer = null;\");\r\n\t\t\t\t\t\talert(\"can not set SceneRemoteCharacter.renderer = null;\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$$renderer = value;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/** @type {CharacterRenderer} */\r\n\t\tthis.renderer = new _Renderer_CharacterRenderer_js__WEBPACK_IMPORTED_MODULE_3__[\"CharacterRenderer\"]();\r\n\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis.$physics = scene.controller.$createRemotePlayer(this, this.renderer);\r\n\t}\r\n\r\n\tget $remote() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_player_control() {\r\n\t\tthis._remote_control();\r\n\t}\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9TY2VuZUNoYXJhY3Rlci5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1NjZW5lQ2hhcmFjdGVyLmpzPzg5MTYiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IEl0ZW1DYXRlZ29yeUluZm8gfSBmcm9tIFwiLi4vLi4vcHVibGljL2phdmFzY3JpcHRzL3Jlc291cmNlLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBJUmVuZGVyZXIgfSBmcm9tIFwiLi9JUmVuZGVyZXIuanNcIjtcclxuXHJcbmltcG9ydCB7IFNjZW5lT2JqZWN0IH0gZnJvbSBcIi4vU2NlbmVPYmplY3QuanNcIjtcclxuaW1wb3J0IHsgQ2hhcmFjdGVyUmVuZGVyZXIgfSBmcm9tIFwiLi9SZW5kZXJlci9DaGFyYWN0ZXJSZW5kZXJlci5qc1wiO1xyXG5pbXBvcnQgeyBDaGF0QmFsbG9vbiB9IGZyb20gXCIuL1JlbmRlcmVyL0NoYXRCYWxsb29uLmpzXCI7XHJcbmltcG9ydCB7IFBQbGF5ZXIsIFBQbGF5ZXJTdGF0ZSB9IGZyb20gXCIuL1BoeXNpY3MvUFBsYXllci5qc1wiO1xyXG5cclxuaW1wb3J0IHsgJGNyZWF0ZUl0ZW0sIEl0ZW1FcXVpcCwgSXRlbVNsb3QsIEl0ZW1CYXNlIH0gZnJvbSBcIi4vSXRlbS5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZVNraWxsIH0gZnJvbSBcIi4vU2tpbGwuanNcIjtcclxuXHJcbmltcG9ydCB7IENoYXJhY3RlclN0YXQgfSBmcm9tIFwiLi4vQ29tbW9uL1BsYXllckRhdGEuanNcIjtcclxuaW1wb3J0IHsgQ2hhcmFjdGVyTW92ZUVsZW0gfSBmcm9tIFwiLi4vQ2xpZW50L1BNb3ZlUGF0aC5qc1wiO1xyXG5pbXBvcnQgeyAkUGFja2V0X0NoYXJhY3Rlck1vdmUgfSBmcm9tIFwiLi4vQ29tbW9uL1BhY2tldFwiO1xyXG5pbXBvcnQgeyBBdHRhY2tJbmZvLCBEYW1hZ2VQYWlyIH0gZnJvbSBcIi4uL0NvbW1vbi9BdHRhY2tJbmZvLmpzXCI7XHJcblxyXG5pbXBvcnQgeyBLZXlTbG90LCBDb21tYW5kU2xvdCwgQWN0aW9uU2xvdCwgU2tpbGxTbG90IH0gZnJvbSBcIi4uL3VpL0Jhc2ljL0tleVNsb3QuanNcIjtcclxuaW1wb3J0IHsgSW5wdXRLZXkgfSBmcm9tIFwiLi9JbnB1dEtleS5qc1wiO1xyXG5cclxuaW1wb3J0IHsgU2NlbmVNYXAgfSBmcm9tIFwiLi9NYXAuanNcIjtcclxuaW1wb3J0IHsgZGFtYWdlTnVtYmVyTGF5ZXIgfSBmcm9tIFwiLi9SZW5kZXJlci9EYW1hZ2VOdW1iZXIuanNcIjtcclxuaW1wb3J0IHsgQ2hhaXIgfSBmcm9tIFwiLi9SZW5kZXJlci9DaGFpci5qc1wiO1xyXG5pbXBvcnQgeyBzY2VuZVJlbmRlcmVyLCBTY2VuZVJlbmRlcmVyIH0gZnJvbSBcIi4vUmVuZGVyZXIvU2NlbmVSZW5kZXJlci5qc1wiO1xyXG5cclxuXHJcbi8vIFNjZW5lQ2hhcmFjdGVy55qE5pu05paw5rWB56iLXHJcbi8vXHJcbi8vIGNoYXRDdHJsLnVwZGF0ZSAo6aCG5bqP54Sh6ZecKVxyXG4vL1xyXG4vLyA8Li4uY29udHJvbGxlcj5cclxuLy8gY29udHJvbFxyXG4vLyBhY3RpdmVTa2lsbHMuZm9yRWFjaChza2lsbCA9PiBza2lsbC51cGRhdGUpXHJcbi8vIGNoYXJhLl9oYW5kbGVBdHRhY2tcclxuLy8gY2hhcmEuX3BsYXllcl9jb250cm9sID0+IHsgaW5wdXRLZXkuZm9yRWFjaChrZXkgPT4ga2V5ID8gYWN0aXZlU2tpbGxzLmZvckVhY2goc2tpbGwgPT4gc2tpbGwuY29udHJvbCkpOyAuLi4gfVxyXG4vLyBjaGFyYS5fYXBwbHlTdGF0ZVxyXG4vL1xyXG4vLyA8cmVuZGVyZXI+XHJcbi8vIHNldCBjaGFyYS5yZW5kZXJlci5wb3NpdGlvblxyXG4vLyBjaGFyYS5yZW5kZXJlci51cGRhdGVcclxuXHJcblxyXG53aW5kb3cuJGFkZEl0ZW1fcmVwZWF0RXF1aXAgPSBmYWxzZTtcclxuXHJcblxyXG5jbGFzcyBUaW1lRWxhcHNlZCB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHQvKiogQHR5cGUge0RhdGV9ICovXHJcblx0XHR0aGlzLl9kYXRlID0gbmV3IERhdGUoKTtcclxuXHR9XHJcblx0cmVzZXQoKSB7XHJcblx0XHR0aGlzLl9kYXRlID0gbmV3IERhdGUoKTtcclxuXHR9XHJcblx0Z2V0IGVsYXBzZWQoKSB7XHJcblx0XHRjb25zdCBlbGFwc2VkID0gKG5ldyBEYXRlKCkpLmdldE1pbGxpc2Vjb25kcygpIC0gdGhpcy5fZGF0ZS5nZXRNaWxsaXNlY29uZHMoKTtcclxuXHRcdHJldHVybiBlbGFwc2VkO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbmNsYXNzIENoYXRDb250cm9sbGVyIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy50ZXh0ID0gXCJcIjtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuJG91dHB1dFRleHQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5lbGFwc2VkID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLl9pc0Rpc3BsYXkgPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0XHJcblx0ICovXHJcblx0ZW50ZXIodGV4dCkge1xyXG5cdFx0dGhpcy50ZXh0ID0gU3RyaW5nKHRleHQpO1xyXG5cdFx0dGhpcy4kb3V0cHV0VGV4dCA9IG51bGw7XHJcblx0XHR0aGlzLmlzRGlzcGxheSA9IHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGNvbnN0ICRkaXNwbGF5RHVyYXRpb24gPSB0aGlzLmRpc3BsYXlEdXJhdGlvbjtcclxuXHJcblx0XHRpZiAodGhpcy5lbGFwc2VkID4gJGRpc3BsYXlEdXJhdGlvbikge1xyXG5cdFx0XHR0aGlzLmlzRGlzcGxheSA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuZWxhcHNlZCArPSBzdGFtcDtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7QmFzZVNjZW5lQ2hhcmFjdGVyfSBjaGFyYVxyXG5cdCAqL1xyXG5cdGFzeW5jIGRyYXcocmVuZGVyZXIsIGNoYXJhKSB7XHJcblx0XHRpZiAodGhpcy5faXNEaXNwbGF5KSB7XHJcblx0XHRcdGNvbnN0IHN0eWxlID0gY2hhcmEuY2hhdEJhbGxvb25TdHlsZSB8fCAkZ3YuQ2hhdEJhbGxvb25fZGVmYXVsdF9zdHlsZTtcclxuXHJcblx0XHRcdC8qKiBAdHlwZSB7Q2hhdEJhbGxvb259ICovXHJcblx0XHRcdGxldCBjYiA9IENoYXRCYWxsb29uLmNhY2hlW3N0eWxlXTtcclxuXHRcdFx0aWYgKCFjYikge1xyXG5cdFx0XHRcdGNiID0gbmV3IENoYXRCYWxsb29uKCk7XHJcblx0XHRcdFx0YXdhaXQgY2IubG9hZChzdHlsZSk7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGNvbnN0ICRjb2xvbiA9IHRoaXMuY29sb247XHJcblx0XHRcdGNvbnN0IGNyciA9IGNoYXJhLnJlbmRlcmVyO1xyXG5cdFx0XHRjb25zdCBib3VuZEJveCA9IGNyci5fYm91bmRCb3g7XHJcblxyXG5cdFx0XHRpZiAoIXRoaXMuJG91dHB1dFRleHQpIHtcclxuXHRcdFx0XHR0aGlzLiRvdXRwdXRUZXh0ID0gY2hhcmEuaWQgKyAkY29sb24gKyB0aGlzLnRleHQ7XHJcblx0XHRcdH1cclxuXHRcdFx0Y2IuZHJhdyhyZW5kZXJlciwgdGhpcy4kb3V0cHV0VGV4dCwgY3JyLngsIGNyci55IC0gYm91bmRCb3guaGVpZ2h0KTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGdldCBpc0Rpc3BsYXkoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5faXNEaXNwbGF5O1xyXG5cdH1cclxuXHRzZXQgaXNEaXNwbGF5KHZhbHVlKSB7XHJcblx0XHR0aGlzLl9pc0Rpc3BsYXkgPSAhIXZhbHVlO1xyXG5cdFx0dGhpcy5lbGFwc2VkID0gMDtcclxuXHR9XHJcblxyXG5cdC8qKiBAdHlwZSB7XCIgOiBcIn0gKi9cclxuXHRnZXQgY29sb24oKSB7XHJcblx0XHRyZXR1cm4gXCIgOiBcIjtcclxuXHR9XHJcblx0Z2V0ICRtYXhMZW5ndGgoKSB7XHJcblx0XHRyZXR1cm4gNzA7XHJcblx0fVxyXG5cdGdldCBkaXNwbGF5RHVyYXRpb24oKSB7XHJcblx0XHRyZXR1cm4gJGd2LkNoYXRCYWxsb29uX2Rpc3BsYXlfZHVyYXRpb247XHJcblx0fVxyXG59XHJcblxyXG5cclxuY29uc3Qga2V5Ym9hcmRfbWFwID0gW1xyXG5cdHtcclxuXHRcdEFycm93VXA6IG5ldyBLZXlTbG90KFwiQWN0aW9uXCIsIG5ldyBBY3Rpb25TbG90KFwidXBcIikpLFxyXG5cdFx0QXJyb3dMZWZ0OiBuZXcgS2V5U2xvdChcIkFjdGlvblwiLCBuZXcgQWN0aW9uU2xvdChcImxlZnRcIikpLFxyXG5cdFx0QXJyb3dEb3duOiBuZXcgS2V5U2xvdChcIkFjdGlvblwiLCBuZXcgQWN0aW9uU2xvdChcImRvd25cIikpLFxyXG5cdFx0QXJyb3dSaWdodDogbmV3IEtleVNsb3QoXCJBY3Rpb25cIiwgbmV3IEFjdGlvblNsb3QoXCJyaWdodFwiKSksXHJcblx0XHR6OiBuZXcgS2V5U2xvdChcIkFjdGlvblwiLCBuZXcgQWN0aW9uU2xvdChcImp1bXBcIikpLFxyXG5cdFx0Ly96OiBuZXcgS2V5U2xvdChcIlNraWxsXCIsIG5ldyBTa2lsbFNsb3QoXCIyMzAwMTAwMlwiKSksXHJcblx0XHR4OiBuZXcgS2V5U2xvdChcIkFjdGlvblwiLCBuZXcgQWN0aW9uU2xvdChcImF0dGFja1wiKSksXHJcblx0XHRjOiBuZXcgS2V5U2xvdChcIlNraWxsXCIsIG5ldyBTa2lsbFNsb3QoXCIxMDAxMDA1XCIpKSxcclxuXHRcdHY6IG5ldyBLZXlTbG90KFwiU2tpbGxcIiwgbmV3IFNraWxsU2xvdChcIjY0MTIwMDAwXCIpKSxcclxuXHRcdGI6IG5ldyBLZXlTbG90KFwiU2tpbGxcIiwgbmV3IFNraWxsU2xvdChcIjIzMTIxMDAwXCIpKSwvLzE1MjAwMTAwMVxyXG5cdH0sXHJcblx0ey8vZWRpdG9yIG1vZGVcclxuXHRcdHc6IG5ldyBLZXlTbG90KFwiQWN0aW9uXCIsIG5ldyBBY3Rpb25TbG90KFwidXBcIikpLFxyXG5cdFx0YTogbmV3IEtleVNsb3QoXCJBY3Rpb25cIiwgbmV3IEFjdGlvblNsb3QoXCJsZWZ0XCIpKSxcclxuXHRcdHM6IG5ldyBLZXlTbG90KFwiQWN0aW9uXCIsIG5ldyBBY3Rpb25TbG90KFwiZG93blwiKSksXHJcblx0XHRkOiBuZXcgS2V5U2xvdChcIkFjdGlvblwiLCBuZXcgQWN0aW9uU2xvdChcInJpZ2h0XCIpKSxcclxuXHRcdHE6IG5ldyBLZXlTbG90KFwiQWN0aW9uXCIsIG5ldyBBY3Rpb25TbG90KFwianVtcFwiKSksXHJcblx0XHRmOiBuZXcgS2V5U2xvdChcIlNraWxsXCIsIG5ldyBTa2lsbFNsb3QoXCIyMzAwMTAwMlwiKSksLy9kZWJ1Z1xyXG5cdFx0eDogbmV3IEtleVNsb3QoXCJBY3Rpb25cIiwgbmV3IEFjdGlvblNsb3QoXCJhdHRhY2tcIikpLFxyXG5cdFx0YzogbmV3IEtleVNsb3QoXCJTa2lsbFwiLCBuZXcgU2tpbGxTbG90KFwiMTAwMTAwNVwiKSksXHJcblx0XHR2OiBuZXcgS2V5U2xvdChcIlNraWxsXCIsIG5ldyBTa2lsbFNsb3QoXCI2NDEyMDAwMFwiKSksXHJcblx0XHRiOiBuZXcgS2V5U2xvdChcIlNraWxsXCIsIG5ldyBTa2lsbFNsb3QoXCIyMzEyMTAwMFwiKSksLy8xNTIwMDEwMDFcclxuXHR9XHJcbl07XHJcblxyXG5cclxuY2xhc3MgUGxheWVySm9iIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7SW5wdXRLZXl9ICovXHJcblx0XHR0aGlzLmlucHV0S2V5ID0gbmV3IElucHV0S2V5KCk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7QmFzZVNjZW5lQ2hhcmFjdGVyfSBvd25lclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqIEBwYXJhbSB7SW5wdXRLZXl9IGlucHV0S2V5XHJcblx0ICovXHJcblx0dXBkYXRlKG93bmVyLCBzdGFtcCwgaW5wdXRLZXkpIHtcclxuXHRcdGxldCByID0gdGhpcy5fdXBkYXRlX2NvbW1hbmRfc2tpbGwob3duZXIsIHN0YW1wLCBpbnB1dEtleSk7XHJcblx0XHRpZiAocikge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fdXBkYXRlKG93bmVyLCBzdGFtcCwgaW5wdXRLZXkpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0Jhc2VTY2VuZUNoYXJhY3Rlcn0gb3duZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKiBAcGFyYW0ge0lucHV0S2V5fSBpbnB1dEtleVxyXG5cdCAqL1xyXG5cdF91cGRhdGUob3duZXIsIHN0YW1wLCBpbnB1dEtleSkge1xyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0Jhc2VTY2VuZUNoYXJhY3Rlcn0gb3duZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKiBAcGFyYW0ge0lucHV0S2V5fSBpbnB1dEtleVxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufSBpcyBtYXRjaFxyXG5cdCAqL1xyXG5cdF91cGRhdGVfY29tbWFuZF9za2lsbChvd25lciwgc3RhbXAsIGlucHV0S2V5KSB7XHJcblx0XHRjb25zdCBmcm9udEtleSA9IG93bmVyLiRwaHlzaWNzLnN0YXRlLmZyb250ID4gMCA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xyXG5cdFx0XHJcblx0XHQvL3RoaXMuaW5wdXRLZXkudXBkYXRlKHN0YW1wLCBpa2V5KTtcclxuXHRcdFxyXG5cdFx0aWYgKHRoaXMuaW5wdXRLZXkubWF0Y2goW1tcImRvd25cIl0sIFtmcm9udEtleV1dLCAtMSkgfHxcclxuXHRcdFx0dGhpcy5pbnB1dEtleS5tYXRjaChbW1wiZG93blwiXSwgW1wiZG93blwiLCBmcm9udEtleV0sIFtmcm9udEtleV1dLCAtMSlcclxuXHRcdCkge1xyXG5cdFx0XHRpZiAoaW5wdXRLZXkuYXR0YWNrID09IDEpIHtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhcImludm9rZSBza2lsbDog5rOi5YuV5ouzXCIpO1xyXG5cdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG59XHJcblxyXG5jbGFzcyBQbGF5ZXJKb2JfMjMwMCBleHRlbmRzIFBsYXllckpvYiB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtCYXNlU2NlbmVDaGFyYWN0ZXJ9IG93bmVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICogQHBhcmFtIHtJbnB1dEtleX0gaW5wdXRLZXlcclxuXHQgKi9cclxuXHRfdXBkYXRlKG93bmVyLCBzdGFtcCwgaW5wdXRLZXkpIHtcclxuXHRcdGlmIChpbnB1dEtleS5qdW1wKSB7XHJcblx0XHRcdGNvbnN0IHNraWxsX2lkID0gXCIyMzAwMTAwMlwiO1xyXG5cdFx0XHRsZXQgc2tpbGwgPSBvd25lci5hY3RpdmVTa2lsbHMuZ2V0KHNraWxsX2lkKTtcclxuXHRcdFx0Ly9pZiAoa2V5RG93biAmJiBjYW5fdXNlX3NraWxsKSB7XHJcblx0XHRcdFx0c2tpbGwgPSBza2lsbCB8fCBTY2VuZVNraWxsLnByZWxvYWQoc2tpbGxfaWQpO1xyXG5cdFx0XHRcdGlmICghc2tpbGwuJHByb21pc2UgJiYgc2tpbGwudGVzdChvd25lcikpIHtcclxuXHRcdFx0XHRcdHNraWxsID0gc2tpbGwgfHwgb3duZXIuaW52b2tlU2tpbGwoc2tpbGxfaWQpO1xyXG5cdFx0XHRcdFx0aWYgKHNraWxsKSB7XHJcblx0XHRcdFx0XHRcdHNraWxsLmNvbnRyb2woaW5wdXRLZXksIGlucHV0S2V5Lmp1bXAsIDApO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0Ly99XHJcblx0XHRcdC8vaWYgKHNraWxsKSB7XHJcblx0XHRcdC8vXHRza2lsbC5jb250cm9sKGlrZXksIGtleURvd24sIGtleVVwKTtcclxuXHRcdFx0Ly99XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQmFzZVNjZW5lQ2hhcmFjdGVyIGV4dGVuZHMgU2NlbmVPYmplY3Qge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHQvLy8qKiBAdHlwZSB7UFBsYXllcn0gKi9cclxuXHRcdC8vdGhpcy4kcGh5c2ljcyA9IG51bGw7Ly9uZXcgUFBsYXllcigpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyUmVuZGVyZXJ9ICovXHJcblx0XHR0aGlzLnJlbmRlcmVyID0gbnVsbDtcclxuXHRcdHRoaXMuJGxheWVyID0gNTtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMubmFtZSA9IG51bGw7XHJcblxyXG5cdFx0dGhpcy5zdGF0ID0gbmV3IENoYXJhY3RlclN0YXQoKTtcclxuXHRcdFxyXG5cdFx0Ly8gYmVnaW4gUGxheWVyRGF0YVxyXG5cdFx0Ly9UT0RPOiBtb3ZlIHBsYXllciBkYXRhIHRvIFBsYXllckRhdGFcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmNoYXRCYWxsb29uU3R5bGUgPSAwO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMubGFiZWxTdHlsZSA9IDA7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5kYW1hZ2VTa2luID0gXCJkZWZhdWx0XCI7XHJcblx0XHRcclxuXHRcdC8vIGVuZCBQbGF5ZXJEYXRhXHJcblxyXG5cdFx0LyoqIEB0eXBlIHtQbGF5ZXJKb2J9ICovXHJcblx0XHR0aGlzLmpvYkNvbnRyb2xsZXIgPSBuZXcgUGxheWVySm9iXzIzMDAoKTtcclxuXHJcblx0XHQvKiogQHR5cGUge01hcDxzdHJpbmcsU2NlbmVTa2lsbD59ICovXHJcblx0XHR0aGlzLmFjdGl2ZVNraWxscyA9IG5ldyBNYXAoKTtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtNYXA8c3RyaW5nLFNjZW5lU2tpbGw+fSAqL1xyXG5cdFx0dGhpcy5za2lsbENvbnRyb2xsZXJzID0gbmV3IE1hcCgpO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge0NoYWlyfSAqL1xyXG5cdFx0dGhpcy5jaGFpciA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7Q2hhdENvbnRyb2xsZXJ9ICovXHJcblx0XHR0aGlzLmNoYXRDdHJsID0gbmV3IENoYXRDb250cm9sbGVyKCk7XHJcblx0XHRcclxuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcclxuXHRcdFx0JGluUGFja2V0OiB7XHJcblx0XHRcdFx0d3JpdGFibGU6IHRydWUsXHJcblx0XHRcdH0sXHJcblx0XHRcdCRvdXRQYWNrZXQ6IHtcclxuXHRcdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0fSxcclxuXHRcdH0pO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e21vdmU6JFBhY2tldF9DaGFyYWN0ZXJNb3ZlfX0gKi9cclxuXHRcdHRoaXMuJGluUGFja2V0ID0ge307XHJcblx0XHR0aGlzLiRpblBhY2tldC5tb3ZlID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge3ttb3ZlOiRQYWNrZXRfQ2hhcmFjdGVyTW92ZX19ICovXHJcblx0XHR0aGlzLiRvdXRQYWNrZXQgPSB7fTtcclxuXHRcdHRoaXMuJG91dFBhY2tldC5tb3ZlID0gbnVsbDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBhbGlhcyBuYW1lXHJcblx0ICogQHR5cGUge3N0cmluZ31cclxuXHQgKi9cclxuXHRnZXQgaWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5uYW1lO1xyXG5cdH1cclxuXHRzZXQgaWQodmFsdWUpIHtcclxuXHRcdHRoaXMubmFtZSA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQGFsaWFzIG5hbWVcclxuXHQgKiBAdHlwZSB7c3RyaW5nfVxyXG5cdCAqL1xyXG5cdGdldCAkb2JqZWN0aWQoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5uYW1lO1xyXG5cdH1cclxuXHRzZXQgJG9iamVjdGlkKHZhbHVlKSB7XHJcblx0XHR0aGlzLm5hbWUgPSB2YWx1ZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7QmFzZVNjZW5lQ2hhcmFjdGVyfG51bGx9IGNoYXJhIC0g6KKrIGNoYXJhIOaUu+aTilxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBkYW1hZ2UgLSDlgrflrrNcclxuXHQgKi9cclxuXHRkYW1hZ2UoY2hhcmEsIGRhbWFnZSkge1xyXG5cdFx0Y29uc29sZS5sb2coXCJQbGF5ZXIoXCIgKyB0aGlzLiRvYmplY3RpZCArIFwiKSDooqsgXCIgKyBjaGFyYS4kb2JqZWN0aWQgKyBcIiDmlLvmk4rvvIzmuJvlsJEgXCIgKyBkYW1hZ2UgKyBcIiBIUFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7QmFzZVNjZW5lQ2hhcmFjdGVyfG51bGx9IGNoYXJhIC0g6KKrIGNoYXJhIOaUu+aTilxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBtb3ZlWCAtIHVuaXQgaXMgcGl4ZWxcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbW92ZVkgLSB1bml0IGlzIHBpeGVsXHJcblx0ICovXHJcblx0a25vY2tiYWNrKGNoYXJhLCBtb3ZlWCwgbW92ZVkpIHtcclxuXHRcdHRoaXMuJHBoeXNpY3Mua25vY2tiYWNrKG1vdmVYLCBtb3ZlWSwgMTAwMCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0geyRQYWNrZXRfQ2hhcmFjdGVyTW92ZX0gX21vdmVcclxuXHQgKi9cclxuXHQkbW92ZShfbW92ZSkge1xyXG5cdFx0bGV0IG1vdmUgPSBfbW92ZSB8fCB0aGlzLiRpblBhY2tldC5tb3ZlO1xyXG5cdFx0dGhpcy4kaW5QYWNrZXQubW92ZSA9IG1vdmU7XHJcblx0fVxyXG5cclxuXHRfcmVtb3RlX2NvbnRyb2woKSB7XHJcblx0XHRsZXQgbW92ZSA9IHRoaXMuJGluUGFja2V0Lm1vdmU7XHJcblxyXG5cdFx0aWYgKG1vdmUgJiYgbW92ZS5wYXRoICYmIG1vdmUucGF0aC5sZW5ndGgpIHtcclxuXHRcdFx0Y29uc3QgY3JyID0gdGhpcy5yZW5kZXJlcjtcclxuXHRcdFx0bGV0IGVsZW0gPSBtb3ZlLnBhdGguc2hpZnQoKTtcclxuXHJcblx0XHRcdGlmIChlbGVtLmlzQXdha2UpIHtcclxuXHRcdFx0XHR0aGlzLiRwaHlzaWNzLm1vdmVUbyhlbGVtKTtcclxuXHRcdFx0XHR0aGlzLiRwaHlzaWNzLnN0YXRlID0gZWxlbS5wU3RhdGU7Ly8/P1xyXG5cclxuXHRcdFx0XHRjcnIuZnJvbnQgPSBlbGVtLnBTdGF0ZS5mcm9udDtcclxuXHRcdFx0fVxyXG5cdFx0XHQvL2Vsc2Uge1xyXG5cdFx0XHQvL1x0Ly9ub24gcGh5c2ljcyBzdGF0ZTogY2hhcmEucmVuZGVyZXIuLi5cclxuXHRcdFx0Ly99XHJcblx0XHRcclxuXHRcdFx0aWYgKGVsZW0uYWN0aW9uKSB7XHJcblx0XHRcdFx0Y3JyLmFjdGlvbiA9IGVsZW0uYWN0aW9uO1xyXG5cdFx0XHRcdC8vY3JyLmFjdGlvbl9mcmFtZSA9IGVsZW0uYWN0aW9uX2ZyYW1lO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChlbGVtLmVtb3Rpb24pIHtcclxuXHRcdFx0XHRjcnIuZW1vdGlvbiA9IGVsZW0uZW1vdGlvbjtcclxuXHRcdFx0XHQvL2Nyci5lbW90aW9uX2ZyYW1lID0gZWxlbS5lbW90aW9uX2ZyYW1lO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZXF1aXBJZFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBmcm9tXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHRvXHJcblx0ICovXHJcblx0JG1vdmVJdGVtKGVxdWlwSWQsIGZyb20sIHRvKSB7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBjaGFpcklkXHJcblx0ICovXHJcblx0c2l0Q2hhaXIoY2hhaXJJZCkge1xyXG5cdFx0aWYgKCF0aGlzLmNoYWlyKSB7XHJcblx0XHRcdHRoaXMuY2hhaXIgPSBuZXcgQ2hhaXIoKTtcclxuXHRcdFx0dGhpcy5jaGFpci5pbml0KHRoaXMpO1xyXG5cdFx0XHR0aGlzLmNoYWlyLmxvYWQoY2hhaXJJZCkudGhlbigoKSA9PiB7XHJcblx0XHRcdFx0dGhpcy5jaGFpci5hZGRUb1NjZW5lKHNjZW5lUmVuZGVyZXIpO1xyXG5cdFx0XHRcdHsvLyBDaGFpciN1cGRhdGVcclxuXHRcdFx0XHRcdGNvbnN0IGJvZHlSZWxNb3ZlID0gdGhpcy5jaGFpci5ib2R5UmVsTW92ZTtcclxuXHRcdFx0XHRcdGlmIChib2R5UmVsTW92ZSkge1xyXG5cdFx0XHRcdFx0XHQvL3RoaXMucmVuZGVyZXIudHggPSBib2R5UmVsTW92ZS54O1xyXG5cdFx0XHRcdFx0XHQvL3RoaXMucmVuZGVyZXIudHkgPSBib2R5UmVsTW92ZS55O1xyXG5cdFx0XHRcdFx0XHR0aGlzLnJlbmRlcmVyLnggKz0gYm9keVJlbE1vdmUueDtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJlci55ICs9IGJvZHlSZWxNb3ZlLnk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcclxuXHRcdFx0XHRcdGlmICh0aGlzLmNoYWlyLl9yYXcuaW5mby5zaXRBY3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5hY3Rpb24gPSB0aGlzLmNoYWlyLl9yYXcuaW5mby5zaXRBY3Rpb247XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5hY3Rpb24gPSBcInNpdFwiO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0aWYgKHRoaXMuY2hhaXIuX3Jhdy5pbmZvLnNpdEVtb3Rpb24pIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5lbW90aW9uID0gd2luZG93LmNoYXJhY3Rlcl9lbW90aW9uX2xpc3RbdGhpcy5jaGFpci5fcmF3LmluZm8uc2l0RW1vdGlvbl07XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHRoaXMuZW5hYmxlUGh5c2ljcyA9IGZhbHNlO1xyXG5cdFx0XHRcdHRoaXMuJHBoeXNpY3MuYm9keS5TZXRBd2FrZShmYWxzZSk7XHJcblx0XHRcdFx0dGhpcy4kcGh5c2ljcy5mb290X3dhbGsuU2V0QXdha2UoZmFsc2UpO1xyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRjb25zb2xlLmxvZyhcImFscmVhZHkgc2l0XCIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRub1NpdCgpIHtcclxuXHRcdHRoaXMuZW5hYmxlUGh5c2ljcyA9IHRydWU7XHJcblx0XHR0aGlzLiRwaHlzaWNzLmJvZHkuU2V0QXdha2UodHJ1ZSk7XHJcblx0XHR0aGlzLiRwaHlzaWNzLmZvb3Rfd2Fsay5TZXRBd2FrZSh0cnVlKTtcclxuXHRcdFxyXG5cdFx0ey8vIENoYWlyI3VwZGF0ZVxyXG5cdFx0XHQvL3RoaXMucmVuZGVyZXIudHggPSAwO1xyXG5cdFx0XHQvL3RoaXMucmVuZGVyZXIudHkgPSAwO1xyXG5cdFx0XHRjb25zdCBib2R5UmVsTW92ZSA9IHRoaXMuY2hhaXIuYm9keVJlbE1vdmU7XHJcblx0XHRcdGlmIChib2R5UmVsTW92ZSkge1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyZXIueCAtPSBib2R5UmVsTW92ZS54O1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyZXIueSAtPSBib2R5UmVsTW92ZS55O1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHR0aGlzLnJlbmRlcmVyLmFjdGlvbiA9IFwic3RhbmQxXCI7XHJcblx0XHRcdHRoaXMucmVuZGVyZXIuZW1vdGlvbiA9IFwiYmxpbmtcIjtcclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0dGhpcy5jaGFpciA9IG51bGw7Ly9UT0RPOiByZW1vdmUgY2hhaXJcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2lsbElkXHJcblx0ICogQHBhcmFtIHtmdW5jdGlvbihTY2VuZVNraWxsKTp2b2lkfSBbY2JmdW5jXVxyXG5cdCAqIEByZXR1cm5zIHtTY2VuZVNraWxsfVxyXG5cdCAqL1xyXG5cdGludm9rZVNraWxsKHNraWxsSWQsIGNiZnVuYykge1xyXG5cdFx0aWYgKHdpbmRvdy4kaW8pIHtcclxuXHRcdFx0dGhpcy5fX2ludm9rZVNraWxsX2NsaWVudChza2lsbElkKS50aGVuKGNiZnVuYyk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX19pbnZva2VTa2lsbF9vZmZsaW5lKHNraWxsSWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpbGxJZFxyXG5cdCAqIEByZXR1cm5zIHtTY2VuZVNraWxsfVxyXG5cdCAqL1xyXG5cdGFzeW5jIF9faW52b2tlU2tpbGxfY2xpZW50KHNraWxsSWQpIHtcclxuXHRcdGxldCBpc1ZhbGlkO1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0aXNWYWxpZCA9IGF3YWl0IHdpbmRvdy4kaW8uZW1pdChcInNraWxsXCIsIHtcclxuXHRcdFx0XHRza2lsbElkOiBza2lsbElkXHJcblx0XHRcdH0pO1xyXG5cdFx0fVxyXG5cdFx0Y2F0Y2ggKGV4KSB7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoZXgpO1xyXG5cdFx0fVxyXG5cdFx0aWYgKGlzVmFsaWQpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX19pbnZva2VTa2lsbF9vZmZsaW5lKHNraWxsSWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpbGxJZFxyXG5cdCAqIEByZXR1cm5zIHtTY2VuZVNraWxsfVxyXG5cdCAqL1xyXG5cdF9faW52b2tlU2tpbGxfb2ZmbGluZShza2lsbElkKSB7XHJcblx0XHRsZXQgc2tpbGwgPSBuZXcgU2NlbmVTa2lsbCgpO1xyXG5cdFx0c2tpbGwubG9hZChza2lsbElkLCB0aGlzKTtcclxuXHRcdHRoaXMuYWN0aXZlU2tpbGxzLnNldChza2lsbElkLCBza2lsbCk7XHJcblx0XHRyZXR1cm4gc2tpbGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBhZnRlciBzdGVwLCBiZWZvcmUgcmVuZGVyaW5nXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wKSB7XHJcblx0XHRjb25zdCByZW5kZXJlciA9IHRoaXMucmVuZGVyZXI7XHJcblxyXG5cdFx0dGhpcy5jaGF0Q3RybC51cGRhdGUoc3RhbXApO1xyXG5cclxuXHRcdHRoaXMuX2hhbmRsZVNraWxsKHN0YW1wKTtcclxuXHJcblx0XHR0aGlzLl9wbGF5ZXJfY29udHJvbCgpO1xyXG5cclxuXHRcdGlmICgkZ3YubV9lZGl0b3JfbW9kZSkge1xyXG5cdFx0XHRpZiAocmVuZGVyZXIuc3BlZWQgPiAwICYmIHRoaXMuJHBoeXNpY3MgJiYgdGhpcy5lbmFibGVQaHlzaWNzKSB7XHJcblx0XHRcdFx0dGhpcy5fYXBwbHlTdGF0ZSh7XHJcblx0XHRcdFx0XHRmcm9udDogdGhpcy4kcGh5c2ljcy5zdGF0ZS5mcm9udCxcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy4kcGh5c2ljcykge1xyXG5cdFx0XHR0aGlzLl9hcHBseVN0YXRlKHRoaXMuJHBoeXNpY3Muc3RhdGUpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLiRwaHlzaWNzKSB7XHJcblx0XHRcdGlmIChyZW5kZXJlciAmJiB0aGlzLmVuYWJsZVBoeXNpY3MpIHtcclxuXHRcdFx0XHRjb25zdCBwb3MgPSB0aGlzLiRwaHlzaWNzLmdldFBvc2l0aW9uKCk7XHJcblx0XHRcdFx0Y29uc3QgcHggPSBNYXRoLnRydW5jKHBvcy54ICogJGd2LkNBTlZBU19TQ0FMRSArIDAuNSk7XHJcblx0XHRcdFx0Y29uc3QgcHkgPSBNYXRoLnRydW5jKHBvcy55ICogJGd2LkNBTlZBU19TQ0FMRSArIDAuNSk7XHJcblxyXG5cdFx0XHRcdC8vcG9zaXRpb25cclxuXHRcdFx0XHRyZW5kZXJlci54ID0gcHg7XHJcblx0XHRcdFx0cmVuZGVyZXIueSA9IHB5O1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdC8vcm90YXRlXHJcblx0XHRcdFx0aWYgKHRoaXMuJHBoeXNpY3MuYm9keS5HZXRBbmdsZSgpIHx8IHRoaXMuJHBoeXNpY3MuYm9keS5HZXRBbmd1bGFyVmVsb2NpdHkoKSkge1xyXG5cdFx0XHRcdFx0cmVuZGVyZXIuYW5nbGUgPSB0aGlzLiRwaHlzaWNzLmJvZHkuR2V0QW5nbGUoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRyZW5kZXJlci5hbmdsZSA9IDA7XHJcblx0XHRcdFx0fVxyXG5cclxuXHRcdFx0XHQvL2xheWVyXHJcblx0XHRcdFx0dGhpcy4kbGF5ZXIgPSB0aGlzLiRwaHlzaWNzLmdldExheWVyKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRyZW5kZXJlci51cGRhdGUoc3RhbXApO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0XyRkcmF3TmFtZShyZW5kZXJlcikge1xyXG5cdFx0Y29uc3QgbmFtZSA9IHRoaXMuaWQ7XHJcblx0XHR0aGlzLl9fZHJhd05hbWUocmVuZGVyZXIsIG5hbWUsIHRoaXMubGFiZWxTdHlsZSB8fCAkZ3YuTmFtZUxhYmVsX2RlZmF1bHRfc3R5bGUpO1xyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge0lSZW5kZXJlcn0gcmVuZGVyZXJcclxuXHQgKi9cclxuXHRfJGRyYXdDaGF0QmFsbG9vbihyZW5kZXJlcikge1xyXG5cdFx0dGhpcy5jaGF0Q3RybC5kcmF3KHJlbmRlcmVyLCB0aGlzKTsvL3RoaXMuY2hhdFRleHQgfHwgXCIxMjM0NTEyMzQ1MTIzNDUxMjM0NTEyMzQ1MTIzNDUxMjM0NTEyMzQ1MTIzNDUxMjM0NTEyMzQ1MTIzNDUxMjM0NTEyMzQ1MTIzNDUxMjM0NTEyMzRcIiwgODRcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICovXHJcblx0X3BsYXllcl9jb250cm9sKCkge1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogJ2NoYXJhY3RlciBwaHlzaWNzIHN0YXRlJyB0byAnY2hhcmFjdGVyIHJlbmRlcmVyIHN0YXRlJ1xyXG5cdCAqIEBwYXJhbSB7UFBsYXllclN0YXRlfSBwbGF5ZXJfc3RhdGVcclxuXHQgKi9cclxuXHRfYXBwbHlTdGF0ZShwbGF5ZXJfc3RhdGUpIHtcclxuXHRcdGNvbnN0IHJlbmRlcmVyID0gdGhpcy5yZW5kZXJlcjtcclxuXHRcdGNvbnN0IHBTdGF0ZSA9IHRoaXMuJHBoeXNpY3Muc3RhdGU7XHJcblxyXG5cdFx0Ly8gcmVuZGVyZXI6IGFwcGx5IGRlZmF1bHQgYWN0aW9uXHJcblx0XHRpZiAoIXBTdGF0ZS5pbnZva2VTa2lsbCkge1xyXG5cdFx0XHRjb25zdCB7IGZyb250LCBqdW1wLCB3YWxrLCBwcm9uZSwgZmx5LCBsYWRkZXIgfSA9IHBsYXllcl9zdGF0ZTtcclxuXHRcdFx0Y29uc3QgZW5hYmxlUGh5c2ljcyA9IGNoYXJhLmVuYWJsZVBoeXNpY3M7XHJcblxyXG5cdFx0XHRpZiAoZnJvbnQgIT0gbnVsbCkge1xyXG5cdFx0XHRcdHJlbmRlcmVyLmZyb250ID0gZnJvbnQ7XHJcblx0XHRcdH1cclxuXHJcblx0XHRcdGlmIChsYWRkZXIpIHtcclxuXHRcdFx0XHRpZiAoZW5hYmxlUGh5c2ljcyAmJiB0aGlzLiRwaHlzaWNzLmxhZGRlcikge1xyXG5cdFx0XHRcdFx0aWYgKHRoaXMuJHBoeXNpY3MubGFkZGVyLmlzTGFkZGVyKCkpIHtcclxuXHRcdFx0XHRcdFx0cmVuZGVyZXIuYWN0aW9uID0gXCJsYWRkZXJcIjtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRyZW5kZXJlci5hY3Rpb24gPSBcInJvcGVcIjtcclxuXHRcdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0XHRpZiAocFN0YXRlLmxhZGRlcl9tb3ZlX2Rpcikge1xyXG5cdFx0XHRcdFx0XHRpZiAoY2hhcmEucmVuZGVyZXIuYWN0YW5pLmlzRW5kKCkpIHtcclxuXHRcdFx0XHRcdFx0XHRjaGFyYS5yZW5kZXJlci5hY3RhbmkucmVzZXQoKTtcclxuXHRcdFx0XHRcdFx0XHRyZW5kZXJlci5hY3RhbmkubG9vcCA9IGZhbHNlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0cmVuZGVyZXIuYWN0YW5pLl9pc19lbmQgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChqdW1wKSB7XHJcblx0XHRcdFx0cmVuZGVyZXIuYWN0aW9uID0gXCJqdW1wXCI7XHJcblx0XHRcdFx0cmVuZGVyZXIuYWN0YW5pLmxvb3AgPSBmYWxzZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICh3YWxrKSB7XHJcblx0XHRcdFx0cmVuZGVyZXIuYWN0aW9uID0gXCJ3YWxrMVwiO1xyXG5cdFx0XHRcdHJlbmRlcmVyLmFjdGFuaS5sb29wID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmIChwcm9uZSkge1xyXG5cdFx0XHRcdHJlbmRlcmVyLmFjdGlvbiA9IFwicHJvbmVcIjtcclxuXHRcdFx0XHRyZW5kZXJlci5hY3RhbmkubG9vcCA9IGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2UgaWYgKGZseSkge1xyXG5cdFx0XHRcdHJlbmRlcmVyLmFjdGlvbiA9IFwiZmx5XCI7XHJcblx0XHRcdFx0cmVuZGVyZXIuYWN0YW5pLmxvb3AgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHJlbmRlcmVyLmFjdGlvbiA9IFwic3RhbmQxXCI7XHJcblx0XHRcdFx0cmVuZGVyZXIuYWN0YW5pLmxvb3AgPSB0cnVlO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHQvL1RPRE86IGtleWJvYXJkOiBlbW90aW9uIGtleVxyXG5cdFx0XHRmb3IgKGxldCBpID0gMDsgaSA8PSA5OyArK2kpIHtcclxuXHRcdFx0XHRpZiAoJGd2LmlucHV0X2tleURvd25baV0pIHtcclxuXHRcdFx0XHRcdGxldCBhID0gW1xyXG5cdFx0XHRcdFx0XHRcImJsaW5rXCIsIFwiaGl0XCIsIFwic21pbGVcIixcclxuXHRcdFx0XHRcdFx0XCJ0cm91YmxlZFwiLCBcImNyeVwiLCBcImFuZ3J5XCIsXHJcblx0XHRcdFx0XHRcdFwiYmV3aWxkZXJlZFwiLCBcInN0dW5uZWRcIiwgXCJ2b21pdFwiLFxyXG5cdFx0XHRcdFx0XHRcIm9vcHNcIlxyXG5cdFx0XHRcdFx0XTtcclxuXHRcdFx0XHRcdGxldCBlID0gYVtpICUgYS5sZW5ndGhdO1xyXG5cdFx0XHRcdFx0cmVuZGVyZXIuZW1vdGlvbiA9IGU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIHJvdXRlXHJcblx0ICog57WQ566X5pS75pOK5YK35a6zXHJcblx0ICovXHJcblx0X2hhbmRsZVNraWxsKHN0YW1wKSB7XHJcblx0XHQvKiogQHR5cGUge0F0dGFja0luZm9bXX0gKi9cclxuXHRcdGxldCBhdHRhY2tJbmZvTGlzdCA9IFtdO1xyXG5cdFx0XHJcblx0XHR0aGlzLmFjdGl2ZVNraWxscy5mb3JFYWNoKHNraWxsID0+IHtcclxuXHRcdFx0aWYgKHNraWxsKSB7XHJcblx0XHRcdFx0aWYgKHNraWxsLmlzRW5kKCkpIHtcclxuXHRcdFx0XHRcdHRoaXMuYWN0aXZlU2tpbGxzLmRlbGV0ZShza2lsbC5za2lsbElkKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0XHRza2lsbC51cGRhdGUoc3RhbXAsIHRoaXMpO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHQvL2NsZWFyIGFsbCBhdHRhY2tcclxuXHRcdFx0XHRsZXQgYWxsQXR0YWNrID0gc2tpbGwuYXR0YWNrSW5mby5zaGlmdEFsbEF0dGFjaygpO1xyXG5cdFx0XHRcdGlmIChhbGxBdHRhY2subGVuZ3RoKSB7XHJcblx0XHRcdFx0XHRsZXQgYXR0YWNrSW5mbyA9IG5ldyBBdHRhY2tJbmZvKCk7XHJcblx0XHRcdFx0XHRhdHRhY2tJbmZvLmFsbEF0dGFjayA9IGFsbEF0dGFjaztcclxuXHRcdFx0XHRcdGF0dGFja0luZm9MaXN0LnB1c2goYXR0YWNrSW5mbyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHR9XHJcblx0XHR9KTtcclxuXHRcdFxyXG5cdFx0aWYgKGF0dGFja0luZm9MaXN0Lmxlbmd0aCkge1xyXG5cdFx0XHRpZiAod2luZG93LiRpbykge1xyXG5cdFx0XHRcdHRoaXMuX19oYW5kbGVBdHRhY2tfY2xpZW50KGF0dGFja0luZm9MaXN0KTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHR0aGlzLl9faGFuZGxlQXR0YWNrX29mZmxpbmUoYXR0YWNrSW5mb0xpc3QpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIOe1kOeul+aUu+aTiuWCt+Wus1xyXG5cdCAqIEBwYXJhbSB7QXR0YWNrSW5mb1tdfSBhdHRhY2tJbmZvTGlzdFxyXG5cdCAqL1xyXG5cdGFzeW5jIF9faGFuZGxlQXR0YWNrX2NsaWVudChhdHRhY2tJbmZvTGlzdCkge1xyXG5cdFx0bGV0IGlzVmFsaWQgPSBhd2FpdCB3aW5kb3cuJGlvLmVtaXQoXCJhdHRhY2tcIiwge1xyXG5cdFx0XHQvL1RPRE86IG9ubGluZSBtb2RlOiBwYWNrZXRfYXR0YWNrXHJcblx0XHRcdGF0dGFjazogYXR0YWNrSW5mb0xpc3RcclxuXHRcdH0pO1xyXG5cdFx0XHJcblx0XHRpZiAoaXNWYWxpZCkge1xyXG5cdFx0XHQvL1RPRE86IG9ubGluZSBtb2RlOiBhdHRhY2sgPz9cclxuXHRcdFx0dGhpcy5fX2hhbmRsZUF0dGFja19vZmZsaW5lKGF0dGFja0luZm9MaXN0KTsvL3Nob3cgYXR0YWNrXHJcblx0XHR9XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIOe1kOeul+aUu+aTiuWCt+Wus1xyXG5cdCAqIEBwYXJhbSB7QXR0YWNrSW5mb1tdfSBhdHRhY2tJbmZvTGlzdFxyXG5cdCAqL1xyXG5cdF9faGFuZGxlQXR0YWNrX29mZmxpbmUoYXR0YWNrSW5mb0xpc3QpIHtcclxuXHRcdGZvciAobGV0IGF0dGFja0luZm8gb2YgYXR0YWNrSW5mb0xpc3QpIHtcclxuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhdHRhY2tJbmZvLmFsbEF0dGFjay5sZW5ndGg7ICsraSkge1xyXG5cdFx0XHRcdGNvbnN0IGF0dGFjayA9IGF0dGFja0luZm8uYWxsQXR0YWNrW2ldO1xyXG5cclxuXHRcdFx0XHRjb25zdCB0YXJnZXRPYmplY3QgPSBhdHRhY2suZ2V0VGFyZ2V0T2JqZWN0KCk7XHJcblxyXG5cdFx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgYXR0YWNrLmFsbERhbWFnZS5sZW5ndGg7ICsraikge1xyXG5cdFx0XHRcdFx0bGV0IGRhbVZhciA9IHRoaXMuc3RhdC5nZXRDdXJyZW50TWF4QmFzZURhbWFnZSgpIC0gdGhpcy5zdGF0LmdldEN1cnJlbnRNaW5CYXNlRGFtYWdlKCk7XHJcblx0XHRcdFx0XHRsZXQgcmVhbERhbWFnZSA9IHRoaXMuc3RhdC5nZXRDdXJyZW50TWluQmFzZURhbWFnZSgpICsgTWF0aC5yYW5kb20oKSAqIGRhbVZhcjtcclxuXHRcdFx0XHRcdGxldCBkYW1hZ2UgPSBhdHRhY2suYWxsRGFtYWdlW2pdID0gbmV3IERhbWFnZVBhaXIoKTtcclxuXHRcdFx0XHRcdGxldCBzdHlsZTtcclxuXHJcblx0XHRcdFx0XHRpZiAoTWF0aC50cnVuYyhNYXRoLnJhbmRvbSgpICogMTAwKSA8IHRoaXMuc3RhdC5jcml0UmF0ZSkge1xyXG5cdFx0XHRcdFx0XHRyZWFsRGFtYWdlID0gcmVhbERhbWFnZSAqICgxICsgdGhpcy5zdGF0LmNyaXREYW1hZ2UgLyAxMDApO1xyXG5cdFx0XHRcdFx0XHRkYW1hZ2UuY3JpdGljYWwgPSB0cnVlO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHJcblx0XHRcdFx0XHRyZWFsRGFtYWdlID0gTWF0aC50cnVuYyhyZWFsRGFtYWdlKTtcclxuXHRcdFx0XHRcdGRhbWFnZS5yZWFsRGFtYWdlID0gcmVhbERhbWFnZTtcclxuXHJcblx0XHRcdFx0XHR0YXJnZXRPYmplY3QuZGFtYWdlKHRoaXMsIHJlYWxEYW1hZ2UpO1xyXG5cclxuXHRcdFx0XHRcdGlmIChkYW1hZ2UuY3JpdGljYWwpIHtcclxuXHRcdFx0XHRcdFx0c3R5bGUgPSBcIk5vQ3JpXCI7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0c3R5bGUgPSBcIk5vUmVkXCI7XHJcblx0XHRcdFx0XHR9XHJcblxyXG5cdFx0XHRcdFx0Ly9UT0RPOiA/PyB0YXJnZXQgcG9zaXRpb25cclxuXHRcdFx0XHRcdGRhbWFnZU51bWJlckxheWVyLmFkZERhbWFnZVBhaXIodGhpcy5kYW1hZ2VTa2luIHx8IFwiZGVmYXVsdFwiLCBzdHlsZSwgZGFtYWdlLCB0YXJnZXRPYmplY3QueCArIChhdHRhY2suYWxsRGFtYWdlLmxlbmd0aCA+IDEgPyAoMjUgLSAoMSAtIGogJiAxKSAqIDI1KSA6IDApLCB0YXJnZXRPYmplY3QueSwgaiAqIDEwMCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdC8vXHJcblx0XHRcdFx0dGFyZ2V0T2JqZWN0Lmtub2NrYmFjayh0aGlzLCAxNiwgMTYpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogY2xpZW50IHBsYXllclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIFNjZW5lQ2hhcmFjdGVyIGV4dGVuZHMgQmFzZVNjZW5lQ2hhcmFjdGVyIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge1NjZW5lTWFwfSBzY2VuZVxyXG5cdCAqL1xyXG5cdGNvbnN0cnVjdG9yKHNjZW5lKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Q2hhcmFjdGVyUmVuZGVyZXJ9ICovXHJcblx0XHR0aGlzLnJlbmRlcmVyID0gbmV3IENoYXJhY3RlclJlbmRlcmVyKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtQUGxheWVyfSAqL1xyXG5cdFx0dGhpcy4kcGh5c2ljcyA9IHNjZW5lLmNvbnRyb2xsZXIuJGNyZWF0ZVBsYXllcih0aGlzLCB0aGlzLnJlbmRlcmVyKTsvL25ldyBQUGxheWVyKCk7XHJcblxyXG5cdFx0dGhpcy4kbGF5ZXIgPSA1O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy5pZCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtJdGVtU2xvdFtdW119IC0gaXRlbSBpbnZlbnRvcnkgKi9cclxuXHRcdHRoaXMuaXRlbXMgPSBuZXcgQXJyYXkoNSk7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IDU7ICsraSkge1xyXG5cdFx0XHR0aGlzLml0ZW1zW2ldID0gbmV3IEFycmF5KDEyOCk7XHJcblx0XHRcdGZvciAobGV0IGogPSAwOyBqIDwgMTI4OyArK2opIHtcclxuXHRcdFx0XHR0aGlzLml0ZW1zW2ldW2pdID0gbmV3IEl0ZW1TbG90KGosIG51bGwsIG51bGwsIDApO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0Ly90aGlzLmFkZEl0ZW0oXCIwMTAwNTE3N1wiLCAxKTtcclxuXHRcdC8vdGhpcy5hZGRJdGVtKFwiMDEwNTMzMjJcIiwgMSk7XHJcblx0XHQvL3RoaXMuYWRkSXRlbShcIjAxMDczMjg0XCIsIDEpO1xyXG5cclxuXHRcdHRoaXMuc3RhdC5vbkpvYkNoYW5nZSh0aGlzLl9vbkpvYkNoYW5nZS5iaW5kKHRoaXMpKTtcclxuXHR9XHJcblxyXG5cdF9vbkpvYkNoYW5nZSgpIHtcclxuXHRcdC8vVE9ETzogcmVnaXN0ZXIgYnVmLCBkZWJ1ZiwgYXV0b2ZpcmUgc2tpbGxcclxuXHRcdC8vVE9ETzog5LqM5q616Lez5Y+W5Luj6Lez6LqN6Y21XHJcblx0XHRjb25zdCBuZXdKb2IgPSB0aGlzLnN0YXQuam9iO1xyXG5cclxuXHRcdGNvbnNvbGUubG9nKFwiUGxheWVyKFwiICsgdGhpcy4kb2JqZWN0aWQgKyBcIikgY2hhbmdlIGpvYjogXCIgKyBuZXdKb2IpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogJ2NoYXJhY3RlciBwaHlzaWNzIHN0YXRlJyB0byAnY2hhcmFjdGVyIHJlbmRlcmVyIHN0YXRlJ1xyXG5cdCAqIEBwYXJhbSB7UFBsYXllclN0YXRlfSBwbGF5ZXJfc3RhdGVcclxuXHQgKi9cclxuXHRfYXBwbHlTdGF0ZShwbGF5ZXJfc3RhdGUpIHtcclxuXHRcdHN1cGVyLl9hcHBseVN0YXRlKHBsYXllcl9zdGF0ZSk7XHJcblxyXG5cdFx0dGhpcy4kcmVjTW92ZSgpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICovXHJcblx0X3BsYXllcl9jb250cm9sKCkge1xyXG5cdFx0aWYgKCF0aGlzLiRwaHlzaWNzKSB7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdC8vaWYgKCF0aGlzLiRwaHlzaWNzLnN0YXRlLmp1bXAgJiYgdGhpcy4kJGp1bXBfc3RhdGUpIHtcclxuXHRcdC8vXHRkZWxldGUgdGhpcy4kJGp1bXBfc3RhdGU7XHJcblx0XHQvL31cclxuXHRcdGNvbnN0IGtleV9tYXAgPSBrZXlib2FyZF9tYXBbJGd2Lm1fZWRpdG9yX21vZGUgPyAxIDogMF07XHJcblxyXG5cdFx0LyoqIEB0eXBlIHt7W2tleTpzdHJpbmddOm51bWJlcn19ICovXHJcblx0XHRsZXQgaWtleSA9IHt9O1xyXG5cclxuXHRcdGxldCBjYW5fdXNlX3NraWxsID0gdGhpcy5hY3RpdmVTa2lsbHMuc2l6ZSA9PSAwOy8vVE9ETzog5Lul5p+l6KGo5rOV5qqi5p+l5LiN5ZCM5oqA6IO95piv5ZCm5Y+v5Lul5ZCM5pmC5L2/55SoXHJcblxyXG5cdFx0Zm9yIChsZXQga2V5TmFtZSBpbiBrZXlfbWFwKSB7XHJcblx0XHRcdC8qKiBAdHlwZSB7S2V5U2xvdH0gKi9cclxuXHRcdFx0Y29uc3Qga2V5U2xvdCA9IGtleV9tYXBba2V5TmFtZV07XHJcblx0XHRcdGlmICgha2V5U2xvdCkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGNvbnN0IGtleURvd24gPSAkZ3YuaW5wdXRfa2V5RG93bltrZXlOYW1lXTtcclxuXHRcdFx0Y29uc3Qga2V5VXAgPSAkZ3YuaW5wdXRfa2V5VXBba2V5TmFtZV07XHJcblxyXG5cdFx0XHRzd2l0Y2ggKGtleVNsb3QudHlwZSkge1xyXG5cdFx0XHRcdGNhc2UgXCJDb21tYW5kXCI6Ly9vcGVuIG9yIGNsb3NlIFVJLCAuLi5cclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgXCJBY3Rpb25cIjpcclxuXHRcdFx0XHRcdGlmIChrZXlEb3duKSB7XHJcblx0XHRcdFx0XHRcdC8qKiBAdHlwZSB7QWN0aW9uU2xvdH0gKi9cclxuXHRcdFx0XHRcdFx0Y29uc3QgY2sgPSBrZXlTbG90LmRhdGE7XHJcblx0XHRcdFx0XHRcdGlmICh0aGlzLmNoYWlyKSB7XHJcblx0XHRcdFx0XHRcdFx0aWYgKGNrLmFjdGlvbiA9PSBcImxlZnRcIiB8fFxyXG5cdFx0XHRcdFx0XHRcdFx0Y2suYWN0aW9uID09IFwicmlnaHRcIiB8fFxyXG5cdFx0XHRcdFx0XHRcdFx0Y2suYWN0aW9uID09IFwianVtcFwiXHJcblx0XHRcdFx0XHRcdFx0KSB7XHJcblx0XHRcdFx0XHRcdFx0XHR0aGlzLm5vU2l0KCk7XHJcblx0XHRcdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0XHRcdGlrZXlbY2suYWN0aW9uXSA9IGtleURvd247XHJcblx0XHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRcdGNhc2UgXCJJdGVtXCI6XHJcblx0XHRcdFx0XHRpZiAoa2V5RG93bikge1xyXG5cdFx0XHRcdFx0XHQvKiogQHR5cGUge0l0ZW1TbG90fSAqL1xyXG5cdFx0XHRcdFx0XHRjb25zdCBpdGVtU2xvdCA9IGtleVNsb3QuZGF0YTtcclxuXHRcdFx0XHRcdFx0dGhpcy51c2VJdGVtKGl0ZW1TbG90LmRhdGEuaWQpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdFx0YnJlYWs7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGlmICghdGhpcy5jaGFpcikge1xyXG5cdFx0XHQvL1RPRE86IHN0YW1wXHJcblx0XHRcdGNvbnN0IHN0YW1wID0gMDtcclxuXHRcdFx0aWYgKHRoaXMuam9iQ29udHJvbGxlci51cGRhdGUodGhpcywgc3RhbXAsIGlrZXkpKSB7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0Zm9yIChsZXQga2V5TmFtZSBpbiBrZXlfbWFwKSB7XHJcblx0XHRcdFx0XHQvKiogQHR5cGUge0tleVNsb3R9ICovXHJcblx0XHRcdFx0XHRjb25zdCBrZXlTbG90ID0ga2V5X21hcFtrZXlOYW1lXTtcclxuXHRcdFx0XHRcdGlmICgha2V5U2xvdCkge1xyXG5cdFx0XHRcdFx0XHRkZWJ1Z2dlcjtcclxuXHRcdFx0XHRcdFx0Y29udGludWU7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRjb25zdCBrZXlEb3duID0gJGd2LmlucHV0X2tleURvd25ba2V5TmFtZV07XHJcblx0XHRcdFx0XHRjb25zdCBrZXlVcCA9ICRndi5pbnB1dF9rZXlVcFtrZXlOYW1lXTtcclxuXHJcblx0XHRcdFx0XHRpZiAoa2V5U2xvdC50eXBlID09IFwiU2tpbGxcIikge1xyXG5cdFx0XHRcdFx0XHQvKiogQHR5cGUge1NraWxsU2xvdH0gKi9cclxuXHRcdFx0XHRcdFx0Y29uc3Qga3MgPSBrZXlTbG90LmRhdGE7XHJcblx0XHRcdFx0XHRcdGNvbnN0IHNraWxsX2lkID0ga3Muc2tpbGxfaWQ7XHJcblx0XHRcdFx0XHRcdGxldCBza2lsbCA9IHRoaXMuYWN0aXZlU2tpbGxzLmdldChza2lsbF9pZCk7XHJcblx0XHRcdFx0XHRcdGlmIChrZXlEb3duICYmIGNhbl91c2Vfc2tpbGwpIHtcclxuXHRcdFx0XHRcdFx0XHRza2lsbCA9IHNraWxsIHx8IHRoaXMuaW52b2tlU2tpbGwoc2tpbGxfaWQpO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRcdGlmIChza2lsbCkge1xyXG5cdFx0XHRcdFx0XHRcdHNraWxsLmNvbnRyb2woaWtleSwga2V5RG93biwga2V5VXApO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy4kcGh5c2ljcy5jb250cm9sKGlrZXkpOy8vYXBwbHkgYWN0aW9uIGNvbnRyb2xcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIHJvdXRlIGFkZEl0ZW1cclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudFxyXG5cdCAqL1xyXG5cdGFkZEl0ZW0oaXRlbUlkLCBhbW91bnQpIHtcclxuXHRcdGlmICh3aW5kb3cuJGlvKSB7XHJcblx0XHRcdC8vVE9ETzogb25saW5lIG1vZGU6IGFkZEl0ZW1cclxuXHRcdFx0Y29uc29sZS53YXJuKFwi5pyq5a6M5oiQOiBfX2FkZEl0ZW1fY2xpZW50XCIpO1xyXG5cdFx0XHQvL3RoaXMuX19hZGRJdGVtX2NsaWVudChpdGVtSWQsIGFtb3VudCk7XHJcblx0XHR9XHJcblx0XHQvL2Vsc2Uge1xyXG5cdFx0XHR0aGlzLl9fYWRkSXRlbV9vZmZsaW5lKGl0ZW1JZCwgYW1vdW50KTtcclxuXHRcdC8vfVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaXRlbUlkXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGFtb3VudFxyXG5cdCAqL1xyXG5cdGFzeW5jIF9fYWRkSXRlbV9jbGllbnQoaXRlbUlkLCBhbW91bnQpIHtcclxuXHRcdC8vVE9ETzogb25saW5lIG1vZGU6IGFkZEl0ZW1cclxuXHRcdGNvbnNvbGUud2FybihcIuacquWujOaIkDogX19hZGRJdGVtX2NsaWVudFwiKTtcclxuXHRcdFxyXG5cdFx0bGV0IHJlc3VsdCA9IGF3YWl0IHdpbmRvdy4kaW8uZW1pdChcImFkZEl0ZW1cIiwge1xyXG5cdFx0XHR0eXBlOiB0eXBlLFxyXG5cdFx0XHRzbG90OiBzbG90LFxyXG5cdFx0fSk7XHJcblx0fVxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBpdGVtSWRcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gYW1vdW50XHJcblx0ICovXHJcblx0X19hZGRJdGVtX29mZmxpbmUoaXRlbUlkLCBhbW91bnQpIHtcclxuXHRcdC8qKiBAdHlwZSB7UGFydGlhbDxJdGVtRXF1aXA+fSAqL1xyXG5cdFx0bGV0IHByb3BzID0gey8vdGVzdCBhdHRyXHJcblx0XHRcdGluY0RFWHI6IE1hdGgudHJ1bmMoTWF0aC5yYW5kb20oKSAqIDMpLFxyXG5cdFx0XHR0aW1lTGltaXRlZDogRGF0ZSgpLFxyXG5cdFx0fTtcclxuXHJcblx0XHQkY3JlYXRlSXRlbShpdGVtSWQsIHByb3BzKS50aGVuKGl0ZW0gPT4ge1xyXG5cdFx0XHR0aGlzLl9hZGRJdGVtKGl0ZW0sIGFtb3VudCk7XHJcblx0XHR9LCBmdW5jdGlvbiAoZXJyKSB7XHJcblx0XHRcdGNvbnNvbGUud2FybihlcnIpO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAdGVtcGxhdGUgVFxyXG5cdCAqIEBwYXJhbSB7VCBleHRlbmRzIEl0ZW1CYXNlID8gVCA6IG5ldmVyfSBpdGVtRGF0YVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBhbW91bnRcclxuXHQgKi9cclxuXHRfYWRkSXRlbShpdGVtRGF0YSwgYW1vdW50KSB7XHJcblx0XHRsZXQgU04gPSAxMjM7XHJcblx0XHRsZXQgaXRlbUlkID0gaXRlbURhdGEuaWQ7XHJcblx0XHRsZXQgc2xvdFR5cGUgPSBpdGVtRGF0YS5nZXRTbG90KCk7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXNbc2xvdFR5cGVdLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGlmICh0aGlzLml0ZW1zW3Nsb3RUeXBlXVtpXS5pc0VtcHR5KCkpIHtcclxuXHRcdFx0XHRpZiAod2luZG93LiRhZGRJdGVtX3JlcGVhdEVxdWlwKSB7XHJcblx0XHRcdFx0XHR0aGlzLml0ZW1zW3Nsb3RUeXBlXVtpXS5hc3NpZ24oaSwgU04sIGl0ZW1EYXRhLCBzbG90VHlwZSA/IGFtb3VudCA6IDEpO1xyXG5cdFx0XHRcdFx0Y29uc29sZS5pbmZvKGBnaXZlICR7dGhpcy5pZH06ICR7aXRlbUlkfSAqICR7YW1vdW50fWApO1xyXG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0aWYgKHNsb3RUeXBlID09IDApIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5pdGVtc1tzbG90VHlwZV1baV0uYXNzaWduKGksIFNOLCBpdGVtRGF0YSwgMSk7XHJcblx0XHRcdFx0XHRcdGFtb3VudC0tO1xyXG5cdFx0XHRcdFx0XHRpZiAoYW1vdW50ID09IDApIHtcclxuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmluZm8oYHJlcGVhdCBnaXZlICR7dGhpcy5pZH06ICR7aXRlbUlkfWApO1xyXG5cdFx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRcdFx0dGhpcy5pdGVtc1tzbG90VHlwZV1baV0uYXNzaWduKGksIFNOLCBpdGVtRGF0YSwgYW1vdW50KTtcclxuXHRcdFx0XHRcdFx0Y29uc29sZS5pbmZvKGBnaXZlICR7dGhpcy5pZH06ICR7aXRlbUlkfSAqICR7YW1vdW50fWApO1xyXG5cdFx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdHJldHVybiBmYWxzZTsvL2l0ZW0gaW52ZW50b3J5IHdhcyBmdWxsXHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB0eXBlIC0gaXRlbSB0eXBlXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHNsb3RcclxuXHQgKi9cclxuXHRyZW1vdmVJdGVtKHR5cGUsIHNsb3QpIHtcclxuXHRcdGlmICh3aW5kb3cuJGlvKSB7XHJcblx0XHRcdC8vVE9ETzogb25saW5lIG1vZGU6IHJlbW92ZUl0ZW1cclxuXHRcdFx0Y29uc29sZS53YXJuKFwi5pyq5a6M5oiQOiByZW1vdmVJdGVtXCIpO1xyXG5cdFx0fVxyXG5cdFx0Ly9pZiAod2luZG93LiRpbykgey8vVE9ETzogb25saW5lIG1vZGU6IHJlbW92ZUl0ZW1cclxuXHRcdC8vXHRjb25zb2xlLndhcm4oXCLmnKrlrozmiJA6IHJlbW92ZUl0ZW1cIik7XHJcblx0XHQvL1x0XHJcblx0XHQvL1x0d2luZG93LiRpby5lbWl0KFwicmVtb3ZlSXRlbVwiLCB7XHJcblx0XHQvL1x0XHR0eXBlOiB0eXBlLFxyXG5cdFx0Ly9cdFx0c2xvdDogc2xvdCxcclxuXHRcdC8vXHR9KS50aGVuKHJlc3VsdHMgPT4ge1xyXG5cdFx0Ly9cdFx0aWYgKHJlc3VsdCkge1xyXG5cdFx0Ly9cdFx0XHR0aGlzLl9yZW1vdmVJdGVtKHR5cGUsIHNsb3QpO1xyXG5cdFx0Ly9cdFx0fVxyXG5cdFx0Ly9cdFx0cmV0dXJuIHJlc3VsdDtcclxuXHRcdC8vXHR9LCBlcnIgPT4ge1xyXG5cdFx0Ly9cdFx0Y29uc29sZS5lcnJvcihlcnIpO1xyXG5cdFx0Ly9cdH0pO1xyXG5cdFx0Ly99XHJcblx0XHQvL2Vsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5fcmVtb3ZlSXRlbSh0eXBlLCBzbG90KTtcclxuXHRcdC8vfVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHR5cGUgLSBpdGVtIHR5cGVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc2xvdFxyXG5cdCAqL1xyXG5cdF9yZW1vdmVJdGVtKHR5cGUsIHNsb3QpIHtcclxuXHRcdHRoaXMuaXRlbXNbdHlwZV1bc2xvdF0uX2NsZWFyKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gZnJvbVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSB0b1xyXG5cdCAqL1xyXG5cdG1vdmVJdGVtVG9TbG90KGZyb20sIHRvKSB7XHJcblx0XHQvL1RPRE86IChcIi4vdWkvQmFzaWMvVUlTbG90SXRlbS52dWVcIikubWV0aG9kcy5kcm9wXHJcblx0XHRkZWJ1Z2dlcjtcclxuXHR9XHJcblxyXG5cdC8vLyoqXHJcblx0Ly8gKiBAcGFyYW0ge2FueX0gaWRcclxuXHQvLyAqL1xyXG5cdC8vJGdldEl0ZW0oaWQpIHtcclxuXHQvL1x0dGhpcy5pdGVtU2xvdFxyXG5cdC8vfVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaXRlbUlkXHJcblx0ICovXHJcblx0ZmluZEl0ZW0oaXRlbUlkKSB7XHJcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaXRlbXMubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0Zm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLml0ZW1zW2ldLmxlbmd0aDsgKytqKSB7XHJcblx0XHRcdFx0bGV0IGl0ZW1TbG90ID0gdGhpcy5pdGVtc1tpXVtqXTtcclxuXHJcblx0XHRcdFx0aWYgKGl0ZW1TbG90ICYmIGl0ZW1TbG90LmRhdGEgJiYgKGl0ZW1TbG90LmRhdGEuaWQgPT0gaXRlbUlkKSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIHtcclxuXHRcdFx0XHRcdFx0dHlwZU5hbWU6IEl0ZW1DYXRlZ29yeUluZm8udHlwZU5hbWVbaV0sXHJcblx0XHRcdFx0XHRcdGl0ZW1TbG90OiBpdGVtU2xvdCxcclxuXHRcdFx0XHRcdH07XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRyZXR1cm4ge1xyXG5cdFx0XHR0eXBlTmFtZTogbnVsbCxcclxuXHRcdFx0aXRlbVNsb3Q6IG51bGwsXHJcblx0XHR9O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogcm91dGVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaXRlbUlkXHJcblx0ICovXHJcblx0dXNlSXRlbShpdGVtSWQsIGNhdGVnb3J5LCBpdGVtSW5mbykge1xyXG5cdFx0aWYgKHdpbmRvdy4kaW8pIHtcclxuXHRcdFx0dGhpcy5fX3VzZUl0ZW1fY2xpZW50KGl0ZW1JZCk7XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5fX3VzZUl0ZW1fb2ZmbGluZShpdGVtSWQpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gaXRlbUlkXHJcblx0ICogQHJldHVybnMge1Byb21pc2U8e30+fVxyXG5cdCAqL1xyXG5cdF9fdXNlSXRlbV9jbGllbnQoaXRlbUlkKSB7XHJcblx0XHRyZXR1cm4gd2luZG93LiRpby5lbWl0KFwidXNlSXRlbVwiLCB7XHJcblx0XHRcdGl0ZW1JZDogaXRlbUlkXHJcblx0XHR9KS50aGVuKHJlc3VsdHMgPT4ge1xyXG5cdFx0XHRpZiAocmVzdWx0cykge1xyXG5cdFx0XHRcdHRoaXMuX191c2VJdGVtX29mZmxpbmUoaXRlbUlkKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gcmVzdWx0cztcclxuXHRcdH0sIGVyciA9PiB7XHJcblx0XHRcdGNvbnNvbGUubG9nKCk7XHJcblx0XHRcdGNvbnNvbGUuZXJyb3IoXCJjYW4ndCB1c2UgaXRlbTogJW9cXG5lcnJvcjogJW9cIiwgaWQsIGVycik7XHJcblx0XHR9KTtcclxuXHR9XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGl0ZW1JZFxyXG5cdCAqL1xyXG5cdF9fdXNlSXRlbV9vZmZsaW5lKGl0ZW1JZCkge1xyXG5cdFx0Y29uc3QgYXJncyA9IGFyZ3VtZW50cztcclxuXHRcdGxldCBleGlzdEl0ZW0gPSB0aGlzLmZpbmRJdGVtKGl0ZW1JZCkuaXRlbVNsb3Q7XHJcblxyXG5cdFx0aWYgKGV4aXN0SXRlbSkge1xyXG5cdFx0XHRpZiAoISRndi5tX2VkaXRvcl9tb2RlKSB7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coYOa2iOiAl+mBk+WFt++8miR7aXRlbUlkfeOAguacquWujOaIkGApO1xyXG5cdFx0XHRcdHRoaXMuX2NvbnN1bWUoaXRlbUlkLCAxKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRjb25zb2xlLmxvZyhg5L2/55So6YGT5YW377yaJHtpdGVtSWR944CCYCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYgKEl0ZW1DYXRlZ29yeUluZm8uaXNDaGFpcihpdGVtSWQpKSB7XHJcblx0XHRcdFx0dGhpcy5zaXRDaGFpcihpdGVtSWQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHVwZGF0ZV9yZW5kZXJlci5jYWxsKHRoaXMpO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0aWYgKCRndi5tX2VkaXRvcl9tb2RlKSB7XHJcblx0XHRcdFx0dGhpcy5hZGRJdGVtKGl0ZW1JZCwgMSk7XHJcblx0XHRcdFx0aWYgKEl0ZW1DYXRlZ29yeUluZm8uaXNDaGFpcihpdGVtSWQpKSB7XHJcblx0XHRcdFx0XHR0aGlzLnNpdENoYWlyKGl0ZW1JZCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdFx0dXBkYXRlX3JlbmRlcmVyLmNhbGwodGhpcyk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdGNvbnNvbGUubG9nKFwi54Sh5rOV5L2/55So5LiN5a2Y5Zyo55qE6YGT5YW344CCeW91IGNhbiB0cnkgYWRkIGl0ZW0gZWRpdG9yIG1vZGVcIik7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRmdW5jdGlvbiB1cGRhdGVfcmVuZGVyZXIoKSB7XHJcblx0XHRcdC8vVE9ETzogaW1wbGVtZW50IGpvYlxyXG5cdFx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG5cdFx0XHRcdGNvbnN0IGNhdGVnb3J5ID0gYXJnc1sxXSwgZXF1aXBJbmZvID0gYXJnc1syXTtcclxuXHRcdFx0XHR0aGlzLnJlbmRlcmVyLnVzZShpdGVtSWQsIGNhdGVnb3J5LCBlcXVpcEluZm8pO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVsc2Uge1xyXG5cdFx0XHRcdHRoaXMucmVuZGVyZXIudXNlKGl0ZW1JZCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB0ZXh0XHJcblx0ICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59XHJcblx0ICovXHJcblx0YXN5bmMgc2F5KHRleHQpIHtcclxuXHRcdGlmICh3aW5kb3cuJGlvKSB7XHJcblx0XHRcdGxldCByZXN1bHQgPSBhd2FpdCB3aW5kb3cuJGlvLmVtaXQoXCJjaGF0XCIsIHtcclxuXHRcdFx0XHQkc3R5bGU6IHRoaXMuY2hhdEN0cmwuc3R5bGUsXHJcblx0XHRcdFx0dGV4dDogdGV4dCxcclxuXHRcdFx0fSk7XHJcblx0XHRcdGlmIChyZXN1bHQpIHtcclxuXHRcdFx0XHR0aGlzLmNoYXRDdHJsLmVudGVyKHRleHQpO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiByZXN1bHQ7Ly9ib29sZWFuXHJcblx0XHR9XHJcblx0XHRlbHNlIHtcclxuXHRcdFx0dGhpcy5jaGF0Q3RybC5lbnRlcih0ZXh0KTtcclxuXHRcdFx0cmV0dXJuIHRydWU7XHJcblx0XHR9XHJcblx0fVxyXG5cdFxyXG5cdCRlbWl0KHNvY2tldCkge1xyXG5cdFx0aWYgKHRoaXMuJG91dFBhY2tldC5tb3ZlKSB7XHJcblx0XHRcdHNvY2tldC5lbWl0KFwiY2hhcmFNb3ZlXCIsIHRoaXMuJG91dFBhY2tldC5tb3ZlKTtcclxuXHRcdFx0dGhpcy4kb3V0UGFja2V0Lm1vdmUgPSBudWxsO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGxldCBjaGFyYU1vdmUgPSBuZXcgJFBhY2tldF9DaGFyYWN0ZXJNb3ZlKCk7XHJcblxyXG5cdFx0XHRjaGFyYU1vdmUuY2FwdHVyZSh0aGlzKTtcclxuXHJcblx0XHRcdHNvY2tldC5lbWl0KFwiY2hhcmFNb3ZlXCIsIGNoYXJhTW92ZSk7XHJcblx0XHR9XHJcblxyXG5cdFx0dGhpcy4kb3V0UGFja2V0Lm1vdmUgPSBudWxsO1xyXG5cdH1cclxuXHRcclxuXHQkcmVjTW92ZSgpIHtcclxuXHRcdGxldCBtb3ZlID0gdGhpcy4kb3V0UGFja2V0Lm1vdmUgfHwgbmV3ICRQYWNrZXRfQ2hhcmFjdGVyTW92ZSgpO1xyXG5cdFx0bW92ZS5jYXB0dXJlKHRoaXMpO1xyXG5cdFx0dGhpcy4kb3V0UGFja2V0Lm1vdmUgPSBtb3ZlO1xyXG5cdH1cclxufVxyXG5cclxuLyoqXHJcbiAqIHJlbW90ZSBwbGF5ZXJcclxuICovXHJcbmV4cG9ydCBjbGFzcyBTY2VuZVJlbW90ZUNoYXJhY3RlciBleHRlbmRzIEJhc2VTY2VuZUNoYXJhY3RlciB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtTY2VuZU1hcH0gc2NlbmVcclxuXHQgKi9cclxuXHRjb25zdHJ1Y3RvcihzY2VuZSkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHJcblx0XHRpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xyXG5cdFx0XHRkZWxldGUgdGhpcy4kcGh5c2ljcztcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiJHBoeXNpY3NcIiwge1xyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXHJcblx0XHRcdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy4kJHBoeXNpY3M7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0XHRzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG5cdFx0XHRcdFx0aWYgKHZhbHVlID09IG51bGwpIHtcclxuXHRcdFx0XHRcdFx0Y29uc29sZS5lcnJvcihcImNhbiBub3Qgc2V0IFNjZW5lUmVtb3RlQ2hhcmFjdGVyLiRwaHlzaWNzID0gbnVsbDtcIik7XHJcblx0XHRcdFx0XHRcdGFsZXJ0KFwiY2FuIG5vdCBzZXQgU2NlbmVSZW1vdGVDaGFyYWN0ZXIuJHBoeXNpY3MgPSBudWxsO1wiKTtcclxuXHRcdFx0XHRcdH1cclxuXHRcdFx0XHRcdHRoaXMuJCRwaHlzaWNzID0gdmFsdWU7XHJcblx0XHRcdFx0fSxcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0XHRkZWxldGUgdGhpcy5yZW5kZXJlcjtcclxuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmVuZGVyZXJcIiwge1xyXG5cdFx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXHJcblx0XHRcdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XHJcblx0XHRcdFx0XHRyZXR1cm4gdGhpcy4kJHJlbmRlcmVyO1xyXG5cdFx0XHRcdH0sXHJcblx0XHRcdFx0c2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuXHRcdFx0XHRcdGlmICh2YWx1ZSA9PSBudWxsKSB7XHJcblx0XHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXCJjYW4gbm90IHNldCBTY2VuZVJlbW90ZUNoYXJhY3Rlci5yZW5kZXJlciA9IG51bGw7XCIpO1xyXG5cdFx0XHRcdFx0XHRhbGVydChcImNhbiBub3Qgc2V0IFNjZW5lUmVtb3RlQ2hhcmFjdGVyLnJlbmRlcmVyID0gbnVsbDtcIik7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0XHR0aGlzLiQkcmVuZGVyZXIgPSB2YWx1ZTtcclxuXHRcdFx0XHR9LFxyXG5cdFx0XHR9KTtcclxuXHRcdH1cclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlclJlbmRlcmVyfSAqL1xyXG5cdFx0dGhpcy5yZW5kZXJlciA9IG5ldyBDaGFyYWN0ZXJSZW5kZXJlcigpO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7UFBsYXllcn0gKi9cclxuXHRcdHRoaXMuJHBoeXNpY3MgPSBzY2VuZS5jb250cm9sbGVyLiRjcmVhdGVSZW1vdGVQbGF5ZXIodGhpcywgdGhpcy5yZW5kZXJlcik7XHJcblx0fVxyXG5cclxuXHRnZXQgJHJlbW90ZSgpIHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICovXHJcblx0X3BsYXllcl9jb250cm9sKCkge1xyXG5cdFx0dGhpcy5fcmVtb3RlX2NvbnRyb2woKTtcclxuXHR9XHJcbn1cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/game/SceneCharacter.js\n");

/***/ }),

/***/ "./src/game/SceneObject.js":
/*!*********************************!*\
  !*** ./src/game/SceneObject.js ***!
  \*********************************/
/*! exports provided: SceneObject */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SceneObject\", function() { return SceneObject; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Physics_PPlayer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Physics/PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _Renderer_NameLabel_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Renderer/NameLabel.js */ \"./src/game/Renderer/NameLabel.js\");\n﻿\r\n\r\n\r\n\r\n\r\n/**\r\n * Game object\r\n */\r\nclass SceneObject {\r\n\tconstructor() {\r\n\t\t/** @type {string|number} */\r\n\t\tthis.$objectid = null;\t// playerName or objectID; ?? null if not in scene\r\n\r\n\t\t/** @type {number} - layer id */\r\n\t\tthis.$layer = null;\t//maybe override\r\n\r\n\t\t/** @type {PPlayer} */\r\n\t\tthis.$physics = null;\r\n\t\tObject.defineProperty(this, \"$physics\", {\r\n\t\t\tconfigurable: true,\r\n\t\t\tenumerable: false,\r\n\t\t\twritable: true,\r\n\t\t\tvalue: null,\r\n\t\t});\r\n\r\n\t\tthis.renderer = null;\r\n\t}\r\n\t\r\n\t/** create physics, load resource, ... */\r\n\tcreate() {\r\n\t}\r\n\t/** destroy physics, ... */\r\n\tdestroy() {\r\n\t}\r\n\t\r\n\tset enablePhysics(value) {\r\n\t\tif (this.$physics) {\r\n\t\t\tthis.$physics.enable = value;\r\n\t\t\tthis.$physics.state.freeze = !value;\r\n\t\t}\r\n\t}\r\n\tget enablePhysics() {\r\n\t\tif (this.$physics) {\r\n\t\t\treturn this.$physics.enable;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\t_applyState() {\r\n\t\tthrow new Error(\"Not implement\");\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis.renderer.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trender(renderer) {\r\n\t\tthis.renderer.render(renderer);\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * @param {SceneObject|null} chara - 被 chara 攻擊\r\n\t * @param {number} damage - 傷害\r\n\t */\r\n\tdamage(chara, damage) {\r\n\t\tconsole.log(this.$objectid + \" 被 \" + chara.$objectid + \" 攻擊，減少 \" + damage + \" HP\");\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t * if (chara == null) ??\r\n\t * @param {SceneObject|null} chara - 被 chara 攻擊\r\n\t * @param {number} moveX - unit is pixel\r\n\t * @param {number} moveY - unit is pixel\r\n\t */\r\n\tknockback(chara, moveX, moveY) {\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} name\r\n\t * @param {string} labelStyle\r\n\t */\r\n\t__drawName(renderer, name, labelStyle) {\r\n\t\tif (!$gv.m_display_name_label) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (labelStyle && labelStyle != \"0\") {\r\n\t\t\tlet label = _Renderer_NameLabel_js__WEBPACK_IMPORTED_MODULE_2__[\"NameLabel\"].get(labelStyle);\r\n\t\t\tif (label && !label.$promise) {\r\n\t\t\t\tconst crr = this.renderer;\r\n\t\t\t\tlabel.draw(renderer, name, crr.x, crr.y);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.__drawName_default(renderer, name);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t * @param {string} name\r\n\t * @param {string} color\r\n\t * @param {string} bgColor\r\n\t */\r\n\t__drawName_default(renderer, name, color=\"#FFF\", bgColor=\"#000B\") {\r\n\t\tconst ctx = renderer.ctx;\r\n\t\tconst crr = this.renderer;\r\n\r\n\t\tctx.font = \"12px 微軟正黑體\";//新細明體\r\n\t\tctx.textBaseline = \"middle\";\r\n\t\tctx.textAlign = \"start\";\r\n\r\n\t\tconst r = 2, h = 12;\r\n\t\tconst w = ctx.measureText(name).width + 3;\r\n\t\tconst x = Math.trunc(crr.x/* + crr.tx*/) - w * 0.5;//TODO: crr.tx and crr.ty ??\r\n\t\tconst y = Math.trunc(crr.y/* + crr.ty*/);\r\n\r\n\t\tconst left = x + r;\r\n\t\tconst _left = x;\r\n\t\tconst top = y;\r\n\t\tconst _top = y + r;\r\n\t\tconst _right = x + w;\r\n\t\tconst right = _right + r;\r\n\t\tconst bottom = y + r + h + r;\r\n\t\tconst _bottom = y + r + h;\r\n\r\n\t\tctx.beginPath();\r\n\t\t{\r\n\t\t\tctx.moveTo(left, top);\r\n\r\n\t\t\tctx.lineTo(_right, top);\r\n\t\t\tctx.arcTo(right, top, right, _top, r);\r\n\r\n\t\t\tctx.lineTo(right, _bottom);\r\n\t\t\tctx.arcTo(right, bottom, _right, bottom, r);\r\n\r\n\t\t\tctx.lineTo(left, bottom);\r\n\t\t\tctx.arcTo(_left, bottom, _left, _bottom, r);\r\n\r\n\t\t\tctx.lineTo(_left, _top);\r\n\t\t\tctx.arcTo(_left, top, left, top, r);\r\n\t\t}\r\n\t\tctx.fillStyle = bgColor;\r\n\t\tctx.fill();\r\n\t\t//ctx.strokeStyle = \"#000F\";\r\n\t\t//ctx.stroke();\r\n\r\n\t\tif (0) {}\r\n\t\t\r\n\t\tctx.fillStyle = color;\r\n\t\tctx.fillText(name, left, (top + bottom) * 0.5);\r\n\t}\r\n}\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9TY2VuZU9iamVjdC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1NjZW5lT2JqZWN0LmpzPzRkNTIiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IElSZW5kZXJlciB9IGZyb20gJy4vSVJlbmRlcmVyLmpzJztcclxuaW1wb3J0IHsgUFBsYXllciB9IGZyb20gJy4vUGh5c2ljcy9QUGxheWVyLmpzJztcclxuaW1wb3J0IHsgTmFtZUxhYmVsIH0gZnJvbSAnLi9SZW5kZXJlci9OYW1lTGFiZWwuanMnO1xyXG5cclxuLyoqXHJcbiAqIEdhbWUgb2JqZWN0XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgU2NlbmVPYmplY3Qge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHtzdHJpbmd8bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy4kb2JqZWN0aWQgPSBudWxsO1x0Ly8gcGxheWVyTmFtZSBvciBvYmplY3RJRDsgPz8gbnVsbCBpZiBub3QgaW4gc2NlbmVcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSBsYXllciBpZCAqL1xyXG5cdFx0dGhpcy4kbGF5ZXIgPSBudWxsO1x0Ly9tYXliZSBvdmVycmlkZVxyXG5cclxuXHRcdC8qKiBAdHlwZSB7UFBsYXllcn0gKi9cclxuXHRcdHRoaXMuJHBoeXNpY3MgPSBudWxsO1xyXG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiJHBoeXNpY3NcIiwge1xyXG5cdFx0XHRjb25maWd1cmFibGU6IHRydWUsXHJcblx0XHRcdGVudW1lcmFibGU6IGZhbHNlLFxyXG5cdFx0XHR3cml0YWJsZTogdHJ1ZSxcclxuXHRcdFx0dmFsdWU6IG51bGwsXHJcblx0XHR9KTtcclxuXHJcblx0XHR0aGlzLnJlbmRlcmVyID0gbnVsbDtcclxuXHR9XHJcblx0XHJcblx0LyoqIGNyZWF0ZSBwaHlzaWNzLCBsb2FkIHJlc291cmNlLCAuLi4gKi9cclxuXHRjcmVhdGUoKSB7XHJcblx0fVxyXG5cdC8qKiBkZXN0cm95IHBoeXNpY3MsIC4uLiAqL1xyXG5cdGRlc3Ryb3koKSB7XHJcblx0fVxyXG5cdFxyXG5cdHNldCBlbmFibGVQaHlzaWNzKHZhbHVlKSB7XHJcblx0XHRpZiAodGhpcy4kcGh5c2ljcykge1xyXG5cdFx0XHR0aGlzLiRwaHlzaWNzLmVuYWJsZSA9IHZhbHVlO1xyXG5cdFx0XHR0aGlzLiRwaHlzaWNzLnN0YXRlLmZyZWV6ZSA9ICF2YWx1ZTtcclxuXHRcdH1cclxuXHR9XHJcblx0Z2V0IGVuYWJsZVBoeXNpY3MoKSB7XHJcblx0XHRpZiAodGhpcy4kcGh5c2ljcykge1xyXG5cdFx0XHRyZXR1cm4gdGhpcy4kcGh5c2ljcy5lbmFibGU7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZmFsc2U7XHJcblx0fVxyXG5cclxuXHRfYXBwbHlTdGF0ZSgpIHtcclxuXHRcdHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRcIik7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMucmVuZGVyZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHJlbmRlcihyZW5kZXJlcikge1xyXG5cdFx0dGhpcy5yZW5kZXJlci5yZW5kZXIocmVuZGVyZXIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge1NjZW5lT2JqZWN0fG51bGx9IGNoYXJhIC0g6KKrIGNoYXJhIOaUu+aTilxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBkYW1hZ2UgLSDlgrflrrNcclxuXHQgKi9cclxuXHRkYW1hZ2UoY2hhcmEsIGRhbWFnZSkge1xyXG5cdFx0Y29uc29sZS5sb2codGhpcy4kb2JqZWN0aWQgKyBcIiDooqsgXCIgKyBjaGFyYS4kb2JqZWN0aWQgKyBcIiDmlLvmk4rvvIzmuJvlsJEgXCIgKyBkYW1hZ2UgKyBcIiBIUFwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEB2aXJ0dWFsXHJcblx0ICogaWYgKGNoYXJhID09IG51bGwpID8/XHJcblx0ICogQHBhcmFtIHtTY2VuZU9iamVjdHxudWxsfSBjaGFyYSAtIOiiqyBjaGFyYSDmlLvmk4pcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gbW92ZVggLSB1bml0IGlzIHBpeGVsXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IG1vdmVZIC0gdW5pdCBpcyBwaXhlbFxyXG5cdCAqL1xyXG5cdGtub2NrYmFjayhjaGFyYSwgbW92ZVgsIG1vdmVZKSB7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGxhYmVsU3R5bGVcclxuXHQgKi9cclxuXHRfX2RyYXdOYW1lKHJlbmRlcmVyLCBuYW1lLCBsYWJlbFN0eWxlKSB7XHJcblx0XHRpZiAoISRndi5tX2Rpc3BsYXlfbmFtZV9sYWJlbCkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHRpZiAobGFiZWxTdHlsZSAmJiBsYWJlbFN0eWxlICE9IFwiMFwiKSB7XHJcblx0XHRcdGxldCBsYWJlbCA9IE5hbWVMYWJlbC5nZXQobGFiZWxTdHlsZSk7XHJcblx0XHRcdGlmIChsYWJlbCAmJiAhbGFiZWwuJHByb21pc2UpIHtcclxuXHRcdFx0XHRjb25zdCBjcnIgPSB0aGlzLnJlbmRlcmVyO1xyXG5cdFx0XHRcdGxhYmVsLmRyYXcocmVuZGVyZXIsIG5hbWUsIGNyci54LCBjcnIueSk7XHJcblx0XHRcdFx0cmV0dXJuO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLl9fZHJhd05hbWVfZGVmYXVsdChyZW5kZXJlciwgbmFtZSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGNvbG9yXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IGJnQ29sb3JcclxuXHQgKi9cclxuXHRfX2RyYXdOYW1lX2RlZmF1bHQocmVuZGVyZXIsIG5hbWUsIGNvbG9yPVwiI0ZGRlwiLCBiZ0NvbG9yPVwiIzAwMEJcIikge1xyXG5cdFx0Y29uc3QgY3R4ID0gcmVuZGVyZXIuY3R4O1xyXG5cdFx0Y29uc3QgY3JyID0gdGhpcy5yZW5kZXJlcjtcclxuXHJcblx0XHRjdHguZm9udCA9IFwiMTJweCDlvq7ou5/mraPpu5Hpq5RcIjsvL+aWsOe0sOaYjumrlFxyXG5cdFx0Y3R4LnRleHRCYXNlbGluZSA9IFwibWlkZGxlXCI7XHJcblx0XHRjdHgudGV4dEFsaWduID0gXCJzdGFydFwiO1xyXG5cclxuXHRcdGNvbnN0IHIgPSAyLCBoID0gMTI7XHJcblx0XHRjb25zdCB3ID0gY3R4Lm1lYXN1cmVUZXh0KG5hbWUpLndpZHRoICsgMztcclxuXHRcdGNvbnN0IHggPSBNYXRoLnRydW5jKGNyci54LyogKyBjcnIudHgqLykgLSB3ICogMC41Oy8vVE9ETzogY3JyLnR4IGFuZCBjcnIudHkgPz9cclxuXHRcdGNvbnN0IHkgPSBNYXRoLnRydW5jKGNyci55LyogKyBjcnIudHkqLyk7XHJcblxyXG5cdFx0Y29uc3QgbGVmdCA9IHggKyByO1xyXG5cdFx0Y29uc3QgX2xlZnQgPSB4O1xyXG5cdFx0Y29uc3QgdG9wID0geTtcclxuXHRcdGNvbnN0IF90b3AgPSB5ICsgcjtcclxuXHRcdGNvbnN0IF9yaWdodCA9IHggKyB3O1xyXG5cdFx0Y29uc3QgcmlnaHQgPSBfcmlnaHQgKyByO1xyXG5cdFx0Y29uc3QgYm90dG9tID0geSArIHIgKyBoICsgcjtcclxuXHRcdGNvbnN0IF9ib3R0b20gPSB5ICsgciArIGg7XHJcblxyXG5cdFx0Y3R4LmJlZ2luUGF0aCgpO1xyXG5cdFx0e1xyXG5cdFx0XHRjdHgubW92ZVRvKGxlZnQsIHRvcCk7XHJcblxyXG5cdFx0XHRjdHgubGluZVRvKF9yaWdodCwgdG9wKTtcclxuXHRcdFx0Y3R4LmFyY1RvKHJpZ2h0LCB0b3AsIHJpZ2h0LCBfdG9wLCByKTtcclxuXHJcblx0XHRcdGN0eC5saW5lVG8ocmlnaHQsIF9ib3R0b20pO1xyXG5cdFx0XHRjdHguYXJjVG8ocmlnaHQsIGJvdHRvbSwgX3JpZ2h0LCBib3R0b20sIHIpO1xyXG5cclxuXHRcdFx0Y3R4LmxpbmVUbyhsZWZ0LCBib3R0b20pO1xyXG5cdFx0XHRjdHguYXJjVG8oX2xlZnQsIGJvdHRvbSwgX2xlZnQsIF9ib3R0b20sIHIpO1xyXG5cclxuXHRcdFx0Y3R4LmxpbmVUbyhfbGVmdCwgX3RvcCk7XHJcblx0XHRcdGN0eC5hcmNUbyhfbGVmdCwgdG9wLCBsZWZ0LCB0b3AsIHIpO1xyXG5cdFx0fVxyXG5cdFx0Y3R4LmZpbGxTdHlsZSA9IGJnQ29sb3I7XHJcblx0XHRjdHguZmlsbCgpO1xyXG5cdFx0Ly9jdHguc3Ryb2tlU3R5bGUgPSBcIiMwMDBGXCI7XHJcblx0XHQvL2N0eC5zdHJva2UoKTtcclxuXHJcblx0XHRpZiAoMCkgey8vaW5uZXJcclxuXHRcdFx0Y3R4LmZpbGxTdHlsZSA9IFwieWVsbG93XCI7XHJcblx0XHRcdGN0eC5zdHJva2VTdHlsZSA9IFwieWVsbG93XCI7XHJcblx0XHRcdGN0eC5iZWdpblBhdGgoKTtcclxuXHRcdFx0e1xyXG5cdFx0XHRcdGN0eC5tb3ZlVG8obGVmdCwgX3RvcCk7XHJcblxyXG5cdFx0XHRcdGN0eC5saW5lVG8oX3JpZ2h0LCBfdG9wKTtcclxuXHJcblx0XHRcdFx0Y3R4LmxpbmVUbyhfcmlnaHQsIF9ib3R0b20pO1xyXG5cclxuXHRcdFx0XHRjdHgubGluZVRvKGxlZnQsIF9ib3R0b20pO1xyXG5cclxuXHRcdFx0XHRjdHguY2xvc2VQYXRoKCk7XHJcblx0XHRcdH1cclxuXHRcdFx0Y3R4LnN0cm9rZSgpO1xyXG5cdFx0fVxyXG5cdFx0XHJcblx0XHRjdHguZmlsbFN0eWxlID0gY29sb3I7XHJcblx0XHRjdHguZmlsbFRleHQobmFtZSwgbGVmdCwgKHRvcCArIGJvdHRvbSkgKiAwLjUpO1xyXG5cdH1cclxufVxyXG5cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsV0FnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/game/SceneObject.js\n");

/***/ }),

/***/ "./src/game/Skill.js":
/*!***************************!*\
  !*** ./src/game/Skill.js ***!
  \***************************/
/*! exports provided: SkillEffectAnimation, EffectManager, SceneSkill */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SkillEffectAnimation\", function() { return SkillEffectAnimation; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"EffectManager\", function() { return EffectManager; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SceneSkill\", function() { return SceneSkill; });\n/* harmony import */ var _IRenderer_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./IRenderer.js */ \"./src/game/IRenderer.js\");\n/* harmony import */ var _Sprite_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Sprite.js */ \"./src/game/Sprite.js\");\n/* harmony import */ var _Animation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Animation */ \"./src/game/Animation.js\");\n/* harmony import */ var _SceneObject__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./SceneObject */ \"./src/game/SceneObject.js\");\n/* harmony import */ var _Renderer_CharacterActionAnimation_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Renderer/CharacterActionAnimation.js */ \"./src/game/Renderer/CharacterActionAnimation.js\");\n/* harmony import */ var _Renderer_CharacterRenderer_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./Renderer/CharacterRenderer.js */ \"./src/game/Renderer/CharacterRenderer.js\");\n/* harmony import */ var _Physics_PPlayer_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Physics/PPlayer.js */ \"./src/game/Physics/PPlayer.js\");\n/* harmony import */ var _SceneCharacter_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./SceneCharacter.js */ \"./src/game/SceneCharacter.js\");\n/* harmony import */ var _Physics_World_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Physics/World.js */ \"./src/game/Physics/World.js\");\n/* harmony import */ var _Physics_PBullet_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./Physics/PBullet.js */ \"./src/game/Physics/PBullet.js\");\n/* harmony import */ var _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../Common/AttackInfo.js */ \"./src/Common/AttackInfo.js\");\n/* harmony import */ var _math_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./math.js */ \"./src/game/math.js\");\n﻿\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//dev\r\n\r\n\r\n// skill timeline\r\n//\r\n// 以 ActionAnimation 控制流程\r\n// skill 必須要有 ActionAnimation 才能正確運作(開始、結束)\r\n//\r\n// # normal skill\r\n// -delay1        | delay2\r\n// _init          | update\r\n// defaultAction  | wait current_action end\r\n//                | SkillEffect\r\n//\r\n// # rapid skill\r\n// delay1      | delay2         | delay3\r\n// _init       | control/update | update\r\n// prepare     | loop           | end\r\n// SkillEffect | SkillEffect    | SkillEffect\r\n\r\n\r\n/**\r\n * 23001002(藝術跳躍)\r\n * 24001002(幻影瞬步)\r\n */\r\nlet jump2_info = {\r\n\ttype: 40,\r\n\tcasterMove: 1,\r\n\tavaliableInJumpingState: 1\r\n};\r\n\r\n/**\r\n * 23121000(伊修塔爾之環): localhost/xml2/Skill/2312/skill/23121000\r\n */\r\nlet rapid_attack_info = {\r\n\ttype: 2,\r\n\tknockbackLimit: 80,\r\n\trapidAttack: 1\r\n};\r\n\r\n\r\nclass _SkillInfo {\r\n\tconstructor() {\r\n\t\tthis.type = 40;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.casterMove = 1;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.avaliableInJumpingState = 1;\r\n\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.areaAttack = 1;\r\n\r\n\t\tthis.knockbackLimit = 80;\r\n\r\n\t\t/** @type {boolean} */\r\n\t\tthis.rapidAttack = 1;\r\n\t}\r\n}\r\nclass _SkillCommonData {\r\n\tconstructor() {\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.lt = null;//new Vec2(-200, -113)\r\n\r\n\t\t/** @type {Vec2} */\r\n\t\tthis.rb = null;//new Vec2(-10, 0)\r\n\r\n\t\t/** @type {string} - code */\r\n\t\tthis.mpCon = \"3 + d(x / 6)\";\r\n\r\n\t\t/** @type {string} - code */\r\n\t\tthis.damage = \"175 + 8 * x\";\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.mobCount = 6;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.attackCount = 1;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.maxLevel = 20;\r\n\t}\r\n}\r\nclass _SkillData {\r\n\tconstructor() {\r\n\t\t/** @type {{ [actType: number]: string }} */\r\n\t\tthis.action = {\r\n\t\t\t\"0\": \"dualVulcanLoop\"\r\n\t\t};\r\n\r\n\t\t/** @type {_SkillCommonData} */\r\n\t\tthis.common = null;\r\n\r\n\t\t/** @type {_SkillInfo} */\r\n\t\tthis.info = null;\r\n\r\n\t\t/** @type {SkillEffectAnimation} - ? type */\r\n\t\tthis.effect = null;\r\n\r\n\t\t/** @type {SkillEffectAnimation} - ? type */\r\n\t\tthis.prepare = null;\r\n\r\n\t\t/** @type {SkillEffectAnimation} - ? type */\r\n\t\tthis.keydown = null;\r\n\r\n\t\t/** @type {SkillEffectAnimation} - ? type */\r\n\t\tthis.keydown0 = null;\r\n\r\n\t\t/** @type {SkillEffectAnimation} - ? type */\r\n\t\tthis.keydownend = null;\r\n\r\n\t\t/** @type {{[skill_id:string]:{[type:number]:number}}} */\r\n\t\tthis.finalAttack = {\r\n\t\t\t\"23100006\": {\r\n\t\t\t\t\"0\": 52\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.masterLevel = 10;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.combatOrders = 1;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.weapon = 52;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.subWeapon = 35;\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.psd = 1;\r\n\r\n\t\t/** @type {number} - ?? */\r\n\t\tthis.psdSkill = {\r\n\t\t\t23111002: {}\r\n\t\t};\r\n\r\n\t\t/** @type {{[skill_id:string]:number}} */\r\n\t\tthis.req = {\r\n\t\t\t\"23111000\": 20\r\n\t\t};\r\n\r\n\t\t/** @type {number} */\r\n\t\tthis.canJobRidingUse = 1;\r\n\t}\r\n}\r\n\r\n\r\n\r\nclass SkillEffectAnimation extends _Animation__WEBPACK_IMPORTED_MODULE_2__[\"Animation\"] {\r\n\tconstructor(raw/*, url*/) {\r\n\t\tsuper(raw/*, url*/);\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\r\n\t\t/** @type {{x: number, y: number, front:-1|1}} */\r\n\t\tthis.targetRenderer = null;\r\n\r\n\t\t/** @type {PBullet} */\r\n\t\tthis.$physics = null;\r\n\r\n\t\tthis.is_loop = false;\r\n\r\n\t\tthis.opacity = 1;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string|number} type - ??\r\n\t * @param {string} url - ??\r\n\t * @param {object} raw - ??\r\n\t */\r\n\tload(type) {\r\n\t\tif (!this._raw) {\r\n\t\t\tthrow new TypeError(\"raw\");\r\n\t\t\t//this._url = [this._url, type].join(\"/\");\r\n\t\t\t//return super.load();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (Array.isArray(this._raw[type])) {\r\n\t\t\t\t/** @type {Sprite[]} */\r\n\t\t\t\tthis.textures = this._raw[type];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t/** @type {Sprite[]} */\r\n\t\t\t\tthis.textures = this._raw;\r\n\t\t\t}\r\n\t\t\tif (true) {\r\n\t\t\t\tif (!(this.textures[0] instanceof _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"])) {\r\n\t\t\t\t\tthrow new TypeError();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tthis.$physics = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.$physics) {\r\n\t\t\tthis.update_p(stamp);\r\n\t\t}\r\n\t\telse if (this.targetRenderer) {\r\n\t\t\tthis.update_r(stamp);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trender(renderer) {\r\n\t\tif (this.$physics) {\r\n\t\t\tthis.render_p(renderer);\r\n\t\t}\r\n\t\telse if (this.targetRenderer) {\r\n\t\t\tthis.render_r(renderer);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate_p(stamp) {\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trender_p(renderer) {\r\n\t\tconst pos = this.$physics.getPosition();\r\n\t\tconst front = this.$physics.front;\r\n\t\tconst x = pos.x * $gv.CANVAS_SCALE;\r\n\t\tconst y = pos.y * $gv.CANVAS_SCALE;\r\n\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\r\n\t\t//renderer.pushGlobalAlpha();\r\n\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\t\tthis.draw(renderer, x, y, 0, front > 0);\r\n\r\n\t\t//renderer.popGlobalAlpha();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate_r(stamp) {\r\n\t\tstamp *= this.targetRenderer.getSpeed();\r\n\t\t\r\n\t\tsuper.update(stamp);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\trender_r(renderer) {\r\n\t\tthis.x = this.targetRenderer.x + this.targetRenderer.tx;//TODO: crr.tx and crr.ty ??\r\n\t\tthis.y = this.targetRenderer.y + this.targetRenderer.ty;\r\n\r\n\t\t//renderer.pushGlobalAlpha();\r\n\r\n\t\trenderer.globalAlpha = this.opacity;\r\n\t\tthis.draw(renderer, this.x, this.y, 0, this.targetRenderer.front > 0);\r\n\r\n\t\t//renderer.popGlobalAlpha();\r\n\t}\r\n}\r\n\r\nclass SkillHitAnimation extends SkillEffectAnimation {\r\n\tconstructor(raw, url) {\r\n\t\tsuper(raw, url);\r\n\t}\r\n}\r\n\r\n\r\n\r\n/**\r\n * TODO: SceneObject 取代 EffectManager\r\n */\r\nclass EffectManager {\r\n\tconstructor() {\r\n\t}\r\n\t\r\n\tstatic AddEffect(effect) {\r\n\t\teffect.update(0);//init effect position\r\n\t\t\r\n\t\tEffectManager._effects.push(effect);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} stamp\r\n\t */\r\n\tstatic Update(stamp) {\r\n\t\tconst effects = EffectManager._effects;\r\n\t\t\r\n\t\tEffectManager._effects = effects.filter(function (eff) {\r\n\t\t\tif (!eff.isEnd()) {\r\n\t\t\t\teff.update(stamp);\r\n\t\t\t}\r\n\t\t\tif (eff.isEnd()) {\r\n\t\t\t\teff.destroy();\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {IRenderer} renderer\r\n\t */\r\n\tstatic Render(renderer) {\r\n\t\trenderer.pushGlobalAlpha();\r\n\r\n\t\tconst effects = EffectManager._effects;\r\n\t\tfor (let i = 0; i < effects.length; ++i) {\r\n\t\t\teffects[i].render(renderer);\r\n\t\t}\r\n\r\n\t\trenderer.popGlobalAlpha();\r\n\t}\r\n}\r\n/** @type {Animation[]} */\r\nEffectManager._effects = [];\r\n\r\nwindow.$EffectManager = EffectManager;\r\n\r\n\r\n\r\n/**\r\n * \r\n */\r\nclass SkillAnimationBase {\r\n\t///**\r\n\t// * @param {object} raw\r\n\t// * @param {string} url\r\n\t// */\r\n\tconstructor(/*raw, url*/) {\r\n\t\t//this._raw = raw;\r\n\r\n\t\t/**\r\n\t\t * @type {_SkillData}\r\n\t\t */\r\n\t\tthis.data = null;\r\n\t\t\r\n\t\t/** @type {string} */\r\n\t\tthis.url = null;\r\n\t\t\r\n\t\t//this.textures = {\r\n\t\t//\teffect: [],\r\n\t\t//\thit: {\r\n\t\t//\t\t\"0\": []\r\n\t\t//\t},\r\n\t\t//}\r\n\r\n\t\t/** @type {string} */\r\n\t\tthis.skillId = null;\r\n\r\n\t\t/**\r\n\t\t * actType = GetJobInfo(chara).avaliableWeapon.indexOf(ItemInfo.get(chara.weapon).type)\r\n\t\t */\r\n\t\tthis.actType = 0;\r\n\t\t\r\n\t\t/** @type {SceneObject} */\r\n\t\tthis._owner = null;\r\n\r\n\t\t/** @type {CharacterAnimationBase} */\r\n\t\tthis._crr = null;\r\n\r\n\t\t/** @type {ActionAnimation} */\r\n\t\tthis._actani = null;\r\n\t\t\r\n\t\t/** @type {number} - skill type */\r\n\t\tthis.type = 0;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis._$is_end = false;\r\n\t\t\r\n\t\t/** @type {boolean} */\r\n\t\tthis.is_launch = false;\r\n\t\t\r\n\t\t//if (raw && url) {\r\n\t\t//\tthis.__load(url, raw, null);\r\n\t\t//}\r\n\r\n\t\t/** @type {\"prepare\"|\"keydown\"|\"keydownend\"} */\r\n\t\tthis.state = null;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\t_init() {\r\n\t\tthis._applyDefaultAction();\r\n\t}\r\n\r\n\tget is_end() {\r\n\t\treturn this._$is_end;\r\n\t}\r\n\tset is_end(value) {\r\n\t\tthis._$is_end = value;\r\n\t\tif (value) {\r\n\t\t\tthis.owner.$physics.state.invokeSkill = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/** @type {SceneObject} */\r\n\tget owner() {\r\n\t\treturn this._owner;\r\n\t}\r\n\tset owner(value) {\r\n\t\tif (!value) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._owner = value;\r\n\r\n\t\tthis._crr = value.renderer;\r\n\t\tif (!this._crr) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//const chara = value; //??\r\n\t\t//this.actType = GetJobInfo(chara).avaliableWeapon.indexOf(ItemInfo.get(chara.weapon).type)\r\n\r\n\t\tthis._actani = this._crr.actani;\r\n\t\tif (!this._actani) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * return this._owner as SceneCharacter\r\n\t * @alias owner\r\n\t * @returns {SceneCharacter}\r\n\t */\r\n\tget _owner_player() {\r\n\t\treturn this._owner;\r\n\t}\r\n\tset _owner_player(value) {\r\n\t\tthis.owner = value;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} action\r\n\t */\r\n\t_applyAction(action) {\r\n\t\tif (this._actani && this.data) {\r\n\t\t\tconst actions = this.data.action;\r\n\t\t\tthis._actani.reload(action);//action ? 0, 1\r\n\t\t\tthis._actani.loop = false;\r\n\t\t\t\r\n\t\t\tthis.owner.$physics.state.invokeSkill = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\t_getDefaultAction() {\r\n\t\tconst actions = this.data.action;\r\n\t\treturn actions[this.actType];\r\n\t}\r\n\r\n\t/** skill default action */\r\n\t_applyDefaultAction() {\r\n\t\tthis._applyAction(this._getDefaultAction());\r\n\t}\r\n\r\n\t_isFinishDefaultAction() {\r\n\t\tconst act = this._getDefaultAction();\r\n\t\tif (this._actani) {\r\n\t\t\treturn this._actani._action != act;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * download data, load texture\r\n\t * @param {string} skillId\r\n\t */\r\n\tasync _load(skillId) {\r\n\t\tconst jobID = /^(\\d+)\\d{4}$/.exec(skillId)[1];\r\n\r\n\t\tconst url = `${this.constructor._base_path}/${jobID}/skill/${skillId}`;\r\n\r\n\t\tlet raw;\r\n\t\ttry {\r\n\t\t\traw = await $get.data(url);\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\tif (!raw) {\r\n\t\t\talert(\"SkillAnimationBase\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.data = raw;\r\n\t\t\r\n\t\tthis.url = url;\r\n\r\n\t\tthis.skillId = skillId;\r\n\r\n\t\tthis.type = this.data.info ? (this.data.info.type || 0) : 0;//const\r\n\r\n\t\tthis.__proto__ = this._decide_type().prototype;\r\n\t\t{\r\n\t\t\tthis._loadTexture(raw);\r\n\r\n\t\t\tthis._init();\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * copy\r\n\t * @param {SkillAnimationBase} skill_anim\r\n\t * @param {SkillAnimationBase} proto - skill prototype\r\n\t */\r\n\t_assign(skill_anim, proto) {\r\n\t\tthis.data = skill_anim.data;\r\n\t\t\r\n\t\tthis.url = skill_anim.url;\r\n\r\n\t\tthis.skillId = skill_anim.skillId;\r\n\t\t\r\n\t\tthis.type = skill_anim.type;//const\r\n\r\n\t\tthis.__proto__ = this._decide_type().prototype;\r\n\t\t{\r\n\t\t\tthis._init();\r\n\t\t}\r\n\t}\r\n\t\r\n\t_loadTexture() {\r\n\t\tfor (let effName of this._effect_names) {\r\n\t\t\tlet eff = this.data[effName];\r\n\t\t\tif (eff) {\r\n\t\t\t\tthis.data[effName] = arrNd_texture(eff/*, [this.url, effName].join(\"/\")*/);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction arrNd_texture(arrNd/*, url*/) {\r\n\t\t\tif (\"0\" in arrNd[0]) {\r\n\t\t\t\treturn arr2d_texture(arrNd/*, url*/);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn arr1d_texture(arrNd/*, url*/);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction arr1d_texture(arr1d/*, url*/) {\r\n\t\t\tlet effect = [];\r\n\t\t\tfor (let  i = 0; i in arr1d; ++i) {\r\n\t\t\t\tlet data = arr1d[i];\r\n\t\t\t\tlet tex = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](data);\r\n\t\t\t\t//tex._url = `${url}/${i}`;\r\n\t\t\t\teffect[i] = tex;\r\n\t\t\t}\r\n\t\t\teffect.action = arr1d.action;\r\n\t\t\treturn effect;\r\n\t\t}\r\n\t\tfunction arr2d_texture(arr2d/*, url*/) {\r\n\t\t\tlet hit = [];\r\n\t\t\tfor (let i = 0; i in arr2d; ++i) {\r\n\t\t\t\t//const url_i = `${url}/${i}`;\r\n\t\t\t\tlet group = arr2d[i];\r\n\t\t\t\thit[i] = [];\r\n\t\t\t\tfor (let  j = 0; j in group; ++j) {\r\n\t\t\t\t\tlet data = group[j];\r\n\t\t\t\t\tlet tex = new _Sprite_js__WEBPACK_IMPORTED_MODULE_1__[\"Sprite\"](data);\r\n\t\t\t\t\t//tex._url = `${url_i}/${j}`;\r\n\t\t\t\t\thit[i][j] = tex;\r\n\t\t\t\t}\r\n\t\t\t\thit[i].action = group.action;\r\n\t\t\t}\r\n\t\t\treturn hit;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * reset and restart\r\n\t */\r\n\treset() {\r\n\t\tthis._actani.reset();\r\n\t\tthis.is_launch = false;\r\n\t}\r\n\r\n\t/**\r\n\t * is owner can invoke skill\r\n\t * @virtual\r\n\t * @param {SceneCharacter} owner\r\n\t * @returns {boolean}\r\n\t */\r\n\ttest(owner) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * onKeydown + onKeyup\r\n\t * TODO: 可控制方向的技能\r\n\t * @virtual\r\n\t * @param {Partial<_ArrowKey>} inputKey - keyDown tick counter\r\n\t * @param {number} keyDown - keyDown tick counter\r\n\t * @param {number} keyUp - is keyUp\r\n\t * @returns {boolean} - cancel player default control\r\n\t */\r\n\tcontrol(inputKey, keyDown, keyUp) {\r\n\t}\r\n\t\r\n\t/**\r\n\t * TODO: 自動攻擊、被動技能、debuf\r\n\t * @virtual\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tif (this.$promise) {\r\n\t\t\t//Now loading...\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.is_launch = true;\r\n\t\t\tthis.is_end = true;\r\n\t\t\tconsole.warn(\"Skill not implement: \" + this.skillId);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * no timer\r\n\t * @param {number} stamp\r\n\t */\r\n\t_default_update(stamp) {\r\n\t\t//stamp *= this.targetRenderer.getSpeed();\r\n\r\n\t\tif (this._actani) {\r\n\t\t\tif (this._actani.delay) {// not start yet\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (!this.is_launch) {\r\n\t\t\t\tthis._addEffect();\r\n\r\n\t\t\t\tthis.is_launch = true;\r\n\t\t\t}\r\n\t\t\tif (this._actani.isEnd()) {\r\n\t\t\t\tthis.is_end = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.is_launch = true;\r\n\t\t\tthis.is_end = true;\r\n\t\t}\r\n\t}\r\n\t\r\n\tisEnd() {\r\n\t\treturn this.is_end;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {SceneObject} targetObject\r\n\t */\r\n\taddAttack(targetObject) {\r\n\t\t/** @type {SceneCharacter} */\r\n\t\tconst owner = this._owner;\r\n\r\n\t\tlet attack = new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_10__[\"AttackPair\"]();\r\n\r\n\t\t//attack.objectid = targetObject.$objectid;\r\n\t\tattack.setTargetObject(targetObject);\r\n\r\n\t\tattack.allDamage.length = this.data.common.attackCount;\r\n\r\n\t\t////apply damage\r\n\t\t//for (let i = 0; i < attack.allDamage.length; ++i) {\r\n\t\t//\ttargetObject.damage(owner, 123);\r\n\t\t//}\r\n\t\t////\r\n\t\t//targetObject.knockback(chara, 16, 16);\r\n\r\n\t\tthis.attackInfo.allAttack.push(attack);\r\n\t}\r\n\t\r\n\tcreateBullet(effectName) {\r\n\t\tlet eff, bullet;\r\n\r\n\t\t//bullet renderer\r\n\t\t{\r\n\t\t\teff = this._addEffect(effectName);\r\n\r\n\t\t\teff.is_loop = true;\r\n\t\t}\r\n\r\n\t\t//bullet physics\r\n\t\t{\r\n\t\t\tbullet = new _Physics_PBullet_js__WEBPACK_IMPORTED_MODULE_9__[\"PBullet\"](this.owner.$physics, this, eff);\r\n\r\n\t\t\tbullet._create();\r\n\r\n\t\t\tbullet.launch(null, this.owner.$physics.state.front * (window.$BULLET_SPEED | 32), 0);\r\n\t\t}\r\n\r\n\t\t//link renderer and physics\r\n\t\teff.$physics = bullet;\r\n\r\n\t\treturn bullet;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {boolean} [isBullet=false]\r\n\t */\r\n\t_addDefaultEffect(isBullet) {\r\n\t\tthis._applyDefaultAction();\r\n\t\tthis._addEffect(\"effect\", isBullet);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} [effectName=\"effect\"]\r\n\t * @param {boolean} [isBullet=false]\r\n\t */\r\n\t_addEffect(effectName = \"effect\", isBullet) {\r\n\t\tlet action = this.data[effectName].action;\r\n\t\tif (action) {\r\n\t\t\tthis._applyAction(action);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst type = this.actType;\r\n\t\t\tlet effect = new SkillEffectAnimation(this.data[effectName]/*, [this.url, effectName].join(\"/\")*/);\r\n\r\n\t\t\tif (isBullet) {\r\n\t\t\t\t//...??\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\teffect.targetRenderer = this._crr;\r\n\t\t\t}\r\n\t\t\teffect.load(type);\r\n\r\n\t\t\tEffectManager.AddEffect(effect);\r\n\r\n\t\t\treturn effect;\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {number} x\r\n\t * @param {number} y\r\n\t * @param {{x: number, y: number}=} target\r\n\t * @param {number=} type\r\n\t */\r\n\t_addHitEffect(x, y, target, type) {\r\n\t\tlet hit = new SkillHitAnimation();\r\n\t\t\r\n\t\thit.target = target;\r\n\t\t\r\n\t\thit.load(this.url + \"/hit/\" + type, this.data.hit, type);\r\n\t\t\r\n\t\tEffectManager.AddEffect(hit);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * @returns {function():(T extends SkillAnimationBase)}\r\n\t */\r\n\t_decide_type() {\r\n\t\tconst info = this.data.info;\r\n\r\n\t\t//TODO: register skill\r\n\r\n\t\tswitch (this.type) {\r\n\t\t\tcase 1:\r\n\t\t\tcase 2:\r\n\t\t\t\tif (info.rapidAttack) {\r\n\t\t\t\t\treturn _SkillAnimation_RapidAttack;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 40:\r\n\t\t\t\tif (info.casterMove && info.avaliableInJumpingState) {\r\n\t\t\t\t\treturn _SkillAnimation_N_Jump;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn _SkillAnimation_Default;\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tget _effect_names() {\r\n\t\treturn [\"effect\", \"hit\"];\r\n\t}\r\n\t\r\n\tstatic get _base_path() {\r\n\t\treturn \"/Skill\";\r\n\t}\r\n}\r\n\r\nclass _SkillAnimation_Default extends SkillAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthrow new TypeError(\"constructor\");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_init() {\r\n\t\tthis._applyDefaultAction();\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tthis._default_update(stamp);\r\n\t}\r\n}\r\n\r\nclass _SkillAnimation_RapidAttack extends SkillAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthrow new TypeError(\"constructor\");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_init() {\r\n\t\tthis._applyDefaultAction();\r\n\r\n\t\tthis.state = \"prepare\";\r\n\t\tthis._state_func = this._prepare;\r\n\t\tthis.current_effect = this._addEffect(this.state);\r\n\r\n\t\t/** animation */\r\n\t\tthis.time = 0;\r\n\r\n\t\t/** fire bullet */\r\n\t\tthis.tick = 0;\r\n\r\n\t\tthis.fadeTotalTime = this._actani.getTotalTime();\r\n\r\n\t\tthis._crr.fixed_speed = true;\r\n\t}\r\n\r\n\t_prepare() {\r\n\t\tthis.current_effect.opacity = this.time / this.fadeTotalTime;\r\n\t\tif (this.current_effect.opacity > 1) {\r\n\t\t\tthis.current_effect.opacity = 1;\r\n\t\t}\r\n\r\n\t\tif (this._actani.isEnd()) {\r\n\t\t\tthis.current_effect.opacity = 0;//prepare\r\n\t\t\tthis.current_effect.destroy();\r\n\r\n\t\t\tthis.state = \"keydown\";\r\n\t\t\tthis._state_func = this._keydown;\r\n\t\t\tthis.current_effect = this._addEffect(this.state);\r\n\r\n\t\t\tthis._actani.loop = true;\r\n\t\t\tthis.current_effect.is_loop = true;\r\n\r\n\t\t\tthis.time = 0;//reset\r\n\t\t}\r\n\t}\r\n\t_keydown() {\r\n\t\tif (this._actani.isEnd()) {\r\n\t\t\t//this.current_effect.reset();\r\n\t\t\t//this.current_effect.opacity = 1;\r\n\t\t\t//this._actani.reset();\r\n\t\t\tthis.time = 0;//reset\r\n\t\t}\r\n\t}\r\n\t_keydownend() {\r\n\t\tthis.current_effect.opacity = 1 - (this.time / this.fadeTotalTime);\r\n\t\tif (this.current_effect.opacity < 0) {\r\n\t\t\tthis.current_effect.opacity = 0;\r\n\t\t}\r\n\r\n\t\tif (this._actani.isEnd()) {\r\n\t\t\tthis.current_effect.opacity = 0;//keydownend\r\n\t\t\tthis.current_effect.destroy();\r\n\r\n\t\t\tthis._crr.fixed_speed = false;\r\n\t\t\tthis.is_launch = true;\r\n\t\t\tthis.is_end = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * is owner can invoke skill\r\n\t * @override\r\n\t * @param {SceneCharacter} owner\r\n\t * @returns {boolean}\r\n\t */\r\n\ttest(owner) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {Partial<_ArrowKey>} inputKey - keyDown tick counter\r\n\t * @param {number} keyDown - keyDown tick counter\r\n\t * @param {number} keyUp - is keyUp\r\n\t * @returns {boolean} - cancel player default control\r\n\t */\r\n\tcontrol(inputKey, keyDown, keyUp) {\r\n\t\tswitch (this.state) {\r\n\t\t\tcase \"prepare\":\r\n\t\t\tcase \"keydown\":\r\n\t\t\t\tif (!keyDown || keyUp) {\r\n\t\t\t\t\tthis.current_effect.opacity = 0;//keydown\r\n\t\t\t\t\tthis.current_effect.destroy();\r\n\r\n\t\t\t\t\tthis.state = \"keydownend\";\r\n\t\t\t\t\tthis._state_func = this._keydownend;\r\n\t\t\t\t\tthis.current_effect = this._addEffect(this.state);\r\n\t\t\t\t\tthis.fadeTotalTime = this._actani.getTotalTime();\r\n\r\n\t\t\t\t\tthis._actani.loop = false;\r\n\t\t\t\t\tthis.time = 0;//reset\r\n\t\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\t//keydown(first step): prepare\r\n\t\t//keydown(second step): keydown + keydown0\r\n\t\t//keyup: keydownend\r\n\r\n\t\tstamp *= this._crr.getSpeed();\r\n\t\tthis.time += stamp;\r\n\r\n\t\t++this.tick;\r\n\r\n\t\tthis._state_func();\r\n\r\n\t\tif (this.tick % (window.$FIRE_BULLET_T | 3) == (window.$FIRE_BULLET_T2 | 2) && this.state != \"keydownend\") {\r\n\t\t\tthis.createBullet(\"ball\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @virtual\r\n\t */\r\n\tget _effect_names() {\r\n\t\treturn [\"prepare\", \"keydown\", \"keydownend\", \"hit\", \"ball\"];\r\n\t}\r\n}\r\n\r\nclass _SkillAnimation_N_Jump extends SkillAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthrow new TypeError(\"constructor\");\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_init() {\r\n\t\tthis.jump_max_count = (window.jump_max_count || 2);\r\n\t}\r\n\r\n\tjump2() {\r\n\t\tconst crr = this._crr;\r\n\t\t//const body = this._owner_player.$physics.body;\r\n\t\tconst foot_walk = this._owner_player.$physics.foot_walk;\r\n\r\n\t\tconst pos = this._owner_player.$physics.getPosition();\r\n\t\tconsole.log(\"pos: { x: %o, y: %o }\", pos.x, pos.y);\r\n\r\n\t\t//body.ConstantVelocityWorldCenter2((window.$NJmpX || 40) * crr.front, (window.$NJmpY || 0));\r\n\t\tfoot_walk.ConstantVelocityWorldCenter2((window.$NJmpX || 40) * crr.front, (window.$NJmpY || 0));\r\n\r\n\t\tthis._addDefaultEffect();\r\n\t}\r\n\r\n\t/**\r\n\t * is owner can invoke skill\r\n\t * @override\r\n\t * @param {SceneCharacter} owner\r\n\t * @returns {boolean}\r\n\t */\r\n\ttest(owner) {\r\n\t\tconst $physics = owner.$physics;\r\n\t\tconst state = owner.$physics.state;\r\n\t\treturn !$physics.$foothold && state.jump && state.jump_count < this.jump_max_count;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {Partial<_ArrowKey>} inputKey - keyDown tick counter\r\n\t * @param {number} keyDown - keyDown tick counter\r\n\t * @param {number} keyUp - is keyUp\r\n\t * @returns {boolean} - cancel player default control\r\n\t */\r\n\tcontrol(inputKey, keyDown, keyUp) {\r\n\t\tif (!this._owner_player) {\r\n\t\t\tdebugger;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (keyDown == 1 && this.test(this._owner_player)) {\r\n\t\t\tconst $physics = this._owner_player.$physics;\r\n\t\t\t\r\n\t\t\t$physics.state.jump_count += $physics.state.jump_count ? 1 : 2;\r\n\r\n\t\t\tthis.jump2()\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t\tconst $physics = this._owner_player.$physics;\r\n\r\n\t\tif (this._isFinishDefaultAction()) {\r\n\t\t\tthis.is_end = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif ($physics.$foothold) {\r\n\t\t\t\tthis.is_end = true;\r\n\t\t\t}\r\n\t\t\telse if (!$physics.state.jump) {\r\n\t\t\t\tthis.is_end = true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * TODO: add skill\r\n */\r\nclass __SkillAnimation_Template extends SkillAnimationBase {\r\n\t/**\r\n\t * @override\r\n\t */\r\n\t_init() {\r\n\t\tthis._applyDefaultAction();\r\n\t\t// ...\r\n\t}\r\n\r\n\t/**\r\n\t * is owner can invoke skill\r\n\t * @override\r\n\t * @param {SceneCharacter} owner\r\n\t * @returns {boolean}\r\n\t */\r\n\ttest(owner) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {Partial<_ArrowKey>} inputKey - keyDown tick counter\r\n\t * @param {number} keyDown - keyDown tick counter\r\n\t * @param {number} keyUp - is keyUp\r\n\t * @returns {boolean} - cancel player default control\r\n\t */\r\n\tcontrol(inputKey, keyDown, keyUp) {\r\n\t}\r\n\r\n\t/**\r\n\t * @override\r\n\t * @param {number} stamp\r\n\t */\r\n\tupdate(stamp) {\r\n\t}\r\n}\r\n\r\nclass SceneSkill extends SkillAnimationBase {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\t/** @type {AttackInfo} */\r\n\t\tthis.attackInfo = new _Common_AttackInfo_js__WEBPACK_IMPORTED_MODULE_10__[\"AttackInfo\"]();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} skillId\r\n\t * @param {SceneObject} owner\r\n\t */\r\n\tasync load(skillId, owner) {\r\n\t\tthis.owner = owner;\r\n\r\n\t\tif (!skillId) {\r\n\t\t\tthrow new Error(\"1 argument required\");\r\n\t\t}\r\n\t\t\r\n\t\tif (String(skillId).length <= 4) {\r\n\t\t\tthrow new Error(\"skill ID format\");\r\n\t\t}\r\n\t\t//skillId = 1120017;//1001005;// jobId + 4-digit\r\n\r\n\t\tthis.attackInfo.skillId = skillId;\r\n\t\t\r\n\t\tthis.update = this.wait_loading;\r\n\t\tthis.control = this.wait_loading;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tlet loaded_skill = SceneSkill.__loaded_skill[skillId];\r\n\t\t\tif (loaded_skill) {\r\n\t\t\t\tif (loaded_skill.$promise) {\r\n\t\t\t\t\tthis.$promise = loaded_skill.$promise;\r\n\t\t\t\t\tawait loaded_skill.$promise;\r\n\t\t\t\t\tdelete this.$promise;\r\n\t\t\t\t}\r\n\t\t\t\tthis._assign(loaded_skill);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet promise = this._load(skillId/*, owner*/);//owner ??\r\n\r\n\t\t\t\tthis.$promise = promise;\r\n\r\n\t\t\t\tSceneSkill.__loaded_skill[skillId] = this;\r\n\r\n\t\t\t\tawait promise;\r\n\r\n\t\t\t\tdelete this.$promise;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(\"can not load skill: %o, owner: %o\", skillId, owner);\r\n\t\t\tdelete this.$promise;\r\n\t\t\tthis.update = this.__load_failed;//debug\r\n\t\t\tthis.control = this.__load_failed;//debug\r\n\t\t\t//delete SceneSkill.__loaded_skill[skillId];//try reload\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t\t\r\n\t\tdelete this.update;\r\n\t\tdelete this.control;\r\n\t}\r\n\t\r\n\twait_loading() {\r\n\t}\r\n\t\r\n\t/**\r\n\t * debug\r\n\t */\r\n\t__load_failed() {\r\n\t}\r\n\t\r\n\t/**\r\n\t * @param {string} skillId\r\n\t * @returns {SceneSkill}\r\n\t */\r\n\tstatic preload(skillId) {\r\n\t\ttry {\r\n\t\t\tlet loaded_skill = SceneSkill.__loaded_skill[skillId];\r\n\t\t\tif (loaded_skill) {\r\n\t\t\t\treturn loaded_skill;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet skill = new SceneSkill();\r\n\t\t\t\t\r\n\t\t\t\tskill.load(skillId, \"static preload no owner\");\r\n\t\t\t\t\r\n\t\t\t\treturn skill;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (ex) {\r\n\t\t\tconsole.error(\"can not preload skill: %o\", skillId);\r\n\t\t\tthrow ex;\r\n\t\t}\r\n\t}\r\n}\r\nSceneSkill.__loaded_skill = {};\r\n\r\nwindow.$SceneSkill = SceneSkill;\r\n\r\nclass _ArrowKey {\r\n\tconstructor() {\r\n\t\tthis.left = 0;\r\n\t\tthis.up = 0;\r\n\t\tthis.right = 0;\r\n\t\tthis.down = 0;\r\n\t}\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvZ2FtZS9Ta2lsbC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9nYW1lL1NraWxsLmpzPzQwMzQiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IElSZW5kZXJlciB9IGZyb20gXCIuL0lSZW5kZXJlci5qc1wiO1xyXG5pbXBvcnQgeyBTcHJpdGUgfSBmcm9tIFwiLi9TcHJpdGUuanNcIjtcclxuaW1wb3J0IHsgQW5pbWF0aW9uIH0gZnJvbSBcIi4vQW5pbWF0aW9uXCI7XHJcbmltcG9ydCB7IFNjZW5lT2JqZWN0IH0gZnJvbSBcIi4vU2NlbmVPYmplY3RcIjtcclxuaW1wb3J0IHsgQWN0aW9uQW5pbWF0aW9uIH0gZnJvbSAnLi9SZW5kZXJlci9DaGFyYWN0ZXJBY3Rpb25BbmltYXRpb24uanMnO1xyXG5pbXBvcnQgeyBDaGFyYWN0ZXJBbmltYXRpb25CYXNlIH0gZnJvbSBcIi4vUmVuZGVyZXIvQ2hhcmFjdGVyUmVuZGVyZXIuanNcIjtcclxuaW1wb3J0IHsgUFBsYXllciB9IGZyb20gXCIuL1BoeXNpY3MvUFBsYXllci5qc1wiO1xyXG5pbXBvcnQgeyBTY2VuZUNoYXJhY3RlciB9IGZyb20gXCIuL1NjZW5lQ2hhcmFjdGVyLmpzXCI7XHJcbmltcG9ydCB7IFdvcmxkIH0gZnJvbSBcIi4vUGh5c2ljcy9Xb3JsZC5qc1wiO1xyXG5pbXBvcnQgeyBQQnVsbGV0IH0gZnJvbSBcIi4vUGh5c2ljcy9QQnVsbGV0LmpzXCI7XHJcbmltcG9ydCB7IEF0dGFja0luZm8sIEF0dGFja1BhaXIgfSBmcm9tIFwiLi4vQ29tbW9uL0F0dGFja0luZm8uanNcIjtcclxuXHJcbmltcG9ydCB7IFZlYzIgfSBmcm9tIFwiLi9tYXRoLmpzXCI7Ly9kZXZcclxuXHJcblxyXG4vLyBza2lsbCB0aW1lbGluZVxyXG4vL1xyXG4vLyDku6UgQWN0aW9uQW5pbWF0aW9uIOaOp+WItua1geeoi1xyXG4vLyBza2lsbCDlv4XpoIjopoHmnIkgQWN0aW9uQW5pbWF0aW9uIOaJjeiDveato+eiuumBi+S9nCjplovlp4vjgIHntZDmnZ8pXHJcbi8vXHJcbi8vICMgbm9ybWFsIHNraWxsXHJcbi8vIC1kZWxheTEgICAgICAgIHwgZGVsYXkyXHJcbi8vIF9pbml0ICAgICAgICAgIHwgdXBkYXRlXHJcbi8vIGRlZmF1bHRBY3Rpb24gIHwgd2FpdCBjdXJyZW50X2FjdGlvbiBlbmRcclxuLy8gICAgICAgICAgICAgICAgfCBTa2lsbEVmZmVjdFxyXG4vL1xyXG4vLyAjIHJhcGlkIHNraWxsXHJcbi8vIGRlbGF5MSAgICAgIHwgZGVsYXkyICAgICAgICAgfCBkZWxheTNcclxuLy8gX2luaXQgICAgICAgfCBjb250cm9sL3VwZGF0ZSB8IHVwZGF0ZVxyXG4vLyBwcmVwYXJlICAgICB8IGxvb3AgICAgICAgICAgIHwgZW5kXHJcbi8vIFNraWxsRWZmZWN0IHwgU2tpbGxFZmZlY3QgICAgfCBTa2lsbEVmZmVjdFxyXG5cclxuXHJcbi8qKlxyXG4gKiAyMzAwMTAwMijol53ooZPot7Pouo0pXHJcbiAqIDI0MDAxMDAyKOW5u+W9seeerOatpSlcclxuICovXHJcbmxldCBqdW1wMl9pbmZvID0ge1xyXG5cdHR5cGU6IDQwLFxyXG5cdGNhc3Rlck1vdmU6IDEsXHJcblx0YXZhbGlhYmxlSW5KdW1waW5nU3RhdGU6IDFcclxufTtcclxuXHJcbi8qKlxyXG4gKiAyMzEyMTAwMCjkvIrkv67loZTniL7kuYvnkrApOiBsb2NhbGhvc3QveG1sMi9Ta2lsbC8yMzEyL3NraWxsLzIzMTIxMDAwXHJcbiAqL1xyXG5sZXQgcmFwaWRfYXR0YWNrX2luZm8gPSB7XHJcblx0dHlwZTogMixcclxuXHRrbm9ja2JhY2tMaW1pdDogODAsXHJcblx0cmFwaWRBdHRhY2s6IDFcclxufTtcclxuXHJcblxyXG5jbGFzcyBfU2tpbGxJbmZvIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHRoaXMudHlwZSA9IDQwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuY2FzdGVyTW92ZSA9IDE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5hdmFsaWFibGVJbkp1bXBpbmdTdGF0ZSA9IDE7XHJcblxyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMuYXJlYUF0dGFjayA9IDE7XHJcblxyXG5cdFx0dGhpcy5rbm9ja2JhY2tMaW1pdCA9IDgwO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi9cclxuXHRcdHRoaXMucmFwaWRBdHRhY2sgPSAxO1xyXG5cdH1cclxufVxyXG5jbGFzcyBfU2tpbGxDb21tb25EYXRhIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdC8qKiBAdHlwZSB7VmVjMn0gKi9cclxuXHRcdHRoaXMubHQgPSBudWxsOy8vbmV3IFZlYzIoLTIwMCwgLTExMylcclxuXHJcblx0XHQvKiogQHR5cGUge1ZlYzJ9ICovXHJcblx0XHR0aGlzLnJiID0gbnVsbDsvL25ldyBWZWMyKC0xMCwgMClcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBjb2RlICovXHJcblx0XHR0aGlzLm1wQ29uID0gXCIzICsgZCh4IC8gNilcIjtcclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gLSBjb2RlICovXHJcblx0XHR0aGlzLmRhbWFnZSA9IFwiMTc1ICsgOCAqIHhcIjtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMubW9iQ291bnQgPSA2O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5hdHRhY2tDb3VudCA9IDE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLm1heExldmVsID0gMjA7XHJcblx0fVxyXG59XHJcbmNsYXNzIF9Ta2lsbERhdGEge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0LyoqIEB0eXBlIHt7IFthY3RUeXBlOiBudW1iZXJdOiBzdHJpbmcgfX0gKi9cclxuXHRcdHRoaXMuYWN0aW9uID0ge1xyXG5cdFx0XHRcIjBcIjogXCJkdWFsVnVsY2FuTG9vcFwiXHJcblx0XHR9O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7X1NraWxsQ29tbW9uRGF0YX0gKi9cclxuXHRcdHRoaXMuY29tbW9uID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge19Ta2lsbEluZm99ICovXHJcblx0XHR0aGlzLmluZm8gPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7U2tpbGxFZmZlY3RBbmltYXRpb259IC0gPyB0eXBlICovXHJcblx0XHR0aGlzLmVmZmVjdCA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTa2lsbEVmZmVjdEFuaW1hdGlvbn0gLSA/IHR5cGUgKi9cclxuXHRcdHRoaXMucHJlcGFyZSA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTa2lsbEVmZmVjdEFuaW1hdGlvbn0gLSA/IHR5cGUgKi9cclxuXHRcdHRoaXMua2V5ZG93biA9IG51bGw7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtTa2lsbEVmZmVjdEFuaW1hdGlvbn0gLSA/IHR5cGUgKi9cclxuXHRcdHRoaXMua2V5ZG93bjAgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7U2tpbGxFZmZlY3RBbmltYXRpb259IC0gPyB0eXBlICovXHJcblx0XHR0aGlzLmtleWRvd25lbmQgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e1tza2lsbF9pZDpzdHJpbmddOntbdHlwZTpudW1iZXJdOm51bWJlcn19fSAqL1xyXG5cdFx0dGhpcy5maW5hbEF0dGFjayA9IHtcclxuXHRcdFx0XCIyMzEwMDAwNlwiOiB7XHJcblx0XHRcdFx0XCIwXCI6IDUyXHJcblx0XHRcdH1cclxuXHRcdH07XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLm1hc3RlckxldmVsID0gMTA7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLmNvbWJhdE9yZGVycyA9IDE7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9ICovXHJcblx0XHR0aGlzLndlYXBvbiA9IDUyO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7bnVtYmVyfSAqL1xyXG5cdFx0dGhpcy5zdWJXZWFwb24gPSAzNTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMucHNkID0gMTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gLSA/PyAqL1xyXG5cdFx0dGhpcy5wc2RTa2lsbCA9IHtcclxuXHRcdFx0MjMxMTEwMDI6IHt9XHJcblx0XHR9O1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7e1tza2lsbF9pZDpzdHJpbmddOm51bWJlcn19ICovXHJcblx0XHR0aGlzLnJlcSA9IHtcclxuXHRcdFx0XCIyMzExMTAwMFwiOiAyMFxyXG5cdFx0fTtcclxuXHJcblx0XHQvKiogQHR5cGUge251bWJlcn0gKi9cclxuXHRcdHRoaXMuY2FuSm9iUmlkaW5nVXNlID0gMTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIFNraWxsRWZmZWN0QW5pbWF0aW9uIGV4dGVuZHMgQW5pbWF0aW9uIHtcclxuXHRjb25zdHJ1Y3RvcihyYXcvKiwgdXJsKi8pIHtcclxuXHRcdHN1cGVyKHJhdy8qLCB1cmwqLyk7XHJcblx0XHR0aGlzLnggPSAwO1xyXG5cdFx0dGhpcy55ID0gMDtcclxuXHJcblx0XHQvKiogQHR5cGUge3t4OiBudW1iZXIsIHk6IG51bWJlciwgZnJvbnQ6LTF8MX19ICovXHJcblx0XHR0aGlzLnRhcmdldFJlbmRlcmVyID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge1BCdWxsZXR9ICovXHJcblx0XHR0aGlzLiRwaHlzaWNzID0gbnVsbDtcclxuXHJcblx0XHR0aGlzLmlzX2xvb3AgPSBmYWxzZTtcclxuXHJcblx0XHR0aGlzLm9wYWNpdHkgPSAxO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ3xudW1iZXJ9IHR5cGUgLSA/P1xyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSB1cmwgLSA/P1xyXG5cdCAqIEBwYXJhbSB7b2JqZWN0fSByYXcgLSA/P1xyXG5cdCAqL1xyXG5cdGxvYWQodHlwZSkge1xyXG5cdFx0aWYgKCF0aGlzLl9yYXcpIHtcclxuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcInJhd1wiKTtcclxuXHRcdFx0Ly90aGlzLl91cmwgPSBbdGhpcy5fdXJsLCB0eXBlXS5qb2luKFwiL1wiKTtcclxuXHRcdFx0Ly9yZXR1cm4gc3VwZXIubG9hZCgpO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmIChBcnJheS5pc0FycmF5KHRoaXMuX3Jhd1t0eXBlXSkpIHtcclxuXHRcdFx0XHQvKiogQHR5cGUge1Nwcml0ZVtdfSAqL1xyXG5cdFx0XHRcdHRoaXMudGV4dHVyZXMgPSB0aGlzLl9yYXdbdHlwZV07XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0LyoqIEB0eXBlIHtTcHJpdGVbXX0gKi9cclxuXHRcdFx0XHR0aGlzLnRleHR1cmVzID0gdGhpcy5fcmF3O1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XHJcblx0XHRcdFx0aWYgKCEodGhpcy50ZXh0dXJlc1swXSBpbnN0YW5jZW9mIFNwcml0ZSkpIHtcclxuXHRcdFx0XHRcdHRocm93IG5ldyBUeXBlRXJyb3IoKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdGRlc3Ryb3koKSB7XHJcblx0XHRzdXBlci5kZXN0cm95KCk7XHJcblxyXG5cdFx0dGhpcy4kcGh5c2ljcyA9IG51bGw7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdGlmICh0aGlzLiRwaHlzaWNzKSB7XHJcblx0XHRcdHRoaXMudXBkYXRlX3Aoc3RhbXApO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSBpZiAodGhpcy50YXJnZXRSZW5kZXJlcikge1xyXG5cdFx0XHR0aGlzLnVwZGF0ZV9yKHN0YW1wKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHJlbmRlcihyZW5kZXJlcikge1xyXG5cdFx0aWYgKHRoaXMuJHBoeXNpY3MpIHtcclxuXHRcdFx0dGhpcy5yZW5kZXJfcChyZW5kZXJlcik7XHJcblx0XHR9XHJcblx0XHRlbHNlIGlmICh0aGlzLnRhcmdldFJlbmRlcmVyKSB7XHJcblx0XHRcdHRoaXMucmVuZGVyX3IocmVuZGVyZXIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGVfcChzdGFtcCkge1xyXG5cdFx0c3VwZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHJlbmRlcl9wKHJlbmRlcmVyKSB7XHJcblx0XHRjb25zdCBwb3MgPSB0aGlzLiRwaHlzaWNzLmdldFBvc2l0aW9uKCk7XHJcblx0XHRjb25zdCBmcm9udCA9IHRoaXMuJHBoeXNpY3MuZnJvbnQ7XHJcblx0XHRjb25zdCB4ID0gcG9zLnggKiAkZ3YuQ0FOVkFTX1NDQUxFO1xyXG5cdFx0Y29uc3QgeSA9IHBvcy55ICogJGd2LkNBTlZBU19TQ0FMRTtcclxuXHJcblx0XHR0aGlzLnggPSB4O1xyXG5cdFx0dGhpcy55ID0geTtcclxuXHJcblx0XHQvL3JlbmRlcmVyLnB1c2hHbG9iYWxBbHBoYSgpO1xyXG5cclxuXHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gdGhpcy5vcGFjaXR5O1xyXG5cdFx0dGhpcy5kcmF3KHJlbmRlcmVyLCB4LCB5LCAwLCBmcm9udCA+IDApO1xyXG5cclxuXHRcdC8vcmVuZGVyZXIucG9wR2xvYmFsQWxwaGEoKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICovXHJcblx0dXBkYXRlX3Ioc3RhbXApIHtcclxuXHRcdHN0YW1wICo9IHRoaXMudGFyZ2V0UmVuZGVyZXIuZ2V0U3BlZWQoKTtcclxuXHRcdFxyXG5cdFx0c3VwZXIudXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtJUmVuZGVyZXJ9IHJlbmRlcmVyXHJcblx0ICovXHJcblx0cmVuZGVyX3IocmVuZGVyZXIpIHtcclxuXHRcdHRoaXMueCA9IHRoaXMudGFyZ2V0UmVuZGVyZXIueCArIHRoaXMudGFyZ2V0UmVuZGVyZXIudHg7Ly9UT0RPOiBjcnIudHggYW5kIGNyci50eSA/P1xyXG5cdFx0dGhpcy55ID0gdGhpcy50YXJnZXRSZW5kZXJlci55ICsgdGhpcy50YXJnZXRSZW5kZXJlci50eTtcclxuXHJcblx0XHQvL3JlbmRlcmVyLnB1c2hHbG9iYWxBbHBoYSgpO1xyXG5cclxuXHRcdHJlbmRlcmVyLmdsb2JhbEFscGhhID0gdGhpcy5vcGFjaXR5O1xyXG5cdFx0dGhpcy5kcmF3KHJlbmRlcmVyLCB0aGlzLngsIHRoaXMueSwgMCwgdGhpcy50YXJnZXRSZW5kZXJlci5mcm9udCA+IDApO1xyXG5cclxuXHRcdC8vcmVuZGVyZXIucG9wR2xvYmFsQWxwaGEoKTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIFNraWxsSGl0QW5pbWF0aW9uIGV4dGVuZHMgU2tpbGxFZmZlY3RBbmltYXRpb24ge1xyXG5cdGNvbnN0cnVjdG9yKHJhdywgdXJsKSB7XHJcblx0XHRzdXBlcihyYXcsIHVybCk7XHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBUT0RPOiBTY2VuZU9iamVjdCDlj5bku6MgRWZmZWN0TWFuYWdlclxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIEVmZmVjdE1hbmFnZXIge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdH1cclxuXHRcclxuXHRzdGF0aWMgQWRkRWZmZWN0KGVmZmVjdCkge1xyXG5cdFx0ZWZmZWN0LnVwZGF0ZSgwKTsvL2luaXQgZWZmZWN0IHBvc2l0aW9uXHJcblx0XHRcclxuXHRcdEVmZmVjdE1hbmFnZXIuX2VmZmVjdHMucHVzaChlZmZlY3QpO1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHRzdGF0aWMgVXBkYXRlKHN0YW1wKSB7XHJcblx0XHRjb25zdCBlZmZlY3RzID0gRWZmZWN0TWFuYWdlci5fZWZmZWN0cztcclxuXHRcdFxyXG5cdFx0RWZmZWN0TWFuYWdlci5fZWZmZWN0cyA9IGVmZmVjdHMuZmlsdGVyKGZ1bmN0aW9uIChlZmYpIHtcclxuXHRcdFx0aWYgKCFlZmYuaXNFbmQoKSkge1xyXG5cdFx0XHRcdGVmZi51cGRhdGUoc3RhbXApO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmIChlZmYuaXNFbmQoKSkge1xyXG5cdFx0XHRcdGVmZi5kZXN0cm95KCk7XHJcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0XHR9XHJcblx0XHRcdHJldHVybiB0cnVlO1xyXG5cdFx0fSk7XHJcblx0fVxyXG5cdFxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7SVJlbmRlcmVyfSByZW5kZXJlclxyXG5cdCAqL1xyXG5cdHN0YXRpYyBSZW5kZXIocmVuZGVyZXIpIHtcclxuXHRcdHJlbmRlcmVyLnB1c2hHbG9iYWxBbHBoYSgpO1xyXG5cclxuXHRcdGNvbnN0IGVmZmVjdHMgPSBFZmZlY3RNYW5hZ2VyLl9lZmZlY3RzO1xyXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBlZmZlY3RzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdGVmZmVjdHNbaV0ucmVuZGVyKHJlbmRlcmVyKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZW5kZXJlci5wb3BHbG9iYWxBbHBoYSgpO1xyXG5cdH1cclxufVxyXG4vKiogQHR5cGUge0FuaW1hdGlvbltdfSAqL1xyXG5FZmZlY3RNYW5hZ2VyLl9lZmZlY3RzID0gW107XHJcblxyXG53aW5kb3cuJEVmZmVjdE1hbmFnZXIgPSBFZmZlY3RNYW5hZ2VyO1xyXG5cclxuXHJcblxyXG4vKipcclxuICogXHJcbiAqL1xyXG5jbGFzcyBTa2lsbEFuaW1hdGlvbkJhc2Uge1xyXG5cdC8vLyoqXHJcblx0Ly8gKiBAcGFyYW0ge29iamVjdH0gcmF3XHJcblx0Ly8gKiBAcGFyYW0ge3N0cmluZ30gdXJsXHJcblx0Ly8gKi9cclxuXHRjb25zdHJ1Y3RvcigvKnJhdywgdXJsKi8pIHtcclxuXHRcdC8vdGhpcy5fcmF3ID0gcmF3O1xyXG5cclxuXHRcdC8qKlxyXG5cdFx0ICogQHR5cGUge19Ta2lsbERhdGF9XHJcblx0XHQgKi9cclxuXHRcdHRoaXMuZGF0YSA9IG51bGw7XHJcblx0XHRcclxuXHRcdC8qKiBAdHlwZSB7c3RyaW5nfSAqL1xyXG5cdFx0dGhpcy51cmwgPSBudWxsO1xyXG5cdFx0XHJcblx0XHQvL3RoaXMudGV4dHVyZXMgPSB7XHJcblx0XHQvL1x0ZWZmZWN0OiBbXSxcclxuXHRcdC8vXHRoaXQ6IHtcclxuXHRcdC8vXHRcdFwiMFwiOiBbXVxyXG5cdFx0Ly9cdH0sXHJcblx0XHQvL31cclxuXHJcblx0XHQvKiogQHR5cGUge3N0cmluZ30gKi9cclxuXHRcdHRoaXMuc2tpbGxJZCA9IG51bGw7XHJcblxyXG5cdFx0LyoqXHJcblx0XHQgKiBhY3RUeXBlID0gR2V0Sm9iSW5mbyhjaGFyYSkuYXZhbGlhYmxlV2VhcG9uLmluZGV4T2YoSXRlbUluZm8uZ2V0KGNoYXJhLndlYXBvbikudHlwZSlcclxuXHRcdCAqL1xyXG5cdFx0dGhpcy5hY3RUeXBlID0gMDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtTY2VuZU9iamVjdH0gKi9cclxuXHRcdHRoaXMuX293bmVyID0gbnVsbDtcclxuXHJcblx0XHQvKiogQHR5cGUge0NoYXJhY3RlckFuaW1hdGlvbkJhc2V9ICovXHJcblx0XHR0aGlzLl9jcnIgPSBudWxsO1xyXG5cclxuXHRcdC8qKiBAdHlwZSB7QWN0aW9uQW5pbWF0aW9ufSAqL1xyXG5cdFx0dGhpcy5fYWN0YW5pID0gbnVsbDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtudW1iZXJ9IC0gc2tpbGwgdHlwZSAqL1xyXG5cdFx0dGhpcy50eXBlID0gMDtcclxuXHRcdFxyXG5cdFx0LyoqIEB0eXBlIHtib29sZWFufSAqL1xyXG5cdFx0dGhpcy5fJGlzX2VuZCA9IGZhbHNlO1xyXG5cdFx0XHJcblx0XHQvKiogQHR5cGUge2Jvb2xlYW59ICovXHJcblx0XHR0aGlzLmlzX2xhdW5jaCA9IGZhbHNlO1xyXG5cdFx0XHJcblx0XHQvL2lmIChyYXcgJiYgdXJsKSB7XHJcblx0XHQvL1x0dGhpcy5fX2xvYWQodXJsLCByYXcsIG51bGwpO1xyXG5cdFx0Ly99XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtcInByZXBhcmVcInxcImtleWRvd25cInxcImtleWRvd25lbmRcIn0gKi9cclxuXHRcdHRoaXMuc3RhdGUgPSBudWxsO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHRfaW5pdCgpIHtcclxuXHRcdHRoaXMuX2FwcGx5RGVmYXVsdEFjdGlvbigpO1xyXG5cdH1cclxuXHJcblx0Z2V0IGlzX2VuZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLl8kaXNfZW5kO1xyXG5cdH1cclxuXHRzZXQgaXNfZW5kKHZhbHVlKSB7XHJcblx0XHR0aGlzLl8kaXNfZW5kID0gdmFsdWU7XHJcblx0XHRpZiAodmFsdWUpIHtcclxuXHRcdFx0dGhpcy5vd25lci4kcGh5c2ljcy5zdGF0ZS5pbnZva2VTa2lsbCA9IGZhbHNlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqIEB0eXBlIHtTY2VuZU9iamVjdH0gKi9cclxuXHRnZXQgb3duZXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fb3duZXI7XHJcblx0fVxyXG5cdHNldCBvd25lcih2YWx1ZSkge1xyXG5cdFx0aWYgKCF2YWx1ZSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0XHR0aGlzLl9vd25lciA9IHZhbHVlO1xyXG5cclxuXHRcdHRoaXMuX2NyciA9IHZhbHVlLnJlbmRlcmVyO1xyXG5cdFx0aWYgKCF0aGlzLl9jcnIpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vY29uc3QgY2hhcmEgPSB2YWx1ZTsgLy8/P1xyXG5cdFx0Ly90aGlzLmFjdFR5cGUgPSBHZXRKb2JJbmZvKGNoYXJhKS5hdmFsaWFibGVXZWFwb24uaW5kZXhPZihJdGVtSW5mby5nZXQoY2hhcmEud2VhcG9uKS50eXBlKVxyXG5cclxuXHRcdHRoaXMuX2FjdGFuaSA9IHRoaXMuX2Nyci5hY3Rhbmk7XHJcblx0XHRpZiAoIXRoaXMuX2FjdGFuaSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiByZXR1cm4gdGhpcy5fb3duZXIgYXMgU2NlbmVDaGFyYWN0ZXJcclxuXHQgKiBAYWxpYXMgb3duZXJcclxuXHQgKiBAcmV0dXJucyB7U2NlbmVDaGFyYWN0ZXJ9XHJcblx0ICovXHJcblx0Z2V0IF9vd25lcl9wbGF5ZXIoKSB7XHJcblx0XHRyZXR1cm4gdGhpcy5fb3duZXI7XHJcblx0fVxyXG5cdHNldCBfb3duZXJfcGxheWVyKHZhbHVlKSB7XHJcblx0XHR0aGlzLm93bmVyID0gdmFsdWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICovXHJcblx0X2FwcGx5QWN0aW9uKGFjdGlvbikge1xyXG5cdFx0aWYgKHRoaXMuX2FjdGFuaSAmJiB0aGlzLmRhdGEpIHtcclxuXHRcdFx0Y29uc3QgYWN0aW9ucyA9IHRoaXMuZGF0YS5hY3Rpb247XHJcblx0XHRcdHRoaXMuX2FjdGFuaS5yZWxvYWQoYWN0aW9uKTsvL2FjdGlvbiA/IDAsIDFcclxuXHRcdFx0dGhpcy5fYWN0YW5pLmxvb3AgPSBmYWxzZTtcclxuXHRcdFx0XHJcblx0XHRcdHRoaXMub3duZXIuJHBoeXNpY3Muc3RhdGUuaW52b2tlU2tpbGwgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge3N0cmluZ31cclxuXHQgKi9cclxuXHRfZ2V0RGVmYXVsdEFjdGlvbigpIHtcclxuXHRcdGNvbnN0IGFjdGlvbnMgPSB0aGlzLmRhdGEuYWN0aW9uO1xyXG5cdFx0cmV0dXJuIGFjdGlvbnNbdGhpcy5hY3RUeXBlXTtcclxuXHR9XHJcblxyXG5cdC8qKiBza2lsbCBkZWZhdWx0IGFjdGlvbiAqL1xyXG5cdF9hcHBseURlZmF1bHRBY3Rpb24oKSB7XHJcblx0XHR0aGlzLl9hcHBseUFjdGlvbih0aGlzLl9nZXREZWZhdWx0QWN0aW9uKCkpO1xyXG5cdH1cclxuXHJcblx0X2lzRmluaXNoRGVmYXVsdEFjdGlvbigpIHtcclxuXHRcdGNvbnN0IGFjdCA9IHRoaXMuX2dldERlZmF1bHRBY3Rpb24oKTtcclxuXHRcdGlmICh0aGlzLl9hY3RhbmkpIHtcclxuXHRcdFx0cmV0dXJuIHRoaXMuX2FjdGFuaS5fYWN0aW9uICE9IGFjdDtcclxuXHRcdH1cclxuXHRcdGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGRvd25sb2FkIGRhdGEsIGxvYWQgdGV4dHVyZVxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2lsbElkXHJcblx0ICovXHJcblx0YXN5bmMgX2xvYWQoc2tpbGxJZCkge1xyXG5cdFx0Y29uc3Qgam9iSUQgPSAvXihcXGQrKVxcZHs0fSQvLmV4ZWMoc2tpbGxJZClbMV07XHJcblxyXG5cdFx0Y29uc3QgdXJsID0gYCR7dGhpcy5jb25zdHJ1Y3Rvci5fYmFzZV9wYXRofS8ke2pvYklEfS9za2lsbC8ke3NraWxsSWR9YDtcclxuXHJcblx0XHRsZXQgcmF3O1xyXG5cdFx0dHJ5IHtcclxuXHRcdFx0cmF3ID0gYXdhaXQgJGdldC5kYXRhKHVybCk7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdFx0dGhyb3cgZXg7XHJcblx0XHR9XHJcblx0XHRpZiAoIXJhdykge1xyXG5cdFx0XHRhbGVydChcIlNraWxsQW5pbWF0aW9uQmFzZVwiKTtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cdFx0dGhpcy5kYXRhID0gcmF3O1xyXG5cdFx0XHJcblx0XHR0aGlzLnVybCA9IHVybDtcclxuXHJcblx0XHR0aGlzLnNraWxsSWQgPSBza2lsbElkO1xyXG5cclxuXHRcdHRoaXMudHlwZSA9IHRoaXMuZGF0YS5pbmZvID8gKHRoaXMuZGF0YS5pbmZvLnR5cGUgfHwgMCkgOiAwOy8vY29uc3RcclxuXHJcblx0XHR0aGlzLl9fcHJvdG9fXyA9IHRoaXMuX2RlY2lkZV90eXBlKCkucHJvdG90eXBlO1xyXG5cdFx0e1xyXG5cdFx0XHR0aGlzLl9sb2FkVGV4dHVyZShyYXcpO1xyXG5cclxuXHRcdFx0dGhpcy5faW5pdCgpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBjb3B5XHJcblx0ICogQHBhcmFtIHtTa2lsbEFuaW1hdGlvbkJhc2V9IHNraWxsX2FuaW1cclxuXHQgKiBAcGFyYW0ge1NraWxsQW5pbWF0aW9uQmFzZX0gcHJvdG8gLSBza2lsbCBwcm90b3R5cGVcclxuXHQgKi9cclxuXHRfYXNzaWduKHNraWxsX2FuaW0sIHByb3RvKSB7XHJcblx0XHR0aGlzLmRhdGEgPSBza2lsbF9hbmltLmRhdGE7XHJcblx0XHRcclxuXHRcdHRoaXMudXJsID0gc2tpbGxfYW5pbS51cmw7XHJcblxyXG5cdFx0dGhpcy5za2lsbElkID0gc2tpbGxfYW5pbS5za2lsbElkO1xyXG5cdFx0XHJcblx0XHR0aGlzLnR5cGUgPSBza2lsbF9hbmltLnR5cGU7Ly9jb25zdFxyXG5cclxuXHRcdHRoaXMuX19wcm90b19fID0gdGhpcy5fZGVjaWRlX3R5cGUoKS5wcm90b3R5cGU7XHJcblx0XHR7XHJcblx0XHRcdHRoaXMuX2luaXQoKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0X2xvYWRUZXh0dXJlKCkge1xyXG5cdFx0Zm9yIChsZXQgZWZmTmFtZSBvZiB0aGlzLl9lZmZlY3RfbmFtZXMpIHtcclxuXHRcdFx0bGV0IGVmZiA9IHRoaXMuZGF0YVtlZmZOYW1lXTtcclxuXHRcdFx0aWYgKGVmZikge1xyXG5cdFx0XHRcdHRoaXMuZGF0YVtlZmZOYW1lXSA9IGFyck5kX3RleHR1cmUoZWZmLyosIFt0aGlzLnVybCwgZWZmTmFtZV0uam9pbihcIi9cIikqLyk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gYXJyTmRfdGV4dHVyZShhcnJOZC8qLCB1cmwqLykge1xyXG5cdFx0XHRpZiAoXCIwXCIgaW4gYXJyTmRbMF0pIHtcclxuXHRcdFx0XHRyZXR1cm4gYXJyMmRfdGV4dHVyZShhcnJOZC8qLCB1cmwqLyk7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0cmV0dXJuIGFycjFkX3RleHR1cmUoYXJyTmQvKiwgdXJsKi8pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHRmdW5jdGlvbiBhcnIxZF90ZXh0dXJlKGFycjFkLyosIHVybCovKSB7XHJcblx0XHRcdGxldCBlZmZlY3QgPSBbXTtcclxuXHRcdFx0Zm9yIChsZXQgIGkgPSAwOyBpIGluIGFycjFkOyArK2kpIHtcclxuXHRcdFx0XHRsZXQgZGF0YSA9IGFycjFkW2ldO1xyXG5cdFx0XHRcdGxldCB0ZXggPSBuZXcgU3ByaXRlKGRhdGEpO1xyXG5cdFx0XHRcdC8vdGV4Ll91cmwgPSBgJHt1cmx9LyR7aX1gO1xyXG5cdFx0XHRcdGVmZmVjdFtpXSA9IHRleDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlZmZlY3QuYWN0aW9uID0gYXJyMWQuYWN0aW9uO1xyXG5cdFx0XHRyZXR1cm4gZWZmZWN0O1xyXG5cdFx0fVxyXG5cdFx0ZnVuY3Rpb24gYXJyMmRfdGV4dHVyZShhcnIyZC8qLCB1cmwqLykge1xyXG5cdFx0XHRsZXQgaGl0ID0gW107XHJcblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIGluIGFycjJkOyArK2kpIHtcclxuXHRcdFx0XHQvL2NvbnN0IHVybF9pID0gYCR7dXJsfS8ke2l9YDtcclxuXHRcdFx0XHRsZXQgZ3JvdXAgPSBhcnIyZFtpXTtcclxuXHRcdFx0XHRoaXRbaV0gPSBbXTtcclxuXHRcdFx0XHRmb3IgKGxldCAgaiA9IDA7IGogaW4gZ3JvdXA7ICsraikge1xyXG5cdFx0XHRcdFx0bGV0IGRhdGEgPSBncm91cFtqXTtcclxuXHRcdFx0XHRcdGxldCB0ZXggPSBuZXcgU3ByaXRlKGRhdGEpO1xyXG5cdFx0XHRcdFx0Ly90ZXguX3VybCA9IGAke3VybF9pfS8ke2p9YDtcclxuXHRcdFx0XHRcdGhpdFtpXVtqXSA9IHRleDtcclxuXHRcdFx0XHR9XHJcblx0XHRcdFx0aGl0W2ldLmFjdGlvbiA9IGdyb3VwLmFjdGlvbjtcclxuXHRcdFx0fVxyXG5cdFx0XHRyZXR1cm4gaGl0O1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogcmVzZXQgYW5kIHJlc3RhcnRcclxuXHQgKi9cclxuXHRyZXNldCgpIHtcclxuXHRcdHRoaXMuX2FjdGFuaS5yZXNldCgpO1xyXG5cdFx0dGhpcy5pc19sYXVuY2ggPSBmYWxzZTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGlzIG93bmVyIGNhbiBpbnZva2Ugc2tpbGxcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7U2NlbmVDaGFyYWN0ZXJ9IG93bmVyXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59XHJcblx0ICovXHJcblx0dGVzdChvd25lcikge1xyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBvbktleWRvd24gKyBvbktleXVwXHJcblx0ICogVE9ETzog5Y+v5o6n5Yi25pa55ZCR55qE5oqA6IO9XHJcblx0ICogQHZpcnR1YWxcclxuXHQgKiBAcGFyYW0ge1BhcnRpYWw8X0Fycm93S2V5Pn0gaW5wdXRLZXkgLSBrZXlEb3duIHRpY2sgY291bnRlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBrZXlEb3duIC0ga2V5RG93biB0aWNrIGNvdW50ZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0ga2V5VXAgLSBpcyBrZXlVcFxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufSAtIGNhbmNlbCBwbGF5ZXIgZGVmYXVsdCBjb250cm9sXHJcblx0ICovXHJcblx0Y29udHJvbChpbnB1dEtleSwga2V5RG93biwga2V5VXApIHtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogVE9ETzog6Ieq5YuV5pS75pOK44CB6KKr5YuV5oqA6IO944CBZGVidWZcclxuXHQgKiBAdmlydHVhbFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0aWYgKHRoaXMuJHByb21pc2UpIHtcclxuXHRcdFx0Ly9Ob3cgbG9hZGluZy4uLlxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuaXNfbGF1bmNoID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5pc19lbmQgPSB0cnVlO1xyXG5cdFx0XHRjb25zb2xlLndhcm4oXCJTa2lsbCBub3QgaW1wbGVtZW50OiBcIiArIHRoaXMuc2tpbGxJZCk7XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBubyB0aW1lclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdF9kZWZhdWx0X3VwZGF0ZShzdGFtcCkge1xyXG5cdFx0Ly9zdGFtcCAqPSB0aGlzLnRhcmdldFJlbmRlcmVyLmdldFNwZWVkKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMuX2FjdGFuaSkge1xyXG5cdFx0XHRpZiAodGhpcy5fYWN0YW5pLmRlbGF5KSB7Ly8gbm90IHN0YXJ0IHlldFxyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIGlmICghdGhpcy5pc19sYXVuY2gpIHtcclxuXHRcdFx0XHR0aGlzLl9hZGRFZmZlY3QoKTtcclxuXHJcblx0XHRcdFx0dGhpcy5pc19sYXVuY2ggPSB0cnVlO1xyXG5cdFx0XHR9XHJcblx0XHRcdGlmICh0aGlzLl9hY3RhbmkuaXNFbmQoKSkge1xyXG5cdFx0XHRcdHRoaXMuaXNfZW5kID0gdHJ1ZTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdHRoaXMuaXNfbGF1bmNoID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5pc19lbmQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdH1cclxuXHRcclxuXHRpc0VuZCgpIHtcclxuXHRcdHJldHVybiB0aGlzLmlzX2VuZDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7U2NlbmVPYmplY3R9IHRhcmdldE9iamVjdFxyXG5cdCAqL1xyXG5cdGFkZEF0dGFjayh0YXJnZXRPYmplY3QpIHtcclxuXHRcdC8qKiBAdHlwZSB7U2NlbmVDaGFyYWN0ZXJ9ICovXHJcblx0XHRjb25zdCBvd25lciA9IHRoaXMuX293bmVyO1xyXG5cclxuXHRcdGxldCBhdHRhY2sgPSBuZXcgQXR0YWNrUGFpcigpO1xyXG5cclxuXHRcdC8vYXR0YWNrLm9iamVjdGlkID0gdGFyZ2V0T2JqZWN0LiRvYmplY3RpZDtcclxuXHRcdGF0dGFjay5zZXRUYXJnZXRPYmplY3QodGFyZ2V0T2JqZWN0KTtcclxuXHJcblx0XHRhdHRhY2suYWxsRGFtYWdlLmxlbmd0aCA9IHRoaXMuZGF0YS5jb21tb24uYXR0YWNrQ291bnQ7XHJcblxyXG5cdFx0Ly8vL2FwcGx5IGRhbWFnZVxyXG5cdFx0Ly9mb3IgKGxldCBpID0gMDsgaSA8IGF0dGFjay5hbGxEYW1hZ2UubGVuZ3RoOyArK2kpIHtcclxuXHRcdC8vXHR0YXJnZXRPYmplY3QuZGFtYWdlKG93bmVyLCAxMjMpO1xyXG5cdFx0Ly99XHJcblx0XHQvLy8vXHJcblx0XHQvL3RhcmdldE9iamVjdC5rbm9ja2JhY2soY2hhcmEsIDE2LCAxNik7XHJcblxyXG5cdFx0dGhpcy5hdHRhY2tJbmZvLmFsbEF0dGFjay5wdXNoKGF0dGFjayk7XHJcblx0fVxyXG5cdFxyXG5cdGNyZWF0ZUJ1bGxldChlZmZlY3ROYW1lKSB7XHJcblx0XHRsZXQgZWZmLCBidWxsZXQ7XHJcblxyXG5cdFx0Ly9idWxsZXQgcmVuZGVyZXJcclxuXHRcdHtcclxuXHRcdFx0ZWZmID0gdGhpcy5fYWRkRWZmZWN0KGVmZmVjdE5hbWUpO1xyXG5cclxuXHRcdFx0ZWZmLmlzX2xvb3AgPSB0cnVlO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vYnVsbGV0IHBoeXNpY3NcclxuXHRcdHtcclxuXHRcdFx0YnVsbGV0ID0gbmV3IFBCdWxsZXQodGhpcy5vd25lci4kcGh5c2ljcywgdGhpcywgZWZmKTtcclxuXHJcblx0XHRcdGJ1bGxldC5fY3JlYXRlKCk7XHJcblxyXG5cdFx0XHRidWxsZXQubGF1bmNoKG51bGwsIHRoaXMub3duZXIuJHBoeXNpY3Muc3RhdGUuZnJvbnQgKiAod2luZG93LiRCVUxMRVRfU1BFRUQgfCAzMiksIDApO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vbGluayByZW5kZXJlciBhbmQgcGh5c2ljc1xyXG5cdFx0ZWZmLiRwaHlzaWNzID0gYnVsbGV0O1xyXG5cclxuXHRcdHJldHVybiBidWxsZXQ7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge2Jvb2xlYW59IFtpc0J1bGxldD1mYWxzZV1cclxuXHQgKi9cclxuXHRfYWRkRGVmYXVsdEVmZmVjdChpc0J1bGxldCkge1xyXG5cdFx0dGhpcy5fYXBwbHlEZWZhdWx0QWN0aW9uKCk7XHJcblx0XHR0aGlzLl9hZGRFZmZlY3QoXCJlZmZlY3RcIiwgaXNCdWxsZXQpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IFtlZmZlY3ROYW1lPVwiZWZmZWN0XCJdXHJcblx0ICogQHBhcmFtIHtib29sZWFufSBbaXNCdWxsZXQ9ZmFsc2VdXHJcblx0ICovXHJcblx0X2FkZEVmZmVjdChlZmZlY3ROYW1lID0gXCJlZmZlY3RcIiwgaXNCdWxsZXQpIHtcclxuXHRcdGxldCBhY3Rpb24gPSB0aGlzLmRhdGFbZWZmZWN0TmFtZV0uYWN0aW9uO1xyXG5cdFx0aWYgKGFjdGlvbikge1xyXG5cdFx0XHR0aGlzLl9hcHBseUFjdGlvbihhY3Rpb24pO1xyXG5cdFx0fVxyXG5cclxuXHRcdHRyeSB7XHJcblx0XHRcdGNvbnN0IHR5cGUgPSB0aGlzLmFjdFR5cGU7XHJcblx0XHRcdGxldCBlZmZlY3QgPSBuZXcgU2tpbGxFZmZlY3RBbmltYXRpb24odGhpcy5kYXRhW2VmZmVjdE5hbWVdLyosIFt0aGlzLnVybCwgZWZmZWN0TmFtZV0uam9pbihcIi9cIikqLyk7XHJcblxyXG5cdFx0XHRpZiAoaXNCdWxsZXQpIHtcclxuXHRcdFx0XHQvLy4uLj8/XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSB7XHJcblx0XHRcdFx0ZWZmZWN0LnRhcmdldFJlbmRlcmVyID0gdGhpcy5fY3JyO1xyXG5cdFx0XHR9XHJcblx0XHRcdGVmZmVjdC5sb2FkKHR5cGUpO1xyXG5cclxuXHRcdFx0RWZmZWN0TWFuYWdlci5BZGRFZmZlY3QoZWZmZWN0KTtcclxuXHJcblx0XHRcdHJldHVybiBlZmZlY3Q7XHJcblx0XHR9XHJcblx0XHRjYXRjaCAoZXgpIHtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHhcclxuXHQgKiBAcGFyYW0ge251bWJlcn0geVxyXG5cdCAqIEBwYXJhbSB7e3g6IG51bWJlciwgeTogbnVtYmVyfT19IHRhcmdldFxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyPX0gdHlwZVxyXG5cdCAqL1xyXG5cdF9hZGRIaXRFZmZlY3QoeCwgeSwgdGFyZ2V0LCB0eXBlKSB7XHJcblx0XHRsZXQgaGl0ID0gbmV3IFNraWxsSGl0QW5pbWF0aW9uKCk7XHJcblx0XHRcclxuXHRcdGhpdC50YXJnZXQgPSB0YXJnZXQ7XHJcblx0XHRcclxuXHRcdGhpdC5sb2FkKHRoaXMudXJsICsgXCIvaGl0L1wiICsgdHlwZSwgdGhpcy5kYXRhLmhpdCwgdHlwZSk7XHJcblx0XHRcclxuXHRcdEVmZmVjdE1hbmFnZXIuQWRkRWZmZWN0KGhpdCk7XHJcblx0fVxyXG5cclxuXHJcblx0LyoqXHJcblx0ICogQHJldHVybnMge2Z1bmN0aW9uKCk6KFQgZXh0ZW5kcyBTa2lsbEFuaW1hdGlvbkJhc2UpfVxyXG5cdCAqL1xyXG5cdF9kZWNpZGVfdHlwZSgpIHtcclxuXHRcdGNvbnN0IGluZm8gPSB0aGlzLmRhdGEuaW5mbztcclxuXHJcblx0XHQvL1RPRE86IHJlZ2lzdGVyIHNraWxsXHJcblxyXG5cdFx0c3dpdGNoICh0aGlzLnR5cGUpIHtcclxuXHRcdFx0Y2FzZSAxOlxyXG5cdFx0XHRjYXNlIDI6XHJcblx0XHRcdFx0aWYgKGluZm8ucmFwaWRBdHRhY2spIHtcclxuXHRcdFx0XHRcdHJldHVybiBfU2tpbGxBbmltYXRpb25fUmFwaWRBdHRhY2s7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0XHRjYXNlIDQwOlxyXG5cdFx0XHRcdGlmIChpbmZvLmNhc3Rlck1vdmUgJiYgaW5mby5hdmFsaWFibGVJbkp1bXBpbmdTdGF0ZSkge1xyXG5cdFx0XHRcdFx0cmV0dXJuIF9Ta2lsbEFuaW1hdGlvbl9OX0p1bXA7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cdFx0fVxyXG5cdFx0cmV0dXJuIF9Ta2lsbEFuaW1hdGlvbl9EZWZhdWx0O1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHRnZXQgX2VmZmVjdF9uYW1lcygpIHtcclxuXHRcdHJldHVybiBbXCJlZmZlY3RcIiwgXCJoaXRcIl07XHJcblx0fVxyXG5cdFxyXG5cdHN0YXRpYyBnZXQgX2Jhc2VfcGF0aCgpIHtcclxuXHRcdHJldHVybiBcIi9Ta2lsbFwiO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgX1NraWxsQW5pbWF0aW9uX0RlZmF1bHQgZXh0ZW5kcyBTa2lsbEFuaW1hdGlvbkJhc2Uge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRocm93IG5ldyBUeXBlRXJyb3IoXCJjb25zdHJ1Y3RvclwiKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqL1xyXG5cdF9pbml0KCkge1xyXG5cdFx0dGhpcy5fYXBwbHlEZWZhdWx0QWN0aW9uKCk7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHRcdHRoaXMuX2RlZmF1bHRfdXBkYXRlKHN0YW1wKTtcclxuXHR9XHJcbn1cclxuXHJcbmNsYXNzIF9Ta2lsbEFuaW1hdGlvbl9SYXBpZEF0dGFjayBleHRlbmRzIFNraWxsQW5pbWF0aW9uQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcImNvbnN0cnVjdG9yXCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICovXHJcblx0X2luaXQoKSB7XHJcblx0XHR0aGlzLl9hcHBseURlZmF1bHRBY3Rpb24oKTtcclxuXHJcblx0XHR0aGlzLnN0YXRlID0gXCJwcmVwYXJlXCI7XHJcblx0XHR0aGlzLl9zdGF0ZV9mdW5jID0gdGhpcy5fcHJlcGFyZTtcclxuXHRcdHRoaXMuY3VycmVudF9lZmZlY3QgPSB0aGlzLl9hZGRFZmZlY3QodGhpcy5zdGF0ZSk7XHJcblxyXG5cdFx0LyoqIGFuaW1hdGlvbiAqL1xyXG5cdFx0dGhpcy50aW1lID0gMDtcclxuXHJcblx0XHQvKiogZmlyZSBidWxsZXQgKi9cclxuXHRcdHRoaXMudGljayA9IDA7XHJcblxyXG5cdFx0dGhpcy5mYWRlVG90YWxUaW1lID0gdGhpcy5fYWN0YW5pLmdldFRvdGFsVGltZSgpO1xyXG5cclxuXHRcdHRoaXMuX2Nyci5maXhlZF9zcGVlZCA9IHRydWU7XHJcblx0fVxyXG5cclxuXHRfcHJlcGFyZSgpIHtcclxuXHRcdHRoaXMuY3VycmVudF9lZmZlY3Qub3BhY2l0eSA9IHRoaXMudGltZSAvIHRoaXMuZmFkZVRvdGFsVGltZTtcclxuXHRcdGlmICh0aGlzLmN1cnJlbnRfZWZmZWN0Lm9wYWNpdHkgPiAxKSB7XHJcblx0XHRcdHRoaXMuY3VycmVudF9lZmZlY3Qub3BhY2l0eSA9IDE7XHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKHRoaXMuX2FjdGFuaS5pc0VuZCgpKSB7XHJcblx0XHRcdHRoaXMuY3VycmVudF9lZmZlY3Qub3BhY2l0eSA9IDA7Ly9wcmVwYXJlXHJcblx0XHRcdHRoaXMuY3VycmVudF9lZmZlY3QuZGVzdHJveSgpO1xyXG5cclxuXHRcdFx0dGhpcy5zdGF0ZSA9IFwia2V5ZG93blwiO1xyXG5cdFx0XHR0aGlzLl9zdGF0ZV9mdW5jID0gdGhpcy5fa2V5ZG93bjtcclxuXHRcdFx0dGhpcy5jdXJyZW50X2VmZmVjdCA9IHRoaXMuX2FkZEVmZmVjdCh0aGlzLnN0YXRlKTtcclxuXHJcblx0XHRcdHRoaXMuX2FjdGFuaS5sb29wID0gdHJ1ZTtcclxuXHRcdFx0dGhpcy5jdXJyZW50X2VmZmVjdC5pc19sb29wID0gdHJ1ZTtcclxuXHJcblx0XHRcdHRoaXMudGltZSA9IDA7Ly9yZXNldFxyXG5cdFx0fVxyXG5cdH1cclxuXHRfa2V5ZG93bigpIHtcclxuXHRcdGlmICh0aGlzLl9hY3RhbmkuaXNFbmQoKSkge1xyXG5cdFx0XHQvL3RoaXMuY3VycmVudF9lZmZlY3QucmVzZXQoKTtcclxuXHRcdFx0Ly90aGlzLmN1cnJlbnRfZWZmZWN0Lm9wYWNpdHkgPSAxO1xyXG5cdFx0XHQvL3RoaXMuX2FjdGFuaS5yZXNldCgpO1xyXG5cdFx0XHR0aGlzLnRpbWUgPSAwOy8vcmVzZXRcclxuXHRcdH1cclxuXHR9XHJcblx0X2tleWRvd25lbmQoKSB7XHJcblx0XHR0aGlzLmN1cnJlbnRfZWZmZWN0Lm9wYWNpdHkgPSAxIC0gKHRoaXMudGltZSAvIHRoaXMuZmFkZVRvdGFsVGltZSk7XHJcblx0XHRpZiAodGhpcy5jdXJyZW50X2VmZmVjdC5vcGFjaXR5IDwgMCkge1xyXG5cdFx0XHR0aGlzLmN1cnJlbnRfZWZmZWN0Lm9wYWNpdHkgPSAwO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmICh0aGlzLl9hY3RhbmkuaXNFbmQoKSkge1xyXG5cdFx0XHR0aGlzLmN1cnJlbnRfZWZmZWN0Lm9wYWNpdHkgPSAwOy8va2V5ZG93bmVuZFxyXG5cdFx0XHR0aGlzLmN1cnJlbnRfZWZmZWN0LmRlc3Ryb3koKTtcclxuXHJcblx0XHRcdHRoaXMuX2Nyci5maXhlZF9zcGVlZCA9IGZhbHNlO1xyXG5cdFx0XHR0aGlzLmlzX2xhdW5jaCA9IHRydWU7XHJcblx0XHRcdHRoaXMuaXNfZW5kID0gdHJ1ZTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGlzIG93bmVyIGNhbiBpbnZva2Ugc2tpbGxcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge1NjZW5lQ2hhcmFjdGVyfSBvd25lclxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdHRlc3Qob3duZXIpIHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtQYXJ0aWFsPF9BcnJvd0tleT59IGlucHV0S2V5IC0ga2V5RG93biB0aWNrIGNvdW50ZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0ga2V5RG93biAtIGtleURvd24gdGljayBjb3VudGVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGtleVVwIC0gaXMga2V5VXBcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBjYW5jZWwgcGxheWVyIGRlZmF1bHQgY29udHJvbFxyXG5cdCAqL1xyXG5cdGNvbnRyb2woaW5wdXRLZXksIGtleURvd24sIGtleVVwKSB7XHJcblx0XHRzd2l0Y2ggKHRoaXMuc3RhdGUpIHtcclxuXHRcdFx0Y2FzZSBcInByZXBhcmVcIjpcclxuXHRcdFx0Y2FzZSBcImtleWRvd25cIjpcclxuXHRcdFx0XHRpZiAoIWtleURvd24gfHwga2V5VXApIHtcclxuXHRcdFx0XHRcdHRoaXMuY3VycmVudF9lZmZlY3Qub3BhY2l0eSA9IDA7Ly9rZXlkb3duXHJcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRfZWZmZWN0LmRlc3Ryb3koKTtcclxuXHJcblx0XHRcdFx0XHR0aGlzLnN0YXRlID0gXCJrZXlkb3duZW5kXCI7XHJcblx0XHRcdFx0XHR0aGlzLl9zdGF0ZV9mdW5jID0gdGhpcy5fa2V5ZG93bmVuZDtcclxuXHRcdFx0XHRcdHRoaXMuY3VycmVudF9lZmZlY3QgPSB0aGlzLl9hZGRFZmZlY3QodGhpcy5zdGF0ZSk7XHJcblx0XHRcdFx0XHR0aGlzLmZhZGVUb3RhbFRpbWUgPSB0aGlzLl9hY3RhbmkuZ2V0VG90YWxUaW1lKCk7XHJcblxyXG5cdFx0XHRcdFx0dGhpcy5fYWN0YW5pLmxvb3AgPSBmYWxzZTtcclxuXHRcdFx0XHRcdHRoaXMudGltZSA9IDA7Ly9yZXNldFxyXG5cdFx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBzdGFtcFxyXG5cdCAqL1xyXG5cdHVwZGF0ZShzdGFtcCkge1xyXG5cdFx0Ly9rZXlkb3duKGZpcnN0IHN0ZXApOiBwcmVwYXJlXHJcblx0XHQvL2tleWRvd24oc2Vjb25kIHN0ZXApOiBrZXlkb3duICsga2V5ZG93bjBcclxuXHRcdC8va2V5dXA6IGtleWRvd25lbmRcclxuXHJcblx0XHRzdGFtcCAqPSB0aGlzLl9jcnIuZ2V0U3BlZWQoKTtcclxuXHRcdHRoaXMudGltZSArPSBzdGFtcDtcclxuXHJcblx0XHQrK3RoaXMudGljaztcclxuXHJcblx0XHR0aGlzLl9zdGF0ZV9mdW5jKCk7XHJcblxyXG5cdFx0aWYgKHRoaXMudGljayAlICh3aW5kb3cuJEZJUkVfQlVMTEVUX1QgfCAzKSA9PSAod2luZG93LiRGSVJFX0JVTExFVF9UMiB8IDIpICYmIHRoaXMuc3RhdGUgIT0gXCJrZXlkb3duZW5kXCIpIHtcclxuXHRcdFx0dGhpcy5jcmVhdGVCdWxsZXQoXCJiYWxsXCIpO1xyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQHZpcnR1YWxcclxuXHQgKi9cclxuXHRnZXQgX2VmZmVjdF9uYW1lcygpIHtcclxuXHRcdHJldHVybiBbXCJwcmVwYXJlXCIsIFwia2V5ZG93blwiLCBcImtleWRvd25lbmRcIiwgXCJoaXRcIiwgXCJiYWxsXCJdO1xyXG5cdH1cclxufVxyXG5cclxuY2xhc3MgX1NraWxsQW5pbWF0aW9uX05fSnVtcCBleHRlbmRzIFNraWxsQW5pbWF0aW9uQmFzZSB7XHJcblx0Y29uc3RydWN0b3IoKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihcImNvbnN0cnVjdG9yXCIpO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICovXHJcblx0X2luaXQoKSB7XHJcblx0XHR0aGlzLmp1bXBfbWF4X2NvdW50ID0gKHdpbmRvdy5qdW1wX21heF9jb3VudCB8fCAyKTtcclxuXHR9XHJcblxyXG5cdGp1bXAyKCkge1xyXG5cdFx0Y29uc3QgY3JyID0gdGhpcy5fY3JyO1xyXG5cdFx0Ly9jb25zdCBib2R5ID0gdGhpcy5fb3duZXJfcGxheWVyLiRwaHlzaWNzLmJvZHk7XHJcblx0XHRjb25zdCBmb290X3dhbGsgPSB0aGlzLl9vd25lcl9wbGF5ZXIuJHBoeXNpY3MuZm9vdF93YWxrO1xyXG5cclxuXHRcdGNvbnN0IHBvcyA9IHRoaXMuX293bmVyX3BsYXllci4kcGh5c2ljcy5nZXRQb3NpdGlvbigpO1xyXG5cdFx0Y29uc29sZS5sb2coXCJwb3M6IHsgeDogJW8sIHk6ICVvIH1cIiwgcG9zLngsIHBvcy55KTtcclxuXHJcblx0XHQvL2JvZHkuQ29uc3RhbnRWZWxvY2l0eVdvcmxkQ2VudGVyMigod2luZG93LiROSm1wWCB8fCA0MCkgKiBjcnIuZnJvbnQsICh3aW5kb3cuJE5KbXBZIHx8IDApKTtcclxuXHRcdGZvb3Rfd2Fsay5Db25zdGFudFZlbG9jaXR5V29ybGRDZW50ZXIyKCh3aW5kb3cuJE5KbXBYIHx8IDQwKSAqIGNyci5mcm9udCwgKHdpbmRvdy4kTkptcFkgfHwgMCkpO1xyXG5cclxuXHRcdHRoaXMuX2FkZERlZmF1bHRFZmZlY3QoKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGlzIG93bmVyIGNhbiBpbnZva2Ugc2tpbGxcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge1NjZW5lQ2hhcmFjdGVyfSBvd25lclxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdHRlc3Qob3duZXIpIHtcclxuXHRcdGNvbnN0ICRwaHlzaWNzID0gb3duZXIuJHBoeXNpY3M7XHJcblx0XHRjb25zdCBzdGF0ZSA9IG93bmVyLiRwaHlzaWNzLnN0YXRlO1xyXG5cdFx0cmV0dXJuICEkcGh5c2ljcy4kZm9vdGhvbGQgJiYgc3RhdGUuanVtcCAmJiBzdGF0ZS5qdW1wX2NvdW50IDwgdGhpcy5qdW1wX21heF9jb3VudDtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqIEBwYXJhbSB7UGFydGlhbDxfQXJyb3dLZXk+fSBpbnB1dEtleSAtIGtleURvd24gdGljayBjb3VudGVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGtleURvd24gLSBrZXlEb3duIHRpY2sgY291bnRlclxyXG5cdCAqIEBwYXJhbSB7bnVtYmVyfSBrZXlVcCAtIGlzIGtleVVwXHJcblx0ICogQHJldHVybnMge2Jvb2xlYW59IC0gY2FuY2VsIHBsYXllciBkZWZhdWx0IGNvbnRyb2xcclxuXHQgKi9cclxuXHRjb250cm9sKGlucHV0S2V5LCBrZXlEb3duLCBrZXlVcCkge1xyXG5cdFx0aWYgKCF0aGlzLl9vd25lcl9wbGF5ZXIpIHtcclxuXHRcdFx0ZGVidWdnZXI7XHJcblx0XHRcdHJldHVybjtcclxuXHRcdH1cclxuXHRcdGlmIChrZXlEb3duID09IDEgJiYgdGhpcy50ZXN0KHRoaXMuX293bmVyX3BsYXllcikpIHtcclxuXHRcdFx0Y29uc3QgJHBoeXNpY3MgPSB0aGlzLl9vd25lcl9wbGF5ZXIuJHBoeXNpY3M7XHJcblx0XHRcdFxyXG5cdFx0XHQkcGh5c2ljcy5zdGF0ZS5qdW1wX2NvdW50ICs9ICRwaHlzaWNzLnN0YXRlLmp1bXBfY291bnQgPyAxIDogMjtcclxuXHJcblx0XHRcdHRoaXMuanVtcDIoKVxyXG5cdFx0fVxyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IHN0YW1wXHJcblx0ICovXHJcblx0dXBkYXRlKHN0YW1wKSB7XHJcblx0XHRjb25zdCAkcGh5c2ljcyA9IHRoaXMuX293bmVyX3BsYXllci4kcGh5c2ljcztcclxuXHJcblx0XHRpZiAodGhpcy5faXNGaW5pc2hEZWZhdWx0QWN0aW9uKCkpIHtcclxuXHRcdFx0dGhpcy5pc19lbmQgPSB0cnVlO1xyXG5cdFx0fVxyXG5cdFx0ZWxzZSB7XHJcblx0XHRcdGlmICgkcGh5c2ljcy4kZm9vdGhvbGQpIHtcclxuXHRcdFx0XHR0aGlzLmlzX2VuZCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdFx0ZWxzZSBpZiAoISRwaHlzaWNzLnN0YXRlLmp1bXApIHtcclxuXHRcdFx0XHR0aGlzLmlzX2VuZCA9IHRydWU7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUT0RPOiBhZGQgc2tpbGxcclxuICovXHJcbmNsYXNzIF9fU2tpbGxBbmltYXRpb25fVGVtcGxhdGUgZXh0ZW5kcyBTa2lsbEFuaW1hdGlvbkJhc2Uge1xyXG5cdC8qKlxyXG5cdCAqIEBvdmVycmlkZVxyXG5cdCAqL1xyXG5cdF9pbml0KCkge1xyXG5cdFx0dGhpcy5fYXBwbHlEZWZhdWx0QWN0aW9uKCk7XHJcblx0XHQvLyAuLi5cclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIGlzIG93bmVyIGNhbiBpbnZva2Ugc2tpbGxcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge1NjZW5lQ2hhcmFjdGVyfSBvd25lclxyXG5cdCAqIEByZXR1cm5zIHtib29sZWFufVxyXG5cdCAqL1xyXG5cdHRlc3Qob3duZXIpIHtcclxuXHRcdHJldHVybiB0cnVlO1xyXG5cdH1cclxuXHJcblx0LyoqXHJcblx0ICogQG92ZXJyaWRlXHJcblx0ICogQHBhcmFtIHtQYXJ0aWFsPF9BcnJvd0tleT59IGlucHV0S2V5IC0ga2V5RG93biB0aWNrIGNvdW50ZXJcclxuXHQgKiBAcGFyYW0ge251bWJlcn0ga2V5RG93biAtIGtleURvd24gdGljayBjb3VudGVyXHJcblx0ICogQHBhcmFtIHtudW1iZXJ9IGtleVVwIC0gaXMga2V5VXBcclxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn0gLSBjYW5jZWwgcGxheWVyIGRlZmF1bHQgY29udHJvbFxyXG5cdCAqL1xyXG5cdGNvbnRyb2woaW5wdXRLZXksIGtleURvd24sIGtleVVwKSB7XHJcblx0fVxyXG5cclxuXHQvKipcclxuXHQgKiBAb3ZlcnJpZGVcclxuXHQgKiBAcGFyYW0ge251bWJlcn0gc3RhbXBcclxuXHQgKi9cclxuXHR1cGRhdGUoc3RhbXApIHtcclxuXHR9XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBTY2VuZVNraWxsIGV4dGVuZHMgU2tpbGxBbmltYXRpb25CYXNlIHtcclxuXHRjb25zdHJ1Y3RvcigpIHtcclxuXHRcdHN1cGVyKCk7XHJcblxyXG5cdFx0LyoqIEB0eXBlIHtBdHRhY2tJbmZvfSAqL1xyXG5cdFx0dGhpcy5hdHRhY2tJbmZvID0gbmV3IEF0dGFja0luZm8oKTtcclxuXHR9XHJcblxyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBza2lsbElkXHJcblx0ICogQHBhcmFtIHtTY2VuZU9iamVjdH0gb3duZXJcclxuXHQgKi9cclxuXHRhc3luYyBsb2FkKHNraWxsSWQsIG93bmVyKSB7XHJcblx0XHR0aGlzLm93bmVyID0gb3duZXI7XHJcblxyXG5cdFx0aWYgKCFza2lsbElkKSB7XHJcblx0XHRcdHRocm93IG5ldyBFcnJvcihcIjEgYXJndW1lbnQgcmVxdWlyZWRcIik7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGlmIChTdHJpbmcoc2tpbGxJZCkubGVuZ3RoIDw9IDQpIHtcclxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwic2tpbGwgSUQgZm9ybWF0XCIpO1xyXG5cdFx0fVxyXG5cdFx0Ly9za2lsbElkID0gMTEyMDAxNzsvLzEwMDEwMDU7Ly8gam9iSWQgKyA0LWRpZ2l0XHJcblxyXG5cdFx0dGhpcy5hdHRhY2tJbmZvLnNraWxsSWQgPSBza2lsbElkO1xyXG5cdFx0XHJcblx0XHR0aGlzLnVwZGF0ZSA9IHRoaXMud2FpdF9sb2FkaW5nO1xyXG5cdFx0dGhpcy5jb250cm9sID0gdGhpcy53YWl0X2xvYWRpbmc7XHJcblx0XHRcclxuXHRcdHRyeSB7XHJcblx0XHRcdGxldCBsb2FkZWRfc2tpbGwgPSBTY2VuZVNraWxsLl9fbG9hZGVkX3NraWxsW3NraWxsSWRdO1xyXG5cdFx0XHRpZiAobG9hZGVkX3NraWxsKSB7XHJcblx0XHRcdFx0aWYgKGxvYWRlZF9za2lsbC4kcHJvbWlzZSkge1xyXG5cdFx0XHRcdFx0dGhpcy4kcHJvbWlzZSA9IGxvYWRlZF9za2lsbC4kcHJvbWlzZTtcclxuXHRcdFx0XHRcdGF3YWl0IGxvYWRlZF9za2lsbC4kcHJvbWlzZTtcclxuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLiRwcm9taXNlO1xyXG5cdFx0XHRcdH1cclxuXHRcdFx0XHR0aGlzLl9hc3NpZ24obG9hZGVkX3NraWxsKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRsZXQgcHJvbWlzZSA9IHRoaXMuX2xvYWQoc2tpbGxJZC8qLCBvd25lciovKTsvL293bmVyID8/XHJcblxyXG5cdFx0XHRcdHRoaXMuJHByb21pc2UgPSBwcm9taXNlO1xyXG5cclxuXHRcdFx0XHRTY2VuZVNraWxsLl9fbG9hZGVkX3NraWxsW3NraWxsSWRdID0gdGhpcztcclxuXHJcblx0XHRcdFx0YXdhaXQgcHJvbWlzZTtcclxuXHJcblx0XHRcdFx0ZGVsZXRlIHRoaXMuJHByb21pc2U7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKFwiY2FuIG5vdCBsb2FkIHNraWxsOiAlbywgb3duZXI6ICVvXCIsIHNraWxsSWQsIG93bmVyKTtcclxuXHRcdFx0ZGVsZXRlIHRoaXMuJHByb21pc2U7XHJcblx0XHRcdHRoaXMudXBkYXRlID0gdGhpcy5fX2xvYWRfZmFpbGVkOy8vZGVidWdcclxuXHRcdFx0dGhpcy5jb250cm9sID0gdGhpcy5fX2xvYWRfZmFpbGVkOy8vZGVidWdcclxuXHRcdFx0Ly9kZWxldGUgU2NlbmVTa2lsbC5fX2xvYWRlZF9za2lsbFtza2lsbElkXTsvL3RyeSByZWxvYWRcclxuXHRcdFx0dGhyb3cgZXg7XHJcblx0XHR9XHJcblx0XHRcclxuXHRcdGRlbGV0ZSB0aGlzLnVwZGF0ZTtcclxuXHRcdGRlbGV0ZSB0aGlzLmNvbnRyb2w7XHJcblx0fVxyXG5cdFxyXG5cdHdhaXRfbG9hZGluZygpIHtcclxuXHR9XHJcblx0XHJcblx0LyoqXHJcblx0ICogZGVidWdcclxuXHQgKi9cclxuXHRfX2xvYWRfZmFpbGVkKCkge1xyXG5cdH1cclxuXHRcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gc2tpbGxJZFxyXG5cdCAqIEByZXR1cm5zIHtTY2VuZVNraWxsfVxyXG5cdCAqL1xyXG5cdHN0YXRpYyBwcmVsb2FkKHNraWxsSWQpIHtcclxuXHRcdHRyeSB7XHJcblx0XHRcdGxldCBsb2FkZWRfc2tpbGwgPSBTY2VuZVNraWxsLl9fbG9hZGVkX3NraWxsW3NraWxsSWRdO1xyXG5cdFx0XHRpZiAobG9hZGVkX3NraWxsKSB7XHJcblx0XHRcdFx0cmV0dXJuIGxvYWRlZF9za2lsbDtcclxuXHRcdFx0fVxyXG5cdFx0XHRlbHNlIHtcclxuXHRcdFx0XHRsZXQgc2tpbGwgPSBuZXcgU2NlbmVTa2lsbCgpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRcdHNraWxsLmxvYWQoc2tpbGxJZCwgXCJzdGF0aWMgcHJlbG9hZCBubyBvd25lclwiKTtcclxuXHRcdFx0XHRcclxuXHRcdFx0XHRyZXR1cm4gc2tpbGw7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHRcdGNhdGNoIChleCkge1xyXG5cdFx0XHRjb25zb2xlLmVycm9yKFwiY2FuIG5vdCBwcmVsb2FkIHNraWxsOiAlb1wiLCBza2lsbElkKTtcclxuXHRcdFx0dGhyb3cgZXg7XHJcblx0XHR9XHJcblx0fVxyXG59XHJcblNjZW5lU2tpbGwuX19sb2FkZWRfc2tpbGwgPSB7fTtcclxuXHJcbndpbmRvdy4kU2NlbmVTa2lsbCA9IFNjZW5lU2tpbGw7XHJcblxyXG5jbGFzcyBfQXJyb3dLZXkge1xyXG5cdGNvbnN0cnVjdG9yKCkge1xyXG5cdFx0dGhpcy5sZWZ0ID0gMDtcclxuXHRcdHRoaXMudXAgPSAwO1xyXG5cdFx0dGhpcy5yaWdodCA9IDA7XHJcblx0XHR0aGlzLmRvd24gPSAwO1xyXG5cdH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/game/Skill.js\n");

/***/ }),

/***/ "./src/ui/Basic/KeySlot.js":
/*!*********************************!*\
  !*** ./src/ui/Basic/KeySlot.js ***!
  \*********************************/
/*! exports provided: KeySlot, CommandSlot, ActionSlot, SkillSlot */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"KeySlot\", function() { return KeySlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CommandSlot\", function() { return CommandSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ActionSlot\", function() { return ActionSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SkillSlot\", function() { return SkillSlot; });\n/* harmony import */ var _KeySlotData__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./KeySlotData */ \"./src/ui/Basic/KeySlotData.js\");\n/* harmony import */ var _game_Item__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../game/Item */ \"./src/game/Item.js\");\n﻿\r\n\r\n\r\n\r\n\r\nclass KeySlot {\r\n\t/**\r\n\t * @param {\"Command\"|\"Action\"|\"Item\"|\"Skill\"} type\r\n\t * @param {KeySlotData} data\r\n\t */\r\n\tconstructor(type, data) {\r\n\t\tif (true) {\r\n\t\t\tif ((type + \"Slot\") != data.constructor.name) {\r\n\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.type = type;\r\n\t\tthis.data = data;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * open/close ui, command...\r\n */\r\nclass CommandSlot extends _KeySlotData__WEBPACK_IMPORTED_MODULE_0__[\"KeySlotData\"] {\r\n\t/**\r\n\t * @param {string} command\r\n\t */\r\n\tconstructor(command) {\r\n\t\tsuper();\r\n\t\tthis.command = command;\r\n\t}\r\n}\r\n\r\n/**\r\n * charaction action key\r\n */\r\nclass ActionSlot extends _KeySlotData__WEBPACK_IMPORTED_MODULE_0__[\"KeySlotData\"] {\r\n\t/**\r\n\t * @param {string} action\r\n\t */\r\n\tconstructor(action) {\r\n\t\tsuper();\r\n\t\tthis.action = action;\r\n\t}\r\n}\r\n\r\n\r\n//TODO: SkillSlot.js 未完成\r\nclass SkillSlot extends _KeySlotData__WEBPACK_IMPORTED_MODULE_0__[\"KeySlotData\"] {\r\n\t/**\r\n\t * @param {string} skill_id\r\n\t */\r\n\tconstructor(skill_id) {\r\n\t\tsuper();\r\n\t\tthis.skill_id = skill_id;\r\n\t}\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdWkvQmFzaWMvS2V5U2xvdC5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy91aS9CYXNpYy9LZXlTbG90LmpzP2VkZmIiXSwic291cmNlc0NvbnRlbnQiOlsi77u/XHJcbmltcG9ydCB7IEtleVNsb3REYXRhIH0gZnJvbSBcIi4vS2V5U2xvdERhdGFcIjtcclxuaW1wb3J0IHsgSXRlbVNsb3QgfSBmcm9tIFwiLi4vLi4vZ2FtZS9JdGVtXCI7XHJcblxyXG5cclxuZXhwb3J0IGNsYXNzIEtleVNsb3Qge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7XCJDb21tYW5kXCJ8XCJBY3Rpb25cInxcIkl0ZW1cInxcIlNraWxsXCJ9IHR5cGVcclxuXHQgKiBAcGFyYW0ge0tleVNsb3REYXRhfSBkYXRhXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IodHlwZSwgZGF0YSkge1xyXG5cdFx0aWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcclxuXHRcdFx0aWYgKCh0eXBlICsgXCJTbG90XCIpICE9IGRhdGEuY29uc3RydWN0b3IubmFtZSkge1xyXG5cdFx0XHRcdGRlYnVnZ2VyO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0XHR0aGlzLnR5cGUgPSB0eXBlO1xyXG5cdFx0dGhpcy5kYXRhID0gZGF0YTtcclxuXHR9XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogb3Blbi9jbG9zZSB1aSwgY29tbWFuZC4uLlxyXG4gKi9cclxuZXhwb3J0IGNsYXNzIENvbW1hbmRTbG90IGV4dGVuZHMgS2V5U2xvdERhdGEge1xyXG5cdC8qKlxyXG5cdCAqIEBwYXJhbSB7c3RyaW5nfSBjb21tYW5kXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoY29tbWFuZCkge1xyXG5cdFx0c3VwZXIoKTtcclxuXHRcdHRoaXMuY29tbWFuZCA9IGNvbW1hbmQ7XHJcblx0fVxyXG59XHJcblxyXG4vKipcclxuICogY2hhcmFjdGlvbiBhY3Rpb24ga2V5XHJcbiAqL1xyXG5leHBvcnQgY2xhc3MgQWN0aW9uU2xvdCBleHRlbmRzIEtleVNsb3REYXRhIHtcclxuXHQvKipcclxuXHQgKiBAcGFyYW0ge3N0cmluZ30gYWN0aW9uXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3IoYWN0aW9uKSB7XHJcblx0XHRzdXBlcigpO1xyXG5cdFx0dGhpcy5hY3Rpb24gPSBhY3Rpb247XHJcblx0fVxyXG59XHJcblxyXG5cclxuLy9UT0RPOiBTa2lsbFNsb3QuanMg5pyq5a6M5oiQXHJcbmV4cG9ydCBjbGFzcyBTa2lsbFNsb3QgZXh0ZW5kcyBLZXlTbG90RGF0YSB7XHJcblx0LyoqXHJcblx0ICogQHBhcmFtIHtzdHJpbmd9IHNraWxsX2lkXHJcblx0ICovXHJcblx0Y29uc3RydWN0b3Ioc2tpbGxfaWQpIHtcclxuXHRcdHN1cGVyKCk7XHJcblx0XHR0aGlzLnNraWxsX2lkID0gc2tpbGxfaWQ7XHJcblx0fVxyXG59XHJcblxyXG5cclxuXHJcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOyIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/ui/Basic/KeySlot.js\n");

/***/ }),

/***/ "./src/ui/Basic/KeySlotData.js":
/*!*************************************!*\
  !*** ./src/ui/Basic/KeySlotData.js ***!
  \*************************************/
/*! exports provided: KeySlotData */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"KeySlotData\", function() { return KeySlotData; });\n﻿\r\nclass KeySlotData {\r\n}\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvdWkvQmFzaWMvS2V5U2xvdERhdGEuanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvdWkvQmFzaWMvS2V5U2xvdERhdGEuanM/ZGQ2NSJdLCJzb3VyY2VzQ29udGVudCI6WyLvu79cclxuZXhwb3J0IGNsYXNzIEtleVNsb3REYXRhIHtcclxufVxyXG5cclxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/ui/Basic/KeySlotData.js\n");

/***/ })

}]);